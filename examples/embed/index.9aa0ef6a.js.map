{"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAI,WAAW;AAAK,IAAI,WAAW;AAAK,IAAI,aAAa;AAAM,IAAI,eAAe;AAAmB,OAAO,OAAO,gBAAgB;AAAmB;AAEtJ,iJAAiJ,GACjJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA,GACA,IAAI,aAAa;AACjB,IAAI,YAAY,OAAO,OAAO;AAC9B,SAAS,OAAO,UAAU;IACxB,UAAU,KAAK,IAAI,EAAE;IACrB,IAAI,CAAC,MAAM;QACT,MAAM,OAAO,OAAO,OAAO,CAAC,WAAW;QACvC,kBAAkB,EAAE;QACpB,mBAAmB,EAAE;QACrB,QAAQ,SAAU,EAAE;YAClB,IAAI,CAAC,iBAAiB,KAAK,MAAM,YAAa;QAChD;QACA,SAAS,SAAU,EAAE;YACnB,IAAI,CAAC,kBAAkB,KAAK;QAC9B;IACF;IACA,OAAO,OAAO,OAAO,CAAC,WAAW,GAAG;AACtC;AACA,OAAO,OAAO,SAAS;AACvB,OAAO,OAAO,UAAU,CAAC;AACzB,IAAI,cAAc,0BAA0B,KAAI,gBAAgB,mCAAmC,KAAI,eAAe,mCAAmC;AAEzJ,SAAS;IACP,OAAO,YAAa,CAAA,SAAS,SAAS,QAAQ,YAAY,IAAI,SAAS,WAAW,WAAU;AAC9F;AACA,SAAS;IACP,OAAO,YAAY,SAAS;AAC9B;AAEA,wCAAwC;AACxC,IAAI,SAAS,OAAO,OAAO;AAC3B,IAAI,AAAC,CAAA,CAAC,UAAU,CAAC,OAAO,eAAc,KAAM,OAAO,cAAc,aAAa;IAC5E,IAAI,WAAW;IACf,IAAI,OAAO;IACX,IAAI,WAAW,cAAc,SAAS,YAAY,YAAY,CAAC,8BAA8B,KAAK,YAAY,QAAQ;IACtH,IAAI,KAAK,IAAI,UAAU,WAAW,QAAQ,WAAY,CAAA,OAAO,MAAM,OAAO,EAAC,IAAK;IAEhF,wBAAwB;IACxB,IAAI,SAAS,OAAO,WAAW,cAAc,OAAO,YAAY,cAAc,OAAO,UAAU;IAE/F,oDAAoD;IACpD,0DAA0D;IAC1D,IAAI,oBAAoB;IACxB,IAAI;QACD,CAAA,GAAG,IAAG,EAAG;IACZ,EAAE,OAAO,KAAK;QACZ,oBAAoB,IAAI,MAAM,SAAS;IACzC;IAEA,aAAa;IACb,GAAG,YAAY,eAAgB,MAAM,wBAAwB,GAAzB;QAClC,gBAAgB,CAAC,EAAE,0BAA0B;QAC7C,iBAAiB,EAAE;QACnB,kBAAkB,EAAE;QACpB,IAAI,KAAK,eAAe,MAAK,KAAK,MAAM,MAAM;QAC9C,IAAI,KAAK,SAAS,UAAU;YAC1B,uCAAuC;YACvC,IAAI,OAAO,aAAa,aACtB;YAEF,IAAI,SAAS,KAAK,OAAO,OAAO,CAAA,QAAS,MAAM,YAAY;YAE3D,oBAAoB;YACpB,IAAI,UAAU,OAAO,MAAM,CAAA;gBACzB,OAAO,MAAM,SAAS,SAAS,MAAM,SAAS,QAAQ,eAAe,OAAO,OAAO,MAAM,MAAM,IAAI,MAAM;YAC3G;YACA,IAAI,SAAS;gBACX,QAAQ;gBAER,yEAAyE;gBACzE,IAAI,OAAO,WAAW,eAAe,OAAO,gBAAgB,aAC1D,OAAO,cAAc,IAAI,YAAY;gBAEvC,MAAM,gBAAgB;gBAEtB,0BAA0B;gBAC1B,IAAI,kBAAkB,CAAC,EAAE,0BAA0B;gBACnD,IAAK,IAAI,IAAI,GAAG,IAAI,gBAAgB,QAAQ,IAAK;oBAC/C,IAAI,KAAK,eAAe,CAAC,EAAE,CAAC,EAAE;oBAC9B,IAAI,CAAC,eAAe,CAAC,GAAG,EAAE;wBACxB,WAAW,eAAe,CAAC,EAAE,CAAC,EAAE,EAAE;wBAClC,eAAe,CAAC,GAAG,GAAG;oBACxB;gBACF;gBAEA,8FAA8F;gBAC9F,kBAAkB,CAAC;gBACnB,IAAK,IAAI,IAAI,GAAG,IAAI,eAAe,QAAQ,IAAK;oBAC9C,IAAI,KAAK,cAAc,CAAC,EAAE,CAAC,EAAE;oBAC7B,IAAI,CAAC,eAAe,CAAC,GAAG,EAAE;wBACxB,UAAU,cAAc,CAAC,EAAE,CAAC,EAAE,EAAE;wBAChC,eAAe,CAAC,GAAG,GAAG;oBACxB;gBACF;YACF,OAAO;QACT;QACA,IAAI,KAAK,SAAS,SAAS;YACzB,+BAA+B;YAC/B,KAAK,IAAI,kBAAkB,KAAK,YAAY,KAAM;gBAChD,IAAI,QAAQ,eAAe,YAAY,eAAe,YAAY,eAAe;gBACjF,QAAQ,MAAM,4BAAkB,eAAe,UAAU,OAAO,QAAQ,SAAS,eAAe,MAAM,KAAK;YAC7G;YACA,IAAI,OAAO,aAAa,aAAa;gBACnC,gCAAgC;gBAChC;gBACA,IAAI,UAAU,mBAAmB,KAAK,YAAY;gBAClD,aAAa;gBACb,SAAS,KAAK,YAAY;YAC5B;QACF;IACF;IACA,GAAG,UAAU,SAAU,CAAC;QACtB,QAAQ,MAAM,EAAE;IAClB;IACA,GAAG,UAAU;QACX,QAAQ,KAAK;IACf;AACF;AACA,SAAS;IACP,IAAI,UAAU,SAAS,eAAe;IACtC,IAAI,SAAS;QACX,QAAQ;QACR,QAAQ,IAAI;IACd;AACF;AACA,SAAS,mBAAmB,WAAW;IACrC,IAAI,UAAU,SAAS,cAAc;IACrC,QAAQ,KAAK;IACb,IAAI,YAAY;IAChB,KAAK,IAAI,cAAc,YAAa;QAClC,IAAI,QAAQ,WAAW,OAAO,SAAS,WAAW,OAAO,OAAO,CAAC,GAAG;YAClE,OAAO,CAAC,EAAE,EAAE;sCACoB,EAAE,mBAAmB,MAAM,UAAU,2FAA2F,EAAE,MAAM,SAAS;AACvL,EAAE,MAAM,KAAK,CAAC;QACV,GAAG,MAAM,WAAW;QACpB,aAAa,CAAC;;;aAGL,EAAE,WAAW,QAAQ;;aAErB,EAAE,MAAM;;UAEX,EAAE,WAAW,MAAM,IAAI,CAAA,OAAQ,uBAAa,OAAO,UAAU,KAAK,IAAI;;QAExE,EAAE,WAAW,gBAAgB,CAAC,uCAAuC,EAAE,WAAW,cAAc,sCAAsC,CAAC,GAAG,GAAG;;IAEjJ,CAAC;IACH;IACA,aAAa;IACb,QAAQ,YAAY;IACpB,OAAO;AACT;AACA,SAAS;IACP,IAAI,YAAY,UACd,SAAS;SACJ,IAAI,UAAU,OAAO,WAAW,OAAO,QAAQ,QACpD,OAAO,QAAQ;AAEnB;AACA,SAAS,WAAW,MAAM,EAAE,EAAE,EAAE,mCAAmC;IACjE,IAAI,UAAU,OAAO;IACrB,IAAI,CAAC,SACH,OAAO,EAAE;IAEX,IAAI,UAAU,EAAE;IAChB,IAAI,GAAG,GAAG;IACV,IAAK,KAAK,QACR,IAAK,KAAK,OAAO,CAAC,EAAE,CAAC,EAAE,CAAE;QACvB,MAAM,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;QACtB,IAAI,QAAQ,MAAM,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI,SAAS,EAAE,KAAK,IAC9D,QAAQ,KAAK;YAAC;YAAQ;SAAE;IAE5B;IAEF,IAAI,OAAO,QACT,UAAU,QAAQ,OAAO,WAAW,OAAO,QAAQ;IAErD,OAAO;AACT;AACA,SAAS,WAAW,IAAI;IACtB,IAAI,OAAO,KAAK,aAAa;IAC7B,IAAI,CAAC,MACH;IAEF,IAAI,UAAU,KAAK;IACnB,QAAQ,SAAS;QACf,IAAI,KAAK,eAAe,MACtB,aAAa;QACb,KAAK,WAAW,YAAY;IAEhC;IACA,QAAQ,aAAa,QACrB,aAAa;IACb,KAAK,MAAM,IAAI,CAAC,EAAE,GAAG,MAAM,KAAK;IAChC,aAAa;IACb,KAAK,WAAW,aAAa,SAAS,KAAK;AAC7C;AACA,IAAI,aAAa;AACjB,SAAS;IACP,IAAI,YACF;IAEF,aAAa,WAAW;QACtB,IAAI,QAAQ,SAAS,iBAAiB;QACtC,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,IAAK;YACrC,gCAAgC;YAChC,IAAI,KAAK,WAAW,MAAK,KAAK,CAAC,EAAE,CAAC,aAAa;YAC/C,IAAI,WAAW;YACf,IAAI,sBAAsB,aAAa,cAAc,IAAI,OAAO,mDAAmD,WAAW,KAAK,QAAQ,KAAK,QAAQ,WAAW,MAAM;YACzK,IAAI,WAAW,gBAAgB,KAAK,SAAS,KAAK,QAAQ,SAAS,YAAY,KAAK,CAAC;YACrF,IAAI,CAAC,UACH,WAAW,KAAK,CAAC,EAAE;QAEvB;QACA,aAAa;IACf,GAAG;AACL;AACA,SAAS,YAAY,KAAK;IACxB,IAAI,MAAM,SAAS,MAAM;QACvB,IAAI,OAAO,aAAa,aAAa;YACnC,IAAI,SAAS,SAAS,cAAc;YACpC,OAAO,MAAM,MAAM,MAAM,QAAQ,KAAK;YACtC,IAAI,MAAM,iBAAiB,YACzB,OAAO,OAAO;YAEhB,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,IAAI;gBACJ,OAAO,SAAS,IAAM,QAAQ;gBAC9B,OAAO,UAAU;gBAChB,CAAA,iBAAiB,SAAS,IAAG,MAAO,QAAQ,mBAAmB,KAAK,KAAa,eAAe,YAAY;YAC/G;QACF,OAAO,IAAI,OAAO,kBAAkB,YAAY;YAC9C,iBAAiB;YACjB,IAAI,MAAM,iBAAiB,YACzB,OAAO,OAAmB,MAAM,MAAM,QAAQ,KAAK;iBAEnD,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,IAAI;oBACF,cAA0B,MAAM,MAAM,QAAQ,KAAK;oBACnD;gBACF,EAAE,OAAO,KAAK;oBACZ,OAAO;gBACT;YACF;QAEJ;IACF;AACF;AACA,eAAe,gBAAgB,MAAM;IACnC,OAAO,kBAAkB,OAAO,OAAO;IACvC,IAAI;IACJ,IAAI;QACF,kEAAkE;QAClE,gEAAgE;QAChE,gEAAgE;QAChE,mDAAmD;QACnD,iDAAiD;QACjD,mDAAmD;QACnD,IAAI,CAAC,mBAAmB;YACtB,IAAI,WAAW,OAAO,IAAI,CAAA;gBACxB,IAAI;gBACJ,OAAO,AAAC,CAAA,eAAe,YAAY,MAAK,MAAO,QAAQ,iBAAiB,KAAK,IAAI,KAAK,IAAI,aAAa,MAAM,CAAA;oBAC3G,oCAAoC;oBACpC,oEAAoE;oBACpE,IAAI,UAAU,OAAO,WAAW,OAAO,QAAQ,cAAc,oBAAoB,GAAG;wBAClF,IAAI,OAAO,4BAA4B,eAAe,kBAAkB,0BAA0B;4BAChG,OAAO,QAAQ;4BACf;wBACF;wBACA,MAAM,MAAM,OAAO,QAAQ,OAAO,+BAA+B,mBAAmB,MAAM,MAAM,QAAQ,KAAK;wBAC7G,OAAO,YAAY;oBACrB;oBACA,MAAM;gBACR;YACF;YACA,kBAAkB,MAAM,QAAQ,IAAI;QACtC;QACA,OAAO,QAAQ,SAAU,KAAK;YAC5B,SAAS,OAAO,OAAO,MAAM;QAC/B;IACF,SAAU;QACR,OAAO,OAAO;QACd,IAAI,iBACF,gBAAgB,QAAQ,CAAA;YACtB,IAAI,QAAQ;gBACV,IAAI;gBACH,CAAA,kBAAkB,SAAS,IAAG,MAAO,QAAQ,oBAAoB,KAAK,KAAa,gBAAgB,YAAY;YAClH;QACF;IAEJ;AACF;AACA,SAAS,SAAS,OAAO,kBAAkB,GAAnB,EAAuB,MAAM,cAAc,GAAf;IAClD,IAAI,UAAU,OAAO;IACrB,IAAI,CAAC,SACH;IAEF,IAAI,MAAM,SAAS,OACjB;SACK,IAAI,MAAM,SAAS,MAAM;QAC9B,IAAI,OAAO,MAAM,YAAY,CAAC,OAAO,cAAc;QACnD,IAAI,MAAM;YACR,IAAI,OAAO,CAAC,MAAM,GAAG,EAAE;gBACrB,iEAAiE;gBACjE,oHAAoH;gBACpH,IAAI,UAAU,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;gBAClC,IAAK,IAAI,OAAO,QACd,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,CAAC,IAAI,EAAE;oBAC5C,IAAI,KAAK,OAAO,CAAC,IAAI;oBACrB,IAAI,UAAU,WAAW,OAAO,OAAO,MAAM;oBAC7C,IAAI,QAAQ,WAAW,GACrB,UAAU,OAAO,OAAO,MAAM;gBAElC;YAEJ;YACA,IAAI,mBAGF,AAFA,4DAA4D;YAC5D,+CAA+C;YAC9C,CAAA,GAAG,IAAG,EAAG,MAAM;YAGlB,aAAa;YACb,IAAI,KAAK,OAAO,eAAe,CAAC,MAAM,GAAG;YACzC,OAAO,CAAC,MAAM,GAAG,GAAG;gBAAC;gBAAI;aAAK;QAChC,OAAO,IAAI,OAAO,QAChB,SAAS,OAAO,QAAQ;IAE5B;AACF;AACA,SAAS,UAAU,MAAM,EAAE,EAAE;IAC3B,IAAI,UAAU,OAAO;IACrB,IAAI,CAAC,SACH;IAEF,IAAI,OAAO,CAAC,GAAG,EAAE;QACf,8EAA8E;QAC9E,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,EAAE;QACzB,IAAI,UAAU,EAAE;QAChB,IAAK,IAAI,OAAO,KAAM;YACpB,IAAI,UAAU,WAAW,OAAO,OAAO,MAAM,IAAI,CAAC,IAAI;YACtD,IAAI,QAAQ,WAAW,GACrB,QAAQ,KAAK,IAAI,CAAC,IAAI;QAE1B;QAEA,sGAAsG;QACtG,OAAO,OAAO,CAAC,GAAG;QAClB,OAAO,OAAO,KAAK,CAAC,GAAG;QAEvB,0BAA0B;QAC1B,QAAQ,QAAQ,CAAA;YACd,UAAU,OAAO,OAAO,MAAM;QAChC;IACF,OAAO,IAAI,OAAO,QAChB,UAAU,OAAO,QAAQ;AAE7B;AACA,SAAS,eAAe,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ,EAAgB,aAAa,uCAAuC,GAAxC;IACjF,IAAI,kBAAkB,QAAQ,IAAI,eAChC,OAAO;IAGT,uGAAuG;IACvG,IAAI,UAAU,WAAW,OAAO,OAAO,MAAM;IAC7C,IAAI,WAAW;IACf,MAAO,QAAQ,SAAS,EAAG;QACzB,IAAI,IAAI,QAAQ;QAChB,IAAI,IAAI,kBAAkB,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE;QACtC,IAAI,GACF,+EAA+E;QAC/E,WAAW;aACN;YACL,yDAAyD;YACzD,IAAI,IAAI,WAAW,OAAO,OAAO,MAAM,CAAC,CAAC,EAAE;YAC3C,IAAI,EAAE,WAAW,GAAG;gBAClB,kFAAkF;gBAClF,WAAW;gBACX;YACF;YACA,QAAQ,QAAQ;QAClB;IACF;IACA,OAAO;AACT;AACA,SAAS,kBAAkB,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ,EAAgB,aAAa,uCAAuC,GAAxC;IACpF,IAAI,UAAU,OAAO;IACrB,IAAI,CAAC,SACH;IAEF,IAAI,gBAAgB,CAAC,YAAY,CAAC,OAAO,cAAc,EAAE;QACvD,2EAA2E;QAC3E,yEAAyE;QACzE,IAAI,CAAC,OAAO,QACV,OAAO;QAET,OAAO,eAAe,OAAO,QAAQ,IAAI;IAC3C;IACA,IAAI,aAAa,CAAC,GAAG,EACnB,OAAO;IAET,aAAa,CAAC,GAAG,GAAG;IACpB,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;IAC7B,gBAAgB,KAAK;QAAC;QAAQ;KAAG;IACjC,IAAI,CAAC,UAAU,OAAO,OAAO,OAAO,IAAI,iBAAiB,QAAQ;QAC/D,eAAe,KAAK;YAAC;YAAQ;SAAG;QAChC,OAAO;IACT;AACF;AACA,SAAS,WAAW,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ;IACjD,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;IAC7B,OAAO,OAAO,CAAC,GAAG,GAAG,CAAC;IACtB,IAAI,UAAU,OAAO,KACnB,OAAO,IAAI,OAAO,OAAO,OAAO,CAAC,GAAG;IAEtC,IAAI,UAAU,OAAO,OAAO,OAAO,IAAI,kBAAkB,QACvD,OAAO,IAAI,kBAAkB,QAAQ,SAAU,EAAE;QAC/C,GAAG,OAAO,OAAO,CAAC,GAAG;IACvB;IAEF,OAAO,OAAO,KAAK,CAAC,GAAG;AACzB;AACA,SAAS,UAAU,OAAO,kBAAkB,GAAnB,EAAuB,GAAG,WAAW,GAAZ;IAChD,sBAAsB;IACtB,OAAO;IAEP,6DAA6D;IAC7D,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;IAC7B,IAAI,UAAU,OAAO,OAAO,OAAO,IAAI,iBAAiB,QACtD,OAAO,IAAI,iBAAiB,QAAQ,SAAU,EAAE;QAC9C,IAAI,qBAAqB,GAAG;YAC1B,OAAO,WAAW,OAAO,OAAO,MAAM;QACxC;QACA,IAAI,sBAAsB,eAAe,QAAQ;YAC/C,mBAAmB,QAAQ,SAAU,CAAC;gBACpC,WAAW,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE;YACvB;YAEA,+BAA+B;YAC/B,eAAe,KAAK,MAAM,gBAAgB;QAC5C;IACF;AAEJ;;;AC3eA;;CAEC,GAED;AACA;AACA;AACA;AAGA;AACA;AAEA,SAAS,UAAW,CAAQ;IACxB,MAAM,KAAK,SAAS,cAAc;IAClC,GAAG,MAAM,YAAY;IACrB,GAAG,MAAM,aAAa;IACtB,GAAG,MAAM,UAAU;IACnB,GAAG,YAAY;IACf,MAAM,WAAW,SAAS,cAAc;IACxC,SAAS,cAAc,YAAa,CAAA,EAAE,UAAU,EAAE,UAAW,KAAK,CAAC;IACnE,GAAG,OAAO;IACV,SAAS,KAAK,OAAO;IACrB,QAAQ,MAAM;AAClB;AAEC,CAAA;IACG,IAAI;IACJ,IAAI,cAAc;IAElB,IAAI;QACA,OAAO,iBAAiB,oBAAoB;YACxC,cAAc;QAClB;QACA,MAAM,CAAA,GAAA,kBAAO;IACjB,EAAE,OAAO,GAAG;QACR,UAAU;QACV;IACJ;IAEA,SAAS,gBAAiB,OAA0B,EAAE,YAA0B;QAC5E,IAAI,OACA,MAAM;QAEV,4CAA4C;QAC5C,MAAM,kBAAkB,SAAS,eAAe;QAChD,iBAAiB;QAEjB,MAAM,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,aACxB,CAAA,GAAA,oBAAQ,GACR,MACA,MACA,IAAM,MAAM,aACZ;YACI,OAAO,QAAQ,MAAM,cAAc;QACvC,GACA,MACA;QAEJ,QAAQ,IAAI,CAAA,GAAA,YAAI,EACZ,SACA;YACI;YACA;QACJ;QAEJ,aAAa;QACb,IAAI,SACA,WAAW;YACP,MAAM,IAAI,CAAA,GAAA,cAAG,EAAE;QACnB,GAAG;QAGP,SAAS,KAAK,OAAO,MAAM;IAC/B;IAEA,eAAe;QACX,IAAI;YACA,OAAO,oBAAoB,oBAAoB;YAC/C,MAAM,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE;YAC5B,IAAI,UAA6B;YACjC,IAAI;gBACA,MAAM,aAAa,MAAM,aAAa;gBACtC,IAAI,YACA,UAAU,WAAW;YAE7B,EAAE,OAAM,GAAG;gBACP,IAAI;gBACJ,IAAI,AAAC,EAAY,QAAQ,QAAQ,gBAAgB,GAC7C,UAAU;qBACP,IAAI,AAAC,EAAY,QAAQ,QAAQ,oBAAoB,GACxD,UAAU;qBAEV,UAAU;gBAEd,IAAI,SACA,WAAW;oBACP,SAAS,MAAM,IAAI;oBACnB,MAAM,IAAI,MAAM,oCAAoC;gBACxD,GAAG;YAEX;YACA,gBAAgB,SAAS;QAC7B,EAAE,OAAO,GAAG;YACR,UAAU;QACd;IAEJ;IACA,IAAI,aACA;SAEA,OAAO,iBAAiB,oBAAoB;AAEpD,CAAA;;;ACjHA;AAEA;;;;;;;;CAQC,GAED,6CAA6C;AAC7C,IAAI,CAAE,CAAA,cAAc,QAAQ,SAAQ,GAChC,OAAO,eAAe,QAAQ,WAAW,YAAY;IACjD,OAAO,SAAU,CAAS,EAAE,CAAS;QACjC,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,YAAY;IACrB;AACJ;AAGJ,6CAA6C;AAC7C,IAAI,CAAE,CAAA,cAAc,QAAQ,SAAQ,GAChC,OAAO,eAAe,QAAQ,WAAW,YAAY;IACjD,OAAO,SAAU,CAAS,EAAE,CAAS;QACjC,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,aAAa;IACtB;AACJ;AAGJ,4CAA4C;AAC5C,IAAI,CAAC,MAAM,UAAU,MACjB,OAAO,eAAe,MAAM,WAAW,QAAQ;IAC3C,cAAc;IACd,OAAO,SAAS,KAAM,GAAG,IAAW;QAChC,MAAM,QAAQ,MAAM,IAAI,CAAC,EAAE,IAAI,IAAI,OAAO,IAAI,CAAC,EAAE;QAEjD,OAAO,QAAQ,MAAM,UAAU,OAAO,KAAK,IAAI,EAAE,SAAU,GAAQ,EAAE,GAAG;YACpE,IAAI,MAAM,QAAQ,MACd,yCAAyC;YACzC,IAAI,KAAK,MAAM,KAAK,KAAK,KAAK,KAAK,QAAQ;iBAE3C,IAAI,KAAK;YAGb,OAAO;QACX,GAAG,EAAE,IAAI,MAAM,UAAU,MAAM,KAAK,IAAI;IAC5C;IACA,UAAU;AACd;AAGJ,qCAAqC;AACrC,2CAA2C;AAC3C,IAAI,CAAC,OAAO,UAAU,YAClB,OAAO,eAAe,OAAO,WAAW,cAAc;IAClD,OAAO,SAAU,WAA4B,EAAE,YAAoB;QAC/D,IAAI,OAAO,iBAAiB,YACxB,MAAM,IAAI,MAAM;QAEpB,OAAO,IAAI,CAAC,QAAQ,IAAI,OAAO,aAAa,MAAM;IACtD;AACJ;AAGJ;;;;;;;;;;;;;;;;;;;;AAoBA,GACA,IAAI,CAAC,OAAO,aACR,OAAO,eAAe,QAAQ,eAAe;IACzC,OAAO,OAAY;QACf,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,OAAO,SAAS,EACrC,MAAM,IAAI,MAAM;QAEpB,MAAM,IAAS,CAAC;QAChB,OAAO,KAAK,SAAS,QAAQ,CAAC;YAC1B,MAAM,CAAC,GAAG,EAAE,GAAG,OAAO,CAAC,IAAI;YAC3B,CAAC,CAAC,EAAE,GAAG;QACX;QACA,OAAO;IACX;AACJ;AAGJ,gDAAgD;AAChD,IAAI,CAAE,CAAA,kBAAkB,MAAK,GACzB,IAAI;IACC,OAAe,eAAe;QAC3B,SAAS,IAAM;QACf,SAAS,KAAO;QAChB,YAAY,KAAO;IACvB;AACJ,EAAE,OAAO,GAAG;AACR,kBAAkB;AACtB;;;AClHJ;;;;;;;CAOC,GAED;AACA,6EAA+C,qCAAqC;AACpF;AACA;;;ACZA,CAAC;IAAW,SAAS;QAAI,IAAI,IAAE,MAAM,UAAU,MAAM,KAAK,YAAW,IAAE,SAAS;QAAyB,EAAE,QAAQ,SAAS,CAAC;YAAE,IAAI,IAAE,aAAa;YAAK,EAAE,YAAY,IAAE,IAAE,SAAS,eAAe,OAAO;QAAI,IAAG,IAAI,CAAC,YAAY;IAAE;IAAC;QAAC,QAAQ;QAAU,SAAS;QAAU,iBAAiB;KAAU,CAAC,QAAQ,SAAS,CAAC;QAAE,EAAE,eAAe,aAAW,OAAO,eAAe,GAAE,UAAS;YAAC,cAAa,CAAC;YAAE,YAAW,CAAC;YAAE,UAAS,CAAC;YAAE,OAAM;QAAC;IAAE;AAAE;;;ACA5a,CAAC;IAAW,SAAS;QAAI,IAAI,IAAE,MAAM,UAAU,MAAM,KAAK,YAAW,IAAE,SAAS;QAAyB,EAAE,QAAQ,SAAS,CAAC;YAAE,IAAI,IAAE,aAAa;YAAK,EAAE,YAAY,IAAE,IAAE,SAAS,eAAe,OAAO;QAAI,IAAG,IAAI,CAAC,aAAa,GAAE,IAAI,CAAC;IAAW;IAAC;QAAC,QAAQ;QAAU,SAAS;QAAU,iBAAiB;KAAU,CAAC,QAAQ,SAAS,CAAC;QAAE,EAAE,eAAe,cAAY,OAAO,eAAe,GAAE,WAAU;YAAC,cAAa,CAAC;YAAE,YAAW,CAAC;YAAE,UAAS,CAAC;YAAE,OAAM;QAAC;IAAE;AAAE;;;ACA/b,OAAO,UAAU,YAAW,CAAA,OAAO,UAAU,WAAS,SAAS,CAAC,EAAC,CAAC;IAAE,OAAO,MAAI,GAAE,IAAE,OAAO,KAAG,MAAK,IAAI,CAAC,SAAO,IAAE,OAAO,IAAI,IAAG,CAAA,AAAC,CAAA,KAAG,IAAI,CAAC,MAAK,IAAG,EAAE,UAAS,CAAA,KAAG,EAAE,OAAO,IAAE,EAAE,OAAM,GAAG,EAAE,MAAM,GAAE,KAAG,OAAO,IAAI,CAAA;AAAE,CAAA;;;ACA7M,MAAM,UAAU,aAAW,OAAO,eAAe,MAAM,WAAU,aAAY;IAAC,OAAM,SAAS,CAAC;QAAE,IAAG,QAAM,IAAI,EAAC,MAAM,IAAI,UAAU;QAAiC,IAAI,IAAE,OAAO,IAAI,GAAE,IAAE,EAAE,WAAS;QAAE,IAAG,cAAY,OAAO,GAAE,MAAM,IAAI,UAAU;QAAgC,IAAI,IAAI,IAAE,SAAS,CAAC,EAAE,EAAC,IAAE,GAAE,IAAE,GAAG;YAAC,IAAI,IAAE,CAAC,CAAC,EAAE;YAAC,IAAG,EAAE,KAAK,GAAE,GAAE,GAAE,IAAG,OAAO;YAAE;QAAG;QAAC,OAAM;IAAE;AAAC;;;;;wCC6EzV;AA7Eb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKO,MAAM,KAAK;aAGd,AADA,kBAAkB;IAClB,CAAA,GAAA,gBAAM;eACN,CAAA,GAAA,oBAAQ;yBACR,CAAA,GAAA,wCAAkB;cAGlB,AADA,iBAAiB;IACjB,CAAA,GAAA,kBAAO;iBACP,CAAA,GAAA,wBAAU;yBAGV,AADA,oBAAoB;IACpB,CAAA,GAAA,wCAAkB;uBAClB,CAAA,GAAA,oCAAgB;qBAChB,CAAA,GAAA,8BAAc;qBAGd,AADA,kBAAkB;IAClB,CAAA,GAAA,wBAAc;eACd,CAAA,GAAA,kBAAQ;qBAGR,AADA,kBAAkB;IAClB,CAAA,GAAA,gCAAc;gBAGd,AADA,2BAA2B;IAC3B,CAAA,GAAA,sBAAS;mBACT,CAAA,GAAA,wBAAY;eACZ,CAAA,GAAA,oBAAQ;eACR,CAAA,GAAA,oBAAQ;kBACR,CAAA,GAAA,0BAAW;kBACX,CAAA,GAAA,0BAAW;SAGX,AADA,kBAAkB;IAClB;eACA,CAAA,GAAA,oBAAQ;eACR;kBACA,CAAA,GAAA,0BAAW;eACX,CAAA,GAAA,oBAAQ;oBACR,CAAA,GAAA,8BAAa;6BAGb,AADA,0BAA0B;IAC1B,CAAA,GAAA,sCAAsB;cACtB,CAAA,GAAA,kBAAO;WACP,CAAA,GAAA,YAAI;YACJ,CAAA,GAAA,cAAK;iBACL,CAAA,GAAA,wBAAU;oBACV,CAAA,GAAA,8BAAa;eACb,CAAA,GAAA,oBAAQ;6BACR,CAAA,GAAA,gDAAsB;cACtB,CAAA,GAAA,kBAAO;oBACP,CAAA,GAAA,oCAAa;mBACb,CAAA,GAAA,4BAAY;wBACZ,CAAA,GAAA,sCAAiB;iBACjB,CAAA,GAAA,wBAAU;kBACV,CAAA,GAAA,0BAAW;aACX,CAAA,GAAA,gBAAM;eACN,CAAA,GAAA,oBAAQ;mBACR,CAAA,GAAA,4BAAY;cACZ,CAAA,GAAA,kBAAO;mBACP,CAAA,GAAA,4BAAY;yBACZ,CAAA,GAAA,wCAAkB;aAClB,CAAA,GAAA,gBAAM;kBACN,CAAA,GAAA,0BAAW;oBACX,CAAA,GAAA,8BAAa;sBACb,CAAA,GAAA,kCAAe;qBACf,CAAA,GAAA,gCAAc;kBACd,CAAA,GAAA,0BAAW;sBACX,CAAA,GAAA,kCAAe;4BACf,CAAA,GAAA,8CAAqB;YACrB,CAAA,GAAA,cAAK;wBACL,CAAA,GAAA,sCAAiB;sBACjB,CAAA,GAAA,kCAAe;kBACf,CAAA,GAAA,0BAAW;uBACX,CAAA,GAAA,oCAAgB;mBAGhB,AADA,sBAAsB;IACtB,CAAA,GAAA,yBAAY;IACZ,OAAO,CAAA,GAAA,oBAAQ;IACf,OAAO,CAAA,GAAA,0BAAW;qBAClB,CAAA,GAAA,gCAAc;6BACd,CAAA,GAAA,gDAAsB;oBACtB,CAAA,GAAA,8BAAa;oBACb,CAAA,GAAA,8BAAa;2BACb,CAAA,GAAA,4CAAoB;IACpB,iBAAiB,CAAA,GAAA,gCAAc;iBAC/B,CAAA,GAAA,wBAAU;YAGV,AADA,yBAAyB;IACzB,CAAA,GAAA,cAAK;YACL,CAAA,GAAA,cAAK;gBACL,CAAA,GAAA,sBAAS;YACT,CAAA,GAAA,cAAK;aACL,CAAA,GAAA,gBAAM;aACN,CAAA,GAAA,gBAAM;eACN,CAAA,GAAA,oBAAQ;iBACR,CAAA,GAAA,wBAAU;kBACV,CAAA,GAAA,0BAAW;eAEX,CAAA,GAAA,oBAAQ;oBACR,CAAA,GAAA,yBAAa;AACjB;AAEA,OAAO,KAAK,KAAK,mDAAmD;;;AChLpE,+DAA+D;;;AAsE/D,oDAAa;AAeb,+CAAa;+CAsKA;AA1Pb;AAoDA,IAAI,kBAA2B;AAiBxB,MAAM;IACT,QAAe,CAAC;IAChB,cAAqB,CAAC;IACtB,OAAc,CAAC;IACf,OAAyB;QAAE,OAAO,EAAE;IAAE;IACtC,OAAqC;QAAE,OAAO;IAAW;IACzD,SAAoC;QAAE,OAAO,EAAE;IAAE;IACjD,UAAoB;QAAE,OAAO;IAAO;IACpC,UAAoB;QAAE,OAAO;IAAO;IACpC,WAAoB;QAAE,OAAO;IAAG;IAChC,kBAA2B;QAAE,OAAO;IAAG;AAC3C;AAEA,MAAM,gBAAgB;AAEf,MAAM;IAUD,UAAW,CAA2B,EAAQ;QAClD,WAAW;YACP,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC;YAEtB,IAAI,CAAC;QACT,GAAG;IACP;IAEA,mBAAmB;IAEnB,aAAe;aAfE,MAAc,GAAI,wBAAwB;;QAgBvD,IAAI,iBACA,MAAM,IAAI,MAAM;QAEpB,kBAAkB;QAClB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,UAAU,EAAE;QACjB,IAAI,CAAC,YAAY,EAAE;QACnB,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,eAAe;IACxB;IAEA;;;;;KAKC,GACD,MAAO,CAAU,EAAQ;QACrB,IAAI,GACA,IAAI,CAAC;aAEL,IAAI,CAAC,aAAa,KAAK,IAAI,GAAG,IAAI,CAAC,aAAa;IAExD;IAEA,YAAa,CAAmB,EAAQ;QACpC,IAAI,CAAC,UAAU,KAAK;IACxB;IAEA,KAAM,QAAuB,EAAQ;QACjC,IAAI,IAAI,CAAC,aAAa,GAClB;QAEJ,MAAO,IAAI,CAAC,eAAe,IAAI,CAAC,QAAQ,SAAS,EAC7C,IAAI,CAAC,QAAQ;QAGjB,6DAA6D;QAC7D,MAAM,YAAY,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,SAAS,EAAE;QACvD,UAAU;QACV,IACI,aAAa,SAAS,IAAI,CAAC,EAAE,KAAK,YAAY,UAAU,IAAI,CAAC,EAAE,KAAK,YACpE,SAAS,WAAW,kBAAkB,UAAU,WAAW,kBAC3D,UAAU,MAAO,CAAC,EAAE,KAAK,SAAS,MAAO,CAAC,EAAE,EAC9C;YACE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,SAAS,EAAE,GAAG;YACxC,IAAI,CAAC,SAAS,oDAAoD;YAClE;QACJ;QACA,mBAAmB;QACnB,IACI,aAAa,SAAS,IAAI,CAAC,EAAE,KAAK,YAAY,UAAU,IAAI,CAAC,EAAE,KAAK,YACpE,SAAS,WAAW,uBAAuB,UAAU,WAAW,uBAChE,UAAU,MAAO,CAAC,EAAE,KAAK,SAAS,MAAO,CAAC,EAAE,IAC5C,UAAU,MAAO,CAAC,EAAE,IAAI,SAAS,MAAO,CAAC,EAAE,EAC7C;YACE,sFAAsF;YACtF,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC;YACL,IAAI,CAAC,SAAS,oDAAoD;YAClE,IAAI,CAAC,UAAU;YACf;QACJ;QACA,eAAe;QACf,IAAI,SAAS,WAAW,gBAAgB,aAAa,UAAU,WAAW,cAAc;YACpF,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,SAAS,EAAE,GAAG;YACxC,IAAI,CAAC;YACL;QACJ;QAEA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,OAAO,GAAG;QACpC,IAAI,CAAC,eAAe,IAAI,CAAC,QAAQ,SAAS;QAC1C,MAAM,YAAY,IAAI,CAAC;QACvB,IAAI,CAAC,WAAW,KAAK,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,eAAe,IAAI,CAAC;QACjE,IAAI,YAAY,IAAI,CAAC,UAAU;YAC3B,MAAM,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS;YACxC,IAAI,CAAC,MACD,MAAM,IAAI,MAAM;YAEpB,IAAI,CAAC,UAAU;gBAAC,cAAc;YAAI;QACtC,OACI,IAAI,CAAC,UAAU;QAEnB,IAAI,iBAAiB,IAAI,CAAC,YAAY,GAClC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,GAAG,MAAM,2DAA2D;IAEvG;IAEA;;;;KAIC,GACD,OAAyB;QACrB,MAAM,SAA0B,EAAE;QAClC,IAAI,CAAC,IAAI,CAAC,WACN,OAAO;QAEX,IAAK,IAAI,IAAI,IAAI,CAAC,WAAW,GAAG,IAAI,IAAI,CAAC,cAAc,IACnD,OAAO,KAAK,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE;QAE3C,IAAI,CAAC;QACL,IAAI,CAAC,UAAU;QACf,OAAO;IACX;IAEA;;KAEC,GACD,OAAqC;QACjC,IAAI,CAAC,IAAI,CAAC,WACN,OAAO;QAEX,IAAI,CAAC;QACL,IAAI,CAAC,UAAU;QACf,OAAO,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa;IACtD;IAEA,SAAoC;QAChC,OAAO;eAAI,IAAI,CAAC;SAAQ;IAC5B;IAEA,UAAoB;QAChB,OAAO,IAAI,CAAC,eAAe,IAAI,CAAC,QAAQ,SAAS;IACrD;IAEA,UAAoB;QAChB,OAAO,IAAI,CAAC,eAAe,IAAI,CAAC;IACpC;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA;;KAEC,GACD,kBAA2B;QACvB,OAAQ,IAAI,CAAC,eAAe;IAChC;AAEJ;AAEO,MAAM,YAAY,IAAI;;;;;AC3P7B,iDAAgB;AAMhB,+CAAgB;AAmBhB,oDAAgB;AAShB,yCAAgB;AAahB,mDAAgB;AAShB;;CAEC,GACD,4CAAgB;AAMhB;;CAEC,GACD,6CAAgB;AAiBhB;;;;;;CAMC,GACD,kDAAgB;AAOhB,6CAAgB;AAUhB,yCAAgB;AAIhB,4CAAgB;AAKhB,mDAAgB;AAOhB;;;;CAIC,GACD,oDAAgB;AAchB,uDAAgB;AAQhB,6CAAgB;AAIhB;;;;;;;;;;;;CAYC,GACD,iDAAgB;AA0BhB;;;;;;CAMC,GACD,iDAAgB;AAahB,+CAAgB;AAchB,iDAAgB;AAQhB,sDAAgB;AAOhB,qDAAgB;AAMhB,4CAAgB;AAIhB,uDAAgB;AAIhB,0DAAgB;AAlQT,SAAS,YAAa,aAAsB,EAAE,OAAgB;IACjE,IAAI,cAAc,YACd,cAAc,WAAW,aAAa,SAAS,cAAc;AAErE;AAEO,SAAS,UAAW,EAAoB,EAAE,QAAoB;IACjE,IAAI,UAAU;IAEd,SAAS;QACL,IAAI,YAAY,MAAM;YAClB,MAAM;YACN;QACJ;QACA,IAAI,GAAG,UAAU;YACb;YACA;QACJ,OACI,WAAW,OAAO;IAE1B;IAEA;AACJ;AAEO,SAAS,eAAgB,GAAW;IACvC,OAAO,IAAI,QAAQ,CAAC,SAAS;QACzB,MAAM,MAAM,IAAI;QAChB,IAAI,SAAS,IAAM,QAAQ;QAC3B,IAAI,UAAU;QACd,IAAI,MAAM;IACd;AACJ;AAEO,SAAS,IAAK,EAA4B,EAAE,QAA4B;IAC3E,MAAM,SAAS,OAAO,KAAK;IAC3B,IAAI;IACJ,MAAM,QAAS,GAAG;IAClB,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAAK;QACpC,SAAS,MAAM,CAAC,EAAE;QAClB,KAAK,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO;QAChC,IAAI,WAAW,cACX,MAAM,mBAAmB,QAAQ,CAAC,OAAO,EAAE,SAAS;IAE5D;AACJ;AAEO,SAAS,cAAe,EAAW,EAAE,OAAmB;IAC3D,MAAM,SAAS,OAAO,KAAK;IAC3B,IAAI;IACJ,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAAK;QACpC,SAAS,MAAM,CAAC,EAAE;QAClB,GAAG,aAAa,QAAQ,OAAO,CAAC,OAAO;IAC3C;AACJ;AAKO,SAAS,OAAQ,MAAmB,EAAE,GAAyC;IAClF,MAAM,WAAW,SAAS;IAC1B,IAAI,QAAQ,CAAA,OAAQ,QAAQ,SAAS,OAAO;IAC5C,OAAO,OAAO;AAClB;AAKO,SAAS,QAAS,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,GAAY;IACjF,IAAI,QAAQ,KAAK,IAAI,SAAS,KAAK;IACnC,IAAI,QAAQ,IAAI;QACZ,SAAS,KAAK,QAAQ;QACtB,QAAQ;IACZ;IACA,IAAI,SAAS,IAAI;QACb,QAAQ,KAAK,SAAS;QACtB,SAAS;IACb;IACA,IAAI,KAAK;QACL,QAAQ,KAAK,IAAI,KAAK;QACtB,SAAS,KAAK,IAAI,KAAK;IAC3B;IACA,OAAO;QAAC;QAAO;IAAM;AACzB;AASO,SAAS,aAAc,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IACxE,OAAO;QACH,GAAG,KAAK,IAAI,KAAK;QACjB,GAAG,KAAK,IAAI,KAAK;IACrB;AACJ;AAEO,SAAS;IACZ,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,KAAK;IAClB,MAAM,QAAQ,AAAC,CAAA,KAAK,aAAa,CAAA,EAAG,WAAW,SAAS,GAAG;IAC3D,MAAM,MAAM,KAAK,UAAU,WAAW,SAAS,GAAG;IAClD,MAAM,UAAU,AAAC,CAAA,KAAK,aAAa,KAAK,KAAK,YAAW,EAAG,SAAS,IAAI,SAAS,GAAG;IAEpF,OAAO,OAAO,MAAM,QAAQ,MAAM,MAAM,MAAM,UAAU;AAC5D;AAEO,SAAS,IAAK,CAAS,EAAE,CAAS;IACrC,OAAO,IAAI,IAAI,GAAG,IAAI,KAAK;AAC/B;AAEO,SAAS,OAAQ,SAAiB,EAAE,WAAmB;IAC1D,MAAM,IAAI,IAAI,WAAW;IACzB,OAAO;QAAC,YAAY;QAAG,cAAc;KAAE;AAC3C;AAEO,SAAS,cAAe,aAAqB;IAChD,MAAM,MAAM,cAAc,WAAW,SAAS;IAC9C,MAAM,cAAc,KAAK,IAAI,IAAI;IACjC,MAAM,YAAY,gBAAgB;IAClC,OAAO,OAAO,WAAW;AAC7B;AAOO,SAAS,eAAgB,OAAa;IACzC,IAAI,CAAC,SACD,MAAM,IAAI,MAAM;IAEpB,IAAI,OAAO,QAAQ,mBAAmB,MAClC,OAAO,IAAI,gBAAgB,UAAU,aAAa;SAC/C,IAAI,QAAQ,YAAY,SAAS,UAAU;QAC9C,MAAM,WAAY;QAClB,OAAO,UAAU,SAAS,OAAO,MAAM,SAAS,WAAW,MAAM,SAAS,MAAM,WAAW;IAC/F,OACI,MAAM,IAAI,MAAM;AAExB;AAEO,SAAS,kBAAmB,KAAoB,EAAE,KAAoB;IACzE,QAAQ,IAAI,KAAK;IACjB,QAAQ,IAAI,KAAK;IACjB,MAAM,SAAS,GAAG,GAAG,GAAG;IACxB,MAAM,SAAS,GAAG,GAAG,GAAG;IACxB,OAAO,AAAC,CAAA,MAAM,YAAY,MAAM,SAAQ,IAAM;AAClD;AAEO,SAAS,QAAY,GAAM;IAC9B,OAAO,KAAK,MAAM,KAAK,UAAU;AACrC;AAeO,SAAS,YAAa,CAAoF;IAC7G,MAAM,WAAW;IACjB,MAAM,MAAM,IAAY,MAAM;IAC9B,EAAE,OAAO,OAAO,SAAU,IAAI;QAC1B,IAAI,CAAC,MAAM;YACP;YACA,EAAE;YACF;QACJ;QACA,IAAI;YACA,MAAM,aAAa;gBAAC,IAAI,KAAK;oBAAC;iBAAK,EAAE,EAAE,UAAU;oBAAC,MAAM;gBAAQ;aAAG;YACnE,UAAU,MAAM;gBACZ,OAAO,EAAE;gBACT,OAAO;YACX,GACK,KAAK,KAAO,GACZ,MAAM;gBACH;YACR;QACJ,EAAE,OAAM,GAAG;YACP;QACJ;QACA,EAAE;IACN,GAAG;AACP;AASO,SAAS,YAAa,UAAiB;IAC1C,MAAM,SAA6B,WAAW;IAC9C,IAAI,CAAC,QACD,OAAO;IAEX,IAAI;QAAC;QAAK;QAAS;QAAS;KAAU,CAAC,SAAS,OAAO,YAAY,AAAC,OAAe,YAC/E,OAAO;IAEX,WAAW;IACX,OAAO;AACX;AAGO,SAAS,UAAW,CAAO;IAC9B,MAAM,SAAS,SAAS,gBAAgB,8BAA8B,EAAE;IACxE,OAAO,QAAQ,GAAG,QAAQ,CAAC,CAAC,QAAQ,KAAK;QACrC,IAAI,WAAW,eACX,AAAC,KAAgB,QAAQ,CAAA;YACrB,OAAO,OAAO,UAAU;QAC5B;aACG,IAAI,WAAW,eAClB,OAAO,aAAa,QAAQ;IAEpC;IACA,OAAO;AACX;AAEO,SAAS,YAAgB,CAAW;IACvC,sDAAsD;IACtD,IAAI,MAAM,MACN,MAAM,IAAI,MAAM;IAEpB,OAAO;AACX;AAEO,SAAS,iBAAqB,CAAgB,EAAE,UAAU,oBAAoB;IACjF,IAAI,MAAM,WACN,MAAM,IAAI,MAAM;IAEpB,OAAO;AACX;AAEO,SAAS,gBAAoB,CAAW;IAC3C,OAAO,MAAM,OAAO,YAAY;AACpC;AAEA,MAAM,iBAAiB,AAAC,gBAAgB,SAAU,OAAO,WAAW,kCAAkC;AAE/F,SAAS;IACZ,OAAO,kBAAkB,eAAe;AAC5C;AAEO,SAAS,kBAAmB,IAAgB;IAC/C,kBAAkB,sBAAsB,kBAAkB,eAAe,iBAAiB,UAAU;AACxG;AAEO,SAAS,qBAAsB,IAAgB;IAClD,kBAAkB,yBAAyB,kBAAkB,eAAe,oBAAoB,UAAU;AAC9G;;;ACtQA,QAAQ,iBAAiB,SAAU,CAAC;IAClC,OAAO,KAAK,EAAE,aAAa,IAAI;QAAC,SAAS;IAAC;AAC5C;AAEA,QAAQ,oBAAoB,SAAU,CAAC;IACrC,OAAO,eAAe,GAAG,cAAc;QAAC,OAAO;IAAI;AACrD;AAEA,QAAQ,YAAY,SAAU,MAAM,EAAE,IAAI;IACxC,OAAO,KAAK,QAAQ,QAAQ,SAAU,GAAG;QACvC,IAAI,QAAQ,aAAa,QAAQ,gBAAgB,KAAK,eAAe,MACnE;QAGF,OAAO,eAAe,MAAM,KAAK;YAC/B,YAAY;YACZ,KAAK;gBACH,OAAO,MAAM,CAAC,IAAI;YACpB;QACF;IACF;IAEA,OAAO;AACT;AAEA,QAAQ,SAAS,SAAU,IAAI,EAAE,QAAQ,EAAE,GAAG;IAC5C,OAAO,eAAe,MAAM,UAAU;QACpC,YAAY;QACZ,KAAK;IACP;AACF;;;;;ACtBA,+CAAgB;AAPhB;AACA;AACA;AACA;AACA;;AACA;;AAEO,SAAS,UACZ,CAaC;IAID,CAAA,GAAA,yBAAY,EAAE;IACd,IAAI,WAAW;IACf,IAAI,mBAAmB,CAAC,CAAC,EAAE;IAE3B,wHAAwH;IACxH,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;QACrB,QAAQ,SAAS;QACjB,KAAK;YACD,UAAU;YACV,MAAM;YACN,KAAK;YACL,OAAO;YACP,QAAQ;YACR,UAAU;QACd;IACJ;IACA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;QACjB,QAAQ;QACR,WAAW;IACf;IAEA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;QACxB,QAAQ;QACR,KAAK;YACD,OAAO;YACP,WAAW;YACX,qBAAqB;YACrB,UAAU;YACV,SAAS;YACT,eAAe;YACf,gBAAgB;YAChB,YAAY;QAChB;IACJ;IAEA,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;QACf,QAAQ;QACR,SAAS;YACL,IAAI,kBACA;YAEJ,MAAM;QACV;QACA,KAAK;YACD,UAAU;YACV,MAAM;YACN,KAAK;YACL,QAAQ;YACR,OAAO;YACP,QAAQ;QACZ;IACJ;IAEA,MAAM,cAAc;IACpB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;QAClB,SAAS;QACT,WAAW;QACX,SAAS,CAAC,UAAU,EAAE,CAAA,GAAA,cAAG,EAAE,eAAe,mBAAmB,EAAE,CAAA,GAAA,yBAAQ,EAAE,EAAE,CAAC;QAC5E,OAAO,CAAA,GAAA,cAAG,EAAE;QACZ,SAAS;YACL,MAAM;QACV;QACA,KAAK;YACD,OAAO,cAAc;YACrB,QAAQ,cAAc;YACtB,YAAY,cAAc;YAC1B,UAAU;YACV,OAAO;YACP,KAAK;YACL,YAAY;YACZ,WAAW;QACf;IACJ;IAEA,IAAI,OAAgC;IACpC,IAAI,EAAE,MAEF,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;QACT,WAAW;YACP,OAAO;YACP,IAAI;YACJ,SAAS;YACT,QAAQ;QACZ,CAAC,CAAC,EAAE,KAAK;IACb;IAGJ,MAAM,aAAa;QAAC;KAAe;IACnC,WAAW,KAAK;IAChB,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;QAChB,SAAS;YACL;YACA;YACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS,EAAE;gBACX,KAAK;oBACD,aAAa;oBACb,cAAc,EAAE,MAAM,SAAS;gBACnC;YACJ;YACA,EAAE;SACL;QACD,WAAW,WAAW,KAAK;QAC3B,KAAK,EAAE,QAAQ,EAAE,QAAQ;IAC7B;IAEA,cAAc,OACV,CAAA,GAAA,MAAC,EAAE,GAAG;QACF,KAAK;YACD,MAAM;QACV;IACJ,IACA,OACA,CAAA,GAAA,MAAC,EAAE,GAAG;QACF,KAAK;YACD,MAAM;QACV;IACJ;IAGJ,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;QACnC,QAAQ,SAAU,MAAM,EAAE,CAAC,EAAE,QAAQ;YACjC,IAAI,UACA;YAEJ,IAAI,mBAAmB,aAAa,WAAW,CAAC,CAAA,GAAA,MAAC,EAAE,kBAAkB;gBACjE,EAAE;gBACF,WAAW;oBACP,mBAAmB,gBAAgB;gBACvC,GAAG;YACP;YACA,IAAI,aAAa,OAAO;gBACpB,EAAE;gBACF,MAAM;YACV;QACJ;IACJ;IACA,sCAAsC;IACtC,MAAM,eAAe,CAAC;QAClB,IAAI,YAAY,UAAU,SACtB,MAAM;IAEd;IACA,OAAO,iBAAiB,SAAS;IACjC,OAAO,UAAU,CAAA,GAAA,MAAC,EAAE;IAEpB,IAAI;IACJ,IAAI,EAAE,WACF,YAAY,EAAE;SACX,IAAI,EAAE,cAAc,OACvB,YAAY;SAEZ,YAAY;IAGhB,MAAM,cAAc,EAAE,WAAW,EAAE,QAAQ,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;QAC1D,QAAQ;QACR,KAAK;YACD,SAAS;YACT,UAAU;YACV,gBAAgB;YAChB,WAAW;YACX,YAAY;QAChB;IACJ,KAAK;IACL,IAAI;IACJ,MAAM,WAAgC,EAAE;IACxC,IAAI,EAAE,SACF,EAAE,QAAQ,QAAQ,CAAA;QACd,MAAM,aAAa;YAAC;SAAgB;QACpC,IAAI,eAAe,QAAS,EAAE,aAAa,EAAE,UAAU,SAAS,aAC5D,WAAW,KAAK;QAEpB,IAAI;QACJ,IAAI,QAAQ;QACZ,IAAI,eAAe,MAAM;YACrB,QAAQ,CAAA,GAAA,cAAG,EAAE;YACb,UAAU,CAAA,GAAA,wBAAO;QACrB;QACA,IAAI,eAAe,UAAU;YACzB,QAAQ,CAAA,GAAA,cAAG,EAAE;YACb,UAAU,CAAA,GAAA,yBAAQ;YAClB,WAAW,KAAK;QACpB;QACA,IAAI,UAAmC;QACvC,IAAI,SACA,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACZ,SAAS;YACT,QAAQ;gBACJ,KAAK;gBACL,QAAQ;YACZ;QACJ;QAEJ,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,GAAG;YACd,QAAQ;YACR,SAAS;YACT,WAAW,WAAW,KAAK;YAC3B,SAAS;gBACL;gBACA,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,WAAW;oBACX,SAAS;gBACb;aACH;YACD,SAAS;gBACL,MAAM;YACV;QACJ;QACA,SAAS,KAAK;QACd,IAAI,cAAc,YAAY;YAC1B,WAAW;gBACP,IAAI;gBACJ,OAAO,SAAS,GAAG;YACvB,GAAG;YACH,WAAW;gBACP,kCAAkC;gBAClC,OAAO,SAAS,GAAG;YACvB,GAAG;QACP;QACA,IAAI,eAAe,EAAE,cACjB,kBAAkB;IAE1B;IAGJ,SAAS,MAAO,KAAa;QACzB,IAAI,UACA;QAGJ,WAAW;QACX,CAAA,GAAA,MAAC,EAAE;QACH,CAAA,GAAA,MAAC,EAAE;QACH,WAAW;QACX,CAAA,GAAA,yBAAY,EAAE;QACd,CAAA,GAAA,MAAC,EAAE,UAAU;QACb,CAAA,GAAA,MAAC,EAAE,UAAU;QACb,YAAY;QACZ,OAAO,oBAAoB,SAAS;QACpC,sDAAsD;QACtD,OAAO,UAAU;QACjB,SAAS,QAAQ,CAAA,OAAQ,CAAA,GAAA,MAAC,EAAE,UAAU;QACtC,SAAS,OAAO,GAAG,SAAS;QAE5B,IAAI,EAAE,UACF,EAAE,SAAS;IAEnB;IAEA,IAAI,EAAE,WACF,EAAE,UAAU;QACR,MAAM;IACV;IAGJ,OAAO;QACH,qBAAqB,CAAC;YAClB,mBAAmB;QACvB;IACJ;AACJ;;;AC9RA,eAAe;AAEf;;CAEC;;AAED,mDAAa;mDAkCA;AAlCN,MAAM;IAID,OAAc;QAClB,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB,KAAK,IAAI,CAAC;QACd;IACJ;IAEA,SAAU,CAAU,EAAQ;QACxB,IAAI,MAAM,WACN,IAAI,CAAC,SAAS;aAEd,IAAI,CAAC;QAET,IAAI,CAAC;IACT;IACA,SAAU,CAAU,EAAQ;QACxB,IAAI,MAAM,WACN,IAAI,CAAC,SAAS;aAEd,IAAI,CAAC;QAET,IAAI,CAAC;IACT;IACA,MAAe;QACX,OAAO,IAAI,CAAC;IAChB;IACA,UAAW,QAA6B,EAAQ;QAC5C,IAAI,CAAC,UAAU,KAAK;IACxB;;aA9BQ,YAAqC,EAAE;aACvC,QAAQ;;AA8BpB;AAEO,MAAM,gBAAgB,IAAI;;;;;wCCyCpB;AAlFb;AAoBA;AAMA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AASA;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEO,MAAM,KAAK;+BAGd,AADA,oBAAoB;IACpB,CAAA,GAAA,kCAAwB;sBACxB,CAAA,GAAA,yBAAe;0BACf,CAAA,GAAA,6BAAmB;mBACnB,CAAA,GAAA,sBAAY;uBACZ,CAAA,GAAA,0BAAgB;iBAGhB,AADA,iBAAiB;IACjB,CAAA,GAAA,iBAAU;eACV,CAAA,GAAA,eAAQ;SACR,CAAA,GAAA,SAAE;mBACF,CAAA,GAAA,mBAAY;YACZ,CAAA,GAAA,YAAK;aACL,CAAA,GAAA,aAAM;kBACN,CAAA,GAAA,kBAAW;aACX,CAAA,GAAA,aAAM;SACN,CAAA,GAAA,SAAE;YACF,CAAA,GAAA,YAAK;mBACL,CAAA,GAAA,mBAAY;oBACZ,CAAA,GAAA,oBAAa;uBACb,CAAA,GAAA,uBAAgB;aAChB,CAAA,GAAA,aAAM;iBACN,CAAA,GAAA,iBAAU;iBACV,CAAA,GAAA,iBAAU;eACV,CAAA,GAAA,eAAQ;WACR,CAAA,GAAA,YAAI;kBACJ,CAAA,GAAA,0BAAW;iBACX,CAAA,GAAA,iBAAU;qBACV,CAAA,GAAA,qBAAc;YACd,CAAA,GAAA,YAAK;SAGL,AADA,iBAAiB;IACjB,CAAA,GAAA,SAAE;UACF,CAAA,GAAA,UAAG;iBACH,CAAA,GAAA,iBAAU;gBACV,CAAA,GAAA,gBAAS;sBACT,CAAA,GAAA,sBAAe;sBACf,CAAA,GAAA,sBAAe;kBACf,CAAA,GAAA,kBAAW;WACX,CAAA,GAAA,WAAI;YACJ,CAAA,GAAA,YAAK;kBACL,CAAA,GAAA,kBAAW;YACX,CAAA,GAAA,cAAK;UACL,CAAA,GAAA,UAAG;YACH,CAAA,GAAA,YAAK;eACL,CAAA,GAAA,eAAQ;iBACR,CAAA,GAAA,iBAAU;WACV,CAAA,GAAA,WAAI;kBACJ,CAAA,GAAA,kBAAW;kBACX,CAAA,GAAA,kBAAW;wBAGX,AADA,iBAAiB;IACjB,CAAA,GAAA,wBAAiB;eACjB,CAAA,GAAA,eAAQ;gBACR,CAAA,GAAA,gBAAS;wBACT,CAAA,GAAA,wBAAiB;0BACjB,CAAA,GAAA,0BAAmB;IAEnB,mBAAmB;IACnB,QAAQ,CAAA,GAAA,0BAAW;SACnB,CAAA,GAAA,WAAE;gBACF,CAAA,GAAA,kBAAS;wBACT,CAAA,GAAA,0BAAiB;oCACjB,CAAA,GAAA,sCAA6B;kCAC7B,CAAA,GAAA,oCAA2B;yBAC3B,CAAA,GAAA,2BAAkB;0BAClB,CAAA,GAAA,4BAAmB;kBACnB,CAAA,GAAA,oBAAW;iCACX,CAAA,GAAA,mCAA0B;gBAC1B,CAAA,GAAA,kBAAS;kBACT,CAAA,GAAA,oBAAW;SAGX,AADA,kBAAkB;IAClB,CAAA,GAAA,UAAE;SACF,CAAA,GAAA,UAAE;UACF,CAAA,GAAA,WAAG;oBACH,CAAA,GAAA,qBAAa;6BACb,CAAA,GAAA,8BAAsB;mBAGtB,AADA,eAAe;IACf,CAAA,GAAA,iBAAY;oBACZ,CAAA,GAAA,kBAAa;qBACb,CAAA,GAAA,mBAAc;QACd,CAAA,GAAA,MAAC;eACD,CAAA,GAAA,aAAQ;oBACR,CAAA,GAAA,kBAAa;qBACb,CAAA,GAAA,mBAAc;iBAKd,AAFA,2BAA2B;IAE3B,CAAA,GAAA,wBAAU;qBACV,CAAA,GAAA,gCAAc;cACd,CAAA,GAAA,qBAAO;gBAEP,CAAA,GAAA,sBAAS;kBACT,CAAA,GAAA,0BAAW;mBACX,CAAA,GAAA,4BAAY;iBACZ,CAAA,GAAA,wBAAU;uBACV,CAAA,GAAA,oCAAgB;uBAChB,CAAA,GAAA,oCAAgB;AACpB;AAEA,OAAO,KAAK,KAAK,mDAAmD;;;;;+CC1LvD;+DAEA;sDAOA;0DAEA;mDA+BA;AAKb,uDAAgB;AA/CT,MAAM,YAAY,UAAU,UAAU,cAAc,QAAQ,aAAa;AAEzE,MAAM,4BAA4B,AAAC;IACtC,MAAM,4BAAqC,IAAI,MAAM,IAAI,YAAY;IACrE,OAAO;QACH,OAAO;IACX;AACJ;AAEO,MAAM,mBAAmB,CAAC,CAAC,OAAO;AAElC,MAAM,uBAAuB,AAAC;IACjC,IAAI;IAEJ,SAAS;QACL,MAAM,MAAM,SAAS,cAAc;QACnC,IAAI,MAAM,WAAW;QACrB,IAAI,MAAM,MAAM;QAChB,IAAI,MAAM,OAAO;QACjB,SAAS,KAAK,OAAO;QACrB,WAAW;YACP,SAAS,IAAI,eAAe;YAC5B,IAAI;QACR,GAAG;IACP;IAEA,IAAI,SAAS,MACT;SAEA,OAAO,iBAAiB,oBAAoB;QACxC;IACJ;IAGJ,OAAO;QACH,IAAI,WAAW,WACX,MAAM,IAAI,MAAM;QAEpB,OAAO;IACX;AACJ;AAEO,MAAM,gBAAgB;IACzB,OAAO,WAAW,aAAa,cAAc;AACjD;AAGO,SAAS,kBAAmB,GAAgB,EAAE,GAAG,QAAyB;IAC7E,SAAS,QAAQ,CAAA;QACb,sDAAsD;QACtD,GAAG,CAAC,QAAQ,GAAG;IACnB;AACJ;;;;;AC2LA;;;;;;;CAOC,GACD,iDAAa;AA8Cb;;CAEC,GACD,8CAAgB;AAlRhB,MAAM,YAAY,AAAC,CAAA;IAEf,iCAAiC;IACjC,0BAA0B;IAC1B,4BAA4B;IAE5B,MAAM,iBAAiB;QACnB,SAAS;YAAC;YAAK;SAAW;QAC1B,OAAO;YAAC;YAAO;SAAW;QAC1B,SAAS;QACT,QAAQ;QACR,OAAO;YAAC;YAAQ;YAAY;SAAY;QACxC,SAAS;QACT,OAAO;QACP,aAAa;QACb,UAAU;QACV,aAAa;QACb,cAAc;QACd,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,KAAK;YAAC;YAAK;SAAI;QACf,QAAQ;QACR,SAAS;QACT,QAAQ;QACR,SAAS;QACT,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,OAAO;IACX;IAEA,yBAAyB;IACzB,MAAM,YAAY,OAAO,KAAK;IAE9B,wBAAwB;IACxB,MAAM,YAAqB,OAAO,QAAQ,gBAAgB,OAAO,CAAC,KAAK,CAAC,IAAI;QACxE,GAAG,CAAC,IAAI,GAAG;QACX,OAAO;IACX,GAAG,CAAC;IAEJ,sBAAsB;IACtB,6BAA6B;IAC7B,MAAM,iBAAiB,OAAO,QAAQ,gBAAgB,OAAO,CAAC,KAAK,CAAC,KAAK,KAAK;QAC1E,IAAI,OAAO,SAAS,UAChB,GAAG,CAAC,KAAK,GAAG;aAEZ,KAAK,QAAQ,CAAA;YACT,GAAG,CAAC,KAAK,GAAG;QAChB;QAEJ,OAAO;IACX,GAAG,CAAC;IAEJ,IAAI,WAAqB,EAAE;IAE3B,0GAA0G;IAC1G,wFAAwF;IACxF,IAAI,gBAEA,CAAC;IACL,MAAM,cAAiC,EAAE;IAGzC,MAAM,WAAuB,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAE;QAC9C,YAAY,QAAQ,CAAA;YAChB,IAAI,CAAC,IAAI,CAAC,EAAE,EACR;YAEJ,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,GAAG;QACrB;IACJ;IAEA,MAAM,SAAmB,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;QACtC,YAAY,QAAQ,CAAA;YAChB,IAAI,CAAC,IAAI,CAAC,EAAE,EACR;YAEJ,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG;QAClB;IACJ;IAEA,MAAM,WAAoB;QACtB,YAAY,QAAQ,CAAA;YAChB,IAAI,CAAC,IAAI,CAAC,EAAE,EACR;YAEJ,IAAI,CAAC,EAAE;QACX;IACJ;IAEA,SAAS,QAAS,CAAgB;QAC9B,MAAM,MAAM,EAAE;QACd,MAAM,OAAO,EAAE;QAEf,IAAI,OAAO,gBAAgB;YACvB,MAAM,SAAS,cAAc,CAAC,IAAI;YAClC,IAAI,SAAS,CAAC,OAAO,EAAE;gBACnB,SAAS,QAAQ,GAAG,SAAS,KAAK,MAAM;gBACxC;YACJ;YACA,SAAS,CAAC,OAAO,GAAG;YACpB,aAAa,CAAC,KAAK,GAAG;YAEtB,cAAc;YACd,SAAS,KAAK;YAEd,SAAS,QAAQ,GAAG,SAAS,KAAK;QACtC;IACJ;IAGA,SAAS,MAAO,CAAgB;QAC5B,MAAM,OAAO,EAAE;QACf,MAAM,cAAc,SAAS,KAAK;QAElC,oFAAoF;QACpF,gHAAgH;QAChH,IAAI;YACA;YAAQ;YAAY;YACpB;YAAU;SACb,CAAC,SAAS,OAAO;YACd;YACA;QACJ;QAEA,MAAM,SAAS,aAAa,CAAC,KAAK;QAClC,IAAI,WAAW,WAAW;YACtB,SAAS,CAAC,OAAO,GAAG;YACpB,aAAa,CAAC,KAAK,GAAG;YAEtB,oBAAoB;YACpB,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,QAAQ,IACjC,IAAI,QAAQ,CAAC,EAAE,IAAI,QAAQ;gBACvB,SAAS,OAAO,GAAG;gBACnB;YACJ;YAGJ,OAAO,QAAQ,GAAG;QACtB;IACJ;IAEA,SAAS;QACL,MAAM,cAAc,SAAS,KAAK;QAClC,WAAW,EAAE;QACb,gBAAgB,CAAC;QAEjB,MAAM,WAAqB,EAAE;QAC7B,UAAU,QAAQ,CAAA;YACd,IAAI,SAAS,CAAC,OAAO,EAAE;gBACnB,SAAS,CAAC,OAAO,GAAG;gBACpB,SAAS,KAAK;YAClB;QACJ;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,QAAQ,IACjC,OACI,QAAQ,CAAC,EAAE,EACX;YACI,gBAAgB,YAAa;YAC7B,iBAAiB,YAAa;QAClC,GACA;QAGR;IACJ;IAIA,OAAO;QACH,KAAK,CAAC;YACF,IAAI,YAAY,SAAS,iBACrB;YAEJ,MAAM,QAAQ,YAAY,WAAW;YACrC,YAAY,KAAK;YAEjB,IAAI,OAAO;gBACP,SAAS,iBAAiB,WAAW;gBACrC,SAAS,iBAAiB,SAAS;gBACnC,OAAO,iBAAiB,QAAQ;YACpC;QACJ;QACA,QAAQ,CAAC;YACL,IAAI,CAAC,YAAY,SAAS,iBACtB;YAEJ,MAAM,OAAO,YAAY,WAAW;YACpC,IAAK,IAAI,IAAI,GAAG,IAAI,YAAY,QAAQ,IACpC,IAAI,WAAW,CAAC,EAAE,KAAK,gBAAgB;gBACnC,YAAY,OAAO,GAAG;gBACtB;YACJ;YAEJ,IAAI,MAAM;gBACN,SAAS,oBAAoB,WAAW;gBACxC,SAAS,oBAAoB,SAAS;gBACtC,OAAO,oBAAoB,QAAQ;YACvC;QACJ;QACA,WAAW,IAAe;QAC1B,UAAU,IAAgB;IAC9B;AACJ,CAAA;AAYO,MAAM;IAOT,YACI,CAIC,CACH;QACE,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,CAAC,OAAO,EAAE;QACd,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,CAAC,MAAM;YAAC,IAAI,CAAC;YAAQ,IAAI,CAAC;YAAM,IAAI,CAAC;SAAO;QAChD,UAAU,IAAI,IAAI,CAAC;IACvB;IAEA,UAAW,MAAc,EAAW;QAChC,IAAI,CAAE,CAAA,UAAU,UAAU,WAAU,GAChC,MAAM,UAAU,SAAS;QAE7B,OAAO,UAAU,WAAW,CAAC,OAAO;IACxC;IAEA,cAAuB;QACnB,OAAO,UAAU,WAAW,KAAK;IACrC;IAEA,kBAAmB,SAAmB,EAAW;QAC7C,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,WAAW,QAAQ,IAAK;YAClD,IAAI,CAAC,UAAU,SAAS,UAAU,UAAU,CAAC,EAAE,GAC3C,OAAO;QAEf;QACA,OAAO;IACX;IAEA,UAAiB;QACb,UAAU,OAAO,IAAI,CAAC;IAC1B;AACJ;AAKO,SAAS,SAAU,SAAiB,EAAE,SAAiB;IAC1D,OAAO,UAAU,MAAM,KAAK,OAAO,KAAK,SAAS,UAAU,MAAM,KAAK,OAAO,KAAK;AACtF;;;;;AC/EA;;;CAGC,GACD,qDAAa;AAhOb;AACA;AAEA;AA8DA,kDAAkD;AAClD,MAAM,aAAyB,EAAE;AAEjC,SAAS,WAAY,KAA6B;IAC9C,MAAM,aAAuB;QACzB,WAAW,MAAM;QACjB,WAAW;QACX,WAAW;IACf;IACA,WAAW,KAAK;IAEhB,IAAI,WAAW,SAAS,IACpB,WAAW;IAGf,OAAO;AACX;AAEA,SAAS,WAAY,KAA6B;IAC9C,IAAK,IAAI,IAAI,WAAW,SAAS,GAAG,KAAK,GAAG,IAAK;QAC7C,IAAI,MAAM,cAAc,UAAU,CAAC,EAAE,CAAC,WAClC,OAAO,UAAU,CAAC,EAAE;IAE5B;IACA,OAAO;AACX;AAEA,SAAS,aAAc,OAAe;IAClC,OAAQ;QACJ,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,OAAO;IACf;AACJ;AAEA,MAAM,qBAAqB,IAAI,CAAA,GAAA,sCAAiB;AAChD,MAAM,kBAAkB,CAAA,GAAA,kCAAwB,MAAM,IAAI,CAAC,YAAY,OAAO;AAG9E,MAAM,iBAAkB,CAAA,GAAA,yBAAe,IAAI,gBAAgB;AAC3D,MAAM,iBAAkB,CAAA,GAAA,yBAAe,IAAI,gBAAgB;AAC3D,MAAM,eAAgB,CAAA,GAAA,yBAAe,IAAI,cAAc;AACvD,MAAM,mBAAoB,CAAA,GAAA,yBAAe,IAAI,kBAAkB;AAC/D,MAAM,kBAAmB,CAAA,GAAA,yBAAe,IAAI,iBAAiB;AAC7D,MAAM,kBAAmB,CAAA,GAAA,yBAAe,IAAI,iBAAiB;AAG7D;;;CAGC,GACD,SAAS,oBAAqB,KAA8C;IACxE,IAAI,eAAe,OACf,OAAO,MAAM;IAGjB,SAAS;QACL,IAAI,MAAM,YAAY,WAClB,OAAO,MAAM;QAEjB;;;;;;;;SAQC,GACD,IAAI,MAAM,WAAW,WACjB,OAAO;YAAC;YAAE;YAAE;YAAE;YAAE;SAAG,CAAC,MAAM,OAAO;QAErC,OAAO;IACX;IAEA,MAAM,eAAuC;QACzC,WAAW,MAAM;QACjB,aAAa,MAAM;QACnB,OAAO,MAAM;QACb,OAAO,MAAM;QACb,SAAS,MAAM;QACf,SAAS,MAAM;QACf,WAAW,MAAM;QACjB,WAAW,MAAM;QACjB,WAAW,MAAM,YAAY;QAC7B,UAAU,mBAAmB,UAAU,MAAM;QAC7C,SAAS;QACT,QAAQ,MAAM;QACd,cAAc,EAAE;QAChB,qBAAqB,IAAM,MAAM;QACjC,sBAAsB,IAAM,MAAM;IACtC;IACC,MAAmC,YAAY;IAEhD,IAAI,iBAAiB;IACrB,IAAI,eAAe,OACf;QAAA,IAAI,cAAc,SAAS,MAAM,YAAY,KAAM,CAAA;YAAC;SAAQ,CAAC,SAAS,MAAM,gBAAiB,MAAM,gBAAgB,WAAW,MAAM,aAAa,CAAC,GAAI;YAClJ,aAAa,WAAW;YACxB,iBAAiB;QACrB;IAAA,OACG;QACH,aAAa,YAAY;QACzB,aAAa,cAAc;QAC3B,aAAa,WAAW,AAAC,MAAuB,YAAY,IAAI,IAAI;QACpE,iBAAiB,aAAa;IAClC;IAEA,IAAI,CAAA,GAAA,kBAAQ,KAAK,MAAM,eAAe,WAAW,MAAM,SAAS,iBAAiB,MAAM,YAAY,GAC/F,aAAa,UAAU,GAAG,4CAA4C;IAG1E,IAAI,oBAAoC,EAAE;IAC1C,IAAI,wBAAwB,OACxB,oBAAoB,MAAM;IAG9B,uEAAuE;IACvE,iBAAiB;IAEjB,MAAM,aAAuB,WAAW,iBAAiB,WAAW;IAEpE,MAAM,aAAa,WAAW;IAC9B,MAAM,aAAa,WAAW;IAE9B,IAAK,IAAI,IAAI,GAAG,IAAI,kBAAkB,QAAQ,IAAK;QAC/C,MAAM,YAAY,iBAAiB,CAAC,EAAE;QAEtC,aAAa,aAAa,KAAK;YAC3B,OAAO,UAAU;YACjB,OAAO,UAAU;YACjB,SAAS,UAAU;YACnB,SAAS,UAAU;YACnB,WAAW,WAAW,cAAc,OAAO,IAAI,UAAU,QAAQ,WAAW;YAC5E,WAAW,WAAW,cAAc,OAAO,IAAI,UAAU,QAAQ,WAAW;YAC5E,WAAW,UAAU,cAAc,IAAI,aAAa,YAAa,UAAU,YAAY;YACvF,UAAU,mBAAmB,OAAO,mBAAmB,UAAU,UAAU,YAAY;QAC3F;QAEA,WAAW,YAAY,UAAU;QACjC,WAAW,YAAY,UAAU;IACrC;IAEA,WAAW,YAAY,aAAa;IACpC,WAAW,YAAY,aAAa;IACpC,aAAa,YAAY,eAAe,OAAO,IAAI,WAAW,YAAY;IAC1E,aAAa,YAAY,eAAe,OAAO,IAAI,WAAW,YAAY;IAE1E,OAAO;AACX;AAMO,MAAM;IAuCD,WAAY,SAAiB,EAAmB;QACpD,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,QAAQ,IAAK;YAC7C,IAAI,cAAc,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,WACjC,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE;QAEjC;QACA,OAAO;IACX;IAEQ,cAAe,SAAiB,EAAmB;QACvD,IAAI,iBAAkC;QACtC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,iBAAiB,QAAQ,IAC9C,IAAI,IAAI,CAAC,gBAAgB,CAAC,EAAE,KAAK,WAAW;YACxC,iBAAiB,IAAI,CAAC,UAAU,CAAC,EAAE;YACnC,IAAI,CAAC,WAAW,OAAO,GAAG;YAC1B,IAAI,CAAC,iBAAiB,OAAO,GAAG;YAChC;QACJ;QAEJ,OAAO;IACX;IAEA;;KAEC,GACD,AAAQ,sBACJ,OAA0B,EAC1B,cAAsC,EACtC,MAA+B,EAClB;QAEb,MAAM,SAAkB,IAAI,CAAC,cAAc;QAC3C,MAAM,SAAwB;YAC1B,MAAM;YACN,WAAW,eAAe;YAC1B,aAAa,eAAe;YAC5B,OAAO,eAAe;YACtB,OAAO,eAAe;YACtB,SAAS,eAAe;YACxB,SAAS,eAAe;YACxB,MAAM,eAAe,UAAU,OAAO,OAAO,IAAI,CAAC,cAAc;YAChE,MAAM,eAAe,UAAU,OAAO,MAAM,IAAI,CAAC,cAAc;YAC/D,IAAI,eAAe;YACnB,IAAI,eAAe;YACnB,MAAM,eAAe;YACrB,qBAAqB,eAAe;YACpC,sBAAsB,eAAe;YACrC,GAAG,MAAM;QACb;QAEA,IAAI,YAAY,eAAe;YAC3B,OAAO,eAAe,EAAE;YACxB,IAAI,eAAe,aAAa,SAAS,GAAG;gBACxC,IAAI;gBACJ,IAAK,IAAI,IAAI,GAAG,IAAI,eAAe,aAAa,QAAQ,IAAK;oBACzD,gBAAgB,eAAe,YAAY,CAAC,EAAE;oBAC9C,OAAO,aAAa,KAAK;wBACrB,OAAO,cAAc;wBACrB,OAAO,cAAc;wBACrB,SAAS,cAAc;wBACvB,SAAS,cAAc;wBACvB,MAAM,cAAc,UAAU,OAAO,OAAO,IAAI,CAAC,cAAc;wBAC/D,MAAM,cAAc,UAAU,OAAO,MAAM,IAAI,CAAC,cAAc;wBAC9D,IAAI,cAAc;wBAClB,IAAI,cAAc;wBAClB,MAAM,cAAc;oBACxB;gBACJ;YACJ;QACJ;QAEA,OAAO;IACX;IAEQ,yBAA0B;QAC9B,IAAI,CAAC,uBAAuB,SAAS,iBAAiB,gBAAgB,IAAI,CAAC;QAC3E,IAAI,CAAC,qBAAqB,SAAS,iBAAiB,cAAc,IAAI,CAAC;QACvE,IAAI,CAAC,wBAAwB,SAAS,iBAAiB,kBAAkB,IAAI,CAAC;QAC9E,IAAI,CAAC,wBAAwB,SAAS,iBAAiB,iBAAiB,IAAI,CAAC;IACjF;IAEQ,2BAA4B;QAChC,IAAI,CAAC,uBAAuB,SAAS,oBAAoB,gBAAgB,IAAI,CAAC;QAC9E,IAAI,CAAC,qBAAqB,SAAS,oBAAoB,cAAc,IAAI,CAAC;QAC1E,IAAI,CAAC,wBAAwB,SAAS,oBAAoB,kBAAkB,IAAI,CAAC;QACjF,IAAI,CAAC,wBAAwB,SAAS,oBAAoB,iBAAiB,IAAI,CAAC;IACpF;IAGA,mBAAmB;IAEnB,YAAa,CAAyB,CAAE;aAhIhC,cAAuB;aAUvB,gBAAwB;QAEhC,sCAAsC;aAC9B,aAAyB,EAAE;aAC3B,mBAA6B,EAAE;QAEvC,iCAAiC;aACzB,kBAAuC;aACvC,UAAmB;QA+GvB,IAAI,CAAC,gBAAgB,EAAE;QACvB,IAAI,CAAC,oBAAoB,EAAE;QAC3B,IAAI,CAAC,kBAAkB,EAAE;QACzB,IAAI,CAAC,uBAAuB,EAAE;QAC9B,IAAI,CAAC,cAAc,KAAK,IAAI,GAAG,EAAE,eAAe;QAGhD,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE,CAAC;YAClC,IAAI,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,iBAC1B;YAEJ,MAAM,SAAS,IAAI,CAAC,cAAc;YAClC,MAAM,WAAW;gBACb,GAAG,YAAY;gBACf,MAAM,aAAa,UAAU,OAAO,OAAO,IAAI,CAAC,cAAc;gBAC9D,MAAM,aAAa,UAAU,OAAO,MAAM,IAAI,CAAC,cAAc;YACjE;YACA,IAAI,CAAC,gBAAgB;QACzB;QAEA,IAAI,IAAI,CAAC,mBAAmB;YACxB,IAAI,CAAC,gBAAgB,CAAC;gBAClB,MAAM,iBAAiB,oBAAoB;gBAE3C,MAAM,sBAAsB,IAAI,CAAC;gBACjC,IAAI,CAAC,kBAAkB,eAAe;gBAEtC,IACI,IAAI,CAAC,iBAAiB,SAAS,eAAe,cAC9C,IAAI,CAAC,iBAAiB,WAAW,IAAI,CAAC,eACtC,eAAe,gBAAgB,SACjC;oBACE,IAAI,CAAC,UAAU;oBACf;gBACJ;gBAEA,8GAA8G;gBAC9G,IAAI,CAAC,IAAI,CAAC,WAAW,eAAe,gBAAgB,WAAW,wBAAwB,OAAO;oBAC1F,IAAI,CAAC,UAAU;oBACf;gBACJ;gBACA,IAAI,CAAC,UAAU;gBAEf,MAAM,WAAW,IAAI,CAAC,sBAAsB,eAAe;gBAC3D,IAAI,CAAC,qBAAqB,IAAI,CAAC,kBAAkB;YACrD;YAEA,IAAI,CAAC,gBAAgB,CAAC,OAAqB;gBAEvC,kFAAkF;gBAClF,MAAM,iBAAiB,oBAAoB;gBAC3C,8DAA8D;gBAC9D,IAAI,IAAI,CAAC,iBAAiB,SAAS,eAAe,cAAc,IAAI,CAAC,iBAAiB,WAAW,IAAI,CAAC,eAAe,CAAC;oBAAC;oBAAG;oBAAG;iBAAE,CAAC,SAAS,eAAe,UACpJ,qCAAqC;gBACrC;gBAGJ,yBAAyB;gBACzB,IAAI,IAAI,CAAC,WAAW,WAAW,KAAK,CAAC,cACjC,IAAI,CAAC;gBAET,MAAM,UAAoB;oBACtB,WAAW,eAAe;oBAC1B,aAAa,eAAe;oBAC5B,WAAW,eAAe;oBAC1B,WAAW,eAAe;oBAC1B,SAAS,eAAe;oBACxB,WAAW,eAAe;oBAC1B,WAAW,eAAe;oBAC1B,eAAe,eAAe;gBAClC;gBACA,IAAI,CAAC,WAAW,KAAK;gBACrB,IAAI,CAAC,iBAAiB,KAAK,eAAe;gBAE1C,MAAM,WAA0B,IAAI,CAAC,sBAAsB,eAAe,gBAAgB;oBACtF,WAAW,eAAe;oBAC1B,WAAW,eAAe;oBAC1B,QAAQ,aAAa,eAAe;oBACpC,UAAU,eAAe;gBAC7B;gBAEA,IAAI,CAAC,qBAAqB,IAAI,CAAC,kBAAkB;YACrD;YAEA,IAAI,CAAC,sBAAsB,CAAC;gBACxB,gDAAgD;gBAChD,MAAM,iBAAiB,oBAAoB;gBAC3C,oEAAoE;gBACpE,IAAI,CAAE,IAAI,CAAC,iBAAiB,SAAS,eAAe,YAChD;gBAGJ,MAAM,UAAU,IAAI,CAAC,WAAW,eAAe;gBAE/C,IAAI,CAAC,SACD,4BAA4B;gBAC5B;gBAGJ,+DAA+D;gBAC/D,IAAI,eAAe,YAAY,QAAQ,SAAS;oBAC5C,YAAY;oBAEZ,iBAAiB;oBACjB,IAAI,IAAI,CAAC,WAAW,WAAW,GAC3B,IAAI,CAAC;oBAET,IAAI,CAAC,cAAc,eAAe;oBAElC,MAAM,WAAW,IAAI,CAAC,sBAAsB,aAAa,gBAAgB;wBACrE,WAAW,QAAQ;wBACnB,WAAW,QAAQ;oBACvB;oBACA,IAAI,CAAC,qBAAqB,IAAI,CAAC,kBAAkB;oBACjD;gBACJ;gBAEA,wBAAwB;gBACxB,IACI,eAAe,gBAAgB,SAC/B,eAAe,UAAU,QAAQ,aACjC,eAAe,UAAU,QAAQ,aACjC,eAAe,cAAc,QAAQ,eAErC,QAAQ;gBACR;gBAGJ,MAAM,WAAW,IAAI,CAAC,sBAAsB,eAAe,gBAAgB;oBACvE,WAAW,QAAQ;oBACnB,WAAW,QAAQ;oBACnB,QAAQ,aAAa,eAAe;oBACpC,UAAU,eAAe;gBAC7B;gBAEA,QAAQ,YAAY,eAAe;gBACnC,QAAQ,YAAY,eAAe;gBACnC,QAAQ,gBAAgB,eAAe;gBAEvC,IAAI,CAAC,qBAAqB,IAAI,CAAC,kBAAkB;YACrD;YAEA,IAAI,CAAC,oBAAoB,CAAC;gBACtB,8CAA8C;gBAC9C,MAAM,iBAAiB,oBAAoB;gBAC3C,kEAAkE;gBAClE,IAAI,CAAE,IAAI,CAAC,iBAAiB,SAAS,eAAe,YAChD;gBAGJ,iBAAiB;gBACjB,IAAI,IAAI,CAAC,WAAW,WAAW,GAC3B,IAAI,CAAC;gBAET,MAAM,UAAU,IAAI,CAAC,cAAc,eAAe;gBAClD,IAAI,CAAC,SACD,4BAA4B;gBAC5B;gBAGJ,MAAM,WAAW,IAAI,CAAC,sBAAsB,aAAa,gBAAgB;oBACrE,WAAW,QAAQ;oBACnB,WAAW,QAAQ;gBACvB;gBACA,IAAI,CAAC,qBAAqB,IAAI,CAAC,kBAAkB;YAErD;YAEA,IAAI,CAAC,uBAAuB,CAAC;gBACzB,iDAAiD;gBACjD,MAAM,iBAAiB,oBAAoB;gBAC3C,8EAA8E;gBAC9E,IAAI,CAAE,IAAI,CAAC,iBAAiB,SAAS,eAAe,YAChD;gBAGJ,iBAAiB;gBACjB,IAAI,IAAI,CAAC,WAAW,WAAW,GAC3B,IAAI,CAAC;gBAET,MAAM,UAAU,IAAI,CAAC,cAAc,eAAe;gBAClD,IAAI,CAAC,SACD,4BAA4B;gBAC5B;gBAGJ,MAAM,WAAW,IAAI,CAAC,sBAAsB,aAAa,gBAAgB;oBACrE,WAAW,QAAQ;oBACnB,WAAW,QAAQ;gBACvB;gBACA,IAAI,CAAC,qBAAqB,IAAI,CAAC,kBAAkB;YACrD;YAEA,IAAI,CAAC,cAAc,iBAAiB,gBAAgB,IAAI,CAAC;YACzD,IAAI,CAAC,cAAc,iBAAiB,gBAAgB,IAAI,CAAC;YAEzD,IAAI,CAAC,CAAA,GAAA,yBAAe,GAAG;gBACnB,MAAM,qBAAqB,CAAC,OAAc,YAAwB;oBAC9D,OAAO;wBACH,WAAW,MAAM;wBACjB,aAAa;wBACb,OAAO,MAAM;wBACb,OAAO,MAAM;wBACb,SAAS,MAAM;wBACf,SAAS,MAAM;wBACf,QAAQ,SAAS,IAAI;wBACrB,SAAS,SAAS,IAAI;wBACtB,WAAW,WAAW;wBACtB,QAAQ,WAAW;wBACnB,UAAU,SAAS,IAAI;wBACvB,gBAAgB,IAAM,WAAW;wBACjC,iBAAiB,IAAM,WAAW;oBACtC;gBACJ;gBAEA,MAAM,cAAc,CAAC,GAAe;oBAChC,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,eAAe,QAAQ,IAAK;wBAC9C,MAAM,QAAQ,EAAE,cAAc,CAAC,EAAE;wBACjC,MAAM,cAAc,mBAAmB,OAAO,GAAG;4BAAC;4BAAS;yBAAO,CAAC,SAAS;wBAC5E,IAAI,SAAS,SACT,IAAI,CAAC,cAAe,aAA6B;6BAC9C,IAAI,SAAS,QAChB,IAAI,CAAC,oBAAqB;6BACvB,IAAI,SAAS,OAChB,IAAI,CAAC,kBAAmB;6BAExB,IAAI,CAAC,qBAAsB;oBAEnC;gBACJ;gBAEA,IAAI,CAAC,eAAe,CAAC;oBACjB,EAAE;oBACF,YAAY,GAAG;gBACnB;gBACA,IAAI,CAAC,cAAc,CAAC;oBAChB,YAAY,GAAG;gBACnB;gBACA,IAAI,CAAC,aAAa,CAAC;oBACf,YAAY,GAAG;gBACnB;gBACA,IAAI,CAAC,gBAAgB,CAAC;oBAClB,YAAY,GAAG;gBACnB;gBAEA,IAAI,CAAC,cAAc,iBAAiB,cAAc,IAAI,CAAC;gBACvD,IAAI,CAAC,cAAc,iBAAiB,aAAa,IAAI,CAAC;gBACtD,IAAI,CAAC,cAAc,iBAAiB,YAAY,IAAI,CAAC;gBACrD,IAAI,CAAC,cAAc,iBAAiB,eAAe,IAAI,CAAC;YAC5D;QACJ;QACA,IAAI,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,UAAU,CAAC;gBACZ,IAAI,CAAC,aAAa,QAAQ;YAC9B;YACA,IAAI,CAAC,cAAc,iBAAiB,SAAS,IAAI,CAAC;QACtD;QACA,IAAI,IAAI,CAAC,sBAAsB;YAC3B,IAAI,CAAC,iBAAiB;gBAClB,IAAI,CAAC;gBACL,IAAI,CAAC,wBAAwB,IAAI,CAAC,qBAAqB;YAC3D;YAEA,IAAI,CAAC,iBAAiB;gBAClB,IAAI,CAAC;gBACL,IAAI,CAAC,wBAAwB,IAAI,CAAC,qBAAqB;YAC3D;YAEA,IAAI,CAAC,cAAc,iBAAiB,iBAAiB,IAAI,CAAC;YAC1D,IAAI,CAAC,cAAc,iBAAiB,iBAAiB,IAAI,CAAC;QAC9D;QAEA,IAAI,EAAE,aAAa;YACf,2EAA2E;YAC3E,IAAI,CAAC,yBAAyB,CAAC,IAAkB,EAAE;YACnD,IAAI,CAAC,cAAc,iBAAiB,aAAa,IAAI,CAAC;QAC1D;IACJ;IAEA,UAAiB;QACb,IAAI,IAAI,CAAC,aACL;QAEJ,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,kBAAkB,IAAI,CAAC,cAAc,oBAAoB,iBAAiB,IAAI,CAAC;QACpF,IAAI,CAAC,kBAAkB,IAAI,CAAC,cAAc,oBAAoB,iBAAiB,IAAI,CAAC;QACpF,IAAI,CAAC,iBAAiB,IAAI,CAAC,cAAc,oBAAoB,gBAAgB,IAAI,CAAC;QAClF,IAAI,CAAC,iBAAiB,IAAI,CAAC,cAAc,oBAAoB,gBAAgB,IAAI,CAAC;QAClF,IAAI,CAAC,WAAW,IAAI,CAAC,cAAc,oBAAoB,SAAS,IAAI,CAAC;QACrE,IAAI,CAAC;QACL,IAAI,CAAC,0BAA0B,SAAS,oBAAoB,aAAa,IAAI,CAAC;QAE9E,IAAI,CAAC,gBAAgB,IAAI,CAAC,cAAc,oBAAoB,cAAc,IAAI,CAAC;QAC/E,IAAI,CAAC,eAAe,IAAI,CAAC,cAAc,oBAAoB,aAAa,IAAI,CAAC;QAC7E,IAAI,CAAC,cAAc,IAAI,CAAC,cAAc,oBAAoB,YAAY,IAAI,CAAC;QAC3E,IAAI,CAAC,iBAAiB,IAAI,CAAC,cAAc,oBAAoB,eAAe,IAAI,CAAC;IACrF;AAEJ;;;;;ACnoBA;;;;;;;;;;;;CAYC,GACD,kDAAa;AAfb,MAAM,sBAAsB;AAerB,MAAM;IAeD,KAAM,KAAa,EAAQ;QAC/B,IAAI,IAAI,CAAC,aAAa,QAAQ,IAAI,CAAC,iBAAiB,MAChD;QAEJ,IAAI,CAAC,SAAS;YACV,QAAQ,KAAK,MAAM,QAAQ,IAAI,CAAC;YAChC,OAAO,IAAI,CAAC,SAAS;YACrB,OAAO,IAAI,CAAC,SAAS;YACrB,SAAS,IAAI,CAAC,SAAS;YACvB,SAAS,IAAI,CAAC,SAAS;QAC3B;IACJ;IAEQ,cAAqB;QACzB,IAAI,IAAI,CAAC,gBAAgB,MAAM;YAC3B,IAAI,CAAC,KAAK,IAAI,CAAC;YACf,IAAI,CAAC,cAAc;QACvB;QACA,IAAI,IAAI,CAAC,iBAAiB,QAAQ,CAAE,IAAI,CAAC,aAAa,SAAS,IAAI,CAAC,eAChE,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC;QAEhC,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,eAAe;IACxB;IAGA,mBAAmB;IAEnB,YAAqB,SAA2C;wBAA3C;aAzCJ,eAAyB;YAAC;SAAI;aACvC,iBAAyB;aACzB,eAA8B;aAE9B,cAA6B;aAC7B,WAKJ;IA+B6D;IAEjE,QAAS,KAAiB,EAAQ;QAC9B,IAAI,CAAC,WAAW;YACZ,OAAO,MAAM;YACb,OAAO,MAAM;YACb,SAAS,MAAM;YACf,SAAS,MAAM;QACnB;QAEA,IAAI,IAAI,CAAC,oBACL,aAAa,IAAI,CAAC;QAEtB,IAAI,CAAC,qBAAqB,WAAW,IAAM,IAAI,CAAC,eAAe;QAE/D,YAAY;QACZ,IAAI,QAAQ,MAAM;QAClB,IAAI,eAAe,SAAS,MAAM,cAAc,GAC5C,SAAS,MAAM;QAEnB,MAAM,WAAW,KAAK,IAAI;QAE1B,iBAAiB;QACjB,IAAI,IAAI,CAAC,mBAAmB,GAAG;YAC3B,IAAI,CAAC;YACL,IAAI,WAAW,IACX,6DAA6D;YAC7D;YAGJ,IAAI,CAAC,eAAe;YACpB,IAAI,IAAI,CAAC,aAAa,SAAS,IAAI,CAAC,eAChC,qCAAqC;YACrC,IAAI,CAAC,KAAK;iBAEV,8FAA8F;YAC9F,IAAI,CAAC,cAAc;YAEvB;QACJ;QAEA,IAAI,IAAI,CAAC,iBAAiB,MAAM;YAC5B,sCAAsC;YACtC,IAAI,CAAC,cAAc;YACnB;QACJ;QAEA,oBAAoB;QACpB,IAAI,aAAa,GACb,oBAAoB;QACpB;QAEJ,IACI,aAAa,IAAI,CAAC,gBAClB,AAAC,WAAW,IAAI,CAAC,eAAgB,IAAI,OAAM,aAAa;;aAGrD,IAAI,AAAC,IAAI,CAAC,eAAe,WAAY,IAAI,QAC5C,0CAA0C;QAC1C,IAAI,CAAC,eAAe;aAEjB,IAAI,aAAa,IAAI,CAAC,cAAc;YACvC,oFAAoF;YACpF,IAAI,CAAC,eAAe;YACpB,IAAI,CAAC,cAAc;YACnB;QACJ;QAGA,IAAI,IAAI,CAAC,gBAAgB,MAAM;YAC3B,IAAI,CAAC,KAAK,IAAI,CAAC;YACf,IAAI,CAAC,cAAc;QACvB;QACA,IAAI,CAAC,KAAK;IACd;AAEJ;;;;;AC5IA;;;;;CAKC,GACD,wDAAa;AARb;AAQO,MAAM;IAOT,mBAAmB;IACnB,UAAW,QAAgB,EAAU;QACjC,IAAI,aAAa,KAAK,aAAa,GAC/B,OAAO;QAGX,IAAI,IAAI,CAAC,QAAQ,IAAI;YACjB,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,CAAC,UAAU,MACnC,IAAI,CAAC,cAAc;iBAEnB,IAAI,CAAC,cAAc,CAAA,GAAA,SAAE,EAAE,UAAU,IAAI,CAAC,aAAa;YAEvD,IAAI,CAAC;QACT,OAAO,IAAI,CAAC,IAAI,CAAC,qBAAqB;YAClC,IAAI,CAAC,sBAAsB;YAC3B,2DAA2D;YAC3D,IAAI,IAAI,CAAC,cAAc,MACnB,IAAI,CAAC,kBAAkB;QAE/B;QAEA,OAAO,KAAK,IAAI,UAAU,IAAI,IAAI,CAAC;IACvC;;aA3BQ,QAAgB;aAChB,cAAsB,EAAG,eAAe;;aACxC,sBAA+B;aAC/B,kBAA0B;;AA0BtC;;;;;ACrCA,yCAAgB;AAIhB,0CAAgB;AAIhB,iDAAgB;AAKhB,gDAAgB;AAKhB,sDAAgB;AAIhB,sDAAgB;AAIhB,kDAAgB;AAKhB,2CAAgB;AAQhB,4CAAgB;AAWhB,kDAAgB;AAOhB,4CAAgB;AAahB;;;CAGC,GACD,+CAAgB;AAgBhB;;;CAGC,GACD,iDAAgB;AAgBhB;;;;;;;;CAQC,GACD,2CAAgB;AAKhB;;;;CAIC,GACD,kDAAgB;AAkBhB;;CAEC,GACD,kDAAgB;AAtJT,SAAS,IAAK,CAAS,EAAE,CAAS,EAAE,CAAS;IAChD,OAAO,IAAK,CAAA,IAAI,CAAA,IAAK,IAAI;AAC7B;AAEO,SAAS,KAAM,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IAChE,OAAO,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,IAAI;AAC9D;AAEO,SAAS,YAAa,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IACvE,gCAAgC;IAChC,OAAO,KAAK,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,IAAI;AACpD;AAEO,SAAS,WAAY,CAAS,EAAE,CAAS;IAC5C,gCAAgC;IAChC,OAAO,IAAI,IAAI,IAAI;AACvB;AAEO,SAAS,iBAAkB,EAAa,EAAE,EAAa;IAC1D,OAAO,KAAK,MAAM,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG;AAC7C;AAEO,SAAS,iBAAkB,EAAa,EAAE,EAAa;IAC1D,OAAO,iBAAiB,IAAI,MAAM,MAAM,KAAK;AACjD;AAEO,SAAS,aAAc,CAAY,EAAE,IAAW;IACnD,OAAO,KAAK,KAAK,EAAE,KAAK,EAAE,KAAK,KAAK,IAAI,KAAK,SACzC,KAAK,KAAK,EAAE,KAAK,EAAE,KAAK,KAAK,IAAI,KAAK;AAC9C;AAEO,SAAS,MAAO,GAAW,EAAE,GAAW,EAAE,GAAW;IACxD,OAAO,MAAM,MACP,MACA,MAAM,MACF,MACA;AACd;AAEO,SAAS,OAAQ,CAAS,EAAE,CAAS,EAAE,GAAW;IACrD,MAAM,QAAQ,MAAO,CAAA,KAAK,KAAK,GAAE;IACjC,MAAM,KAAK,KAAK,IAAI;IACpB,MAAM,KAAK,KAAK,IAAI;IAEpB,OAAO;QACH,GAAG,IAAI,KAAK,IAAI;QAChB,GAAG,IAAI,KAAK,IAAI;IACpB;AACJ;AAEO,SAAS,aAAc,MAAiB,EAAE,KAAgB,EAAE,GAAW;IAC1E,MAAM,MAAM,OAAO,MAAM,IAAI,OAAO,GAAG,MAAM,IAAI,OAAO,GAAG;IAC3D,IAAI,KAAK,OAAO;IAChB,IAAI,KAAK,OAAO;IAChB,OAAO;AACX;AAEO,SAAS,OAAQ,SAAoB,EAAE,GAAW,EAAE,GAAW;IAClE,UAAU,KAAK;IACf,UAAU,KAAK;IACf,MAAM,KAAK,KAAK,MAAM,UAAU;IAChC,MAAM,KAAK,KAAK,MAAM,UAAU;IAChC,UAAU,KAAK;IACf,UAAU,KAAK;IACf,OAAO;QACH;QACA;IACJ;AACJ;AAMO,SAAS,UAAW,CAAS;IAChC,IAAI,IAAI,MAAM,GAAG;QACb,IAAI,IAAI,MAAM,GACV,OAAO;QAEX,OAAO,IAAI;IACf;IACA,MAAM,QAAQ,KAAK,KAAK;IACxB,MAAM,QAAQ,KAAK,MAAM;IACzB,IAAI,QAAQ,MAAM,GACd,OAAO;SAEP,OAAO;AAEf;AAMO,SAAS,YAAa,CAAS;IAClC,IAAI,IAAI,MAAM,GAAG;QACb,IAAI,IAAI,MAAM,GACV,OAAO,IAAI;QAEf,OAAO;IACX;IACA,MAAM,QAAQ,KAAK,KAAK;IACxB,MAAM,QAAQ,KAAK,MAAM;IACzB,IAAI,QAAQ,MAAM,GACd,OAAO;SAEP,OAAO;AAEf;AAWO,SAAS,MAAO,CAAS,EAAE,MAAc;IAC5C,MAAM,YAAY,KAAK,IAAI,IAAI;IAC/B,OAAO,KAAK,MAAM,AAAC,EAAC,mBAAmB,MAAM,aAAa;AAC9D;AAOO,SAAS,aAAc,MAA2B,EAAE,MAA2B;IAClF,IAAI,CAAC,UAAU,CAAC,QACZ,MAAM,IAAI,MAAM;IAEpB,IAAI,CAAC,QACD,OAAO;IAEX,IAAI,CAAC,QACD,SAAS;QAAE,IAAI,OAAO;QAAI,IAAI,OAAO;QAAI,IAAI,OAAO;QAAI,IAAI,OAAO;IAAG;SACnE;QACH,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO;QACvC,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO;QACvC,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO;QACvC,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO;IAC3C;IACA,OAAO;AACX;AAKO,SAAS,aAAc,MAA2B,EAAE,KAAa,EAAE,MAAc;IACpF,IAAI,CAAC,QACD,OAAO;IAEX,MAAM,KAAK,KAAK,IAAI,GAAG,OAAO;IAC9B,MAAM,KAAK,KAAK,IAAI,GAAG,OAAO;IAC9B,MAAM,KAAK,KAAK,IAAI,QAAQ,GAAG,OAAO;IACtC,MAAM,KAAK,KAAK,IAAI,SAAS,GAAG,OAAO;IACvC,IAAI,KAAK,MAAM,KAAK,IAChB,OAAO;IAEX,OAAO;QAAE;QAAI;QAAI;QAAI;IAAG;AAC5B;;;;;AChKA,gDAAgB;AAUhB,yCAAgB;AAQhB;;;CAGC,GACD,wDAAgB;AA0BhB;;;;;;CAMC,GACD,oEAAgB;AAmChB;;;;;;;CAOC,GACD,kEAAgB;yDA2DH;0DA+BA;AA8Bb;;;;;;;CAOC,GACD,kDAAgB;AA4HhB;;;;CAIC,GACD,iEAAgB;AAWhB;;;;CAIC,GACD,gDAAgB;AAMhB;;;;;CAKC,GACD,kDAAgB;AAlYhB;AACA;AAEO,SAAS,WAAY,MAAyB;IACjD,MAAM,eAAe,CAAA,GAAA,0BAAW,EAAE,OAAO,OAAO,OAAO;IACvD,MAAM,MAAM,aAAa,WAAW;IACpC,IAAI,CAAC,KACD,MAAM,IAAI,MAAM;IAEpB,IAAI,UAAU,QAAQ,GAAG;IACzB,OAAO;AACX;AAEO,SAAS,IAAK,MAAyB,EAAE,OAA0C;IACtF,MAAM,MAAM,OAAO,WAAW,MAAM;IACpC,IAAI,CAAC,KACD,MAAM,IAAI,MAAM;IAEpB,OAAO;AACX;AAMO,SAAS,mBACZ,SAAiF,EACjF,MAAc,EACd,MAAc;IAEd,IACI,CAAC;QAAC;QAAG;KAAG,CAAC,SAAS,WAAW,CAAC;QAAC;QAAG;KAAG,CAAC,SAAS,WAC/C,UAAU,QAAQ,MAAM,KAAK,UAAU,SAAS,MAAM,KACtD,KAAK,IAAI,UAAU,YAAY,OAAO,GAEtC,OAAO;IAEX,MAAM,YAAY,KAAK,IAAI,UAAU,WAAW,MAAM,QAAQ;IAC9D,MAAM,QAAQ,YAAY,UAAU,SAAS,UAAU;IACvD,MAAM,SAAS,YAAY,UAAU,QAAQ,UAAU;IACvD,OAAO,AACC,CAAA,AAAC,KAAK,IAAI,SAAS,MAAM,KAAK,UAAU,IAAI,MAAM,KACjD,KAAK,IAAI,SAAS,MAAM,KAAK,UAAU,IAAI,MAAM,GAAG,KAGrD,CAAA,AAAC,KAAK,IAAI,UAAU,MAAM,KAAK,UAAU,IAAI,MAAM,KAClD,KAAK,IAAI,UAAU,MAAM,KAAK,UAAU,IAAI,MAAM,GAAG;AAElE;AAUO,SAAS,+BACZ,OAAiC,EACjC,cAAoD,EACpD,SAAiF,EACjF,MAA8D,EAC9D,SAAmB;IAEnB,IAAI,CAAC,QACD,SAAS;QACL,GAAG;QACH,GAAG;QACH,OAAO,eAAe;QACtB,QAAQ,eAAe;IAC3B;IAGJ,QAAQ;IACR,IAAI,WACA,QAAQ,wBAAwB;SAC7B;QACH,QAAQ,wBAAwB;QAChC,QAAQ,wBAAwB;IACpC;IAEA,QAAQ,UAAU,UAAU,GAAG,UAAU;IACzC,QAAQ,OAAO,UAAU,WAAW,MAAM,KAAK;IAC/C,QAAQ,MAAM,UAAU,QAAQ,IAAI,IAAI,IAAI,UAAU,SAAS,IAAI,IAAI;IACvE,QAAQ,UACJ,gBACA,OAAO,GAAG,OAAO,GAAG,OAAO,OAAO,OAAO,QACzC,CAAC,KAAK,IAAI,UAAU,SAAS,GAAG,CAAC,KAAK,IAAI,UAAU,UAAU,GAAG,KAAK,IAAI,UAAU,QAAQ,KAAK,IAAI,UAAU;IAEnH,QAAQ;AACZ;AAUO,SAAS,6BACZ,UAA6B,EAC7B,cAAoD,EACpD,YAKC;IAED,eAAe,CAAA,GAAA,aAAM,EAAE;IACvB,IAAI,CAAC,aAAa,QACd,aAAa,SAAS;QAClB,GAAG,eAAe,QAAQ;QAC1B,GAAG,eAAe,SAAS;IAC/B;IAEJ,IAAI,CAAC,aAAa,OACd,aAAa,QAAQ;QACjB,GAAG;QACH,GAAG;IACP;IAEJ,IAAI,CAAC,aAAa,aACd,aAAa,cAAc;IAE/B,IAAI,CAAC,aAAa,WACd,aAAa,YAAY;QACrB,GAAG;QACH,GAAG;IACP;IAGJ,MAAM,MAAM,WAAW,WAAW;IAClC,IAAI,CAAC,KACD,MAAM,IAAI,MAAM;IAEpB,IAAI;IACJ,IACI,KAAK,IAAI,aAAa,MAAM,IAAI,KAAM,YACtC,KAAK,IAAI,aAAa,MAAM,IAAI,KAAK,YACrC,KAAK,IAAI,aAAa,cAAc,MAAM,UAC5C;QACE,IAAI,wBAAwB;QAC5B,IAAI,wBAAwB;IAChC,OACI,IAAI,wBAAwB;IAGhC,IAAI,UAAU,aAAa,UAAU,GAAG,aAAa,UAAU;IAC/D,IAAI,UAAU,aAAa,OAAO,GAAG,aAAa,OAAO;IACzD,IAAI,OAAO,aAAa,cAAc,MAAM,KAAK;IACjD,IAAI,MAAM,aAAa,MAAM,GAAG,aAAa,MAAM;IACnD,IAAI,UAAU,CAAC,aAAa,OAAO,GAAG,CAAC,aAAa,OAAO;IAC3D,IAAI,UAAU,gBAAgB,GAAG,GAAG,eAAe,OAAO,eAAe;IAEzE,IAAI;AACR;AAEO,MAAM,sBAAsB,SAAU,IAAY,EAAE,MAAgB;IACvE,MAAM,SAAS,CAAA,GAAA,0BAAW;IAC1B,IAAI;IACJ,IAAI,OAAO,GAAG;QACV,OAAO,QAAQ;QACf,OAAO,SAAS;QAChB,MAAM,OAAO,WAAW;QACxB,IAAI,CAAC,KACD,MAAM,IAAI,MAAM;QAEpB,IAAI,YAAY;QAChB,IAAI,SAAS,GAAG,GAAG,GAAG;IAC1B,OAAO,IAAI,OAAO,KAAK;QACnB,OAAO,QAAQ;QACf,OAAO,SAAS;IACpB,OAAO;QACH,OAAO,QAAQ,OAAO;QACtB,OAAO,SAAS,OAAO;QACvB,MAAM,OAAO,WAAW;QACxB,IAAI,CAAC,KACD,MAAM,IAAI,MAAM;QAEpB,IAAI,YAAY,SAAS,oBAAoB;QAC7C,IAAI,SAAS,GAAG,GAAG,OAAO,GAAG,OAAO;QACpC,IAAI,YAAY,SAAS,oBAAmB;QAC5C,IAAI,SAAS,GAAG,GAAG,MAAM;QACzB,IAAI,SAAS,MAAM,MAAM,OAAO,GAAG,OAAO;IAC9C;IACA,OAAO;AACX;AAEO,MAAM,uBAAuB,AAAC;IACjC,MAAM,QAAoB;QACtB,MAAM;QACN,MAAM;IACV;IAEA,OAAO,SAAU,IAAY,EAAE,QAA8B,EAAE,MAAgB;QAC3E,MAAM,UAAU,SAAS,MAAM;QAE/B,SAAS,OAAQ,IAAY;YACzB,OAAO,SAAS,KAAK;YACrB,IAAI,KAAK,CAAC,KAAK,OAAO,QAAQ,EAC1B,OAAO,KAAK,CAAC,KAAK,OAAO,QAAQ;YAErC,MAAM,SAAS,oBAAoB,MAAM;YACzC,MAAM,SAAS,OAAO,UAAU;YAChC,KAAK,CAAC,KAAK,OAAO,QAAQ,GAAG;YAC7B,OAAO;QACX;QAEA,IAAI,UACA,WAAW;YACP,SAAS,OAAO;QACpB,GAAG;aAEH,OAAO,OAAO;IAEtB;AACJ;AAUO,SAAS,aACZ,MAAyB,EACzB,CAAS,EACT,CAAS,EACT,IAAwB,EACxB,IAAwB;IAGxB,gDAAgD;IAChD,SAAS,YAAa,IAAY,EAAE,IAAY,EAAE,IAAY,EAAE,IAAY;QACxE,MAAM,SAAS;YACX,YAAY,KAAK,MAAM,KAAK,KAAK;YACjC,aAAa,KAAK,MAAM,KAAK,KAAK;YAClC,YAAY,KAAK,KAAK,KAAK,KAAK;YAChC,aAAa,KAAK,KAAK,KAAK,KAAK;QACrC;QACA,OAAO,aAAa,KAAK,IAAI,OAAO,YAAY,OAAO;QACvD,OAAO,cAAc,KAAK,IAAI,OAAO,aAAa,OAAO;QACzD,OAAO;IACX;IAEA,IAAI,CAAC,KAAK,CAAC,KAAM,MAAM,OAAO,SAAS,MAAM,OAAO,QAChD;IAEJ,IAAI,KAAK,IAAI,GAAG;IAChB,IAAI,KAAK,IAAI,GAAG;IAChB,IAAI,KAAK,OAAO,SAAS,KAAK,OAAO,QAAQ;QAEzC,OAAO,CAAC,OAAO,CAAA,GAAA,0BAAW,MAAM;QAChC,OAAO,CAAC,OAAO,CAAA,GAAA,0BAAW,MAAM;QAEhC,MAAM,QAAQ,YAAY,OAAO,OAAO,OAAO,QAAQ,GAAG;QAE1D,kGAAkG;QAClG,KAAK,QAAQ,MAAM,aAAa,MAAM,aAAa,KAAK,IAAI,GAAG,MAAM,cAAc;QACnF,KAAK,SAAS,MAAM,cAAc,MAAM,cAAc,KAAK,IAAI,GAAG,MAAM,eAAe;QACvF,KAAK,WAAW,MAAO;QACvB,KAAK,WAAW,MAAO;QAEvB,IAAI,IAAI;QACR,IAAI,UAAU,MAAM,UAAU;QAE9B,KAAK,MAAM;QACX,KAAK,MAAM;QAEX,IAAI,YAAY,QAAQ,WAAW;QACnC,UAAU,wBAAwB;QAClC,UAAU,wBAAyB;QACnC,UAAU,2BAA4B;QACtC,UAAU,UAAU,QAAQ,GAAG,GAAG,QAAQ,OAAO,QAAQ;QAEzD,IAAI,eAAe,QAAQ;QAC3B,IAAI,gBAAgB,QAAQ;QAE5B,wBAAwB;QACxB,MAAO,KAAK,MAAM,cAAc,KAAK,MAAM,aAAa,MAAM,KAAM;YAChE,YAAY,QAAQ,WAAW;YAC/B,UAAU,wBAAwB;YAClC,UAAU,wBAAyB;YACnC,UAAU,2BAA4B;YAEtC,MAAM,WAAW,AAAC,KAAK,MAAM,aAAc,eAAe,IAAI;YAC9D,MAAM,YAAY,AAAC,KAAK,MAAM,cAAe,gBAAgB,IAAI;YAEjE,uDAAuD;YACvD,QAAQ,QAAQ;YAChB,QAAQ,SAAS;YAEjB,UAAU,UACN,SACA,GAAG,GACH,cAAc,eACd,GAAG,GACH,UAAU;YAEd,eAAe;YACf,gBAAgB;YAEhB,MAAM;YACN,MAAM,MAAM;YACZ,UAAU;YACV,UAAU;QACd;QAEA,oDAAoD;QACpD,OAAO,QAAQ;QACf,OAAO,SAAS;QAChB,MAAM,YAAY,OAAO,WAAW;QACpC,UAAU;QACV,UAAU,wBAAwB;QAClC,UAAU,wBAAyB;QACnC,UAAU,UACN,SACA,GAAG,GACH,cAAc,eACd,GAAG,GACH,GAAG;QAEP,UAAU;QACV,KAAK,WAAW,MAAO;QACvB,KAAK,WAAW,MAAO;IAE3B,OAAO,IAAI,KAAK,OAAO,SAAS,KAAK,OAAO,QAAQ;QAEhD,OAAO,CAAC,OAAO,CAAA,GAAA,0BAAW,MAAM;QAChC,KAAK,QAAQ;QACb,KAAK,SAAS;QACd,MAAM,UAAU,KAAK,WAAW;QAChC,QAAQ;QACR,QAAQ,wBAAwB;QAChC,QAAQ,wBAAyB;QACjC,QAAQ,UAAU,QAAQ,GAAG,GAAG,GAAG;QACnC,QAAQ;QAER,OAAO,QAAQ;QACf,OAAO,SAAS;QAChB,OAAO,WAAW,MAAO,UAAU,MAAM,GAAG;IAEhD,OAAO;QACH,aAAa,QAAQ,GAAG,OAAO,QAAQ,MAAM;QAC7C,aAAa,QAAQ,GAAG,GAAG,MAAM;IACrC;AACJ;AAOO,SAAS,4BAA6B,MAAyB;IAClE,MAAM,QAAQ,OAAO,WAAW,MAAO,aAAa,GAAG,GAAG,OAAO,OAAO,OAAO;IAC/E,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,KAAK,QAAQ,KAAK,EAAG;QAC3C,IAAI,MAAM,IAAI,CAAC,IAAI,EAAE,KAAK,GACtB;QAEJ,MAAM,IAAI,CAAC,IAAI,EAAE,GAAG,AAAC,CAAA,MAAM,IAAI,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC,IAAI,EAAE,GAAG,MAAM,IAAI,CAAC,IAAI,EAAE,AAAD,IAAK,IAAK,CAAA,MAAM,IAAI,CAAC,IAAI,EAAE,GAAG,GAAE;IAC7G;IACA,OAAO,WAAW,MAAO,aAAa,OAAO,GAAG;AACpD;AAOO,SAAS,WAAY,MAAyB;IACjD,OAAO,QAAQ;IACf,OAAO,SAAS;IAChB,OAAO;AACX;AAQO,SAAS,aAAc,OAAiC;IAC3D,MAAM,YAKF;QAAE,GAAG;QAAG,GAAG;QAAG,OAAO;QAAG,QAAQ;IAAE;IACtC;QACI,MAAM,aAA+B;YACjC,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,IAAI;QACR;QACA,MAAM,QAAQ,QAAQ,aAAa,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAE9E,IAAI,MAAM,IAAI,CAAC,EAAE,GAAG,KAAK,MAAM,IAAI,CAAC,MAAM,KAAK,SAAS,EAAE,GAAG,GAAG;YAC5D,WAAW,KAAK;YAChB,WAAW,KAAK;YAChB,WAAW,KAAK,QAAQ,OAAO,QAAQ;YACvC,WAAW,KAAK,QAAQ,OAAO,SAAS;QAC5C,OAAO;YACH,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,KAAK,QAAQ,KAAK,EACxC,IAAI,MAAM,IAAI,CAAC,EAAE,GAAG,GAAI;gBACpB,MAAM,IAAI,AAAE,CAAA,IAAI,CAAA,IAAK,IAAM,QAAQ,OAAO;gBAC1C,MAAM,IAAI,KAAK,MAAM,AAAC,CAAA,IAAI,CAAA,IAAK,IAAI,QAAQ,OAAO;gBAClD,IAAI,WAAW,OAAO,aAAa,WAAW,KAAK,GAC/C,WAAW,KAAK;gBAEpB,IAAI,WAAW,OAAO,WAClB,WAAW,KAAK;gBAEpB,IAAI,WAAW,OAAO,aAAa,WAAW,KAAK,GAC/C,WAAW,KAAK;gBAEpB,IAAI,WAAW,OAAO,aAAa,WAAW,KAAK,GAC/C,WAAW,KAAK;YAExB;QAER;QACA,IAAI,WAAW,OAAO,aAAa,WAAW,OAAO,aAAa,WAAW,OAAO,aAAa,WAAW,OAAO,WAC/G,OAAO;QAEX,UAAU,IAAI,WAAW;QACzB,UAAU,IAAI,WAAW;QACzB,UAAU,QAAQ,WAAW,KAAM,WAAW,KAAK;QACnD,UAAU,SAAS,WAAW,KAAM,WAAW,KAAK;IACxD;IACA,OAAO;AACX;;;ACrbA;;;;;;;;;;;EAWE;;AAEF,kDAAgB;AAAT,SAAS,aAAc,CAAU,EAAE,CAAU;IAChD,MAAM,SAAS,SAAS,cAAc;IACtC,IAAI,KAAK,GAAG;QACR,OAAO,QAAQ;QACf,OAAO,SAAS;IACpB;IACA,mCAAmC;IACnC,OAAO;AACX;;;ACpBA,qFAAqF;AACrF,gBAAgB;;;4CAkFH;AAvEb,SAAS;IACL,OAAO;QACH;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;KACZ;AACL;AAEA,iBAAiB;AACjB,SAAS,uBAAwB,MAAkB,EAAE,KAAY;IAC7D,OAAO;QACF,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG;QAChG,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG;QAChG,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG;QACjG,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG,GAAK,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG;KACrG;AACL;AAEA,mBAAmB;AACnB,SAAS,iBAAkB,OAAmB,EAAE,OAAmB;IAE/D,uCAAuC;IACvC,MAAM,OAAc;QAAC,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;KAAC;IACpE,MAAM,OAAc;QAAC,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;KAAC;IACpE,MAAM,OAAc;QAAC,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,GAAG;QAAE,OAAO,CAAC,GAAG;KAAC;IACtE,MAAM,OAAc;QAAC,OAAO,CAAC,GAAG;QAAE,OAAO,CAAC,GAAG;QAAE,OAAO,CAAC,GAAG;QAAE,OAAO,CAAC,GAAG;KAAC;IAExE,+BAA+B;IAC/B,MAAM,UAAU,uBAAuB,SAAS;IAChD,MAAM,UAAU,uBAAuB,SAAS;IAChD,MAAM,UAAU,uBAAuB,SAAS;IAChD,MAAM,UAAU,uBAAuB,SAAS;IAEhD,iDAAiD;IACjD,OAAO;QACH,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAC9C,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAC9C,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAC9C,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;QAAE,OAAO,CAAC,EAAE;KACjD;AACL;AAEA,SAAS,wBAAyB,CAAS,EAAE,CAAS;IAClD,OAAO;QACH;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;KACZ;AACL;AAEA,SAAS,qBAAsB,QAAgB;IAC3C,8CAA8C;IAC9C,OAAO;QACH,KAAK,IAAI,CAAC;QAAW,CAAC,KAAK,IAAI,CAAC;QAAW;QAAG;QAC9C,KAAK,IAAI,CAAC;QAAW,KAAK,IAAI,CAAC;QAAW;QAAG;QAC7C;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;KACZ;AACL;AAEA,SAAS,kBAAmB,CAAS;IACjC,OAAO;QACH;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;QACT;QAAG;QAAG;QAAG;KACZ;AACL;AAEO,MAAM,SAAS,OAAO,OAAO;IAChC;IACA;IACA;IACA;IACA;IACA;AACJ;;;;;0CCzFa;AAAN,MAAM,OAAO;IAChB,KAAK,SAAU,EAAa,EAAE,EAAa;QACvC,OAAO;YAAC,GAAG,GAAG,IAAI,GAAG;YAAG,GAAG,GAAG,IAAI,GAAG;QAAC;IAC1C;IACA,KAAK,SAAU,EAAa,EAAE,EAAa;QACvC,OAAO;YAAC,GAAG,GAAG,IAAI,GAAG;YAAG,GAAG,GAAG,IAAI,GAAG;QAAC;IAC1C;IACA,KAAK,SAAU,CAAY;QACvB,MAAM,MAAM,KAAK,KAAK,KAAK,IAAI,EAAE,GAAG,KAAK,KAAK,IAAI,EAAE,GAAG;QACvD,OAAO;YAAC,GAAG,EAAE,IAAI;YAAK,GAAG,EAAE,IAAI;QAAG;IACtC;IACA,KAAK,SAAU,CAAY;QACvB,OAAO,KAAK,KAAK,KAAK,IAAI,EAAE,GAAG,KAAK,KAAK,IAAI,EAAE,GAAG;IACtD;IACA,MAAM,SAAU,EAAa,EAAE,EAAa;QACxC,OAAO,KAAK,IAAI,KAAK,IAAI,IAAI;IACjC;IACA,KAAK,SAAU,CAAY,EAAE,CAAS;QAClC,OAAO;YAAC,GAAG,EAAE,IAAI;YAAG,GAAG,EAAE,IAAI;QAAC;IAClC;IACA,OAAO,SAAU,EAAa,EAAE,EAAa;QACzC,OAAO,KAAK,MAAM,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG;IAC7C;IACA,KAAK,SAAU,CAAY,EAAE,CAAY;QACrC,MAAM,OAAO;YAAC,EAAE;YAAG,EAAE;SAAE;QACvB,MAAM,OAAO;YAAC,EAAE;YAAG,EAAE;SAAE;QACvB,OAAO,KAAK,IAAI,CAAC,GAAG,IAAM,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,EAAE,OAAO,CAAC,GAAG,IAAM,IAAI;IACtE;AACJ;;;;;wDCnBa;AAwBb;;CAEC,GACD,+CAAa;AA0Fb;;;CAGC,GACD,gDAAa;AAsJb;;CAEC,GACD,wDAAa;AAiIb;;;;;;CAMC,GACD,0DAAgB;AArahB;AACA;AAEA;AAQO,MAAM,qBAAqB,SAAU,SAAoB,EAAE,OAAkB,EAAE,CAAY;IAC9F,IAAI,GAAG;IACP,IAAI,UAAU,MAAM,QAAQ,GAAG;QAC3B,IAAI,UAAU;QACd,IAAI,EAAE;QAEN,OAAO;YACH,GAAG;YACH,GAAG;QACP;IACJ;IACA,MAAM,IAAI,AAAC,CAAA,QAAQ,IAAI,UAAU,CAAA,IAAM,CAAA,QAAQ,IAAI,UAAU,CAAA;IAC7D,MAAM,IAAI,UAAU,IAAK,IAAI,UAAU;IAEvC,IAAI,AAAC,CAAA,IAAI,EAAE,IAAI,EAAE,IAAI,IAAI,CAAA,IAAM,CAAA,IAAI,IAAI,CAAA;IACvC,IAAI,AAAC,CAAA,IAAI,IAAI,EAAE,IAAI,IAAI,EAAE,IAAI,CAAA,IAAM,CAAA,IAAI,IAAI,CAAA;IAE3C,OAAO;QACH,GAAG;QACH,GAAG;IACP;AACJ;AAMO,MAAM;IAQT,mBAAmB;IACnB,YACI,CAEC,CACH;QACE,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,OAAO,QAAQ,IACjC,AAAC,CAAA,CAAC;YACE,IAAI,SAAS;YACb,IAAI,IAAI,EAAE,OAAO,SAAS,GACtB,SAAS,CAAA,GAAA,UAAG,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE,MAAM,CAAC,EAAE,CAAC,GAAG,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC;YAEnF,IAAI,CAAC,UAAU,CAAC,EAAE,GAAG;gBACjB,GAAG,EAAE,MAAM,CAAC,EAAE,CAAC;gBACf,GAAG,EAAE,MAAM,CAAC,EAAE,CAAC;gBACf,QAAQ;YACZ;QACJ,CAAA,EAAG;IAEX;IAEA,sBAAsB;IAEtB;;;KAGC,GACD,UAAW,IAAY,EAAa;QAChC,IAAI,YAAY,KAAK,IAAI,IAAI,CAAC,aAAa;QAC3C,IAAI,IAAI;QAER,MAAO,YAAY,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,IAAI,IAAI,CAAC,WAAW,SAAS,GAAG,IAC5E,aAAa,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;QAGpC,MAAM,MAAM,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG,YAAY,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;QAEnE,OAAO;YACH,GAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAK,CAAA,IAAI,GAAE,IAAK,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,IAAI;YAClE,GAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAK,CAAA,IAAI,GAAE,IAAK,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,IAAI;QACtE;IACJ;IAEA;;KAEC,GACD,YAAqB;QACjB,IAAI,SAAS;QACb,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,SAAS,GAAG,IAC5C,UAAU,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;QAEjC,OAAO;IACX;AACJ;AA+BO,MAAM;IAST;;;;;;;;KAQC,GACD,AAAQ,gBAAiB,EAAa,EAAE,EAAa,EAAE,EAAa,EAAE,EAAa,EAAE,UAAkB,EAAe;QAClH,MAAM,cAAc,EAAE;QACtB,IAAI;QACJ,IAAK,IAAI,IAAI,GAAG,KAAK,YAAY,IAAK;YAClC,IAAI,IAAI;YACR,WAAW,CAAC,YAAY,OAAO,GAAG;gBAC9B,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAI,IAAI,KAAK,IAAI,IAAI,GAAG,KAAK,IAAI,GAAG,IAAI,IAAK,CAAA,IAAI,CAAA,IAAK,KAAK,IAAI,GAAG,KAAK,GAAG,IAAI,KAAK,IAAI,GAAG,KAAK,GAAG;gBAC7H,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAI,IAAI,KAAK,IAAI,IAAI,GAAG,KAAK,IAAI,GAAG,IAAI,IAAK,CAAA,IAAI,CAAA,IAAK,KAAK,IAAI,GAAG,KAAK,GAAG,IAAI,KAAK,IAAI,GAAG,KAAK,GAAG;YACjI;QACJ;QACA,OAAO;IACX;IAEA,mBAAmB;IACnB,aAAe;aA7BP,UAAkB;QA8BtB,IAAI,CAAC,WAAW,EAAE;IACtB;IAEA,sBAAsB;IAEtB;;;;;;;;KAQC,GACD,IACI,CAAS,EACT,CAAS,EACT,OAAe,EACf,QAA8B,EAC9B,gBAA8C,EAC1C;QACJ,IAAI,IAAI,CAAC,aAAa,MAAM,IAAI,CAAC,UAAU,KAAK,MAAM,IAAI,CAAC,UAAU,GACjE;QAEJ,IAAI,CAAC,YAAY;YAAC;YAAG;QAAC;QACtB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,OAAO,GAAG;YAClC;YACA;YACA;QACJ;QAEA,sBAAsB;QACtB,IAAI,IAAI,CAAC,SAAS,WAAW,GAAG;YAC5B,IAAI,CAAC,cAAc;YACnB;QACJ,OAAO,IAAI,IAAI,CAAC,SAAS,WAAW,GAAG;YACnC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAA,GAAA,UAAG,EAAE,IAAI,CAAA,GAAA,UAAG,EAAE,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC3E,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,cAAc;YACnB;QACJ,OAAO;YACH,MAAM,UAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;YACvD,MAAM,UAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;YACvD,MAAM,UAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;YACvD,QAAQ,MAAM,CAAA,GAAA,UAAG,EAAE,IAAI,CAAA,GAAA,UAAG,EAAE,IAAI,SAAS;YACzC,IAAI,MAAM,QAAQ,IAAI,MAAM,MAAM,QAAQ,IAAI,IAC1C,kBAAkB;YAClB,QAAQ,MAAM,CAAA,GAAA,aAAM,EAAE,QAAQ;QAEtC;QAEA,kBAAkB;QAClB,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;QACjD,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;QACjD,MAAM,KAAK;QACX,MAAM,KAAK,CAAA,GAAA,UAAG,EAAE,IAAI,GAAG,CAAA,GAAA,UAAG,EAAE,IAAI,EAAE,KAAK,CAAA,GAAA,UAAG,EAAE,KAAK,GAAG,KAAK;QACzD,MAAM,KAAK,CAAA,GAAA,UAAG,EAAE,IAAI,GAAG,CAAA,GAAA,UAAG,EAAE,IAAI,EAAE,KAAK,CAAA,GAAA,UAAG,EAAE,KAAK,GAAG,KAAK;QACzD,MAAM,KAAK;QAGX,IAAI;QACJ,IAAI,UAAU;YACV,MAAM,cAAc,IAAI,CAAC,gBAAgB,IAAI,IAAI,IAAI,IAAI;YACzD,YAAY,IAAI,UAAU;gBAAC,QAAQ;YAAW;QAClD,OACI,YAAY,IAAI,UAAU;YAAC,QAAQ;gBAAC;gBAAI;aAAG;QAAA;QAG/C,8CAA8C;QAC9C,MAAM,MAAM,UAAU;QACtB,IAAI,cAAc,CAAA,GAAA,SAAE,EAAE,IAAI,CAAC,aAAc,SAAS,CAAA,GAAA,WAAI,EAAE,IAAI,CAAC,UAAU,KAAK,GAAG;QAC/E,IAAI,IAAI,IAAI,CAAC;QACb,MAAO,KAAK,KAAK,KAAK,YAAa;YAC/B,cAAc,CAAA,GAAA,SAAE,EAAE,IAAI,CAAC,aAAc,SAAS,CAAA,GAAA,WAAI,EAAE,IAAI,KAAK,GAAG;YAChE,MAAM,QAAQ,UAAU,UAAU;YAClC,MAAM,QAAQ,IAAI,CAAC,oBAAoB,CAAA,GAAA,sBAAe,EAAE,IAAI,CAAC,mBAAmB,SAAS;YACzF,IAAI,UACA,SAAS;gBACL,GAAG,MAAM;gBACT,GAAG,MAAM;gBACT,GAAG,IAAI;gBACP,OAAO;gBACP,QAAQ,IAAI,CAAC,oBAAoB,QAAS,IAAI,CAAC,YAAa;YAChE;YAEJ,IAAI,CAAC,oBAAoB;YACzB,IAAI,CAAC,YAAY;QACrB;QAEA,IAAI,UACA,IAAI,CAAC,UAAU,IAAI;aAChB;YACH,IAAI,CAAC,UAAU;YACf,oBAAoB,iBAAiB;gBAAC,IAAI;gBAAI,IAAI;gBAAI,IAAI;gBAAI,IAAI;YAAE;QACxE;QAEA,IAAI,CAAC,cAAc;IACvB;IAEA,SACI,OAAe,EACf,QAA8B,EAC9B,gBAA8C,EAC1C;QACJ,IAAI,IAAI,CAAC,SAAS,SAAS,GACvB;QAGJ,MAAM,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;QAClD,MAAM,KAAK,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;QAElD,MAAM,OAAO,CAAA,GAAA,UAAG,EAAE,IAAI,IAAI,CAAA,GAAA,UAAG,EAAE,IAAI,IAAI;QAEvC,IAAI,CAAC,IAAI,KAAK,GAAG,KAAK,GAAG,SAAS,UAAU;IAChD;AACJ;AAKO,MAAM;IAUT,mBAAmB;IACnB,YACI,MAA0B,CAC5B;QACE,MAAM,IAAI,OAAO;QACjB,IAAI,CAAC,KAAK,EAAE;QACZ,IAAI,CAAC,KAAK,EAAE;QACZ,IAAI,CAAC,IAAI,EAAE;QACX,IAAI,CAAC,KAAK,EAAE;QACZ,IAAI;QAEJ,IAAI,CAAC,QAAQ,MAAM,CAAC,EAAE,CAAC,EAAE;QACzB,IAAI,CAAC,OAAO,MAAM,CAAC,OAAO,SAAS,EAAE,CAAC,EAAE;QAExC,OAAO,KAAK,SAAU,CAAC,EAAE,CAAC;YACtB,OAAO,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACtB;QACA,IAAK,IAAI,GAAG,IAAI,GAAG,IAAK;YACpB,IAAI,CAAC,GAAG,KAAK,MAAM,CAAC,EAAE,CAAC,EAAE;YACzB,IAAI,CAAC,GAAG,KAAK,MAAM,CAAC,EAAE,CAAC,EAAE;QAC7B;QAEA,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG;QACZ,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG;QAEb,IAAK,IAAI,GAAG,IAAI,IAAI,GAAG,EAAE,EAAG;YACxB,+DAA+D;YAC/D,qEAAqE;YACrE,MAAM,KAAK,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE;YAC1C,MAAM,MAAM,AAAC,CAAA,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,AAAD,IAAK;YAC5C,MAAM,IAAI,MAAM,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG;YAEjC,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,AAAC,CAAA,MAAM,GAAE,IAAK;YAE3B,MAAM,QACF,AAAC,CAAA,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,EAAE,AAAD,IAAM,CAAA,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,EAAE,AAAD,IAC3D,AAAC,CAAA,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,AAAD,IAAM,CAAA,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,AAAD;YAE/D,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,AAAC,CAAA,MAAM,QAAQ,KAAK,MAAM,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,AAAD,IAAK;QAC3D;QAEA,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG;QAEjB,iEAAiE;QACjE,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,EAAE,EACtB,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE;IAE5D;IAEA,sBAAsB;IAEtB,YAAqB;QACjB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAa,CAAS,EAAU;QAC5B,MAAM,IAAI,IAAI,CAAC,GAAG;QAClB,IAAI,MAAM;QACV,IAAI,MAAM,IAAI;QAEd,wDAAwD;QACxD,yDAAyD;QACzD,yDAAyD;QACzD,wDAAwD;QACxD,2CAA2C;QAC3C,MAAO,MAAM,MAAM,EAAG;YAClB,MAAM,IAAI,AAAC,MAAM,OAAQ;YAEzB,IAAI,IAAI,CAAC,EAAE,CAAC,EAAE,GAAG,GACb,MAAM;iBAEN,MAAM;QAEd;QAEA,MAAM,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI;QACrC,MAAM,IAAI,AAAC,CAAA,IAAI,CAAC,EAAE,CAAC,IAAI,GAAG,CAAA,IAAK;QAC/B,MAAM,IAAI,AAAC,CAAA,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,AAAD,IAAK;QAE/B,4CAA4C;QAC5C,OAAO,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,GACtC,AAAC,CAAA,AAAC,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK,IAAI,CAAC,EAAE,CAAC,IAAI,GAAG,AAAC,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK,IAAI,CAAC,EAAE,CAAC,IAAI,AAAD,IAAM,CAAA,IAAI,CAAA,IAAK;IACtF;IAEA;;;KAGC,GACD,MAAO,CAAS,EAAE,UAAkB,EAAsB;QACtD,IAAI;QACJ,IAAI;QACJ,IAAK,IAAI,IAAI,GAAG,KAAK,YAAY,IAAK;YAClC,MAAM,QAAQ,IAAI;YAClB,MAAM,QAAQ,IAAI,CAAC,YAAY;YAC/B,IAAI,MAAM,WAAW;gBACjB,IAAI;gBACJ,OAAO,KAAK,IAAI,QAAQ;gBACxB;YACJ;YAEA,MAAM,WAAW,KAAK,IAAI,QAAQ;YAElC,IAAI,WAAW,MAAO;gBAClB,IAAI;gBACJ,OAAO;YACX,OAEI;QAER;QACA,OAAO;IACX;AACJ;AAUO,SAAS,qBACZ,QAAgB,EAChB,MAAc,EACd,QAAgB;IAEhB,SAAS,MAAO,CAAS,EAAE,GAAW;QAClC,OAAO,KAAK,MAAM,IAAI,KAAK,IAAI,IAAI,QAAQ,KAAK,IAAI,IAAI;IAC5D;IAEA,MAAM,YAAgC,EAAE;IACxC,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,KAAK,SACzB,UAAU,KAAK;QAAC,MAAM,GAAG;QAAI,MAAM,WAAW,KAAK,IAAI,GAAG,KAAM,CAAA,SAAS,QAAO,GAAI;KAAG;IAE3F,OAAO;AACX;;;AChbA,2DAA2D;;;AAG3D,yCAAa;AAWb,yCAAa;AAWb,0CAAa;oDAaA;AAgOb,6DAAgB;AAnQT,MAAM;IAIT,YAAa,CAAS,EAAE,CAAS,EAAE,CAAS,CAAE;QAC1C,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;QACnC,IAAI,CAAC,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,KAAK,KAAK,YAAY;QACxD,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;IACvC;AACJ;AAEO,MAAM;IAIT,YAAa,CAAS,EAAE,CAAS,EAAE,CAAS,CAAE;QAC1C,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;QACnC,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;QACnC,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;IACvC;AACJ;AAEO,MAAM;IAKT,YAAa,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,CAAE;QACrD,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;QACnC,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;QACnC,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;QACnC,IAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK;IACvC;AACJ;AAEO,MAAM,iBAAiB;IAE1B,WAAW,SAAU,GAAQ;QACzB,MAAM,SAAS,IAAI,IAAI,GAAG,GAAG;QAE7B,MAAM,IAAI,IAAI,IAAI;QAClB,MAAM,IAAI,IAAI,IAAI;QAClB,MAAM,IAAI,IAAI,IAAI;QAElB,MAAM,SAAS,KAAK,IAAI,GAAG,GAAG;QAC9B,MAAM,SAAS,KAAK,IAAI,GAAG,GAAG;QAC9B,MAAM,QAAQ,SAAS;QAEvB,OAAO,IAAI;QAEX,IAAI,SAAS,GAAG;YACZ,OAAO,IAAI;YACX,OAAO,IAAI;QACf,OAAO;YACH,OAAO,IAAI,QAAQ;YACnB,MAAM,QAAQ,AAAC,CAAA,AAAE,CAAA,SAAS,CAAA,IAAK,IAAM,QAAQ,CAAC,IAAK;YACnD,MAAM,QAAQ,AAAC,CAAA,AAAE,CAAA,SAAS,CAAA,IAAK,IAAM,QAAQ,CAAC,IAAK;YACnD,MAAM,QAAQ,AAAC,CAAA,AAAE,CAAA,SAAS,CAAA,IAAK,IAAM,QAAQ,CAAC,IAAK;YAEnD,IAAI,KAAK,QACL,OAAO,IAAI,QAAQ;iBAChB,IAAI,KAAK,QACZ,OAAO,IAAI,AAAC,IAAI,IAAK,QAAQ;iBAC1B,IAAI,KAAK,QACZ,OAAO,IAAI,AAAC,IAAI,IAAK,QAAQ;YAGjC,IAAI,OAAO,IAAI,GACX,OAAO,KAAK;YAEhB,IAAI,OAAO,IAAI,GACX,OAAO,KAAK;QAEpB;QAEA,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QAEjC,OAAO;IACX;IAEA,WAAW,SAAU,GAAQ;QACzB,MAAM,SAAS,IAAI,IAAI,GAAG,GAAG;QAE7B,IAAI,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO;QAErD,MAAM,IAAI,AAAC,IAAI,IAAI,MAAO;QAC1B,MAAM,IAAI,IAAI,IAAI;QAClB,MAAM,IAAI,IAAI,IAAI;QAElB,IAAI,KAAK,GAAG;YACR,OAAO,IAAI,IAAI;YACf,OAAO,IAAI,IAAI;YACf,OAAO,IAAI,IAAI;QACnB,OAAO;YACH,QAAQ,IAAI;YACZ,QAAQ,KAAK,MAAM;YACnB,QAAQ,IAAK,CAAA,IAAI,CAAA;YACjB,QAAQ,IAAK,CAAA,IAAI,IAAK,CAAA,QAAQ,KAAI,CAAC;YACnC,QAAQ,IAAK,CAAA,IAAI,IAAK,CAAA,IAAK,CAAA,QAAQ,KAAI,CAAC,CAAC;YAEzC,IAAI,SAAS,GAAG;gBACZ,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ,OAAO,IAAI,SAAS,GAAG;gBACnB,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ,OAAO,IAAI,SAAS,GAAG;gBACnB,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ,OAAO,IAAI,SAAS,GAAG;gBACnB,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ,OAAO,IAAI,SAAS,GAAG;gBACnB,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ,OAAO;gBACH,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ;YAEA,OAAO,IAAI,QAAQ;YACnB,OAAO,IAAI,QAAQ;YACnB,OAAO,IAAI,QAAQ;YAEnB,OAAO,IAAI,KAAK,MAAM,OAAO;YAC7B,OAAO,IAAI,KAAK,MAAM,OAAO;YAC7B,OAAO,IAAI,KAAK,MAAM,OAAO;QACjC;QAEA,OAAO;IACX;IAEA,YAAY,SAAU,IAAU;QAC5B,MAAM,SAAS,IAAI,IAAI,GAAG,GAAG;QAE7B,MAAM,IAAI,KAAK,IAAI;QACnB,MAAM,IAAI,KAAK,IAAI;QACnB,MAAM,IAAI,KAAK,IAAI;QACnB,MAAM,IAAI,KAAK,IAAI;QAEnB,OAAO,IAAI,IAAI,KAAK,IAAI,GAAG,IAAK,CAAA,IAAI,CAAA,IAAK;QACzC,OAAO,IAAI,IAAI,KAAK,IAAI,GAAG,IAAK,CAAA,IAAI,CAAA,IAAK;QACzC,OAAO,IAAI,IAAI,KAAK,IAAI,GAAG,IAAK,CAAA,IAAI,CAAA,IAAK;QAEzC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QAEjC,OAAO;IACX;IAEA,YAAY,SAAU,GAAQ;QAC1B,MAAM,SAAS,IAAI,KAAK,GAAG,GAAG,GAAG;QAEjC,MAAM,IAAI,IAAI,IAAI;QAClB,MAAM,IAAI,IAAI,IAAI;QAClB,MAAM,IAAI,IAAI,IAAI;QAElB,OAAO,IAAI,KAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAI;QACtC,OAAO,IAAI,AAAC,CAAA,IAAI,IAAI,OAAO,CAAA,IAAM,CAAA,IAAI,OAAO,CAAA;QAC5C,OAAO,IAAI,AAAC,CAAA,IAAI,IAAI,OAAO,CAAA,IAAM,CAAA,IAAI,OAAO,CAAA;QAC5C,OAAO,IAAI,AAAC,CAAA,IAAI,IAAI,OAAO,CAAA,IAAM,CAAA,IAAI,OAAO,CAAA;QAE5C,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QACjC,OAAO,IAAI,KAAK,MAAM,OAAO,IAAI;QAEjC,OAAO;IACX;IAEA,OAAO,SAAU,CAAmB;QAChC,IAAI,aAAa,KACb,OAAO;QAEX,IAAI,aAAa,KACb,OAAO,IAAI,CAAC,UAAU;QAE1B,IAAI,aAAa,MACb,OAAO,IAAI,CAAC,WAAW;QAE3B,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,SAAU,CAAmB;QAChC,IAAI,aAAa,KACb,OAAO;QAEX,IAAI,aAAa,KACb,OAAO,IAAI,CAAC,UAAU;QAE1B,IAAI,aAAa,MACb,OAAO,IAAI,CAAC,UAAU,IAAI,CAAC,WAAW;QAE1C,MAAM,IAAI,MAAM;IACpB;IAEA,QAAQ,SAAU,CAAmB;QACjC,IAAI,aAAa,MACb,OAAO;QAEX,IAAI,aAAa,KACb,OAAO,IAAI,CAAC,WAAW;QAE3B,IAAI,aAAa,KACb,OAAO,IAAI,CAAC,WAAW,IAAI,CAAC,UAAU;QAE1C,MAAM,IAAI,MAAM;IACpB;IACA,aAAa,SAAU,CAAM;QACzB,IAAI,aAAa,OAAQ,OAAO,KAAK,OAAO,KAAK,OAAO,GAAI;YACxD,IAAI,KAAK,AAAC,SAAS,KAAK,EAAE,GAAI,SAAS;YACvC,IAAI,KAAK,AAAC,SAAS,KAAK,EAAE,GAAI,SAAS;YACvC,IAAI,KAAK,AAAC,SAAS,KAAK,EAAE,GAAI,SAAS;YACvC,IAAI,GAAG,UAAU,GACb,KAAK,MAAM;YAEf,IAAI,GAAG,UAAU,GACb,KAAK,MAAM;YAEf,IAAI,GAAG,UAAU,GACb,KAAK,MAAM;YAEf,OAAO,KAAK,KAAK;QACrB;QACA,OAAO;IACX;IACA,UAAU,SAAU,MAAyC;QACzD,OAAO,SAAS,KAAK,MAAM,OAAO,KAAK,OAAO,KAAK,MAAM,OAAO,KAAK,OAAO,KAAK,MAAM,OAAO,KAAK;IACvG;IACA,WAAW,SAAU,OAAqD;QACtE,OAAO,UAAU,KAAK,MAAM,QAAQ,KAAK,OAAO,KAAK,MAAM,QAAQ,KAAK,OAAO,KAAK,MAAM,QAAQ,KAAK,OAAO,QAAQ,IAAI;IAC9H;IACA,UAAU,SAAU,MAAc;QAC9B,SAAS,OAAO;QAChB,kEAAkE;QAClE,MAAM,iBAAiB;QACvB,SAAS,OAAO,QAAQ,gBAAgB,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;YACxD,OAAO,IAAI,IAAI,IAAI,IAAI,IAAI;QAC/B;QAEA,MAAM,SAAS,4CAA4C,KAAK;QAChE,OAAO,SAAS,IAAI,IAChB,SAAS,MAAM,CAAC,EAAE,EAAE,KACpB,SAAS,MAAM,CAAC,EAAE,EAAE,KACpB,SAAS,MAAM,CAAC,EAAE,EAAE,OACpB;IACR;AAEJ;AAEO,SAAS,wBAAyB,MAAyC;IAC9E,OAAO,AAAC,OAAO,IAAI,QAAQ,OAAO,IAAI,QAAQ,OAAO,IAAI,QAAS;AACtE;;;;;ACtQA,mDAAgB;AAOhB;;;;;CAKC,GACD,oDAAgB;AAShB,qDAAgB;AA4BhB;;CAEC,GACD,oDAAgB;qDAmBH;AA6Bb,uBAAuB;AAEvB;;;;;;;;;;;;;;;;;;CAkBC,GACD,wCAAgB;AA2EhB;;;CAGC,GACD,+CAAgB;AA9MhB;AACA;AAIO,SAAS,cAAe,MAAmB,EAAE,IAAY;IAC5D,MAAM,MAAM,SAAS,cAAc;IACnC,IAAI,YAAY;IAChB,OAAO,OAAO;IACd,OAAO;AACX;AAQO,SAAS,eAAgB,SAAkB,KAAK;IACnD,MAAM,SAAkB,CAAC,CAAC,SAAS,iBAAiB;QAAC;QAAS;QAAY;KAAS,CAAC,SAAS,SAAS,cAAc;IACpH,IAAI,QACA,OAAO;SAEP,OAAO,UAAU,CAAC,SAAS,eAAe,aAAa;AAE/D;AAEO,SAAS;IACZ,IAAI,eAAe,OAAO;QACtB;;;;;;;;aAQK,GACL,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,SAAS;YACjB,SAAS;YACT,KAAK;gBACD,SAAS;gBACT,OAAO;gBACP,QAAQ;YACZ;QACJ;QACA,WAAW;YACP,QAAQ;YACR,QAAQ;YACR,QAAQ;QACZ,GAAG;IACP;AACJ;AAKO,SAAS;IACZ,IAAI,OAAO,cAAc;QACrB,MAAM,MAAM,OAAO;QACnB,IAAI,KAAK;YACL,IAAI,IAAI,OACJ,IAAI;iBACD,IAAI,IAAI,iBACX,IAAI;QAEZ;IACJ;AACJ;AAQO,MAAM,kBAAkB,AAAC;IAE5B,SAAS,aAAc,KAAiB;QACpC,MAAM;QACN,IAAI,kBAAkB;QACtB,IAAI,MAAM,eACN,IAAI;YACC,MAAM,cAA8B;YACrC,kBAAkB;QACtB,EAAE,OAAM,GAAG;YACP,QAAQ,MAAM;QAClB;QAEJ,IAAI,CAAC,iBACD,AAAC,MAAM,cAA8B;IAE7C;IAEA,OAAO,SAAU,EAAE;QACf,GAAG,aAAa,YAAY;QAC5B,GAAG,iBAAiB,SAAS;IACjC;AACJ;AAGA,MAAM,MAGA,EAAE;AAsBD,SAAS,GACZ,MAaC;IAED,IAAI,CAAC,QACD,OAAO,SAAS,cAAc;IAElC,MAAM,SAAS,SAAS,cAAc,OAAO,UAAU,OAAO,UAAU;IACxE,OAAO,OAAO,CAAA,GAAA,SAAE,EAAE,QAAQ,OAAO;IAEjC,IAAI,OAAO,SAAS;QAChB,IAAI,OAAO,OAAO,YAAY,UAC1B,OAAO,YAAY,OAAO;aAEvB,IAAI,MAAM,QAAQ,OAAO,UAC5B,CAAA,GAAA,MAAC,EAAE,OAAO,QAAQ,OAAO;aAGzB,OAAO,OAAO,OAAO;IAG7B;IACA,IAAI,OAAO,aACP,OAAO,cAAc,OAAO;IAEhC,IAAI,OAAO,WACP,OAAO,YAAY,OAAO;IAE9B,IAAI,OAAO,IACP,OAAO,KAAK,OAAO;IAEvB,IAAI,OAAO,QACP,OAAO,OAAO,OAAO;IAEzB,IAAI,WAAW,UAAU,OAAO,UAAU,WACtC,OAAO,QAAQ,OAAO;IAE1B,MAAM,YAA0D,EAAE;IAClE,IAAI,OAAO,YAAY,WAAW;QAC9B,OAAO,iBAAiB,SAAS,OAAO;QACxC,CAAC,OAAO,SAAS,UAAU,KAAK;YAAC;YAAS,OAAO;SAAyB;IAC9E;IACA,IAAI,OAAO,aAAa,WAAW;QAC/B,OAAO,iBAAiB,UAAU,OAAO;QACzC,CAAC,OAAO,SAAS,UAAU,KAAK;YAAC;YAAU,OAAO;SAAS;IAC/D;IACA,IAAI,UAAU,SAAS,GACnB,IAAI,KAAK;QACL,IAAI;QACJ;IACJ;IAIJ,IAAI,YAAY,UAAU,OAAO,QAAQ;QACrC,MAAM,eAAe,OAAO,KAAK,OAAO;QACxC,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,QAAQ,IACrC,OAAO,aAAa,YAAY,CAAC,EAAE,EAAE,OAAO,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC;IAE3E;IACA,OAAO;AACX;AAMO,SAAS,UAAW,EAAgB;IACvC,IAAI,CAAC,IACD;IAEJ,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,QAAQ,IAAK;QACjC,MAAM,OAAO,GAAG,CAAC,EAAE;QACnB,IAAI,KAAK,OAAO,IAAI;YAChB,KAAK,UAAU,QAAQ,CAAA;gBACnB,GAAG,oBAAoB,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE;YAC3C;YACA,IAAI,OAAO,GAAG;YACd;QACJ;IACJ;IACA,YAAY;IACZ;AACJ;;;;;AC3NA,2CAAa;AAAN,MAAM;;aAEM,YAA4B,EAAE;;IAE7C,aAAe,CACf;IAEA,OAAO,UAAW,QAAsB,EAAQ;QAC5C,IAAI,MAAM,UAAU,SAAS,WACzB;QAEJ,MAAM,UAAU,KAAK;IACzB;IAEA,OAAO,YAAa,QAAsB,EAAQ;QAC9C,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,UAAU,QAAQ,IACxC,IAAI,aAAa,MAAM,SAAS,CAAC,EAAE,EAAE;YACjC,MAAM,UAAU,OAAO,GAAG;YAC1B;QACJ;IAER;IAEA,OAAO,KAAM,GAAQ,EAAQ;QACzB,MAAM,UAAU,QAAQ,CAAA;YACpB,KAAK;QACT;IACJ;AACJ;;;AC/BA;;;CAGC;;AACD,kDAAa;AAAN,MAAM;IAIT,OAAO,QAAS,GAAW,EAAiB;QACxC,sDAAsD;QACtD,IAAI,SAAS;QACb,IAAI;YACA,SAAS,aAAa,QAAQ;QAClC,EAAE,OAAO,GAAG;YACR,IAAI,CAAC,QAAQ;QACjB;QACA,OAAO;IACX;IAEA,OAAO,QAAS,GAAW,EAAE,KAAa,EAAQ;QAC9C,IAAI;YACA,aAAa,QAAQ,KAAK;QAC9B,EAAE,OAAO,GAAG;YACR,IAAI,CAAC,QAAQ;QACjB;IACJ;IAEA,OAAO,WAAY,GAAW,EAAQ;QAClC,IAAI;YACA,aAAa,WAAW;QAC5B,EAAE,OAAO,GAAG;YACR,IAAI,CAAC,QAAQ;QACjB;IACJ;IAEA,OAAO,WAAqB;QACxB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;AC/BA;;;;;;;;CAQC,GACD,uDAAa;AAfb;AAeO,MAAM;IAIT,mBAAmB;IAEnB,YAAa,IAAyC,EAAE;QACpD,IAAI,CAAC,WAAW;IACpB;IAEA,QAAS,KAAoB,EAAwB;QACjD,IAAI,MAAM,SAAS,eAAe;YAE9B,IAAI,MAAM,gBAAgB,MAAM,aAAa,SAAS,GAClD,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,aAAa,QAAQ,IAAK;gBAChD,MAAM,YAAoC,CAAA,GAAA,aAAM,EAAE;gBAClD,IAAI,MAAM,GACN,UAAU,eAAe,EAAE;gBAE/B,MAAM,gBAAgB,MAAM,YAAY,CAAC,EAAE;gBAE3C,UAAU,QAAQ,cAAc;gBAChC,UAAU,QAAQ,cAAc;gBAChC,UAAU,OAAO,cAAc;gBAC/B,UAAU,OAAO,cAAc;gBAC/B,UAAU,KAAK,cAAc;gBAC7B,UAAU,KAAK,cAAc;gBAC7B,UAAU,OAAO,cAAc;gBAC/B,IAAI,IAAI,MAAM,aAAa,SAAS,GAChC,UAAU,cAAc;gBAG5B,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS;YACnC;iBAGA,OAAO;QAEf,OACI,OAAO;QAGX,OAAO;IACX;AAEJ;;;;;AC1DA;;;;;CAKC,GACD,mDAAa;AATb;AASO,MAAM;IA8BD,cAAqB;QACzB,IAAI,IAAI,CAAC,cAAc,WAAW,GAC9B;QAEJ,IAAI,CAAC,WAAW,wBAAwB,aAAa,IAAI,CAAC,WAAW;QACrE,IAAI,CAAC,WAAW,cAAc,aAAa,IAAI,CAAC,WAAW;QAC3D,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,QAAQ,IAC3C,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC,aAAa,CAAC,EAAE;QAExD,IAAI,CAAC,gBAAgB,EAAE;QACvB,IAAI,CAAC,YAAY,EAAE;IACvB;IAEQ,UAAiB;QACrB,IAAI,CAAC,WAAW,wBAAwB,aAAa,IAAI,CAAC,WAAW;QACrE,IAAI,CAAC,WAAW,cAAc,aAAa,IAAI,CAAC,WAAW;QAC3D,IAAI,CAAC,gBAAgB,EAAE,EAAE,uBAAuB;QAChD,IAAI,CAAC,YAAY,EAAE;QACnB,IAAI,CAAC;IACT;IAEQ,aAAc,UAAiD,EAAE,MAAc,EAAW;QAC9F,MAAM,OAAO,SAAS,IAAI,CAAC;QAC3B,2DAA2D;QAC3D,IAAI,QAAQ,GACR,OAAO;QAEX,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,WAAW,IAAM,IAAI,CAAC,eAAe;QACnE,OAAO;IACX;IAEQ,aAAc,KAAoB,EAAe;QAErD,MAAM,oBAAoB,IAAI,CAAC;QAC/B,IAAI,CAAC,gBAAgB,MAAM;QAE3B,IAAI,MAAM,SAAS,eACf,IAAI,CAAC,kBAAkB,KAAK,MAAM;aAC/B,IAAI,MAAM,SAAS,aAAa;YACnC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,kBAAkB,QAAQ,IAC/C,IAAI,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,MAAM,WAAW;gBAC/C,IAAI,CAAC,kBAAkB,OAAO,GAAG;gBACjC;YACJ;QAER;QAEA,IAAI,MAAM,gBAAgB,SAAS;YAC/B,IAAI,IAAI,CAAC,UAAU,SAAS,GACxB,IAAI,CAAC;YAET;QACJ;QAEA,IAAI,CAAC,UAAU,YAAY;QAE3B,IAAI,MAAM,SAAS,eAAe;YAC9B,sBAAsB;YACtB,IAAI,IAAI,CAAC,UAAU,SAAS,MAAM,IAAI,CAAC,kBAAkB,QAAQ;gBAC7D,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,SAAS;gBACxC,2DAA2D;gBAC3D,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,IAAI,CAAC,UAAU,SAAS,KAAK,MAAM,OAAO,IAAI,CAAC,2BAA2B,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,YAAY;gBACxG,6EAA6E;gBAC7E,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,IAAI,CAAC,UAAU,WAAW,KAAK,MAAM,OAAO,IAAI,CAAC,6BAA6B,mBAAmB;gBACjG,+DAA+D;gBAC/D,IAAI,CAAC;gBACL;YACJ;YAEA,IAAI,IAAI,CAAC,UAAU,WAAW,GAAG;gBAC7B,IAAI,CAAC,gBAAgB,MAAM;gBAE3B,IAAI,CAAC,IAAI,CAAC,aAAa,wBAAwB,MAAM,OAAO,IAAI,CAAC,6BAA6B,CAAC,IAAI,CAAC,aAAa,cAAc,MAAM,OAAO,IAAI,CAAC,WAAW;oBACxJ,IAAI,CAAC;oBACL;gBACJ;YAEJ;YACA,IAAI,CAAC,UAAU,KAAK;gBAChB,WAAW,MAAM;gBACjB,YAAY,MAAM;gBAClB,WAAW,MAAM;gBACjB,WAAW,MAAM;YACrB;YACA;QAEJ;QAEA,IAAI,MAAM,SAAS,eAAe;YAE9B,IAAI,IAAI,CAAC,UAAU,WAAW,GAC1B,4BAA4B;YAC5B;YAGJ,IAAI,YAAY;YAChB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,cAAc,MAAM,WAAW;gBACjD,YAAY,IAAI,CAAC,SAAS,CAAC,EAAE;gBAC7B;YACJ;YAEJ,IAAI,cAAc,MAAM;gBACpB,IAAI,CAAC;gBACL;YACJ;YAEA,IAAI,MAAM,OAAO,IAAI,CAAC,WAAW,IAAI,CAAC,eAAe;gBACjD,uDAAuD;gBACvD,IAAI,CAAC;gBACL;YACJ;YAEA,MAAM,WAAW,CAAA,GAAA,UAAG,EAAE,MAAM,OAAO,MAAM,OAAO,UAAU,WAAW,UAAU;YAC/E,IAAI,WAAW,IAAI,CAAC,sBAAsB;gBACtC,uEAAuE;gBACvE,IAAI,CAAC;gBACL;YACJ;QAEJ;QAEA,IAAI,MAAM,SAAS,aAAa;YAE5B,IAAI,IAAI,CAAC,UAAU,WAAW,GAC1B,4BAA4B;YAC5B;YAGJ,8CAA8C;YAC9C,IAAI,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,SAAS;gBACxC,wDAAwD;gBACxD,IAAI,CAAC;gBACL;YACJ;YAEA,IAAI,YAAY;YAChB,IAAI,IAAI;YACR,MAAO,IAAI,IAAI,CAAC,UAAU,QAAQ,IAC9B,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,cAAc,MAAM,WAAW;gBACjD,YAAY,IAAI,CAAC,SAAS,CAAC,EAAE;gBAC7B;YACJ;YAEJ,IAAI,cAAc,MACd,YAAY;YACZ;YAGJ,IAAI,MAAM,OAAO,IAAI,CAAC,WAAW,IAAI,CAAC,eAAe;gBACjD,uDAAuD;gBACvD,IAAI,CAAC;gBACL;YACJ;YAEA,MAAM,WAAW,CAAA,GAAA,UAAG,EAAE,MAAM,OAAO,MAAM,OAAO,UAAU,WAAW,UAAU;YAC/E,IAAI,WAAW,IAAI,CAAC,sBAAsB;gBACtC,iGAAiG;gBACjG,yBAAyB;gBACzB,IAAI,CAAC;gBACL;YACJ;YAEA,UAAU,OAAO;YAEjB,IAAI,WAAW;YACf,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM;gBACzB,WAAW;gBACX;YACJ;YAEJ,sCAAsC;YAEtC,IAAI,UAAU;gBACV,IAAI,CAAC;gBACL,OAAO;YACX;QAEJ;IAGJ;IAEA,mBAAmB;IACnB,YACI,CAGC,CACH;aAnOe,6BAA6B;aAC7B,WAAW;aACX,2BAA2B;aAC3B,uBAAuB,GAAI,kBAAkB;;aAGtD,YAMF,EAAE;aACA,gBAAiC,EAAE;aACnC,gBAAwB;aACxB,gBAAwB;aACxB,UAAkB,YAAY;aACrB,oBAA8B,EAAE;aAGhC,aAGb;YACA,sBAAsB;YACtB,YAAY;QAChB;QA0MI,IAAI,CAAC,UAAU,EAAE;QACjB,IAAI,CAAC,QAAQ,EAAE;IACnB;IAGA,QAAS,KAAoB,EAA0B;QAEnD,MAAM,SAAS,IAAI,CAAC,aAAa;QAEjC,gCAAgC;QAEhC,IAAI,WAAW,MACX,qCAAqC;QACrC,OAAO;QAEX,IAAI,IAAI,CAAC,UAAU,WAAW,GAC1B,OAAO;aAEP,IAAI,CAAC,cAAc,KAAK;QAG5B,OAAO;IAEX;IAEA,YAAa,IAAgC,EAAQ;QACjD,IAAI,CAAC,WAAW;IACpB;AAGJ;;;;;AChPA;;;;;;;;CAQC,GACD,iDAAa;AAtCb;AAsCO,MAAM;IA0BD,MAAa;QACjB,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,gBAAgB,EAAE;IAC3B;IAEQ,KAAM,SAAmB,EAAQ;QACrC,IAAI,CAAC,IAAI,CAAC,YACN;QAGJ,IAAI,CAAC,WAAW,uBAAuB,aAAa,IAAI,CAAC,WAAW;QACpE,IAAI,CAAC,WACD,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,QAAQ,IAC3C,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC,aAAa,CAAC,EAAE;QAG5D,IAAI,CAAC;IACT;IAEQ,iBAAkB,MAAc,EAAW;QAC/C,MAAM,OAAO,SAAS,IAAI,CAAC;QAC3B,IAAI,QAAQ,GACR,OAAO;QAEX,IAAI,CAAC,WAAW,sBAAsB,WAAW,IAAM,IAAI,CAAC,QAAQ;QACpE,OAAO;IACX;IAEQ,aAAc,KAAoB,EAAQ;QAE9C,IAAI,MAAM,SAAS,eACf,IAAI,CAAC,kBAAkB,KAAK,MAAM;aAE/B,IAAI,MAAM,SAAS,aAAa;YACnC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,kBAAkB,QAAQ,IAC/C,IAAI,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,MAAM,WAAW;gBAC/C,IAAI,CAAC,kBAAkB,OAAO,GAAG;gBACjC;YACJ;QAER;QAEA,wBAAwB;QACxB,IACI,CAAC,IAAI,CAAC,cACF,CAAA,MAAM,gBAAgB,WAAW,qBAAqB;QACrD,MAAM,SAAS,iBAAiB,IAAI,CAAC,kBAAkB,SAAS,KAAM,gBAAgB;QACvF,IAAI,CAAC,kBAAkB,SAAS,KAAK,gBAAgB;QACrD,MAAM,SAAS,YAAY,gBAAgB;QAAlB,GAG7B;QAGJ,IAAI,CAAC,UAAU,YAAY;QAG3B,cAAc;QACd,IAAI,MAAM,SAAS;YAEf,IAAI,IAAI,CAAC;gBACL,IAAI,MAAM,gBAAgB,SAAS;oBAE/B,IAAI,CAAC,WAAW,gBAAgB,KAAK;wBACjC,WAAW,MAAM;wBACjB,MAAM,MAAM;wBACZ,MAAM,MAAM;oBAChB;oBAEA,IAAI,IAAI,CAAC,WAAW,cAChB,IAAI,CAAC,cAAc,IAAI,CAAC,YAAY;wBAChC,MAAM;wBACN,OAAO,IAAI,CAAC,WAAW,gBAAgB,SAAS;oBACpD;yBACG;wBACH,IAAI,CAAC,WAAW,uBAAuB,aAAa,IAAI,CAAC,WAAW;wBACpE,IAAI,CAAC,WAAW,eAAe;wBAC/B,IAAI,CAAC,WAAW,IAAI,CAAC;oBACzB;oBACA;gBAEJ,OAAO;oBAEH,IAAI,IAAI,CAAC,WAAW,cAChB,IAAI,CAAC,WAAW,kBAAkB,KAAK,MAAM;yBAE7C,IAAI,CAAC;oBAET;gBACJ;mBAGG;gBACH,yDAAyD;gBACzD,IAAI,CAAC,aAAa;oBACd,iBAAiB;wBAAC;4BACd,WAAW,MAAM;4BACjB,MAAM,MAAM;4BACZ,MAAM,MAAM;4BACZ,UAAU,MAAM;4BAChB,UAAU,MAAM;wBACpB;qBAAE;oBACF,mBAAmB,EAAE;oBACrB,cAAc;gBAClB;gBACA,IAAI,CAAC,IAAI,CAAC,iBAAiB,MAAM,OAAO,IAAI,CAAC,8BAA8B;oBACvE,IAAI,CAAC;oBACL;gBACJ;gBACA;YACJ;;QAIJ,0CAA0C;QAC1C,IAAI,CAAC,IAAI,CAAC,YAAY;YAClB,mCAAmC;YACnC,IAAI,CAAC;YACL;QACJ;QAEA,cAAc;QACd,IAAI,MAAM,SAAS,iBAAiB,MAAM,gBAAgB,SAAS;YAC/D,yCAAyC;YAEzC,IAAI,kBAAwC;YAC5C,IAAI,IAAI;YACR,MAAO,IAAI,IAAI,CAAC,WAAW,gBAAgB,QAAQ,IAC/C,IAAI,MAAM,cAAc,IAAI,CAAC,WAAW,eAAe,CAAC,EAAE,CAAC,WAAW;gBAClE,kBAAkB,IAAI,CAAC,WAAW,eAAe,CAAC,EAAE;gBACpD;YACJ;YAGJ,mDAAmD;YACnD,IAAI,CAAC,iBAAiB;gBAClB,mCAAmC;gBACnC,IAAI,CAAC;gBACL;YACJ;YAEA,gBAAgB,OAAO,MAAM;YAC7B,gBAAgB,OAAO,MAAM;YAE7B,IAAI,CAAC,IAAI,CAAC,WAAW,cAAc;gBAE/B,0CAA0C;gBAC1C,IACI,CAAE,CAAA,cAAc,mBAAmB,gBAAgB,aAAa,SAAQ,KACxE,CAAE,CAAA,cAAc,mBAAmB,gBAAgB,aAAa,SAAQ,GAC1E;oBACE,IAAI,CAAC;oBACL;gBACJ;gBAEA,MAAM,WAAW,CAAA,GAAA,UAAG,EAAE,gBAAgB,UAAU,gBAAgB,UAAU,gBAAgB,MAAM,gBAAgB;gBAChH,IAAI,WAAW,IAAI,CAAC,0BAA0B;oBAC1C,IAAI,CAAC;oBACL;gBACJ;YAEJ,OACI,IAAI,IAAI,GACJ,IAAI,CAAC,cAAc,IAAI,CAAC,YAAY;gBAChC,MAAM;gBACN,OAAO;YACX;YAIR;QACJ;QAGA,YAAY;QACZ,IAAI,MAAM,SAAS,aAAa;YAC5B,yCAAyC;YAEzC,IAAI,MAAM,gBAAgB,SAAS;gBAC/B,IAAI,IAAI;gBACR,MAAO,IAAI,IAAI,CAAC,WAAW,gBAAgB,QAAQ,IAC/C,IAAI,IAAI,CAAC,WAAW,eAAe,CAAC,EAAE,CAAC,cAAc,MAAM,WAAW;oBAClE,IAAI,CAAC,WAAW,gBAAgB,OAAO,GAAG;oBAC1C;gBACJ;gBAEJ,IAAI,IAAI,CAAC,WAAW,gBAAgB,SAAS,GACzC,IAAI,CAAC,cAAc,IAAI,CAAC,YAAY;oBAChC,MAAM;oBACN,OAAO;gBACX;YAGR,OAAO;gBACH,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,kBAAkB,QAAQ,IAC1D,IAAI,IAAI,CAAC,WAAW,iBAAiB,CAAC,EAAE,KAAK,MAAM,WAAW;oBAC1D,IAAI,CAAC,WAAW,kBAAkB,OAAO,GAAG;oBAC5C;gBACJ;YAER;YAEA,qBAAqB;YACrB,IAAI,IAAI,CAAC,WAAW,gBAAgB,WAAW,KAAK,IAAI,CAAC,WAAW,kBAAkB,WAAW,GAAG;gBAChG,IAAI,IAAI,CAAC,WAAW,cAAc;oBAC9B,IAAI,CAAC;oBACL,IAAI,CAAC;gBACT,OACI,IAAI,CAAC;gBAET;YACJ;QAEJ;IAGJ;IAEQ,WAAY,UAAyB,EAAQ;QAEjD,IAAK,IAAI,IAAI,GAAG,IAAI,WAAW,gBAAgB,QAAQ,IAAK;YACxD,MAAM,aAAa,WAAW,eAAe,CAAC,EAAE;YAChD,IAAI,CAAC,WAAW,KAAK;gBACjB,WAAW,WAAW;gBACtB,MAAM,WAAW;gBACjB,MAAM,WAAW;gBACjB,UAAU,WAAW;gBACrB,UAAU,WAAW;YACzB;QACJ;QAEA,MAAM,QAA2B;YAC7B,MAAM;YAEN,OAAO;YACP,UAAU;YACV,UAAU;YACV,MAAM;YACN,MAAM;YAEN,UAAU;YACV,OAAO;QACX;QAEA,IAAI,IAAI,CAAC,WAAW,WAAW,GAAG;YAC9B,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;YAChC,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;QACpC,OAAO;YACH,MAAM,OAAO,MAAO,CAAA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAO;YAC5E,MAAM,OAAO,MAAO,CAAA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAO;QAChF;QACA,MAAM,WAAW,MAAM;QACvB,MAAM,WAAW,MAAM;QAEvB,IAAI,CAAC,QAAQ;IAEjB;IAEA,uDAAuD;IAC/C,cACJ,UAAyB,EACzB,SAGC,EACG;QAEJ,IAAI,UAAU,QAAQ,GAClB;QAGJ,IAAI,UAAU,SAAS,QAAQ;YAE3B,IAAI;YACJ,IAAI,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,OAAO,WAAW,eAAe,CAAC,UAAU,MAAM,CAAC;YACpF,IAAI,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,OAAO,WAAW,eAAe,CAAC,UAAU,MAAM,CAAC;YAEpF,IAAI,IAAI,CAAC,WAAW,WAAW,GAE3B,QAAQ;gBACJ,MAAM;gBACN,UAAU,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC7B,UAAU,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC7B,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBACzB,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBACzB,UAAU;gBACV,OAAO;YACX;iBAEG;gBAEH,MAAM,YAAY,CAAA,GAAA,UAAG,EAAE,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBACjI,MAAM,WAAW,CAAA,GAAA,UAAG,EAAE,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAEpH,MAAM,aAAa,CAAA,GAAA,sBAAe,EAAE;oBAChC,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;oBACtB,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC1B,GAAG;oBAAC,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;oBAAU,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAAQ;gBAClE,MAAM,QAAQ,CAAA,GAAA,sBAAe,EAAE;oBAC3B,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;oBACtB,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC1B,GAAG;oBAAC,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;oBAAM,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAAI;gBAE1D,QAAQ;oBACJ,MAAM;oBACN,UAAU,MAAO,CAAA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAO;oBACzE,UAAU,MAAO,CAAA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAO;oBACzE,MAAM,MAAO,CAAA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAG;oBAC7D,MAAM,MAAO,CAAA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAG;oBAC7D,UAAU,QAAQ;oBAClB,OAAO,WAAW;gBACtB;YAEJ;YAEA,IAAI,CAAC,QAAQ;QAEjB,OAAO,IAAI,UAAU,SAAS,UAAU,UAAU,SAAS,MAAM;YAC7D,IAAI,CAAC;YACL,IAAI,CAAC,WAAW;QACpB;IAEJ;IAEQ,WAAkB;QACtB,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,CAAC,QAAQ;YACT,MAAM;QACV;IACJ;IAGA,mBAAmB;IACnB,YACI,CAEC,CACH;aAzWe,2BAA2B;aAC3B,8BAA8B;aAI9B,oBAA8B,EAAE;aACzC,aAAmC;aACnC,gBAAiC,EAAE;aACnC,UAAkB,YAAY;aACrB,aAEb;YACA,qBAAqB;QACzB;aACQ,aAMF,EAAE;QAsVJ,IAAI,CAAC,UAAU,EAAE;IACrB;IAEA,QAAS,KAAoB,EAAwB;QACjD,IAAI,CAAC,aAAa;QAClB,IAAI,IAAI,CAAC,YACL;YAAA,IAAI,CAAC,IAAI,CAAC,WAAW,cACjB,IAAI,CAAC,cAAc,KAAK;QAC5B,OAEA,OAAO;QAEX,OAAO;IACX;IAEA,YAAa,IAAgC,EAAQ;QACjD,IAAI,CAAC,WAAW;IACpB;AAEJ;;;;;ACvZA;;;;;CAKC,GACD,kDAAa;AAnBb;AAmBO,MAAM;IA6CT,sBAAsB;IACd,UAAiB;QACrB,IAAI,CAAC,WAAW,OAAO;QACvB,IAAI,CAAC,WAAW,UAAU;QAC1B,IAAI,CAAC,gBAAgB,EAAE,EAAE,uBAAuB;QAChD,MAAM,mBAAmB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,SAAS,EAAE;QACtE,IAAI,CAAC,cAAc,EAAE;QACrB,IAAI,WAAW,kBACX,IAAI,CAAC,YAAY;YACb,OAAO,iBAAiB;YACxB,OAAO,iBAAiB;YACxB,MAAM,iBAAiB;YACvB,MAAM,iBAAiB;QAC3B;IAER;IAEA,8DAA8D;IACtD,aACJ,UAAoC,EACpC,UAAsB,EACtB,MAAc,EACd,YAAsB,EACf;QACP,MAAM,OAAO,SAAS,IAAI,CAAC;QAC3B,4DAA4D;QAC5D,IAAI,QAAQ,KAAK,CAAC,cACd,OAAO;QAEX,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,WAAW,YAAY,KAAK,IAAI,GAAG;QACjE,OAAO;IACX;IAEA;;KAEC,GACD,AAAQ,aAAc,KAAoB,EAAQ;QAE9C,IAAI,MAAM,SAAS,eACf,IAAI,CAAC,kBAAkB,KAAK,MAAM;aAC/B,IAAI,MAAM,SAAS,aAAa;YACnC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,kBAAkB,QAAQ,IAC/C,IAAI,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,MAAM,WAAW;gBAC/C,IAAI,CAAC,kBAAkB,OAAO,GAAG;gBACjC;YACJ;QAER;QAEA,IAAI,CAAC,IAAI,CAAC,sBAAsB,SAAS,MAAM,cAAc;YACzD,0CAA0C;YAC1C,IAAI,CAAC;YACL;QACJ;QAEA,IAAI,CAAC,UAAU,YAAY;QAC3B,MAAM,mBAAmB,IAAI,CAAC,YAAY,SAAS,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,SAAS,EAAE,GAAG;QACvG,IAAI,MAAM,SAAS,aACf,IAAI,CAAC,aAAa,MAAM;QAG5B,IAAI,MAAM,SAAS,eAAe;YAC9B,IAAI,IAAI,CAAC,kBAAkB,SAAS,GAAG;gBACnC,oDAAoD;gBACpD,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,IAAI,CAAC,WAAW,YAAY,MAAM;gBAClC,oDAAoD;gBACpD,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,IAAI,CAAC,YAAY,WAAW,KAAK,IAAI,CAAC,UAAU,IAAI,CAAC,aAAa,IAAI,CAAC,4BAA4B;gBACnG,qDAAqD;gBACrD,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,MAAM,UAAU,CAAC,IAAI,CAAC,iBAAiB,SAAS,MAAM,SAAS;gBAC/D,sEAAsE;gBACtE,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,AAAC,oBAAoB,YAAY,oBAAoB,iBAAiB,UAAW,IAAI,CAAC,YAAY,SAAS,GAAG;gBAC9G,iCAAiC;gBACjC,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,oBAAoB,cAAc,kBAAkB;gBACpD,MAAM,WAAW,CAAA,GAAA,UAAG,EAAE,iBAAiB,QAAQ,CAAC,EAAE,EAAE,iBAAiB,QAAQ,CAAC,EAAE,EAAE,MAAM,OAAO,MAAM;gBACrG,IAAI,WAAW,IAAI,CAAC,wBAAwB;oBACxC,iDAAiD;oBACjD,IAAI,CAAC;oBAGL,IAAI,UAAU,oBAAoB,IAAI,CAAC,UAAU,iBAAiB,OAAO,IAAI,CAAC,4BAC1E;gBAER;YACJ;YACA,IAAI,CAAC,YAAY,KAAK;gBAClB,QAAQ;gBACR,MAAM,IAAI,CAAC;gBACX,UAAU;oBAAC,MAAM;oBAAO,MAAM;iBAAM;gBACpC,WAAW,MAAM;YACrB;YACA,oBAAoB;YAEpB,IAAI,IAAI,CAAC,YAAY,SAAS,GAC1B,IAAI,CAAC,WAAW,sBAAsB,aAAa,IAAI,CAAC,WAAW;iBAChE,IAAI,CAAC,IAAI,CAAC,aAAa,sBAAsB,IAAM,IAAI,CAAC,iBAAiB,MAAM,OAAO,IAAI,CAAC,+BAA+B;gBAC7H,2DAA2D;gBAC3D,IAAI,CAAC;gBACL;YACJ;YAGA,IAAI,CAAC,WAAW,QAAQ,aAAa,IAAI,CAAC,WAAW;YACrD,IAAI,CAAC,IAAI,CAAC,aAAa,QAAQ,IAAM,IAAI,CAAC,iBAAiB,MAAM,OAAO,IAAI,CAAC,uBAAuB;gBAChG,2DAA2D;gBAC3D,IAAI,CAAC;gBACL;YACJ;QACJ;QACA,IAAI,oBAAoB,MAAM,SAAS,iBAAiB,eAAe,oBAAoB,iBAAiB,cAAc,MAAM,WAAW;YACvI;;;;aAIC,GACD,MAAM,WAAW,CAAA,GAAA,UAAG,EAAE,iBAAiB,QAAQ,CAAC,EAAE,EAAE,iBAAiB,QAAQ,CAAC,EAAE,EAAE,MAAM,OAAO,MAAM;YACrG,IAAI,WAAW,IAAI,CAAC,sBAAsB;gBACtC,8CAA8C;gBAC9C,IAAI,CAAC;gBACL;YACJ;QACJ;QACA,IAAI,oBAAoB,MAAM,SAAS,aAAa;YAChD,IAAI,eAAe,oBAAoB,iBAAiB,cAAc,MAAM,WAAW;gBACnF,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,UAAU,oBAAoB,IAAI,CAAC,WAAW,iBAAiB,OAAO,IAAI,CAAC,sBAAsB;gBACjG,IAAI,CAAC;gBACL;YACJ;YACA,IAAI,CAAC,WAAW,QAAQ,aAAa,IAAI,CAAC,WAAW;YAErD,IAAI,IAAI,CAAC,YAAY,SAAS,GAAG;gBAC7B,IAAI,CAAC,IAAI,CAAC,aAAa,QAAQ,IAAM,IAAI,CAAC,iBAAiB,MAAM,OAAO,IAAI,CAAC,sBAAsB;oBAC/F,IAAI,CAAC;oBACL;gBACJ;gBAEA,IAAI,CAAC,cAAc;oBACf;oBACA;wBACI,MAAM;wBACN,MAAM,IAAI,CAAC;wBACX,UAAU;4BAAC,MAAM;4BAAO,MAAM;yBAAM;oBACxC;iBACH;gBACD;YACJ;YAEA,IAAI,UAAU,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,qBAAqB;gBACrG,4BAA4B;gBAC5B,qBAAqB;gBACrB,IAAI,CAAC,YAAY,KAAK;oBAClB,OAAO,MAAM;oBACb,OAAO,MAAM;oBACb,MAAM,MAAM;oBACZ,MAAM,MAAM;gBAChB;gBACA,IACI,CAAC,IAAI,CAAC,aACF,WACA,IAAM,IAAI,CAAC,WACX,MAAM,OAAO,IAAI,CAAC,mBAClB,OAGJ,IAAI,CAAC;YAEb,OACI,IAAI,CAAC;QAGb;IACJ;IAGA,mBAAmB;IACnB,YACI,CAGC,CACH;aA9OM,wBAAwC;YAAC;YAAS;YAAS;SAAM;aACjE,mBAAqC;YAAC;SAAO;aAC7C,6BAAqC;aACrC,uBAA+B;aAC/B,uBAA+B;aAC/B,yBAAiC;aACjC,sBAA8B;aAC9B,+BAAuC;aACvC,oBAA4B;aAC5B,cAkBE,EAAE;aACJ,oBAA8B,EAAE;aAChC,aAAqB;aACrB,UAAkB;aAClB,gBAAiC,EAAE;aACnC,aAEJ;YACA,MAAM;YACN,oBAAoB;YACpB,SAAS;QACb;QAyMI,IAAI,CAAC,cAAc,EAAE;QACrB,IAAI,EAAE,WAAW;YACb,IAAI,CAAC,6BAA6B;YAClC,IAAI,CAAC,oBAAoB;QAC7B;QACA,IAAI,CAAC,gBAAgB;YACjB,IAAI,IAAI,CAAC,YAAY,WAAW,GAC5B;YAEJ,IAAI,CAAC,WAAW,QAAQ,aAAa,IAAI,CAAC,WAAW;YACrD,IAAI,CAAC,WAAW,sBAAsB,aAAa,IAAI,CAAC,WAAW;YACnE,IAAI,CAAC,WAAW,WAAW,aAAa,IAAI,CAAC,WAAW;YACxD,IAAI,CAAC,WAAW,OAAO;YACvB,IAAI,CAAC,WAAW,qBAAqB;YACrC,IAAI,CAAC,WAAW,UAAU;YAE1B,IAAI,IAAI,CAAC,UACL,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,QAAQ,IAC3C,IAAI,CAAC,SAAS,IAAI,CAAC,aAAa,CAAC,EAAE;YAI3C,IAAI,CAAC,gBAAgB,EAAE;YACvB,IAAI,CAAC,cAAc,EAAE;QACzB;IACJ;IAEA,QAAS,KAAoB,EAAwB;QAEjD,IAAI,CAAC,aAAa;QAElB,IAAI,IAAI,CAAC,YAAY,WAAW,GAAG;YAC/B,IAAI,CAAC;YACL,OAAO;QACX;QACA,4CAA4C;QAC5C,IAAI,CAAC,cAAc,KAAK;QACxB,OAAO;IACX;IAEA,YAAa,IAAmB,EAAQ;QACpC,IAAI,CAAC,WAAW;IACpB;IAEA,yBAA0B,GAAmB,EAAQ;QACjD,IAAI,CAAC,wBAAwB;eAAI;SAAI;IACzC;IAEA,oBAAqB,GAAqB,EAAQ;QAC9C,IAAI,CAAC,mBAAmB;eAAI;SAAI;IACpC;AAEJ;;;;;ACxTA;;;;;CAKC,GACD,uDAAa;AAAN,MAAM;IAMT,mBAAmB;IACnB,QAAS,KAAoB,EAAwB;QAEjD,IAAI,IAAI,CAAC,mBAAmB,SAAS,MAAM,YAAY;YACnD,IAAI,MAAM,SAAS,aAAa;gBAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,mBAAmB,QAAQ,IAChD,IAAI,IAAI,CAAC,kBAAkB,CAAC,EAAE,KAAK,MAAM,WAAW;oBAChD,IAAI,CAAC,mBAAmB,OAAO,GAAG;oBAClC;gBACJ;YAER;YACA,OAAO;QACX;QAEA,IAAI,IAAI,CAAC,kBAAkB,MAAM;YAC7B,IAAI,MAAM,SAAS,eACf,IAAI,CAAC,gBAAgB,MAAM;YAE/B,OAAO;QAEX,OAAO;YACH,IAAI,MAAM,cAAc,IAAI,CAAC,eAAe;gBACxC,IAAI,MAAM,SAAS,eACf,IAAI,CAAC,mBAAmB,KAAK,MAAM;gBAEvC,OAAO;YACX;YACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC,gBAAgB;YAEzB,OAAO;QACX;IACJ;IAEA,YAAa,IAAmB,EAAQ;QACpC,IAAI,CAAC,WAAW;IACpB;;aAxCQ,gBAA+B;aACtB,qBAA+B,EAAE;;AAwCtD;;;;;AClDA;;;CAGC,GACD,gDAAa;AAAN,MAAM;IAID,cAAe,CAAS,EAAE,KAAoB,EAAQ;QAC1D,MAAO,IAAI,IAAI,CAAC,SAAS,QAAQ,IAAK;YAClC,QAAQ,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ;YACjC,IAAI,UAAU,MACV,OAAO;QAEf;QACA,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS;QAC/B,OAAO;IACX;IAEA,mBAAmB;IACnB,YACI,CAEC,CACH;QACE,IAAI,CAAC,WAAW,EAAE;QAElB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,QAAQ,IACtC,AAAE,CAAA,CAAC;YACC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,YAAY,CAAC;gBAC1B,IAAI,CAAC,cAAc,IAAI,GAAG;YAC9B;QACJ,CAAA,EAAG;IAGX;IAEA;;KAEC,GACD,QAAS,KAAoB,EAAQ;QACjC,OAAO,IAAI,CAAC,cAAc,GAAG;IACjC;IAEA;;KAEC,GACD,YAAa,IAAmB,EAAQ;QACpC,IAAI,CAAC,WAAW;IACpB;AAEJ;;;;;qDCpDa;AAqEb,iDAAgB;qDAwCH;0CAEA;8CAaA;AA9Hb;AAEO,MAAM,kBAAkB;AAE/B,MAAM;IAKF,kBAAkB;IAClB,aAAe;aAJP,YAA4B,EAAE;QAKlC,mDAAmD;QACnD,IAAI,CAAC,OAAO;YAAC,GAAG,CAAA,GAAA,kBAAM,CAAC;QAAA;QACvB,IAAI,CAAC,OAAO;IAChB;IAEA,MAAM,YAAa,QAAgB,EAAiB;QAChD,IAAI,aAAa,MACb,IAAI,CAAC,OAAO;YAAC,GAAG,CAAA,GAAA,kBAAM,CAAC;QAAA;aAEvB,IAAI,CAAC,OAAO;YAAC,GAAG,CAAA,GAAA,kBAAM,CAAC;YAAE,GAAI,MAAM,CAAA,GAAA,uBAAW,EAAE,SAAS;QAAC;QAE9D,IAAI,CAAC,OAAO;QACZ,SAAS,gBAAgB,aAAa,QAAQ;QAC9C,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB;QACJ;IACJ;IAEA,IAAK,IAAsB,EAAU;QACjC,IAAI,CAAE,CAAA,QAAQ,IAAI,CAAC,IAAG,GAClB,MAAM,IAAI,MAAM,qCAAqC;QAEzD,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK;IAC1B;IAEA,cAA6C;QACzC,OAAO,CAAA,GAAA,oBAAQ,EAAE,KAAK,CAAA;YAClB,OAAO,KAAK,SAAS,IAAI,CAAC;QAC9B;IACJ;IAEA,kBAAiD;QAC7C,MAAM,WAAW,YAAY;QAC7B,OAAO,CAAA,GAAA,oBAAQ,EAAE,KAAK,CAAA;YAClB,OAAO,KAAK,SAAS;QACzB;IACJ;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,kCAAkC;IAClC,UAAW,UAAsB,EAAE;QAC/B,IAAI,IAAI,CAAC,UAAU,SAAS,aACxB;QAEJ,IAAI,CAAC,UAAU,KAAK;IACxB;IAEA,YAAa,UAAsB,EAAE;QACjC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,eAAe,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE;YAClC,IAAI,CAAC,UAAU,OAAO,GAAG;YACzB;QACJ;IAER;AACJ;AAEO,SAAS,YAAa,eAAyB;IAElD,IAAI,SAAiB;IAErB,MAAM,QAAkB,EAAE,EAAE,kCAAkC;IAC9D,MAAM,WAAW,UAAU,YAAY,UAAU,YAAY;QAAC,UAAU;KAAS;IACjF,SAAS,QAAQ,CAAA;QACb,MAAM,QAAQ,KAAK,MAAM;QACzB,MAAM,KAAK;QACX,IAAI,MAAM,WAAW,GACjB,MAAM,KAAK,KAAK,CAAC,EAAE;IAE3B;IAEA,IAAI,iBACA,IAAI;QACA,MAAM,OAAO,aAAa,QAAQ;QAClC,IAAI,MACA,MAAM,QAAQ;IAEtB,EAAE,OAAO,GAAG;IACR,oCAAoC;IACxC;IAEJ,QAAQ,IAAI;IACZ,QAAQ,IAAI,CAAA,GAAA,oBAAQ;IACpB,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,IAAK;QACnC,MAAM,OAAO,KAAK,CAAC,EAAE;QACrB,MAAM,QAAQ,CAAA,GAAA,oBAAQ,EAAE,KAAK,CAAA;YACzB,OAAO,KAAK,KAAK,kBAAkB,KAAK;QAC5C;QACA,IAAI,OAAO;YACP,SAAS,MAAM;YACf;QACJ;IACJ;IACA,OAAO;AACX;AAEA,MAAM,qBAAqB,YAAY;AAChC,MAAM,kBAAkB,IAAI;AAE5B,MAAM,OAAO,CAAC,MAAwB;IACzC,IAAI,SAAS;QACT,IAAI,SAAS,gBAAgB,IAAI;QACjC,MAAM,SAAS,OAAO,KAAK;QAC3B,OAAO,QAAQ,CAAA;YACX,SAAS,OAAO,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,OAAO,CAAC,IAAI;QACpD;QACA,OAAO;IACX,OACI,OAAO,gBAAgB,IAAI;AAEnC;AAEO,MAAM,WAAW,IAAM,gBAAgB,YAAY;;;AC9H1D,+DAA+D;;;6CAIlD;+CACA;kDAkDA;AArDb;;AAEO,MAAM,UAAU,CAAA,GAAA,sBAAK;AACrB,MAAM,YAA4C;IACrD;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;IACA;QACI,MAAM;QACN,MAAM;IACV;CACH;AACM,MAAM,eAAe,OAAO;IAC/B,IAAI,SAAS,MACT,OAAO;SACJ,IAAI,SAAS,MAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,SAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,SAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,SAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,MAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,MAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,MAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,MAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,MAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,SAChB,OAAO,MAAM,QAAO;SACjB,IAAI,SAAS,SAChB,OAAO,MAAM,QAAO;IAExB,MAAM,IAAI,MAAM;AACpB;CA0ViB,SAAS;;;AC5a1B,OAAO,UAAU,KAAK,MAAM;;;ACA5B,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,mBAAmB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACAvP;AAEA,IAAI,cAAc,QAAQ;AAC1B,OAAO,UAAU,YAAY,SAAU,MAAM;IAC3C,OAAO,IAAI,QAAQ,SAAU,OAAO,EAAE,MAAM;QAC1C,0EAA0E;QAC1E,IAAI,kBAAkB,SAAS,qBAAqB;QACpD,IAAI,EAAE,CAAC,OAAO,iBAAiB,KAAK,SAAS,gBAAgB,MAAM;YACjE,OAAO,OAAO,QAAQ;QACxB,IAAI;YACF;YACA;QACF;QACA,IAAI,cAAc,SAAS,cAAc;QACzC,YAAY,OAAO;QACnB,YAAY,MAAM;QAClB,YAAY,KAAK;QACjB,SAAS,KAAK,YAAY;QAC1B,IAAI,SAAS,SAAS,cAAc;QACpC,OAAO,QAAQ;QACf,OAAO,OAAO;QACd,OAAO,MAAM;QACb,OAAO,UAAU,SAAU,CAAC;YAC1B,IAAI,QAAQ,IAAI,UAAU,gDAAgD,OAAO,QAAQ,aAAa,OAAO,EAAE;YAC/G,OAAO,UAAU,OAAO,SAAS;YACjC,OAAO;YACP,OAAO;QACT;QACA,OAAO,SAAS;YACd,OAAO,UAAU,OAAO,SAAS;YACjC;QACF;QACA,SAAS,qBAAqB,OAAO,CAAC,EAAE,CAAC,YAAY;IACvD;AACF;;;AClCA;AAEA,IAAI,gBAAgB,CAAC;AACrB,IAAI,iBAAiB,CAAC;AACtB,IAAI,mBAAmB,CAAC;AACxB,SAAS,SAAS,IAAI;IACpB,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AACA,OAAO,UAAU,SAAU,MAAM,EAAE,IAAI;IACrC,OAAO,SAAU,MAAM;QACrB,IAAI,QAAQ,SAAS;QACrB,IAAI,KAAK,CAAC,OAAO,EACf,OAAO,KAAK,CAAC,OAAO;QAEtB,OAAO,KAAK,CAAC,OAAO,GAAG,OAAO,MAAM,MAAM,WAAW,MAAM,SAAU,CAAC;YACpE,OAAO,KAAK,CAAC,OAAO;YACpB,MAAM;QACR;IACF;AACF;;;AC1BA;AAEA,IAAI,YAAY,CAAC;AACjB,SAAS,mBAAmB,EAAE;IAC5B,IAAI,QAAQ,SAAS,CAAC,GAAG;IACzB,IAAI,CAAC,OAAO;QACV,QAAQ;QACR,SAAS,CAAC,GAAG,GAAG;IAClB;IACA,OAAO;AACT;AACA,SAAS;IACP,IAAI;QACF,MAAM,IAAI;IACZ,EAAE,OAAO,KAAK;QACZ,IAAI,UAAU,AAAC,CAAA,KAAK,IAAI,KAAI,EAAG,MAAM;QACrC,IAAI,SACF,2EAA2E;QAC3E,mEAAmE;QACnE,OAAO,WAAW,OAAO,CAAC,EAAE;IAEhC;IACA,OAAO;AACT;AACA,SAAS,WAAW,GAAG;IACrB,OAAO,AAAC,CAAA,KAAK,GAAE,EAAG,QAAQ,2EAA2E,QAAQ;AAC/G;AAEA,kFAAkF;AAClF,SAAS,UAAU,GAAG;IACpB,IAAI,UAAU,AAAC,CAAA,KAAK,GAAE,EAAG,MAAM;IAC/B,IAAI,CAAC,SACH,MAAM,IAAI,MAAM;IAElB,OAAO,OAAO,CAAC,EAAE;AACnB;AACA,QAAQ,eAAe;AACvB,QAAQ,aAAa;AACrB,QAAQ,YAAY;;;ACtCpB,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACA1P,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACA1P,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACA1P,OAAO,UAAU,QAAQ,QAAQ,OAAO,OAAO,KAAK;;;ACApD,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,mBAAmB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACAvP,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,mBAAmB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACAvP,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,mBAAmB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACAvP,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,mBAAmB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACAvP,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACA1P,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACA1P,OAAO,WAAW,CAAC;IACf,EAAE;AACN;;;ACFA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,wBAAwB,MAAM,KAAK;;;ACA5G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,uBAAuB,MAAM,KAAK;;;;;ACO3G;;;CAGC,GACD,kDAAa;AAVb;AACA;AACA;AACA;AACA;;AAMO,MAAM;IAWT,mBAAmB;IACnB,YACI,CAWC,CACH;QACE,CAAA,GAAA,yBAAY,EAAE;QACd,IAAI,CAAC,UAAU,EAAE;QACjB,IAAI,CAAC,SAAS,SAAS;QACvB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,QAAQ;gBACR,OAAO;gBACP,UAAU;gBACV,eAAe;gBACf,mBAAmB;gBACnB,yBAAyB;YAC7B;YACA,SAAS,CAAA,GAAA,MAAC,EAAE;QAChB;QAEA,uCAAuC;QACvC,IAAI,CAAC,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACd,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,QAAQ;gBACR,OAAO;YACX;YACA,SAAS,IAAM,IAAI,CAAC;QACxB;QAEA,sBAAsB;QACtB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,OAAQ,CAAA,GAAA,MAAC,EAAE,yBACP,4BAA6B,CAAA,EAAE,QAAQ,EAAE,QAAQ,GAAE,IAAK,QACxD,AAAC,CAAA,EAAE,QAAQ,EAAE,QAAQ,GAAE,IAAK;gBAChC,QAAQ;gBACR,cAAc;gBACd,UAAU;YACd;QACJ;QAEA,2DAA2D;QAC3D,IAAI,CAAC,YAAY;YACb,MAAM,MAAM,QAAQ;YACpB,MAAM,MAAM,QAAQ;YAEpB,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS;gBACZ,MAAM,KAAK,IAAI,GAAG,AAAC,CAAA,OAAO,aAAa,GAAE,IAAK,KAAK;gBACnD,KAAK,KAAK,IAAI,IAAI,AAAC,CAAA,OAAO,cAAc,GAAE,IAAK,IAAK,MAAM,QAAS;YACvE;QACJ;QAEA,IAAI,CAAC;QACL,OAAO,iBAAiB,UAAU,IAAI,CAAC;QAEvC,oBAAoB;QACpB,MAAM,cAAc;QACpB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ;YACR,KAAK;gBACD,QAAQ,cAAc;gBACtB,SAAS;gBACT,gBAAgB;gBAChB,YAAY;gBACZ,aAAa,AAAC,cAAc,IAAK;YACrC;QACJ;QACA,IAAI,EAAE,OACF,QAAQ,OAAO,EAAE;QAErB,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,QAAQ;YACR,SAAS;YACT,WAAW;YACX,SAAS,CAAC,UAAU,EAAE,CAAA,GAAA,cAAG,EAAE,eAAe,mBAAmB,EAAE,CAAA,GAAA,yBAAQ,EAAE,EAAE,CAAC;YAC5E,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS,IAAM,IAAI,CAAC;YACpB,KAAK;gBACD,OAAO,cAAc;gBACrB,QAAQ,cAAc;gBACtB,YAAY,cAAc;gBAC1B,YAAY;gBACZ,WAAW;YACf;YACA,QAAQ;gBACJ,UAAU;YACd;QACJ;QAEA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,QAAQ;YACR,KAAK;gBACD,QAAQ,iBAAiB,cAAc;YAC3C;QACJ;QACA,IAAI,EAAE,SACF,UAAU,OAAO,EAAE;QAGvB,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YAClC,QAAQ,CAAC,QAAQ;gBACb,IAAI,WAAW,OAAO;oBAClB,EAAE;oBACF,IAAI,CAAC;gBACT;YACJ;QACJ;IACJ;IAEA,sBAAsB;IACtB,QAAe;QACX,CAAA,GAAA,yBAAY,EAAE;QACd,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,IAAI,CAAC,OAAO;QACZ,OAAO,oBAAoB,UAAU,IAAI,CAAC;QAC1C,IAAI,CAAC,YAAY;QACjB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,IAAI,CAAC,WAAW,IAAI,CAAC;IACzB;AACJ;;;;;ACjKA;;CAEC,GACD,8CAAa;AANb;AAMO,MAAM;IAMT,iBAAiB;IAEjB,YAAa,MAQZ,CAAE;QACC,IAAI,CAAC,cAAc,CAAC,CAAC,OAAO;QAE5B,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,WAAW;QACf;QAEA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,SAAS;YACT,WAAW;YACX,KAAK;gBACD,SAAS;YACb;QACJ;QAEA,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ;YACR,SAAS;YACT,KAAK;gBACD,QAAQ;YACZ;YACA,QAAQ;gBACJ,MAAM;YACV;QACJ;QAEA,IAAI,CAAC,MAAM,UAAU,CAAC,CAAC,OAAO;QAC9B,IAAI,IAAI,CAAC,eAAe,IAAI,CAAC,MAAM,SAC/B,IAAI,CAAC,QAAQ,UAAU,IAAI;QAE/B,IAAI,CAAC,OAAO,UACR,IAAI,CAAC,MAAM,WAAW;QAG1B,IAAI,OAAO,OACP,QAAQ,QAAQ,OAAO;QAG3B,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ;YACR,SAAS,OAAO;YAChB,KAAK,CAAC;QACV;QACC,MAAc,aAAa;QAE5B,IAAI,CAAC,MAAM,WAAW;YAClB,IAAI,IAAI,CAAC,aACL,IAAI,CAAC,QAAQ,UAAU,OAAO,0BAA0B,IAAI,CAAC,MAAM;YAEvE,OAAO,YAAY,OAAO,SAAS,IAAI,CAAC,MAAM;YAC9C,WAAW;gBACP,IAAI,CAAC,MAAM;YACf,GAAG;QACP;QACA,IAAI,OAAO,KACP,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,OAAO;IAEpC;IAEA,WAAqB;QACjB,OAAO,IAAI,CAAC,MAAM;IACtB;IAEA,SAAU,CAAU,EAAQ;QACxB,IAAI,CAAC,MAAM,UAAU,CAAC,CAAC;QACvB,IAAI,IAAI,CAAC,aACL,IAAI,CAAC,QAAQ,UAAU,OAAO,0BAA0B,IAAI,CAAC,MAAM;IAE3E;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,MAAM,WAAW;IAC1B;AAEJ;;;;;AC5EA,2CAAa;2CAiIA;AA1Jb;AAyBO,MAAM;IAOT,mBAAmB;IACnB,YAAa,CAAe,CAAE;aAHb,cAA2B;YAAC,SAAS,KAAO;QAAC;QAI1D,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS;YACT,SAAS,EAAE;YACX,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,KAAK;YACT;QACJ;QAGA,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,SAAS;YACT,QAAQ,IAAI,CAAC;YACb,OAAO,EAAE;QACb;QAEA,IAAI,CAAC,MAAM;QAEX,IAAI,CAAC,OAAO,EAAE,QAAQ;QACtB,IAAI;YACA,IAAI,CAAC,MAAM,OAAO,IAAI,CAAC;QAC3B,EAAE,OAAM,GAAG;QACP,4BAA4B;QAChC;QAEA,MAAM,WAAW,EAAE,QAAQ;QAE3B,IAAI,IAAI,CAAC,SAAS,UAAU;YACxB,IAAI,EAAE,QAAQ,WACV,IAAI,CAAC,MAAM,MAAM,KAAK,EAAE;YAE5B,IAAI,EAAE,QAAQ,WACV,IAAI,CAAC,MAAM,MAAM,KAAK,EAAE;YAE5B,IAAI,EAAE,SAAS,WACX,IAAI,CAAC,MAAM,OAAO,KAAK;QAE/B;QAEA,IAAI,CAAC,MAAM,QAAQ,KAAK,EAAE;QAE1B,IAAI,iBAAiB,IAAI,CAAC,MAAM;QAEhC;;SAEC,GACD,MAAM,eAAe;YACjB,MAAM,SAAS;YACf,IAAI,WAAW,IAAI,CAAC,MAAM;YAC1B,IAAI,EAAE,kBAAkB;gBACpB,IAAI,YAAY;gBAChB,IAAI,aAAa,IAAI;oBACjB,WAAW;oBACX,YAAY;gBAChB;gBACA,IAAI,EAAE,QAAQ,aAAa,WAAW,YAAY,EAAE,KAAK;oBACrD,WAAW,KAAK,EAAE;oBAClB,YAAY;gBAChB;gBACA,IAAI,EAAE,QAAQ,aAAa,WAAW,YAAY,EAAE,KAAK;oBACrD,WAAW,KAAK,EAAE;oBAClB,YAAY;gBAChB;gBACA,IAAI,WACA,IAAI,CAAC,MAAM,QAAQ,KAAK;YAEhC;YAEA,iBAAiB;YAEjB,OAAO,WAAW;QACtB;QAEA,IAAI,EAAE,UAAU;YACZ,MAAM,WAAW,EAAE;YACnB,IAAI,CAAC,MAAM,WAAW;gBAClB,kBAAkB,SAAS,IAAI,CAAC,MAAM;YAC1C;QACJ;QACA,IAAI,EAAE,KACF,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,OAAO,EAAE;QAGzB,IAAI,EAAE,wBAAwB,EAAE,SAAS,YAAY,EAAE,UAAU;YAC7D,MAAM,WAAW,EAAE;YACnB,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY,CAAC;YACvC,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC1C,QAAQ,IAAI,CAAC;gBACb,SAAS,CAAC;oBACN;;qBAEC,GACD,MAAM,MAAM,IAAI,CAAC,YAAY,UAAU,WAAW,IAAI;oBACtD,IAAI,CAAC,MAAM,QAAQ,KAAM,CAAA,WAAW,IAAI,CAAC,MAAM,SAAS,EAAE,SAAS,WAAW,GAAE;oBAChF,kBAAkB,SAAS,IAAI,CAAC,MAAM;gBAC1C;YACJ;QACJ;IACJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC,MAAM;IACtB;IAEA,SAAU,CAAkB,EAAQ;QAChC,IAAI,CAAC,MAAM,QAAQ,KAAK;IAC5B;IAEA,UAAiB;QACb,IAAI,CAAC,mBAAmB,IAAI,CAAC,gBAAgB;QAC7C,IAAI,CAAC,YAAY;IACrB;AACJ;AAGO,MAAM,QAAQ,SAAU,MAO9B;IACG,MAAM,SAAS,SAAS,cAAc;IACtC,IAAI,OAAO,MACP,IAAI;QACA,OAAO,OAAO,OAAO;IACzB,EAAE,OAAM,GAAG;IACP,SAAS,GACT,4BAA4B;IAChC;SAEA,OAAO,OAAO;IAElB,IAAI,OAAO,QAAQ,WACf,OAAO,MAAM,KAAK,OAAO;IAE7B,IAAI,OAAO,QAAQ,WACf,OAAO,MAAM,KAAK,OAAO;IAE7B,OAAO,QAAQ,KAAK,OAAO;IAC3B,IAAI,OAAO,UACP,OAAO,WAAW;QACd,OAAO,SAAS,OAAO;IAC3B;IAEJ,IAAI,OAAO,KACP,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,OAAO;IAG1B,OAAO;AACX;;;;;ACxLA;;CAEC,GACD,4CAAa;AATb;AASO,MAAM;IAWT,iBAAiB;IACjB,YAAa,CAOZ,CAAE;aAhBK,YAGF,EAAE;QAcJ,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,SAAS;YACT,OAAO,EAAE;YACT,WAAW;YACX,KAAK;gBACD,QAAQ;gBACR,UAAU;gBACV,SAAS;YACb;QACJ;QACA,IAAI,EAAE,KACF,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU,EAAE;QAG5B,MAAM,cAAc,EAAE;QACtB,IAAI,CAAC,aACD,IAAI,CAAC,SAAS,WAAW;QAE7B,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,EAAE,UACF,IAAI,CAAC,WAAW,EAAE;QAEtB,IAAI,CAAC,iBAAiB;YAClB,IAAI,CAAC,aACD,IAAI,CAAC,SAAS;YAElB,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC;QACxC;QACA,IAAI,CAAC,SAAS,iBAAiB,UAAU,IAAI,CAAC;QAC9C,IAAI,CAAC,SAAS,QAAQ,EAAE,cAAc,YAAY,EAAE,YAAY;IACpE;IAEA,SAAU,GAA0B,EAAQ;QACxC,IAAI,CAAC,SAAS,QAAQ,QAAQ,YAAY,KAAK;IACnD;IAEA,WAAuB;QACnB,OAAO,IAAI,CAAC,SAAS;IACzB;IAEA,cAAe,KAAa,EAAQ;QAChC,IAAI,QAAQ;QACZ,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IAAK;YAC5C,MAAM,SAAS,IAAI,CAAC,SAAS,CAAC,EAAE;YAChC,IAAI,OAAO,QAAQ,KAAK,OAAO,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,SAAS,OAAO;gBAC5D,QAAQ;gBACR;YACJ;QACJ;QACA,QAAQ,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,CAAC,UAAU,SAAQ,GAAG,QAAQ;QAC/D,MAAM,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM;QACpC,IAAI,CAAC,SAAS,QAAQ,OAAO,OAAO,OAAO,IAAI,CAAC,EAAE,GAAG;QACrD,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC;IACxC;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAa,EAAa,EAAE,KAAa,EAAQ;QAC7C,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB,IAAI,OAAO,QAAQ,OAAO,IAAI,CAAC,EAAE,KAAK,MAAM,OAAO,IAAI;gBACnD,OAAO,IAAI,CAAC,EAAE,GAAG;gBACjB,OAAO,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE;YAC1C;QACJ;IACJ;IAEA,aAAc,SAAiD,EAAQ;QACnE,IAAI,CAAC,YAAY,EAAE;QACnB,IAAI,CAAC,SAAS,YAAY;QAC1B,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,QAAQ,IAAK;YACvC,MAAM,OAAO,SAAS,CAAC,EAAE;YACzB,IAAI,CAAC,MAAM;gBACP,IAAI,CAAC,UAAU,KAAK;oBAChB;gBACJ;gBACA;YACJ;YACA,MAAM,KAAK,SAAS,cAAc;YAClC,GAAG,QAAQ,IAAI,CAAC,EAAE;YAClB,GAAG,cAAc,IAAI,CAAC,EAAE;YACxB,IAAI,IAAI,CAAC,EAAE,EACP,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,IAAI,CAAC,EAAE,CAAC;YAEvB,IAAI,CAAC,UAAU,KAAK;gBAChB;gBACA;YACJ;YACA,IAAI,CAAC,SAAS,OAAO;QACzB;IACJ;IAEA,UAAiB;QACb,IAAI,CAAC,SAAS,oBAAoB,UAAU,IAAI,CAAC;IACrD;AAEJ;;;;;AC5HA;;CAEC,GACD,iDAAa;AALb;AAKO,MAAM;IAKD,SAAgB;QACpB,IAAI,CAAC,OAAO,UAAU,OAAO,uBAAuB,IAAI,CAAC;IAC7D;IAEA,iBAAiB;IACjB,YACI,CAOC,CACH;QACE,IAAI,CAAC,WAAW,CAAC,CAAC,EAAE;QACpB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,OAAO,EAAE;YACT,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACX,WAAW,qBAAsB,CAAA,EAAE,aAAa,iBAAiB,EAAC;gBAClE,KAAK;oBACD,iBAAiB,UAAU,EAAE,QAAQ;gBACzC;YACJ;YACA,SAAS,CAAC;gBACN,EAAE;gBACF,IAAI,EAAE,WAAW,IAAI,CAAC,UAClB;gBAEJ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;gBACtB,IAAI,CAAC;gBACL,EAAE,SAAS,IAAI,CAAC;YACpB;QACJ;QAGA,IAAI,CAAC;IACT;IAEA,oBAAoB;IACpB,SAAU,CAAU,EAAQ;QACxB,IAAI,CAAC,WAAW,CAAC,CAAC;QAClB,IAAI,CAAC;IACT;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAqB;QACjB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;IACtB;AACJ;;;;;ACzDA;;CAEC,GACD,oDAAa;AAbb;AACA;AAYO,MAAM;IAST,iBAAiB;IACjB,YACI,CAIC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,SAAS;YACb;QACJ;QAEA,IAAI,CAAC,YAAY,EAAE;QAEnB,MAAM,SAAS,CAAC,OAAe;YAC3B,IAAI,CAAC,cAAc;YACnB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,SAAS,MAAM,IAAI,CAAC;YAElD,EAAE,SAAS;QACf;QAEA,IAAI;QACJ,MAAM,eAAe,CAAC,OAAe;YAIjC,IAAI,EAAE,OAAO,EAAE,QACX,eAAe;YAEnB,MAAM,UAAU,IAAI,CAAA,GAAA,wBAAU,EAAE;gBAC5B,OAAO,EAAE;gBACT,OAAO,EAAE;gBACT,WAAW,EAAE,OAAO,EAAE;gBACtB,SAAS;gBACT,UAAU;oBACN,OAAO,OAAO,EAAE;gBACpB;gBACA,YAAY,EAAE;YAClB;YACA,IAAI,CAAC,OAAO,OAAO,QAAQ;YAE3B,OAAO;gBACH,IAAI,EAAE;gBACN;YACJ;QACJ;QAEA,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,UAAU,QAAQ,IACpC,IAAI,CAAC,UAAU,KAAK,aAAa,GAAG,EAAE,SAAS,CAAC,EAAE;QAGtD,IAAI,iBAAiB,WACjB,MAAM,IAAI,MAAM;QAEpB,IAAI,CAAC,cAAc;IACvB;IAEA,oBAAoB;IACpB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC;IAC5C;IAEA,UAAiB;QACb,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB,KAAK,QAAQ;QACjB;IACJ;AACJ;;;;;6DCvFa;AAVb;AACA;AACA;;AACA;AAOO,MAAM,0BAA0B,SACnC,SAAkB,EAClB,cAAoC;IAGpC,MAAM,WAAW,IAAI,CAAA,GAAA,oBAAQ,EAAE;QAC3B,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACT,WAAW;YACX,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,iBAAiB,UAAU,CAAA,GAAA,gCAAM,IAAI;gBACrC,gBAAgB;gBAChB,kBAAkB;gBAClB,QAAQ;gBACR,cAAc;YAClB;QACJ;QACA,OAAO,CAAA,GAAA,cAAG,EAAE;QACZ,MAAM;QACN,UAAU,CAAC;YACP,eAAe;QACnB;IACJ;IAGA,OAAO,SAAS;AACpB;;;ACrCA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,gCAAgC,MAAM,KAAK;;;;;ACEpH,+CAAa;AAFb;AAEO,MAAM;IAIT,SAAgB;QACZ,IAAI,CAAC,GAAG,UAAU,OAAO,yBAAyB,IAAI,CAAC;IAC3D;IAEA,iBAAiB;IACjB,YACI,CAKC,CACH;QACE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE;QACjB,IAAI,CAAC,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;YACZ,SAAS,EAAE;YACX,OAAO,EAAE;YACT,WAAW,AAAC,OAAO,EAAE,UAAU,WAAY,kBAAkB;YAC7D,SAAS;gBACL,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;gBACnB,IAAI,CAAC;gBACL,EAAE,SAAS,IAAI,CAAC;YACpB;YACA,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,OAAO,EAAE,UAAU,UACnB,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,OAAO;YACZ,SAAS;YACT,eAAe;QACnB;QAEJ,IAAI,CAAC;IACT;IAEA,WAAqB;QACjB,OAAO,IAAI,CAAC;IAChB;IAEA,SAAU,CAAU,EAAQ;QACxB,IAAI,CAAC,QAAQ,CAAC,CAAC;QACf,IAAI,CAAC;IACT;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;IACtB;AACJ;;;;;AChDA;;;;;;;;;;;;CAYC,GACD,8CAAa;AAvBb;AACA;AAEA;AACA;AAmBO,MAAM;IA+CD,mBAAoB,KAAa,EAAU;QAC/C,IAAI,IAAI,CAAC,aAAa,IAAI,CAAC,oBACvB,OAAO,IAAI,CAAC,mBAAmB,MAAM,OAAO,KAAK,MAAM,IAAI,CAAC,gBAAgB;QAEhF,OAAO,AAAC,CAAA,QAAQ,IAAI,CAAC,GAAE,IAAM,CAAA,IAAI,CAAC,MAAM,IAAI,CAAC,GAAE;IACnD;IAEQ,mBAAoB,WAAmB,EAAU;QACrD,IAAI,SAAS,IAAI,CAAC,MAAM,cAAe,CAAA,IAAI,CAAC,MAAM,IAAI,CAAC,GAAE;QACzD,IAAI,IAAI,CAAC,aAAa,IAAI,CAAC,oBACvB,SAAS,IAAI,CAAC,mBAAmB,YAAY,gBAAgB;QAEjE,OAAO;IACX;IAEQ,cAAqB;QACzB,IAAI,eAAgC,IAAI,CAAC,oBAAoB,IAAI,CAAC;QAClE,eAAe,IAAI,CAAC,aAAa,IAAI,CAAC,WAAW,gBAAgB,KAAK,MAAM;QAC5E,eAAe,aAAa,eAAe,CAAA,GAAA,yBAAc,EAAE;QAC3D,MAAM,OAAO,IAAI,CAAC,SAAS,YAAY,IAAI,CAAC,OAAO;QACnD,IAAI,CAAC,OAAO,YAAY,IAAI,CAAC,QAAQ,gDAAgD,eAAe,OAAO;QAE3G,MAAM,cAAc,IAAI,CAAC,mBAAmB,IAAI,CAAC;QACjD,IAAI,CAAC,QAAQ,MAAM,QAAQ,AAAC,cAAc,IAAI,CAAC,eAAgB;IACnE;IAEQ,KAAM,OAAgB,EAAQ;QAClC,IAAI,CAAC,WAAW,IAAI,CAAC,iBACjB;QAGJ,IAAI,WAAW,CAAC,IAAI,CAAC,YAAY;YAC7B,IAAI,CAAC,SAAS,IAAI,CAAC;YACnB,IAAI,IAAI,CAAC,cAAc;gBACnB,cAAc,IAAI,CAAC;gBACnB,IAAI,CAAC,eAAe;YACxB;YACA;QACJ;QAEA,IAAI,IAAI,CAAC,cACL,IAAI,CAAC,YAAY,IAAI,CAAC;aAEnB;YACH,IAAI,CAAC,SAAS,IAAI,CAAC;YAEnB,IAAI,CAAC,eAAe,YAAY;gBAC5B,IAAI,IAAI,CAAC,cAAc,WAAW;oBAC9B,cAAc,IAAI,CAAC;oBACnB,IAAI,CAAC,eAAe;gBACxB,OAAO;oBACH,IAAI,CAAC,SAAS,IAAI,CAAC;oBACnB,IAAI,CAAC,YAAY;gBACrB;YACJ,GAAG,IAAI,CAAC;QACZ;IACJ;IAEQ,eAAsB;QAC1B,IAAI,CAAC,gBAAgB,UAAU,OAAO,4BAA4B,CAAC,IAAI,CAAC;QACxE,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,iBAAiB;YACzB,SAAS,IAAI,CAAC,YAAY,KAAK;YAC/B,eAAe,IAAI,CAAC,YAAY,KAAK;QACzC;QACA,IAAI,IAAI,CAAC,aACL,IAAI,CAAC,YAAY,aAAa,IAAI,CAAC;IAE3C;IAEQ,kBAAyB;QAE7B,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,wCAAkB,EACrC,IAAI,CAAC,oBAAoB,IAAI,CAAC,QAC9B,IAAI,CAAC,oBAAoB,IAAI,CAAC,MAC9B,IAAI,CAAC,oBAAoB,IAAI,CAAC,MAC9B,IAAI,CAAC,gBAAgB,yBACrB,CAAC;YACG,MAAM,IAAI,CAAC,oBAAoB;YAC/B,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,MAAM,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC;YAC3C,IAAI,CAAC,SAAS,IAAI,CAAC;QACvB,GACA;YACI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,iBAAiB;gBACzB,SAAS;YACb;YACA,IAAI,IAAI,CAAC,aAAa;gBAClB,IAAI,CAAC,YAAY,aAAa;gBAC9B,IAAI,CAAC,YAAY;YACrB;YACA,IAAI,CAAC,cAAc;QACvB,GACA,AAAC,IAAI,CAAC,0BAA0B,IAAI,CAAC,yBAAyB,IAAK,IAAI,CAAC,yBAAyB;QAErG,IAAI,CAAC,YAAY,aAAa,IAAI,CAAC;QACnC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,YAAY;QACpC,WAAW;YACP,IAAI,CAAC,eAAe,IAAI,CAAC,YAAY;QACzC;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,iBAAiB;YACzB,SAAS;QACb;IACJ;IAGA,iBAAiB;IAEjB,YACI,CAkBC,CACH;QACE,IAAI,CAAC,YAAY,EAAE,cAAc;QACjC,IAAI,CAAC,yBAAyB,EAAE;QAChC,IAAI,CAAC,YAAY,CAAC,CAAC,EAAE;QAErB,IAAI,CAAC,EAAE,OACH,MAAM,IAAI,MAAM;QAEpB,IAAI,EAAE,OAAO,KAAK,EAAE,OAAO,KAAK,EAAE,SAAS,GAAG;YAC1C,IAAI,CAAC,EAAE,OAAO,CAAC,EAAE,OAAO,CAAC,EAAE,OACvB,MAAM,IAAI,MAAM;QAExB;QACA,IAAI,EAAE,OAAO,EAAE,KACX,MAAM,IAAI,MAAM;QAGpB,IAAI,CAAC,MAAM,EAAE;QACb,IAAI,CAAC,MAAM,EAAE;QACb,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM,EAAE,OAAO,IAAI,CAAC,KAAK,IAAI,CAAC;QAC9C,IAAI,CAAC,eAAe,EAAE;QACtB,IAAI,CAAC,gBAAgB,EAAE;QACvB,IAAI,CAAC,aAAa,EAAE,aAAa,EAAE,aAAa,IAAI,CAAC,eAAe;QAEpE,IAAI,CAAC,WAAW,EAAE,WAAW,EAAE,WAAW,KAAO;QACjD,IAAI,CAAC,EAAE,YAAY,CAAC,EAAE,gBAClB,MAAM,IAAI,MAAM;QAEpB,IAAI,CAAC,sBAAsB,EAAE,UAAU,EAAE,UAAU,CAAC,eAAiB;QACrE,IAAI,CAAC,sBAAsB,EAAE,iBAAiB,EAAE,iBAAiB,CAAC,QAAU;QAC5E,IAAI,CAAC,kBAAkB,CAAC,CAAC,EAAE;QAC3B,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,CAAC,OAAO,EAAE;QAEd,IAAI,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,EAAE,OACH,MAAM,IAAI,MAAM;YAEpB,MAAM,WAA+B,EAAE,UAAU,cAAc,CAAA,GAAA,MAAC,EAAE,qBAAqB,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,OAAO,EAAE;YACpH,IAAI,CAAC,qBAAqB,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;QACxD;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,SAAS;YACb;QACJ;QACA,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,UAAU;gBACV,OAAO,IAAI,CAAC,eAAe;gBAC3B,QAAQ,IAAI,CAAC,gBAAgB;gBAC7B,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,OAAO,gBAAgB;YACxB,OAAO;QACX;QACA,IAAI,CAAC,QAAQ,EAAE;QACf,MAAM,gBAAgB,IAAI,CAAC,gBAAgB;QAC3C,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS,IAAI,CAAC;YACd,KAAK;gBACD,UAAU;gBACV,SAAS;gBACT,YAAY;gBACZ,YAAY;gBACZ,QAAQ;gBACR,UAAU,gBAAgB;gBAC1B,eAAe;YACnB;QACJ;QACA,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,OAAO,AAAC,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS,IAAI,CAAC,eAAgB;gBACnE,QAAQ,IAAI,CAAC,gBAAgB;YACjC;QACJ;QACA,MAAM,eAAe,SAAS,cAAc;QAE5C,IAAI,CAAC,gBAAgB,OAAO,IAAI,CAAC,SAAS,IAAI,CAAC;QAC/C,IAAI,CAAC,QAAQ,OAAO;QAEpB,IAAI,CAAC;QAGL,MAAM,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,aAAa;YACrC,aAAa;gBACT,IAAI,CAAC;YACT;QACJ;QACA,aAAa,oBAAoB;YAAC;YAAQ;SAAQ;QAClD,MAAM,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE,WAAW;YACjC,UAAU;gBACN;aACH;QACL;QAEA,IAAI;QACJ,MAAM,YAAY,CAAC;YACf,MAAM;YAEN,IAAI,CAAC,IAAI,CAAC,WACN;YAGJ,IAAI,MAAM,SAAS,eAAe;gBAE9B,8BAA8B;gBAC9B,CAAA,GAAA,MAAC,EAAE;gBAEH,IAAI,CAAC,gBAAgB,YAAY;gBAEjC,IAAI,MAAM,WAAW,QAAQ;oBACzB,IAAI,cAAc,MAAM,OAAO,IAAI,CAAC;oBACpC,cAAc,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;oBACtC,IAAI,CAAC,QAAQ,IAAI,CAAC,mBAAmB;oBACrC,IAAI,CAAC;oBACL,IAAI,CAAC,KAAK;gBACd;gBACA,aAAa,IAAI,CAAC,mBAAmB,IAAI,CAAC;YAC9C;YAEA,IAAI,MAAM,SAAS,iBAAiB;gBAAC;gBAAQ;aAAQ,CAAC,SAAS,MAAM,UAAU,KAAK;gBAEhF,IAAI,SAAS,MAAM;gBACnB,MAAM,SAAS,KAAK,IAAI,MAAM,QAAS,CAAA,MAAM,aAAa,CAAA;gBAC1D,MAAM,SAAS,CAAA,GAAA,sCAAsB,EAAE,QAAQ,MAAM,WAAW;gBAChE,UAAU;gBACV,UAAU,IAAI,CAAC;gBAEf,cAAc;gBAEd,MAAM,cAAc,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;gBAC5C,IAAI,CAAC,QAAQ,IAAI,CAAC,mBAAmB;gBACrC,IAAI,CAAC;gBACL,IAAI,CAAC,KAAK;YACd;YAEA,IAAI,MAAM,SAAS,aAAa;gBAC5B,IAAI,CAAC,gBAAgB,YAAY;gBACjC,IAAI,CAAC,KAAK;YACd;QAEJ;QAEA,IAAI,CAAC,yBAAyB,WAAW;YACrC,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC1C,QAAQ,IAAI,CAAC;gBACb,aAAa;gBACb,WAAW,CAAC;oBACR,UAAU;oBACV,WAAW,QAAQ;gBACvB;gBACA,SAAS,CAAC;oBACN,IAAI,cAAc,IAAI,CAAC,mBAAmB,IAAI,CAAC;oBAC/C,cAAc,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc,MAAM,SAAS,IAAI,GAAG;oBAC3D,IAAI,CAAC,QAAQ,IAAI,CAAC,mBAAmB;oBACrC,IAAI,CAAC;oBACL,IAAI,CAAC,SAAS,IAAI,CAAC;gBACvB;YACJ;YACA,IAAI,CAAC;QACT,GAAG;IACP;IAEA,kBAAmB,CAAS,EAAQ;QAChC,IAAI,CAAC,IAAI,CAAC,WACN;QAEJ,IAAI,cAAc,IAAI,CAAC,mBAAmB,IAAI,CAAC;QAC/C,cAAc,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc,GAAG,GAAG;QAC3C,IAAI,CAAC,QAAQ,IAAI,CAAC,mBAAmB;QACrC,IAAI,CAAC;QACL,IAAI,CAAC,SAAS,IAAI,CAAC;IACvB;IAEA,SAAU,CAAS,EAAQ;QACvB,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,IAAI,CAAC,KAAK,IAAI,CAAC;QACxC,IAAI,CAAC;IACT;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,OAAQ,MAAuB,EAAQ;QACnC,IAAI,CAAC,MAAM,OAAO;QAClB,IAAI,CAAC,MAAM,OAAO;QAClB,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO;QAC1B,IAAI,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,OAAO,OACR,MAAM,IAAI,MAAM;YAEpB,MAAM,WAAW,OAAO,UAAU,cAAc,CAAA,GAAA,MAAC,EAAE,qBAAqB,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,OAAO,OAAO;YAC1G,IAAI,CAAC,qBAAqB,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;QACxD,OACI,IAAI,CAAC,qBAAqB;QAE9B,IAAI,CAAC,aAAa,CAAC,OAAO;IAC9B;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC;IACT;IAEA,UAAiB;QACb,aAAa,IAAI,CAAC;QAClB,IAAI,CAAC,mBAAmB,IAAI,CAAC,gBAAgB;QAC7C,IAAI,IAAI,CAAC,aACL,IAAI,CAAC,YAAY;QAErB,IAAI,IAAI,CAAC,cACL,cAAc,IAAI,CAAC;IAE3B;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;AC1aA;;;;;;;;CAQC;;AACD,6DAAgB;AAAT,SAAS,wBAAyB,MAAc,EAAE,aAAsB;IAC3E,IAAI,SAAS,KAAK,IAAI,IAAI,IAAI,KAAK,IAAI,KAAK,MAAM,SAAS,KAAK;IAChE,IAAI,eACA,UAAU;IAEd,OAAO,IAAI;AACf;;;;;ACZA;;;CAGC,GACD,yDAAa;AAPb;AACA;AAMO,MAAM;IAQD,OAAc;QAClB,IAAI,IAAI,CAAC,cAAc,OAAO,IAAI,CAAC,MAAM,QAAQ;YAC7C,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,MAAM;YAChC,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,MAAM;QACvC;IACJ;IAEQ,iBAAwB;QAC5B,IAAI,IAAI,CAAC,UACL;QAEJ,IAAI,CAAC,WAAW;QAEhB,IAAI,CAAC;QACL,IAAI,CAAC;QACL,WAAW;YACP,oDAAoD;YACpD,IAAI,CAAC,gBAAgB,OAAO,SAAS,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa;YAC5E,IAAI,CAAC,eAAe;QACxB;IACJ;IAEA,iBAAiB;IAEjB,YACI,KAAa,EACb,GAAW,EACX,GAAW,EACX,IAAa,EACL,UACA,SACR,WAAoB,CACtB;wBAHU;uBACA;aAnCJ,YAAqB;aAGrB,WAAoB;QAoCxB,IAAI,CAAC,QAAQ,CAAA,GAAA,YAAI,EAAE;YACf,MAAM;YACN,MAAM;YACN;YACA;YACA,UAAU,CAAC;gBACP,IAAI,CAAC;YACT;QACJ;QACA,IAAI,gBAAgB,GAChB,IAAI,CAAC,MAAM,aAAa,QAAQ;QAEpC,IAAI,CAAC,MAAM,SAAS;YAChB,IAAI,CAAC;QACT;QACA,IAAI,CAAC,MAAM,iBAAiB,SAAS,CAAC;YAClC,IAAI;gBAAC;gBAAS;aAAS,CAAC,SAAS,EAAE,MAC/B,IAAI,CAAC;iBAEL,IAAI,CAAC;QAEb;QACA,IAAI,CAAC,MAAM,iBAAiB,SAAS,IAAM,IAAI,CAAC;QAEhD,IAAI,CAAC,eAAe;YAChB,GAAG,OAAO;YACV,GAAG,OAAO;QACd;QAEA,IAAI;QACJ,IAAI,eAAe,gBAAgB,GAC/B,eAAe,CAAA,GAAA,MAAC,EAAE,MAAM,OAAO;aAE/B,eAAe;QAEnB,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,MAAM,QAAQ,KAAK;QAExB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,OAAO;YACf,OAAO,KAAK,QAAQ;YACpB,QAAQ,KAAK,SAAS;QAC1B;IACJ;IAEA,aAAc;QACV,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,YAAY,CAAC,CAAC;IACvB;IAEA,QAAe;QACX,IAAI,CAAC,MAAM;QACX,IAAI,CAAC,MAAM;IACf;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;IACtB;AACJ;;;;;AC5FA;;CAEC,GACD,oDAAa;AApBb;AACA;AACA;AACA;AACA;;AAGA;AACA;AAYO,MAAM;IAGT,mBAAmB;IACnB,YACI,CAGC,CACH;QACE,IAAI,eAAoB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,EAAE,MAAM;QAEjE,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,cAAc;gBACd,WAAW;gBACX,YAAY,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;YACpD;QACJ;QAEA,cAAc;QAEd,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,SAAS,CAAA,GAAA,cAAG,EAAE;QAClB;QACA,MAAM,WAAW,CAAA,GAAA,YAAI,EAAE;YACnB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;YAC1C,KAAK;gBACD,OAAO;YACX;YACA,UAAU;gBACN,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS,SAAS;gBACjD,IAAI,CAAC,QAAQ;oBACT,SAAS;oBACT,SAAS,QAAQ,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;gBACzD,OACI,eAAe;gBAEnB,UAAU,MAAM,aAAa,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;gBAEjE,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,MAAM,CAAC,EAAE,CAAC;YAElB;QACJ;QACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,SAAS;YACT,SAAS,eAAe,CAAA,GAAA,uBAAM,IAAI;YAClC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS;gBACL,SAAS;gBACT,UAAU,UAAU,UAAU,SAAS,OAAO,OAAO;YACzD;QACJ;QAEA,MAAM,WAAW,CAAA,GAAA,IAAA,EAAE;YACf,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,cAAc;gBACd,UAAU;gBACV,KAAK;gBACL,UAAU;YACd;QACJ,GAAG;YACC;YACA,CAAA,GAAA,IAAA,EAAE,6BAA6B;gBAC3B;gBACA;aACH;SACJ;QACD,WAAW;YACP,SAAS;YACT,SAAS;QACb,GAAG;QAGH,gBAAgB;QAChB,SAAS,kBAAmB,QAAgB,EAAE,YAA6B;YAEvE,MAAM,UAAU,CAAA,GAAA,YAAI,EAAE;gBAClB,MAAM,YAAY,CAAC,aAAa;gBAChC,KAAK;gBACL,KAAK;gBACL,MAAM;gBACN,KAAK;oBACD,OAAO;gBACX;gBACA,UAAU;oBACN,IAAI,QAAQ,UAAU,MAAM,WAAW,QAAQ,SAAS,KAAK,WAAW,QAAQ,SAAS,KAAK;wBAC1F,OAAO;wBACP;oBACJ;oBACA,QAAQ,QAAQ,KAAK,KAAK,MAAM,WAAW,QAAQ;oBACnD,YAAY,CAAC,aAAa,GAAG,OAAO,QAAQ;oBAC5C,UAAU,MAAM,aAAa,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;oBACjE,SAAS,QAAQ,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;gBACzD;YACJ;YAEA,MAAM,QAAQ,CAAA,GAAA,IAAA,EAAE,MAAM;gBAClB,CAAA,GAAA,IAAA,EAAE,YAAY;gBACd,CAAA,GAAA,IAAA,EAAE,MAAM;oBAAC;iBAAQ;aACpB;YAED,MAAM,SAAS;gBACX,QAAQ;oBACJ,QAAQ,QAAQ,KAAK,YAAY,CAAC,aAAa;gBACnD;gBACA,SAAS;oBACL,CAAA,GAAA,MAAC,EAAE,kBAAkB,SAAS;gBAClC;gBACA,SAAS;YACb;YACA,OAAO;QACX;QACA,MAAM,SAAsB;YACxB,kBAAkB,CAAA,GAAA,cAAG,EAAE,QAAQ;YAC/B,kBAAkB,CAAA,GAAA,cAAG,EAAE,UAAU;YACjC,kBAAkB,CAAA,GAAA,cAAG,EAAE,SAAS;SACnC;QAED,MAAM,WAAW,CAAA,GAAA,QAAE,EAAE;YACjB,gBAAgB;YAChB,MAAM;gBACF,eAAe;YACnB;QACJ;QACA,MAAM,SAAS,CAAA,GAAA,IAAA,EAAE,IAAI;YACjB;YACA;YACA,CAAA,GAAA,IAAA,EAAE,WAAW,UAAU;gBAAC,CAAA,GAAA,IAAA,EAAE,SAAS,OAAO,IAAI,CAAA,OAAQ,KAAK;aAAU;SACxE;QAED,CAAA,GAAA,oBAAQ,EAAE;YACN,QAAQ,SAAS;YACjB,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,sBAAsB,IAAI,CAAC;YAC/C,KAAK;YACL,WAAW;YACX,cAAc;YACd,SAAS;gBAAC;gBAAM;aAAS;YACzB,UAAU,SAAU,SAAS;gBACzB,CAAA,GAAA,MAAC,EAAE,UAAU;gBACb,OAAO,QAAQ,CAAA,OAAQ,KAAK;gBAC5B,OAAO,OAAO,GAAG,OAAO;gBAExB,EAAE,QAAQ,cAAc,OAAO,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS,SAAS,SAAS;YAChF;QACJ;IACJ;AAEJ;;;AC7KA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK;;;;;ACgL1G;;CAEC,GACD,uCAAgB;AAlLhB;AACA;AAEA,SAAS,kBAAmB,EAAU;IAClC,IAAI,OAAO,IACP,OAAO,CAAC;IAGZ,IAAI;IACJ,IAAI;IACJ,MAAM,UAAoB,EAAE;IAE5B,QAAQ,GAAG,MAAM;IAEjB,IAAI,MAAM,WAAW,GAAG;QACpB,QAAQ,KAAK,CAAC,EAAE,CAAC,MAAM;QACvB,UAAU,MAAM;IAEpB,OAAO;QACH,UAAU,MAAM;QAChB,MAAM,QAAQ,CAAC,MAAM;YACjB,MAAM,SAAS,UAAU,MAAM,SAAS;YACxC,IAAI,QAAQ;gBACR,QAAQ,KAAK,MAAM;gBACnB,MAAM,OAAO,MAAM;gBACnB,IAAI,SAAS,WACT,QAAQ,KAAK;YAErB,OACI,QAAQ,KAAK;QAErB;IACJ;IAEA,MAAM,SAAS,CAAC;IAKhB,IAAI,YAAY,IACZ,OAAO,UAAU;IAErB,IAAI,QAAQ,SAAS,GACjB,OAAO,UAAU;IAErB,IAAI,MAAM,SAAS,GACf,OAAO,SAAS;IAEpB,OAAO;AACX;AAEA,SAAS,gBAAiB,EAAe,EAAE,UAAoB;IAC3D,MAAM,QAA4B,CAAC;IAEnC,MAAM,aAEF;QACA,GAAG,CAAC;YACA,MAAM,QAAQ,MAAM,CAAC,EAAE;QAC3B;QACA,IAAI,CAAC;YACD,MAAM,aAAa,MAAM,CAAC,EAAE;QAChC;QACA,GAAG,CAAC;YACA,MAAM,UAAU,MAAM,CAAC,EAAE,GAAG;QAChC;QACA,IAAI,CAAC;YACD,MAAM,aAAa,MAAM,CAAC,EAAE,GAAG;YAC/B,MAAM,gBAAgB,MAAM,CAAC,EAAE,GAAG;QACtC;QACA,IAAI,CAAC;YACD,MAAM,aAAa,MAAM,CAAC,EAAE,GAAG;QACnC;QACA,IAAI,CAAC;YACD,MAAM,eAAe,MAAM,CAAC,EAAE,GAAG;QACrC;QACA,IAAI,CAAC;YACD,MAAM,gBAAgB,MAAM,CAAC,EAAE,GAAG;QACtC;QACA,IAAI,CAAC;YACD,MAAM,cAAc,MAAM,CAAC,EAAE,GAAG;QACpC;QACA,IAAI,CAAC;YACD,MAAM,YAAY,MAAM,CAAC,EAAE,GAAG;QAClC;QACA,IAAI,CAAC;YACD,MAAM,cAAc,MAAM,CAAC,EAAE,GAAG;QACpC;QACA,IAAI,CAAC;YACD,MAAM,eAAe,MAAM,CAAC,EAAE,GAAG;QACrC;QACA,IAAI,CAAC;YACD,MAAM,aAAa,MAAM,CAAC,EAAE,GAAG;QACnC;QAEA,OAAO;QACP,MAAM;YACF,MAAM,UAAU;QACpB;QACA,WAAW;YACP,MAAM,gBAAgB;QAC1B;QACA,YAAY;YACR,MAAM,WAAW;QACrB;QACA,KAAK,CAAC;YACF,MAAM,MAAM,OAAO,IAAI,CAAA,OAAQ,OAAO,MAAM,KAAK;QACrD;QACA,MAAM;YACF,MAAM,WAAW;QACrB;QACA,SAAS,CAAC;YACN,MAAM,iBAAiB,MAAM,CAAC,EAAE;QACpC;QACA,OAAO,CAAC;YACJ,MAAM,aAAa,MAAM,CAAC,EAAE;QAChC;QAEA,QAAQ;YACJ,MAAM,UAAU;QACpB;QACA,QAAQ;YACJ,MAAM,aAAa;QACvB;QACA,KAAK,CAAC;YACF,MAAM,WAAW;YACjB,MAAM,OAAO,MAAM,CAAC,EAAE,GAAG;YACzB,MAAM,MAAM,MAAM,CAAC,EAAE,GAAG;QAC5B;QACA,GAAG,CAAC;YACA,MAAM,QAAQ,MAAM,CAAC,EAAE,KAAK,SAAS,SAAS,MAAM,CAAC,EAAE,GAAG;QAC9D;QACA,GAAG,CAAC;YACA,MAAM,SAAS,MAAM,CAAC,EAAE,KAAK,SAAS,SAAS,MAAM,CAAC,EAAE,GAAG;QAC/D;QACA,MAAM,CAAC;YACH,MAAM,YAAY,MAAM,CAAC,EAAE,GAAG;QAClC;QACA,GAAG,CAAC;YACA,MAAM,SAAS,MAAM,CAAC,EAAE;QAC5B;QACA,UAAU,CAAC;YACP,MAAM,WAAW,MAAM,CAAC,EAAE;QAC9B;QACA,KAAK,CAAC;YACF,MAAM,WAAW,MAAM,CAAC,EAAE;QAC9B;QACA,MAAM,CAAC;YACH,MAAM,OAAO,MAAM,CAAC,EAAE,KAAK,SAAS,SAAS,MAAM,CAAC,EAAE,GAAG;QAC7D;QACA,KAAK,CAAC;YACF,MAAM,MAAM,MAAM,CAAC,EAAE,KAAK,SAAS,SAAS,MAAM,CAAC,EAAE,GAAG;QAC5D;QACA,OAAO,CAAC;YACJ,MAAM,QAAQ,MAAM,CAAC,EAAE,KAAK,SAAS,SAAS,MAAM,CAAC,EAAE,GAAG;QAC9D;QACA,QAAQ,CAAC;YACL,MAAM,SAAS,MAAM,CAAC,EAAE,KAAK,SAAS,SAAS,MAAM,CAAC,EAAE,GAAG;QAC/D;QACA,MAAM,CAAC;YACH,MAAM,WAAW,MAAM,CAAC,EAAE,GAAG;QACjC;QACA,SAAS,CAAC;YACN,MAAM,gBAAgB,MAAM,CAAC,EAAE;QACnC;IACJ;IAEA,WAAW,QAAQ,CAAA;QACf,MAAM,SAAS,KAAK,MAAM;QAC1B,MAAM,YAAY,OAAO;QACzB,UAAU,CAAC,UAAU,CAAC;IAC1B;IACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI;AACf;AAKO,SAAS,EACZ,OAAyD,EACzD,KAAsD;IAEtD,IAAI,YAAY,WACZ,OAAO,SAAS,cAAc;IAElC,IAAI,OAAO,YAAY,UAAU;QAC7B,IAAI,CAAE,CAAA,mBAAmB,WAAU,GAC/B,UAAU,CAAA,GAAA,MAAC,EAAE;QAEjB,IAAI;YACA,IAAI,OAAO,UAAU,UACjB,QAAQ,YAAY;iBAEpB,QAAQ,UAAU;;QAI1B,OAAO;IACX;IAEA,MAAM,SAAS,kBAAkB;IACjC,MAAM,SAAS,SAAS,cAAc,OAAO,WAAW;IACxD,OAAO,WAAW,OAAO,UAAU,OAAO,OAAO;IACjD,OAAO,UAAU,gBAAgB,QAAQ,OAAO;IAEhD,IAAI;QACA,IAAI,OAAO,UAAU,UACjB,OAAO,YAAY;aAEnB,OAAO,UAAU;;IAGzB,OAAO;AACX;;;;;ACnMA,2CAAS;AAAT,yCAAgB;AAAhB,wCAAqB;AAArB,2CAAyB;AAAzB,yDAAgC;AAAhC,6CAAqD;AAArD,kDAA8D;AAA9D,+CAA4E;AAA5E,2CAAuF;AAAvF,2CAA8F;AAnB9F;;AACA;AACA;AACA;AAEA,IAAI,iBAAiB,CAAA,GAAA,6CAAY,EAAE;IACjC,KAAK;AACP,IACI,QAAQ,eAAe,OACvB,UAAU,eAAe,SACzB,KAAK,eAAe,IACpB,QAAQ,eAAe,OACvB,sBAAsB,eAAe,qBACrC,eAAe,eAAe,cAC9B,YAAY,eAAe,WAC3B,MAAM,eAAe,KACrB,QAAQ,eAAe,OACvB,QAAQ,eAAe;;;;;AC8H3B,6CAAS;AA/IT;;AACA;AACA;AAEA,SAAS,qBAAqB,KAAK,EAAE,UAAU;IAC7C,IAAI,MAAM,QAAQ,CAAC,WAAW,KAAK,KAAK,WACtC,OAAO,MAAM,OAAO,IAAI,YAAY,MAAM,OAAO;AAErD;AAEA,SAAS,MAAM,UAAU,EAAE,GAAG,EAAE,SAAS;IACvC,IAAI,mBAAmB,EAAE;IACzB,IAAI,eAAe,CAAA,GAAA,0BAAkB,EAAE,YAAY,kBAAkB;IAErE,IAAI,iBAAiB,SAAS,GAC5B,OAAO;IAGT,OAAO,eAAe,IAAI;AAC5B;AAEA,IAAI,gBAAgB,SAAS,cAAc,OAAO;IAChD,IAAI,QAAQ,CAAA,GAAA,qBAAU,EAAE,UAAU,aAAa;IAE/C,MAAM,MAAM,SAAS,SAAU,KAAK;QAClC,IAA6C,IAAI,CAAC,QAAQ,GACxD,MAAM,IAAI,MAAM;QAGlB,IAAI,CAAC,WAAW;IAClB;IAEA,MAAM,SAAS;IAEf,IAAI,MAAM,SAAS;QACjB,IAAK,IAAI,OAAO,UAAU,QAAQ,OAAO,IAAI,MAAM,OAAO,OAAO,GAAG,OAAO,MAAM,OAC/E,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC,KAAK;QAG9B,IAAI,aAAa,CAAA,GAAA,0BAAc,EAAE,MAAM,MAAM,YAAY;QACzD,CAAA,GAAA,mBAAW,EAAE,OAAO,YAAY;QAChC,OAAO,MAAM,MAAM,MAAM,WAAW;IACtC;IAEA,IAAI,YAAY,SAAS;QACvB,IAAK,IAAI,QAAQ,UAAU,QAAQ,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,OAAO,QACpF,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM;QAGhC,IAAI,aAAa,CAAA,GAAA,0BAAc,EAAE,MAAM,MAAM;QAC7C,IAAI,YAAY,eAAe,WAAW;QAC1C,qBAAqB,OAAO;YAC1B,MAAM,WAAW;YACjB,QAAQ,gBAAgB,YAAY,MAAM,WAAW,SAAS;QAChE;QACA,OAAO;IACT;IAEA,IAAI,eAAe,SAAS;QAC1B,IAAK,IAAI,QAAQ,UAAU,QAAQ,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,OAAO,QACpF,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM;QAGhC,IAAI,aAAa,CAAA,GAAA,0BAAc,EAAE,MAAM,MAAM;QAC7C,qBAAqB,OAAO;IAC9B;IAEA,IAAI,KAAK,SAAS;QAChB,IAAK,IAAI,QAAQ,UAAU,QAAQ,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,OAAO,QACpF,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM;QAGhC,OAAO,MAAM,MAAM,YAAY,KAAK,WAAW;IACjD;IAEA,OAAO;QACL,KAAK;QACL,IAAI;QACJ,cAAc;QACd,WAAW;QACX,SAAS,SAAS,QAAQ,GAAG;YAC3B,IAAI,QAAQ,SAAU,GAAG;gBACvB,MAAM,QAAQ,CAAC,IAAI,GAAG;YACxB;QACF;QACA,OAAO,SAAS;YACd,MAAM,aAAa,CAAC;YACpB,MAAM,WAAW,CAAC;YAClB,MAAM,MAAM;QACd;QACA,aAAa;QACb,OAAO,MAAM;QACb,OAAO;QACP,qBAAqB,CAAA,GAAA,0BAAkB,EAAE,KAAK,MAAM,MAAM;QAC1D,OAAO,MAAM,KAAK,MAAM,MAAM,YAAY;IAC5C;AACF;AAEA,IAAI,aAAa,SAAS,WAAW,IAAI;IACvC,IAAI,MAAM;IAEV,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,QAAQ,IAAK;QACpC,IAAI,MAAM,IAAI,CAAC,EAAE;QACjB,IAAI,OAAO,MAAM;QACjB,IAAI,QAAQ,KAAK;QAEjB,OAAQ,OAAO;YACb,KAAK;gBACH;YAEF,KAAK;gBAED,IAAI,MAAM,QAAQ,MAChB,QAAQ,WAAW;qBACd;oBACL,QAAQ;oBAER,IAAK,IAAI,KAAK,IACZ,IAAI,GAAG,CAAC,EAAE,IAAI,GAAG;wBACf,SAAU,CAAA,SAAS,GAAE;wBACrB,SAAS;oBACX;gBAEJ;gBAEA;YAGJ;gBAEI,QAAQ;QAEd;QAEA,IAAI,OAAO;YACT,OAAQ,CAAA,OAAO,GAAE;YACjB,OAAO;QACT;IACF;IAEA,OAAO;AACT;;;;;ACybA,6CAAS;AAtkBT;AACA;AACA;AACA;AAEA,IAAI,8BAA8B,SAAS,4BAA4B,KAAK,EAAE,MAAM,EAAE,KAAK;IACzF,IAAI,WAAW;IACf,IAAI,YAAY;IAEhB,MAAO,KAAM;QACX,WAAW;QACX,YAAY,CAAA,GAAA,YAAG,KAAK,MAAM;QAE1B,IAAI,aAAa,MAAM,cAAc,IACnC,MAAM,CAAC,MAAM,GAAG;QAGlB,IAAI,CAAA,GAAA,aAAI,EAAE,YACR;QAGF,CAAA,GAAA,YAAG;IACL;IAEA,OAAO,CAAA,GAAA,aAAI,EAAE,OAAO,CAAA,GAAA,gBAAO;AAC7B;AAEA,IAAI,UAAU,SAAS,QAAQ,MAAM,EAAE,MAAM;IAC3C,qCAAqC;IACrC,IAAI,QAAQ;IACZ,IAAI,YAAY;IAEhB,GACE,OAAQ,CAAA,GAAA,aAAI,EAAE;QACZ,KAAK;YACH,MAAM;YACN,IAAI,cAAc,MAAM,CAAA,GAAA,YAAG,QAAQ,IACjC,0GAA0G;YAC1G,2GAA2G;YAC3G,oEAAoE;YACpE,qHAAqH;YACrH,MAAM,CAAC,MAAM,GAAG;YAGlB,MAAM,CAAC,MAAM,IAAI,4BAA4B,CAAA,GAAA,gBAAO,IAAI,GAAG,QAAQ;YACnE;QAEF,KAAK;YACH,MAAM,CAAC,MAAM,IAAI,CAAA,GAAA,eAAM,EAAE;YACzB;QAEF,KAAK;YACH,QAAQ;YACR,IAAI,cAAc,IAAI;gBACpB,QAAQ;gBACR,MAAM,CAAC,EAAE,MAAM,GAAG,CAAA,GAAA,YAAG,QAAQ,KAAK,QAAQ;gBAC1C,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;gBAC9B;YACF;QAEF,cAAc;QAEd;YACE,MAAM,CAAC,MAAM,IAAI,CAAA,GAAA,YAAG,EAAE;IAC1B;WACO,YAAY,CAAA,GAAA,YAAG,KAAK;IAE7B,OAAO;AACT;AAEA,IAAI,WAAW,SAAS,SAAS,KAAK,EAAE,MAAM;IAC5C,OAAO,CAAA,GAAA,eAAM,EAAE,QAAQ,CAAA,GAAA,aAAI,EAAE,QAAQ;AACvC,GAAG,2EAA2E;AAG9E,IAAI,gBAAgB,aAAa,GAAE,IAAI;AACvC,IAAI,SAAS,SAAS,OAAO,OAAO;IAClC,IAAI,QAAQ,SAAS,UAAU,CAAC,QAAQ,UAAU,4DAA4D;IAC9G,sEAAsE;IACtE,QAAQ,SAAS,GACf;IAGF,IAAI,QAAQ,QAAQ,OAChB,SAAS,QAAQ;IACrB,IAAI,iBAAiB,QAAQ,WAAW,OAAO,UAAU,QAAQ,SAAS,OAAO;IAEjF,MAAO,OAAO,SAAS,OAAQ;QAC7B,SAAS,OAAO;QAChB,IAAI,CAAC,QAAQ;IACf,EAAE,sCAAsC;IAGxC,IAAI,QAAQ,MAAM,WAAW,KAAK,MAAM,WAAW,OAAO,MAEvD,CAAC,cAAc,IAAI,SACpB;KACA,iGAAiG;IACnG,uHAAuH;IAGvH,IAAI,gBACF;IAGF,cAAc,IAAI,SAAS;IAC3B,IAAI,SAAS,EAAE;IACf,IAAI,QAAQ,SAAS,OAAO;IAC5B,IAAI,cAAc,OAAO;IAEzB,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAI,MAAM,QAAQ,IACvC,IAAK,IAAI,IAAI,GAAG,IAAI,YAAY,QAAQ,KAAK,IAC3C,QAAQ,KAAK,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,QAAQ,QAAQ,WAAW,CAAC,EAAE,IAAI,WAAW,CAAC,EAAE,GAAG,MAAM,KAAK,CAAC,EAAE;AAG/G;AACA,IAAI,cAAc,SAAS,YAAY,OAAO;IAC5C,IAAI,QAAQ,SAAS,QAAQ;QAC3B,IAAI,QAAQ,QAAQ;QAEpB,IACA,MAAM,WAAW,OAAO,OAAO,iBAAiB;QAChD,MAAM,WAAW,OAAO,IAAI;YAC1B,qBAAqB;YACrB,OAAO,CAAC,SAAS,GAAG;YACpB,QAAQ,QAAQ;QAClB;IACF;AACF;AACA,IAAI,aAAa;AAEjB,IAAI,oBAAoB,SAAS,kBAAkB,OAAO;IACxD,OAAO,QAAQ,SAAS,UAAU,QAAQ,SAAS,QAAQ,cAAc;AAC3E;AAEA,IAAI,6BAA6B,SAAS,2BAA2B,KAAK;IACxE,OAAO,SAAU,OAAO,EAAE,KAAK,EAAE,QAAQ;QACvC,IAAI,QAAQ,SAAS,UAAU,MAAM,QAAQ;QAC7C,IAAI,sBAAsB,QAAQ,MAAM,MAAM;QAE9C,IAAI,qBAAqB;YACvB,IAAI,WAAW,CAAC,CAAC,QAAQ,QAAQ,8GAA8G;YAC/I,EAAE;YACF,0BAA0B;YAC1B,OAAO;YACP,qBAAqB;YACrB,oBAAoB;YACpB,IAAI;YACJ,uCAAuC;YACvC,OAAO;YACP,QAAQ;YACR,iBAAiB;YACjB,sBAAsB;YACtB,MAAM;YACN,UAAU;YACV,IAAI;YAEJ,IAAI,mBAAmB,WAAW,QAAQ,OAAO,WACjD;YAEA,IAAK,IAAI,IAAI,iBAAiB,SAAS,GAAG,KAAK,GAAG,IAAK;gBACrD,IAAI,OAAO,gBAAgB,CAAC,EAAE;gBAE9B,IAAI,KAAK,OAAO,QAAQ,MACtB;iBACA,mFAAmF;gBACrF,kGAAkG;gBAClG,yCAAyC;gBACzC,OAAO;gBACP,eAAe;gBACf,UAAU;gBACV,IAAI;gBACJ,EAAE;gBACF,mBAAmB;gBACnB,EAAE;gBACF,oGAAoG;gBACpG,OAAO;gBACP,sBAAsB;gBACtB,IAAI;gBACJ,qEAAqE;gBACrE,2EAA2E;gBAG3E,IAAI,KAAK,SAAS,QAAQ,QAAQ;oBAChC,IAAI,kBAAkB,OACpB;oBAGF;gBACF;YACF;YAEA,oBAAoB,QAAQ,SAAU,iBAAiB;gBACrD,QAAQ,MAAM,uBAAwB,oBAAoB,mFAAqF,kBAAkB,MAAM,SAAS,CAAC,EAAE,GAAG;YACxL;QACF;IACF;AACF;AAEA,IAAI,eAAe,SAAS,aAAa,OAAO;IAC9C,OAAO,QAAQ,KAAK,WAAW,OAAO,OAAO,QAAQ,KAAK,WAAW,OAAO;AAC9E;AAEA,IAAI,8BAA8B,SAAS,4BAA4B,KAAK,EAAE,QAAQ;IACpF,IAAK,IAAI,IAAI,QAAQ,GAAG,KAAK,GAAG,IAAK;QACnC,IAAI,CAAC,aAAa,QAAQ,CAAC,EAAE,GAC3B,OAAO;IAEX;IAEA,OAAO;AACT,GAAG,gEAAgE;AACnE,6DAA6D;AAC7D,mGAAmG;AAGnG,IAAI,iBAAiB,SAAS,eAAe,OAAO;IAClD,QAAQ,OAAO;IACf,QAAQ,QAAQ;IAChB,OAAO,CAAC,SAAS,GAAG;IACpB,QAAQ,WAAW;IACnB,QAAQ,QAAQ;AAClB;AAEA,IAAI,uBAAuB,SAAS,qBAAqB,OAAO,EAAE,KAAK,EAAE,QAAQ;IAC/E,IAAI,CAAC,aAAa,UAChB;IAGF,IAAI,QAAQ,QAAQ;QAClB,QAAQ,MAAM;QACd,eAAe;IACjB,OAAO,IAAI,4BAA4B,OAAO,WAAW;QACvD,QAAQ,MAAM;QACd,eAAe;IACjB;AACF;AAEA,iCAAiC,GAEjC,SAAS,OAAO,KAAK,EAAE,MAAM;IAC3B,OAAQ,CAAA,GAAA,YAAG,EAAE,OAAO;QAClB,eAAe;QACf,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,WAAW,QAAQ;QACrC,4GAA4G;QAE5G,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QAEL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QAEL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QAEL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ;QAC1B,gEAAgE;QAEhE,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,WAAE,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,QAAQ;QACrD,uBAAuB;QAEvB,KAAK;QACL,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,QAAQ;QACvC,QAAQ;QAER,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,UAAU,QAAQ;QACjD,cAAc;QAEd,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,eAAM,EAAE,OAAO,kBAAkB,CAAA,GAAA,cAAK,IAAI,aAAa,CAAA,GAAA,UAAC,IAAI,eAAe;QACrG,aAAa;QAEb,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,eAAe,CAAA,GAAA,eAAM,EAAE,OAAO,eAAe,MAAM;QAClF,gBAAgB;QAEhB,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,mBAAmB,CAAA,GAAA,eAAM,EAAE,OAAO,6BAA6B,MAAM;QACpG,cAAc;QAEd,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,UAAU,cAAc;QACtE,aAAa;QAEb,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,SAAS,oBAAoB;QAC3E,YAAY;QAEZ,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,SAAS,CAAA,GAAA,eAAM,EAAE,OAAO,SAAS,MAAM,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,QAAQ,cAAc;QACpH,aAAa;QAEb,KAAK;YACH,OAAO,CAAA,GAAA,cAAK,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,sBAAsB,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ;QAC/E,SAAS;QAET,KAAK;YACH,OAAO,CAAA,GAAA,eAAM,EAAE,CAAA,GAAA,eAAM,EAAE,CAAA,GAAA,eAAM,EAAE,OAAO,gBAAgB,CAAA,GAAA,cAAK,IAAI,OAAO,eAAe,CAAA,GAAA,cAAK,IAAI,OAAO,OAAO,MAAM;QACpH,+BAA+B;QAE/B,KAAK;QACL,KAAK;YACH,OAAO,CAAA,GAAA,eAAM,EAAE,OAAO,qBAAqB,CAAA,GAAA,cAAK,IAAI,OAAO;QAC7D,kBAAkB;QAElB,KAAK;YACH,OAAO,CAAA,GAAA,eAAM,EAAE,CAAA,GAAA,eAAM,EAAE,OAAO,qBAAqB,CAAA,GAAA,cAAK,IAAI,gBAAgB,CAAA,GAAA,UAAC,IAAI,iBAAiB,cAAc,aAAa,CAAA,GAAA,cAAK,IAAI,QAAQ;QAChJ,sCAAsC;QAEtC,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,OAAO,CAAA,GAAA,eAAM,EAAE,OAAO,mBAAmB,CAAA,GAAA,cAAK,IAAI,UAAU;QAC9D,kDAAkD;QAElD,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACH,oDAAoD;YACpD,IAAI,CAAA,GAAA,cAAK,EAAE,SAAS,IAAI,SAAS,GAAG,OAAQ,CAAA,GAAA,cAAK,EAAE,OAAO,SAAS;gBACjE,+BAA+B;gBAC/B,KAAK;oBACH,IAAI;oBACJ,IAAI,CAAA,GAAA,cAAK,EAAE,OAAO,SAAS,OAAO,IAAI;gBACxC,kCAAkC;gBAElC,KAAK;oBACH,OAAO,CAAA,GAAA,eAAM,EAAE,OAAO,oBAAoB,OAAO,CAAA,GAAA,cAAK,IAAI,UAAU,OAAO,CAAA,GAAA,WAAE,IAAK,CAAA,CAAA,GAAA,cAAK,EAAE,OAAO,SAAS,MAAM,MAAM,OAAO,OAAM,KAAM;gBAC1I,YAAY;gBAEZ,KAAK;oBACH,OAAO,CAAC,CAAA,GAAA,eAAM,EAAE,OAAO,aAAa,OAAO,CAAA,GAAA,eAAM,EAAE,OAAO,WAAW,mBAAmB,UAAU,QAAQ;YAC9G;YACA;QACF,mBAAmB;QAEnB,KAAK;YACH,YAAY;YACZ,IAAI,CAAA,GAAA,cAAK,EAAE,OAAO,SAAS,OAAO,KAAK;QACzC,8BAA8B;QAE9B,KAAK;YACH,OAAQ,CAAA,GAAA,cAAK,EAAE,OAAO,CAAA,GAAA,cAAK,EAAE,SAAS,IAAK,CAAA,CAAC,CAAA,GAAA,eAAM,EAAE,OAAO,iBAAiB,EAAC;gBAC3E,WAAW;gBACX,KAAK;oBACH,OAAO,CAAA,GAAA,eAAM,EAAE,OAAO,KAAK,MAAM,CAAA,GAAA,cAAK,KAAK;gBAC7C,mBAAmB;gBAEnB,KAAK;oBACH,OAAO,CAAA,GAAA,eAAM,EAAE,OAAO,yBAAyB,OAAO,CAAA,GAAA,cAAK,IAAK,CAAA,CAAA,GAAA,cAAK,EAAE,OAAO,QAAQ,KAAK,YAAY,EAAC,IAAK,UAAU,OAAO,CAAA,GAAA,cAAK,IAAI,SAAS,OAAO,CAAA,GAAA,UAAC,IAAI,aAAa;YAC7K;YAEA;QACF,eAAe;QAEf,KAAK;YACH,OAAQ,CAAA,GAAA,cAAK,EAAE,OAAO,SAAS;gBAC7B,gBAAgB;gBAChB,KAAK;oBACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,sBAAsB,QAAQ;gBAC5E,gBAAgB;gBAEhB,KAAK;oBACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,sBAAsB,WAAW;gBAC/E,kBAAkB;gBAElB,KAAK;oBACH,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,CAAA,GAAA,eAAM,EAAE,OAAO,sBAAsB,QAAQ;YAC9E;YAEA,OAAO,CAAA,GAAA,cAAK,IAAI,QAAQ,CAAA,GAAA,UAAC,IAAI,QAAQ;IACzC;IAEA,OAAO;AACT;AAEA,IAAI,WAAW,SAAS,SAAS,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ;IACjE,IAAI,QAAQ,SAAS,IAAI;QAAA,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,OAAQ,QAAQ;YAC/D,KAAK,GAAA;gBACH,OAAO,CAAC,SAAS,GAAG,OAAO,QAAQ,OAAO,QAAQ;gBAClD;YAEF,KAAK,GAAA;gBACH,OAAO,CAAA,GAAA,iBAAQ,EAAE;oBAAC,CAAA,GAAA,YAAG,EAAE,SAAS;wBAC9B,OAAO,CAAA,GAAA,eAAM,EAAE,QAAQ,OAAO,KAAK,MAAM,CAAA,GAAA,cAAK;oBAChD;iBAAG,EAAE;YAEP,KAAK,GAAA;gBACH,IAAI,QAAQ,QAAQ,OAAO,CAAA,GAAA,eAAM,EAAE,QAAQ,OAAO,SAAU,KAAK;oBAC/D,OAAQ,CAAA,GAAA,aAAI,EAAE,OAAO;wBACnB,qBAAqB;wBACrB,KAAK;wBACL,KAAK;4BACH,OAAO,CAAA,GAAA,iBAAQ,EAAE;gCAAC,CAAA,GAAA,YAAG,EAAE,SAAS;oCAC9B,OAAO;wCAAC,CAAA,GAAA,eAAM,EAAE,OAAO,eAAe,MAAM,CAAA,GAAA,WAAE,IAAI;qCAAM;gCAC1D;6BAAG,EAAE;wBACP,eAAe;wBAEf,KAAK;4BACH,OAAO,CAAA,GAAA,iBAAQ,EAAE;gCAAC,CAAA,GAAA,YAAG,EAAE,SAAS;oCAC9B,OAAO;wCAAC,CAAA,GAAA,eAAM,EAAE,OAAO,cAAc,MAAM,CAAA,GAAA,cAAK,IAAI;qCAAY;gCAClE;gCAAI,CAAA,GAAA,YAAG,EAAE,SAAS;oCAChB,OAAO;wCAAC,CAAA,GAAA,eAAM,EAAE,OAAO,cAAc,MAAM,CAAA,GAAA,WAAE,IAAI;qCAAM;gCACzD;gCAAI,CAAA,GAAA,YAAG,EAAE,SAAS;oCAChB,OAAO;wCAAC,CAAA,GAAA,eAAM,EAAE,OAAO,cAAc,CAAA,GAAA,UAAC,IAAI;qCAAY;gCACxD;6BAAG,EAAE;oBACT;oBAEA,OAAO;gBACT;QACJ;IAAA;AACF;AAEA,IAAI,uBAAuB;IAAC;CAAS;AAErC,IAAI,cAAc,SAAS,YAAY,OAAO;IAC5C,IAAI,MAAM,QAAQ;IAElB,IAA6C,CAAC,KAC5C,MAAM,IAAI,MAAM;IAGlB,IAAI,QAAQ,OAAO;QACjB,IAAI,YAAY,SAAS,iBAAiB,sCAAsC,uDAAuD;QACvI,0HAA0H;QAC1H,+FAA+F;QAC/F,oEAAoE;QAEpE,MAAM,UAAU,QAAQ,KAAK,WAAW,SAAU,IAAI;YACpD,uFAAuF;YACvF,sFAAsF;YACtF,yHAAyH;YACzH,qIAAqI;YACrI,sGAAsG;YACtG,2DAA2D;YAC3D,IAAI,uBAAuB,KAAK,aAAa;YAE7C,IAAI,qBAAqB,QAAQ,SAAS,IACxC;YAEF,SAAS,KAAK,YAAY;YAC1B,KAAK,aAAa,UAAU;QAC9B;IACF;IAEA,IAAI,gBAAgB,QAAQ,iBAAiB;IAG3C,aAAa;IACb,IAAI,UAAU,KAAK,MACjB,MAAM,IAAI,MAAM,iFAAkF,MAAM;IAI5G,IAAI,WAAW,CAAC;IAChB,IAAI;IACJ,IAAI,iBAAiB,EAAE;IAGrB,YAAY,QAAQ,aAAa,SAAS;IAC1C,MAAM,UAAU,QAAQ,KACxB,oGAAoG;IACpG,SAAS,iBAAiB,0BAA2B,MAAM,QAAS,SAAU,IAAI;QAChF,IAAI,SAAS,KAAK,aAAa,gBAAgB,MAAM,MAAM,aAAa;QAExE,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IACjC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG;QAGxB,eAAe,KAAK;IACtB;IAGF,IAAI;IAEJ,IAAI,qBAAqB;QAAC;QAAQ;KAAY;IAG5C,mBAAmB,KAAK,2BAA2B;QACjD,IAAI,UAAS;YACX,OAAO,MAAM;QACf;IAEF,IAAI;IAIJ,IAAI;IACJ,IAAI,oBAAoB;QAAC,CAAA,GAAA,iBAAQ;QAA2C,SAAU,OAAO;YAC3F,IAAI,CAAC,QAAQ,MAAM;gBACjB,IAAI,OAAO,CAAC,SAAS,EACnB,aAAa,OAAO,OAAO,CAAC,SAAS;qBAChC,IAAI,QAAQ,SAAS,QAAQ,SAAS,CAAA,GAAA,eAAM,GACjD,mDAAmD;gBACnD,6FAA6F;gBAC7F,aAAa,OAAO,QAAQ,QAAQ;YAExC;QACF;KAEG;IACH,IAAI,aAAa,CAAA,GAAA,kBAAS,EAAE,mBAAmB,OAAO,eAAe;IAErE,IAAI,SAAS,SAAS,OAAO,MAAM;QACjC,OAAO,CAAA,GAAA,iBAAQ,EAAE,CAAA,GAAA,eAAM,EAAE,SAAS;IACpC;IAEA,UAAU,SAAS,OAAO,QAAQ,EAAE,UAAU,EAAE,KAAK,EAAE,WAAW;QAChE,eAAe;QAEf,IAA6C,WAAW,QAAQ,WAC9D,eAAe;YACb,QAAQ,SAAS,OAAO,IAAI;gBAC1B,MAAM,OAAO,OAAO,WAAW;YACjC;QACF;QAGF,OAAO,WAAW,WAAW,MAAM,WAAW,SAAS,MAAM,WAAW;QAExE,IAAI,aACF,MAAM,QAAQ,CAAC,WAAW,KAAK,GAAG;IAEtC;IAGF,IAAI,QAAQ;QACV,KAAK;QACL,OAAO,IAAI,CAAA,GAAA,iBAAS,EAAE;YACpB,KAAK;YACL,WAAW;YACX,OAAO,QAAQ;YACf,QAAQ,QAAQ;YAChB,SAAS,QAAQ;YACjB,gBAAgB,QAAQ;QAC1B;QACA,OAAO,QAAQ;QACf,UAAU;QACV,YAAY,CAAC;QACb,QAAQ;IACV;IACA,MAAM,MAAM,QAAQ;IACpB,OAAO;AACT;;;ACpkBA;;;;;;;;;;;;;;;;;;;;;AAqBA,GACA,aAAa;;;AAmIb,gDAAS;AAlIT,SAAS,YAAY,GAAG;IACtB,IAAI,IAAI,OACN,aAAa;IACb,OAAO,IAAI;KACX,2CAA2C;IAE7C,wBAAwB,GAGxB,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,YAAY,QAAQ,IAAK;QACpD,IAAI,SAAS,WAAW,CAAC,EAAE,CAAC,cAAc,KACxC,aAAa;QACb,OAAO,SAAS,WAAW,CAAC,EAAE;IAElC;AACF;AAEA,SAAS,mBAAmB,OAAO;IACjC,IAAI,MAAM,SAAS,cAAc;IACjC,IAAI,aAAa,gBAAgB,QAAQ;IAEzC,IAAI,QAAQ,UAAU,WACpB,IAAI,aAAa,SAAS,QAAQ;IAGpC,IAAI,YAAY,SAAS,eAAe;IACxC,IAAI,aAAa,UAAU;IAC3B,OAAO;AACT;AAEA,IAAI,aAAa,WAAW,GAAE;IAC5B,wEAAwE;IACxE,SAAS,WAAW,OAAO;QACzB,IAAI,QAAQ,IAAI;QAEhB,IAAI,CAAC,aAAa,SAAU,GAAG;YAC7B,IAAI;YAEJ,IAAI,MAAM,KAAK,WAAW,GAAG;gBAC3B,IAAI,MAAM,gBACR,SAAS,MAAM,eAAe;qBACzB,IAAI,MAAM,SACf,SAAS,MAAM,UAAU;qBAEzB,SAAS,MAAM;YAEnB,OACE,SAAS,MAAM,IAAI,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;YAG7C,MAAM,UAAU,aAAa,KAAK;YAElC,MAAM,KAAK,KAAK;QAClB;QAEA,IAAI,CAAC,WAAW,QAAQ,WAAW,YAAY,QAAwC,QAAQ;QAC/F,IAAI,CAAC,OAAO,EAAE;QACd,IAAI,CAAC,MAAM;QACX,IAAI,CAAC,QAAQ,QAAQ,OAAO,yFAAyF;QAErH,IAAI,CAAC,MAAM,QAAQ;QACnB,IAAI,CAAC,YAAY,QAAQ;QACzB,IAAI,CAAC,UAAU,QAAQ;QACvB,IAAI,CAAC,iBAAiB,QAAQ;QAC9B,IAAI,CAAC,SAAS;IAChB;IAEA,IAAI,SAAS,WAAW;IAExB,OAAO,UAAU,SAAS,QAAQ,KAAK;QACrC,MAAM,QAAQ,IAAI,CAAC;IACrB;IAEA,OAAO,SAAS,SAAS,OAAO,IAAI;QAClC,oFAAoF;QACpF,mFAAmF;QACnF,qDAAqD;QACrD,IAAI,IAAI,CAAC,MAAO,CAAA,IAAI,CAAC,WAAW,QAAQ,CAAA,MAAO,GAC7C,IAAI,CAAC,WAAW,mBAAmB,IAAI;QAGzC,IAAI,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE;QAGvC,IAAI,eAAe,KAAK,WAAW,OAAO,MAAM,KAAK,WAAW,OAAO;QAEvE,IAAI,gBAAgB,IAAI,CAAC,sCACvB,+CAA+C;QAC/C,sEAAsE;QACtE,uCAAuC;QACvC,QAAQ,MAAM,sDAAsD,OAAO;QAE7E,IAAI,CAAC,uCAAuC,IAAI,CAAC,wCAAwC,CAAC;QAG5F,IAAI,IAAI,CAAC,UAAU;YACjB,IAAI,QAAQ,YAAY;YAExB,IAAI;gBACF,uDAAuD;gBACvD,iEAAiE;gBACjE,MAAM,WAAW,MAAM,MAAM,SAAS;YACxC,EAAE,OAAO,GAAG;gBACV,IAA6C,CAAC,4IAA4I,KAAK,OAC7L,QAAQ,MAAM,wDAAyD,OAAO,KAAM;YAExF;QACF,OACE,IAAI,YAAY,SAAS,eAAe;QAG1C,IAAI,CAAC;IACP;IAEA,OAAO,QAAQ,SAAS;QACtB,aAAa;QACb,IAAI,CAAC,KAAK,QAAQ,SAAU,GAAG;YAC7B,OAAO,IAAI,cAAc,IAAI,WAAW,YAAY;QACtD;QACA,IAAI,CAAC,OAAO,EAAE;QACd,IAAI,CAAC,MAAM;QAGT,IAAI,CAAC,uCAAuC;IAEhD;IAEA,OAAO;AACT;;;;;AEvJU,6CAAA;AAAA,6CAAA;AAAA,mDAAA;AAAA,iDAAA;AAAA,8CAAA;AAAA,+CAAA;AAAA,yDAAA;AAAA,4CAAA;AAAA,+CAAA;AAAA,2CAAA;AAAA,2CAAA;AAAA,yCAAA;AAAA,wCAAA;AAAA,+CAAA;AAAA,0CAAA;AAAA,6CAAA;AAAA,8CAAA;AAAA,8CAAA;AAAA,4CAAA;AAAA,yCAAA;AAAA,2CAAA;AAAA,4CAAA;AAAA,4CAAA;AAAA,2CAAA;AAAA,0CAAA;AAAA,+CAAA;AAAA,gDAAA;AAAA,4CAAA;AAAA,4CAAA;AAAA,6CAAA;AAAA,6CAAA;AAAA,+CAAA;AAAA,6CAAA;AAAA,0CAAA;AAAA,6CAAA;AAAA,iDAAA;AAAA,6CAAA;AAAA,+CAAA;AAAA,8CAAA;AAAA,0CAAA;AAAA,0CAAA;AAAA,gDAAA;AAAA,6CAAA;AAAA,4CAAA;AAAA,0CAAA;AAAA,2CAAA;AAAA,gDAAA;AAAA,+CAAA;AAAA,0CAAA;AAAA,0CAAA;AAAA,2CAAA;AAAA,0CAAA;AAAA,8CAAA;AAAA,4CAAA;AAAA,8CAAA;AAAA,0CAAA;AAAA,6CAAA;AAAA,6CAAA;AAAA,+CAAA;AAAA,+CAAA;AAAA,4CAAA;AAAA,2CAAA;AAAA,+CAAA;AAAA,4CAAA;AAAA,4CAAA;AAAA,2CAAA;AAAA,8CAAA;AAAA,+CAAA;AAAA,0CAAA;AAAA,gDAAA;AAAA,IAACA,IAAK;AACN,IAACC,IAAM;AACP,IAACC,IAAS;AAEV,IAACC,IAAU;AACX,IAACC,IAAU;AACX,IAACC,IAAc;AAEf,IAACC,IAAO;AACR,IAACC,IAAQ;AACT,IAACC,IAAS;AACV,IAACC,IAAU;AACX,IAACC,IAAW;AACZ,IAACC,IAAW;AACZ,IAACC,IAAW;AACZ,IAACC,IAAY;AACb,IAACC,IAAY;AACb,IAACC,IAAY;AACb,IAACC,IAAgB;AACjB,IAACC,IAAsB;AACvB,IAACC,IAAQ;AChBT,IAACC,IAAMC,KAAKD;AAMZ,IAACE,IAAOC,OAAOC;AAMf,IAACC,IAASC,OAAOD;AAOpB,SAASE,EAAMC,CAAAA,EAAOC,CAAAA;IAC5B,OAAOC,EAAOF,GAAO,KAAK,KAAA,AAAA,CAAA,AAAA,CAAA,AAAYC,CAAAA,KAAU,IAAKC,EAAOF,GAAO,EAAA,KAAO,IAAKE,EAAOF,GAAO,EAAA,KAAO,IAAKE,EAAOF,GAAO,EAAA,KAAO,IAAKE,EAAOF,GAAO,KAAK;AAAA;AAOhJ,SAASG,EAAMH,CAAAA;IACrB,OAAOA,EAAMG;AAAAA;AAQP,SAASC,EAAOJ,CAAAA,EAAOK,CAAAA;IAC7B,OAAA,AAAQL,CAAAA,IAAQK,EAAQC,KAAKN,EAAAA,IAAUA,CAAAA,CAAM,EAAA,GAAKA;AAAAA;AASnD,SAAgBO,EAASP,CAAAA,EAAOK,CAAAA,EAASG,CAAAA;IACxC,OAAOR,EAAMO,QAAQF,GAASG;AAAAA;AAQxB,SAASC,EAAST,CAAAA,EAAOU,CAAAA;IAC/B,OAAOV,EAAMW,QAAQD;AAAAA;AAQf,SAASR,EAAQF,CAAAA,EAAOY,CAAAA;IAC9B,OAAOZ,EAAMa,WAAWD,KAAS;AAAA;AASlC,SAAgBE,EAAQd,CAAAA,EAAOe,CAAAA,EAAOC,CAAAA;IACrC,OAAOhB,EAAMiB,MAAMF,GAAOC;AAAAA;AAOpB,SAASE,EAAQlB,CAAAA;IACvB,OAAOA,EAAMC;AAAAA;AAOP,SAASkB,EAAQnB,CAAAA;IACvB,OAAOA,EAAMC;AAAAA;AAQP,SAASmB,EAAQpB,CAAAA,EAAOqB,CAAAA;IAC9B,OAAOA,EAAMC,KAAKtB,IAAQA;AAAAA;AAQpB,SAASuB,EAASF,CAAAA,EAAOG,CAAAA;IAC/B,OAAOH,EAAMI,IAAID,GAAUE,KAAK;AAAA;AC/GvB,IAACC,IAAO;AAClB,IAAWC,IAAS;AACpB,IAAW3B,IAAS;AACpB,IAAW4B,IAAW;AACtB,IAAWC,IAAY;AACvB,IAAWC,IAAa;AAWjB,SAASC,EAAMhC,CAAAA,EAAOiC,CAAAA,EAAMC,CAAAA,EAAQC,CAAAA,EAAMC,CAAAA,EAAOC,CAAAA,EAAUpC,CAAAA;IACjE,OAAO;QAACD,OAAOA;QAAOiC,MAAMA;QAAMC,QAAQA;QAAQC,MAAMA;QAAMC,OAAOA;QAAOC,UAAUA;QAAUV,MAAMA;QAAMC,QAAQA;QAAQ3B,QAAQA;QAAQqC,QAAQ;IAAA;AAAA;AAQ9I,SAASC,EAAMN,CAAAA,EAAMG,CAAAA;IAC3B,OAAOvC,EAAOmC,EAAK,IAAI,MAAM,MAAM,IAAI,MAAM,MAAM,IAAIC,GAAM;QAAChC,QAAAA,CAASgC,EAAKhC;IAAAA,GAASmC;AAAAA;AAMtF,SAAgBI;IACf,OAAOV;AAAAA;AAMR,SAAgBW;IACfX,IAAYD,IAAW,IAAI3B,EAAO6B,GAAAA,EAAcF,KAAY;IAE5D,IAAID,KAAUE,MAAc,IAC3BF,IAAS,GAAGD;IAEb,OAAOG;AAAAA;AAMR,SAAgBY;IACfZ,IAAYD,IAAW5B,IAASC,EAAO6B,GAAYF,OAAc;IAEjE,IAAID,KAAUE,MAAc,IAC3BF,IAAS,GAAGD;IAEb,OAAOG;AAAAA;AAMR,SAAgBa;IACf,OAAOzC,EAAO6B,GAAYF;AAAAA;AAM3B,SAAgBe;IACf,OAAOf;AAAAA;AAQD,SAASZ,EAAOF,CAAAA,EAAOC,CAAAA;IAC7B,OAAOF,EAAOiB,GAAYhB,GAAOC;AAAAA;AAO3B,SAAS6B,EAAOV,CAAAA;IACtB,OAAQA;QAEP,KAAK;QAAG,KAAK;QAAG,KAAK;QAAI,KAAK;QAAI,KAAK;YACtC,OAAO;QAER,KAAK;QAAI,KAAK;QAAI,KAAK;QAAI,KAAK;QAAI,KAAK;QAAI,KAAK;QAAI,KAAK;QAE3D,KAAK;QAAI,KAAK;QAAK,KAAK;YACvB,OAAO;QAER,KAAK;YACJ,OAAO;QAER,KAAK;QAAI,KAAK;QAAI,KAAK;QAAI,KAAK;YAC/B,OAAO;QAER,KAAK;QAAI,KAAK;YACb,OAAO;IAAA;IAGT,OAAO;AAAA;AAOD,SAASW,EAAO9C,CAAAA;IACtB,OAAO2B,IAAOC,IAAS,GAAG3B,IAASiB,EAAOa,IAAa/B,IAAQ6B,IAAW,GAAG,EAAA;AAAA;AAOvE,SAASkB,EAAS/C,CAAAA;IACxB,OAAO+B,IAAa,IAAI/B;AAAAA;AAOlB,SAASgD,EAASb,CAAAA;IACxB,OAAOhC,EAAKc,EAAMY,IAAW,GAAGoB,GAAUd,MAAS,KAAKA,IAAO,IAAIA,MAAS,KAAKA,IAAO,IAAIA;AAAAA;AAOtF,SAASe,EAAUlD,CAAAA;IACzB,OAAO+C,EAAQI,EAAUL,EAAM9C;AAAAA;AAOzB,SAASoD,EAAYjB,CAAAA;IAC3B,MAAOL,IAAYa,IAClB,IAAIb,IAAY,IACfY;SAEA;IAEF,OAAOG,EAAMV,KAAQ,KAAKU,EAAMf,KAAa,IAAI,KAAK;AAAA;AAOhD,SAASqB,EAAWd,CAAAA;IAC1B,MAAOK,IACN,OAAQG,EAAMf;QACb,KAAK;YAAGV,EAAOiC,GAAWxB,IAAW,IAAIQ;YACxC;QACD,KAAK;YAAGjB,EAAO4B,EAAQlB,IAAYO;YAClC;QACD;YAASjB,EAAO1B,EAAKoC,IAAYO;IAAAA;IAGnC,OAAOA;AAAAA;AAQD,SAASiB,GAAU1C,CAAAA,EAAO2C,CAAAA;IAChC,MAAA,EAASA,KAASb,IAEjB,IAAIZ,IAAY,MAAMA,IAAY,OAAQA,IAAY,MAAMA,IAAY,MAAQA,IAAY,MAAMA,IAAY,IAC7G;IAEF,OAAOb,EAAML,GAAOgC,MAAWW,CAAAA,IAAQ,KAAKZ,OAAU,MAAMD,OAAU,EAAA;AAAA;AAOhE,SAASO,GAAWd,CAAAA;IAC1B,MAAOO,IACN,OAAQZ;QAEP,KAAKK;YACJ,OAAON;QAER,KAAK;QAAI,KAAK;YACb,IAAIM,MAAS,MAAMA,MAAS,IAC3Bc,GAAUnB;YACX;QAED,KAAK;YACJ,IAAIK,MAAS,IACZc,GAAUd;YACX;QAED,KAAK;YACJO;YACA;IAAA;IAGH,OAAOb;AAAAA;AAQD,SAAS2B,GAAWrB,CAAAA,EAAMvB,CAAAA;IAChC,MAAO8B,IAEN,IAAIP,IAAOL,MAAc,IACxB;SAEI,IAAIK,IAAOL,MAAc,MAAWa,QAAW,IACnD;IAEF,OAAO,OAAO1B,EAAML,GAAOiB,IAAW,KAAK,MAAMnC,EAAKyC,MAAS,KAAKA,IAAOO;AAAAA;AAOrE,SAASW,GAAYzC,CAAAA;IAC3B,MAAA,CAAQiC,EAAMF,KACbD;IAED,OAAOzB,EAAML,GAAOiB;AAAAA;AC5Od,SAAS4B,GAASzD,CAAAA;IACxB,OAAO+C,EAAQW,GAAM,IAAI,MAAM,MAAM,MAAM;QAAC;KAAA,EAAK1D,IAAQ8C,EAAM9C,IAAQ,GAAG;QAAC;KAAA,EAAIA;AAAAA;AAehF,SAAgB0D,GAAO1D,CAAAA,EAAOiC,CAAAA,EAAMC,CAAAA,EAAQyB,CAAAA,EAAMC,CAAAA,EAAOC,CAAAA,EAAUC,CAAAA,EAAQC,CAAAA,EAAQC,CAAAA;IAClF,IAAIpD,IAAQ;IACZ,IAAIqD,IAAS;IACb,IAAIhE,IAAS6D;IACb,IAAII,IAAS;IACb,IAAIC,IAAW;IACf,IAAIC,IAAW;IACf,IAAIC,IAAW;IACf,IAAIC,IAAW;IACf,IAAIC,IAAY;IAChB,IAAIzC,IAAY;IAChB,IAAIK,IAAO;IACX,IAAIC,IAAQwB;IACZ,IAAIvB,IAAWwB;IACf,IAAIW,IAAYb;IAChB,IAAI5B,IAAaI;IAEjB,MAAOmC,EACN,OAAQF,IAAWtC,GAAWA,IAAYY;QAEzC,KAAK;YACJ,IAAI0B,KAAY,OAAOlE,EAAO6B,GAAY9B,IAAS,MAAM,IAAI;gBAC5D,IAAIQ,EAAQsB,KAAcxB,EAAQyC,EAAQlB,IAAY,KAAK,QAAQ,UAAA,IAClEyC,IAAAA;gBACD;YAAA;QAGF,KAAK;QAAI,KAAK;QAAI,KAAK;YACtBxC,KAAciB,EAAQlB;YACtB;QAED,KAAK;QAAG,KAAK;QAAI,KAAK;QAAI,KAAK;YAC9BC,KAAcqB,EAAWgB;YACzB;QAED,KAAK;YACJrC,KAAcuB,GAASV,MAAU,GAAG;YACpC;QAED,KAAK;YACJ,OAAQD;gBACP,KAAK;gBAAI,KAAK;oBACbvB,EAAOqD,GAAQjB,GAAUd,KAAQE,MAAUX,GAAMC,IAAS8B;oBAC1D;gBACD;oBACCjC,KAAc;YAAA;YAEhB;QAED,KAAK,MAAMsC;YACVN,CAAAA,CAAOnD,IAAAA,GAAWM,EAAOa,KAAcwC;QAExC,KAAK,MAAMF;QAAU,KAAK;QAAI,KAAK;YAClC,OAAQvC;gBAEP,KAAK;gBAAG,KAAK;oBAAKwC,IAAW;gBAE7B,KAAK,KAAKL;oBAAQ,IAAIM,KAAAA,IAAiBxC,IAAaxB,EAAQwB,GAAY,OAAO;oBAC9E,IAAIoC,IAAW,KAAMjD,EAAOa,KAAc9B,GACzCmB,EAAO+C,IAAW,KAAKO,GAAY3C,IAAa,KAAK4B,GAAMzB,GAAQjC,IAAS,KAAKyE,GAAYnE,EAAQwB,GAAY,KAAK,MAAM,KAAK4B,GAAMzB,GAAQjC,IAAS,IAAI+D;oBAC7J;gBAED,KAAK;oBAAIjC,KAAc;gBAEvB;oBACCX,EAAOoD,IAAYG,GAAQ5C,GAAYE,GAAMC,GAAQtB,GAAOqD,GAAQL,GAAOG,GAAQ5B,GAAMC,IAAQ,EAAA,EAAIC,IAAW,EAAA,EAAIpC,IAAS4D;oBAE7H,IAAI/B,MAAc;wBACjB,IAAImC,MAAW,GACdP,GAAM3B,GAAYE,GAAMuC,GAAWA,GAAWpC,GAAOyB,GAAU5D,GAAQ8D,GAAQ1B;6BAE/E,OAAQ6B,MAAW,MAAMhE,EAAO6B,GAAY,OAAO,MAAM,MAAMmC;4BAE9D,KAAK;4BAAK,KAAK;4BAAK,KAAK;4BAAK,KAAK;gCAClCR,GAAM1D,GAAOwE,GAAWA,GAAWb,KAAQvC,EAAOuD,GAAQ3E,GAAOwE,GAAWA,GAAW,GAAG,GAAGZ,GAAOG,GAAQ5B,GAAMyB,GAAOxB,IAAQ,EAAA,EAAInC,IAASoC,IAAWuB,GAAOvB,GAAUpC,GAAQ8D,GAAQJ,IAAOvB,IAAQC;gCACzM;4BACD;gCACCqB,GAAM3B,GAAYyC,GAAWA,GAAWA,GAAW;oCAAC;iCAAA,EAAKnC,GAAU,GAAG0B,GAAQ1B;wBAAAA;;YAAAA;YAIpFzB,IAAQqD,IAASE,IAAW,GAAGE,IAAWE,IAAY,GAAGpC,IAAOJ,IAAa,IAAI9B,IAAS6D;YAC1F;QAED,KAAK;YACJ7D,IAAS,IAAIiB,EAAOa,IAAaoC,IAAWC;QAC7C;YACC,IAAIC,IAAW,GACd;gBAAA,IAAIvC,KAAa,KAAA,EACduC;qBACE,IAAIvC,KAAa,OAAOuC,OAAc,KAAK5B,OAAU,KACzD;YAAA;YAEF,OAAQV,KAAcrC,EAAKoC,IAAYA,IAAYuC;gBAElD,KAAK;oBACJE,IAAYN,IAAS,IAAI,IAAKlC,CAAAA,KAAc,MAAA,EAAO;oBACnD;gBAED,KAAK;oBACJgC,CAAAA,CAAOnD,IAAAA,GAAAA,AAAYM,CAAAA,EAAOa,KAAc,CAAA,IAAKwC,GAAWA,IAAY;oBACpE;gBAED,KAAK;oBAEJ,IAAI5B,QAAW,IACdZ,KAAciB,EAAQN;oBAEvBwB,IAASvB,KAAQsB,IAAShE,IAASiB,EAAOiB,IAAOJ,KAAcsB,GAAWT,OAAWd;oBACrF;gBAED,KAAK;oBACJ,IAAIsC,MAAa,MAAMlD,EAAOa,MAAe,GAC5CsC,IAAW;YAAA;IAAA;IAIjB,OAAOR;AAAAA;AAiBR,SAAgBc,GAAS3E,CAAAA,EAAOiC,CAAAA,EAAMC,CAAAA,EAAQtB,CAAAA,EAAOqD,CAAAA,EAAQL,CAAAA,EAAOG,CAAAA,EAAQ5B,CAAAA,EAAMC,CAAAA,EAAOC,CAAAA,EAAUpC,CAAAA;IAClG,IAAI2E,IAAOX,IAAS;IACpB,IAAIN,IAAOM,MAAW,IAAIL,IAAQ;QAAC;KAAA;IACnC,IAAIiB,IAAO1D,EAAOwC;IAElB,IAAK,IAAImB,IAAI,GAAGC,IAAI,GAAGC,IAAI,GAAGF,IAAIlE,GAAAA,EAASkE,EAC1C,IAAK,IAAIG,IAAI,GAAGC,IAAIpE,EAAOd,GAAO4E,IAAO,GAAGA,IAAOpF,EAAIuF,IAAIhB,CAAAA,CAAOe,EAAAA,IAAMK,IAAInF,GAAOiF,IAAIJ,GAAAA,EAAQI,EAC9F,IAAIE,IAAIhF,EAAK4E,IAAI,IAAIpB,CAAAA,CAAKsB,EAAAA,GAAK,MAAMC,IAAI3E,EAAQ2E,GAAG,QAAQvB,CAAAA,CAAKsB,EAAAA,IAChE7C,CAAAA,CAAM4C,IAAAA,GAAOG;IAEhB,OAAOnD,EAAKhC,GAAOiC,GAAMC,GAAQ+B,MAAW,IAAIxF,IAAU0D,GAAMC,GAAOC,GAAUpC;AAAAA;AASlF,SAAgBwE,GAASzE,CAAAA,EAAOiC,CAAAA,EAAMC,CAAAA;IACrC,OAAOF,EAAKhC,GAAOiC,GAAMC,GAAQ1D,GAASkB,EAAK8C,MAAS1B,EAAOd,GAAO,GAAA,KAAQ;AAAA;AAU/E,SAAgB0E,GAAa1E,CAAAA,EAAOiC,CAAAA,EAAMC,CAAAA,EAAQjC,CAAAA;IACjD,OAAO+B,EAAKhC,GAAOiC,GAAMC,GAAQxD,GAAaoC,EAAOd,GAAO,GAAGC,IAASa,EAAOd,GAAOC,IAAS,GAAA,KAAQA;AAAAA;ACpLxG,SAAgBmF,GAAQpF,CAAAA,EAAOC,CAAAA,EAAQoC,CAAAA;IACtC,OAAQtC,EAAKC,GAAOC;QAEnB,KAAK;YACJ,OAAO1B,IAAS,WAAWyB,IAAQA;QAEpC,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAEvE,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAE5D,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAE5D,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;YAC3D,OAAOzB,IAASyB,IAAQA;QAEzB,KAAK;YACJ,OAAO1B,IAAM0B,IAAQA;QAEtB,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;YAChD,OAAOzB,IAASyB,IAAQ1B,IAAM0B,IAAQ3B,IAAK2B,IAAQA;QAEpD,KAAK;YACJ,OAAQE,EAAOF,GAAOC,IAAS;gBAE9B,KAAK;oBACJ,OAAO1B,IAASyB,IAAQ3B,IAAKkC,EAAQP,GAAO,sBAAsB,QAAQA;gBAE3E,KAAK;oBACJ,OAAOzB,IAASyB,IAAQ3B,IAAKkC,EAAQP,GAAO,sBAAsB,WAAWA;gBAE9E,KAAK;oBACJ,OAAOzB,IAASyB,IAAQ3B,IAAKkC,EAAQP,GAAO,sBAAsB,QAAQA;YAAAA;QAI7E,KAAK;QAAM,KAAK;QAAM,KAAK;YAC1B,OAAOzB,IAASyB,IAAQ3B,IAAK2B,IAAQA;QAEtC,KAAK;YACJ,OAAOzB,IAASyB,IAAQ3B,IAAK,UAAU2B,IAAQA;QAEhD,KAAK;YACJ,OAAOzB,IAASyB,IAAQO,EAAQP,GAAO,kBAAkBzB,IAAS,aAAaF,IAAK,eAAe2B;QAEpG,KAAK;YACJ,OAAOzB,IAASyB,IAAQ3B,IAAK,eAAekC,EAAQP,GAAO,gBAAgB,MAAA,CAAA,CAAQI,EAAMJ,GAAO,oBAAoB3B,IAAK,cAAckC,EAAQP,GAAO,gBAAgB,MAAM,EAAA,IAAMA;QAEnL,KAAK;YACJ,OAAOzB,IAASyB,IAAQ3B,IAAK,mBAAmBkC,EAAQP,GAAO,8BAA8B,MAAMA;QAEpG,KAAK;YACJ,OAAOzB,IAASyB,IAAQ3B,IAAKkC,EAAQP,GAAO,UAAU,cAAcA;QAErE,KAAK;YACJ,OAAOzB,IAASyB,IAAQ3B,IAAKkC,EAAQP,GAAO,SAAS,oBAAoBA;QAE1E,KAAK;YACJ,OAAOzB,IAAS,SAASgC,EAAQP,GAAO,SAAS,MAAMzB,IAASyB,IAAQ3B,IAAKkC,EAAQP,GAAO,QAAQ,cAAcA;QAEnH,KAAK;YACJ,OAAOzB,IAASgC,EAAQP,GAAO,sBAAsB,OAAOzB,IAAS,QAAQyB;QAE9E,KAAK;YACJ,OAAOO,EAAQA,EAAQA,EAAQP,GAAO,gBAAgBzB,IAAS,OAAO,eAAeA,IAAS,OAAOyB,GAAO,MAAMA;QAEnH,KAAK;QAAM,KAAK;YACf,OAAOO,EAAQP,GAAO,qBAAqBzB,IAAS,OAAO;QAE5D,KAAK;YACJ,OAAOgC,EAAQA,EAAQP,GAAO,qBAAqBzB,IAAS,gBAAgBF,IAAK,iBAAiB,cAAc,aAAaE,IAASyB,IAAQA;QAE/I,KAAK;YACJ,IAAA,CAAKI,EAAMJ,GAAO,mBAAmB,OAAO3B,IAAK,sBAAsByC,EAAOd,GAAOC,KAAUD;YAC/F;QAED,KAAK;QAAM,KAAK;YACf,OAAO3B,IAAKkC,EAAQP,GAAO,aAAa,MAAMA;QAE/C,KAAK;QAAM,KAAK;YACf,IAAIqC,KAAYA,EAASgD,KAAK,SAAUC,CAAAA,EAAS1E,CAAAA;gBAAS,OAAOX,IAASW,GAAOR,EAAMkF,EAAQlD,OAAO;YAAA,IACrG,OAAA,CAAQ3B,EAAQT,IAASqC,CAAAA,IAAWA,CAAAA,CAASpC,EAAAA,CAAQD,KAAAA,GAAQ,UAAUA,IAAS3B,IAAKkC,EAAQP,GAAO,UAAU,MAAMA,IAAQ3B,IAAK,mBAAA,CAAA,CAAqBoC,EAAQ4B,GAAU,UAAUjC,EAAMiC,GAAU,SAAA,CAAUjC,EAAMiC,GAAU,SAAA,CAAUjC,EAAMJ,GAAO,MAAA,IAAU;YAE9P,OAAO3B,IAAKkC,EAAQP,GAAO,UAAU,MAAMA;QAE5C,KAAK;QAAM,KAAK;YACf,OAAQqC,KAAYA,EAASgD,KAAK,SAAUC,CAAAA;gBAAW,OAAOlF,EAAMkF,EAAQlD,OAAO;YAAA,KAAwBpC,IAAQ3B,IAAKkC,EAAQA,EAAQP,GAAO,QAAQ,UAAU,SAAS,MAAMA;QAEjL,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;YACrC,OAAOO,EAAQP,GAAO,mBAAmBzB,IAAS,UAAUyB;QAE7D,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QACtC,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QACtC,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;YAErC,IAAIkB,EAAOlB,KAAS,IAAIC,IAAS,GAChC,OAAQC,EAAOF,GAAOC,IAAS;gBAE9B,KAAK;oBAEJ,IAAIC,EAAOF,GAAOC,IAAS,OAAO,IACjC;gBAEF,KAAK;oBACJ,OAAOM,EAAQP,GAAO,oBAAoB,OAAOzB,IAAS,UAAU,OAAOD,IAAO4B,CAAAA,EAAOF,GAAOC,IAAS,MAAM,MAAM,OAAO,OAAA,KAAYD;gBAEzI,KAAK;oBACJ,OAAA,CAAQS,EAAQT,GAAO,aAAaoF,GAAO7E,EAAQP,GAAO,WAAW,mBAAmBC,GAAQoC,KAAYrC,IAAQA;YAAAA;YAEvH;QAED,KAAK;QAAM,KAAK;YACf,OAAOO,EAAQP,GAAO,6CAA6C,SAAUuF,CAAAA,EAAGC,CAAAA,EAAGC,CAAAA,EAAGC,CAAAA,EAAGC,CAAAA,EAAGC,CAAAA,EAAGC,CAAAA;gBAAK,OAAQxH,IAAKmH,IAAI,MAAMC,IAAII,IAAMH,CAAAA,IAAKrH,IAAKmH,IAAI,WAAYG,CAAAA,IAAIC,IAAAA,CAAKA,IAAAA,CAAKH,CAAAA,IAAMI,IAAI,EAAA,IAAM7F;YAAAA;QAE9L,KAAK;YAEJ,IAAIE,EAAOF,GAAOC,IAAS,OAAO,KACjC,OAAOM,EAAQP,GAAO,KAAK,MAAMzB,KAAUyB;YAC5C;QAED,KAAK;YACJ,OAAQE,EAAOF,GAAOE,EAAOF,GAAO,QAAQ,KAAK,KAAK;gBAErD,KAAK;oBACJ,OAAOO,EAAQP,GAAO,iCAAiC,OAAOzB,IAAU2B,CAAAA,EAAOF,GAAO,QAAQ,KAAK,YAAY,EAAA,IAAM,UAAU,OAAOzB,IAAS,SAAS,OAAOF,IAAK,aAAa2B;gBAElL,KAAK;oBACJ,OAAOO,EAAQP,GAAO,KAAK,MAAM3B,KAAM2B;YAAAA;YAEzC;QAED,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;QAAM,KAAK;YAChD,OAAOO,EAAQP,GAAO,WAAW,kBAAkBA;IAAAA;IAGrD,OAAOA;AAAAA;ACvID,SAAS8F,GAAWzD,CAAAA,EAAUb,CAAAA;IACpC,IAAIuE,IAAS;IACb,IAAI9F,IAASkB,EAAOkB;IAEpB,IAAK,IAAIyC,IAAI,GAAGA,IAAI7E,GAAQ6E,IAC3BiB,KAAUvE,EAASa,CAAAA,CAASyC,EAAAA,EAAIA,GAAGzC,GAAUb,MAAa;IAE3D,OAAOuE;AAAAA;AAUR,SAAgBC,GAAWV,CAAAA,EAAS1E,CAAAA,EAAOyB,CAAAA,EAAUb,CAAAA;IACpD,OAAQ8D,EAAQnD;QACf,KAAK5C;YAAO,IAAI+F,EAAQjD,SAASpC,QAAQ;QACzC,KAAKpB;QAAQ,KAAKH;YAAa,OAAO4G,EAAQhD,SAASgD,EAAQhD,UAAUgD,EAAQtF;QACjF,KAAKxB;YAAS,OAAO;QACrB,KAAKW;YAAW,OAAOmG,EAAQhD,SAASgD,EAAQtF,QAAQ,MAAM8F,GAAUR,EAAQjD,UAAUb,KAAY;QACtG,KAAK/C;YAAS6G,EAAQtF,QAAQsF,EAAQlD,MAAMV,KAAK;IAAA;IAGlD,OAAOR,EAAOmB,IAAWyD,GAAUR,EAAQjD,UAAUb,MAAa8D,EAAQhD,SAASgD,EAAQtF,QAAQ,MAAMqC,IAAW,MAAM;AAAA;ACxBpH,SAAS4D,GAAYC,CAAAA;IAC3B,IAAIjG,IAASkB,EAAO+E;IAEpB,OAAO,SAAUZ,CAAAA,EAAS1E,CAAAA,EAAOyB,CAAAA,EAAUb,CAAAA;QAC1C,IAAIuE,IAAS;QAEb,IAAK,IAAIjB,IAAI,GAAGA,IAAI7E,GAAQ6E,IAC3BiB,KAAUG,CAAAA,CAAWpB,EAAAA,CAAGQ,GAAS1E,GAAOyB,GAAUb,MAAa;QAEhE,OAAOuE;IAAAA;AAAAA;AAQF,SAASI,GAAW3E,CAAAA;IAC1B,OAAO,SAAU8D,CAAAA;QAChB,IAAA,CAAKA,EAAQrD,MACZ;YAAA,IAAIqD,IAAUA,EAAQhD,QACrBd,EAAS8D;QAAAA;IAAAA;AAAAA;AAUb,SAAgBc,GAAUd,CAAAA,EAAS1E,CAAAA,EAAOyB,CAAAA,EAAUb,CAAAA;IACnD,IAAI8D,EAAQrF,SAAAA,IACX;QAAA,IAAA,CAAKqF,EAAQhD,QACZ,OAAQgD,EAAQnD;YACf,KAAKzD;gBAAa4G,EAAQhD,SAAS8C,GAAOE,EAAQtF,OAAOsF,EAAQrF,QAAQoC;gBACxE;YACD,KAAKlD;gBACJ,OAAO2G,GAAU;oBAACvD,EAAK+C,GAAS;wBAACtF,OAAOO,EAAQ+E,EAAQtF,OAAO,KAAK,MAAMzB;oBAAAA;iBAAAA,EAAYiD;YACvF,KAAK/C;gBACJ,IAAI6G,EAAQrF,QACX,OAAOsB,EAAQ+D,EAAQlD,OAAO,SAAUpC,CAAAA;oBACvC,OAAQI,EAAMJ,GAAO;wBAEpB,KAAK;wBAAc,KAAK;4BACvB,OAAO8F,GAAU;gCAACvD,EAAK+C,GAAS;oCAAClD,OAAO;wCAAC7B,EAAQP,GAAO,eAAe,MAAM1B,IAAM;qCAAA;gCAAA;6BAAA,EAAWkD;wBAE/F,KAAK;4BACJ,OAAOsE,GAAU;gCAChBvD,EAAK+C,GAAS;oCAAClD,OAAO;wCAAC7B,EAAQP,GAAO,cAAc,MAAMzB,IAAS;qCAAA;gCAAA;gCACnEgE,EAAK+C,GAAS;oCAAClD,OAAO;wCAAC7B,EAAQP,GAAO,cAAc,MAAM1B,IAAM;qCAAA;gCAAA;gCAChEiE,EAAK+C,GAAS;oCAAClD,OAAO;wCAAC7B,EAAQP,GAAO,cAAc3B,IAAK;qCAAA;gCAAA;6BAAA,EACvDmD;oBAAAA;oBAGL,OAAO;gBAAA;QAAA;IAAA;AAAA;AAUP,SAAS6E,GAAWf,CAAAA;IAC1B,OAAQA,EAAQnD;QACf,KAAK1D;YACJ6G,EAAQlD,QAAQkD,EAAQlD,MAAMX,IAAI,SAAUzB,CAAAA;gBAC3C,OAAOuB,EAAQ2B,EAASlD,IAAQ,SAAUA,CAAAA,EAAOY,CAAAA,EAAOyB,CAAAA;oBACvD,OAAQnC,EAAOF,GAAO;wBAErB,KAAK;4BACJ,OAAOc,EAAOd,GAAO,GAAGkB,EAAOlB;wBAEhC,KAAK;wBAAG,KAAK;wBAAI,KAAK;wBAAI,KAAK;wBAAI,KAAK;4BACvC,OAAOA;wBAER,KAAK;4BACJ,IAAIqC,CAAAA,CAAAA,EAAWzB,EAAAA,KAAW,UACzByB,CAAAA,CAASzB,EAAAA,GAAS,IAAIyB,CAAAA,CAAAA,EAAWzB,EAAAA,GAAS,OAAOE,EAAOuB,CAAAA,CAASzB,EAAAA,EAAQA,IAAQ,GAAA;wBAEnF,KAAK;4BACJ,OAAOA,MAAU,IAAI,KAAKZ;wBAC3B;4BACC,OAAQY;gCACP,KAAK;oCAAG0E,IAAUtF;oCACjB,OAAOmB,EAAOkB,KAAY,IAAI,KAAKrC;gCACpC,KAAKY,IAAQO,EAAOkB,KAAY;gCAAG,KAAK;oCACvC,OAAOzB,MAAU,IAAIZ,IAAQsF,IAAUA,IAAUtF,IAAQsF;gCAC1D;oCACC,OAAOtF;4BNrGN;oBAAA;gBAAA;YAAA;IAAA;AAAA;;;;;AOeV,6CAAS;AAfT,IAAI,cAAc,SAAS,YAAY,IAAI;IACzC,kFAAkF;IAClF,IAAI,QAAQ,IAAI;IAChB,OAAO,SAAU,GAAG;QAClB,IAAI,MAAM,IAAI,MACZ,aAAa;QACb,OAAO,MAAM,IAAI;QAGnB,IAAI,MAAM,KAAK;QACf,MAAM,IAAI,KAAK;QACf,OAAO;IACT;AACF;;;;;ACLA,6CAAS;AART,SAAS,QAAQ,EAAE;IACjB,IAAI,QAAQ,OAAO,OAAO;IAC1B,OAAO,SAAU,GAAG;QAClB,IAAI,KAAK,CAAC,IAAI,KAAK,WAAW,KAAK,CAAC,IAAI,GAAG,GAAG;QAC9C,OAAO,KAAK,CAAC,IAAI;IACnB;AACF;;;;;ACqTA,qDAAS;AA3TT;;AACA;;AACA;;AAEA,IAAI,gCAAgC;AACpC,IAAI,gCAAgC;AACpC,IAAI,iBAAiB;AACrB,IAAI,iBAAiB;AAErB,IAAI,mBAAmB,SAAS,iBAAiB,QAAQ;IACvD,OAAO,SAAS,WAAW,OAAO;AACpC;AAEA,IAAI,qBAAqB,SAAS,mBAAmB,KAAK;IACxD,OAAO,SAAS,QAAQ,OAAO,UAAU;AAC3C;AAEA,IAAI,mBAAmB,aAAa,GAAE,CAAA,GAAA,uBAAM,EAAE,SAAU,SAAS;IAC/D,OAAO,iBAAiB,aAAa,YAAY,UAAU,QAAQ,gBAAgB,OAAO;AAC5F;AAEA,IAAI,oBAAoB,SAAS,kBAAkB,GAAG,EAAE,KAAK;IAC3D,OAAQ;QACN,KAAK;QACL,KAAK;YAED,IAAI,OAAO,UAAU,UACnB,OAAO,MAAM,QAAQ,gBAAgB,SAAU,KAAK,EAAE,EAAE,EAAE,EAAE;gBAC1D,SAAS;oBACP,MAAM;oBACN,QAAQ;oBACR,MAAM;gBACR;gBACA,OAAO;YACT;IAGR;IAEA,IAAI,CAAA,GAAA,wBAAO,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,iBAAiB,QAAQ,OAAO,UAAU,YAAY,UAAU,GAC1F,OAAO,QAAQ;IAGjB,OAAO;AACT;AAGE,IAAI,sBAAsB;AAC1B,IAAI,gBAAgB;IAAC;IAAU;IAAQ;IAAW;IAAW;CAAQ;AACrE,IAAI,uBAAuB;AAC3B,IAAI,YAAY;AAChB,IAAI,gBAAgB;AACpB,IAAI,kBAAkB,CAAC;AAEvB,oBAAoB,SAAS,kBAAkB,GAAG,EAAE,KAAK;IACvD,IAAI,QAAQ,WAAW;QACrB,IAAI,OAAO,UAAU,YAAY,cAAc,QAAQ,WAAW,MAAM,CAAC,oBAAoB,KAAK,UAAW,CAAA,MAAM,OAAO,OAAO,MAAM,OAAO,MAAM,SAAS,MAAM,MAAM,OAAO,OAAO,OAAO,MAAM,OAAO,OAAO,GAAE,GAClN,MAAM,IAAI,MAAM,mGAAmG,QAAQ;IAE/H;IAEA,IAAI,YAAY,qBAAqB,KAAK;IAE1C,IAAI,cAAc,MAAM,CAAC,iBAAiB,QAAQ,IAAI,QAAQ,SAAS,MAAM,eAAe,CAAC,IAAI,KAAK,WAAW;QAC/G,eAAe,CAAC,IAAI,GAAG;QACvB,QAAQ,MAAM,mFAAmF,IAAI,QAAQ,WAAW,OAAO,QAAQ,eAAe,SAAU,GAAG,EAAE,KAAK;YACxK,OAAO,MAAM;QACf,KAAK;IACP;IAEA,OAAO;AACT;AAGF,IAAI,6BAA6B;AAEjC,SAAS,oBAAoB,WAAW,EAAE,UAAU,EAAE,aAAa;IACjE,IAAI,iBAAiB,MACnB,OAAO;IAGT,IAAI,cAAc,qBAAqB,WAAW;QAChD,IAA6C,cAAc,eAAe,yBACxE,MAAM,IAAI,MAAM;QAGlB,OAAO;IACT;IAEA,OAAQ,OAAO;QACb,KAAK;YAED,OAAO;QAGX,KAAK;YAED,IAAI,cAAc,SAAS,GAAG;gBAC5B,SAAS;oBACP,MAAM,cAAc;oBACpB,QAAQ,cAAc;oBACtB,MAAM;gBACR;gBACA,OAAO,cAAc;YACvB;YAEA,IAAI,cAAc,WAAW,WAAW;gBACtC,IAAI,OAAO,cAAc;gBAEzB,IAAI,SAAS,WACX,mEAAmE;gBACnE,0DAA0D;gBAC1D,MAAO,SAAS,UAAW;oBACzB,SAAS;wBACP,MAAM,KAAK;wBACX,QAAQ,KAAK;wBACb,MAAM;oBACR;oBACA,OAAO,KAAK;gBACd;gBAGF,IAAI,SAAS,cAAc,SAAS;gBAEpC,IAA6C,cAAc,QAAQ,WACjE,UAAU,cAAc;gBAG1B,OAAO;YACT;YAEA,OAAO,uBAAuB,aAAa,YAAY;QAG3D,KAAK;YAED,IAAI,gBAAgB,WAAW;gBAC7B,IAAI,iBAAiB;gBACrB,IAAI,SAAS,cAAc;gBAC3B,SAAS;gBACT,OAAO,oBAAoB,aAAa,YAAY;YACtD,OACE,QAAQ,MAAM;YAGhB;QAGJ,KAAK;YAED,IAAI,UAAU,EAAE;YAChB,IAAI,WAAW,cAAc,QAAQ,gBAAgB,SAAU,KAAK,EAAE,EAAE,EAAE,EAAE;gBAC1E,IAAI,cAAc,cAAc,QAAQ;gBACxC,QAAQ,KAAK,WAAW,cAAc,kBAAkB,GAAG,QAAQ,6BAA6B,MAAM;gBACtG,OAAO,OAAO,cAAc;YAC9B;YAEA,IAAI,QAAQ,QACV,QAAQ,MAAM,oHAAyH,EAAE,CAAC,OAAO,SAAS;gBAAC,MAAM,WAAW;aAAI,EAAE,KAAK,QAAQ,qDAAsD,CAAA,SAAS,WAAW,GAAE;YAI/Q;IACJ,EAAE,qFAAqF;IAGvF,IAAI,cAAc,MAChB,OAAO;IAGT,IAAI,SAAS,UAAU,CAAC,cAAc;IACtC,OAAO,WAAW,YAAY,SAAS;AACzC;AAEA,SAAS,uBAAuB,WAAW,EAAE,UAAU,EAAE,GAAG;IAC1D,IAAI,SAAS;IAEb,IAAI,MAAM,QAAQ,MAChB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,QAAQ,IAC9B,UAAU,oBAAoB,aAAa,YAAY,GAAG,CAAC,EAAE,IAAI;SAGnE,IAAK,IAAI,QAAQ,IAAK;QACpB,IAAI,QAAQ,GAAG,CAAC,KAAK;QAErB,IAAI,OAAO,UAAU,UAAU;YAC7B,IAAI,cAAc,QAAQ,UAAU,CAAC,MAAM,KAAK,WAC9C,UAAU,OAAO,MAAM,UAAU,CAAC,MAAM,GAAG;iBACtC,IAAI,mBAAmB,QAC5B,UAAU,iBAAiB,QAAQ,MAAM,kBAAkB,MAAM,SAAS;QAE9E,OAAO;YACL,IAAI,SAAS,2BAA2B,MACtC,MAAM,IAAI,MAAM;YAGlB,IAAI,MAAM,QAAQ,UAAU,OAAO,KAAK,CAAC,EAAE,KAAK,YAAa,CAAA,cAAc,QAAQ,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,SAAQ,GAAI;gBACtH,IAAK,IAAI,KAAK,GAAG,KAAK,MAAM,QAAQ,KAClC,IAAI,mBAAmB,KAAK,CAAC,GAAG,GAC9B,UAAU,iBAAiB,QAAQ,MAAM,kBAAkB,MAAM,KAAK,CAAC,GAAG,IAAI;YAGpF,OAAO;gBACL,IAAI,eAAe,oBAAoB,aAAa,YAAY;gBAEhE,OAAQ;oBACN,KAAK;oBACL,KAAK;wBAED,UAAU,iBAAiB,QAAQ,MAAM,eAAe;wBACxD;oBAGJ;wBAEI,IAA6C,SAAS,aACpD,QAAQ,MAAM;wBAGhB,UAAU,OAAO,MAAM,eAAe;gBAE5C;YACF;QACF;IACF;IAGF,OAAO;AACT;AAEA,IAAI,eAAe;AACnB,IAAI;AAGF,mBAAmB;AAErB,uEAAuE;AAGvE,IAAI;AACJ,IAAI,kBAAkB,SAAS,gBAAgB,IAAI,EAAE,UAAU,EAAE,WAAW;IAC1E,IAAI,KAAK,WAAW,KAAK,OAAO,IAAI,CAAC,EAAE,KAAK,YAAY,IAAI,CAAC,EAAE,KAAK,QAAQ,IAAI,CAAC,EAAE,CAAC,WAAW,WAC7F,OAAO,IAAI,CAAC,EAAE;IAGhB,IAAI,aAAa;IACjB,IAAI,SAAS;IACb,SAAS;IACT,IAAI,UAAU,IAAI,CAAC,EAAE;IAErB,IAAI,WAAW,QAAQ,QAAQ,QAAQ,WAAW;QAChD,aAAa;QACb,UAAU,oBAAoB,aAAa,YAAY;IACzD,OAAO;QACL,IAA6C,OAAO,CAAC,EAAE,KAAK,WAC1D,QAAQ,MAAM;QAGhB,UAAU,OAAO,CAAC,EAAE;IACtB,EAAE,0DAA0D;IAG5D,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,QAAQ,IAAK;QACpC,UAAU,oBAAoB,aAAa,YAAY,IAAI,CAAC,EAAE;QAE9D,IAAI,YAAY;YACd,IAA6C,OAAO,CAAC,EAAE,KAAK,WAC1D,QAAQ,MAAM;YAGhB,UAAU,OAAO,CAAC,EAAE;QACtB;IACF;IAEA,IAAI;IAGF,SAAS,OAAO,QAAQ,kBAAkB,SAAU,KAAK;QACvD,YAAY;QACZ,OAAO;IACT;IAIF,aAAa,YAAY;IACzB,IAAI,iBAAiB;IACrB,IAAI,OAAO,qDAAqD;IAEhE,MAAO,AAAC,CAAA,QAAQ,aAAa,KAAK,OAAM,MAAO,KAC7C,kBAAkB,MAAM,mCAAmC;IAC3D,KAAK,CAAC,EAAE;IAGV,IAAI,OAAO,CAAA,GAAA,oBAAS,EAAE,UAAU;IAG9B,gGAAgG;IAChG,OAAO;QACL,MAAM;QACN,QAAQ;QACR,KAAK;QACL,MAAM;QACN,UAAU,SAAS;YACjB,OAAO;QACT;IACF;AAQJ;;;ACzTA,kBAAkB,GAClB,yDAAyD;AACzD,6HAA6H;;;AAoD7H,6CAAS;AAnDT,SAAS,QAAQ,GAAG;IAClB,sDAAsD;IACtD,6DAA6D;IAC7D,wBAAwB;IACxB,gBAAgB;IAChB,sBAAsB;IACtB,IAAI,IAAI,GAAG,sCAAsC;IAEjD,IAAI,GACA,IAAI,GACJ,MAAM,IAAI;IAEd,MAAO,OAAO,GAAG,EAAE,GAAG,OAAO,EAAG;QAC9B,IAAI,IAAI,WAAW,KAAK,OAAO,AAAC,CAAA,IAAI,WAAW,EAAE,KAAK,IAAG,KAAM,IAAI,AAAC,CAAA,IAAI,WAAW,EAAE,KAAK,IAAG,KAAM,KAAK,AAAC,CAAA,IAAI,WAAW,EAAE,KAAK,IAAG,KAAM;QACxI,IAEA,AADA,oBAAoB,GACnB,CAAA,IAAI,MAAK,IAAK,aAAc,CAAA,AAAC,CAAA,MAAM,EAAC,IAAK,UAAU,EAAC;QACrD,KACA,YAAY,GACZ,MAAM;QACN,IAEA,AADA,oBAAoB,GACnB,CAAA,IAAI,MAAK,IAAK,aAAc,CAAA,AAAC,CAAA,MAAM,EAAC,IAAK,UAAU,EAAC,IAErD,AADA,oBAAoB,GACnB,CAAA,IAAI,MAAK,IAAK,aAAc,CAAA,AAAC,CAAA,MAAM,EAAC,IAAK,UAAU,EAAC;IACvD,EAAE,+CAA+C;IAGjD,OAAQ;QACN,KAAK;YACH,KAAK,AAAC,CAAA,IAAI,WAAW,IAAI,KAAK,IAAG,KAAM;QAEzC,KAAK;YACH,KAAK,AAAC,CAAA,IAAI,WAAW,IAAI,KAAK,IAAG,KAAM;QAEzC,KAAK;YACH,KAAK,IAAI,WAAW,KAAK;YACzB,IAEA,AADA,oBAAoB,GACnB,CAAA,IAAI,MAAK,IAAK,aAAc,CAAA,AAAC,CAAA,MAAM,EAAC,IAAK,UAAU,EAAC;IACzD,EAAE,0DAA0D;IAC5D,+BAA+B;IAG/B,KAAK,MAAM;IACX,IAEA,AADA,oBAAoB,GACnB,CAAA,IAAI,MAAK,IAAK,aAAc,CAAA,AAAC,CAAA,MAAM,EAAC,IAAK,UAAU,EAAC;IACrD,OAAO,AAAC,CAAA,AAAC,CAAA,IAAI,MAAM,EAAC,MAAO,CAAA,EAAG,SAAS;AACzC;;;;;ACFA,6CAAS;AAlDT,IAAI,eAAe;IACjB,yBAAyB;IACzB,aAAa;IACb,mBAAmB;IACnB,kBAAkB;IAClB,kBAAkB;IAClB,SAAS;IACT,cAAc;IACd,iBAAiB;IACjB,aAAa;IACb,SAAS;IACT,MAAM;IACN,UAAU;IACV,cAAc;IACd,YAAY;IACZ,cAAc;IACd,WAAW;IACX,SAAS;IACT,YAAY;IACZ,aAAa;IACb,cAAc;IACd,YAAY;IACZ,eAAe;IACf,gBAAgB;IAChB,iBAAiB;IACjB,WAAW;IACX,eAAe;IACf,cAAc;IACd,kBAAkB;IAClB,YAAY;IACZ,YAAY;IACZ,SAAS;IACT,OAAO;IACP,SAAS;IACT,SAAS;IACT,QAAQ;IACR,QAAQ;IACR,MAAM;IACN,iBAAiB;IACjB,yBAAyB;IACzB,aAAa;IACb,cAAc;IACd,aAAa;IACb,iBAAiB;IACjB,kBAAkB;IAClB,kBAAkB;IAClB,eAAe;IACf,aAAa;AACf;;;;;ACLA,yDAAS;AAAT,kDAA8B;AAA9B,oDAA4C;AA3C5C,IAAI,YAAY;AAChB,SAAS,oBAAoB,UAAU,EAAE,gBAAgB,EAAE,UAAU;IACnE,IAAI,eAAe;IACnB,WAAW,MAAM,KAAK,QAAQ,SAAU,SAAS;QAC/C,IAAI,UAAU,CAAC,UAAU,KAAK,WAC5B,iBAAiB,KAAK,UAAU,CAAC,UAAU,GAAG;aAE9C,gBAAgB,YAAY;IAEhC;IACA,OAAO;AACT;AACA,IAAI,iBAAiB,SAAS,eAAe,KAAK,EAAE,UAAU,EAAE,WAAW;IACzE,IAAI,YAAY,MAAM,MAAM,MAAM,WAAW;IAE7C,IAKA,AAJA,wCAAwC;IACxC,sDAAsD;IACtD,kDAAkD;IAClD,+EAA+E;IAC9E,CAAA,gBAAgB,SAAS,yDAAyD;IACnF,+DAA+D;IAC/D,gEAAgE;IAChE,yEAAyE;IACzE,cAAc,KAAI,KAAO,MAAM,UAAU,CAAC,UAAU,KAAK,WACvD,MAAM,UAAU,CAAC,UAAU,GAAG,WAAW;AAE7C;AACA,IAAI,eAAe,SAAS,aAAa,KAAK,EAAE,UAAU,EAAE,WAAW;IACrE,eAAe,OAAO,YAAY;IAClC,IAAI,YAAY,MAAM,MAAM,MAAM,WAAW;IAE7C,IAAI,MAAM,QAAQ,CAAC,WAAW,KAAK,KAAK,WAAW;QACjD,IAAI,UAAU;QAEd,GAAG;YACD,MAAM,OAAO,eAAe,UAAU,MAAM,YAAY,IAAI,SAAS,MAAM,OAAO;YAElF,UAAU,QAAQ;QACpB,QAAS,YAAY,WAAW;IAClC;AACF;;;;;AChCA;;;CAGC,GACD,mDAAa;AAbb;AACA;AACA;AACA;;AACA;AAGA;AAMO,MAAM;IA4BD,iBAAkB,GAAQ,EAAQ;QACtC,IAAI,IAAI,MAAM,GACV,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,IAAI,GAAG,IAAI;aAErE,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,IAAI;IAE5D;IAEQ,iBAAwB;QAC5B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,KAAK;QAC5E,CAAA,GAAA,MAAC,EAAE,cAAc,IAAI,CAAC,SAAS;YAC3B,cAAc,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;QACtD;IACJ;IAEQ,kBAAyB;QAC7B,MAAM,OAAO,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,CAAC,QAAQ;QACzD,MAAM,MAAM,AAAC,CAAA,IAAI,IAAI,CAAC,gBAAgB,IAAI,GAAE,IAAK,IAAI,CAAC,WAAW;QACjE,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;YACnB,MAAM,OAAO;YACb,KAAK,MAAM;QACf;IACJ;IAEQ,gBAAuB;QAC3B,IAAI,CAAC,WAAW,MAAM,kBAAkB,SAAS,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,CAAC,gBAAgB,IAAI;QAExI,IAAI,CAAA,GAAA,MAAC,EAAE,wBAAwB,IAAI,CAAC,kBAAkB;YAClD,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc;gBACtB,QAAQ;YACZ;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;gBACnB,QAAQ;YACZ;QACJ,OAAM;YACF,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc;gBACtB,QAAQ;YACZ;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;gBACnB,QAAQ;YACZ;QACJ;IAEJ;IAEQ,uBAA8B;QAClC,IAAI,CAAC,kBAAkB,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS,IAAI,CAAC;IACnF;IAIA,mBAAmB;IAEnB,YACI,CAMC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,UAAU;YACd;QACJ;QACA,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,KAAK;gBACD,SAAS;gBACT,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,WAAW,EAAE;QAClB,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,CAAC,YAAY,EAAE;QAEnB,IAAI,CAAC,kBAAkB;YACnB,GAAG,SAAS,KAAK,EAAE,WAAW;YAC9B,GAAG,SAAS,KAAK,EAAE,WAAW;YAC9B,GAAG,SAAS,KAAK,EAAE,WAAW;QAClC;QACA,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,EAAE,aAAa,SAAS;QACvE,IAAI,CAAC,oBAAoB;YAAC,GAAG,CAAA,GAAA,uBAAU;YAAG,GAAG,CAAA,GAAA,uBAAU;YAAG,GAAG,CAAA,GAAA,uBAAU;QAAC;QACxE,IAAI,CAAC,oBAAoB,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU,IAAI,CAAC,oBAAoB,SAAS;QAEvF,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE;QACrB,IAAI,CAAC,QAAQ,IAAI,YAAY,gBAAgB,4kBAA4kB,iBAAiB;QAC1oB;YACI,MAAM,UAAU,IAAI,CAAC,MAAM,cAAc;YACzC,IAAI,CAAC,SACD,MAAM,MAAM;YAEhB,IAAI,CAAC,UAAU;QACnB;QACA,CAAA,GAAA,MAAC,EAAE,cAAc,IAAI,CAAC,SAAS;YAC3B,cAAc;QAClB;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,OAAO;YACf,OAAO,IAAI,CAAC,QAAQ;YACpB,QAAQ,IAAI,CAAC,WAAW;QAC5B;QACA,UAAU,OAAO,IAAI,CAAC;QAEtB,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,UAAU;gBACV,OAAO,IAAI,CAAC,QAAQ;gBACpB,QAAQ,IAAI,CAAC,SAAS;gBACtB,QAAQ;gBACR,WAAW;gBACX,cAAc;YAClB;QACJ;QACA,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,WAAW;YACX,KAAK;gBACD,SAAS;gBACT,gBAAgB;gBAChB,OAAO,AAAC,IAAI,CAAC,SAAS,MAAO;gBAC7B,QAAQ,IAAI,CAAC,SAAS;YAC1B;QACJ;QACA,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE;QAInB,MAAM,cAAc,CAAC;YACjB,MAAM,KAAK,IAAI;YACf,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI;gBACP,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,SAAS;gBACT,eAAe;YACnB;YACA,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;YACtC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YACnB,MAAM,QAAQ,IAAI,qBAAqB,GAAG,GAAG,IAAI,CAAC,OAAO;YACzD,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,KAAK,KAAM;gBAC9B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,KAAK,KAAK;gBAC7D,IAAI,KAAK,AAAC,SAAS,KAAK,IAAI,GAAI,SAAS;gBACzC,IAAI,KAAK,AAAC,SAAS,KAAK,IAAI,GAAI,SAAS;gBACzC,IAAI,KAAK,AAAC,SAAS,KAAK,IAAI,GAAI,SAAS;gBACzC,IAAI,GAAG,WAAW,GACd,KAAK,MAAM;gBAEf,IAAI,GAAG,WAAW,GACd,KAAK,MAAM;gBAEf,IAAI,GAAG,WAAW,GACd,KAAK,MAAM;gBAEf,MAAM,aAAa,GAAG,MAAM,KAAK,KAAK;YAC1C;YACA,IAAI,YAAY;YAChB,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;YAEpC,SAAS,OAAO;YAChB,GAAG,MAAM;YACT,GAAG,MAAM,GAAG,UAAU;YACtB,GAAG,MAAM,UAAU;QACvB;QASA,IAAI,CAAC;QACL,IAAI,CAAC,OAAO,MAAM,QAAQ,IAAI,CAAC,QAAQ;QACvC,IAAI,CAAC,OAAO,gBAAgB;YACxB,OAAO;QACX;QAEA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,WAAW;YACX,KAAK;gBACD,OAAO,IAAI,CAAC,QAAQ;gBACpB,QAAQ,IAAI,CAAC,WAAW;gBACxB,UAAU;gBACV,SAAS;gBACT,UAAU;gBACV,QAAQ;YACZ;QACJ;QAEA,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,cAAc;gBACd,UAAU;gBACV,eAAe;gBACf,WAAW;YACf;QACH;QAEA,IAAI,CAAC,YAAY,OAAO,WAAW,IAAI,CAAC;QACxC,IAAI,CAAC;QACL,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,aAAa;QACrC,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC;QAE3B,8BAA8B;QAC9B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU;YAClB,OAAO;YACP,QAAQ,IAAI,CAAC,SAAS;YACtB,YAAY;YACZ,YAAY;YACZ,UAAU;YACV,KAAK;YACL,MAAM,SAAS,KAAM,CAAA,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,CAAC,QAAQ,CAAA,KAAM;QAC3E;QAGA,MAAM,aAAa;YACf,GAAG;YACH,GAAG;YACH,GAAG;QACP;QAGA,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,OAAO,CAAA,GAAA,cAAG,EAAE,gBAAgB;YAC5B,WAAW;YACX,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,iBAAiB,SAAS,CAAA,GAAA,6BAAY,IAAI;gBAC1C,kBAAmB;gBACnB,gBAAgB;gBAChB,oBAAoB;YACxB;YACA,SAAS;gBACL,IAAI,IAAI,CAAC,WAAW;oBAChB,IAAI,CAAC,gBAAgB,IAAI,CAAC,aAAa;oBACvC,IAAI,CAAC;gBACT,OAAO;oBACH,IAAI,CAAC,aAAa,UAAU,OAAO;oBACnC,IAAI,CAAC,aAAa,UAAU,IAAI;oBAChC,IAAI,CAAC,YAAY;oBACjB,IAAI,CAAC,gBAAgB,IAAI,CAAC,aAAa;gBAC3C;YACJ;QACJ;QACA,IAAI,CAAC,YAAY;QAEjB,MAAM,8BAA8B,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACvD,QAAQ,IAAI,CAAC;YACb,cAAc,CAAC;gBACX,IAAI,IAAI,CAAC,WACL;gBAEJ,IAAI,CAAC,aAAa,UAAU,OAAO,qCAAqC;YAC5E;QACJ;QACA,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC;QAG5B,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,SAAS;YACT,WAAW;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBACD,QAAQ;gBACR,OAAO,IAAI,CAAC,SAAS;gBACrB,YAAY,IAAI,CAAC,SAAS;gBAC1B,UAAU,AAAC,IAAI,CAAC,SAAS,OAAQ;YACrC;YACA,SAAS;gBACL,IAAI,CAAA,GAAA,oCAAa,EAAE;oBACf,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB;oBACvF,SAAS,CAAC;wBACN,IAAI,CAAC,QACD;wBAEJ,IAAI,CAAC,SAAS;wBACd,IAAI,CAAC,UAAU,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB;oBACnG;gBACJ;YACJ;QACJ;QACA,MAAM,2BAA2B,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACpD,QAAQ,IAAI,CAAC;YACb,cAAc,CAAC;gBACX,IAAI,CAAC,UAAU,UAAU,OAAO,qCAAqC;YACzE;QACJ;QACA,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC;QAE5B,IAAI,CAAC;QAGL,WAAW;YACP,YAAY;YACZ,KAAK,OAAO,IAAI,CAAC;YACjB,MAAM,oBAAoB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC7C,QAAQ;gBACR,aAAa;gBACb,WAAW,CAAC;oBACR,IAAI,MAAM,SAAS,eAAe;wBAE9B,oDAAoD;wBACpD,CAAA,GAAA,MAAC,EAAE;wBAEH,IAAI,CAAC,YAAY,UAAU,OAAO,2BAA2B;wBAE7D,IAAI,MAAM,WAAW,QAAQ;4BAEzB,WAAW,IAAI,MAAM,OAAO,IAAI,CAAC,QAAQ;4BACzC,WAAW,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,WAAW;4BAElD,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,WAAW,GAAG,WAAW;4BACnF,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;4BAEpD,IAAI,CAAC;4BACL,IAAI,CAAC;4BACL,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;wBAChD,OAAO;4BACH,WAAW,IAAI,IAAI,CAAC,gBAAgB;4BACpC,WAAW,IAAI,IAAI,CAAC,gBAAgB;wBACxC;oBACJ;oBAEA,IAAI,MAAM,SAAS,iBAAiB;wBAAC;wBAAQ;qBAAQ,CAAC,SAAS,MAAM,UAAU,KAAK;wBAEhF,IAAI,SAAS;wBACb,IAAI,MAAM,WAAW,SACjB,SAAS;wBAGb,WAAW,KAAK,MAAM,KAAK,IAAI,CAAC,QAAQ,MAAM;wBAC9C,WAAW,KAAK,MAAM,KAAK,IAAI,CAAC,WAAW,MAAM;wBAEjD,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,WAAW,GAAG,WAAW;wBACnF,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;wBACpD,IAAI,CAAC;wBACL,IAAI,CAAC;wBACL,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;oBAEhD;oBAEA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC,YAAY,UAAU,OAAO,2BAA2B;gBAGrE;YACJ;YACA,MAAM,mBAAmB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC5C,QAAQ;gBACR,aAAa;gBACb,WAAW,CAAC;oBAER,IAAI,MAAM,SAAS,eAAe;wBAE9B,oDAAoD;wBACpD,CAAA,GAAA,MAAC,EAAE;wBAEH,KAAK,UAAU,OAAO,2BAA2B;wBAEjD,IAAI,MAAM,WAAW,QAAQ;4BAEzB,WAAW,IAAI,MAAM,OAAO,IAAI,CAAC,QAAQ;4BAEzC,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB;4BAC7F,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;4BACpD,IAAI,CAAC,SAAS,MAAM,OAAO,AAAC,KAAK,MAAM,IAAI,CAAC,gBAAgB,IAAI,SAAS,IAAI,CAAC,SAAS,IAAK;4BAC5F,IAAI,CAAC;4BACL,IAAI,CAAC;4BACL,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;wBAChD,OACI,WAAW,IAAI,IAAI,CAAC,gBAAgB;oBAE5C;oBAEA,IAAI,MAAM,SAAS,iBAAiB;wBAAC;wBAAQ;qBAAQ,CAAC,SAAS,MAAM,UAAU,KAAK;wBAEhF,MAAM,SAAS,KAAK,IAAI,MAAM,QAAQ,MAAM;wBAC5C,MAAM,SAAS,CAAA,GAAA,sCAAsB,EAAE,QAAQ,MAAM,WAAW;wBAEhE,WAAW,KAAK,MAAM,KAAK,IAAI,CAAC,QAAQ,SAAS;wBAEjD,IAAI,MAAM,WAAW,SAAS;4BAC1B,WAAW,IAAI,WAAW,IAAI;4BAC9B,IAAI,WAAW,IAAI,GACf,WAAW,KAAK;wBAExB;wBACA,WAAW,IAAI,KAAK,IAAI,QAAQ,WAAW;wBAC3C,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB;wBAC7F,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;wBACpD,IAAI,CAAC,SAAS,MAAM,OAAO,AAAC,KAAK,MAAM,IAAI,CAAC,gBAAgB,IAAI,SAAS,IAAI,CAAC,SAAS,IAAK;wBAC5F,IAAI,CAAC;wBACL,IAAI,CAAC;wBACL,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;oBAEhD;oBAEA,IAAI,MAAM,SAAS,aACf,KAAK,UAAU,OAAO,2BAA2B;gBAEzD;YACJ;QACJ,GAAG;QAGH,0BAA0B;QAE1B,IAAI,CAAC,oBAAoB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC3B,QAAQ,IAAI,CAAC;YACb,OAAO,CAAA,GAAA,cAAG,EAAE,qBAAqB;YACjC,WAAW;YACX,KAAK;gBACD,QAAQ;gBACR,YAAY;gBACZ,OAAO;gBACP,QAAQ;YACZ;YACA,SAAS,CAAC;gBACN,EAAE;gBACF,IAAI,CAAC;YACT;QACJ;QACA,IAAI,CAAC;IACT;IAEA,SAAU,CAAO,EAAQ;QACrB,IAAI,CAAC,kBAAkB;YAAC,GAAG,SAAS,KAAK,EAAE;YAAI,GAAG,SAAS,KAAK,EAAE;YAAI,GAAG,SAAS,KAAK,EAAE;QAAE;QAC3F,IAAI,CAAC,iBAAiB,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM;QAC9C,IAAI,CAAC,SAAS,MAAM,OAAO,SAAS,KAAM,CAAA,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,CAAC,QAAQ,CAAA,KAAM;QAC5F,IAAI,CAAC;QACL,IAAI,CAAC;QACL,IAAI,CAAC;IACT;IAEA,WAAiB;QACb,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB;IAC3F;IAEA,kBAAwB;QACpB,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB;IACjG;IAEA,gBAAiB,IAA0B,EAAQ;QAC/C,IAAI,CAAC,eAAe;IACxB;IAEA,cAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,WACN;QAEJ,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,aAAa,UAAU,OAAO;IACvC;IAEA,OAAQ,CAAU,EAAQ;QACtB,IAAI,GAAG;YACH,IAAI,CAAC,OAAO,MAAM,gBAAgB;YAClC,IAAI,CAAC,OAAO,MAAM,UAAU;YAC5B,IAAI,CAAC,UAAU,MAAM,gBAAgB;YACrC,IAAI,CAAC,UAAU,MAAM,UAAU;QACnC,OAAO;YACH,IAAI,CAAC,OAAO,MAAM,gBAAgB;YAClC,IAAI,CAAC,OAAO,MAAM,UAAU;YAC5B,IAAI,CAAC,UAAU,MAAM,gBAAgB;YACrC,IAAI,CAAC,UAAU,MAAM,UAAU;QACnC;IACJ;IAEA,UAAW,CAAS,EAAQ;QACxB,IAAI,SAAS,KAAK,CAAA,IAAI,IAAI,CAAC,SAAS,IAAI,CAAA,GAAI;QAC5C,IAAI,MAAM,IAAI,CAAC,UACX;QAEJ,IAAI,CAAC,WAAW;QAChB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,OAAO;YACf,OAAO,IAAI,CAAC,QAAQ;YACpB,QAAQ,IAAI,CAAC,WAAW;QAC5B;QACA,IAAI,CAAC,YAAY,MAAM,SAAS,IAAI,CAAC,WAAW;QAChD,IAAI,CAAC;IACT;IAEA,aAAoB;QAChB,WAAW;QACX,IAAI,MAAiB,IAAI,CAAC;QAC1B,IAAI,CAAC,oBAAoB,IAAI,CAAC;QAC9B,IAAI,CAAC,iBAAiB;QACtB,WAAW;QACX,MAAM,IAAI,CAAC;QACX,IAAI,CAAC,oBAAoB,IAAI,CAAC;QAC9B,IAAI,CAAC,kBAAkB;QAEvB,IAAI,CAAC,SAAS,MAAM,OAAO,SAAS,KAAM,CAAA,IAAI,CAAC,gBAAgB,IAAI,MAAM,IAAI,CAAC,QAAQ,CAAA,KAAM;QAC5F,IAAI,CAAC;QACL,IAAI,CAAC;QACL,IAAI,CAAC;QACL,IAAI,CAAC;QAEL,IAAI,CAAC,UAAU,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB;IACnG;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,mBAAiC;QAC7B,OAAO,IAAI,CAAC;IAChB;AAEJ;;;AC7iBA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;iDCEpG;AAFb;AAEO,MAAM,cAAc,CAAA,GAAA,YAAI,EAAE,WAAW,MAAM;;;;;2CC+FrC;AAjGb;AAEA,MAAM,eAAe;AAKrB,MAAM;IAQM,cAAqB;QACzB,MAAM,WAAW,IAAI,CAAC;QACtB,IAAI,CAAC,QAAQ,IAAI,CAAC,eAAe,IAAI,CAAC;QAEtC,IAAI,IAAI,CAAC,UAAU,UACf;QAEJ,SAAS,KAAK,UAAU,OAAO,iBAAiB,IAAI,CAAC,UAAU;QAC/D,IAAI,CAAC,UAAU,QAAQ,CAAA,OAAQ;IACnC;IAEQ,mBAAwC;QAC5C,IAAI,SAAS,aAAa,QAAQ;QAClC,IAAI,CAAC,UAAW,OAAO,WAAW,YAAY,CAAC;YAAC;YAAQ;SAAQ,CAAC,SAAS,SAAU;YAChF,SAAS;YACT,aAAa,WAAW,eAAe,wBAAwB;QACnE;QACA,OAAO;IACX;IAEA,mBAAmB;IACnB,aAAe;QA1Bf,sCAAsC;aAC9B,kBAA0B,QAAS,uBAAuB;;aAC1D,QAAgB;aACP,YAA8B,EAAE;QAyB7C,mBAAmB;QACnB,IAAI,CAAC,kBAAkB,CAAA,GAAA,YAAK,MAAM,SAAS;QAC3C,CAAA,GAAA,uBAAgB,EAAE;YACd,IAAI,CAAC,kBAAkB,CAAA,GAAA,YAAK,MAAM,SAAS;YAC3C,IAAI,CAAC;QACT;QAEA,qBAAqB;QACrB,IAAI,CAAC,cAAc,IAAI,CAAC;QACxB,iBAAiB,WAAW,CAAC;YACzB,IAAI,EAAE,QAAQ,cAAc;gBACxB,IAAI,CAAC,cAAc,IAAI,CAAC;gBACxB,IAAI,CAAC;YACT;QACJ;QAEA,IAAI,CAAC;IACT;IAEA,SAAmB;QACf,OAAO,IAAI,CAAC,UAAU;IAC1B;IAEA,kBAAmB,IAAoB,EAAQ;QAC3C,IAAI,IAAI,CAAC,UAAU,SAAS,OACxB;QAEJ,IAAI,CAAC,UAAU,KAAK;IACxB;IAEA,qBAAsB,IAAoB,EAAQ;QAC9C,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE,KAAK,MAAM;YAC5B,IAAI,CAAC,UAAU,OAAO,GAAG;YACzB;QACJ;IAER;IAEA,qBAA8B;QAC1B,OAAO,IAAI,CAAC;IAChB;IAEA,iBAAsC;QAClC,OAAO,IAAI,CAAC;IAChB;IAEA,eAAgB,KAAyB,EAAQ;QAC7C,IAAI,OACA,aAAa,QAAQ,cAAc;aAEnC,aAAa,WAAW;QAE5B,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC;IACT;AAEJ;AAEO,MAAM,QAAQ,IAAI;;;;;AC3FzB;;CAEC,GACD,wDAAa;AATb;AACA;AAQO,MAAM;IAeD,WAAkB;QACtB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACxB,IAAG,CAAC,KACA,MAAM,IAAI,MAAM;QAEpB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,QAAQ,KAAK,EAAG;YAC9C,MAAM,YAAY,IAAI,qBAAqB,GAAG,GAAG,IAAI,CAAC,SAAS,OAAO;YAEtE,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,GAAG,MAAO,IAAI,IAAI,CAAC,SAAS,SAAS;YACtG,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,KAAK,MAAO,IAAI,IAAI,CAAC,SAAS,SAAS;YACzG,UAAU,aAAa,GAAG,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;YAC9D,UAAU,aAAa,GAAG,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,YAAY;YAC9D,IAAI,YAAY,WAAW,6CAA6C;YACxE,IAAI,YAAY;YAChB,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,SAAS,OAAO;QAC5C;IACJ;IAEQ,kBAAyB;QAC7B,MAAM,OAAO,IAAI,CAAC,MAAM,IAAI,MAAM,IAAI,CAAC,QAAQ;QAC/C,MAAM,MAAM,AAAC,CAAA,IAAI,IAAI,CAAC,MAAM,IAAI,GAAE,IAAK,IAAI,CAAC,WAAW;QACvD,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;YACnB,MAAM,OAAO;YACb,KAAK,MAAM;QACf;IACJ;IAEQ,iBAAwB;QAC5B,IAAI,CAAC,SAAS,MAAM,OAAO,AAAC,IAAI,CAAC,MAAM,IAAI,UAAU,IAAI,CAAC,QAAQ,IAAK;IAC3E;IAKA,oBAAoB;IACpB,YACI,CAMC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,OAAO,EAAE,QAAQ;gBACjB,UAAU;gBACV,UAAU;gBACV,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,OAAO,gBAAgB,CAAC;YACzB,EAAE;QACN;QACA,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,EAAE,MAAM;QAC9E,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,WAAW,EAAE;QAElB,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI;QAC9B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU;YAClB,OAAO,IAAI,CAAC,QAAQ;YACpB,QAAQ,IAAI,CAAC,WAAW;YACxB,QAAQ;QACZ;QAGA,IAAI,CAAC;QAEL,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,OAAO,EAAE,OAAO,EAAE;QACrC,QAAQ,MAAM,SAAS;QACtB,CAAA;YACG,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YAEnB,MAAM,QAAQ,IAAI,qBAAqB,GAAG,GAAG,EAAE,OAAO;YACtD,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,KAAK,KAAM;gBAC9B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,KAAK,KAAK;gBAC7D,MAAM,aAAa,GAAG,UAAU,SAAS,KAAK,IAAI,KAAK,OAAO,SAAS,KAAK,IAAI,KAAK,OAAO,SAAS,KAAK,IAAI,KAAK;YACvH;YACA,IAAI,YAAY;YAChB,IAAI,SAAS,GAAG,GAAG,EAAE,OAAO,EAAE;QAElC,CAAA;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU;YAClB,OAAO,EAAE,QAAQ;YACjB,QAAQ,EAAE,WAAW;YACrB,UAAU;YACV,UAAU;QACd;QACA,IAAI,CAAC,SAAS,MAAM,WAAW;QAC/B,QAAQ,MAAM,WAAW;QAEzB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,UAAU;QAElC,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,cAAc;gBACd,UAAU;gBACV,eAAe;gBACf,WAAW;YACf;QACJ;QAEA,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,OAAO;gBACP,QAAQ,EAAE,UAAU;gBACpB,YAAY;gBACZ,aAAa;gBACb,UAAU;gBACV,KAAK,EAAE,WAAW;gBAClB,eAAe;YACnB;QACJ;QAEA,IAAI,CAAC;QACL,IAAI,CAAC;QAEL,MAAM,aAAa;YACf,GAAG;YACH,GAAG;YACH,GAAG;QACP;QAEA,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,oBAAoB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC5C,QAAQ,IAAI,CAAC;YACb,aAAa;YACb,WAAW,CAAC;gBAER,IAAI,MAAM,SAAS,eAAe;oBAE9B,oDAAoD;oBACpD,CAAA,GAAA,MAAC,EAAE;oBAEH,IAAI,CAAC,cAAc,MAAM;oBACzB,IAAI,MAAM,WAAW,QAAQ;wBAEzB,WAAW,IAAI,MAAM,OAAO,EAAE,QAAQ;wBACtC,WAAW,IAAI,MAAM,MAAM,OAAO,EAAE,WAAW;wBAE/C,IAAI,CAAC,QAAQ,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,WAAW,GAAG,WAAW;wBAE/D,IAAI,CAAC;wBACL,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;oBAC5C,OAAO;wBACH,WAAW,IAAI,IAAI,CAAC,MAAM;wBAC1B,WAAW,IAAI,IAAI,CAAC,MAAM;oBAC9B;gBACJ;gBAEA,IAAI,MAAM,SAAS,iBAAiB;oBAAC;oBAAQ;iBAAQ,CAAC,SAAS,KAAK,MAAM,WAAW,IAAI,CAAC,gBAAgB,MAAM,WAAW;oBAEvH,IAAI,SAAS;oBACb,IAAI,MAAM,WAAW,SACjB,SAAS;oBAGb,WAAW,KAAK,MAAM,KAAK,EAAE,QAAQ,MAAM;oBAC3C,WAAW,KAAK,MAAM,KAAK,EAAE,WAAW,MAAM;oBAE9C,IAAI,CAAC,QAAQ,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,WAAW,GAAG,WAAW;oBAC/D,IAAI,CAAC;oBACL,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;gBAE5C;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC,cAAc;YAG3B;QACJ;QAEA,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,mBAAmB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC3C,QAAQ;YACR,aAAa;YACb,WAAW,CAAC;gBAER,IAAI,MAAM,SAAS,eAAe;oBAC9B,IAAI,CAAC,aAAa,MAAM;oBACxB,IAAI,MAAM,WAAW,QAAQ;wBAEzB,WAAW,IAAI,MAAM,OAAO,EAAE,QAAQ;wBAEtC,IAAI,CAAC,QAAQ,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;wBAC/D,IAAI,CAAC;wBACL,IAAI,CAAC;wBACL,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;oBAC5C,OACI,WAAW,IAAI,IAAI,CAAC,MAAM;gBAElC;gBAEA,IAAI,MAAM,SAAS,iBAAiB;oBAAC;oBAAQ;iBAAQ,CAAC,SAAS,KAAK,MAAM,WAAW,IAAI,CAAC,eAAe,MAAM,WAAW;oBAEtH,MAAM,SAAS,KAAK,IAAI,MAAM,QAAQ,MAAM;oBAC5C,MAAM,SAAS,CAAA,GAAA,sCAAsB,EAAE,QAAQ,MAAM,WAAW;oBAEhE,WAAW,KAAK,MAAM,KAAK,EAAE,QAAQ,SAAS;oBAE9C,IAAI,MAAM,WAAW,SAAS;wBAC1B,WAAW,IAAI,WAAW,IAAI;wBAC9B,IAAI,WAAW,IAAI,GACf,WAAW,KAAK;oBAExB;oBACA,WAAW,IAAI,KAAK,IAAI,QAAQ,WAAW;oBAC3C,IAAI,CAAC,QAAQ,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;oBAC/D,IAAI,CAAC;oBACL,IAAI,CAAC;oBACL,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;gBAE5C;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC,aAAa;YAE1B;QACJ;QAGA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,OAAO;YACX;QACJ;IACJ;IAEA,sBAAsB;IACtB,SAAU,CAAO,EAAQ;QACrB,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE;QAC5D,IAAI,CAAC;QACL,IAAI,CAAC;QACL,IAAI,CAAC;IACT;IAEA,WAAkB;QACd,OAAO,CAAA,GAAA,MAAC,EAAE,eAAe,MAAM,IAAI,CAAC;IACxC;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,MAAa;QACT,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,aAAa;IACtB;AACJ;;;;;ACvRA;;;CAGC,GACD,iDAAa;AAPb;AAOO,MAAM;IAMT,mBAAmB;IACnB,YACI,CAKC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,UAAU;YACd;QACJ;QACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,WAAW,SAAS,KAAM,CAAA,EAAE,YAAY,IAAI,CAAA,KAAM;gBAClD,OAAO,EAAE,QAAQ;YACrB;QACJ;QACA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,QAAQ,IAAI,CAAC;YACb,WAAW;QACf;QACA,IAAI;QACJ,IAAI,aAAa;QAEjB,aAAa;QACb,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,mCAAmC;gBACnC,QAAQ;gBACR,OAAO;gBACP,QAAQ;YACZ;QACJ;QAEA,MAAM,cAAc;YAChB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa;gBACrB,MAAM,YAAY;YACtB;QACJ;QACA,MAAM,WAAW;YACb,OAAO,YAAc,CAAA,EAAE,QAAQ,EAAE,SAAQ;QAC7C;QAEA;YACI,IAAI;YACJ,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM,EAAE,OAAQ,CAAA,EAAE,QAAQ,EAAE,SAAQ,GAAI,GAAG,EAAE,QAAQ,EAAE;YACtE,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa;gBACrB,OAAO,EAAE,YAAY;gBACrB,QAAQ,EAAE,YAAY;gBACtB,cAAc,EAAE,YAAY;YAChC;YACA;YACA,IAAI;YACJ,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC1C,QAAQ,IAAI,CAAC;gBACb,aAAa;gBACb,WAAW,CAAC;oBACR,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACzD,UAAU;wBACV,aAAa;wBACb,eAAe;wBACf;wBACA,MAAM;oBACV,OAAO,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBAChE,MAAM;wBACN,eAAe,eAAe,MAAM;wBACpC,YAAY,SAAS,KAAK,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc,GAAG,EAAE,QAAQ,EAAE;wBAChE;wBACA,EAAE,SAAS,YAAY,SAAS;wBAChC,UAAU;oBACd;oBACA,IAAI,MAAM,SAAS,aAAa;wBAC5B,MAAM;wBACN,aAAa;wBACb;wBACA,EAAE,SAAS,YAAY,OAAO;oBAClC;gBACJ;YACJ;QACJ;IACJ;IAEA,sBAAsB;IAEtB,QAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAW,QAAiB,EAAQ;QAChC,IAAI,CAAC,YAAY,MAAM,kBAAkB,WAAW,SAAS;IACjE;IAEA,UAAiB;QACb,IAAI,CAAC,gBAAgB;IACzB;AACJ;;;;;AC5GA;;;;CAIC,GACD,kDAAa;AAXb;AAEA;AACA;AACA;AAOO,MAAM;IAcT,mBAAmB;IACnB,YACI,CAMC,CACH;aAhBe,WAA6B,EAAE;aACxC,gBAAwB;QAgB5B,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS,EAAE,QAAQ,EAAE,QAAQ;YAC7B,OAAO,EAAE,SAAS;YAClB,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,KAAK;YACT;QACJ;QAEA,IAAI,CAAC,YAAY,EAAE;QACnB,MAAM,aAAa;QACnB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,WAAW,CAAA,GAAA,YAAI,EAAE;QAE/D,IAAI,CAAC,qBAAqB;YACtB,MAAM,IAAI,IAAI,CAAC;YACf,MAAM,QAAQ,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC9B,IAAI,CAAC,SAAS,MAAM,IAAI,GACpB,SAAS;YACT;YAGJ,MAAM,cAAc,IAAI,CAAC,WAAW;YACpC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,MAAM,kBAAkB;YAC9D,IAAI,CAAC,QAAQ,CAAC,EAAE,GAAG;gBACf,GAAG,CAAA,GAAA,qBAAa,EAAE,SAAS,YAAY;gBACvC,GAAG;YACP;YACA,EAAE,SAAS,IAAI,CAAC,QAAQ,CAAC,EAAE;QAC/B;QACA,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,SAAS;YACT,QAAQ;gBACJ,MAAM;gBACN,UAAU;YACd;QACJ;QACA,IAAI,CAAC,WAAW,WAAW,IAAI,CAAC;QAChC,IAAI,CAAC,WAAW,UAAU,IAAI,CAAC;QAE/B,2CAA2C;QAC3C,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,SAAS,QAAQ,IAAK;YACxC,MAAM,OAAO,EAAE,QAAQ,CAAC,EAAE;YAC1B,IAAI,QAAQ;YACZ,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,QAAQ,IAAK;gBAC3C,MAAM,QAAQ,IAAI,CAAC,QAAQ,CAAC,EAAE;gBAC9B,IAAI,UAAU,MAAM;oBAChB,QAAQ;oBACR;gBACJ;gBACA,IAAI,UAAU,QAAQ,SAAS,MAC3B;gBAEJ,IAAI,MAAM,MAAM,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,MAAM,MAAM,KAAK,GAAG;oBACtF,QAAQ;oBACR;gBACJ;YACJ;YACA,IAAI,OACA;YAEJ,IAAI,CAAC,SAAS,KAAK;YACnB,IAAI,kBAAkB,KAAK,EAAE,iBAAiB,GAC1C,IAAI,CAAC,gBAAgB,IAAI,CAAC,SAAS,SAAS;QAEpD;QAEA,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,QAAQ,IACtC,AAAC,CAAA,CAAC;YACE,MAAM,QAAQ,IAAI,CAAC,QAAQ,CAAC,EAAE;YAE9B,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;gBACtB,QAAQ,IAAI,CAAC;gBACb,SAAS,QAAQ,KAAK;gBACtB,WAAW;gBACX,KAAK;oBACD,OAAO,aAAa;oBACpB,QAAQ,aAAa;oBACrB,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU,SAAS;oBAC9D,YAAY,AAAC,aAAa,IAAK;gBACnC;gBACA,SAAS,CAAC;oBACN,IAAI,IAAI,CAAC,kBAAkB,GAAG;wBAC1B,IAAI,SAAS,MAAM,MAAM,GACrB,IAAI,CAAC,WAAW,aAAa,IAAI,CAAC,WAAW,eAAe,IAAI,CAAC,WAAW;wBAEhF;oBACJ;oBAEA,EAAE;oBACF,IAAI,CAAC,gBAAgB;oBACrB;oBACA,EAAE,SAAS,IAAI,CAAC,QAAQ,CAAC,EAAE,GAAG,mBAAmB;gBACrD;YACJ;YACA,IAAI,SAAS,MAAM,MAAM,GACrB,YAAY,MAAM,kBAAkB,SAAS,aAAa;YAG9D,MAAM,gBAAgB,CAAC;gBACnB,YAAY,UAAU,OAAO,2BAA2B;YAC5D;YAEA,IAAI,CAAC,UAAU,KAAK;gBAChB,IAAI;gBACJ;YACJ;QACJ,CAAA,EAAG;QAGP,IAAI,CAAC,OAAO,OAAO,CAAA,GAAA,IAAA,EAAE,4BAA4B;YAAC,IAAI,CAAC;SAAW;QAGlE,MAAM,SAAS;YACX,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,cAAc,MAAM,IAAI,CAAC;QAEnD;QACA;QAEA,IAAI,CAAC,qBAAqB;YACtB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,WAAW,CAAA,GAAA,YAAI,EAAE;YAC/D,IAAI,CAAC,UAAU,QAAQ,CAAC,QAAQ;gBAC5B,MAAM,QAAQ,IAAI,CAAC,QAAQ,CAAC,EAAE;gBAC9B,IAAI,SAAS,MAAM,MAAM,GACrB,OAAO,GAAG,MAAM,kBAAkB,SAAS,aAAa;YAEhE;QACJ;QACA,CAAA,GAAA,YAAI,EAAE,kBAAkB,IAAI,CAAC;IACjC;IAEA,sBAAsB;IACtB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAA0B;QACtB,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc;IAC5C;IAEA,UAAiB;QACb,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB,CAAA,GAAA,MAAC,EAAE,UAAU,KAAK;QACtB;QACA,IAAI,CAAC,UAAU,OAAO,GAAG,IAAI,CAAC,UAAU;QACxC,CAAA,GAAA,YAAI,EAAE,qBAAqB,IAAI,CAAC;QAChC,IAAI,CAAC,WAAW,WAAW;QAC3B,IAAI,CAAC,WAAW,UAAU;IAC9B;AAEJ;;;;;ACzLA;;CAEC,GACD,6CAAa;AALb;AAKO,MAAM;IAUD,WAAoB;QACxB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IAAK;YAC5C,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,YAC9B,OAAO;QAEf;QACA,OAAO;IACX;IAEQ,SAAgB;QACpB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,GAAG,UAAU,OAC3B,sBACA,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC;IAG1C;IAEA,mBAAmB;IACnB,YACI,CAUC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE;QAEjB,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,SAAS;YACb;QACJ;QAEA,IAAI,EAAE,UACF,IAAI,CAAC,WAAW,EAAE;QAEtB,IAAI,CAAC,YAAY,EAAE;QACnB,IAAI,CAAC,aAAa,AAAC,eAAe,KAAK,EAAE,WAAW,YAAa,EAAE,SAAS,EAAE,SAAS,CAAC,EAAE,CAAC;QAE3F,MAAM,eAAe,CAAC;YAMlB,MAAM,WAAW;gBAAC;aAAY;YAC9B,IAAI,EAAE,SACF,SAAS,KAAK;YAElB,IAAI,OAAO,EAAE,UAAU,UAAU;gBAC7B,SAAS,KAAK;gBACd,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,OAAO;oBACZ,SAAS;oBACT,eAAe;gBACnB;YACJ;YAEA,MAAM,YAAY;gBACd,IAAI,EAAE;gBACN,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;oBACN,QAAQ;oBACR,SAAS,EAAE;oBACX,WAAW,SAAS,KAAK;oBACzB,SAAS;wBACL,IAAI,IAAI,CAAC,eAAe,UAAU,IAAI;4BAClC,IAAI,CAAC,aAAa,UAAU;4BAC5B,IAAI,CAAC;4BACL,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC;wBACxC;oBACJ;gBACJ;YACJ;YAEA,IAAI,EAAE,OACF,UAAU,GAAG,QAAQ,EAAE;YAG3B,IAAI,CAAC,UAAU,KAAK;QACxB;QAEA,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,UAAU,QAAQ,IACpC,aAAa,EAAE,SAAS,CAAC,EAAE;QAG/B,IAAI,CAAC;QAEL,IAAI,EAAE,cACF,WAAW;YACP,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC;QACxC,GAAG;IAEX;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,OAAc;QACV,IAAI,CAAC,aAAa,IAAI,CAAC,SAAS,CAAC,AAAC,CAAA,IAAI,CAAC,aAAa,CAAA,IAAK,IAAI,CAAC,UAAU,OAAO,CAAC;QAChF,IAAI,CAAC;QACL,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC;IACxC;IAEA,WAAkB;QACd,IAAI,CAAC,aAAa,IAAI,CAAC,SAAS,CAAC,AAAC,CAAA,IAAI,CAAC,UAAU,SAAS,IAAI,CAAC,aAAa,CAAA,IAAK,IAAI,CAAC,UAAU,OAAO,CAAC;QACxG,IAAI,CAAC;QACL,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC;IACxC;IAEA,UAAiB;QACb,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB,CAAA,GAAA,MAAC,EAAE,UAAU,KAAK;QACtB;QACA,IAAI,CAAC,UAAU,OAAO,GAAG,IAAI,CAAC,UAAU;IAC5C;AACJ;;;;;AC1IA;;CAEC,GACD,mDAAa;AATb;AACA;;AAQO,MAAM;IAaD,gBAAiB;QACrB,IAAI,IAAI,CAAC,YAAY,QACjB,IAAI,CAAC,GAAG,MAAM,OAAO;aAErB,IAAI,CAAC,GAAG,MAAM,eAAe;IAErC;IAGA,iBAAiB;IAEjB,aAAe;aAlBP,SAAkB,MAAO,oBAAoB;;aAC7C,UAAoB;QAkBxB,IAAI,CAAC,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;YACZ,WAAW;YACX,SAAS,CAAA,GAAA,MAAC,EAAE;QAChB;QAEA,IAAI,CAAC;QAEL,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,WAAW;QACf;QAGA,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,QAAQ,MAAM,CAAA,GAAA,wBAAO;QAC1B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS;YACjB,eAAe;YACf,OAAO;YACP,QAAQ;YACR,YAAY;YACZ,cAAc;QAClB;QAEA,IAAI,CAAC,eAAe,SAAS,cAAc;QAC3C,IAAI,CAAC,aAAa,MAAM,UAAU;QAElC,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC;QAC5C,IAAI,CAAC,GAAG,OAAO,IAAI,CAAC;QACpB,SAAS,KAAK,OAAO,IAAI,CAAC;QAC1B,IAAI,CAAC,GAAG,MAAM,UAAU;IAC5B;IAEA,QAAS,CAAU,EAAE;QACjB,IAAI,CAAC,SAAS;QAEd,IAAI,CAAC,IAAI,CAAC,IACN;QAGJ,IAAI,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,GAAG,MAAM,QAAQ;YACtB,IAAI,CAAC,GAAG,MAAM,OAAO;QACzB,OAAO;YACH,IAAI,CAAC,GAAG,MAAM,eAAe;YAC7B,IAAI,CAAC,GAAG,MAAM,OAAO,IAAI,CAAC,YAAY,SAAS,UAAU;QAC7D;IACJ;IAEA,WAAY,KAAe,EAAE;QACzB,IAAI,CAAC,UAAU;QACf,IAAI,CAAC;IACT;IAEA,IAAK,GAAkE,EAAE,OAAiB,EAAE;QAExF,IAAI,OAAO,QAAQ,UAAU;YACzB,IAAI,CAAC,QAAQ,MAAM,UAAU;YAC7B,IAAI,CAAC,aAAa,YAAY;QAClC,OACI,IAAI,IAAI,SAAS,aAAa;YAC1B,IAAI,CAAC,QAAQ,MAAM,UAAU;YAC7B,IAAI,CAAC,QAAQ,MAAM,YAAY,YAAY,IAAI,WAAW;YAE1D,IAAI,IAAI,WAAW,OAAO,GACtB,IAAI,CAAC,QAAQ,MAAM,YAAY;iBAE/B,IAAI,CAAC,QAAQ,MAAM,YAAY;YAGnC,IAAI,CAAC,aAAa,YAAY,KAAK,MAAM,IAAI,QAAQ,OAAO;QAGhE,OACI,IAAI,CAAC,QAAQ,MAAM,UAAU;QAIrC,IAAI,SAAS;YACT,IAAI,CAAC,QAAQ,MAAM,YAAY;YAC/B,WACI,IAAM,IAAI,CAAC,QAAQ,MAAM,YAAY,iCACrC;YAEJ,aAAa,IAAI,CAAC;YAClB,IAAI,CAAC,WAAW,WACZ,IAAM,IAAI,CAAC,QAAQ,MAAM,YAAY,IACrC;QAER;QAIA,aAAa,IAAI,CAAC;QAClB,aAAa,IAAI,CAAC;QAClB,IAAI,CAAC,GAAG,MAAM,gBAAgB,UAAU,kBAAkB;QAC1D,IAAI,CAAC,GAAG,MAAM,UAAU;QACxB,IAAI,CAAC,UAAU,WAAW;YACtB,IAAI,CAAC,GAAG,MAAM,UAAU;YACxB,IAAI,CAAC,GAAG,MAAM,gBAAgB;YAC9B,IAAI,CAAC,WAAW,WAAW;gBACvB,IAAI,CAAC,GAAG,MAAM,UAAU;YAC5B,GAAG;QACP,GAAG;QACH,IAAI,CAAC,GAAG,MAAM,UAAU;IAC5B;AAGJ;;;AC5IA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,uBAAuB,MAAM,KAAK;;;;;ACe3G;;CAEC,GACD,8CAAa;AAlBb;AAIA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AAOO,MAAM;IAgBD,YAAmB;QACvB,IAAI,CAAC,OAAO;YACR,GAAG;YACH,GAAG;YACH,OAAO,IAAI,CAAC,OAAO;YACnB,QAAQ,IAAI,CAAC,OAAO;QACxB;IACJ;IAEQ,2BAAmC;QACvC,MAAM,YAAY,IAAI,CAAC,QAAQ;QAC/B,MAAM,MAAM,CAAA,GAAA,4CAAoB,EAAE;QAClC,MAAM,IAAI,CAAA,GAAA,kCAAW,EAAE,KAAK,IAAI,CAAC;QACjC,OAAO;YACH,GAAG,EAAE;YACL,GAAG,EAAE;YACL,OAAO,IAAI,CAAC,KAAK,QAAQ,UAAU;YACnC,QAAQ,IAAI,CAAC,KAAK,SAAS,UAAU;QACzC;IACJ;IAEQ,sBAA6B;QACjC,IAAI,CAAC,cAAc,QAAQ,KAAK,MAAM,IAAI,CAAC,KAAK;QAChD,IAAI,CAAC,cAAc,SAAS,KAAK,MAAM,IAAI,CAAC,KAAK;QACjD,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACxB,IAAI,UAAU,IAAI,CAAC,QAAQ,KAAK,MAAM,CAAC,IAAI,CAAC,KAAK,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,KAAK;QAC3E,IAAI,IAAI,CAAC,cACL,IAAI,CAAC,aAAa,MAAM,IAAI,CAAC,cAAc,UAAU;QAEzD,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,IAAI,CAAC,cAAc,OAAO,IAAI,CAAC,cAAc;IAChF;IACQ,sBAA6B;QACjC,MAAM,OAAO,IAAI,CAAC;QAElB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,iBAAiB;YACzB,MAAM,KAAK,IAAI;YACf,KAAK,KAAK,IAAI;YACd,OAAO,KAAK,QAAQ;YACpB,QAAQ,KAAK,SAAS;YACtB,SAAS,IAAI,CAAC,YAAY,SAAS;QACvC;QACA,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS,KAAK,MAAM,IAAI,CAAC,KAAK,QAAQ,KAAK,MAAM,IAAI,CAAC,KAAK;IACrF;IAEA,mBAAmB;IAEnB,YACI,KAMC,CACH;aAlEM,OAAc;YAAC,GAAG;YAAG,GAAG;YAAG,OAAO;YAAG,QAAQ;QAAC,EAAG,qBAAqB;;aAStE,OAAqB;QA0DzB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,QAAQ,MAAM,SAAS;gBACvB,OAAO,MAAM,QAAQ;gBACrB,UAAU;YACd;QACJ;QACA,IAAI,MAAM,UACN,IAAI,CAAC,WAAW,MAAM;QAE1B,IAAI,CAAC,SAAS,MAAM;QAEpB,IAAI,CAAC;QAKL,MAAM,wBAAwB,CAAC;YAC3B,OAAO,CAAA,GAAA,MAAC,EAAE,aAAa,GAAG,IAAI,CAAC;QACnC;QAEA,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE;QACxB,IAAI,CAAC,cAAc,IAAI,CAAC;QACxB,IAAI,CAAC,MAAM,WAAW;YAClB,IAAI,CAAC,eAAe,IAAI;YACxB,IAAI,CAAC,cAAc,IAAI,CAAC;QAC5B;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa;YACrB,QAAQ,MAAM,SAAS;YACvB,OAAO,MAAM,QAAQ;QACzB;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC;QACxB,IAAI,CAAC;QAEL,IAAI,CAAC,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACvB,OAAO,MAAM;YACb,QAAQ,MAAM,SAAS;YACvB,SAAS;gBACL,OAAO,MAAM,OAAO;gBACpB,QAAQ,MAAM,OAAO;gBACrB,QAAQ;oBAAC;wBACL,OAAO,MAAM;wBACb,SAAS;wBACT,WAAW;wBACX,YAAY;wBACZ,aAAa;oBACjB;iBAAE;YACN;YACA,aAAa;YACb,cAAc,CAAC;gBACX,IAAI,CAAC,OAAO;gBACZ,IAAI,CAAC,QAAQ,aAAa,MAAM,gBAAgB,SAAS,SAAS,SAAS;gBAC3E,IAAI,CAAC,OAAO,QAAQ,SAAS,SAAS,CAAA,GAAA,cAAG,EAAE,uBAAuB;YACtE;YACA,mBAAmB,IAAM,IAAI,CAAC;YAC9B,SAAS;YACT,WAAW;YACX,UAAU,CAAA,GAAA,2BAAU;QACxB;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ,cAAc;YAC9B,UAAU;YACV,MAAM;YACN,KAAK;YACL,UAAU;YACV,eAAe;QACnB;QACA,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,QAAQ;QAEhC,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,QAAQ,IAAI,CAAC,QAAQ;YACrB,WAAW;QACf;QACA,IAAI,CAAC;QAEL,+BAA+B;QAC/B,MAAM,UAAU,CAAC,IAAe;YAC5B,MAAM,MAAM,CAAA,GAAA,4CAAoB,EAAE,IAAI,CAAC,QAAQ;YAC/C,MAAM,aAAa,CAAA,GAAA,6BAAM,EAAE;YAC3B,MAAM,WAAW;gBACb,GAAG,KAAK,IAAI,GAAG,GAAG,GAAG;gBACrB,GAAG,KAAK,IAAI,GAAG,GAAG,GAAG;YACzB;YACA,MAAM,eAAe;gBACjB,GAAG,KAAK,IAAI,GAAG,GAAG,GAAG;gBACrB,GAAG,KAAK,IAAI,GAAG,GAAG,GAAG;YACzB;YACA,MAAM,eAAe,CAAA,GAAA,kCAAW,EAAE,YAAY;YAC9C,MAAM,mBAAmB,CAAA,GAAA,kCAAW,EAAE,YAAY;YAClD,aAAa,IAAI,CAAA,GAAA,WAAI,EAAE,KAAK,MAAM,aAAa,IAAI,GAAG,IAAI,CAAC,OAAO;YAClE,aAAa,IAAI,CAAA,GAAA,WAAI,EAAE,KAAK,MAAM,aAAa,IAAI,GAAG,IAAI,CAAC,OAAO;YAClE,iBAAiB,IAAI,CAAA,GAAA,WAAI,EAAE,KAAK,KAAK,iBAAiB,IAAI,GAAG,IAAI,CAAC,OAAO;YACzE,iBAAiB,IAAI,CAAA,GAAA,WAAI,EAAE,KAAK,KAAK,iBAAiB,IAAI,GAAG,IAAI,CAAC,OAAO;YACzE,OAAO;gBACH,GAAG,aAAa;gBAChB,GAAG,aAAa;gBAChB,OAAO,iBAAiB,IAAI,aAAa;gBACzC,QAAQ,iBAAiB,IAAI,aAAa;YAC9C;QACJ;QAIA,IAAI;QACJ,IAAI,YAA0B;QAC9B,IAAI,aAAa;QACjB,IAAI,UAAU;QACd,IAAI;QACJ,MAAM,eAAe,IAAI,CAAA,GAAA,sBAAS,EAAE;YAChC,UAAU;gBACN,IAAI,CAAA,GAAA,oCAAgB;aACvB;QACL;QACA,aAAa,YAAY,CAAC;YACtB,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;gBACzD,MAAM;gBACN,aAAa;gBACb,SAAS;oBACL,GAAG,MAAM;oBACT,GAAG,MAAM;gBACb;gBACA,IAAI,CAAC,IAAI,CAAC,aAAa,sBAAsB,SACzC,YAAY;oBACR,GAAG,IAAI,CAAC,KAAK;oBACb,GAAG,IAAI,CAAC,KAAK;oBACb,OAAO,IAAI,CAAC,KAAK;oBACjB,QAAQ,IAAI,CAAC,KAAK;gBACtB;qBAEA,IAAI,CAAC,OAAO,QAAQ,QAAQ;YAEpC,OAAO,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;gBAChE,MAAM;gBACN,UAAU;gBACV,IAAI,WAAW;oBACX,MAAM,YAAY,IAAI,CAAC,QAAQ;oBAC/B,IAAI,CAAC,KAAK,IAAI,UAAU,IAAI,KAAK,MAAM,AAAC,CAAA,MAAM,OAAO,OAAQ,CAAA,IAAK,UAAU;oBAC5E,IAAI,CAAC,KAAK,IAAI,UAAU,IAAI,KAAK,MAAM,AAAC,CAAA,MAAM,OAAO,OAAQ,CAAA,IAAK,UAAU;oBAC5E,IAAI,CAAC,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,GAAG,GAAG,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,KAAK;oBACrE,IAAI,CAAC,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,GAAG,GAAG,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,KAAK;gBAC1E,OACI,IAAI,CAAC,OAAO,QAAQ,QAAS;oBAAC,GAAG,MAAM;oBAAM,GAAG,MAAM;gBAAI;gBAE9D,IAAI,CAAC;YACT,OAAO,IAAI,MAAM,SAAS,eAAe,QAAQ;gBAC7C,MAAM;gBACN,aAAa;gBACb,YAAY;gBACZ,SAAS;gBACT,IAAI,IAAI,CAAC,KAAK,UAAU,KAAK,IAAI,CAAC,KAAK,WAAW,KAAK,CAAC,SAAS;oBAC7D,IAAI,CAAC;oBACL,IAAI,CAAC;gBACT;gBACA,UAAU;gBACV,oBAAoB,WAAW,IAAM,IAAI,CAAC,uBAAuB;YACrE;QACJ;QACA,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC1C,QAAQ,IAAI,CAAC;YACb,aAAa;YACb,SAAS,CAAC;gBACN,IAAI,CAAC,QAAQ,QAAQ;YACzB;YACA,WAAW,CAAC;gBACR,IAAI,IAAI,CAAC,SAAS,QAAQ;oBACtB,MAAM;oBACN,IAAI,CAAC,QAAQ,UAAU;oBACvB;gBACJ;gBACA,aAAa,QAAQ;YACzB;YACA,aAAa;QACjB;QAEA,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YAClC,QAAQ,CAAC,QAAQ;gBACb,IAAI,YACA;gBAEJ,IAAI,WAAW;gBACf,MAAM,YAAY,IAAI,CAAC,QAAQ;gBAE/B,MAAM,WAAW,KAAK,IAAI,GAAG,IAAI,UAAU;gBAC3C,MAAM,iBAAiB,IAAI,CAAC,YAAY,UAAU;gBAElD,IAAI,WAAW,QAAQ;oBACnB,IAAI,gBACA,IAAI,CAAC,KAAK,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,QAAQ,UAAU,GAAG,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,KAAK;yBAExF,IAAI,CAAC,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,KAAK;oBAEpF,WAAW;gBACf;gBACA,IAAI,WAAW,SAAS;oBACpB,IAAI,gBACA,IAAI,CAAC,KAAK,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,QAAQ,UAAU,GAAG,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,KAAK;yBAExF,IAAI,CAAC,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,KAAK;oBAEpF,WAAW;gBACf;gBACA,IAAI,WAAW,MAAM;oBACjB,IAAI,gBACA,IAAI,CAAC,KAAK,SAAS,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,SAAS,UAAU,GAAG,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,KAAK;yBAE3F,IAAI,CAAC,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,KAAK;oBAErF,WAAW;gBACf;gBACA,IAAI,WAAW,QAAQ;oBACnB,IAAI,gBACA,IAAI,CAAC,KAAK,SAAS,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,SAAS,UAAU,GAAG,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,KAAK;yBAE3F,IAAI,CAAC,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,KAAK;oBAErF,WAAW;gBACf;gBAEA,IAAI,UAAU;oBACV,EAAE;oBACF,IAAI,CAAC;oBACL,aAAa;oBACb,oBAAoB,WAAW,IAAM,IAAI,CAAC,uBAAuB;gBACrE;YACJ;QACJ;IACJ;IAEA,sBAAsB;IAEtB,QAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IACA,QAAe;QACX,IAAI,CAAC;QACL,IAAI,CAAC;QACL,IAAI,CAAC;IACT;IACA,UAAiB;QACb,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,YAAY,MAAM,eAAe;QACtC,IAAI,CAAC,YAAY,MAAM,eAAe;QACtC,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,gBAAgB;QACrB,IAAI,CAAC,QAAQ;IACjB;IACA,UAAoB;QAChB,OAAO,IAAI,CAAC,KAAK,MAAM,KAAK,IAAI,CAAC,KAAK,MAAM,KAAK,IAAI,CAAC,KAAK,UAAU,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,KAAK,WAAW,IAAI,CAAC,OAAO;IAC/H;IACA,UAAkB;QACd,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;IAC3B;IACA,mBAAuC;QACnC,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;AClTA,6CAAa;AAxCb;AACA;AACA;AACA;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA,MAAM,kBAAkB;AAEjB,MAAM;IAmCD,kBAAyB;QAC7B,IAAI,CAAC,WAAW;IACpB;IAEQ,YAAa,CAAS,EAAE,CAAS,EAAQ;QAC7C,IAAI,IAAI,CAAC,SAAS;YACd,IAAI,CAAC,UAAU;YAEf,MAAM,UAAU,CAAA,GAAA,kCAAW,EAAE,CAAA,GAAA,6BAAM,EAAE,CAAA,GAAA,4CAAoB,EAAE,IAAI,CAAC,SAAS,kBAAkB;gBAAC;gBAAG;YAAC;YAEhG,IAAI,CAAC,SAAS,aAAa,CAAA,GAAA,gCAAc,EACrC;gBAAC,GAAG,IAAI,CAAC,QAAQ;gBAAG,GAAG,IAAI,CAAC,SAAS;YAAC,GACtC,SACA,GACA;YAEJ,IAAI,CAAC;QACT,OACI,IAAI,CAAC;IAEb;IAEQ,QAAe;QACnB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QACX,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ,QACjC,IAAI,CAAC,QAAQ,IAAI,CAAC,UAAU,GAC5B,IAAI,CAAC,SAAS,IAAI,CAAC,UAAU;QAEjC,MAAM,QAAQ,IAAI,QAAQ,IAAI,CAAC,QAAQ;QACvC,IAAI,CAAC,SAAS,aAAa,CAAA,GAAA,gCAAc,EACrC;YAAC,GAAG,IAAI,CAAC,QAAQ;YAAG,GAAG,IAAI,CAAC,SAAS;QAAC,GACtC;YAAC,GAAG,IAAI,CAAC,QAAQ,QAAQ;YAAG,GAAG,IAAI,CAAC,QAAQ,SAAS;QAAC,GACtD,OACA;QAEJ,IAAI,CAAC,UAAU;QACf,IAAI,CAAC;IACT;IAEQ,gBACJ,CAcC,EACG;QACJ,IAAI,EAAE,SAAS,aAAa;YACxB,MAAM,MAAM,IAAI,CAAC,SAAS;YAC1B,IAAI,EAAE,MAAM,KAAK,EAAE,MAAM,GACrB;YAEJ,IAAI,CAAC,SAAS,aAAa;gBACvB,GAAG,GAAG;gBACN,GAAG,IAAI,IAAI,EAAE;gBACb,GAAG,IAAI,IAAI,EAAE;YACjB;QACJ,OAAO,IAAI,EAAE,SAAS,QAAQ;YAC1B,MAAM,MAAM,IAAI,CAAC,SAAS;YAC1B,MAAM,eAAe,IAAI,CAAC,SAAS,aAAa;YAChD,EAAE,KAAK,EAAE,MAAM,aAAa,QAAQ;YACpC,EAAE,KAAK,EAAE,MAAM,aAAa,SAAS;YAErC,MAAM,gBAAgB,CAAA,GAAA,gCAAc,EAChC,KACI;gBAAC,GAAG,EAAE;gBAAI,GAAG,EAAE;YAAE;YAEzB,cAAc,SAAS,EAAE;YAEzB,IAAI,CAAC,SAAS,aAAa,CAAA,GAAA,gCAAc,EACrC,cAAc,WACd,cAAc,SACd,cAAc,OACd,cAAc;QAEtB;QACA,IAAI,CAAC,UAAU;QAEf,IAAI,CAAC;IACT;IAEA,mBAAmB;IACnB,YAAa,CAAiB,CAAE;aAxHxB,UAAmB;aAEnB,WAAW;aAIX,uBAA2C;YAAC,GAAG;YAAG,GAAG;YAAG,OAAO;YAAG,UAAU;QAAC;aAM7E,aAAa;YACjB,IAAI,CAAC,mBAAmB,sBAAsB,IAAI,CAAC;YAEnD,IAAI,IAAI,CAAC,UAAU;gBACf,IAAI,CAAC,WAAW;gBAChB,IAAI,CAAC,SAAS;gBACd,MAAM,oBAAoB,IAAI,CAAC,SAAS;gBACxC,IACI,IAAI,CAAC,qBACL,KAAK,UAAU,IAAI,CAAC,0BAA0B,KAAK,UAAU,oBAC/D;oBACE,IAAI,CAAC,kBAAkB;oBACvB,IAAI,CAAC,uBAAuB;gBAChC;YACJ;QACJ;aA+UA,UAAU,CAAC;YACP,MAAM,eAAe,IAAI,CAAC,SAAS,aAAa;YAChD,MAAM,KAAK,EAAE,QAAQ,aAAa;YAClC,MAAM,KAAK,EAAE,QAAQ,aAAa;YAElC,MAAM,WAAW,IAAI,CAAC,SAAS,eAAe;YAC9C,MAAM,WAAW,CAAA,GAAA,sBAAS,EAAE,UAAU,CAAC,EAAE,SAAS;YAElD,IAAI,CAAC,gBAAgB;gBACjB,MAAM;gBACN;gBACA;gBACA,KAAK,WAAW;YACpB;QACJ;QA/PI,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,CAAC,UAAU,EAAE;QACjB,IAAI,CAAC,oBAAoB,EAAE;QAC3B,IAAI,CAAC,UAAU,EAAE,WAAW;QAE5B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QACX,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ,QACjC,IAAI,CAAC,QAAQ,IAAI,CAAC,UAAU,GAC5B,IAAI,CAAC,SAAS,IAAI,CAAC,UAAU;QAEjC,MAAM,QAAQ,IAAI,QAAQ,IAAI,CAAC,QAAQ;QAEvC,IAAI,CAAC,WAAW,IAAI,CAAA,GAAA,gCAAc,EAAE;YAChC,OAAO,IAAI,CAAC;YACZ,QAAQ,IAAI,CAAC;YACb,WAAW,CAAA,GAAA,gCAAc,EACrB;gBAAC,GAAG,IAAI,CAAC,QAAQ;gBAAG,GAAG,IAAI,CAAC,SAAS;YAAC,GACtC;gBAAC,GAAG,IAAI,CAAC,QAAQ,QAAQ;gBAAG,GAAG,IAAI,CAAC,QAAQ,SAAS;YAAC,GACtD,OACA;YAEJ,SAAS,IAAI,CAAC;YACd,qBAAqB;YACrB,gBAAgB;QACpB;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YAClC,aAAa,CAAC;gBACV,MAAM,IAAI,CAAA,GAAA,4CAAoB,EAAE,IAAI,CAAC,SAAS;gBAC9C,MAAM,KAAK,CAAA,GAAA,kCAAW,EAAE,GAAG;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBACtC,MAAM,KAAK,CAAA,GAAA,kCAAW,EAAE,GAAG;oBAAC,GAAG,IAAI,CAAC,QAAQ;oBAAO,GAAG,IAAI,CAAC,QAAQ;gBAAM;gBACzE,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,aAChB;oBAAC,GAAG,EAAE;oBAAM,GAAG,EAAE;gBAAI,GACrB;oBACI,GAAG,GAAG;oBACN,GAAG,GAAG;oBACN,OAAO,GAAG,IAAI,GAAG;oBACjB,QAAQ,GAAG,IAAI,GAAG;gBACtB;gBAGJ,IAAI,CAAC,IAAI,CAAC,WAAW,UACjB,IAAI,CAAC,YAAY,EAAE,MAAM,EAAE;YAEnC;YACA,WAAW;QACf;QACA,IAAI,eAA+C;QACnD,MAAM,cAAc,IAAI,CAAA,GAAA,wBAAU,EAAE;YAChC,SAAS,CAAC;gBACN,IAAI,EAAE,SAAS,QAAQ;oBACnB,IAAI,CAAC,cACD,eAAe,IAAI,CAAC,SAAS;oBAEjC,MAAM,gBAAgB,CAAA,GAAA,gCAAc,EAAE,cAAc;wBAAC,GAAG,EAAE;wBAAU,GAAG,EAAE;oBAAQ;oBACjF,cAAc,SAAS,EAAE;oBACzB,cAAc,UAAU,KAAK,EAAE,OAAO,EAAE;oBACxC,cAAc,UAAU,KAAK,EAAE,OAAO,EAAE;oBACxC,IAAI,CAAC,SAAS,aAAa,CAAA,GAAA,gCAAc,EACrC,cAAc,WACd,cAAc,SACd,cAAc,OACd,cAAc;oBAElB,IAAI,CAAC;oBACL,IAAI,CAAC,UAAU;gBAEnB,OAAQ,IAAI,EAAE,SAAS,OACnB,eAAe;YAEvB;QACJ;QAGA,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,sBAAS,EAAE;YAChC,UAAU;gBACN;gBACA;aACH;QACJ;QACA,IAAI,CAAC,aAAa,YAAY,CAAC;YAC3B,IAAI,EAAE,UAAU;gBAAC;gBAAQ;aAAS,CAAC,SAAS,EAAE,SAC1C,+BAA+B;YAC/B,IAAI,CAAC,gBAAgB;gBACjB,MAAM;gBACN,GAAG,EAAE;gBACL,GAAG,EAAE;YACT;QAER;QAEA,IAAI,CAAC,SAAS,aAAa,UAAU,IAAI,CAAA,GAAA,QAAE,EAAE;YACzC,QAAQ;YACR,WAAW;gBACP,QAAQ;YACZ;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,cAAc;YAC/B,YAAY;YACZ,aAAa;QACjB;QACA,IAAI,CAAC,SAAS,aAAa,iBAAkB,YAAY,CAAC;YACtD,EAAE;YACF,OAAO;QACX;QACA,IAAI,CAAC,SAAS,aAAa,iBAAiB,eAAe,CAAC;YACxD,EAAE;YACF,OAAO;QACX;QACA,IAAI,CAAC,SAAS,aAAa,iBAAiB,aAAa,CAAC;YACtD,EAAE;YACF,OAAO;QACX;QAEA,IAAI,CAAC,0BAA0B,IAAI,CAAA,GAAA,gCAAc,EAAE;YAC/C,QAAQ,IAAI,CAAC,SAAS;YACtB,WAAW,CAAC;gBACR,IAAI,CAAC,aAAa,QAAQ;YAC9B;YACA,SAAS,IAAI,CAAC;YACd,aAAa;QACjB;QACA,IAAI,CAAC,SAAS,aAAa,iBAAiB,SAAS,CAAC;YAClD,EAAE;QACN;QAEA,IAAI,EAAE,aACF,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,gBAAM,EAAgB;YACxC,WAAW,AAAC;gBAAC;gBAAQ;aAAO,CAAW,IAAI,CAAA;gBACvC,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;oBACb,WAAW;oBACX,KAAK;wBACD,OAAO;wBACP,QAAQ;wBACR,gBAAgB;wBAChB,QAAQ;wBACR,iBAAiB,CAAC,IAAI,EAAE,OAAO,SAAS,EAAE,YAAY,CAAA,GAAA,6BAAY,IAAI,CAAA,GAAA,2BAAU,EAAE,CAAC,CAAC;wBACpF,oBAAoB;wBACpB,kBAAkB;oBACtB;gBACJ;gBAEA,OAAO;oBACH;oBACA,OAAO;oBACP,OAAO,OAAO,SAAS,CAAA,GAAA,cAAG,EAAE,cAAc,CAAA,GAAA,cAAG,EAAE;gBACnD;YACJ;YACA,QAAQ;YACR,UAAU,CAAC;gBACP,EAAE,gBAAgB,EAAE,aAAa;YACrC;QACJ;QAGJ,MAAM,QAAQ,CAAA,GAAA,QAAE,EAAE,EAAE,cAAc,QAAQ,CAAC,IAAI;YAC3C,WAAW;YACX,cAAc;YACd,oBAAoB;gBAChB,WAAW;gBACX,cAAc;YAClB;QACJ;QACA,qFAAqF;QACrF,IAAI,CAAC,SAAS,CAAA,GAAA,IAAA,EACV;YACI,WAAW;YACX,KAAK;gBACD,UAAU;YACd;QACJ,GACA;YACI,IAAI,CAAC,SAAS;eACV,IAAI,CAAC,aAAa;gBAClB,CAAA,GAAA,IAAA,EAAE,+CAA+C;oBAC7C,IAAI,CAAC,WAAW;iBACnB;aACJ,GAAG,EAAE;YACN,CAAA,GAAA,IAAA,EAAE,sEAAsE;gBACpE,CAAA,GAAA,IAAA,EAAE;oBACE,SAAS;oBACT,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,SAAS;wBACL,IAAI,CAAC;oBACT;oBACA,SAAS,CAAC,kCAAkC,EAAE,CAAA,GAAA,gCAAe,EAAE,EAAE,CAAC;oBAClE,OAAO;gBACX;gBACA,CAAA,GAAA,IAAA,EAAE;oBACE,SAAS;oBACT,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,SAAS;wBACL,MAAM,WAAW,IAAI,CAAC,SAAS,eAAe;wBAC9C,MAAM,WAAW,CAAA,GAAA,sBAAS,EAAE,UAAU;wBACtC,IAAI,CAAC,gBAAgB;4BACjB,MAAM;4BACN,KAAK,WAAW;wBACpB;oBACJ;oBACA,SAAS,CAAC,oCAAoC,EAAE,CAAA,GAAA,6BAAY,EAAE,EAAE,CAAC;oBACjE,OAAO;gBACX;gBACA,CAAA,GAAA,IAAA,EAAE;oBACE,SAAS;oBACT,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,SAAS;wBACL,MAAM,WAAW,IAAI,CAAC,SAAS,eAAe;wBAC9C,MAAM,WAAW,CAAA,GAAA,sBAAS,EAAE,UAAU;wBACtC,IAAI,CAAC,gBAAgB;4BACjB,MAAM;4BACN,KAAK,WAAW;wBACpB;oBACJ;oBACA,SAAS,CAAC,qCAAqC,EAAE,CAAA,GAAA,8BAAa,EAAE,EAAE,CAAC;oBACnE,OAAO;gBACX;aACH;SACJ;QAEL,IAAI,CAAC;IACT;IAEA,SAAgB;QACZ,IAAI,CAAC;IACT;IAEA,aAAc,SAA6B,EAAQ;QAC/C,IAAI,CAAC,SAAS,aAAa;QAC3B,IAAI,CAAC;QACL,IAAI,CAAC,UAAU;IACnB;IAEA,eAAoC;QAChC,OAAO,IAAI,CAAC,SAAS;IACzB;IAEA,UAAW,KAAoB,EAAQ;QACnC,IAAI,CAAC,aAAa,QAAQ;IAC9B;IAkBA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,qBAAqB,aAAa,qBAAqB,IAAI,CAAC;QACjE,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,wBAAwB;QAC7B,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,cAAc,IAAI,CAAC,WAAW;IACvC;AACJ;;;;;ACxXA;;;;;;;;;;CAUC,GACD,qDAAa;AArEb;AACA;AACA;AACA;AACA;AAEA,SAAS,SAAU,KAAa,EAAE,MAAc;IAC5C,OAAO,KAAK,MAAM,SAAS,SAAS;AACxC;AA6DO,MAAM;IA6BT,mBAAmB;IACnB,YAAa,CAAyB,CAAE;aAjBhC,WAAoB;aAGpB,WAAW;YACf,IAAI,CAAC,UAAU,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,IAAI,cAAc,CAAA,GAAA,MAAC,EAAE,oBAAoB,IAAI,CAAA,GAAA,YAAI,EAAE,WAAW;YAC9F,IAAI,CAAC;QACT;aAEQ,SAAS;aACT,iBAAiB;YACrB,IAAI,qBAAqB,IAAI,CAAC,QAAQ;gBAClC,IAAI,CAAC,OAAO,MAAM,iBAAiB,KAAK,MAAM,sBAAsB,mBAAmB,KAAK;gBAC5F,IAAI,CAAC,SAAS;YAClB;QACJ;QAII,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,CAAC,UAAU,EAAE;QACjB,IAAI,CAAC,sBAAsB,CAAC,CAAC,EAAE;QAC/B,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAE;QAC1B,IAAI,CAAC,eAAe,CAAC,CAAC,EAAE;QAExB,IAAI,CAAC,YAAY;YACb,GAAG,EAAE,SAAS;QAClB;QAGA,IAAI,CAAC,YAAY,IAAI,CAAC,sBAAsB,mBAAmB;QAC/D,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,OACb,IAAI,CAAC,QAAQ,IAAI,CAAC,WAClB,IAAI,CAAC,SAAS,IAAI,CAAC;QAEvB,IAAI,CAAC,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACvB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,OAAO,IAAI,CAAC,eAAe,SAAU,IAAI,CAAC,QAAQ;YAClD,QAAQ,IAAI,CAAC,eAAe,SAAU,IAAI,CAAC,SAAS;YACpD,gBAAgB,KAAK,MAAM,sBAAsB,mBAAmB,YAAY;YAChF,SAAS;QACb;QACA,OAAO,iBAAiB,UAAU,IAAI,CAAC;QAEvC,IAAI,CAAC,UAAU,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,IAAI,cAAc,CAAA,GAAA,MAAC,EAAE,oBAAoB,IAAI,CAAA,GAAA,YAAI,EAAE,WAAW;QAC9F,CAAA,GAAA,YAAI,EAAE,kBAAkB,IAAI,CAAC;IAE7B,iBAAiB;IACrB;IAEA,SAAgB;QACZ,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;QACrB,MAAM,YAAY;YACd,GAAG,IAAI,CAAC,SAAS;YACjB,GAAG,IAAI,CAAC,UAAU;YAClB,GAAG,IAAI,CAAC,UAAU;YAClB,OAAO,IAAI,CAAC,UAAU;QAC1B;QAEA,IAAI,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,YAAY,IAAI,CAAC,sBAAsB,mBAAmB;YAC/D,IAAI,CAAC,OAAO,QAAQ,KAAK,MAAM,IAAI,CAAC,QAAQ,IAAI,CAAC;YACjD,IAAI,CAAC,OAAO,SAAS,KAAK,MAAM,IAAI,CAAC,SAAS,IAAI,CAAC;QACvD;QAEA,MAAM,oBAA0C;YAC5C,GAAG,KAAK,MAAM,UAAU;YACxB,GAAG,KAAK,MAAM,UAAU;YACxB,QAAQ,SAAS,UAAU,OAAO,IAAI,CAAC,QAAQ;YAC/C,QAAQ,SAAS,UAAU,OAAO,IAAI,CAAC,QAAQ;YAC/C,UAAU,UAAU;QACxB;QACA,MAAM,cAAc,CAAA,GAAA,4CAAoB,EAAE;QAI1C,IAAI,CAAC,IAAI;QACT,IAAI,CAAC,IAAI,wBAAwB;QAEjC,IAAI,IAAI,CAAC,gBAAgB;YACrB,IAAI,CAAC,IAAI,YAAY,SAAS,oBAAoB;YAClD,IAAI,CAAC,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO;QAC3D,OAAO;YACH,IAAI,CAAC,IAAI,YAAY,IAAI,CAAC;YAC1B,IAAI,CAAC,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;QAC7C;QAEA,kDAAkD;QAClD,IAAI,CAAC,IAAI,UAAU,kBAAkB,GAAG,kBAAkB;QAC1D,IAAI,CAAC,IAAI,MAAM,kBAAkB,QAAQ,kBAAkB;QAC3D,IAAI,CAAC,IAAI,OAAO,kBAAkB,WAAW,MAAM,KAAK;QAGxD,IAAI,IAAI,CAAC,gBAAgB;YACrB,IAAI,CAAC,IAAI;YAET,IAAI,CAAC,IAAI,YAAY,CAAA,GAAA,YAAI,EAAE,WAAW,2BAA2B;YACjE,MAAM,eAAe,IAAI,kBAAkB;YAC3C,MAAM,eAAe,IAAI,kBAAkB;YAC3C,IAAI,CAAC,IAAI,SAAS,CAAC,cAAc,CAAC,cAAc,IAAI,CAAC,QAAQ,QAAQ,eAAe,GAAG,IAAI,CAAC,QAAQ,SAAS,eAAe;YAE5H,IAAI,CAAC,IAAI,YAAY,IAAI,CAAC;YAC1B,IAAI,CAAC,QAAQ,aAAa,CAAA,GAAA,6BAAM,EAAE;YAClC,IAAI,CAAC,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ;YAEzD,IAAI,CAAC,IAAI;QACb;QAEA,IAAI,CAAC,QAAQ,OAAO,QAAQ,CAAA;YACxB,IAAI,CAAC,MAAM,aAAa,CAAC,MAAM,SAC3B;YAEJ,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,IAAI,2BAA2B,MAAM;YAC1C,IAAI,CAAC,IAAI,cAAc,MAAM;YAE7B,IAAI,QAA2B,CAAC;YAChC,IAAI,OAAO,MAAM,UAAU,YAAY;gBACnC,MAAM,MAAM,MAAM,MAAM,mBAAmB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO;gBAC1E,IAAI,WAAW,OAAO,eAAe,KAAK;oBACtC,QAAQ,IAAI;oBACZ,IAAI,CAAC,IAAI,aAAa,CAAA,GAAA,6BAAM,EAAE,aAAa,IAAI;gBACnD,OACI,QAAQ;YAEhB,OACI,QAAQ,MAAM;YAElB,IAAI,CAAC,IAAI,UAAU,OAAO,GAAG,IAAI,8CAA8C;YAC/E,IAAI,CAAC,IAAI;QACb;QAEA,IAAI,CAAC,IAAI;IACb;IAEA,QAAS,KAAa,EAAE,MAAc,EAAQ;QAC1C,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QAEd,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,OAAO,IAAI,CAAC,eAAe,SAAU,IAAI,CAAC,QAAQ;YAClD,QAAQ,IAAI,CAAC,eAAe,SAAU,IAAI,CAAC,SAAS;QACxD;IACJ;IAEA,aAAc,SAA6B,EAAQ;QAC/C,IAAI,CAAC,YAAY;YAAE,GAAG,SAAS;QAAC;IACpC;IAEA,eAAoC;QAChC,OAAO;YAAE,GAAG,IAAI,CAAC,SAAS;QAAC;IAC/B;IAEA,uBAAwB,CAAU,EAAQ;QACtC,IAAI,CAAC,sBAAsB;QAC3B,IAAI,CAAC,WAAW;IACpB;IAEA,yBAAmC;QAC/B,OAAO,IAAI,CAAC;IAChB;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC;QACnB,CAAA,GAAA,YAAI,EAAE,qBAAqB,IAAI,CAAC;QAChC,OAAO,oBAAoB,UAAU,IAAI,CAAC;IAC9C;AACJ;;;;;AChQA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;AACA;AAAA,wBAAA;;;ACnBA;;;;;CAKC;;AACD,kDAAgB;AAYhB;;;;;CAKC,GACD,mDAAgB;AAlBT,SAAS,aAAc,MAAM,EAAE,KAAK;IACzC,OAAO,MAAM,QAAQ,SACjB;QACE,OAAO,IAAI,KAAK,CAAC,EAAE,GAAG,OAAO,IAAI,KAAK,CAAC,EAAE,GAAG,OAAO;QACnD,OAAO,IAAI,KAAK,CAAC,EAAE,GAAG,OAAO,IAAI,KAAK,CAAC,EAAE,GAAG,OAAO;KACpD,GACD;QACE,GAAG,OAAO,IAAI,MAAM,IAAI,OAAO,IAAI,MAAM,IAAI,OAAO;QACpD,GAAG,OAAO,IAAI,MAAM,IAAI,OAAO,IAAI,MAAM,IAAI,OAAO;IACtD;AACN;AAQO,SAAS,cAAe,MAAM,EAAE,MAAM;IAC3C,OAAO,OAAO,IAAI,CAAA,QAAS,aAAa,QAAQ;AAClD;;;AC1BA;;;;;CAKC;;AACD,gDAAgB;AAAT,SAAS,WAAY,MAAM;IAChC,OAAO;QACL,GAAG,WAAW,OAAO;QACrB,GAAG,WAAW,OAAO;QACrB,GAAG,WAAW,OAAO;QACrB,GAAG,WAAW,OAAO;QACrB,GAAG,WAAW,OAAO;QACrB,GAAG,WAAW,OAAO;IACvB;AACF;;;ACfA;;;CAGC;;AAGD;;;;;;;;CAQC,GACD,gDAAgB;AAXhB,MAAM,cAAc;AAWb,SAAS,WAAY,MAAM;IAChC,MAAM,SAAS,OAAO,MAAM;IAC5B,IAAI,WAAW,QAAQ,OAAO,SAAS,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,EAAE,OAAO,iBAAiB,CAAC;IACvF,OAAO;QACL,GAAG,WAAW,MAAM,CAAC,EAAE;QACvB,GAAG,WAAW,MAAM,CAAC,EAAE;QACvB,GAAG,WAAW,MAAM,CAAC,EAAE;QACvB,GAAG,WAAW,MAAM,CAAC,EAAE;QACvB,GAAG,WAAW,MAAM,CAAC,EAAE;QACvB,GAAG,WAAW,MAAM,CAAC,EAAE;IACzB;AACF;;;AC1BA;;;CAGC;;AACD,8CAAgB;AAAT,SAAS;IACd,OAAO;QACL,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;AACF;;;ACbA;;;;CAIC;;AACD,6CAAgB;AAAT,SAAS,QAAS,MAAM;IAC7B,+FAA+F;IAE/F,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG;IAE7B,MAAM,QAAQ,IAAI,IAAI,IAAI;IAE1B,OAAO;QACL,GAAG,IAAI;QACP,GAAG,IAAI,CAAC;QACR,GAAG,IAAI,CAAC;QACR,GAAG,IAAI;QACP,GAAG,AAAC,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK,CAAC;QACtB,GAAG,AAAC,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;IACvB;AACF;;;;;AClBA;;;;CAIC,GAED,oDAAgB;AARhB;AAQO,SAAS,eAAgB,MAAM;IACpC,OAAO,CAAA,GAAA,eAAO,EAAE,WACd,OAAO,UACP,CAAA,GAAA,gBAAQ,EAAE,OAAO,MACjB,OAAO,UACP,CAAA,GAAA,gBAAQ,EAAE,OAAO,MACjB,OAAO,UACP,CAAA,GAAA,gBAAQ,EAAE,OAAO,MACjB,OAAO,UACP,CAAA,GAAA,gBAAQ,EAAE,OAAO,MACjB,OAAO,UACP,CAAA,GAAA,gBAAQ,EAAE,OAAO,MACjB,OAAO,UACP,CAAA,GAAA,gBAAQ,EAAE,OAAO;AACrB;;;;;ACtBA,iDAAgB;AAIhB,+CAAgB;AAMhB,8CAAgB;AAMhB,kDAAgB;AAhBT,SAAS,YAAa,GAAG;IAC9B,OAAO,OAAO,QAAQ;AACxB;AAEO,SAAS,UAAW,CAAC;IAC1B,OAAO,OAAO,MAAM,YAClB,CAAC,OAAO,MAAM,MACd,OAAO,SAAS;AACpB;AAEO,SAAS,SAAU,GAAG;IAC3B,OAAO,OAAO,QAAQ,YACpB,QAAQ,QACR,CAAC,MAAM,QAAQ;AACnB;AAEO,SAAS,aAAc,GAAG,EAAE,IAAI;IACrC,OAAO,KAAK,MAAM,CAAA,MAAO,OAAO;AAClC;;;;;ACbA;;;;;;CAMC,GACD,4CAAgB;AAsBhB;;;;;;CAMC,GACD,+CAAgB;AAzChB;AACA;AACA;AAEA,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG;AAQlB,SAAS,OAAQ,KAAK,EAAE,EAAE,EAAE,EAAE;IACnC,MAAM,WAAW,IAAI;IACrB,MAAM,WAAW,IAAI;IACrB,MAAM,iBAAiB;QACrB,GAAG;QACH,GAAG,CAAC;QACJ,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;IACA,IAAI,CAAA,GAAA,kBAAU,EAAE,OAAO,CAAA,GAAA,kBAAU,EAAE,KACjC,OAAO;IAGT,OAAO,CAAA,GAAA,oBAAQ,EAAE;QACf,CAAA,GAAA,oBAAQ,EAAE,IAAI;QACd;QACA,CAAA,GAAA,oBAAQ,EAAE,CAAC,IAAI,CAAC;KACjB;AACH;AASO,SAAS,UAAW,KAAK,EAAE,EAAc,EAAE,EAAc;IAC9D,OAAO,OAAO,QAAQ,KAAK,KAAK,IAAI;AACtC;;;AC3CA;;;;;CAKC;;AACD,+CAAgB;AAAT,SAAS,UAAW,EAAE,EAAE,KAAK,CAAC;IACnC,OAAO;QACL,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;AACF;;;ACfA;;;;CAIC;;AACD,+CAAgB;AAgChB;;;;CAIC,GACD,6CAAgB;AArCT,SAAS,UAAW,GAAG,QAAQ;IACpC,WAAW,MAAM,QAAQ,QAAQ,CAAC,EAAE,IAAI,QAAQ,CAAC,EAAE,GAAG;IAEtD,MAAM,WAAW,CAAC,IAAI;QACpB,OAAO;YACL,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;YAC3B,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;YAC3B,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;YAClC,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;YAC3B,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;YAC3B,GAAG,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;QACpC;IACF;IAEA,OAAQ,SAAS;QACf,KAAK;YACH,MAAM,IAAI,MAAM;QAElB,KAAK;YACH,OAAO,QAAQ,CAAC,EAAE;QAEpB,KAAK;YACH,OAAO,SAAS,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE;QAE1C;YAAS;gBACP,MAAM,CAAC,IAAI,IAAI,GAAG,KAAK,GAAG;gBAC1B,MAAM,IAAI,SAAS,IAAI;gBACvB,OAAO,UAAU,MAAM;YACzB;IACF;AACF;AAOO,SAAS,QAAS,GAAG,QAAQ;IAClC,OAAO,aAAa;AACtB;;;;;ACxCA;;;;;;;CAOC,GACD,2CAAgB;AAZhB;AACA;AACA;AAUO,SAAS,MAAO,EAAE,EAAE,EAAc,EAAE,EAAc,EAAE,EAAc;IACvE,IAAI,CAAA,GAAA,kBAAU,EAAE,KAAK,KAAK;IAE1B,MAAM,cAAc;QAClB,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;IAEA,IAAI,CAAA,GAAA,kBAAU,EAAE,OAAO,CAAA,GAAA,kBAAU,EAAE,KACjC,OAAO;IAGT,OAAO,CAAA,GAAA,oBAAQ,EAAE;QACf,CAAA,GAAA,oBAAQ,EAAE,IAAI;QACd;QACA,CAAA,GAAA,oBAAQ,EAAE,CAAC,IAAI,CAAC;KACjB;AACH;;;ACjCA;;;;;CAKC;;AACD,2CAAgB;AAAT,SAAS,MAAO,GAAG,EAAE,GAAG;IAC7B,OAAO;QACL,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;AACF;;;ACfA,2EAA2E;;;AAG3E;;;;;CAKC,GACD,0CAAgB;AAWhB;;;;;CAKC,GACD,6CAAgB;AAzBhB,MAAM,EAAE,GAAG,EAAE,GAAG;AAQT,SAAS,KAAM,EAAE,EAAE,EAAE;IAC1B,OAAO;QACL,GAAG;QACH,GAAG,IAAI;QACP,GAAG;QACH,GAAG,IAAI;QACP,GAAG;QACH,GAAG;IACL;AACF;AAQO,SAAS,QAAS,EAAE,EAAE,EAAE;IAC7B,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AACjD;;;AC5BA;;;;CAIC;;AACD,2CAAgB;AAIhB;;;;CAIC,GACD,2CAAgB;AAIhB;;;;CAIC,GACD,8CAAgB;AAlBT,SAAS,MAAO,MAAM;IAC3B,OAAO,SAAS;AAClB;AAOO,SAAS,MAAO,MAAM;IAC3B,OAAO,SAAS;AAClB;AAOO,SAAS,SAAU,MAAM;IAC9B,OAAO,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;AAC1F;;;;;ACrBA;;;;;;CAMC,GACD,mDAAgB;AAXhB;AACA;AACA;AASO,SAAS,cAAe,EAAE,EAAE,EAAE;IACnC,wCAAwC;IACxC,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAEhD,yCAAyC;IACzC,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAEhD,wCAAwC;IACxC,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAChD,MAAM,MAAM,EAAE,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE;IAEhD,MAAM,KAAK;QACT,GAAG,MAAM;QACT,GAAG,MAAM;QACT,GAAG,MAAM;QACT,GAAG,MAAM;QACT,GAAG;QACH,GAAG;IACL;IACA,MAAM,KAAK;QACT,GAAG,MAAM;QACT,GAAG,MAAM;QACT,GAAG,MAAM;QACT,GAAG,MAAM;QACT,GAAG;QACH,GAAG;IACL;IAEA,MAAM,YAAY,CAAA,GAAA,gBAAM,EAAE;IAC1B,MAAM,eAAe,CAAA,GAAA,oBAAQ,EAAE;QAAC;QAAI;KAAU;IAE9C,2DAA2D;IAC3D,OAAO,CAAA,GAAA,0BAAW,EAAE;AACtB;;;ACpDA;;;;;CAKC;;AACD,kDAAgB;AAAT,SAAS,aAAc,MAAM,EAAE,YAAY,WAAW;IAC3D,OAAO;QACL,GAAG,KAAK,MAAM,OAAO,IAAI,aAAa;QACtC,GAAG,KAAK,MAAM,OAAO,IAAI,aAAa;QACtC,GAAG,KAAK,MAAM,OAAO,IAAI,aAAa;QACtC,GAAG,KAAK,MAAM,OAAO,IAAI,aAAa;QACtC,GAAG,KAAK,MAAM,OAAO,IAAI,aAAa;QACtC,GAAG,KAAK,MAAM,OAAO,IAAI,aAAa;IACxC;AACF;;;;;ACRA;;;;;;;;;;;;;;;;;;;;;;;;;EAyBE,GACF,oDAAgB;AAjChB;AACA;AACA;AACA;AACA;AACA;AA4BO,SAAS,eAAgB,6BAA6B;IAC3D,OAAO,MAAM,QAAQ,iCACjB,8BAA8B,IAAI,UAClC,OAAO;IAEX,SAAS,OAAQ,UAAU;QACzB,OAAQ,WAAW;YACjB,KAAK;gBACH,IAAI,OAAO,cACT,OAAO,cACP,OAAO,cACP,OAAO,cACP,OAAO,cACP,OAAO,YAEP,OAAO,CAAA,GAAA,sBAAS,EAAE;qBAElB,MAAM,IAAI,MAAM;YAGpB,KAAK;gBACH,IAAI,CAAE,CAAA,QAAQ,UAAS,GAAI,MAAM,IAAI,MAAM;gBAE3C,IAAI,QAAQ,YAAY,OAAO,CAAA,GAAA,oBAAQ,EAAE,WAAW,IAAI,WAAW;gBAEnE,OAAO,CAAA,GAAA,oBAAQ,EAAE,WAAW;YAE9B,KAAK;gBACH,IAAI,CAAE,CAAA,QAAQ,UAAS,GAAI,MAAM,IAAI,MAAM;gBAE3C,IAAI,QAAQ,YAAY,OAAO,CAAA,GAAA,YAAI,EAAE,WAAW,IAAI,WAAW;gBAE/D,OAAO,CAAA,GAAA,YAAI,EAAE,WAAW;YAE1B,KAAK;gBACH,IAAI,CAAE,CAAA,WAAW,UAAS,GAAI,MAAM,IAAI,MAAM;gBAE9C,IAAI,QAAQ,cAAc,QAAQ,YAChC,OAAO,CAAA,GAAA,iBAAQ,EAAE,WAAW,OAAO,WAAW,IAAI,WAAW;gBAE/D,OAAO,CAAA,GAAA,iBAAQ,EAAE,WAAW;YAE9B,KAAK;gBACH,IAAI,CAAE,CAAA,WAAW,UAAS,GAAI,MAAM,IAAI,MAAM;gBAC9C,OAAO,CAAA,GAAA,aAAM,EAAE,WAAW,OAAO;YAEnC,KAAK;gBACH,IAAI,CAAE,CAAA,WAAW,UAAS,GAAI,MAAM,IAAI,MAAM;gBAC9C,OAAO,CAAA,GAAA,aAAM,EAAE,GAAG,WAAW;YAE/B,KAAK;gBACH,IAAI,CAAE,CAAA,SAAS,cAAc,SAAS,UAAS,GAAI,MAAM,IAAI,MAAM;gBACnE,OAAO,CAAA,GAAA,YAAI,EAAE,WAAW,KAAK,WAAW;YAE1C;gBACE,MAAM,IAAI,MAAM;QACpB;IACF;AACF;;;;;ACzFA;;;;;;;;;;;;;;;;CAgBC,GACD,4DAAgB;AAnBhB;AAmBO,SAAS,uBAAwB,eAAe;IACrD,OAAO,CAAA,GAAA,0CAAI,EAAE;AACf;;;ACrBA,4BAA4B;AAC5B,EAAE;AACF,uBAAuB;;;AAi2CvB,iDACE;AADF,2CAGE;AAl2CF,SAAS,aAAa,KAAK,EAAE,MAAM;IACjC,SAAS;QAAM,IAAI,CAAC,cAAc;IAAO;IACzC,EAAE,YAAY,OAAO;IACrB,MAAM,YAAY,IAAI;AACxB;AAEA,SAAS,gBAAgB,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ;IACzD,IAAI,OAAO,MAAM,KAAK,IAAI,EAAE;IAC5B,+EAA+E;IAC/E,IAAI,OAAO,gBACT,OAAO,eAAe,MAAM,gBAAgB;IAE9C,KAAK,WAAW;IAChB,KAAK,QAAQ;IACb,KAAK,WAAW;IAChB,KAAK,OAAO;IACZ,OAAO;AACT;AAEA,aAAa,iBAAiB;AAE9B,SAAS,WAAW,GAAG,EAAE,YAAY,EAAE,SAAS;IAC9C,YAAY,aAAa;IACzB,IAAI,IAAI,SAAS,cAAgB,OAAO;IACxC,gBAAgB,IAAI;IACpB,aAAa,UAAU,OAAO;IAC9B,OAAO,MAAM,UAAU,MAAM,GAAG;AAClC;AAEA,gBAAgB,UAAU,SAAS,SAAS,OAAO;IACjD,IAAI,MAAM,YAAY,IAAI,CAAC;IAC3B,IAAI,IAAI,CAAC,UAAU;QACjB,IAAI,MAAM;QACV,IAAI;QACJ,IAAK,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAC9B,IAAI,OAAO,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC,SAAS,QAAQ;YAC9C,MAAM,OAAO,CAAC,EAAE,CAAC,KAAK,MAAM;YAC5B;QACF;QAEF,IAAI,IAAI,IAAI,CAAC,SAAS;QACtB,IAAI,WAAW,AAAC,IAAI,CAAC,SAAS,UAAW,OAAO,IAAI,CAAC,SAAS,OAAO,WAAW,aAC5E,IAAI,CAAC,SAAS,OAAO,OAAO,KAC5B;QACJ,IAAI,MAAM,IAAI,CAAC,SAAS,SAAS,MAAM,SAAS,OAAO,MAAM,SAAS;QACtE,IAAI,KAAK;YACP,IAAI,IAAI,IAAI,CAAC,SAAS;YACtB,IAAI,SAAS,WAAW,IAAI,SAAS,KAAK,WAAW,QAAQ;YAC7D,IAAI,OAAO,GAAG,CAAC,EAAE,OAAO,EAAE;YAC1B,IAAI,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,SAAS,KAAK,SAAS;YACxD,IAAI,SAAS,AAAC,OAAO,EAAE,UAAW;YAClC,OAAO,YAAY,MAAM,OACnB,SAAS,SACT,SAAS,OAAO,QAAQ,OAAO,OAC/B,SAAS,QAAQ,WAAW,IAAI,EAAE,SAAS,GAAG,OAC9C,WAAW,IAAI,QAAQ;QAC/B,OACE,OAAO,WAAW;IAEtB;IACA,OAAO;AACT;AAEA,gBAAgB,eAAe,SAAS,QAAQ,EAAE,KAAK;IACrD,IAAI,2BAA2B;QAC7B,SAAS,SAAS,WAAW;YAC3B,OAAO,MAAO,cAAc,YAAY,QAAQ;QAClD;QAEA,OAAO,SAAS,WAAW;YACzB,IAAI,eAAe,YAAY,MAAM,IAAI,SAAS,IAAI;gBACpD,OAAO,MAAM,QAAQ,QACjB,YAAY,IAAI,CAAC,EAAE,IAAI,MAAM,YAAY,IAAI,CAAC,EAAE,IAChD,YAAY;YAClB;YAEA,OAAO,MAAO,CAAA,YAAY,WAAW,MAAM,EAAC,IAAK,aAAa,KAAK,MAAM;QAC3E;QAEA,KAAK;YACH,OAAO;QACT;QAEA,KAAK;YACH,OAAO;QACT;QAEA,OAAO,SAAS,WAAW;YACzB,OAAO,YAAY;QACrB;IACF;IAEA,SAAS,IAAI,EAAE;QACb,OAAO,GAAG,WAAW,GAAG,SAAS,IAAI;IACvC;IAEA,SAAS,cAAc,CAAC;QACtB,OAAO,EACJ,QAAQ,OAAO,QACf,QAAQ,MAAO,OACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,gBAAyB,SAAS,EAAE;YAAI,OAAO,SAAS,IAAI;QAAK,GACzE,QAAQ,yBAAyB,SAAS,EAAE;YAAI,OAAO,QAAS,IAAI;QAAK;IAC9E;IAEA,SAAS,YAAY,CAAC;QACpB,OAAO,EACJ,QAAQ,OAAO,QACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,MAAO,OACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,OAAO,OACf,QAAQ,gBAAyB,SAAS,EAAE;YAAI,OAAO,SAAS,IAAI;QAAK,GACzE,QAAQ,yBAAyB,SAAS,EAAE;YAAI,OAAO,QAAS,IAAI;QAAK;IAC9E;IAEA,SAAS,oBAAoB,WAAW;QACtC,OAAO,wBAAwB,CAAC,YAAY,KAAK,CAAC;IACpD;IAEA,SAAS,iBAAiB,QAAQ;QAChC,IAAI,eAAe,SAAS,IAAI;QAChC,IAAI,GAAG;QAEP,aAAa;QAEb,IAAI,aAAa,SAAS,GAAG;YAC3B,IAAK,IAAI,GAAG,IAAI,GAAG,IAAI,aAAa,QAAQ,IAC1C,IAAI,YAAY,CAAC,IAAI,EAAE,KAAK,YAAY,CAAC,EAAE,EAAE;gBAC3C,YAAY,CAAC,EAAE,GAAG,YAAY,CAAC,EAAE;gBACjC;YACF;YAEF,aAAa,SAAS;QACxB;QAEA,OAAQ,aAAa;YACnB,KAAK;gBACH,OAAO,YAAY,CAAC,EAAE;YAExB,KAAK;gBACH,OAAO,YAAY,CAAC,EAAE,GAAG,SAAS,YAAY,CAAC,EAAE;YAEnD;gBACE,OAAO,aAAa,MAAM,GAAG,IAAI,KAAK,QAClC,UACA,YAAY,CAAC,aAAa,SAAS,EAAE;QAC7C;IACF;IAEA,SAAS,cAAc,KAAK;QAC1B,OAAO,QAAQ,MAAO,cAAc,SAAS,MAAO;IACtD;IAEA,OAAO,cAAc,iBAAiB,YAAY,UAAU,cAAc,SAAS;AACrF;AAEA,SAAS,UAAU,KAAK,EAAE,OAAO;IAC/B,UAAU,YAAY,YAAY,UAAU,CAAC;IAE7C,IAAI,aAAa,CAAC;IAClB,IAAI,aAAa,QAAQ;IAEzB,IAAI,yBAAyB;QAAE,eAAe;IAAuB;IACrE,IAAI,wBAAwB;IAE5B,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IAEb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IACb,IAAI,SAAS;IAEb,IAAI,SAAS,uBAAuB,UAAU;IAC9C,IAAI,SAAS,uBAAuB,KAAK;IACzC,IAAI,SAAS,uBAAuB,KAAK;IACzC,IAAI,SAAS,uBAAuB,aAAa;IACjD,IAAI,SAAS,uBAAuB,SAAS;IAC7C,IAAI,SAAS,uBAAuB,UAAU;IAC9C,IAAI,SAAS,uBAAuB,SAAS;IAC7C,IAAI,SAAS,uBAAuB,SAAS;IAC7C,IAAI,SAAS,uBAAuB,KAAK;IACzC,IAAI,SAAS,qBAAqB;IAClC,IAAI,UAAU,uBAAuB,KAAK;IAC1C,IAAI,UAAU,qBAAqB;QAAC;QAAK;KAAI,EAAE,OAAO;IACtD,IAAI,UAAU,qBAAqB;QAAC;QAAK;KAAI,EAAE,OAAO;IACtD,IAAI,UAAU,qBAAqB;QAAC;YAAC;YAAK;SAAI;KAAC,EAAE,OAAO;IACxD,IAAI,UAAU,qBAAqB;QAAC;QAAK;QAAM;QAAM;KAAK,EAAE,OAAO;IAEnE,IAAI,SAAS,SAAS,EAAE;QAAI,OAAO;IAAI;IACvC,IAAI,SAAS,SAAS,CAAC,EAAE,EAAE;QAAI,OAAO,EAAE,OAAO;IAAI;IACnD,IAAI,SAAS,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAClC,OAAO;YAAC;gBAAC,MAAM;gBAAU,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;SAAE;IAC/D;IACF,IAAI,SAAS,SAAS,EAAE,EAAE,EAAE;QACxB,IAAI,IAAI;YAAC,MAAM;YAAa,IAAI;QAAE;QAClC,IAAI,IAAI,EAAE,KAAK;QACf,OAAO;YAAC;SAAE;IACZ;IACF,IAAI,SAAS,SAAS,EAAE,EAAE,EAAE;QACxB,IAAI,IAAI;YAAC,MAAK;YAAS,IAAI;QAAE;QAC7B,IAAI,IAAI,EAAE,KAAK;QACf,OAAO;YAAC;SAAE;IACZ;IACF,IAAI,SAAS,SAAS,KAAK,EAAE,CAAC;QAC1B,IAAI,IAAI;YAAC,MAAK;YAAU,OAAO;QAAK;QACpC,IAAI,GAAG;YACL,EAAE,KAAK,CAAC,CAAC,EAAE;YACX,EAAE,KAAK,CAAC,CAAC,EAAE;QACb;QACA,OAAO;YAAC;SAAE;IACZ;IACF,IAAI,SAAS,SAAS,KAAK;QACvB,OAAO;YAAC;gBAAC,MAAM;gBAAS,OAAO;YAAK;SAAE;IACxC;IACF,IAAI,SAAS,SAAS,KAAK;QACvB,OAAO;YAAC;gBAAC,MAAM;gBAAS,OAAO;YAAK;SAAE;IACxC;IACF,IAAI,SAAS,SAAS,CAAC;QAAI,OAAO,WAAW,EAAE,KAAK;IAAM;IAC1D,IAAI,SAAS,SAAS,CAAC;QAAI,OAAO,SAAS,EAAE,KAAK;IAAM;IACxD,IAAI,UAAU,SAAS,CAAC;QAAI,OAAO;IAAG;IACtC,IAAI,UAAU,SAAS,EAAE,EAAE,EAAE;QAAI,OAAO;YAAC;YAAI;SAAG;IAAE;IAClD,IAAI,UAAU,SAAS,EAAE;QAAI,OAAO,GAAG,KAAK;IAAK;IACjD,IAAI,UAAU,SAAS,CAAC,EAAE,CAAC;QAAI,OAAO;YAAC;YAAG,KAAK;SAAK,CAAC,KAAK;IAAG;IAC7D,IAAI,UAAU,SAAS,CAAC,EAAE,CAAC;QAAI,OAAO;YAAC;YAAG;SAAE,CAAC,KAAK;IAAG;IACrD,IAAI,UAAU,SAAS,EAAE,EAAE,EAAE;QAAI,OAAO;YAAC,KAAK,GAAG,KAAK,MAAM;YAAM;YAAK,GAAG,KAAK;SAAI,CAAC,KAAK;IAAK;IAC9F,IAAI,UAAU,SAAS,CAAC;QAAI,OAAO,EAAE,KAAK;IAAK;IAC/C,IAAI,UAAU,SAAS,CAAC,EAAE,CAAC;QAAI,OAAO;YAAC;YAAK;YAAG,EAAE,KAAK;SAAI,CAAC,KAAK;IAAI;IACpE,IAAI,cAAc;IAClB,IAAI,eAAe;IACnB,IAAI,sBAAsB;QAAC;YAAE,MAAM;YAAG,QAAQ;QAAE;KAAE;IAClD,IAAI,iBAAiB;IACrB,IAAI,sBAAsB,EAAE;IAC5B,IAAI,kBAAkB;IAEtB,IAAI;IAEJ,IAAI,eAAe,SAAS;QAC1B,IAAI,CAAE,CAAA,QAAQ,aAAa,sBAAqB,GAC9C,MAAM,IAAI,MAAM,qCAAqC,QAAQ,YAAY;QAG3E,wBAAwB,sBAAsB,CAAC,QAAQ,UAAU;IACnE;IAEA,SAAS;QACP,OAAO,MAAM,UAAU,cAAc;IACvC;IAEA,SAAS;QACP,OAAO;IACT;IAEA,SAAS;QACP,OAAO;YACL,QAAQ;YACR,OAAO;YACP,KAAK;QACP;IACF;IAEA,SAAS;QACP,OAAO,oBAAoB,cAAc;IAC3C;IAEA,SAAS,SAAS,WAAW,EAAE,QAAQ;QACrC,WAAW,aAAa,YACpB,WACA,oBAAoB,cAAc;QAEtC,MAAM,yBACJ;YAAC,qBAAqB;SAAa,EACnC,MAAM,UAAU,cAAc,cAC9B;IAEJ;IAEA,SAAS,MAAM,OAAO,EAAE,QAAQ;QAC9B,WAAW,aAAa,YACpB,WACA,oBAAoB,cAAc;QAEtC,MAAM,qBAAqB,SAAS;IACtC;IAEA,SAAS,uBAAuB,IAAI,EAAE,UAAU;QAC9C,OAAO;YAAE,MAAM;YAAW,MAAM;YAAM,YAAY;QAAW;IAC/D;IAEA,SAAS,qBAAqB,KAAK,EAAE,QAAQ,EAAE,UAAU;QACvD,OAAO;YAAE,MAAM;YAAS,OAAO;YAAO,UAAU;YAAU,YAAY;QAAW;IACnF;IAEA,SAAS;QACP,OAAO;YAAE,MAAM;QAAM;IACvB;IAEA,SAAS;QACP,OAAO;YAAE,MAAM;QAAM;IACvB;IAEA,SAAS,qBAAqB,WAAW;QACvC,OAAO;YAAE,MAAM;YAAS,aAAa;QAAY;IACnD;IAEA,SAAS,sBAAsB,GAAG;QAChC,IAAI,UAAU,mBAAmB,CAAC,IAAI;QACtC,IAAI;QAEJ,IAAI,SACF,OAAO;aACF;YACL,IAAI,MAAM;YACV,MAAO,CAAC,mBAAmB,CAAC,EAAE,CAC5B;YAGF,UAAU,mBAAmB,CAAC,EAAE;YAChC,UAAU;gBACR,MAAM,QAAQ;gBACd,QAAQ,QAAQ;YAClB;YAEA,MAAO,IAAI,IAAK;gBACd,IAAI,MAAM,WAAW,OAAO,IAAI;oBAC9B,QAAQ;oBACR,QAAQ,SAAS;gBACnB,OACE,QAAQ;gBAGV;YACF;YAEA,mBAAmB,CAAC,IAAI,GAAG;YAE3B,OAAO;QACT;IACF;IAEA,SAAS,oBAAoB,QAAQ,EAAE,MAAM,EAAE,MAAM;QACnD,IAAI,kBAAkB,sBAAsB;QAC5C,IAAI,gBAAgB,sBAAsB;QAE1C,IAAI,MAAM;YACR,QAAQ;YACR,OAAO;gBACL,QAAQ;gBACR,MAAM,gBAAgB;gBACtB,QAAQ,gBAAgB;YAC1B;YACA,KAAK;gBACH,QAAQ;gBACR,MAAM,cAAc;gBACpB,QAAQ,cAAc;YACxB;QACF;QACA,IAAI,UAAU,cAAe,OAAO,WAAW,WAAW,YAAa;YACrE,IAAI,QAAQ,WAAW,OAAO,IAAI;YAClC,IAAI,MAAM,WAAW,OAAO,IAAI;QAClC;QACA,OAAO;IACT;IAEA,SAAS,SAAS,QAAQ;QACxB,IAAI,cAAc,gBAAkB;QAEpC,IAAI,cAAc,gBAAgB;YAChC,iBAAiB;YACjB,sBAAsB,EAAE;QAC1B;QAEA,oBAAoB,KAAK;IAC3B;IAEA,SAAS,qBAAqB,OAAO,EAAE,QAAQ;QAC7C,OAAO,IAAI,gBAAgB,SAAS,MAAM,MAAM;IAClD;IAEA,SAAS,yBAAyB,QAAQ,EAAE,KAAK,EAAE,QAAQ;QACzD,OAAO,IAAI,gBACT,gBAAgB,aAAa,UAAU,QACvC,UACA,OACA;IAEJ;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI;QAEpB,KAAK;QACL,KAAK,EAAE;QACP,KAAK;QACL,MAAO,OAAO,WAAY;YACxB,GAAG,KAAK;YACR,KAAK;QACP;QACA,KAAK;QACL,IAAI,OAAO,YACT,KAAK;QAEP,KAAK,EAAE;QACP,KAAK;QACL,MAAO,OAAO,WAAY;YACxB,GAAG,KAAK;YACR,KAAK;QACP;QACA,eAAe;QACf,KAAK,OAAO;QAEZ,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI;QAEhB,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,IAAI,OAAO,YACT,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;iBAEA,KAAK;YAEP,IAAI,OAAO,YAAY;gBACrB,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,eAAe;oBACf,KAAK,OAAO,IAAI;gBAClB,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QACA,IAAI,OAAO,YACT,KAAK;QAGP,OAAO;IACT;IAEA,SAAS;QACP,IAAI;QAEJ,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK;oBACL,IAAI,OAAO,YAAY;wBACrB,KAAK;wBACL,IAAI,OAAO,YACT,KAAK;oBAET;gBACF;YACF;QACF;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;QAE/E,KAAK;QACL,IAAI,MAAM,OAAO,aAAa,OAAO,QAAQ;YAC3C,KAAK;YACL,eAAe;QACjB,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gBACxC,KAAK;gBACL;YACF,OAAO;gBACL,KAAK;gBACL,IAAI,oBAAoB,GAAK,SAAS;YACxC;YACA,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK;oBACL,IAAI,OAAO,YAAY;wBACrB,KAAK;wBACL,IAAI,OAAO,YAAY;4BACrB,KAAK;4BACL,IAAI,OAAO,YAAY;gCACrB,KAAK;gCACL,IAAI,OAAO,YAAY;oCACrB,MAAM;oCACN,IAAI,QAAQ,YAAY;wCACtB,MAAM;wCACN,IAAI,QAAQ,YAAY;4CACtB,MAAM;4CACN,IAAI,QAAQ,YAAY;gDACtB,MAAM;gDACN,IAAI,QAAQ,YAAY;oDACtB,MAAM;oDACN,IAAI,QAAQ,YAAY;wDACtB,MAAM;wDACN,IAAI,QAAQ,YAAY;4DACtB,MAAM,EAAE;4DACR,MAAM;4DACN,MAAO,QAAQ,WAAY;gEACzB,IAAI,KAAK;gEACT,MAAM;4DACR;4DACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gEACxC,MAAM;gEACN;4DACF,OAAO;gEACL,MAAM;gEACN,IAAI,oBAAoB,GAAK,SAAS;4DACxC;4DACA,IAAI,QAAQ,YAAY;gEACtB,eAAe;gEACf,KAAK,OAAO,IAAI,IAAI,IAAI,KAAK,KAAK;4DACpC,OAAO;gEACL,cAAc;gEACd,KAAK;4DACP;wDACF,OAAO;4DACL,cAAc;4DACd,KAAK;wDACP;oDACF,OAAO;wDACL,cAAc;wDACd,KAAK;oDACP;gDACF,OAAO;oDACL,cAAc;oDACd,KAAK;gDACP;4CACF,OAAO;gDACL,cAAc;gDACd,KAAK;4CACP;wCACF,OAAO;4CACL,cAAc;4CACd,KAAK;wCACP;oCACF,OAAO;wCACL,cAAc;wCACd,KAAK;oCACP;gCACF,OAAO;oCACL,cAAc;oCACd,KAAK;gCACP;4BACF,OAAO;gCACL,cAAc;gCACd,KAAK;4BACP;wBACF,OAAO;4BACL,cAAc;4BACd,KAAK;wBACP;oBACF,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;QAEpC,KAAK;QACL,IAAI,MAAM,OAAO,aAAa,OAAO,QAAQ;YAC3C,KAAK;YACL,eAAe;QACjB,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gBACxC,KAAK;gBACL;YACF,OAAO;gBACL,KAAK;gBACL,IAAI,oBAAoB,GAAK,SAAS;YACxC;YACA,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK;oBACL,IAAI,OAAO,YACT,KAAK;oBAEP,KAAK,EAAE;oBACP,KAAK;oBACL,MAAO,OAAO,WAAY;wBACxB,GAAG,KAAK;wBACR,KAAK;oBACP;oBACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;wBACxC,KAAK;wBACL;oBACF,OAAO;wBACL,KAAK;wBACL,IAAI,oBAAoB,GAAK,SAAS;oBACxC;oBACA,IAAI,OAAO,YAAY;wBACrB,eAAe;wBACf,KAAK,OAAO,IAAI;oBAClB,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;QAEpC,KAAK;QACL,IAAI,MAAM,OAAO,aAAa,OAAO,QAAQ;YAC3C,KAAK;YACL,eAAe;QACjB,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gBACxC,KAAK;gBACL;YACF,OAAO;gBACL,KAAK;gBACL,IAAI,oBAAoB,GAAK,SAAS;YACxC;YACA,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK;oBACL,IAAI,OAAO,YACT,KAAK;oBAEP,KAAK,EAAE;oBACP,KAAK;oBACL,MAAO,OAAO,WAAY;wBACxB,GAAG,KAAK;wBACR,KAAK;oBACP;oBACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;wBACxC,KAAK;wBACL;oBACF,OAAO;wBACL,KAAK;wBACL,IAAI,oBAAoB,GAAK,SAAS;oBACxC;oBACA,IAAI,OAAO,YAAY;wBACrB,eAAe;wBACf,KAAK,OAAO,IAAI;oBAClB,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;QAEpC,KAAK;QACL,IAAI,MAAM,OAAO,aAAa,OAAO,QAAQ;YAC3C,KAAK;YACL,eAAe;QACjB,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gBACxC,KAAK;gBACL;YACF,OAAO;gBACL,KAAK;gBACL,IAAI,oBAAoB,GAAK,SAAS;YACxC;YACA,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK;oBACL,IAAI,OAAO,YACT,KAAK;oBAEP,KAAK,EAAE;oBACP,KAAK;oBACL,MAAO,OAAO,WAAY;wBACxB,GAAG,KAAK;wBACR,KAAK;oBACP;oBACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;wBACxC,KAAK;wBACL;oBACF,OAAO;wBACL,KAAK;wBACL,IAAI,oBAAoB,GAAK,SAAS;oBACxC;oBACA,IAAI,OAAO,YAAY;wBACrB,eAAe;wBACf,KAAK,OAAO,IAAI;oBAClB,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;QAEhC,KAAK;QACL,IAAI,MAAM,OAAO,aAAa,OAAO,QAAQ;YAC3C,KAAK;YACL,eAAe;QACjB,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gBACxC,KAAK;gBACL;YACF,OAAO;gBACL,KAAK;gBACL,IAAI,oBAAoB,GAAK,SAAS;YACxC;YACA,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK,EAAE;oBACP,KAAK;oBACL,MAAO,OAAO,WAAY;wBACxB,GAAG,KAAK;wBACR,KAAK;oBACP;oBACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;wBACxC,KAAK;wBACL;oBACF,OAAO;wBACL,KAAK;wBACL,IAAI,oBAAoB,GAAK,SAAS;oBACxC;oBACA,IAAI,OAAO,YAAY;wBACrB,eAAe;wBACf,KAAK,OAAO;oBACd,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;QAEhC,KAAK;QACL,IAAI,MAAM,OAAO,aAAa,OAAO,QAAQ;YAC3C,KAAK;YACL,eAAe;QACjB,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;gBACxC,KAAK;gBACL;YACF,OAAO;gBACL,KAAK;gBACL,IAAI,oBAAoB,GAAK,SAAS;YACxC;YACA,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK,EAAE;oBACP,KAAK;oBACL,MAAO,OAAO,WAAY;wBACxB,GAAG,KAAK;wBACR,KAAK;oBACP;oBACA,IAAI,MAAM,WAAW,iBAAiB,IAAI;wBACxC,KAAK;wBACL;oBACF,OAAO;wBACL,KAAK;wBACL,IAAI,oBAAoB,GAAK,SAAS;oBACxC;oBACA,IAAI,OAAO,YAAY;wBACrB,eAAe;wBACf,KAAK,OAAO;oBACd,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI;QAEhB,KAAK;QACL,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YACT,KAAK;QAEP,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK;gBAAC;gBAAI;aAAG;YACb,KAAK;QACP,OAAO;YACL,cAAc;YACd,KAAK;QACP;QACA,IAAI,OAAO,YAAY;YACrB,eAAe;YACf,KAAK,OAAO;QACd;QACA,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,KAAK;YACL,KAAK;YACL,IAAI,OAAO,YACT,KAAK;YAEP,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,KAAK;oBAAC;oBAAI;iBAAG;gBACb,KAAK;YACP,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;YACA,IAAI,OAAO,YAAY;gBACrB,eAAe;gBACf,KAAK,OAAO;YACd;YACA,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI;QAEZ,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,eAAe;gBACf,KAAK,QAAQ;YACf,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI;QAEpB,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,KAAK;oBACL,IAAI,OAAO,YAAY;wBACrB,eAAe;wBACf,KAAK,QAAQ,IAAI;oBACnB,OAAO;wBACL,cAAc;wBACd,KAAK;oBACP;gBACF,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI,IAAI;QAEpB,KAAK;QACL,KAAK,EAAE;QACP,KAAK;QACL,IAAI,OAAO,YACT,MAAO,OAAO,WAAY;YACxB,GAAG,KAAK;YACR,KAAK;QACP;aAEA,KAAK;QAEP,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YACT,KAAK;YAEP,KAAK,EAAE;YACP,KAAK;YACL,MAAO,OAAO,WAAY;gBACxB,GAAG,KAAK;gBACR,KAAK;YACP;YACA,KAAK;gBAAC;gBAAI;gBAAI;aAAG;YACjB,KAAK;QACP,OAAO;YACL,cAAc;YACd,KAAK;QACP;QACA,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,KAAK,EAAE;gBACP,KAAK;gBACL,MAAO,OAAO,WAAY;oBACxB,GAAG,KAAK;oBACR,KAAK;gBACP;gBACA,KAAK;oBAAC;oBAAI;iBAAG;gBACb,KAAK;YACP,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI;QAEJ,IAAI,MAAM,WAAW,iBAAiB,IAAI;YACxC,KAAK;YACL;QACF,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI;QAER,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,eAAe;YACf,KAAK,QAAQ;QACf;QACA,KAAK;QAEL,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI;QAEZ,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YACT,KAAK;YAEP,eAAe;YACf,KAAK,QAAQ,IAAI;QACnB,OAAO;YACL,cAAc;YACd,KAAK;QACP;QACA,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,KAAK;gBACL,IAAI,OAAO,YAAY;oBACrB,eAAe;oBACf,KAAK,QAAQ,IAAI;gBACnB,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI;QAEhB;QACA,KAAK;QACL,KAAK;QACL,IAAI,OAAO,YACT,KAAK;QAEP,IAAI,MAAM,WAAW,iBAAiB,IAAI;YACxC,KAAK;YACL;QACF,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,eAAe;gBACf,KAAK,QAAQ,IAAI;YACnB,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QACA,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,IAAI,MAAM,WAAW,iBAAiB,IAAI;oBACxC,KAAK;oBACL;gBACF,OAAO;oBACL,KAAK;oBACL,IAAI,oBAAoB,GAAK,SAAS;gBACxC;gBACA,IAAI,OAAO,YAAY;oBACrB,eAAe;oBACf,KAAK,QAAQ;gBACf,OAAO;oBACL,cAAc;oBACd,KAAK;gBACP;YACF,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF;QACA;QACA,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI,IAAI,IAAI;QAEhB,KAAK;QACL,IAAI,OAAO,KAAK,MAAM,OAAO,eAAe;YAC1C,KAAK,MAAM,OAAO;YAClB;QACF,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QACA,IAAI,OAAO,YAAY;YACrB,KAAK;YACL,IAAI,OAAO,YACT,KAAK;YAEP,KAAK;YACL,IAAI,OAAO,YAAY;gBACrB,eAAe;gBACf,KAAK,QAAQ,IAAI;YACnB,OAAO;gBACL,cAAc;gBACd,KAAK;YACP;QACF,OAAO;YACL,cAAc;YACd,KAAK;QACP;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI;QAEJ,IAAI,OAAO,KAAK,MAAM,OAAO,eAAe;YAC1C,KAAK,MAAM,OAAO;YAClB;QACF,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI,IAAI;QAER,KAAK,EAAE;QACP,KAAK;QACL,IAAI,OAAO,YACT,MAAO,OAAO,WAAY;YACxB,GAAG,KAAK;YACR,KAAK;QACP;aAEA,KAAK;QAGP,OAAO;IACT;IAEA,SAAS;QACP,IAAI;QAEJ,IAAI,OAAO,KAAK,MAAM,OAAO,eAAe;YAC1C,KAAK,MAAM,OAAO;YAClB;QACF,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QAEA,OAAO;IACT;IAEA,SAAS;QACP,IAAI;QAEJ,IAAI,OAAO,KAAK,MAAM,OAAO,eAAe;YAC1C,KAAK,MAAM,OAAO;YAClB;QACF,OAAO;YACL,KAAK;YACL,IAAI,oBAAoB,GAAK,SAAS;QACxC;QAEA,OAAO;IACT;IAEA,aAAa;IAEb,IAAI,eAAe,cAAc,gBAAgB,MAAM,QACrD,OAAO;SACF;QACL,IAAI,eAAe,cAAc,cAAc,MAAM,QACnD,SAAS;QAGX,MAAM,yBACJ,qBACA,iBAAiB,MAAM,SAAS,MAAM,OAAO,kBAAkB,MAC/D,iBAAiB,MAAM,SACnB,oBAAoB,gBAAgB,iBAAiB,KACrD,oBAAoB,gBAAgB;IAE5C;AACF;;;;;AC/1CA;;;;;;;;;;;;CAYC,GACD,kDAAgB;AAfhB;AACA;AAcO,SAAS,aAAc,MAAM,EAAE,QAAQ,KAAK,EAAE,QAAQ,KAAK;IAChE,+EAA+E;IAC/E,0DAA0D;IAC1D,iEAAiE;IACjE,IAAI;QACF,IAAI,OACF,SAAS,CAAA,GAAA,kBAAM,EAAE,QAAQ,CAAA,GAAA,YAAI,EAAE,IAAI;aAEnC,SAAS,CAAA,GAAA,kBAAM,EAAE,QAAQ,CAAA,GAAA,YAAI,EAAE,GAAG;WAE/B,IAAI,OACT,SAAS,CAAA,GAAA,kBAAM,EAAE,QAAQ,CAAA,GAAA,YAAI,EAAE,IAAI;IAGrC,MAAM,IAAI,OAAO;IAAG,MAAM,IAAI,OAAO;IACrC,MAAM,IAAI,OAAO;IAAG,MAAM,IAAI,OAAO;IACrC,IAAI,QAAQ,QAAQ;IAEpB,IAAI,MAAM,KAAK,MAAM,GAAG;QACtB,MAAM,UAAU,KAAK,MAAM,GAAG;QAC9B,SAAS;QACT,SAAS,AAAC,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAC3B,MAAM,OAAO,KAAK,KAAK,IAAI;QAC3B,WAAW,IAAI,IAAI,CAAC,OAAO;IAC7B,OAAO,IAAI,MAAM,KAAK,MAAM,GAAG;QAC7B,MAAM,UAAU,KAAK,MAAM,GAAG;QAC9B,SAAS,AAAC,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAC3B,SAAS;QACT,MAAM,OAAO,KAAK,KAAK,IAAI;QAC3B,WAAW,KAAK,KAAK,IAAK,CAAA,IAAI,IAAI,CAAC,OAAO,IAAG;IAC/C,OAAO;QACL,SAAS;QACT,SAAS;QACT,WAAW;IACb;IAEA,4BAA4B;IAC5B,IAAI,OACF,SAAS,CAAC;IAGZ,IAAI,OACF,SAAS,CAAC;IAGZ,OAAO;QACL,WAAW;YAAE,IAAI,OAAO;YAAG,IAAI,OAAO;QAAE;QACxC,OAAO;YAAE,IAAI;YAAQ,IAAI;QAAO;QAChC,UAAU;YAAE,OAAO;QAAS;IAC9B;AACF;;;AChEA;;;CAGC;;AACD,2CAAgB;AAWhB;;;CAGC,GACD,2CAAgB;AAWhB;;;CAGC,GACD,gDAAgB;AA9BT,SAAS;IACd,OAAO;QACL,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;AACF;AAMO,SAAS;IACd,OAAO;QACL,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;AACF;AAMO,SAAS;IACd,OAAO;QACL,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;AACF;;;;;ACtCA,wGAAwG;AAExG;;;;;CAKC,GACD,wDAAgB;AAOhB;;;;;;;CAOC,GACD,yDAAgB;AA7BhB;AACA;AACA;AACA;AACA;AAUO,SAAS,mBAAoB,aAAa,EAAE,WAAW;IAC5D,MAAM,KAAK,YAAY,IAAI,cAAc;IACzC,MAAM,KAAK,YAAY,IAAI,cAAc;IAEzC,OAAO,CAAA,GAAA,oBAAQ,EAAE,IAAI;AACvB;AAUO,SAAS,oBAAqB,cAAc,EAAE,cAAc,EAAE,YAAY,EAAE,YAAY;IAC7F,oBAAoB;IACpB,MAAM,oBAAoB,mBAAmB,gBAAgB;IAE7D,MAAM,SAAS,CAAA,GAAA,0BAAW,EAAE,mBAAmB,gBAAgB,iCAAiC;;IAChG,MAAM,SAAS;IACf,MAAM,SAAS;IAEf,wBAAwB;IACxB,MAAM,QAAQ,KAAK,MAAM,OAAO,IAAI,OAAO,GAAG,OAAO,IAAI,OAAO,KAAK,KAAK,MAAM,OAAO,IAAI,OAAO,GAAG,OAAO,IAAI,OAAO;IACvH,MAAM,iBAAiB,CAAA,GAAA,cAAK,EAAE,OAAO,OAAO,GAAG,OAAO;IAEtD,qBAAqB;IACrB,MAAM,KAAK,KAAK,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO,GAAG,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO,GAAG;IACtF,MAAM,KAAK,KAAK,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO,GAAG,KAAK,KAAK,IAAI,OAAO,IAAI,OAAO,GAAG;IACtF,MAAM,eAAe,KAAK;IAC1B,MAAM,gBAAgB,CAAA,GAAA,YAAI,EAAE,cAAc,cAAc,OAAO,GAAG,OAAO;IAEzE,OAAO,CAAA,GAAA,kBAAM,EAAE;QACb;QACA;QACA;KACD;AACH;;;;;ACjDA,2DAAgB;AAFhB;AAEO,SAAS,sBAAuB,SAAoD;IACvF,MAAM,SAAS,WAAW,YAAY,UAAU,QAAQ,UAAU;IAClE,MAAM,SAAS,WAAW,YAAY,UAAU,QAAQ,UAAU;IAClE,OAAO,CAAA,GAAA,6BAAM,EACT,CAAA,GAAA,+BAAQ,EAAE,UAAU,GAAG,UAAU,IACjC,CAAA,GAAA,4BAAK,EAAE,UAAU,WAAW,MAAM,KAAK,KACvC,CAAA,GAAA,2BAAI,EAAE,QAAQ;AAEtB;;;ACXA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;ACAlH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,+BAA+B,MAAM,KAAK;;;ACAnH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,gCAAgC,MAAM,KAAK;;;ACApH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;ACCjH,gDAAgB;AAAT,SAAS,WAAY,QAAgB,EAAE,OAAe;IACzD,MAAM,OAAO,KAAK,KAAK;IAEvB,IAAI,UAAU,OAAO,KAAK,IAAI;IAC9B,WAAW,UAAU,IAAI,IAAI;IAC7B,UAAU,KAAK,MAAM;IACrB,WAAW,KAAK,IAAI;IAEpB,OAAO,KAAK,IAAI,GAAG;AACvB;;;;;ACNA,qDAAgB;AAFhB;AAEO,SAAS,gBACZ,aAAwB,EACxB,WAAsB,EACtB,KAAa,EACb,QAAgB;IAEhB,MAAM,MAAM,CAAA,GAAA,6BAAM,EACd,CAAA,GAAA,2BAAQ,EAAE,CAAC,OAAO,CAAC,QACnB,CAAA,GAAA,4BAAK,EAAE,WAAW,MAAM,KAAK;IAEjC,MAAM,WAAW,CAAA,GAAA,kCAAW,EAAE,KAAK;IACnC,SAAS,KAAK,cAAc;IAC5B,SAAS,KAAK,cAAc;IAC5B,OAAO;QACH,GAAG,SAAS;QACZ,GAAG,SAAS;QACZ;QACA;IACJ;AACJ;;;;;ACXA,qDAAgB;AAZhB;AAGA;AASO,SAAS,gBACZ,SAA6B,EAC7B,SAAoB;IAEpB,MAAM,IAAI,CAAA,GAAA,4CAAoB,EAAE;IAChC,MAAM,UAAU,CAAA,GAAA,kCAAW,EAAE,CAAA,GAAA,6BAAM,EAAE,IAAI;IACzC,OAAO;QACH;QACA;QACA,OAAO,UAAU;QACjB,UAAU,UAAU;IACxB;AACJ;;;ACxBA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;;;ACO/G,qDAAgB;AAPhB;AACA;AACA;AACA;AAIO,SAAS,gBACZ,MAAmB,EACnB,UAA6B,EAC7B,YAAuC,EACvC,MAAqB,EACrB,cAAuB;IAGvB,IAAI,2BAAoC;IACxC,IAAI;QACA,2BAA2B,CAAC,CAAC;IACjC,EAAE,OAAO,GAAG,CAAc;IAE1B,MAAM,MAAM,SAAS,cAAc;IACnC,MAAM,UAAU,OAAO,aAAa,OAAO,OAAO,cAAc;IAEhE,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;QACrB,SAAS,CAAA,GAAA,cAAG,EAAE,uBAAwB,CAAA,2BAA2B,KAAK,SAAS,CAAA,GAAA,cAAG,EAAE,sBAAqB;QACzG,KAAK;YACD,WAAW;QACf;IACJ;IACA,IAAI,OAAO;IAGX,MAAM,WAAW,IAAI,CAAA,GAAA,kBAAO,EAAE;QAC1B,OAAO,UAAU,MAAM;QACvB,QAAQ,UAAU,MAAM;QACxB,QAAQ;QACR,WAAW;QACX,UAAU,IAAM,WAAW,IAAM;IACrC;IACA,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS,SAAS;QACrB,WAAW;QACX,YAAY;IAChB;IACA,IAAI,OAAO,SAAS;IAEpB,IAAI,OAAyB;IAE7B,4GAA4G;IAC5G,mHAAmH;IACnH,gDAAgD;IAChD,yCAAyC;IACzC,IAAI;IACJ,SAAS;QACL,IAAI,CAAC,0BACD;QAEJ,aAAa;QACb,cAAc,WAAW;YACrB,SAAS,mBAAmB,OAAO,CAAC;gBAChC,OAAO,UAAU;YACrB,GAAG;QACP,GAAG;IACP;IAEA,eAAe;QACX,IAAI,CAAC,MACD;QAEJ,IAAI;YACA,MAAM,AAAC,UAAU,UAAkB,MAAM;gBACrC,IAAI,cAAc;oBACd,CAAC,KAAK,KAAK,EAAE;gBACjB;aACH;YACD,WAAW;gBACP,OAAO,IAAI,CAAA,GAAA,cAAG,EAAE,oBAAoB;YACxC,GAAG;QACP,EAAE,OAAO,KAAK;YACV,QAAQ,MAAM,AAAC,IAAc,MAAM,AAAC,IAAc;YAClD;QACJ;IACJ;IAEA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;QACnC,QAAQ,SAAU,MAAM,EAAE,QAAQ,EAAE,QAAQ;YACxC,IAAI;gBAAC;gBAAU;aAAQ,CAAC,SAAS,WAAW;gBACxC;gBACA,aAAa;YACjB;QACJ;IACJ;IAEA,IAAI;IACJ,SAAS;QACL,aAAa;IACjB;IACA,OAAO,iBAAiB,QAAQ;IAEhC,MAAM,YAAY,EAAE;IACpB,IAAI,0BACA,UAAU,KAAK,CAAA,GAAA,cAAG,EAAE;IAExB,IAAI,gBACA,UAAU,KAAK,CAAA,GAAA,cAAG,EAAE;IAExB,UAAU,KAAK;IAEf,CAAA,GAAA,oBAAQ,EAAE;QACN,QAAQ;QACR,SAAS,QAAS,CAAA,iBAAiB,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,uBAAuB,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,uBAAuB,CAAC,GAAG,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,uBAAuB,CAAC,AAAD,IAAK;QAC3I,KAAK;QACL,OAAO,UAAU,CAAC,IAAI;YAClB,OAAO;QACX;QACA,SAAS;QACT,WAAW;YAAC,CAAA,GAAA,cAAG,EAAE;SAAqB;QACtC,UAAU,SAAU,MAAM;YACtB,IAAI,WAAW,CAAA,GAAA,cAAG,EAAE,sBAChB;iBACG,IAAI,WAAW,CAAA,GAAA,cAAG,EAAE,sBAAsB;gBAC7C,MAAM,UAAU,SAAS;gBACzB,aAAa;oBACT,MAAM,KAAK,MAAM,CAAC,QAAQ;oBAC1B,OAAO,KAAK,MAAM,QAAQ,IAAI,QAAQ,QAAQ,WAAW;oBACzD,KAAK,KAAK,MAAM,CAAC,QAAQ;oBACzB,QAAQ,KAAK,MAAM,QAAQ,IAAI,QAAQ,SAAS,WAAW;gBAC/D;YACJ;YACA,OAAO,oBAAoB,QAAQ;YACnC,CAAA,GAAA,MAAC,EAAE,WAAW,SAAS;YACvB,SAAS;YACT,YAAY;QAChB;QACA,cAAc,CAAA,GAAA,cAAG,EAAE;QACnB,WAAW,SAAU,IAAI;YACrB,YAAY;QAChB;IACJ;AACJ;;;;;AClGA,kDAAa;AAxCb;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAgBA,MAAM,cAAc;AAEb,MAAM;IAkCD,KAAM,YAAoB,EAAE,YAAoB,EAAQ;QAC5D,IAAI,MAAM,iBAAiB,MAAM,eAC7B,MAAM;QAEV,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,iBAAiB,QAAQ,IAC9C,AAAC,CAAA,CAAC;YACE,IAAI,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,UAAU;YAC9C,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,SAAS,cAC5B,OAAO;iBACJ;gBACH,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,cAC1B;gBAEJ,IAAI,QAAQ,cACR;YAER;YACA,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO;YAC1B,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,AAAC,CAAA,IAAI,CAAC,cAAc,IAAI,CAAC,YAAW,IAAM,CAAA,IAAI,CAAC,iBAAiB,SAAS,OAAO,CAAA;YAC1G,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO;QAC7D,CAAA,EAAG;QAEP,IAAI,iBAAiB,cACjB;QAEJ,IAAI,CAAC,SAAS,UAAU,IAAI,CAAC,mBAAmB,eAAe;QAC/D,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;QACtC,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC,SAAS,WAAW,IAAI,CAAC,sBAAsB;IACxD;IAEQ,UAAW,CAAS,EAAU;QAClC,IAAI,SAAS,SAAS,KAAM,CAAA,IAAK,CAAA,IAAI,CAAC,cAAc,IAAI,CAAC,YAAW,IAAK,GAAE;QAC3E,SAAS,KAAK,IAAI,IAAI,CAAC,iBAAiB,SAAS,GAAG,KAAK,IAAI,GAAG;QAChE,SAAS,IAAI,CAAC,iBAAiB,SAAS,SAAS;QACjD,OAAO;IACX;IAEA;;KAEC,GACD,AAAQ,6BAA8B,EAAU,EAAE,OAAe,EAAQ;QACrE,UAAU,KAAK,IAAI,IAAI,CAAC,iBAAiB,SAAS,GAAG,KAAK,IAAI,GAAG;QACjE,IAAI,YAAY,IAAI,CAAC,SACjB;QAEJ,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,iBAAiB,QAAQ,IAAK;YACnD,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,SAAS,IAC5B;YAEJ,IAAI,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;YAC9B,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,IAC1B;YAEJ,IAAI,QAAQ,SACR;YAEJ,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO,AAAC,CAAA,IAAI,CAAC,cAAc,IAAI,CAAC,YAAW,IAAM,CAAA,IAAI,CAAC,iBAAiB,SAAS,OAAO,CAAA;YAC1G,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,MAAM,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,OAAO;QAC7D;QACA,IAAI,CAAC,UAAU;IACnB;IAEQ,YAAa,SAAiB,EAAQ;QAE1C,CAAA,GAAA,oCAAgB,EACZ,IAAI,CAAC,UACL,IAAI,CAAC,SAAS,SAAS,WAAY,MACnC,CAAC;YACG,IAAI,YAAY,aAAa,YAAY,IAAI,CAAC,SAAS,SAAS,WAAY,MACxE;YAEJ,IAAI,CAAC,SAAS,YAAY,WAAW;YACrC,IAAI,CAAC;YACL,CAAA,GAAA,oBAAQ,EAAE,MAAM;YAChB,IAAI,CAAC,SAAS;YACd,CAAA,GAAA,oBAAQ,EAAE,MAAM;QACpB;IAER;IAEQ,eAAsB;QAC1B,IAAI,CAAC,YAAY,MAAM,SAAS,AAAC,IAAI,CAAC,WAAW,SAAS,KAAM;IACpE;IAEQ,kBAAyB;QAC7B,IAAI,CAAC,kBAAkB,CAAA,GAAA,oBAAQ,EAAE;QACjC,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;QACtC,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,WAAW,CAAA,GAAA,YAAI,EAAE;QAEjE,MAAM,mBAAmB,CAAC;YACtB,MAAM,UAAU,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,SAAS;YACnD,MAAM,YAAY,QAAQ;YAC1B,MAAM,UAAU,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;YAC7C,MAAM,YAAY,QAAQ;YAC1B,MAAM,cAAc,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,QAAQ;YAEzD,MAAM,QAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;gBAC1B,WAAW;YACf;YACA,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG;YACzB,MAAM,OAAQ,AAAC,CAAA,IAAI,CAAC,iBAAiB,SAAS,CAAA,IAAK,KAAK,QAAQ;YAChE,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;gBACV,KAAK,MAAM,OAAO;YACtB;YACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE;YACtB,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY;gBACf,UAAU;YACd;YAEA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE;YACtB,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY;gBACf,OAAO;gBACP,QAAQ;YACZ;YACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE;YACtB,MAAM,OAAO;YACb,WAAW,OAAO,YAAY;YAE9B,MAAM,OAAO;YAEb,uBAAuB;YACvB;gBACI,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;oBACvB,SAAS;oBACT,QAAQ;oBACR,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,KAAK;wBACD,SAAS;wBACT,OAAO;wBACP,QAAQ;wBACR,gBAAgB;wBAChB,YAAY;wBACZ,QAAQ;oBACZ;gBACJ;gBACA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;oBAChB,SAAS;oBACT,QAAQ;oBACR,QAAQ;wBACJ,MAAM;wBACN,UAAU;oBACd;oBACA,KAAK;wBACD,SAAS;wBACT,QAAQ;wBACR,QAAQ;wBACR,aAAa;oBACjB;gBACJ;gBACA,MAAM,UAAU;gBAChB,MAAM,WAAW;oBACb,IAAI,CAAC,SAAS,kBAAkB,MAAM,MAAM,MAAM;oBAClD,IAAI,CAAC;oBACL,IAAI,MAAM,SAAS,IAAI,CAAC,mBAAmB;wBACvC,CAAA,GAAA,oBAAQ,EAAE,MAAM;wBAChB,IAAI,CAAC,SAAS,IAAI,CAAC;wBACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBACpB;gBACJ;gBACA,gCAAgC;gBAChC,MAAM,cAAc,CAAC;oBACjB,EAAE;oBACF,EAAE;gBACN;gBACA,IAAI,GAAA,2BACA,aAAa,gBAAgB;qBAE7B,aAAa,cAAc;YAEnC;YAGA,OAAO;YACP;gBACI,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,QAAQ,YAAY,OAAO,YAAY,QAAQ,IAAI,IAAI;gBAClF,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,gBAAgB,OAAO,gBAAgB;gBAE/D,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM;gBACzB,IAAI;gBACJ,IAAI,MAAM,MAAM,QAAQ,YAAY,OAChC,IAAI,wBAAwB;gBAEhC,IAAI,UAAU,aAAa,GAAG,GAAG,MAAM,MAAM,OAAO,MAAM,MAAM;gBAChE,IAAI;gBACJ,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,OAAO;oBAChB,UAAU;oBACV,MAAM,AAAE,CAAA,KAAK,MAAM,MAAM,KAAI,IAAK,IAAI,cAAe;oBACrD,KAAK,AAAE,CAAA,KAAK,MAAM,MAAM,MAAK,IAAK,IAAI,IAAK;gBAC/C;gBACA,MAAM,MAAM,MAAM,kBAAkB,SAAS,eAAe;YAChE;YAII,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;gBAChB,WAAW;YACf;YACA,MAAM,YAAY;YAClB,MAAM,MAAM,OAAO,MAAM;YAEzB,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,OAAO;gBAChB,UAAU;gBACV,MAAM,AAAC,KAAa,cAAe;gBACnC,KAAK;gBACL,UAAU;gBACV,OAAO;gBACP,QAAQ;gBACR,UAAU;gBACV,YAAY;YAChB;YAEA,MAAM,MAAM,aAAa;gBACrB,IAAI,CAAC,YAAY,MAAM;YAC3B;YAIA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;gBACvB,WAAW;YACf;YACA,MAAM,UAAU;YAChB,MAAM,aAAa,OAAO,SAAS,KAAM,MAAM,UAAU,OAAQ;YAEjE,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,cAAc;gBACvB,UAAU;gBACV,MAAM,AAAC,MAAuB,cAAe;gBAC7C,KAAK;gBACL,UAAU;gBACV,WAAW;gBACX,OAAO;gBACP,YAAY;gBACZ,gBAAgB,YAAY,YAAY;YAC5C;YAGJ,IAAI;YACJ,MAAM,gBAAgB,IAAI,CAAA,GAAA,wBAAU,EAAE;gBAClC,MAAM,MAAM;gBACZ,OAAO;gBACP,WAAW;gBACX,UAAU,CAAC,aAAa,SAAS;oBAC7B,IAAI,SAAS;wBACT,aAAa,IAAI,CAAC,SAAS,SAAS,MAAM,MAAO;wBACjD,CAAA,GAAA,oBAAQ,EAAE,MAAM;wBAChB;oBACJ;oBACA,IAAI,QAAQ;wBACR,CAAA,GAAA,oBAAQ,EAAE,MAAM;wBAChB,IAAI,eAAe,aACf,IAAI,CAAC,SAAS,aAAa,MAAM,MAAM;wBAE3C;oBACJ;oBACA,MAAM,aAAa,YAAY,KAAK,MAAM,cAAc,OAAO;oBAC/D,IAAI,CAAC,SAAS,aAAa,MAAM,MAAM;gBAC3C;YACJ;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,SAAS;gBAC1B,UAAU;gBACV,MAAM,AAAC,KAAK,cAAe;gBAC3B,KAAK;YACT;YACA,MAAM,gBAAgB;YAEtB,8BAA8B;YAC9B,MAAM,MAAM,gBAAgB,CAAC;gBACzB,IAAI,EAAE,YAAY,KAAM,CAAA,CAAC,EAAE,eAAe,EAAE,gBAAgB,OAAM,GAC9D;gBAGJ,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,QAAQ,YAAY,OAAO,YAAY,QAAQ,KAAK,KAAK;gBAEpF,IAAI,IAAI,CAAC,iBAAiB,UAAU,gBAAgB,SAAS,IAAI,CAAC,iBAAiB,WAAW,gBAAgB,QAAQ;oBAClH,IAAI,CAAC,iBAAiB,QAAQ,gBAAgB;oBAC9C,IAAI,CAAC,iBAAiB,SAAS,gBAAgB;gBACnD;gBACA,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;gBACxB,IAAI;gBACJ,IAAI,IAAI,CAAC,iBAAiB,QAAQ,YAAY,OAC1C,IAAI,wBAAwB;gBAEhC,IAAI,wBAAwB;gBAC5B,IAAI,UAAU,GAAG,GAAG,IAAI,CAAC,iBAAiB,OAAO,IAAI,CAAC,iBAAiB;gBACvE,IAAI,UAAU,aAAa,GAAG,GAAG,IAAI,CAAC,iBAAiB,OAAO,IAAI,CAAC,iBAAiB;gBACpF,IAAI;gBACJ,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe;oBACvB,KAAK,AAAC,EAAE,UAAU,IAAI,CAAC,iBAAiB,SAAS,IAAK;oBACtD,SAAS;gBACb;gBACA,IAAI,CAAC,IAAI,CAAC,sBAAsB;oBAC5B,SAAS,KAAK,OAAO,IAAI,CAAC;oBAC1B,IAAI,CAAC,uBAAuB;gBAChC;gBACA,aAAa,IAAI,CAAC;gBAClB,IAAI,CAAC,sBAAsB,WAAW;oBAClC,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe;wBACvB,SAAS;oBACb;gBACJ,GAAG;gBACH,aAAa,IAAI,CAAC;YACtB;YACA,MAAM,MAAM,eAAe;gBACvB,aAAa,IAAI,CAAC;gBAClB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe;oBACvB,SAAS;gBACb;gBACA,aAAa,IAAI,CAAC;gBAClB,IAAI,CAAC,oBAAoB,WAAW;oBAChC,IAAI,CAAC,IAAI,CAAC,sBACN;oBAEJ,IAAI,CAAC,cAAc;oBACnB,IAAI,CAAC,uBAAuB;gBAChC,GAAG;YACP;YAEA,WAAW,OAAO,MAAM,OAAO,MAAM,OAAO,MAAM,cAAc,cAAc;YAC9E,IAAI,YAAY;YAChB,IAAI,iBAAiB;YAErB,sCAAsC;YACtC,MAAM,mBAAmB,CAAC;gBACtB,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;wBACV,YAAY;oBAChB;oBACA,MAAM,MAAM,SAAS;oBACrB,IAAI,CAAC,UAAU,MAAM;oBACrB,iBAAiB;oBACjB,IAAI,CAAC,MAAM,YAAY;wBACnB,iBAAiB;wBACjB,IAAI,CAAC,cAAc,MAAM;oBAC7B;oBACA,YAAY;gBAEhB,OAAO,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBAEhE,IAAI,WAAW;wBACX,YAAY;wBACZ,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;4BACV,WAAW;wBACf;oBACJ;oBACA,MAAM,QAAQ,MAAM;oBACpB,MAAM,YAAY,KAAK,IAAI,GAAG,KAAK,IAAI,AAAC,CAAA,IAAI,CAAC,iBAAiB,SAAS,CAAA,IAAM,IAAK,MAAM;oBACxF,MAAM,MAAM,MAAM,YAAY;oBAC9B,IAAI,CAAC,6BAA6B,MAAM,MAAM,IAAI,CAAC,UAAU,MAAM;gBAEvE;gBACA,IAAI,MAAM,SAAS,aAAa;oBAC5B,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;wBACV,YAAY;oBAChB;oBACA,WAAW;wBACP,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;4BACV,WAAW;wBACf;oBACJ,GAAG;oBACH,MAAM,OAAO,KAAK,IAAI,GAAG,KAAK,IAAI,AAAC,CAAA,IAAI,CAAC,iBAAiB,SAAS,CAAA,IAAM,IAAK,MAAM;oBACnF,MAAM,MAAM,SAAS;oBACrB,MAAM,UAAU,IAAI,CAAC,UAAU,MAAM;oBACrC,MAAM,UAAU,MAAM;oBACtB,IAAI,CAAC,KAAK,MAAM,MAAM;oBACtB,IAAI,WAAW,SAAS;wBACpB,CAAA,GAAA,oBAAQ,EAAE,MAAM;wBAChB,IAAI,CAAC,SAAS,IAAI,CAAC;wBACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBACpB;oBACA,IAAI,YAAY,WAAW,gBACvB,IAAI,CAAC,SAAS,IAAI,CAAC;oBAEvB,iBAAiB;gBACrB;YACJ;YAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC3C,QAAQ;gBACR,WAAW;YACf;YAEA,IAAI,CAAC,YAAY,OAAO;QAC5B;QACA,IAAI,CAAC,aAAa,EAAE;QACpB,MAAO,IAAI,CAAC,YAAY,WAAY;YAChC,MAAM,QAAQ,IAAI,CAAC,YAAY;YAC/B,MAAM,gBAAgB;YACtB,MAAM,cAAc;YACpB,MAAM;QACV;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,iBAAiB,QAAQ,IAC9C,iBAAiB;QAErB,IAAI,CAAC,cAAc,IAAI,CAAC;QACxB,IAAI,CAAC;IACT;IAEQ,gBAAuB;QAC3B,MAAM,aAAa,IAAI,CAAC,iBAAiB,WAAW,CAAA,GAAA,oBAAS;QAC7D,MAAM,WAAW,IAAI,CAAC,iBAAiB,WAAW;QAElD,IAAI,CAAC,OAAO,WAAW;QACvB,IAAI,CAAC,UAAU,WAAW;QAC1B,IAAI,CAAC,aAAa,WAAW;QAC7B,IAAI,CAAC,SAAS,WAAW,IAAI,CAAC,sBAAsB;QACpD,IAAI,CAAC,aAAa,WAAW,aAAa,CAAC;IAC/C;IAGA,mBAAmB;IACnB,YACI,QAAkB,EAClB,QAAsC,EACtC,QAAqB,EACrB,OAAkB,CACpB;aAraM,UAAkB;aAGT,cAAsB;aACtB,eAAuB;QAkapC,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,eAAe;QACpB,MAAM,QAAQ;QACd,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,UAAU;QAEf,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,SAAS,CAAA,GAAA,MAAC,EAAE;YACZ,KAAK;gBACD,UAAU;gBACV,KAAK;gBACL,YAAY;gBACZ,WAAW;gBACX,eAAe;gBACf,SAAS;gBACT,QAAQ;gBACR,YAAY;gBACZ,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,WAAW;QAChB,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,CAAC;YACxB,IAAI,CAAC,cAAc,MAAM,kBAAkB,SAAS,MAAM;QAC9D,GAAG,CAAA,GAAA,YAAI,EAAE;QACT,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,OAAO,KAAK;QACvC,IAAI,CAAC,iBAAiB,MAAM,UAAU;QACtC,IAAI,CAAC,cAAc,OAAO,IAAI,CAAC;QAC/B,IAAI,CAAC,uBAAuB;QAE5B,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;QACtC,IAAI,CAAC,oBAAoB,IAAI,CAAC,iBAAiB,SAAS;QACxD,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,aAAa;gBACb,cAAc;gBACd,YAAY;gBACZ,WAAW;gBACX,QAAQ;YACZ;QACJ;QAEA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,KAAK;gBACD,OAAO,QAAQ;gBACf,UAAU;gBACV,QAAQ;gBACR,QAAQ;YACZ;QACJ;QAEA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,QAAQ;QACZ;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAQ;QACtC,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAQ;QAC5C,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAQ;QACxC,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAQ;QACzC,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAQ;QAC1C,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YACjC,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;gBACV,SAAS,CAAC,UAAU,EAAE,CAAA,GAAA,4BAAW,EAAE,cAAc,CAAC;gBAClD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,SAAS;gBACb;YACJ;YACA,aAAa,CAAA,GAAA,cAAG,EAAE;YAClB,OAAO;gBACH;oBAAC;oBAAa,CAAA,GAAA,cAAG,EAAE;iBAAoB;aAC1C;YACD,aAAa,CAAC;gBACV,IAAI,OAAO,aAAa;oBACpB,MAAM,WAAW,IAAI,CAAC,SAAS;oBAC/B,IAAI,aAAa,OACb;oBAEJ,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;oBACtC,IAAI,CAAC,oBAAoB;oBAEzB,IAAI,CAAC;oBACL,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAChB,IAAI,CAAC,SAAS,IAAI,CAAC;oBACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAEhB,IAAI,CAAC;gBACT;YACJ;QACJ;QAEA,IAAI,CAAC;QAEL,MAAM,gBAAgB;YAClB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE;YACf,MAAM,QAAQ;gBACV,CAAA,GAAA,MAAC,EAAE,gBAAgB,IAAI,CAAC;gBACxB,CAAA,GAAA,MAAC,EAAE,gBAAgB,IAAI,CAAC;gBACxB,CAAA,GAAA,MAAC,EAAE,gBAAgB,IAAI,CAAC;gBACxB,CAAA,GAAA,MAAC,EAAE,gBAAgB,IAAI,CAAC;gBACxB,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAEnB,IAAI,CAAC,OAAO,MAAM,WAAW;gBAC7B,IAAI,CAAC,aAAa,MAAM,WAAW;gBACnC,IAAI,CAAC,SAAS,MAAM,WAAW;gBAC/B,IAAI,CAAC,UAAU,MAAM,WAAW;gBAChC,UAAU,MAAM,WAAW;gBAE3B,IAAI,CAAC,OAAO,QAAQ,CAAA,GAAA,cAAG,EAAE;gBACzB,IAAI,CAAC,aAAa,QAAQ,CAAA,GAAA,cAAG,EAAE;gBAC/B,IAAI,CAAC,UAAU,QAAQ,CAAA,GAAA,cAAG,EAAE;gBAC5B,IAAI,CAAC,SAAS,QAAQ,CAAA,GAAA,cAAG,EAAE;gBAC3B,UAAU,QAAQ,CAAA,GAAA,cAAG,EAAE;gBAEvB,IAAI,CAAC,OAAO,MAAM,cAAc;gBAChC,IAAI,CAAC,OAAO,MAAM,eAAe;gBAEjC,IAAI,CAAC,UAAU,MAAM,cAAc;gBACnC,IAAI,CAAC,UAAU,MAAM,eAAe;gBAEpC,IAAI,CAAC,aAAa,MAAM,cAAc;gBACtC,IAAI,CAAC,aAAa,MAAM,eAAe;gBAEvC,IAAI,CAAC,SAAS,MAAM,cAAc;gBAClC,IAAI,CAAC,SAAS,MAAM,eAAe;gBAEnC,UAAU,MAAM,SAAS;gBACzB,UAAU,MAAM,aAAa;gBAE7B,IAAI,CAAC,OAAO,YAAY,eAAe,CAAA,GAAA,2BAAU,IAAI;gBACrD,IAAI,CAAC,aAAa,YAAY,eAAe,CAAA,GAAA,iCAAgB,IAAI;gBACjE,IAAI,CAAC,SAAS,YAAY,eAAe,CAAA,GAAA,8BAAY,IAAI;gBACzD,IAAI,CAAC,UAAU,YAAY,eAAe,CAAA,GAAA,8BAAa,IAAI;gBAC3D,UAAU,YAAY,eAAe,CAAA,GAAA,8BAAa,IAAI;gBACtD,IAAI,OACA,CAAA,GAAA,IAAA,EAAE,qBAAqB;oBACnB,IAAI,CAAC;oBACL,IAAI,CAAC;oBACL,IAAI,CAAC;oBACL,IAAI,CAAC;oBACL;oBACA,CAAA,GAAA,IAAA,EAAE;oBACF,IAAI,CAAC,aAAa;iBACrB;gBAGL,IAAI,CAAC,OAAO,UAAU;oBAClB,IAAI,IAAI,CAAC,SAAS,SAAS,IAAI,CAAC,uBAAuB,OACnD;oBAEJ,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;oBAEtC,IAAI,CAAC,oBAAoB,IAAI,CAAC,oBAAoB;oBAClD,IAAI,CAAC;oBACL,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAChB,IAAI,CAAC,SAAS,IAAI,CAAC;oBACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAEhB,IAAI,CAAC;gBACT;gBACA,IAAI,CAAC,aAAa,UAAU;oBACxB,IAAI,IAAI,CAAC,SAAS,eAAe,IAAI,CAAC,uBAAuB,OACzD;oBAEJ,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;oBAEtC,IAAI,CAAC;oBACL,IAAI,CAAC;oBACL,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAChB,IAAI,CAAC,SAAS,IAAI,CAAC;oBACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAEhB,IAAI,CAAC;gBACT;gBACA,IAAI,CAAC,UAAU,UAAU;oBACrB,IAAI,IAAI,CAAC,WAAW,UAAU,GAC1B;oBAGJ,IAAI,CAAC,SAAS,YAAY,IAAI,CAAC;oBAC/B,IAAI,IAAI,CAAC,oBAAoB,GACzB,IAAI,CAAC;oBAET,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;oBACtC,IAAI,CAAC;oBACL,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAChB,IAAI,CAAC,SAAS,IAAI,CAAC;oBACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAEhB,IAAI,CAAC;gBACT;gBACA,IAAI,CAAC,SAAS,UAAU;oBACpB,IAAI,IAAI,CAAC,qBAAqB,GAC1B;oBAEJ,CAAA,GAAA,kCAAe,EAAE,IAAI,CAAC,UAAU;wBAC5B,WAAW,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,kBAAkB,CAAC,QAAQ;wBACjE,cAAc,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,QAAQ;wBACxE,YAAY,IAAI,CAAC,SAAS,SAAS,IAAI,CAAC,mBAAoB;wBAC5D,YAAY,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,kBAAkB,CAAC;wBAC1D,UAAU,CAAC;4BACP,IAAI,CAAC,SAAS,YAAY,IAAI,CAAC,mBAAmB,IAAI,CAAC,oBAAoB,GAAG;4BAC9E,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;4BACtC,IAAI,CAAC;4BAEL,IAAI,CAAC;4BACL,CAAA,GAAA,oBAAQ,EAAE,MAAM;4BAChB,IAAI,CAAC,SAAS,IAAI,CAAC;4BACnB,CAAA,GAAA,oBAAQ,EAAE,MAAM;4BAEhB,IAAI,CAAC;wBACT;oBACJ;gBACJ;gBAEA,UAAU,UAAU;oBAChB,IAAI,CAAC,YAAY,IAAI,CAAC;gBAC1B;YACJ;YACA,WAAW,OAAO;YAClB,OAAO;QACX;QACA,IAAI,CAAC,OAAO,OAAO;QAEnB,IAAI;QAEA,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS,CAAA,GAAA,cAAG,EAAE,qBAAqB;YACnC,KAAK;gBACD,UAAU;YACd;QACJ;QAEA,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,cAAK,EAAY;YACnC,WAAW;gBACP;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACH,CAAC,IAAI,CAAC;gBACH,OAAO,OAAO;oBAAC;oBAAM,CAAA,GAAA,oCAAgB,EAAE;iBAAM,GAAG;YACpD;YACA,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,WAAW,IAAI,CAAC,mBAAmB;gBACjD,IAAI,CAAC,OAAO,IAAI,CAAC;YACrB;YACA,KAAK;gBACD,cAAc;YAClB;QACJ;QAEA,YAAY,OAAO,IAAI,CAAC,WAAW;QACnC,IAAI,CAAC,OAAO,OAAO;QAKvB,IAAI,CAAC,OAAO,OAAO;QAEnB,iCAAiC;QACjC,6EAA6E;QAC7E,YAAY;YACR,IAAI,IAAI,CAAC,OAAO,MAAM,YAAY,SAC9B;YAGJ,MAAM,eAAe,CAAA,GAAA,oBAAQ,EAAE;YAC/B,IAAI,iBAAiB,IAAI,CAAC,iBACtB;YAEJ,IAAI,CAAC,kBAAkB;YAEvB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,QAAQ,IACxC,IAAI,IAAI,CAAC,sBAAsB,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAQ,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,KAAK,EAAE;gBACtG,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBACtC,IAAI;gBACJ,IAAI,UAAU,GAAG,GAAG,IAAI,OAAO,OAAO,IAAI,OAAO;gBACjD,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,OAAO,QAAQ,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,OAC/F,IAAI,wBAAwB;gBAEhC,IAAI,UAAU,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,QAAQ,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,MAAM;gBAC5I,IAAI;YACR;QAGR,GAAG;QAEH,CAAA,GAAA,YAAI,EAAE,kBAAkB;YACpB,IAAI,CAAC;QACT;QAEA,IAAI,CAAC;IACT;IAEA,sBAAsB;IACtB,OAAQ,oBAA6B,EAAQ;QACzC,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS;QACtC,IAAI,wBAAwB,yBAAyB,GACjD,IAAI,CAAC,oBAAoB;QAE7B,IAAI,CAAC;QACL,WAAW,IAAM,IAAI,CAAC,mBAAmB;IAC7C;IAEA,cAAuB;QACnB,OAAO,IAAI,CAAC;IAChB;IAEA,cAAe,SAAiB,EAAQ;QACpC,IAAI,YAAY,KAAK,YAAY,IAAI,CAAC,WAAW,SAAS,GACtD,MAAM,uBAAuB,YAAY,yBAAyB,IAAI,CAAC,WAAW;QAEtF,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC,WAAW,SAAS,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,kBAAkB,CAAC;QACvE,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,QAAQ,IAAK;YAC7C,MAAM,QAAQ,IAAI,CAAC,UAAU,CAAC,EAAE;YAChC,MAAM,aAAa,IAAI,CAAC,sBAAsB,MAAM;YAEpD,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;gBACV,WAAW;YACf;YACA,MAAM,UAAU,OAAO,sBAAsB;YAC7C,MAAM,cAAc,UAAU;YAC9B,MAAM,aAAa;QACvB;QACA,IAAI,CAAC,SAAS,WAAW,IAAI,CAAC,sBAAsB;IACxD;IAEA,WAAY,QAAmB,EAAQ;QACnC,IAAI,CAAC,UAAU;QAEf,IAAI,IAAI,CAAC,YAAY,QACjB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe;YACvB,MAAM;YACN,OAAO;QACX;aAEA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe;YACvB,MAAM;YACN,OAAO;QACX;IAER;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;;;gDC9yBa;AAiBb;;;;;CAKC,GACD,8CAAa;AAnEb;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA,sBAAsB;AACtB,0FAA0F;AAC1F,8CAA8C;AAC9C,mEAAmE;AACnE,SAAS,6BAA8B,GAA6B;IAChE,IAAI;IACJ,IAAI,YAAY;IAChB,IAAI,SAAS,YAAY,YAAY,GAAG;IACxC,IAAI;AACR;AAIA,MAAM,kBAAkB;IACpB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACH;AAEM,MAAM,aAAa;AAuBnB,MAAM;IAcD,KAAM,CAAS,EAAE,CAAS,EAAQ;QACtC,IAAI,CAAC,KAAK,CAAC,KAAK,MAAM,MAAM,MAAM,MAAM,IAAI,KAAK,IAAI,GACjD,MAAM,IAAI,MAAM,iCAAiC,IAAI,OAAO;QAEhE,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;IAClB;IAEQ,aAAoB;QACxB,sGAAsG;QACtG,IAAI,CAAC,kBAAkB,QAAQ,CAAA,OAAQ;IAC3C;IAEQ,gBAAuB;QAC3B,IAAI,CAAC,eAAe,QAAQ,CAAC,MAAM;YAC/B,KAAK,QAAQ;QACjB;IACJ;IAEA,mBAAmB;IAEnB,YACI,MAQC,EACO,gBAAwB,CAAC,CACnC;6BADU;aAxCJ,cAAc;QA0ClB,IAAI,CAAC,iBAAiB,EAAE;QACxB,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QAC/B,IAAI,CAAC,UAAU,IAAI,CAAA,GAAA,yBAAa;QAChC,IAAI,UAAU,QAAQ;YAClB,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,SAAS;QAClB,OACI,IAAI,WAAW,UAAU,YAAY,QAAQ;YACzC,IAAI,CAAC,QAAQ,OAAO;YACpB,IAAI,CAAC,SAAS,OAAO;QACzB,OAAO;YACH,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,SAAS;QAClB;QAEJ,IAAI,CAAC,KAAK,IAAI,CAAC,OAAO,IAAI,CAAC;QAE3B,IAAI,CAAC,oBAAoB,EAAE;QAE3B,IAAI,UAAU,QACV,IAAI;YACA,IAAI,CAAC,KAAK,OAAO;QACrB,EAAE,OAAO,GAAG;YACR,IAAI,CAAC;YACL,MAAM;QACV;aACG,IAAI,gBAAgB,QAAQ;YAC/B,MAAM,WAAW;mBAAI,OAAO,WAAW;aAAO;YAC9C,IAAI,CAAC,KAAK,OAAO,WAAW,OAAO,OAAO,WAAW;YAErD,IAAI,CAAC,SAAS,QACV,MAAM,IAAI,MAAM;YAGpB,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,QAAQ,IAAK;gBACtC,MAAM,aAAa,QAAQ,CAAC,EAAE,CAAC;gBAC/B,IAAI,cAAc,CAAC,gBAAgB,SAAS,aACxC,MAAM,IAAI,MAAM,wBAAwB,QAAQ,CAAC,EAAE,CAAC;gBAGxD,IAAI,CAAC;gBACL,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC,EAAE,CAAC;gBACjC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,QAAQ,CAAC,EAAE,CAAC;gBAC1C,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,YAAY,QAAQ,CAAC,EAAE,CAAC;gBAC/C,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,aAAa,cAAc;gBAClD,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,QAAQ,CAAC,EAAE,CAAC,OAAO,GAAG;YACnE;QACJ;QACA,IAAI,CAAC;IACT;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA;;;;KAIC,GACD,MACI,CAaC,EACK;QACN,IAAI,CAAC,EAAE,SAAS,CAAC,EAAE,UAAU,EAAE,QAAQ,KAAK,EAAE,SAAS,KAAK,MAAM,EAAE,UAAU,MAAM,EAAE,SAClF,MAAM,IAAI,MAAM;QAGpB,IAAI,CAAC,QAAQ,MAAM;QAEnB,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,SAAS,EAAE;QAEhB,IAAI,CAAC,eAAe,OAAO,GAAG,KAAK,IAAI,GAAG,IAAI,CAAC,eAAe,SAAS;QAEvE,IAAI,EAAE,QACF,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,OAAO,QAAQ,IAAK;YACtC,MAAM,OAAO,EAAE,MAAM,CAAC,EAAE;YACxB,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,EAAE,EACvB,IAAI,CAAC;YAET,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,KAAK;YACnC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,YAAY,KAAK;YACxC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,QAAQ,IAAI,CAAC;YACpC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,SAAS,IAAI,CAAC;YACrC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,aAAa,KAAK,aAAa,KAAK,aAAa;YACxE,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,KAAK,OAAO,GAAG;YACxD,IAAI,CAAC,aAAa,GAAG,KAAK;QAC9B;aACG;YACH,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,EAAE,YAAY,EAAE,YAAY,CAAA,GAAA,cAAG,EAAE,kBAAkB;YACjF,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,YAAY;YACnC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,QAAQ,IAAI,CAAC;YACpC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,SAAS,IAAI,CAAC;YACrC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,aAAa;YACpC,IAAI,CAAC,aAAa,GAAG;YACrB,IAAI,EAAE,OACF,IAAI,CAAC,UAAU,GAAG,EAAE;iBACjB,IAAI,EAAE,OACT,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,EAAE,OAAO,GAAG;QAE7D;QACA,IAAI,CAAC;QAEL,IAAI,CAAC,QAAQ,MAAM;QAEnB,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;aAAE;QACf;QAEA,OAAO,IAAI,CAAC,eAAe,SAAS;IACxC;IAEA,sBAAgC;QAC5B,OAAO,IAAI,CAAC,eAAe,UAAU;IACzC;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAqB;QACjB,OAAO,IAAI,CAAC;IAChB;IAEA,KAAM,YAAsB,EAAQ;QAChC,IACI,aAAa,aAAa,KAC1B,aAAa,cAAc,KAC3B,MAAM,aAAa,eACnB,MAAM,aAAa,cAEnB,MAAM,IAAI,MAAM;QAGpB,yBAAyB;QAEzB,MAAM,aAAa,aAAa;QAEhC,MAAO,IAAI,CAAC,eAAe,SAAS,WAAW,OAC3C,IAAI,CAAC,YAAY,IAAI,CAAC,eAAe,SAAS;QAGlD,IAAI,aAAa,cAAc,IAAI,CAAC,SAAS,aAAa,eAAe,IAAI,CAAC,QAC1E,IAAI,CAAC,KAAK,aAAa,YAAY,aAAa;QAEpD,IAAK,IAAI,IAAI,GAAG,IAAI,WAAW,QAAQ,IAAK;YACxC,IAAI,KAAK,IAAI,CAAC,eAAe,QACzB,IAAI,CAAC;iBACF;gBACH,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,QAAQ,IAAI,CAAC;gBACpC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,SAAS,IAAI,CAAC;YACzC;YACA,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC,EAAE,CAAC;YACnC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,UAAU,CAAC,EAAE,CAAC;YAC5C,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,YAAY,UAAU,CAAC,EAAE,CAAC;YACjD,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,aAAa,UAAU,CAAC,EAAE,CAAC;YAClD,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,UAAU,CAAC,EAAE,CAAC,QAAQ,QAAQ,GAAG;QAC9E;QACA,IAAI,CAAC;IACT;IAEA,gBAAyB;QACrB,OAAO,IAAI,CAAC,eAAe;IAC/B;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,YAAoC,QAAQ,EAAW;QACjF,IAAI,CAAC,KAAK,CAAC,KAAM,MAAM,IAAI,CAAC,SAAS,MAAM,IAAI,CAAC,UAAW,MAAM,MAAM,MAAM,MAAM,IAAI,KAAK,IAAI,GAC5F,OAAO;QAEX,IAAI,KAAK,IAAI,GAAG;QAChB,IAAI,KAAK,IAAI,GAAG;QAEhB,IAAI,MAAM;QAEV,IAAI,cAAc,aAAa;YAC3B,OAAO,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;YACpB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,IAAI;YACvB,QAAQ,wBAAwB;YAChC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;gBACjD,IAAI,IAAI,GACJ,QAAQ,UAAU,GAAG,GAAG,GAAG;gBAE/B,MAAM,cAAc,IAAI,CAAC,cAAc,CAAC,EAAE;gBAC1C,QAAQ,UAAU,aAAa,GAAG,GAAG,GAAG;gBACxC,YAAY,QAAQ;gBACpB,YAAY,SAAS;gBACrB,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,IAAI;gBAC5B,aAAa,UAAU,MAAM,GAAG;YACpC;QAEJ,OAAO,IAAI,cAAc,UAAU;YAC/B,OAAO,CAAA,GAAA,MAAC,EAAE;YACV,OAAO,CAAA,GAAA,MAAC,EAAE;YACV,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAC5C,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,GAAG,GAAG,MAAM;QAE5D,OACI,MAAM,IAAI,MAAM;QAGpB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QACd,OAAO;IACX;IAEA;;;KAGC,GACD,aAAc,CAMb,EAAQ;QAEL,MAAM,OAAO,KAAK,MAAM,EAAE,QAAQ,IAAI,CAAC,QAAQ,KAAK,MAAM,EAAE;QAC5D,MAAM,OAAO,KAAK,MAAM,EAAE,OAAO,IAAI,CAAC,SAAS,KAAK,MAAM,EAAE;QAC5D,MAAM,OAAO,KAAK,MAAM,EAAE;QAC1B,MAAM,OAAO,KAAK,MAAM,EAAE;QAE1B,IAAI,MAAM,SAAS,MAAM,SAAS,OAAO,KAAK,OAAO,GACjD,MAAM,IAAI,MAAM;QAGpB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;YACjD,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;YACzC,MAAM,cAAc,IAAI,CAAC,cAAc,CAAC,EAAE;YAC1C,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE;YAC9C,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO,UAAU,aAAa,GAAG;YAExC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,QAAQ;YAC/B,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,SAAS;YAEhC,SAAS;YACT,IAAI,MAAM,KAAK,EAAE,WAAW;gBACxB,SAAS,YAAY,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS,EAAE;gBAClD,SAAS,SAAS,GAAG,GAAG,MAAM;gBAC9B,SAAS,UAAU,MAAM,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC;YACpD;YACA,SAAS,UAAU,OAAO,MAAM;YAChC,SAAS;QACb;QACA,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;IAClB;IAEA;;;KAGC,GACD,SAAU,QAAiB,EAAkB;QACzC,IAAI,IAAI,CAAC,uBACL,OAAO;QAEX,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QAC1C,IAAI,CAAC,OAAO,WAAW,OACnB,MAAM,IAAI,MAAM;QAGpB,OAAO,YAAY;QACnB,OAAO,aAAa;QAEpB,IAAI,aAAa,WAAW;YACxB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,eAAe,OAAO,GAAG;YAClD,WAAW,KAAK,IAAI,GAAG,IAAI,CAAC,eAAe,SAAS;QACxD,OAAO;YACH,IAAI,CAAC,eAAe,OAAO,WAAW,GAAG,GAAG;YAC5C;QACJ;QAEA,OAAO,OAAO,CAAA,GAAA,cAAG,EAAE,kBAAkB,MAAO,CAAA,IAAI,CAAC,eAAe,SAAS,IAAI,CAAC,aAAY;QAC1F,IAAI,CAAC,QAAQ,MAAM;QACnB,IAAI,CAAC,aAAa,UAAU;QAC5B,IAAI,CAAC,QAAQ,MAAM;QACnB,IAAI,CAAC;QACL,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC,WAAW;aAAE;QAC1B;QACA,OAAO;IACX;IAEA,eAAgB,CAAS,EAAkB;QACvC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,EAAE,IAAI,IAAI,CAAC,uBAChC,OAAO;QAEX,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QAC1C,IAAI,CAAC,eAAe,OAAO,IAAI,GAAG,GAAG;QAErC,OAAO,OAAO,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,MAAM,CAAA,GAAA,cAAG,EAAE;QACvD,OAAO,YAAY,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC;QAC1C,OAAO,aAAa,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC;QAC3C,2EAA2E;QAC3E,2DAA2D;QAC3D,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,aAAa,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC,SAAS,GAAG;QAC3G,IAAI,CAAC,QAAQ,MAAM;QACnB,IAAI,CAAC,aAAa,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC;QAChD,IAAI,CAAC,QAAQ,MAAM;QAEnB,IAAI,CAAC;QAEL,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;aAAE;QACf;QACA,OAAO,IAAI;IACf;IAEA,gBAAiB,CAAS,EAAE,YAAsB,EAAmC;QACjF,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EACtB,OAAO,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE;QAExC,IAAI,cACA,OAAO;QAEX,MAAM,IAAI,MAAM,oBAAoB,IAAI,oBAAoB,IAAI,CAAC,eAAe,SAAS;IAC7F;IAEA,YAAa,CAAS,EAAkB;QACpC,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE;YACxB,IAAI,CAAC,eAAe,OAAO,GAAG;YAC9B,IAAI,CAAC;QACT,OACI,OAAO;QAEX,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;aAAE;QACf;QAEA,OAAO,KAAK,IAAI,GAAG,IAAI;IAC3B;IAEA,YAAa,CAAS,EAAE,IAAY,EAAW;QAC3C,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EACtB,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO;aAE9B,OAAO;QAGX,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAG;aAAK;QACrB;QAEA,OAAO;IACX;IAEA,aAAc,UAAkB,EAAE,OAAe,EAAQ;QACrD,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,EAChC;QAEJ,UAAU,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QAClC,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,UAAU;QAE1C,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY;aAAQ;QACjC;QAEA,IAAI,CAAC;IACT;IAEA,kBAAmB,UAAkB,EAAE,SAAkB,EAAQ;QAC7D,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW,EAC/B,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,YAAY;aAE5C,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE,WAAW,UAAU,CAAC;QAGnD,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY;aAAU;QACnC;IACJ;IAEA,UAAW,CAAS,EAAE,CAAS,EAAiB;QAC5C,IAAI,MAAM,GACN;QAEJ,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE;YACxB,MAAM,OAAO,IAAI,CAAC,cAAc,CAAC,EAAE;YACnC,IAAI,CAAC,eAAe,OAAO,GAAG;YAC9B,MAAM,cAAc,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,GAAG,IAAI,CAAC,eAAe;YACpE,IAAI,CAAC,eAAe,OAAO,aAAa,GAAG;YAC3C,IAAI,CAAC;YACL,IAAI,CAAC,QAAQ,KAAK;gBACd,MAAM;oBAAC;iBAAS;gBAChB,QAAQ;gBACR,QAAQ;oBAAC;oBAAG;iBAAE;YAClB;YACA,OAAO;QACX;IACJ;IAEA,YAAa,gBAAwB,EAAE,aAAqB,EAAE,UAAiC,EAAiB;QAC5G,IACI,CAAC,IAAI,CAAC,cAAc,CAAC,iBAAiB,IACtC,CAAC,IAAI,CAAC,cAAc,CAAC,cAAc,IACnC,qBAAqB,eAErB;QAEJ,iBAAiB;QACjB,IAAI,mBAAmB,eAAe;YAClC,MAAM,OAAO;YACb,mBAAmB;YACnB,gBAAgB;QACpB;QAEA,MAAM,aAAa,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC;QACtD,IAAI,eAAe,KAAK,YAAY;YAChC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB;YACxD,IAAI;YAEJ,IAAI,eAAe,YAAY;gBAE3B,CAAA,GAAA,MAAC,EAAE,4BAA4B,IAAI,CAAC,cAAc,CAAC,cAAc;gBACjE,IAAI,2BAA2B;gBAC/B,IAAI,cAAc;gBAClB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAE,UAAU,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,GAAG;YAEnG,OAAO;gBAEH,IAAI,YACA,IAAI,2BAA2B;gBAEnC,IAAI,cAAc;gBAClB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAE,UAAU,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,GAAG;YAEnG;YAEA,IAAI;YAEJ,cAAc,6BAA6B;QAC/C;QACA,IAAI,CAAC;QACL,IAAI,CAAC,QAAQ,MAAM;QACnB,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,QAAQ,MAAM;QACnB,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAkB;gBAAe;aAAW;QACzD;QAEA,OAAO;IACX;IAEA,WAA4B;QACxB,IAAI,IAAI,CAAC,eAAe,WAAW,GAC/B,OAAO;QAGX,2BAA2B;QAC3B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE;QACzC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;YACjD,MAAM,UAAU,IAAI,CAAC,cAAc,CAAC,EAAE;YACtC,IAAI,CAAC,QAAQ,aAAa,QAAQ,YAAY,GAC1C;YAGJ,IAAI;YACJ,IAAI,2BAA2B,QAAQ;YACvC,IAAI,cAAc,QAAQ;YAC1B,IAAI,UAAU,SAAS,GAAG;YAC1B,IAAI;QACR;QAEA,IAAI,CAAC,QAAQ,MAAM;QAEnB,sBAAsB;QACtB,IAAK,IAAI,IAAI,IAAI,CAAC,eAAe,SAAS,GAAG,IAAI,GAAG,IAChD,IAAI,CAAC,YAAY;QAGrB,kCAAkC;QAClC,IAAI,CAAC,YAAY,GAAG,CAAA,GAAA,cAAG,EAAE,kBAAkB;QAE3C,IAAI,CAAC,QAAQ,MAAM;QAEnB,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ,EAAE;QACd;QAEA,OAAO;IACX;IAEA,OAAQ,GAAW,EAAQ;QACvB,MAAO,MAAM,EACT,OAAO;QAEX,OAAO;QACP,IAAI,MAAM,MAAM,KAAK,QAAQ,GACzB;QAEJ,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE;QAChB,IAAI,QAAQ,KAAK,QAAQ,KAAK;YAC1B,KAAK,QAAQ,IAAI,CAAC;YAClB,KAAK,SAAS,IAAI,CAAC;QACvB,OAAO,IAAI,QAAQ,MAAM,QAAQ,KAAK;YAClC,KAAK,QAAS,IAAI,CAAC;YACnB,KAAK,SAAU,IAAI,CAAC;QACxB;QACA,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;QACnB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;YACjD,IAAI,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK;YACrC,IAAI;YACJ,IAAI,UAAU,KAAK,QAAQ,GAAG,KAAK,SAAS;YAC5C,IAAI,OAAO,MAAM,KAAK,KAAK;YAC3B,IAAI,QAAQ,KACR,IAAI,UAAU,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,CAAC,KAAK,QAAQ,GAAG,CAAC,KAAK,SAAS;iBACnE,IAAI,QAAQ,MAAM,QAAQ,KAC7B,IAAI,UAAU,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,CAAC,KAAK,SAAS,GAAG,CAAC,KAAK,QAAQ;YAE1E,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,QAAQ,KAAK;YACpC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,SAAS,KAAK;YACrC,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC;YACpG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,MAAM,GAAG;YAClD,IAAI;QACR;QACA,IAAI,CAAC,QAAQ,KAAK;QAClB,IAAI,CAAC,SAAS,KAAK;IACvB;IAEA,KAAM,YAAqB,EAAE,UAAmB,EAAE,UAAmB,EAAQ;QACzE,IAAI,CAAC,gBAAgB,CAAC,YAClB;QAGJ,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QACxC,KAAK,QAAQ,IAAI,CAAC;QAClB,KAAK,SAAS,IAAI,CAAC;QACnB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,IAAI;QAEvB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;YAEjD,IAAK,AAAC,CAAA,cAAc,eAAe,CAAA,KAAM,MAAM,YAC3C;YAGJ,QAAQ;YACR,QAAQ,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK;YACzC,QAAQ,UAAU,KAAK,QAAQ,GAAG,KAAK,SAAS;YAChD,QAAQ,MAAO,eAAe,KAAK,GAAK,aAAa,KAAK;YAC1D,QAAQ,UAAU,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,CAAC,KAAK,QAAQ,GAAG,CAAC,KAAK,SAAS;YAC1E,QAAQ;YAER,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC;YACpG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,UAAU,MAAM,GAAG;QACtD;IACJ;IAEA,UAAW,UAAkB,EAAE,QAAc,EAAE,kBAA2B,EAAQ;QAC9E,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW;QAClD,IAAI;QACJ,IAAI,oBACA,IAAI,2BAA2B;QAEnC,IAAI,YAAY,UAAU,SAAS,IAAI,MAAM,SAAS,IAAI,MAAM,SAAS,IAAI;QAC7E,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC;QAC1F,IAAI;QAEJ,0FAA0F;QAC1F,gCAAgC;QAChC,IAAI;QACJ,IAAI,YAAY;QAChB,IAAI,SAAS,YAAY,YAAY,GAAG;QACxC,IAAI;QAEJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;SA4BC,GAED,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY;gBAAU;aAAmB;QACtD;IACJ;IAEA,UACI,UAAkB,EAClB,CAAS,EACT,CAAS,EACT,GAAgB,EAChB,OAAe,EACf,SAAiB,EACjB,SAAwB,EACxB,IAAY,EACZ,YAAqB,EACjB;QACJ,IAAI,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,UAAU,YAAY,GACrE;QAEJ,YAAY,KAAK,MAAM;QAEvB,IAAI,CAAE;YAAC;YAAS;YAAW;SAAM,CAAC,SAAS,YACvC,MAAM,IAAI,MAAM;QAGpB,IAAI;QACJ,IAAI;QACJ,IAAI;QAEJ,IAAI,cAAc,OAAO;YAErB,MAAM,YAAY,IAAI,CAAC,eAAe,WAAW,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,GAAG,IAAI,CAAC,kBAAkB;YACrG,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI;YACtB,MAAM,eAAe,OAAO,aAAa,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;YAChE,MAAM,UAAU,aAAa;YAC7B,SAAS,CAAA,GAAA,wBAAY,EAAE,SAAS,IAAI,CAAC,OAAO,IAAI,CAAC,QAAQ,GAAG,GAAG,WAAW,KAAK,MAAM,OAAO;YAE5F,YAAY,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW;YAClD,kBAAkB,UAAU,aAAa,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;QAEpE,OAAO;YACH,MAAM,WAAW,cAAc,UAAU,aAAa,IAAI;YAE1D,IAAI,YAAY,IAAI,CAAC,eAAe,QAChC;YAGJ,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,SAAS;YACnD,MAAM,eAAe,OAAO,aAAa,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;YAChE,MAAM,UAAU,aAAa;YAC7B,SAAS,CAAA,GAAA,wBAAY,EAAE,SAAS,IAAI,CAAC,OAAO,IAAI,CAAC,QAAQ,GAAG,GAAG,WAAW,KAAK,MAAM,OAAO;YAE5F,YAAY,eAAe,WAAW,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW;YACrF,kBAAkB,eAAe,WAAW,eAAe,UAAU,aAAa,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;QAE7G;QAEA,MAAM,aAAa,gBAAgB;QACnC,IAAI;YACA,IAAI,YAAY,GAAG;gBACf,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,IAC1C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,KAAK;oBACxB,UAAU,CAAC,IAAI,EAAE,GAAG,IAAI;oBACxB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG,IAAI;oBAC5B,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG,IAAI;oBAC5B,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;gBAC5B;YAER,OAAO;gBACH,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,IAC1C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,KAAK;oBACxB,UAAU,CAAC,IAAI,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,CAAC,IAAI,EAAE,EAAE,IAAI,GAAG;oBACrD,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,CAAC,IAAI,IAAI,EAAE,EAAE,IAAI,GAAG;oBAC7D,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,CAAC,IAAI,IAAI,EAAE,EAAE,IAAI,GAAG;oBAC7D,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,CAAC,IAAI,IAAI,EAAE,EAAE,KAAK;gBAC/D;YAER;eAEA,IAAI,YAAY,GAAG;YACf,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,IAC1C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,KACnB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG;QAGpC,OAAO;YACH,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,IAC1C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,KACnB,UAAU,CAAC,IAAI,IAAI,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,CAAC,IAAI,IAAI,EAAE,EAAE,GAAG;QAGrE;QAEJ,UAAU,aAAa,iBAAiB,GAAG;QAG3C,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY;aAAgB;QACzC;IACJ;IAEA;;;;KAIC,GACD,UAAW,UAAkB,EAAE,QAA0B,EAAQ;QAC7D,IAAI,SAAS,OAAO,SAAS,MAAM,SAAS,OAAO,SAAS,IACxD;QAEJ,CAAA,GAAA,oBAAQ,EAAE,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW,GAAG;QACnD,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY,CAAA,GAAA,MAAC,EAAE,QAAQ;aAAU;QAC9C;IACJ;IAEA,aAAc,UAAkB,EAAE,WAAsB,EAAQ;QAC5D,CAAA,GAAA,0BAAW,EAAE,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW,GAAG;QACtD,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY,CAAA,GAAA,MAAC,EAAE,QAAQ;aAAa;QACjD;IACJ;IAEA,KAAM,UAAkB,EAAE,CAAmB,EAAQ;QACjD,CAAA,GAAA,sBAAS,EAAE,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,CAAA,GAAA,MAAC,EAAE,QAAQ;QACvD,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY,CAAA,GAAA,MAAC,EAAE,QAAQ;aAAG;QACvC;IACJ;IAEA,aAAc,UAAkB,EAAE,SAAoB,EAAQ;QAC1D,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW;QAClD,IAAI,aAAa,WAAW,GAAG;QAC/B,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY;aAAU;QACnC;IACJ;IAEA,WAAY,UAAkB,EAAQ;QAClC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW;QAClD,IAAI;QACJ,IAAI,UAAU,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC;QAC3F,IAAI;QAEJ,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;aAAW;QACxB;IACJ;IAEA,YAMI;QACA,OAAO,IAAI,CAAC,eAAe,IAAI,CAAA;YAC3B,OAAO;gBACH,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI;gBAChB,WAAW,KAAK;gBAChB,SAAS,KAAK;gBACd,MAAM,KAAK;gBACX,YAAY,KAAK;YACrB;QACJ;IACJ;IAEA,gBAMI;QACA,OAAO,IAAI,CAAC,eAAe,IAAI,CAAA;YAC3B,OAAO;gBACH,QAAQ;gBACR,WAAW,KAAK;gBAChB,SAAS,KAAK;gBACd,MAAM,KAAK;gBACX,YAAY,KAAK;YACrB;QACJ;IACJ;IAEA,cAAe,SAA4B,EAAE,YAAsB,EAAiB;QAChF,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;YACjD,IAAI,IAAI,CAAC,cAAc,CAAC,EAAE,KAAK,WAC3B,OAAO;QAEf;QACA,IAAI,CAAC,cACD,MAAM,IAAI,MAAM,yBAAyB,IAAI,CAAC,eAAe,SAAS;QAE1E,OAAO;IACX;IAEA,SAAU,KAAa,EAAE,YAAsB,EAAyB;QACpE,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,EAC1B,OAAO;YACH,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM;YAC1C,WAAW,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;YACtC,SAAS,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;YACpC,MAAM,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;YACjC,IAAI;QACR;QAEJ,IAAI,CAAC,cACD,MAAM,IAAI,MAAM,oBAAoB,QAAQ,oBAAoB,IAAI,CAAC,eAAe,SAAS;QAEjG,OAAO;IACX;IAEA,WAAY,CAAS,EAAE,CAAS,EAAQ;QACpC,IAAI,KAAK,MAAM;QACf,IAAI,KAAK,MAAM;QACf,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACxB,IAAI;QACJ,IAAI,wBAAwB;QAC5B,IAAI,UAAU,GAAG,GAAG,GAAG;QACvB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAAK;YACjD,MAAM,QAAQ,IAAI,CAAC,cAAc,CAAC,EAAE;YACpC,IAAI,CAAC,MAAM,aAAa,MAAM,YAAY,GACtC;YAEJ,IAAI,cAAc,MAAM;YACxB,IAAI,2BAA2B,MAAM;YACrC,IAAI,UAAU,OAAO,CAAC,GAAG,CAAC;QAC9B;QACA,IAAI;QACJ,MAAM,SAAS,IAAI,aAAa,GAAG,GAAG,GAAG;QACzC,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO,IAAI,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,EAAE;IACpE;IAEA,kBAAmB,MAAc,EAAqB;QAClD,OAAO,CAAA,GAAA,wBAAU,EAAE,IAAI,CAAC,cAAc;IAC1C;IAEA,aAA0B;QACtB,OAAO;YACH,OAAO,IAAI,CAAC;YACZ,QAAQ,IAAI,CAAC;YACb,QAAQ,IAAI,CAAC,eAAe,IAAI,CAAA;gBAC5B,OAAO;oBACH,MAAM,MAAM;oBACZ,WAAW,MAAM;oBACjB,SAAS,MAAM;oBACf,YAAY,MAAM;oBAClB,OAAO;gBACX;YACJ;QACJ;IACJ;IAEA,kBAAmB,IAAgB,EAAQ;QACvC,IAAI,IAAI,CAAC,kBAAkB,SAAS,OAChC;QAEJ,IAAI,CAAC,kBAAkB,KAAK;IAChC;IAEA,qBAAsB,IAAgB,EAAQ;QAC1C,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,kBAAkB,QAAQ,IAC/C,IAAI,IAAI,CAAC,iBAAiB,CAAC,EAAE,KAAK,MAAM;YACpC,IAAI,CAAC,kBAAkB,OAAO,GAAG;YACjC;QACJ;IAER;IAEA,WAAY,UAAkB,EAAE,UAAoB,EAAQ;QACxD,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,EAChC,MAAM,IAAI,MAAM;QAEpB,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,aAAa;QAE7C,IAAI,CAAC,QAAQ,KAAK;YACd,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBAAC;gBAAY,KAAK;aAAW;QACzC;IACJ;IAEA;;;;;;KAMC,GACD,aACI,UAAkB,EAClB,YAEC,EACG;QACJ,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,EAChC,MAAM,IAAI,MAAM;QAEpB,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,eAAe,CAAA,GAAA,qBAAc,EAAE;IACnE;IAEA,UAAiB;QACb,IAAI,IAAI,CAAC,aACL;QAEJ,IAAI,CAAC,eAAe,QAAQ,CAAA;YACxB,CAAA,GAAA,MAAC,EAAE,WAAW;QAClB;QACA,IAAI,CAAC,iBAAiB,EAAE;QACxB,IAAI,CAAC,cAAc;IACvB;AAEJ;;;ACziCA;;;;CAIC,GAED;;;;;;;;;CASC;;AAsOD;;;;;;;;;;;CAWC,GACD,mDAAgB;AAjPhB,SAAS,SAAU,IAAgB,EAAE,KAAa,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IAC9F,IAAK,IAAI,IAAI,IAAI,KAAK,IAAI,IACtB,IAAK,IAAI,IAAI,IAAI,KAAK,IAAI,IAAK;QAC3B,IAAI,IAAI,CAAC,IAAI,QAAQ,EAAE,KAAK,KACxB;QAEJ,IAAI,CAAC,IAAI,QAAQ,EAAE,GAAG;IAC1B;AAER;AAEA,IAAI,IAAI;AAER;;;;;;;;;CASC,GACD,SAAS,UAAW,KAAa,EAAE,MAAc,EAAE,CAAS,EAAE,EAAU,EAAE,EAAU;IAChF,KAAK,IAAI,QAAQ;IACjB,KAAK,KAAK,MAAM,IAAI,SAAS;IAE7B,IAAI,KAAK,KAAK,KAAK,KAAK,MAAM,SAAS,MAAM,QACzC,OAAO;IAGX,OAAO,KAAK,QAAQ;AACxB;AAEA;;;;;;;;;;;;CAYC,GACD,SAAS,YACL,MAAyB,EACzB,SAAqB,EACrB,KAAa,EACb,MAAc,EACd,QAA0C,EAC1C,SAAiB,EACjB,CAAqB;IAErB,IAAI,MAAM,aAAa,SAAS,CAAC,EAAE,KAAK,KACpC,OAAO;IAGX,IACI,MAAM,CAAC,IAAI,EAAE,KAAK,QAAQ,CAAC,EAAE,IAC7B,MAAM,CAAC,IAAI,IAAI,EAAE,KAAK,QAAQ,CAAC,EAAE,IACjC,MAAM,CAAC,IAAI,IAAI,EAAE,KAAK,QAAQ,CAAC,EAAE,IACjC,MAAM,CAAC,IAAI,IAAI,EAAE,KAAK,QAAQ,CAAC,EAAE,EACnC;QACE,SAAS,CAAC,EAAE,GAAG;QACf,OAAO;IACX;IAEA,IACI,YAAY,KACZ,KAAK,IAAI,MAAM,CAAC,IAAI,EAAE,GAAG,QAAQ,CAAC,EAAE,KAAK,aACzC,KAAK,IAAI,MAAM,CAAC,IAAI,IAAI,EAAE,GAAG,QAAQ,CAAC,EAAE,KAAK,aAC7C,KAAK,IAAI,MAAM,CAAC,IAAI,IAAI,EAAE,GAAG,QAAQ,CAAC,EAAE,KAAK,aAC7C,KAAK,IAAI,MAAM,CAAC,IAAI,IAAI,EAAE,GAAG,QAAQ,CAAC,EAAE,KAAK,WAC/C;QACE,SAAS,CAAC,EAAE,GAAG;QACf,OAAO;IACX;IAEA,OAAO;AACX;AAGA;;;;;;;;;;;CAWC,GACD,SAAS,UACL,MAAyB,EACzB,SAAqB,EACrB,KAAa,EACb,MAAc,EACd,EAAU,EACV,EAAU,EACV,SAAiB,EACjB,IAAY,EACZ,YAAqB;IAGrB,MAAM,WAA6C;QAC/C,MAAM,CAAC,AAAC,CAAA,KAAK,QAAQ,EAAC,IAAK,EAAE;QAC7B,MAAM,CAAC,AAAC,CAAA,KAAK,QAAQ,EAAC,IAAK,IAAI,EAAE;QACjC,MAAM,CAAC,AAAC,CAAA,KAAK,QAAQ,EAAC,IAAK,IAAI,EAAE;QACjC,MAAM,CAAC,AAAC,CAAA,KAAK,QAAQ,EAAC,IAAK,IAAI,EAAE;KACpC;IAED,IAAI,cAAc;QACd,MAAM,IAAc,EAAE;QACtB,EAAE,KAAK,KAAK,QAAQ;QACpB,SAAS,CAAC,KAAK,QAAQ,GAAG,GAAG;QAE7B,IAAI,GAAW;QACf,MAAO,EAAE,OAAQ;YACb,IAAI,EAAE,OAAiB,kCAAkC;YAEzD,8BAA8B;YAC9B,IAAI,UAAU,OAAO,QAAQ,GAAG,IAAI,IAAI,OAAO;YAC/C,+EAA+E;YAC/E,YAAY,QAAQ,WAAW,OAAO,QAAQ,UAAU,WAAW,MAAM,EAAE,KAAK;YAEhF,IAAI,UAAU,OAAO,QAAQ,GAAG,GAAG,IAAI,QAAQ;YAC/C,YAAY,QAAQ,WAAW,OAAO,QAAQ,UAAU,WAAW,MAAM,EAAE,KAAK;YAEhF,IAAI,UAAU,OAAO,QAAQ,GAAG,GAAG,KAAK,KAAK;YAC7C,YAAY,QAAQ,WAAW,OAAO,QAAQ,UAAU,WAAW,MAAM,EAAE,KAAK;YAEhF,IAAI,UAAU,OAAO,QAAQ,GAAG,GAAG,IAAI,SAAS;YAChD,YAAY,QAAQ,WAAW,OAAO,QAAQ,UAAU,WAAW,MAAM,EAAE,KAAK;QACpF;IACJ,OACI,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAChC,YAAY,QAAQ,WAAW,OAAO,QAAQ,UAAU,WAAW;IAI3E,OAAO;IACP,IAAI,SAAS,GACT;IAGJ,oDAAoD;IACpD,8EAA8E;IAC9E,mEAAmE;IACnE,4CAA4C;IAC5C,IAAI,IAAI,IAAI,IAAI;IAChB,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,uCAAuC;IACvE,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,IACvB,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC7B,IAAI,SAAS,CAAC,IAAI,QAAQ,EAAE,KAAK,KAC7B;QAGJ,sBAAsB;QACtB,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QAEL,IAAI,SAAS,CAAC,AAAC,IAAK,QAAQ,IAAI,EAAE,KAAK;QACvC,KAAK,SAAS,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,QAAQ,IAAI,EAAE,KAAK;QAC5C,IAAI,SAAS,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,QAAQ,EAAE,KAAK;QACvC,KAAK,SAAS,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,QAAQ,IAAI,EAAE,KAAK;QAC5C,IAAI,SAAS,CAAC,AAAC,IAAK,QAAQ,IAAI,EAAE,KAAK;QACvC,KAAK,SAAS,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,QAAQ,IAAI,EAAE,KAAK;QAC5C,IAAI,SAAS,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,QAAQ,EAAE,KAAK;QACvC,KAAK,SAAS,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,QAAQ,IAAI,EAAE,KAAK;QAE5C,IAAI,GACA,KAAK,IAAI;QAEb,IAAI,KAAK,MAAM,GAAG;YACd,KAAK,IAAI;YACT,KAAK,IAAI;QACb;QACA,IAAI,GACA,KAAK,KAAK,IAAI,IAAI,IAAI;QAE1B,IAAI,KAAK,MAAM,GAAG;YACd,KAAK,KAAK,IAAI,IAAI,IAAI;YACtB,KAAK,IAAI;QACb;QACA,IAAI,GACA,KAAK,KAAK,IAAI,IAAI,IAAI;QAE1B,IAAI,KAAK,MAAM,GAAG;YACd,KAAK,KAAK,IAAI,IAAI,IAAI;YACtB,KAAK,KAAK,IAAI,IAAI,IAAI;QAC1B;QACA,IAAI,GACA,KAAK,KAAK,IAAI,IAAI,IAAI;QAE1B,IAAI,KAAK,MAAM,GAAG;YACd,KAAK,KAAK,IAAI,IAAI,IAAI;YACtB,KAAK,KAAK,IAAI,IAAI,IAAI;QAC1B;QAEA,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAC9C;QAGJ,SACI,WACA,OACA,KAAK,IAAI,GAAG,KACZ,KAAK,IAAI,GAAG,KACZ,KAAK,IAAI,QAAQ,GAAG,KACpB,KAAK,IAAI,SAAS,GAAG;IAE7B;IAEJ,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAChC,IAAI,SAAS,CAAC,EAAE,KAAK,KACjB,SAAS,CAAC,EAAE,GAAG;AAI3B;AAeO,SAAS,cACZ,OAA0B,EAC1B,KAAa,EACb,MAAc,EACd,CAAS,EACT,CAAS,EACT,SAAiB,EACjB,IAAY,EACZ,YAAqB;IAIrB,IAAI,KAAK,MAAM;IACf,IAAI,KAAK,MAAM;IAEf,MAAM,YAAY,IAAI,WAAW,IAAI,YAAY,QAAQ;IAEzD,UAAU,SAAS,WAAW,OAAO,QAAQ,GAAG,GAAG,WAAW,MAAM;IAEpE,OAAO;QACH,MAAM;IACV;AACJ;;;;;ACrRA;;;;CAIC,GACD,+CAAa;AA+Bb;;CAEC,GACD,+CAAgB;AA1ChB;AAQO,MAAM;IAOT,mBAAmB;IACnB,YACI,CAEC,CACH;aATM,QAAgB;aAChB,QAAgB;aAChB,eAAuB;QAQ3B,IAAI,CAAC,UAAU,EAAE;IACrB;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,QAAgB,EAAQ;QAClD,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,eAAe;IACxB;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAQ;QAChC,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,GAAG,GAAG,IAAI,CAAC;IAC3D;IAEA,KAAM,CAAS,EAAE,CAAS,EAAQ;QAC9B,IAAI,CAAC,QAAQ,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,GAAG,GAAG,IAAI,CAAC;IAC1D;AACJ;AAKO,SAAS,UACZ,GAA6B,EAC7B,QAA0B;IAE1B,WAAW;QACP,WAAW;QACX,UAAU;QACV,YAAY;QACZ,SAAS;QACT,UAAU;QACV,aAAa;QAEb,GAAG,CAAA,GAAA,MAAC,EAAE,QAAQ,SAAS;IAC3B;IAEA,IAAI;QAAC;QAAQ;QAAW;KAAO,CAAC,SAAS,SAAS,OAAO;QACrD,IAAI,SAAS,aAAa,WACtB,MAAM,IAAI,MAAM;QAGpB,MAAM,YAAY,SAAS,cAAc,YAAY,KAAK,KAAK,MAAM,SAAS;QAC9E,MAAM,WAAW,SAAS,WAAW,MAAM,KAAK;QAEhD,qBAAqB;QACrB,IAAI,CAAC,SAAS,YAAY,SAAS,YAAY,aAAa,SAAS,cAAc,WAC/E,MAAM,IAAI,MAAM;QAEpB,MAAM,WAAiB,SAAS,WAAW;YAAC,GAAG;YAAK,GAAG;YAAK,GAAG;QAAG,IAAK,SAAS,UAAU,SAAS,UAAU,SAAS;QAGtH,sBAAsB;QACtB,IAAI;QACJ,IAAI,SAAS,SACT,IAAI,cAAc,SAAS;QAE/B,IAAI,SAAS,UACT,IAAI,2BAA2B;QAEnC,IAAI,SAAS,aACT,IAAI,2BAA2B;QAEnC,IAAI,OAAO,CAAC,SAAS;QACrB,IAAI,SAAS,SACT,IAAI,YAAY,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS;aACxC,IAAI,SAAS,WAAW;YAC3B,IAAI,cAAc,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS;YAC7C,IAAI,YAAY;QACpB;QAEA,IAAI,KAAK,SAAS;QAClB,IAAI,KAAK,SAAS;QAClB,IAAI,KAAK,SAAS;QAClB,IAAI,KAAK,SAAS;QAElB,yBAAyB;QACzB,IAAI,SAAS,aAAa;YACtB,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,IAAI,SAAS,WAAW,KAAK,KAAK;YAC3D,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,IAAI,SAAS,WAAW,KAAK,KAAK;YAE3D,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,iBAAiB,IAAI,MAAM;YAChD,MAAM,mBAAmB,KAAK,MAAM,YAAY,MAAM;YACtD,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,aAAa;gBAAC,GAAG;gBAAI,GAAG;YAAE,GAAG;gBAAC,GAAG;gBAAI,GAAG;YAAE,GAAG,mBAAmB;YACnF,KAAK,QAAQ;YACb,KAAK,QAAQ;YAEb,gEAAgE;YAChE,IAAI,AAAC,CAAA,WAAW,gBAAe,IAAK,OAAO;gBACvC,IAAI,KAAK,MAAM,AAAC,CAAA,WAAW,gBAAe,IAAK,MAAM,MAAM,GACvD,KAAK;qBAEL,KAAK;;QAGjB;QAEA,IAAI,IAAI;QACR,IAAI,IAAI;QACR,IAAI,KAAK,KAAK;QACd,IAAI,KAAK,KAAK;QAEd,oBAAoB;QACpB,IAAI,SAAS,SAAS,UAAU,SAAS,cAAc;YACnD,IAAI,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,SAAS,IAAI,SAAS,IAAI,SAAS,WAAW,KAAK,KAAK;YAC3E,IAAI,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,SAAS,IAAI,SAAS,IAAI,SAAS,WAAW,KAAK,KAAK;YAE3E,MAAM,KAAK,GAAG;YACd,MAAM,KAAK,GAAG;YACd,IAAI,MAAM,GAAG,IAAI,GAAG;YACpB,IAAI,MAAM,GAAG,IAAI,GAAG;YAEpB,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,MACzB,MAAM,KAAK,IAAI,OAAQ,CAAA,MAAM,IAAI,KAAK,CAAA;iBAEtC,MAAM,KAAK,IAAI,OAAQ,CAAA,MAAM,IAAI,KAAK,CAAA;YAE1C,GAAG,IAAI,KAAK;YACZ,GAAG,IAAI,KAAK;YAEZ,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,GAAG,GAAG,CAAC,SAAS,WAAW,KAAK,KAAK;YAC1D,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,GAAG,GAAG,CAAC,SAAS,WAAW,KAAK,KAAK;YAE1D,KAAK,GAAG;YACR,KAAK,GAAG;YACR,KAAK,GAAG;YACR,KAAK,GAAG;YAER,IAAI;YACJ,IAAI;YACJ,KAAK,KAAK;YACV,KAAK,KAAK;QACd;QAEA,oBAAoB;QACpB,IAAI,SAAS,YAAY;YACrB,KAAK;YACL,KAAK;YACL,MAAM;YACN,MAAM;YAEN,KAAK;YACL,KAAK;YACL,KAAK,IAAI;YACT,KAAK,IAAI;QACb;QAEA,IAAI;QACJ,IAAI;QACJ,IAAI,SAAS,SAAS,QAAQ;YAE1B,UAAU;YACV,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YAEvB,UAAU;YACV,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YAEvB,IAAI,YAAY,MAAM,GAAG;gBAErB,IAAI,QAAQ,KAAK;oBACb,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;oBACA,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;oBAEA,IAAI,MAAM,KACN,GAAG,KAAK;yBAER,GAAG,KAAK;gBAEhB,OAAO,IAAI,QAAQ,KAAK;oBACpB,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;oBACA,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;oBAEA,IAAI,MAAM,KACN,GAAG,KAAK;yBAER,GAAG,KAAK;gBAEhB,OAAO;oBACH,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;oBACA,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;gBACJ;YAEJ,OAAO;gBACH,KAAK;oBACD,GAAG;oBACH,GAAG;gBACP;gBACA,KAAK;oBACD,GAAG;oBACH,GAAG;gBACP;gBACA,IAAI,QAAQ,KAAK;oBACb,IAAI,MAAM,KACN,GAAG,KAAK;yBAER,GAAG,KAAK;oBAEZ,GAAG,KAAK;oBACR,GAAG,KAAK;gBACZ,OAAO,IAAI,QAAQ,KAAK;oBACpB,IAAI,MAAM,KACN,GAAG,KAAK;yBAER,GAAG,KAAK;oBAEZ,GAAG,KAAK;oBACR,GAAG,KAAK;gBACZ,OAAO;oBACH,GAAG,IAAI;oBACP,GAAG,IAAI;oBACP,GAAG,IAAI;oBACP,GAAG,IAAI;gBACX;YACJ;YAEA,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,GAAG,GAAG,SAAS,WAAW,KAAK,KAAK;YACzD,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,GAAG,GAAG,SAAS,WAAW,KAAK,KAAK;YAEzD,IAAI;YACJ,IAAI,OAAO,GAAG,GAAG,GAAG;YACpB,IAAI,OAAO,GAAG,GAAG,GAAG;YACpB,IAAI;QAER,OAAO,IAAI,SAAS,SAAS,QAAQ;YAEjC,UAAU;YACV,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YACvB,MAAM,MAAM,KAAK,MAAM;YAEvB,IAAI,WAAW,OAAO,GAAG;gBACrB,IAAI,SAAS,SAAS;oBAClB,IAAI,KAAK,MAAM,GACX,MAAM;oBAEV,IAAI,KAAK,MAAM,GACX,MAAM;oBAEV,IAAI,KAAK,MAAM,GACX,MAAM;oBAEV,IAAI,KAAK,MAAM,GACX,MAAM;oBAGV,KAAK;wBACD,GAAG,KAAK,KAAK,MAAM;wBACnB,GAAG,KAAK,KAAK,MAAM;oBACvB;oBACA,KAAK;wBACD,GAAG,KAAK,KAAK,AAAC,CAAA,KAAK,KAAK,KAAK,EAAC,IAAK,GAAG;wBACtC,GAAG,KAAK,KAAK,AAAC,CAAA,KAAK,KAAK,KAAK,EAAC,IAAK,GAAG;oBAC1C;oBACA,GAAG,IAAI,GAAG,IAAI,GAAG;oBACjB,GAAG,IAAI,GAAG,IAAI,GAAG;gBAErB,OACI,IAAI,YAAY,MAAM,GAAG;oBACrB,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;oBACA,KAAK;wBACD,GAAG;wBACH,GAAG;oBACP;gBACJ,OAAO;oBACH,KAAK;wBACD,GAAG,MAAM;wBACT,GAAG,MAAM;oBACb;oBACA,KAAK;wBACD,GAAG,MAAM;wBACT,GAAG,MAAM;oBACb;gBACJ;YAER,OAAO;gBACH,KAAK;oBACD,GAAG;oBACH,GAAG;gBACP;gBACA,KAAK;oBACD,GAAG;oBACH,GAAG;gBACP;YACJ;YAEA,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,GAAG,GAAG,SAAS,WAAW,KAAK,KAAK;YACzD,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,GAAG,GAAG,SAAS,WAAW,KAAK,KAAK;YACzD,GAAG,IAAI,GAAG,IAAI,GAAG;YACjB,GAAG,IAAI,GAAG,IAAI,GAAG;YAEjB,IAAI,SAAS,SACT,IAAI,SAAS,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG;iBAElC,IAAI,WAAW,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG;QAG5C,OAAO;YACH,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,IAAI,SAAS,WAAW,KAAK,KAAK;YACrD,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,IAAI,SAAS,WAAW,KAAK,KAAK;YACrD,IAAI,GAAG;YACP,IAAI,GAAG;YACP,KAAK,GAAG,IAAI,GAAG;YACf,KAAK,GAAG,IAAI,GAAG;YAEf,IAAI;YACJ,IAAI,QAAQ,IAAI,KAAK,GAAG,IAAI,KAAK,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,GAAG,GAAG,KAAK,KAAK;YACxF,IAAI,SAAS,SACT,IAAI;iBAEJ,IAAI;QAEZ;QAGA,IAAI;IAER,OACI,MAAM,IAAI,MAAM;AAExB;;;;;ACpTA;;;;;;CAMC,GACD,gDAAgB;AAlEhB;AA6BA,SAAS,iBAAkB,OAAoB,EAAE,KAAkB;IAC/D,8BAA8B;IAC9B,MAAM,SAAS,QAAQ,yBAAyB,QAAQ;IACxD,MAAM,UAAU,QAAQ,0BAA0B,QAAQ;IAE1D,IAAI,UAAU,QACV,OAAO;QACH,GAAG;QACH,GAAG,CAAC;QACJ,OAAO,QAAQ;QACf,QAAQ,SAAS;IACrB;IAEJ,IAAI,UAAU,SACV,OAAO;QACH,GAAG,CAAC,QAAQ;QACZ,GAAG,CAAC;QACJ,OAAO,QAAQ;QACf,QAAQ,SAAS;IACrB;IAEJ,SAAS;IACT,OAAO;QACH,GAAG,CAAC,QAAQ,QAAQ;QACpB,GAAG,CAAC;QACJ,OAAO,QAAQ;QACf,QAAQ,SAAS;IACrB;AACJ;AASO,SAAS,WAAY,MAAyB,EAAE,CAAmB;IAEtE,IAAI,CAAA,GAAA,MAAC,EAAE,QAAQ;IAEf,gBAAgB;IAChB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;IACnB,IAAI;IACJ,IAAI,YAAY,EAAE;IAClB,IAAI,gBAAgB,EAAE,gBAAgB,EAAE,gBAAgB,OAAO;IAE/D,OAAO;IACP,MAAM,UAAU;QAAC,EAAE,OAAO,QAAS,CAAA,EAAE,OAAO,EAAE,OAAO,YAAW;KAAG;IACnE,IAAI,EAAE,QACF,QAAQ,QAAQ;IAEpB,IAAI,EAAE,UACF,QAAQ,QAAQ;IAEpB,IAAI,OAAO,QAAQ,KAAK;IAExB,OAAO;IACP,IAAI,YAAY,EAAE,OAAO,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU,EAAE,KAAK,SAAS;IAErE,SAAS;IACT,IAAI,cAAc,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU,EAAE,OAAO,SAAS;IAC3E,IAAI,EAAE,QAAQ;QACV,IAAI,YAAY,EAAE,OAAO;QACzB,IAAI,WAAW;IACnB;IAEA,IAAI,UAAU,EAAE,GAAG,EAAE;IACrB,IAAI,OAAO,CAAC,EAAE;IAGd,MAAM,QAAQ,EAAE,KAAK,MAAM,MAAM,IAAI,CAAA,OAAQ,KAAK,WAAW,KAAM;IAEnE,SAAS;IACT,MAAM,SAAkB;QACpB,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IACA;QACI,IAAI,UAAU;QACd,MAAM,QAAQ,CAAC,MAAM;YACjB,MAAM,UAAU,IAAI,YAAY;YAChC,MAAM,IAAI;YACV,MAAM,IAAK,EAAE,OAAQ,CAAA,EAAE,cAAc,CAAA,IAAK;YAC1C,MAAM,QAAQ,iBAAiB,SAAS,EAAE;YAC1C,IAAI,SAAS;gBACT,UAAU;gBACV,OAAO,KAAK,IAAI,MAAM;gBACtB,OAAO,KAAK,IAAI,MAAM;gBACtB,OAAO,KAAK,IAAI,MAAM,IAAI,MAAM;gBAChC,OAAO,KAAK,IAAI,MAAM,IAAI,MAAM;YACpC,OAAO;gBACH,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,IAAI,MAAM;gBAC1C,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,IAAI,MAAM;gBAC1C,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,IAAI,MAAM,IAAI,MAAM;gBACpD,OAAO,KAAK,KAAK,IAAI,OAAO,IAAI,IAAI,MAAM,IAAI,MAAM;YACxD;QACJ;IACJ;IAEA,cAAc;IACd,MAAM,QAAQ,CAAC,MAAM;QACjB,MAAM,IAAI;QACV,MAAM,IAAK,EAAE,OAAQ,CAAA,EAAE,cAAc,CAAA,IAAK;QAC1C,IAAI,WAAW,MAAM,GAAG;IAC5B;IAEA,YAAY;IACZ,MAAM,QAAQ,CAAC,MAAM;QACjB,MAAM,IAAI;QACV,MAAM,IAAK,EAAE,OAAQ,CAAA,EAAE,cAAc,CAAA,IAAK;QAC1C,IAAI,SAAS,MAAM,GAAG;IAC1B;IAEA,IAAI;IACJ,OAAO;QACH,GAAG,OAAO;QACV,GAAG,OAAO;QACV,OAAO,OAAO,KAAK,OAAO;QAC1B,QAAQ,OAAO,KAAK,OAAO;IAC/B;AACJ;;;;;ACrJA,iDAAgB;AAHhB;AAGO,SAAS,YAAa,OAAmB,EAAE,MAAc;IAC5D,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,OACpB,KAAK,IAAI,GAAG,KAAK,MAAM,QAAQ,QAAQ,UACvC,KAAK,IAAI,GAAG,KAAK,MAAM,QAAQ,SAAS;IAE5C,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;IACnB,IAAI;IACJ,IAAI,SAAS,GACT,IAAI,wBAAwB;IAEhC,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,OAAO,QAAQ,IAAK;QAC5C,MAAM,QAAQ,QAAQ,MAAM,CAAC,EAAE;QAC/B,IAAI,CAAC,MAAM,aAAa,MAAM,YAAY,GACtC;QAEJ,IAAI,cAAc,MAAM;QACxB,MAAM,aAAa,MAAM;QACzB,IAAI,2BAA2B,eAAe,YAAY,aAAa;QACvE,IAAI,UAAU,MAAM,OAAO,GAAG,GAAG,aAAa,OAAO,aAAa;IACtE;IACA,IAAI;IACJ,OAAO;AACX;;;;;ACnBA;;;;CAIC,GACD,kDAAa;AA8Bb,kDAAgB;AAxChB;AAUO,MAAM;IAMT,mBAAmB;IACnB,YACI,CAEC,CACH;aAVM,QAAgB;aAChB,QAAgB;aAChB,eAAuB;QAS3B,IAAI,CAAC,aAAa,EAAE;IACxB;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,QAAgB,EAAQ;QAClD,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,eAAe;IACxB;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAQ;QAChC,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,GAAG,GAAG,IAAI,CAAC;IAC9D;IAEA,KAAM,CAAS,EAAE,CAAS,EAAQ;QAC9B,IAAI,CAAC,WAAW,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,GAAG,GAAG,IAAI,CAAC;IAC7D;AACJ;AAEO,SAAS,aACZ,GAA6B,EAC7B,WAAsB;IAEtB,IAAI;IAEJ,MAAM,KAAK,YAAY;IACvB,MAAM,KAAK,YAAY;IACvB,IAAI,KAAK,YAAY;IACrB,IAAI,KAAK,YAAY;IAErB,IAAI,YAAY,QAAQ;QACpB,MAAM,WAAW,YAAY,WAAW,MAAM,KAAK;QAEnD,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,IAAI,YAAY,WAAW,KAAK,KAAK;QAC9D,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,IAAI,YAAY,WAAW,KAAK,KAAK;QAE9D,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,iBAAiB,IAAI,MAAM;QAChD,MAAM,mBAAmB,KAAK,MAAM,YAAY,MAAM;QACtD,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,aAAa;YAAC,GAAG;YAAI,GAAG;QAAE,GAAG;YAAC,GAAG;YAAI,GAAG;QAAE,GAAG,mBAAmB;QACnF,KAAK,QAAQ;QACb,KAAK,QAAQ;QAEb,gEAAgE;QAChE,IAAI,AAAC,CAAA,WAAW,gBAAe,IAAK,OAAO;YACvC,IAAI,KAAK,MAAM,AAAC,CAAA,WAAW,gBAAe,IAAK,MAAM,MAAM,GACvD,KAAK;iBAEL,KAAK;;IAGjB;IAEA,IAAI,YAAY,YAAY;IAC5B,IAAI,YAAY,YAAY,YAAY,aACpC,YAAY;QAAC,GAAG;QAAK,GAAG;QAAK,GAAG;IAAG;IAEvC,IAAI,SAAgB;QAChB,GAAG,SAAS;QACZ,GAAG,YAAY;IACnB;IACA,IAAI,SAAgB;QAChB,GAAG,SAAS;QACZ,GAAG;IACP;IACA,IAAI,YAAY,YAAY;QACxB,MAAM,OAAO;QACb,SAAS;QACT,SAAS;IACb;IAEA,IAAI;IACJ,IAAI,YAAY,SAAS,UAAU;QAC/B,WAAW,IAAI,qBAAqB,IAAI,IAAI,IAAI;QAChD,SAAS,aAAa,GAAG,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;QACrD,SAAS,aAAa,GAAG,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;IAEzD,OAAO,IAAI,YAAY,SAAS,iBAAiB;QAC7C,MAAM,IAAI;YACN,GAAG,KAAK;YACR,GAAG,KAAK;QACZ;QACA,WAAW,IAAI,qBAAqB,KAAK,EAAE,GAAE,KAAK,EAAE,GAAG,IAAI;QAC3D,SAAS,aAAa,GAAG,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;QACrD,SAAS,aAAa,KAAK,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;QACvD,SAAS,aAAa,GAAG,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;IAEzD,OAAO,IAAI,YAAY,SAAS,UAAU;QACtC,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,KAAK,KACd;YAAC,GAAG;YAAI,GAAG;QAAE,GACb;YAAC,GAAG;YAAI,GAAG;QAAE;QAEjB,WAAW,IAAI,qBAAqB,IAAI,IAAI,GAAG,IAAI,IAAI;QACvD,SAAS,aAAa,GAAG,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;QACrD,SAAS,aAAa,GAAG,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;IACzD;IAEA,IAAI,YAAY;IAChB,IAAI,YAAY,UACZ,IAAI,2BAA2B;IAEnC,IAAI,YAAY,aACZ,IAAI,2BAA2B;IAEnC,IAAI,SAAS,GAAG,GAAG,IAAI,OAAO,OAAO,IAAI,OAAO;IAGhD,IAAI;AACR;;;;;AC7HA,uDAAgB;AAHhB;AAGO,SAAS,kBAAmB,SAAoB;IACnD,IAAI,CAAC,WACD,OAAO,CAAA,GAAA,cAAG,EAAE;IAGhB,MAAM,QAEF;QACA,eAAe;QACf,UAAU;QACV,YAAY;QACZ,cAAc;QACd,WAAW;QACX,UAAU;QACV,eAAe;QACf,WAAW;QACX,cAAc;QACd,cAAc;QACd,cAAc;QACd,aAAa;QACb,OAAO;QACP,cAAc;QACd,SAAS;QACT,cAAc;IAClB;IAEA,IAAI,CAAE,CAAA,aAAa,KAAI,GACnB,MAAM,IAAI,MAAM;IAEpB,OAAO,CAAA,GAAA,cAAG,EAAE,KAAK,CAAC,UAAU;AAChC;;;;;AC5BA,uDAAgB;AANhB;AACA;AACA;AACA;;AAGO,SAAS,kBACZ,QAAqB,EACrB,WAAmB,EACnB,QAA+C;IAE/C,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE;IAEf,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;QAChB,SAAS,CAAA,GAAA,cAAG,EAAE,wBAAwB;QACtC,KAAK;YACD,aAAa;QACjB;IACJ;IAEA,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,GAAG;QACd,KAAK;YACD,SAAS;QACb;IACJ;IACA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAO;IACrC,MAAM,QAAQ;IACd,MAAM,aAAa,qBAAqB;IACxC,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;QACnB,SAAS;QACT,SAAS,eAAe,CAAA,GAAA,8BAAa,IAAI;QACzC,OAAO,CAAA,GAAA,cAAG,EAAE;QACZ,KAAK;YACD,YAAY;QAChB;QACA,SAAS;YACL,MAAM,QAAQ;YACd,MAAM;QACV;IACJ;IACA,MAAM,cAAc;QAChB,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;KACR;IACD,MAAM,iBAAsC,EAAE;IAC9C,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;QACf,KAAK;YACD,SAAS;YACT,UAAU;YACV,WAAW;YACX,YAAY;QAChB;IACJ;IACA,YAAY,QAAQ,CAAA;QAChB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,GAAG;YACd,QAAQ;YACR,SAAS;YACT,SAAS;YACT,SAAS;gBACL,MAAM,QAAQ,KAAK,IAAI;YAC3B;YACA,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,eAAe,KAAK;IACxB;IAEA,IAAI,OAAO;IACX,MAAM,OAAO,KAAK;IAClB,IAAI,OAAO,OAAO;IAElB,WAAW;QACP,MAAM;QACN,MAAM;IACV,GAAG;IAEH,CAAA,GAAA,oBAAQ,EAAE;QACN,QAAQ;QACR,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,uBAAuB,IAAI,CAAC;QAChD,KAAK;QACL,SAAS;YAAC,CAAA,GAAA,cAAG,EAAE;YAAkB;SAAS;QAC1C,WAAW;YAAC,CAAA,GAAA,cAAG,EAAE;SAAiB;QAClC,UAAU,CAAC;YACP,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,eAAe,QAAQ,CAAA;gBACnB,CAAA,GAAA,MAAC,EAAE,UAAU;YACjB;YACA,eAAe,OAAO,GAAG,eAAe;YACxC,IAAI,QAAQ,CAAA,GAAA,cAAG,EAAE,kBACb,SAAS,MAAM;iBAEf,SAAS;QAEjB;QACA,cAAc,CAAA,GAAA,cAAG,EAAE;IACvB;AACJ;;;ACtGA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;;;ACQlH,sDAAgB;AARhB;AACA;AACA;AACA;AACA;AAEA;AAEO,SAAS,iBACZ,QAAqB,EACrB,CAMC;IAED,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE;IACf,IAAI,YAAY,CAAA,GAAA,cAAG,EAAE;IAErB,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;QACxB,WAAW;YACP;gBAAC,IAAI,EAAE;gBAAY,OAAO,CAAA,GAAA,oCAAgB,EAAE,EAAE;YAAW;YACzD;gBAAC,IAAI;gBAAa,OAAO;YAAW;YACpC;gBAAC,IAAI;gBAAc,OAAO;YAAY;YACtC;gBAAC,IAAI;gBAAe,OAAO;YAAa;YACxC;gBAAC,IAAI;gBAAkB,OAAO;YAAgB;YAC9C;gBAAC,IAAI;gBAAmB,OAAO;YAAiB;YAChD;gBAAC,IAAI;gBAAoB,OAAO;YAAkB;YAClD;gBAAC,IAAI;gBAAO,OAAO;YAAK;SAC3B;QACD,QAAQ,EAAE;QACV,UAAU;YACN;QACJ;QACA,SAAS;IACb;IACA,QAAQ,aAAa,MAAM,YAAY;IACvC,IAAI,OAAO,QAAQ;IAEnB,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,QAAQ,EAAE,UAAU,OAAO,EAAE,UAAU,QAAQ,KAAK,KAAK;IACpF,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,OAAO,gBAAgB,OAAO,gBAAgB;IACjE,QAAQ,QAAQ,CAAA,GAAA,cAAG,EAAE;IACrB,QAAQ,YAAY;IACpB,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;QACjB,SAAS;QACT,KAAK;YACD,OAAO;QACX;IACJ;IACA,IAAI,OAAO,QAAQ;IAEnB,SAAS;QACL,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,CAAC;YACxB,QAAQ,MAAM,kBAAkB,SAAS,MAAM;QACnD,GAAG,CAAA,GAAA,YAAI,EAAE;IACb;IACA;IACA,CAAA,GAAA,YAAI,EAAE,kBAAkB;IAExB,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,WAAW;IAClC,CAAA,GAAA,MAAC,EAAE,IAAI,aAAa,UAAU,EAAE,WAAW,GAAG,GAAG,YAAY,OAAO,YAAY;IAChF,CAAA,GAAA,MAAC,EAAE,4BAA4B;IAE/B,MAAM,SAAS;QACX,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;QACnB,IAAI;QACJ,IAAI,UAAU,GAAG,GAAG,QAAQ,OAAO,QAAQ;QAC3C,IAAI,QAAQ,QAAQ,EAAE,UAAU,OAC5B,IAAI,wBAAwB;QAEhC,IAAI,UAAU,EAAE,cAAc,GAAG,GAAG,QAAQ,OAAO,QAAQ;QAE3D,IAAI,QAAQ,eAAe,YAAY;YACnC,IAAI,2BAA2B;YAC/B,IAAI,cAAc,EAAE;YACpB,IAAI,UAAU,aAAa,GAAG,GAAG,QAAQ,OAAO,QAAQ;QAC5D,OAAO;YACH,IAAI,2BAA2B,QAAQ;YACvC,IAAI,cAAc,EAAE;YACpB,IAAI,UAAU,EAAE,WAAW,GAAG,GAAG,QAAQ,OAAO,QAAQ;QAC5D;QACA,IAAI;IACR;IAEA;IAGA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;QACnC,QAAQ,CAAC;YACL,IAAI,WAAW,SACX,QAAQ;YAEZ,IAAI,WAAW,QACX,QAAQ;QAEhB;IACJ;IAEA,CAAA,GAAA,oBAAQ,EAAE;QACN,QAAQ;QACR,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,4BAA4B,IAAI,CAAC;QACrD,KAAK;QACL,SAAS;YAAC;YAAM;SAAS;QACzB,cAAc;QACd,UAAU,CAAC;YACP,YAAY;YACZ,QAAQ;YACR,CAAA,GAAA,YAAI,EAAE,qBAAqB;YAC3B,IAAI,QAAQ,MACR,EAAE,SAAS,QAAQ;QAE3B;IACJ;AACJ;;;;;ACzGA,kDAAa;AAVb;AACA;AASO,MAAM;IAKT,mBAAmB;IACnB,YAAa,CAAsB,CAAE;aAJ7B,aAAsB;aACb,eAAuD,IAAM;QAI1E,MAAM,SAAS,CAAA,GAAA,IAAA,EAAE,wBAAwB;YAAC,EAAE;SAAO;QACnD,OAAO,UAAU;YACb,OAAO,CAAC,IAAI,CAAC;QACjB;QACA,IAAI,EAAE,aACF,OAAO,QAAQ,EAAE;QAErB,CAAA,GAAA,mBAAc,EAAE;QAEhB,MAAM,QAA6B,EAAE;QACrC,MAAM,UAA6C,CAAC;QACpD,EAAE,MAAM,QAAQ,CAAA;YACZ,MAAM,aAAa,CAAA,GAAA,IAAA,EAAE,UAAU,IAAI,CAAC,EAAE;YACtC,CAAA,GAAA,mBAAc,EAAE;YAChB,WAAW,UAAU;gBACjB,OAAO;gBACP,EAAE,YAAY,IAAI,CAAC,EAAE;YACzB;YACA,MAAM,KAAK;YACX,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG;QACvB;QAEA,IAAI,CAAC,eAAe,CAAC,IAAI;YACrB,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC;QAC5B;QAEA,MAAM,OAAO,CAAA,GAAA,IAAA,EACT,oDACA;QAGJ,IAAI,CAAC,cAAc,CAAA,GAAA,IAAA,EAAE,iBAAiB;YAClC;YACA;SACH;QAED,MAAM,SAAS,CAAC;YACZ,IAAI,CAAC,aAAa;YAClB,KAAK,MAAM,UAAU,IAAI,CAAC,aAAa,UAAU;YACjD,IAAI,IAAI,CAAC,YAAY;gBACjB,SAAS,iBAAiB,eAAe;gBACzC,OAAO,iBAAiB,QAAQ;YACpC,OAAO;gBACH,SAAS,oBAAoB,eAAe;gBAC5C,OAAO,oBAAoB,QAAQ;YACvC;QACJ;QAEA,MAAM,gBAAgB,CAAC;YACnB,MAAM,SAAS,EAAE;YACjB,IAAI,OAAO,SAAS,WAAW,KAAK,SAAS,SACzC;YAEJ,OAAO;QACX;QAEA,MAAM,SAAS,IAAM,OAAO;IAChC;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,EAAU,EAAE,OAAgB,EAAQ;QAC5C,IAAI,CAAC,aAAa,IAAI;IAC1B;AACJ;;;ACnFA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,iCAAiC,MAAM,KAAK;;;ACArH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;ACAlH,OAAO,UAAU,QAAQ,mBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;ACAlH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;;;ACGhH;;;;;CAKC,GACD,yDAAa;AATb;AASO,MAAM;IAcT,mBAAmB;IAEnB,YACI,CAGC,CACH;QACE,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,UAAU;YAC5B,aAAa;YACb,OAAO,KAAK,EAAE;YACd,QAAQ,KAAK,EAAE;QACnB;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa;YACrB,UAAU;YACV,MAAM;YACN,KAAK;YACL,eAAe;YACf,YAAY;QAChB;QAEA,eAAe;QACf,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,UAAU;YACjC,aAAa;YACb,GAAG;YACH,QAAQ;YACR,gBAAgB;YAChB,MAAM;QACV;QACA,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,UAAU;YACjC,aAAa;YACb,GAAG;YACH,QAAQ;YACR,gBAAgB;YAChB,MAAM;QACV;QACA,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,kBAAkB,IAAI,CAAC;QAEpD,6BAA6B;QAC7B,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,UAAU;YACpC,aAAa;YACb,GAAG;YACH,QAAQ;YACR,gBAAgB;YAChB,MAAM;QACV;QACA,IAAI,CAAC,oBAAoB,MAAM,UAAU;QACzC,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,UAAU;YACjC,aAAa;YACb,GAAG;YACH,QAAQ;YACR,gBAAgB;YAChB,MAAM;QACV;QACA,IAAI,CAAC,iBAAiB,MAAM,UAAU;QACtC,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,qBAAqB,IAAI,CAAC;QAGvD,kBAAkB;QAClB,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,UAAU;YACxB,aAAa;YACb,WAAW,eAAgB,EAAE,QAAM,IAAK,OAAQ,EAAE,SAAO,IAAK;QAClE;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS;YACjB,YAAY;YACZ,SAAS;QACb;QACA,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,UAAU;YAC7B,aAAa;YACb,WAAW;QACf;QACA,IAAI,CAAC,oBAAoB,CAAA,GAAA,MAAC,EAAE,UAAU;YAClC,aAAa;YACb,MAAM;YACN,QAAQ;YACR,IAAI;YACJ,IAAI;YACJ,GAAG,KAAK,IAAI,CAAC;QACjB;QACA,IAAI,CAAC,oBAAoB,CAAA,GAAA,MAAC,EAAE,UAAU;YAClC,aAAa;YACb,MAAM;YACN,QAAQ;YACR,gBAAgB;YAChB,IAAI;YACJ,IAAI;YACJ,GAAG,KAAM,IAAI,CAAC,cAAc;QAChC;QACA,IAAI,CAAC,uBAAuB,CAAA,GAAA,MAAC,EAAE,UAAU;YACrC,aAAa;YACb,MAAM;YACN,QAAQ;YACR,GAAG,QAAO,IAAI,CAAC,cAAc,OAAM,QAAO,IAAI,CAAC,cAAc,OAAM,WAAU,IAAI,CAAC,cAAc,MAAK;QACzG;QACA,IAAI,CAAC,uBAAuB,CAAA,GAAA,MAAC,EAAE,UAAU;YACrC,aAAa;YACb,MAAM;YACN,QAAQ;YACR,GAAG,QAAO,IAAI,CAAC,cAAc,OAAM,QAAO,IAAI,CAAC,cAAc,OAAM,UAAS,IAAI,CAAC,cAAc,MAAK;QACxG;QAEA,IAAI,CAAC,aAAa,OACd,IAAI,CAAC,mBACL,IAAI,CAAC,mBACL,IAAI,CAAC,sBACL,IAAI,CAAC;QAET,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC;QACzB,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC;IACjC;IAEA,aAA0B;QACtB,OAAO,IAAI,CAAC;IAChB;IAEA,QAAS,KAAa,EAAE,MAAc,EAAQ;QAC1C,IAAI,CAAC,YAAY,aAAa,SAAS,KAAK;QAC5C,IAAI,CAAC,YAAY,aAAa,UAAU,KAAK;QAC7C,IAAI,CAAC,QAAQ,aAAa,aAAa,eAAgB,QAAM,IAAK,OAAQ,SAAO,IAAK;IAC1F;IAEA,aAAc,CAKb,EAAQ;QACL,IAAI,EAAE,MAAM,WAAW;YACnB,IAAI,CAAC,iBAAiB,aAAa,MAAM,KAAK,EAAE;YAChD,IAAI,CAAC,iBAAiB,aAAa,MAAM,KAAK,EAAE;QACpD;QACA,IAAI,EAAE,MAAM,WAAW;YACnB,IAAI,CAAC,iBAAiB,aAAa,MAAM,KAAK,EAAE;YAChD,IAAI,CAAC,iBAAiB,aAAa,MAAM,KAAK,EAAE;QACpD;QACA,IAAI,EAAE,WAAW,WAAW;YACxB,IAAI,CAAC,iBAAiB,aAAa,KAAK,KAAK,KAAK,IAAI,GAAG,EAAE;YAC3D,IAAI,CAAC,iBAAiB,aAAa,KAAK,KAAK,KAAK,IAAI,GAAG,EAAE,SAAS;QACxE;QACA,IAAI,EAAE,cAAc,WAAW;YAC3B,IAAI,CAAC,iBAAiB,MAAM,UAAU,EAAE,YAAY,MAAM;YAC1D,IAAI,CAAC,iBAAiB,MAAM,UAAU,EAAE,YAAY,MAAM;QAC9D;IACJ;IAEA,mBAAoB,CAKnB,EAAQ;QACL,IAAI,EAAE,MAAM,WAAW;YACnB,IAAI,CAAC,iBAAiB,aAAa,MAAM,KAAK,EAAE;YAChD,IAAI,CAAC,oBAAoB,aAAa,MAAM,KAAK,EAAE;QACvD;QACA,IAAI,EAAE,MAAM,WAAW;YACnB,IAAI,CAAC,iBAAiB,aAAa,MAAM,KAAK,EAAE;YAChD,IAAI,CAAC,oBAAoB,aAAa,MAAM,KAAK,EAAE;QACvD;QACA,IAAI,EAAE,OAAO;YACT,IAAI,CAAC,iBAAiB,aAAa,UAAU,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS,EAAE;YAC1E,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,wBAAwB,EAAE,SAAS,0BAA0B;YACpF,IAAI,CAAC,oBAAoB,aAAa,UAAU;QACpD;QACA,IAAI,EAAE,cAAc,WAAW;YAC3B,IAAI,CAAC,iBAAiB,MAAM,UAAU,EAAE,YAAY,MAAM;YAC1D,IAAI,CAAC,oBAAoB,MAAM,UAAU,EAAE,YAAY,MAAM;QACjE;IACJ;IAEA,cAAe,CAGd,EAAQ;QACL,IAAI,EAAE,aAAa,WAAW;YAC1B,IAAI,CAAC,aAAa,aAAa,aAAa,YAAY,EAAE,WAAW;YACrE,IAAI,CAAC,kBAAkB,MAAM,UAAU,EAAE,WAAW,OAAO,IAAI,MAAM;QACzE;QACA,IAAI,EAAE,cAAc,WAChB,IAAI,CAAC,QAAQ,MAAM,UAAU,EAAE,YAAY,MAAM;IAEzD;AAEJ;;;;;AC3IA;;;;;;;;;;;;CAYC,GACD,uDAAa;AAjFb;AAEA;AACA;AACA;;AACA;;AACA;;AACA;;AAIA;AACA;AAMA;AAIA;AA6BA,MAAM,YAAY,IAAI;AACtB,MAAM,YAAY,KAAK,IAAI,GAAG;IAC9B;UAAK,KAAK;IAAL,MAAA,MACD,UAAA,KAAA;IADC,MAAA,MAED,UAAA,KAAA;IAFC,MAAA,MAGD,kBAAA,KAAA;IAHC,MAAA,MAID,UAAA,KAAA;IAJC,MAAA,MAKD,UAAA,KAAA;IALC,MAAA,MAMD,YAAA,KAAA;IANC,MAAA,MAOD,cAAA,KAAA;IAPC,MAAA,MAQD,UAAA,KAAA;IARC,MAAA,MASD,cAAA,KAAA;IATC,MAAA,MAUD,UAAA,KAAA;IAVC,MAAA,MAWD,WAAA,MAAA;GAXC,UAAA;AAaL,MAAM,kBAAkB,KAAK,6CAA6C;AAenE,MAAM;IAkDD,uBAAoC;QACxC,0CAA0C;QAC1C,MAAM,SAAS,IAAI,CAAC;QACpB,OAAO,IAAI,IAAI,CAAC,oBAAoB;QACpC,OAAO,IAAI,IAAI,CAAC,oBAAoB;QACpC,OAAO,QAAQ,IAAI,CAAC,oBAAoB;QACxC,OAAO,QAAQ,IAAI,CAAC,oBAAoB;QAExC,IAAI,OAAO,QAAS,CAAA,KAAK,KAAK,CAAA,MAAO,KAAK,OAAO,QAAQ,MAAM,GAAG;YAC9D,OAAO,IAAI,KAAK,MAAM,OAAO;YAC7B,OAAO,IAAI,KAAK,MAAM,OAAO;QACjC;QAEA,OAAO;IACX;IAEQ,uBAA8B;QAClC,IAAI,CAAC,SAAS,kBAAkB;YAC5B,IAAI,CAAC,oBAAoB;YACzB,IAAI,CAAC;QACT;IACJ;IAEQ,aAAc,OAAc,EAAE,OAAiB,EAAQ;QAC3D,IAAI,YAAY,IAAI,CAAC,eAAe,CAAC,SACjC;QAEJ,MAAM,UAAU,IAAI,CAAC;QACrB,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,oBAAoB;QACzB,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAC3B,IAAI,CAAC,OAAO,MAAM,SAAS;aACxB,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAClC,IAAI,CAAC,OAAO,MAAM,SAAS;aACxB,IAAI,IAAI,CAAC,gBAAgB,MAAM,cAClC,IAAI,CAAC,OAAO,MAAM,SAAS;aACxB,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAClC,IAAI,CAAC,OAAO,MAAM,SAAS,UAAU,CAAA,GAAA,+BAAQ,IAAI;aAC9C,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAClC,IAAI,CAAC,OAAO,MAAM,SAAS,UAAU,CAAA,GAAA,+BAAQ,IAAI;aAC9C,IAAI,IAAI,CAAC,gBAAgB,MAAM,QAClC,IAAI,CAAC,OAAO,MAAM,SAAS;aACxB,IAAI,IAAI,CAAC,gBAAgB,MAAM,UAClC,IAAI,CAAC,OAAO,MAAM,SAAS;aACxB,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAClC,IAAI,CAAC,OAAO,MAAM,SAAS,UAAU,CAAA,GAAA,6BAAM,IAAI;aAC5C,IAAI,IAAI,CAAC,gBAAgB,MAAM,UAClC,IAAI,CAAC,OAAO,MAAM,SAAS;aACxB,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAClC,IAAI,CAAC,OAAO,MAAM,SAAS,UAAU,CAAA,GAAA,6BAAM,IAAI;aAC5C,IAAI,IAAI,CAAC,gBAAgB,MAAM,OAClC,IAAI,CAAC,OAAO,MAAM,SAAS;QAG/B,IAAI;YAAC,MAAM;YAAM,MAAM;YAAM,MAAM;YAAM,MAAM;YAAM,MAAM;SAAM,CAAC,SAAS,IAAI,CAAC,aAAa;YACzF,MAAM,YAAY;gBAAC,MAAM;gBAAM,MAAM;aAAa,CAAC,SAAS;YAC5D,MAAM,gBAAgB;gBAAC,MAAM;gBAAM,MAAM;aAAa,CAAC,SAAS,IAAI,CAAC;YACrE,IAAI,CAAC,aAAa,eACd,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;gBAAS;gBAAO;aAAQ;YAE5E,IAAI,aAAa,CAAC,eACd,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAEhE;QAEA,IAAI,IAAI,CAAC,gBAAgB,MAAM,MAC3B,IAAI,CAAC,WAAW,mBAAmB;YAAC,WAAW;QAAK;IAE5D;IAEA;;;;;;KAMC,GACD,AAAQ,mBAAoB,OAAe,EAAE,OAAe,EAAE,OAAe,EAAW;QACpF,MAAM,OAAO,KAAK,KAAK,IAAI,CAAC,mBAAmB;QAE/C,IAAI,UAAU,OAAO,KAAK,IAAI;QAC9B,WAAW,UAAU,IAAI,IAAI;QAC7B,UAAU,KAAK,MAAM;QACrB,WAAW,KAAK,IAAI;QACpB,MAAM,WAAW,KAAK,IAAI,WAAW,KAAK,IAAI,WAAW,KAAK,IAAI,GAAG;QAErE,aAAa;QACb,IAAI,aAAa,IAAI,CAAC,mBAAmB,OACrC,OAAO;QAGX,MAAM,kBAAkB,WAAW,IAAI,CAAC,mBAAmB;QAC3D,IAAI,CAAC,mBAAmB,QAAQ;QAEhC,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;QACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,SAAS;QACvF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB;QACxE,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,SAAS,CAAC;QAEzF,IAAI,SAAgB;YAAC,IAAI,CAAC,mBAAmB;YAAG,IAAI,CAAC,mBAAmB;YAAG;YAAG;SAAE;QAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;QAClD,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;QACrC,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;QAErC,IAAI,CAAC,mBAAmB;QAExB,OAAO;IACX;IAEA;;;;;;KAMC,GACD,AAAQ,gBAAiB,UAAsB,EAAE,UAAsB,EAAE,WAAmB,EAAQ;QAChG,IAAI,WAAW,UAAU,WAAW,OAAO;YACvC,WAAW,QAAQ,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,OAAO,WAAW,OAAO;YAC9D,WAAW,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAG,WAAW,GAAG;YAClD,WAAW,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAG,WAAW,GAAG;YAClD,WAAW,QAAQ,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,OAAO,WAAW,OAAO;YAC9D;QACJ;QAEA,MAAM,IAAI,IAAI,CAAC,SAAS;QACxB,MAAM,IAAI,IAAI,CAAC,SAAS;QAExB,2CAA2C;QAC3C,MAAM,aAAa,IAAI,CAAC,uBAAuB;YAC3C,GAAG,IAAI;YACP,GAAG,IAAI;QACX,GAAG;QACH,MAAM,aAAa,IAAI,CAAC,uBAAuB;YAC3C,GAAG,IAAI;YACP,GAAG,IAAI;QACX,GAAG;QAEH,yBAAyB;QACzB,WAAW,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAI,WAAW,GAAG;QACnD,WAAW,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,GAAI,WAAW,GAAG;QAEnD,0BAA0B;QAC1B,WAAW,QAAQ,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,OAAO,WAAW,OAAO;QAC9D,WAAW,QAAQ,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,OAAO,WAAW,OAAO;QAE9D,kBAAkB;QAClB,MAAM,WAAW,IAAI,CAAC,uBAAuB;YACzC,GAAG,CAAC,IAAI;YACR,GAAG,CAAC,IAAI;QACZ,GAAG;QACH,WAAW,IAAI,SAAS;QACxB,WAAW,IAAI,SAAS;IAC5B;IAEQ,SAAgB;QACpB,IAAI,IAAI,CAAC,gBAAgB;YACrB,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,mBAAmB,QAAQ,IAAI,CAAC;YACrC,IAAI,CAAC,mBAAmB,SAAS,IAAI,CAAC;QAC1C;QACA,IAAI,CAAC,cAAc,IAAI,CAAC;IAC5B;IAEA;;;KAGC,GACD,AAAQ,gBAA0B;QAC9B,6EAA6E;QAC7E,yFAAyF;QAEzF,MAAM,oBAAoB;YACtB;gBAAC;gBAAG;aAAE;YACN;gBAAC,IAAI,CAAC;gBAAa;aAAE;YACrB;gBAAC,IAAI,CAAC;gBAAa,IAAI,CAAC;aAAa;YACrC;gBAAC;gBAAG,IAAI,CAAC;aAAa;SACzB;QAED,MAAM,MAAM,IAAI,CAAC;QAEjB,6BAA6B;QAC7B,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;QACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB,IAAE,IAAI;QAC9E,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB,CAAC,IAAI;QAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,IAAI,GAAG,CAAC,IAAI;QAE3F,kDAAkD;QAClD,IAAK,IAAI,IAAI,GAAG,IAAI,kBAAkB,QAAQ,IAAK;YAC/C,IAAI,SAAgB;gBAAC,iBAAiB,CAAC,EAAE,CAAC,EAAE;gBAAE,iBAAiB,CAAC,EAAE,CAAC,EAAE;gBAAE;gBAAG;aAAE;YAC5E,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;YAElD,IACI,CAAE,CAAA,KAAK,MAAM,CAAC,EAAE,IAAI,MAAM,CAAC,EAAE,IAAI,IAAI,CAAC,SAAS,cAC3C,KAAK,MAAM,CAAC,EAAE,IAAI,MAAM,CAAC,EAAE,IAAI,IAAI,CAAC,SAAS,WAAU,GAE3D,6BAA6B;YAC7B,OAAO;QAEf;QACA,OAAO;IACX;IAEQ,cAAe,GAA6B,EAAQ;QACxD,MAAM,IAAI,IAAI,CAAC,SAAS;QACxB,MAAM,IAAI,IAAI,CAAC,SAAS;QAExB,MAAM,MAAM,IAAI,CAAC;QACjB,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;QAErB,IAAI,IAAI,SAAS,KAAM,IAAI,UAAU,KAAK,IAAI,UAAU,GACpD,IAAI,wBAAwB;aACzB;YACH,IAAI,wBAAwB;YAC5B,IAAI,wBAAyB,OAAO,qCAAqC;QAC7E;QACA,oCAAoC;QACpC,yDAAyD;QAIzD,IAAI;QACJ;YACI,IAAI,IAAI,CAAC,WAAW;gBAChB,IAAI,YAAY,SAAS,oBAAoB,oBAAoB,sBAAsB;gBACvF,IAAI,SAAS,GAAG,GAAG,IAAI,CAAC,aAAa,IAAI,CAAC;YAC9C,OACI,IAAI,UAAU,GAAG,GAAG,IAAI,CAAC,aAAa,IAAI,CAAC;YAK/C,IAAI,IAAI,CAAC,WAAW;gBAChB,IAAI;gBAEJ,IAAI,UAAU,IAAI,GAAG,IAAI;gBACzB,IAAI,MAAM,IAAI,OAAO,IAAI;gBACzB,IAAI,OAAO,IAAI;gBAEf,IAAI,wBAAwB;gBAE5B,SAAS;gBACT,MAAM,aAAa;gBACnB,IAAI,cAAc,SAAS,OAAO;gBAClC,IAAI,UACA,SAAS,IAAI,CAAC,mBAAmB,IAAI,CAAC,aACtC,CAAC,aAAa,IAAI,OAClB,CAAC,aAAa,IAAI,OAClB,IAAI,aAAa,IAAI,IAAI,OACzB,IAAI,aAAa,IAAI,IAAI;gBAE7B,IAAI,cAAc;gBAElB,OAAO;gBACP,IAAI,2BAA2B;gBAC/B,IAAI,UAAU,IAAI,CAAC,aAAa,GAAG,GAAG,GAAG;gBAEzC,IAAI;YACR;YAEA;;6BAEiB,GAEjB,IAAI,UAAU,IAAI,GAAG,IAAI;YACzB,IAAI,MAAM,IAAI,OAAO,IAAI;YACzB,IAAI,OAAO,IAAI;YAEf,MAAM,WAAW,IAAI,CAAC,SAAS;YAC/B,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,QAAQ,IAAK;gBACtC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,aAAa,QAAQ,CAAC,EAAE,CAAC,YAAY,GAClD;gBAGJ,IAAI,cAAc,QAAQ,CAAC,EAAE,CAAC;gBAC9B,IAAI,2BAA2B,QAAQ,CAAC,EAAE,CAAC;gBAE3C,MAAM,eAAe,QAAQ,CAAC,EAAE,CAAC,OAAO;gBACxC,IAAI,cAAc;oBACd,IAAI,IAAI,CAAC,gBAAgB,UAAU,QAAQ,CAAC,EAAE,CAAC,OAAO,SAAS,IAAI,CAAC,gBAAgB,WAAW,QAAQ,CAAC,EAAE,CAAC,OAAO,QAAQ;wBACtH,IAAI,CAAC,gBAAgB,QAAQ,QAAQ,CAAC,EAAE,CAAC,OAAO;wBAChD,IAAI,CAAC,gBAAgB,SAAS,QAAQ,CAAC,EAAE,CAAC,OAAO;oBACrD,OACI,IAAI,CAAC,aAAa,UAAU,GAAG,GAAG,IAAI,CAAC,gBAAgB,OAAO,IAAI,CAAC,gBAAgB;oBAEvF,IAAI,CAAC,aAAa,UAAU,QAAQ,CAAC,EAAE,CAAC,QAAQ,GAAG;oBACnD,aAAa,KAAK,IAAI,CAAC;oBACvB,IAAI,UAAU,IAAI,CAAC,iBAAiB,GAAG,GAAG,GAAG;gBACjD,OACI,IAAI,UAAU,QAAQ,CAAC,EAAE,CAAC,QAAQ,GAAG,GAAG,GAAG;YAEnD;YACA,IAAI,cAAc;QAItB;QACA,IAAI;QAEJ,eAAe;QACf,IAAI,MAAM,WAAW,IAAI,CAAC,eAAe,MAAM,aAAa,IAAI,CAAC,aAC7D,IAAI,CAAC,WAAW,cAAc;YAC1B,WAAW;YACX,UAAU,IAAI,QAAQ,KAAK,KAAK;QACpC;aAEA,IAAI,CAAC,WAAW,cAAc;YAC1B,WAAW;QACf;IAER;IAEQ,uBAAwB,CAAY,EAAa;QACrD,MAAM,MAAM,IAAI,CAAC;QACjB,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;QACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB,IAAE,IAAI;QAC9E,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB,CAAC,IAAI;QAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,IAAI,GAAG,CAAC,IAAI;QAE3F,IAAI,SAAgB;YAAC,EAAE;YAAG,EAAE;YAAG;YAAG;SAAE;QACpC,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;QAElD,OAAO;YACH,GAAG,MAAM,CAAC,EAAE;YACZ,GAAG,MAAM,CAAC,EAAE;QAChB;IACJ;IAEQ,uBAAwB,CAAY,EAAE,YAAwB,EAAa;QAC/E,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;QACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,aAAa,GAAG,aAAa;QAC3G,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB,aAAa;QACxF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB,aAAa;QAErF,IAAI,SAAgB;YAAC,EAAE;YAAG,EAAE;YAAG;YAAG;SAAE;QACpC,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;QAElD,OAAO;YACH,GAAG,MAAM,CAAC,EAAE;YACZ,GAAG,MAAM,CAAC,EAAE;QAChB;IACJ;IAEQ,aAAc,QAAgB,EAAE,gBAAwB,EAAE,UAAkB,EAAU;QAC1F,IAAI,WAAW,WAAW,MAAM,KAAK;QACrC,MAAM,SAAS,KAAK,IAAI,WAAW;QACnC,MAAM,OAAO,KAAK,IAAI,QAAQ,mBAAmB;QAEjD,IAAI,QAAQ,YACR,WAAW,KAAK,MAAM,WAAW,oBAAoB;QAGzD,OAAO,WAAW,MAAM,KAAK;IACjC;IAEA;;;;KAIC,GACD,AAAQ,iBAAkB,QAAgB,EAAU;QAChD,WAAW,WAAY,CAAA,IAAI,KAAK,EAAC;QACjC,IAAI,WAAW,KAAK,IAChB,YAAY,IAAI,KAAK;aAClB,IAAI,WAAW,CAAC,KAAK,IACxB,YAAY,IAAI,KAAK;QAEzB,OAAO;IACX;IAEQ,sBAA6B;QACjC,IAAI,CAAC,wBAAwB;QAC7B,IAAI,CAAC,aAAa,IAAI,CAAC;QACvB,IAAI,CAAC,SAAS;IAClB;IAEQ,SAAU,cAAwB,EAAQ;QAC9C,IAAI,CAAC,0BAA0B;QAC/B,IAAI,gBACA,IAAI,CAAC,oBAAoB;IAEjC;IAEQ,aAAoB;QACxB,OAAO,sBAAsB,IAAM,IAAI,CAAC;QACxC,MAAM,WAAW,CAAA,GAAA,oBAAQ,EAAE;QAC3B,MAAM,WAAW,IAAI,CAAC,oBAAoB;QAE1C,2BAA2B;QAC3B,MAAM,UAAU,YAAY;QAC5B,MAAM,gBAAgB,AAAC,CAAA,UAAU,IAAI,CAAC,cAAa,IAAK,KAAK,MAAM,6DAA6D;QAChI,IAAI,CAAC,iBAAiB;QAEtB,IAAI,IAAI,CAAC,2BAA2B,UAAU;YAC1C,IAAI,CAAC,0BAA0B;YAC/B,IAAI,CAAC,YAAY;QACrB;IACJ;IAEQ,YAAa,aAAqB,EAAQ;QAE9C,MAAM,WAAW,CAAA,GAAA,oBAAQ,EAAE;QAC3B,MAAM,WAAW,IAAI,CAAC,oBAAoB,YACtC,IAAI,CAAC,oBAAoB,UAAU,IAAI,CAAC,mBAAmB,SAC3D,IAAI,CAAC,oBAAoB,MAAM,IAAI,CAAC,mBAAmB,KACvD,IAAI,CAAC,oBAAoB,MAAM,IAAI,CAAC,mBAAmB;QAE3D,kBAAkB;QAClB,IACI,CAAC,IAAI,CAAC,sBAEF,CAAA,IAAI,CAAC,oBAAoB,UAAU,IAAI,CAAC,mBAAmB,SAC3D,KAAK,IAAI,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC,mBAAmB,SAAS,QAAQ,IAAI,CAAC,mBAAmB,KAAI,GAErH;YACE,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC,mBAAmB;YACzD,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB;YACrD,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB;YACrD,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC,mBAAmB;YACzD,IAAI,IAAI,CAAC,kBAAkB;gBACvB,IAAI,CAAC,mBAAmB;gBACxB,IAAI,CAAC,YAAY,IAAI,CAAC;YAC1B;YAEA,IAAI,CAAC,WAAW,aAAa;gBAAC,QAAQ,IAAI,CAAC,cAAc,IAAI,CAAC,oBAAoB;YAAK;QAC3F,OAAO,IACH,AAAC,CAAA,IAAI,CAAC,oBAAoB,MAAM,IAAI,CAAC,mBAAmB,KAAK,KAAK,IAAI,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB,KAAK,GAAE,KACjI,CAAA,IAAI,CAAC,oBAAoB,MAAM,IAAI,CAAC,mBAAmB,KAAK,KAAK,IAAI,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB,KAAK,GAAE,KAE9H,CAAA,IAAI,CAAC,oBAAoB,UAAU,IAAI,CAAC,mBAAmB,SAC3D,KAAK,IAAI,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC,mBAAmB,SAAS,QAAQ,IAAI,CAAC,mBAAmB,KAAI,GAErH;YACE,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC,mBAAmB;YACzD,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB;YACrD,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB;YACrD,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC,mBAAmB;YACzD,IAAI,CAAE,qBAAqB;YAC3B,IAAI,IAAI,CAAC,kBAAkB;gBACvB,IAAI,CAAC,mBAAmB;gBACxB,IAAI,CAAC,YAAY,IAAI,CAAC;YAC1B;YAEA,IAAI,CAAC,WAAW,aAAa;gBAAC,QAAQ,IAAI,CAAC,cAAc,IAAI,CAAC,oBAAoB;YAAK;QAC3F,OAAO;YACH,IAAI,CAAC,YAAY,8BAA8B;YAC/C,MAAM,cAAc,KAAK,IAAI,GAAG,kBAAkB;YAClD,IAAI,CAAC,gBAAgB,IAAI,CAAC,qBAAqB,IAAI,CAAC,oBAAoB;YACxE,IAAI,CAAC,YAAY,MAAM,iCAAiC;YACxD,IAAI,CAAC,WAAW,aAAa;gBAAC,QAAQ,IAAI,CAAC,cAAc,IAAI,CAAC,oBAAoB;YAAK;QAC3F;QAEA,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,eAAe,MAAM,QAAQ,CAAC,IAAI,CAAC,eACxD,IAAI,CAAC,WAAW,aAAa;YACzB,GAAG,IAAI,CAAC,QAAQ;YAChB,GAAG,IAAI,CAAC,QAAQ;YAChB,WAAW;QACf;aAEA,IAAI,CAAC,WAAW,aAAa;YAAC,WAAW;QAAK;QAIlD,IAAI,UAAU;YACV,mHAAmH;YACnH,IAAI,CAAC,oBAAoB;YACzB,MAAM,QAAQ,YAAY;YAC1B,IAAI,CAAC;YACL,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,YAAY,YAAY,QAAQ,OAAO;QACzE;QAKI;IAKR;IAEA,mBAAmB;IAEnB,YACI,CAaC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,OAAO;gBACP,KAAK;gBACL,QAAQ;gBACR,QAAQ;gBACR,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,WAAW,EAAE;QAClB,IAAI,CAAC,eAAe,EAAE;QACtB,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,OAAO,EAAE,OAAO,EAAE;QAC/C,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACnC,IAAI,CAAC,cAAc,EAAE;QACrB,IAAI,CAAC,eAAe,EAAE;QACtB,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,IAAI,uCAAuC;QAC/E,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAChC,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,qBAAqB;YACtB,GAAG;YACH,GAAG;YACH,OAAO;YACP,OAAO;QACX;QACA,IAAI,CAAC,sBAAsB;YACvB,GAAG;YACH,GAAG;YACH,OAAO;YACP,OAAO;QACX;QACA,IAAI,CAAC,uBAAuB,CAAC;QAC7B,IAAI,CAAC,YAAY;YACb,GAAG;YACH,GAAG;QACP;QACA,IAAI,CAAC,gBAAgB;QACrB,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,mBAAmB;QACxB,IAAI,CAAC,qBAAqB;QAE1B,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,wCAAkB,EAAE;YACtC,OAAO,EAAE;YACT,QAAQ,EAAE;QACd;QAEA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,oBAAoB;YAC5B,YAAY;YACZ,eAAe;QACnB;QACA,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,CAAC;YACxB,IAAI,CAAC,mBAAmB,MAAM,aAAa,SAAS,MAAM;QAC9D,GAAG,CAAA,GAAA,YAAI,EAAE;QAET,CAAA,GAAA,YAAI,EAAE,kBAAkB;YACpB,IAAI,CAAC,mBAAmB,MAAM,aAAa,SAAS,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,WAAW,CAAA,GAAA,YAAI,EAAE,YAAY;YAC5G,IAAI,CAAC,oBAAoB;YACzB,IAAI,CAAC;QACT;QAEA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,oBAAoB,IAAI,CAAC,WAAW;QAC5D,IAAI,CAAC,OAAO,iBAAkB,YAAY,CAAC;YACvC,EAAE;YACF,OAAO;QACX;QACA,IAAI,CAAC,OAAO,iBAAiB,eAAe,CAAC;YACzC,EAAE;YACF,OAAO;QACX;QACA,IAAI,CAAC,OAAO,iBAAiB,aAAa,CAAC;YACvC,EAAE;YACF,OAAO;QACX;QAEA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QAChC,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QACrC;YACI,IAAI,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;YACtB,IAAI,SAAS,GAAG,GAAG,GAAG;YACtB,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;YAClB,IAAI,YAAY;YAChB,IAAI,SAAS,GAAG,GAAG,GAAG;QAC1B;QAEA,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YAClC,QAAQ,CAAC,QAAQ,OAAO,UAAU;gBAE9B,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc,QAAQ,KAAK,CAAA,GAAA,MAAC,EAAE,eAAe,OAChD;gBAEJ,IAAI,WAAW,OACX,MAAM;gBAEV,IAAI,UACA;gBAGJ,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,sBAAsB,UAAU,QAAQ,OAAO,UAAU;qBAE3D;oBAEH,IAAI;wBAAC,MAAM;wBAAM,MAAM;wBAAM,MAAM;wBAAM,MAAM;wBAAU,MAAM;wBAAM,MAAM;qBAAM,CAAC,SAAS,IAAI,CAAC,eAAe,aAAa,SAAS;wBACjI,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU,QAAQ,OAAO,UAAU;wBAC9D;oBACJ;oBAEA,IAAI;wBAAC,MAAM;wBAAM,MAAM;wBAAM,MAAM;wBAAM,MAAM;wBAAU,MAAM;wBAAM,MAAM;qBAAM,CAAC,SAAS,IAAI,CAAC,eAAe,aAAa,OAAO;wBAC/H,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU,QAAQ,OAAO,UAAU;wBAC9D;oBACJ;oBAEA,IAAI;wBAAC;wBAAK;qBAAU,CAAC,SAAS,WAAW;wBACrC,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU,QAAQ,OAAO,UAAU;wBAC9D;oBACJ;oBAEA,IAAI,QAAQ,UAAU;wBAClB,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU,QAAQ,OAAO,UAAU;wBAC9D;oBACJ;gBAEJ;YAEJ;YACA,MAAM,CAAC,QAAQ,OAAO;gBAClB,8BAA8B;gBAC9B,IAAI,WAAW,OACX,MAAM;gBAGV,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,sBAAsB,QAAQ,QAAQ,OAAO;YAE1D;QACJ;QAEA,IAAI,CAAC;QAEL,IAAI,CAAC,cAAc,MAAM;QACzB,IAAI,CAAC,aAAa,MAAM;QAExB,IAAI,CAAC,aAAa;QAElB,IAAI,CAAC,gBAAgB;QAErB,IAAI,CAAC,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC3C,QAAQ,CAAC;gBACL,MAAM,YAAY;oBACd,MAAM,MAAM,IAAI,CAAC;oBACjB,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;oBACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB,IAAE,IAAI;oBAC9E,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB,CAAC,IAAI;oBAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,IAAI,GAAG,CAAC,IAAI;oBAC3F,OAAO;gBACX;gBAEA,IAAI,MAAM,SAAS,UAAU,CAAC,IAAI,CAAC,eAAe;oBAC9C,MAAM,SAAS;oBACf,IAAI,SAAgB;wBAAC,MAAM;wBAAI,MAAM;wBAAI;wBAAG;qBAAE;oBAC9C,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;oBAClD,IAAI,CAAC,gBAAgB;wBACjB,GAAG,MAAM,CAAC,EAAE;wBACZ,GAAG,MAAM,CAAC,EAAE;wBACZ,UAAU,MAAM;oBACpB;oBACA;gBACJ;gBAEA,IAAI,OAAO,SAAS,QAAQ,OAAO;oBAE/B,MAAM,SAAS;oBAEf,IAAI,OAAO,OAAO;wBACd,IAAI,SAAgB;4BAAC,MAAM;4BAAG,MAAM;4BAAG;4BAAG;yBAAE;wBAC5C,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;wBAClD,MAAM,IAAI,MAAM,CAAC,EAAE;wBACnB,MAAM,IAAI,MAAM,CAAC,EAAE;oBACvB;oBACA,IAAI,QAAQ,OAAO;wBACf,MAAM,KAAK,IAAI,CAAC,cAAe;wBAC/B,MAAM,KAAK,IAAI,CAAC,cAAe;wBAC/B,MAAM,YAAY,IAAI,CAAC,cAAe;wBACtC,IAAI,SAAgB;4BAAC,MAAM;4BAAI,MAAM;4BAAI;4BAAG;yBAAE;wBAC9C,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;wBAClD,MAAM,KAAK,MAAM,CAAC,EAAE;wBACpB,MAAM,KAAK,MAAM,CAAC,EAAE;wBAEpB,IAAI,CAAC,gBAAgB;4BACjB,GAAG,MAAM;4BACT,GAAG,MAAM;4BACT,UAAU,MAAM;wBACpB;oBACJ;gBACJ;gBAGA,IAAI,MAAM,SAAS,UAAU,MAAM,SAAS,QACxC,IAAI,CAAC,gBAAgB;oBACjB,GAAG,MAAM;oBACT,GAAG,MAAM;oBACT,UAAU,MAAM;gBACpB;gBAEJ,EAAE,OAAO;YACb;QACJ;QAEA,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,YAAY;QAGjB,IAAI,CAAC,oBAAoB;YACrB,MAAM;gBACF,WAAW,CAAC;oBAER,IAAI,CAAC;oBACL,IAAI,CAAC,aAAa,MAAM;oBAExB,MAAM,WAAW,IAAI,CAAC,YAAY;oBAElC,MAAM,QAAa;wBACf,OAAO,IAAI,CAAC,oBAAoB;oBACpC;oBACA,MAAM,iBAAiB,aAAa;oBACpC,MAAM,WAAW,IAAI;oBACrB,MAAM,cAAc,CAAC,CAAC,IAAI;oBAE1B,IAAI,IAAI,SAAS,eAAe;wBAE5B,IAAI,CAAC,YAAY;wBACjB,MAAM,OAAO;oBAEjB,OAAO,IAAI,IAAI,QACX,MAAM,OAAO;yBAEV,IAAI,IAAI,SAAS,aAAa;wBAEjC,IAAI,CAAC,YAAY;wBACjB,MAAM,OAAO;wBAEb,IAAI,CAAC,kBAAkB,QAAQ;wBAC/B,IAAI,CAAC;wBACL;oBACJ,OACI;oBAGJ,MAAM,IAAI,IAAI;oBACd,MAAM,IAAI,IAAI;oBAEd,IAAI,CAAC,kBAAkB,QAAQ;gBACnC;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,MAAM;gBACF,WAAW,CAAC;oBAER,IAAI,CAAC;oBACL,IAAI,CAAC,aAAa,MAAM;oBAExB,IAAI,MAAM,SAAS,eAAe;wBAC9B,MAAM,QAAQ,IAAI,CAAC,uBAAuB;4BAAC,GAAG,MAAM;4BAAM,GAAG,MAAM;wBAAI;wBACvE,EAAE,OAAO,KAAK,MAAM,MAAM,IAAI,KAAK,MAAM,MAAM;oBAEnD,OAAO,IAAI,MAAM,SAAS,aAAa;wBACnC,IAAI,CAAC;wBACL;oBAEJ;gBAEJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,UAAU;gBACN,WAAW,CAAC;oBAER,IAAI,CAAC;oBACL,IAAI,CAAC,aAAa,MAAM;oBACxB,MAAM,QAAQ,IAAI,CAAC,uBAAuB;wBAAC,GAAG,MAAM;wBAAM,GAAG,MAAM;oBAAI;oBAEvE,IAAI,MAAM,SAAS,eAAe;wBAC9B,IAAI,CAAC,YAAY;wBACjB,EAAE,WAAW,QAAQ,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,qBAAqB;oBAErE,OAAO,IAAI,MAAM,SAAS,eACtB,EAAE,WAAW,QAAQ,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,qBAAqB;yBAE9D,IAAI,MAAM,SAAS,aAAa;wBACnC,IAAI,CAAC,YAAY;wBACjB,EAAE,WAAW,MAAM,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,qBAAqB;wBAC/D,IAAI,CAAC;oBAET;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,MAAM;gBACF,WAAW,CAAC;oBAER,IAAI,CAAC;oBACL,IAAI,CAAC,aAAa,MAAM;oBAExB,IAAI,MAAM,SAAS,eAAe;wBAC9B,MAAM,QAAQ,IAAI,CAAC,uBAAuB;4BAAC,GAAG,MAAM;4BAAM,GAAG,MAAM;wBAAI;wBACvE,EAAE,OAAO,KAAK,MAAM,MAAM,IAAI,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,qBAAqB;oBAEjF,OAAO,IAAI,MAAM,SAAS,aAAa;wBACnC,IAAI,CAAC;wBACL;oBAEJ;gBAEJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,OAAO;gBACH,WAAW,CAAC;oBAER,IAAI,CAAC;oBACL,IAAI,CAAC,aAAa,MAAM;oBACxB,MAAM,QAAQ,IAAI,CAAC,uBAAuB;wBAAC,GAAG,MAAM;wBAAM,GAAG,MAAM;oBAAI;oBAEvE,IAAI,MAAM,SAAS,eAAe;wBAC9B,IAAI,CAAC,YAAY;wBACjB,EAAE,QAAQ,QAAQ,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,qBAAqB;oBAElE,OAAO,IAAI,MAAM,SAAS,eACtB,EAAE,QAAQ,QAAQ,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,qBAAqB;yBAE3D,IAAI,MAAM,SAAS,aAAa;wBACnC,IAAI,CAAC,YAAY;wBACjB,EAAE,QAAQ,MAAM,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,qBAAqB;wBAC5D,IAAI,CAAC;oBAET;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,MAAM;gBACF,WAAW,CAAC;oBACR,IAAI,CAAC,aAAa,MAAM;oBACxB,IAAI;wBAAC;wBAAQ;qBAAS,CAAC,SAAS,MAAM,UAAU,KAAK;wBACjD,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC,mBAAmB,KAAK,MAAM;wBACnC,IAAI,CAAC,mBAAmB,KAAK,MAAM;wBACnC,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;wBAC3C,IAAI,CAAC,qBAAqB;wBAC1B,IAAI,CAAC,mBAAmB;wBACxB,IAAI,CAAC,SAAS;oBAClB,OAAO,IAAI,MAAM,SAAS,aACtB,IAAI,CAAC;gBAEb;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,WAAW;gBACP,WAAW,CAAC;oBACR,IAAI,CAAC,aAAa,MAAM;oBACxB,IAAI;wBAAC;wBAAQ;qBAAS,CAAC,SAAS,MAAM,UAAU,KAAK;wBACjD,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC,mBAAmB,KAAK,MAAM;wBACnC,IAAI,CAAC,mBAAmB,KAAK,MAAM;wBACnC,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;wBAC3C,IAAI,CAAC,qBAAqB;wBAC1B,IAAI,CAAC,mBAAmB;wBACxB,IAAI,CAAC,SAAS;oBAClB;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU;oBACjC,IAAI,aAAa,SACb,IAAI,CAAC;yBAEL,IAAI,CAAC,aAAa,MAAM;gBAEhC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO;oBACrB,IAAI,CAAC;gBACT;YACJ;YACA,MAAM;gBACF,WAAW,CAAC;oBACR,IAAI,CAAC,aAAa,MAAM;oBAExB,IAAI,MAAM,WAAW,UAAU,CAAC,MAAM,eAAe,MAAM,MAAM,GAAG;wBAEhE,MAAM,UAAU,MAAM,QAAQ,MAAM;wBACpC,MAAM,UAAU,MAAM,QAAQ,MAAM;wBAEpC,IAAI,CAAC,mBAAmB,MAAM,KAAK,KAAK,MAAM,YAAa,SAAS,MAAM,YAAa;wBACvF,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;wBAC3C,IAAI,CAAC,oBAAoB;wBACzB,IAAI,CAAC;wBAEL,IAAI,CAAC,aAAa;4BACd,SAAS;gCAAC;6BAAQ;4BAClB,OAAO,IAAI,CAAC,mBAAmB;4BAC/B,OAAO,IAAI,CAAC,mBAAmB;wBACnC;oBACJ;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU;oBACjC,IAAI,aAAa,KACb,IAAI,CAAC;yBAEL,IAAI,CAAC,aAAa,MAAM;gBAEhC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO;oBACrB,IAAI,CAAC;gBACT;YACJ;YACA,QAAQ;gBACJ,WAAW,CAAC;oBACR,IAAI,CAAC,aAAa,MAAM;oBACxB,IACI,AAAC;wBAAC;wBAAQ;qBAAQ,CAAC,SAAS,MAAM,UAAU,OAAO,CAAC,MAAM,eAC1D,MAAM,SAAS,aACjB;wBACE,MAAM,QAAQ,IAAI,CAAC,uBAAuB;4BAAC,GAAG,MAAM;4BAAM,GAAG,MAAM;wBAAI;wBACvE,MAAM,cAAc,IAAI,CAAC,SAAS,WAAW,MAAM,GAAG,MAAM;wBAC5D,EAAE,OAAO,aAAa,MAAM,SAAS;wBACrC,IAAI,CAAC,WAAW,mBAAmB;4BAC/B,GAAG,MAAM;4BACT,GAAG,MAAM;4BACT,OAAO;4BACP,WAAW,MAAM,SAAS;wBAC9B;wBAEA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;oBAEb;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU,YAErC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO,eAEzB;YACJ;YACA,WAAW;gBACP,WAAW,CAAC;oBACR,IAAI,CAAC,aAAa,MAAM;oBACxB,IACI,AAAC;wBAAC;wBAAQ;qBAAQ,CAAC,SAAS,MAAM,UAAU,OAAO,CAAC,MAAM,eAC1D,MAAM,SAAS,aACjB;wBACE,MAAM,QAAQ,IAAI,CAAC,uBAAuB;4BAAC,GAAG,MAAM;4BAAM,GAAG,MAAM;wBAAI;wBACvE,MAAM,cAAc,IAAI,CAAC,SAAS,WAAW,MAAM,GAAG,MAAM;wBAC5D,EAAE,OAAO,aAAa,MAAM,SAAS;wBACrC,IAAI,CAAC,WAAW,mBAAmB;4BAC/B,GAAG,MAAM;4BACT,GAAG,MAAM;4BACT,OAAO;4BACP,WAAW,MAAM,SAAS;wBAC9B;oBACJ;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU;oBACjC,IAAI,aAAa,OACb,IAAI,CAAC;yBAEL,IAAI,CAAC,aAAa,MAAM;gBAEhC;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO;oBACrB,IAAI,CAAC;gBACT;YACJ;YACA,QAAQ;gBACJ,WAAW,CAAC;oBACR,IAAI,CAAC,aAAa,MAAM,WAAW,SAAS,MAAM,WAAW,MAAM;oBAEnE,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QACjD,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;yBACpC,IAAI,MAAM,WAAW,UAAU,CAAC,MAAM,eAAe,IAAI,CAAC,iBAAiB;wBAG9E,MAAM,UAAU,MAAM,QAAQ,MAAM;wBACpC,MAAM,UAAU,MAAM,QAAQ,MAAM;wBACpC,6BAA6B;wBAC7B,MAAM,YAAY;4BACd,GAAG,IAAI,CAAC,cAAc;4BACtB,GAAG,IAAI,CAAC,eAAe;wBAC3B;wBAEA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,KAAK,MAAM,WAAW;4BAAC,GAAG,MAAM,YAAa;4BAAS,GAAG,MAAM,YAAa;wBAAO;wBAC5G,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,KAAK,MAAM,WAAW;4BAAC,GAAG,MAAM,QAAQ;4BAAS,GAAG,MAAM,QAAQ;wBAAO;wBAC7F,IAAI,YAAY,WAAW;wBAE3B,aAAa;wBACb,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;wBAC1C,IAAI,CAAC,mBAAmB,SAAS;wBAEjC,IAAI,IAAI,CAAC,YAAY,UAAU,UAAU;4BACrC,IAAI,CAAC,mBAAmB,QAAQ,KAAK,MAAM,IAAI,CAAC,mBAAmB,QAAQ,KAAK,KAAK,KAAK,KAAK,KAAK,GAAG,6BAA6B;4BACpI,YAAY,IAAI,CAAC,mBAAmB,QAAQ,IAAI,CAAC,gBAAgB;wBACrE;wBAEA,IAAI,CAAC,mBAAmB,QAAQ,IAAI,CAAC,iBAAiB,IAAI,CAAC,mBAAmB;wBAE9E,qBAAqB;wBACrB,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;wBACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,UAAU,GAAG,UAAU;wBACrG,4FAA4F;wBAC5F,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB;wBAC3E,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,UAAU,GAAG,CAAC,UAAU;wBACvG,qGAAqG;wBAErG,IAAI,SAAgB;4BAAC,IAAI,CAAC,mBAAmB;4BAAG,IAAI,CAAC,mBAAmB;4BAAG;4BAAG;yBAAE;wBAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;wBAClD,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;wBACrC,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;wBAErC,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;wBAE3C,IAAI,CAAC,mBAAmB;wBACxB,IAAI,CAAC,oBAAoB;wBACzB,IAAI,CAAC;wBAEL,IAAI,CAAC,aAAa;4BACd,SAAS;gCAAC;6BAAQ;4BAClB,OAAO,IAAI,CAAC,mBAAmB;4BAC/B,OAAO,IAAI,CAAC,mBAAmB;wBACnC;oBAEJ;gBACJ;gBACA,6DAA6D;gBAC7D,WAAW,CAAC,QAAQ,OAAO,UAAU;oBACjC,IAAI;wBAAC;wBAAK;wBAAW;wBAAW;wBAAU;wBAAW;wBAAgB;wBAAgB;qBAAO,CAAC,SAAS,WAClG,IAAI,CAAC,aAAa,MAAM;yBAExB,IAAI,CAAC;gBAEb;gBACA,6DAA6D;gBAC7D,SAAS,CAAC,QAAQ,OAAO;oBACrB,MAAM,WAAW,IAAI,CAAC,YAAY;oBAClC,IAAI;wBAAC;wBAAK;wBAAW;wBAAW;wBAAU;wBAAW;wBAAgB;wBAAgB;qBAAO,CAAC,SAAS,WAClG,IAAI,CAAC,aAAa,MAAM;yBAExB,IAAI,CAAC;gBAEb;YACJ;QACJ;QACA,IAAI,CAAC,wBAAwB;QAG7B,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YAClC,SAAS,CAAC;gBAEN,IAAI,MAAM,SAAS,QAAQ;oBAEvB,IAAI,CAAC,IAAI,CAAC,iBAAiB;wBACvB,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;wBACvC,IAAI,CAAC,qBAAqB,IAAI,CAAC,mBAAmB,QAAS,CAAA,KAAK,KAAK,CAAA,MAAO;oBAChF;oBAEA,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;oBAE1C,MAAM,QAAQ,KAAK,IAAI,WAAW,KAAK,IAAI,WAAW,IAAI,CAAC,mBAAmB,QAAQ,MAAM,UAAU,IAAI,CAAC,mBAAmB;oBAE9H,IAAI,CAAC,mBAAmB,SAAS,MAAM;oBACvC,IAAI,CAAC,mBAAmB,SAAS,MAAM;oBACvC,IAAI,CAAC,mBAAmB,QAAQ,IAAI,CAAC,iBACjC,IAAI,CAAC,aACD,IAAI,CAAC,mBAAmB,OACxB,IACA,IAAI,CAAC,qBAAqB,KAAK;oBAGvC,IAAI,IAAI,CAAC,mBAAmB,QAAS,CAAA,KAAK,KAAK,CAAA,MAAO,GAClD,IAAI,CAAC,qBAAqB;oBAE9B,6FAA6F;oBAC7F,MAAM,WAAW,IAAI,CAAC,mBAAmB,QAAQ,IAAI,CAAC,gBAAgB;oBAEtE,kBAAkB;oBAClB;wBACI,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;wBACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,MAAM,MAAM,MAAM;wBAChG,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB,MAAM;wBAC9E,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB,MAAM;wBACjF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,MAAM,MAAM,CAAC,MAAM;wBAClG,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,MAAM,OAAO,MAAM,UAAU,MAAM,OAAO,MAAM;wBAG9H,IAAI,SAAgB;4BAAC,IAAI,CAAC,mBAAmB;4BAAG,IAAI,CAAC,mBAAmB;4BAAG;4BAAG;yBAAE;wBAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;wBAElD,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;wBACrC,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;oBAEzC;oBAEA,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;oBAE3C,0BAA0B;oBAC1B,IAAI,CAAC,aAAa;wBACd,SAAS;4BAAC;4BAAS;yBAAQ;wBAC3B,OAAO,IAAI,CAAC,mBAAmB;wBAC/B,OAAO,IAAI,CAAC,mBAAmB;oBACnC;oBACA,GAAG;oBACH,IAAI,CAAC;oBACL,IAAI,CAAC,mBAAmB;oBACxB,IAAI,CAAC,oBAAoB;gBAG7B,OAAO,IAAI,MAAM,SAAS,OACtB,IAAI,CAAC,kBAAkB;YAI/B;QACJ;QAEA,MAAM,cAAc,CAAC;YACjB,IAAI,IAAI,CAAC,QAAQ,OAAO;gBACpB,IAAI,CAAC,oBAAoB;gBACzB,IAAI,CAAC;YACT,OAAO;gBACH,uBAAuB;gBAEvB,MAAM,UAAU,IAAI,CAAC,mBACjB,GACA,MAAM,MACN,MAAM;gBAEV,IAAI,SACA,IAAI,CAAC,aAAa;oBACd,SAAS;wBAAC;qBAAQ;oBAClB,OAAO,IAAI,CAAC,mBAAmB;oBAC/B,OAAO,IAAI,CAAC,mBAAmB;gBACnC;gBAGJ,iCAAiC;gBACjC,IAAI,CAAC,oBAAoB;YAC7B;QACJ;QAEA,IAAI,CAAC,mBAAmB,IAAI,CAAA,GAAA,MAAC,EAAE,aAAa;YAAE;QAAY;QAC1D,IAAI,CAAC,qBAAqB,IAAI,CAAA,GAAA,MAAC,EAAE,aAAa;YAAE;QAAY;QAC5D,IAAI,CAAC,mBAAmB,oBAAoB;YAAC;SAAS;QAGtD,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc;YACrC,SAAS;YACT,OAAO;gBACH,EAAE;YACN;QACJ;QACA,IAAI,CAAC,iBAAiB,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc;YACvC,SAAS;YACT,OAAO;gBACH,EAAE;YACN;QACJ;QAGA,IAAI,CAAC,oBAAoB,IAAI,CAAA,GAAA,MAAC,EAAE,WAAW;YACvC,UAAU;gBACN,IAAI,CAAC;gBACL,IAAI,CAAC;gBACL,IAAI,CAAC;gBACL,IAAI,CAAC;gBACL,IAAI,CAAC;gBACL,IAAI,CAAA,GAAA,MAAC,EAAE;gBACP,IAAI,CAAA,GAAA,MAAC,EAAE;aACV;QACL;QACA,IAAI,CAAC,kBAAkB,YAAY,CAAC;YAEhC,IAAI,CAAC,UAAU,IAAI,MAAM;YACzB,IAAI,CAAC,UAAU,IAAI,MAAM;YACzB,IAAI,MAAM,SAAS,eAAe,MAAM,gBAAgB,SAAS;gBAC7D,IAAI,CAAC,UAAU;gBACf,IAAI,CAAC,oBAAoB;gBACzB,IAAI,CAAC;YACT,OAAO;gBACH,IAAI,CAAC,IAAI,CAAC,SACN,IAAI,CAAC,UAAU;oBAAE,GAAG;oBAAG,GAAG;gBAAE;gBAEhC,IAAI,CAAC,QAAQ,IAAI,MAAM;gBACvB,IAAI,CAAC,QAAQ,IAAI,MAAM;YAC3B;YAEA,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,sBAAsB,UAAU;iBAElC;gBAEH,MAAM,WAAW,IAAI,CAAC,YAAY;gBAElC,IAAI,IAAI,CAAC,eAAe,MAAM,MAAM;oBAEhC,IAAI;wBAAC;wBAAI;wBAAS;qBAAO,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACrG,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,SAAS;wBAC5F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,UAAU;wBAC7F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO;wBACH,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC;oBACT;gBAEJ,OAAO,IAAI,IAAI,CAAC,eAAe,MAAM,MAAM;oBAEvC,IAAI,MAAM,SAAS,iBAAiB;wBAAC;wBAAQ;qBAAS,CAAC,SAAS,MAAM,UAAU,KAAK;wBACjF,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,SAAS;wBAC5F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OACI,IAAI,CAAC,aAAa,MAAM;gBAGhC,OAAO,IAAI,IAAI,CAAC,eAAe,MAAM,MAAM;oBAEvC,IAAI,MAAM,SAAS,iBAAiB;wBAAC;wBAAQ;qBAAQ,CAAC,SAAS,MAAM,UAAU,KAAK;wBAChF,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,UAAU;wBAC7F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OACI,IAAI,CAAC,aAAa,MAAM;gBAGhC,OAAO,IAAI,IAAI,CAAC,eAAe,MAAM,MAAM;oBAEvC,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACzD,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,SAAS;wBAC5F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,UAAU;wBAC7F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO;wBACH,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC;oBACT;gBAEJ,OAAO,IAAI,IAAI,CAAC,eAAe,MAAM,UAAU;oBAE3C,IAAI;wBAAC;wBAAI;wBAAS;qBAAO,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACrG,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,SAAS;wBAC5F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,UAAU;wBAC7F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO;wBACH,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC;oBACT;gBAEJ,OAAO,IAAI,IAAI,CAAC,eAAe,MAAM,MAAM;oBAEvC,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACzD,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,SAAS;wBAC5F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,UAAU;wBAC7F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO;wBACH,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC;oBACT;gBAEJ,OAAO,IAAI,IAAI,CAAC,eAAe,MAAM,OAAO;oBAExC,IAAI;wBAAC;wBAAI;wBAAS;qBAAO,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACrG,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,SAAS;wBAC5F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO,IAAI;wBAAC;qBAAG,CAAC,SAAS,aAAa,MAAM,SAAS,iBAAiB,MAAM,WAAW,UAAU;wBAC7F,IAAI,CAAC,wBAAwB,IAAI,CAAC,kBAAkB;wBACpD,IAAI,CAAC,sBAAsB,UAAU;oBACzC,OAAO;wBACH,IAAI,CAAC,aAAa,MAAM;wBACxB,IAAI,CAAC;oBACT;gBAEJ;YAGJ;QAEJ;QAEA,qCAAqC;QACrC,IAAI,CAAC,OAAO,iBAAiB,SAAS,CAAC;YACnC,MAAM;QACV;QAGA,WAAW;YACP,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC1C,QAAQ,IAAI,CAAC;gBACb,aAAa;gBACb,WAAW,CAAC;oBACR,IAAI,EAAE,SAAS,iBAAiB,EAAE,WAAW,UACzC,IAAI;wBACA,EAAE;oBACN,EAAE,OAAO,GAAG;oBACR,SAAS,GACb;oBAEJ,oDAAoD;oBACpD,IAAI,EAAE,SAAS,eACX,CAAA,GAAA,MAAC,EAAE;oBAEP;;qBAEC,GAED,IAAI,CAAC,kBAAkB,QAAQ;gBACnC;gBACA,SAAS,CAAC;oBAEN,IAAI,IAAI,CAAC,WACL;oBAGJ,IAAI,CAAC;oBACL,MAAM,UAAU,IAAI,CAAC,mBACjB,CAAC,WAAW,SAAU,CAAA,IAAI,CAAC,YAAY,UAAU,WAAW,IAAI,CAAA,GAChE,WAAW,MACX,WAAW;oBAEf,IAAI,SACA,IAAI,CAAC,aAAa;wBACd,SAAS;4BAAC;yBAAQ;wBAClB,OAAO,IAAI,CAAC,mBAAmB;wBAC/B,OAAO,IAAI,CAAC,mBAAmB;oBACnC;oBAGJ,iCAAiC;oBACjC,IAAI,CAAC,oBAAoB;gBAG7B;gBACA,cAAc,CAAC;oBACX,IAAI,CAAC,QACD;wBAAA,IAAI,CAAC,IAAI,CAAC,WAAW;4BACjB,IAAI,CAAC,UAAU;4BACf,IAAI,CAAC,oBAAoB;wBAC7B;oBAAA;gBAER;gBACA,aAAa;YACjB;QACJ,GAAG;QAEH,IAAI,CAAC,cAAc;QAEnB,IAAI,CAAC,0BAA0B;QAK/B,iBAAiB;QACjB,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC,iBAAiB,YAAY;QAElC,OAAO,sBAAsB,IAAM,IAAI,CAAC;QAExC,IAAI,CAAC;IACT;IAGA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAW,GAAa,EAAQ;QAC5B,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,gBAAgB;QACrB,IAAI,CAAC;QAEL,IAAI,CAAC;QAEL,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC;IACT;IAEA;;;;KAIC,GACD,QAAS,KAAa,EAAE,MAAc,EAAQ;QAC1C,MAAM,WAAW,IAAI,CAAC;QACtB,MAAM,YAAY,IAAI,CAAC;QAEvB,IAAI,UAAU,YAAY,WAAW,WACjC;QAGJ,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,eAAe;QAEpB,IAAI,CAAC,WAAW,QAAQ,OAAO;QAE/B,IAAI,CAAC,mBAAmB,KAAK,AAAC,CAAA,QAAQ,QAAO,IAAK;QAClD,IAAI,CAAC,mBAAmB,KAAK,AAAC,CAAA,SAAS,SAAQ,IAAK;QAEpD,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB;QACrD,IAAI,CAAC,oBAAoB,IAAI,IAAI,CAAC,mBAAmB;QAErD,IAAI,CAAC,YAAY,IAAI,CAAC;QAEtB,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC;IACT;IAEA,QAAS,OAAiB,EAAQ;QAC9B,yBAAyB;QACzB,IAAI,YAAY,QAAQ;YACpB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAC5D;QACA,IAAI,YAAY,QAAQ;YACpB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAC5D;QACA,IAAI,YAAY,YAAY;YACxB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAC5D;QACA,IAAI,YAAY,QAAQ;YACpB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAC5D;QACA,IAAI,YAAY,SAAS;YACrB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAC5D;QACA,IAAI,YAAY,QAAQ;YACpB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;gBAAS;gBAAO;aAAQ;QAC5E;QACA,IAAI,YAAY,QAAQ;YACpB,IAAI,CAAC,aAAa,MAAM;YACxB,IAAI,CAAC,iBAAiB,yBAAyB;gBAAC;aAAQ;QAC5D;IACJ;IAEA,UAAqB;QACjB,IAAI,IAAI,CAAC,eAAe,MAAM,MAC1B,OAAO;QAEX,IAAI,IAAI,CAAC,eAAe,MAAM,MAC1B,OAAO;QAEX,IAAI,IAAI,CAAC,eAAe,MAAM,UAC1B,OAAO;QAEX,IAAI,IAAI,CAAC,eAAe,MAAM,MAC1B,OAAO;QAEX,IAAI,IAAI,CAAC,eAAe,MAAM,OAC1B,OAAO;QAEX,IAAI,IAAI,CAAC,eAAe,MAAM,MAC1B,OAAO;QAEX,IAAI,IAAI,CAAC,eAAe,MAAM,MAC1B,OAAO;QAEX,MAAM,IAAI,MAAM;IACpB;IAEA,cAAe,QAAgB,EAAQ;QACnC,IAAI,CAAC,cAAc,WAAW;QAE9B,IAAI,CAAC,WAAW,aAAa;YAAC,QAAQ,IAAI,CAAC,cAAc,IAAI,CAAC,oBAAoB;QAAK;QAEvF,IAAI,IAAI,CAAC,YAAY,MAAM;YACvB,IAAI,CAAC,0BAA0B,aAAa,IAAI,CAAC;YAEjD,IAAI,CAAC,WAAW,aAAa;gBACzB,GAAG,IAAI,CAAC,cAAc;gBACtB,GAAG,IAAI,CAAC,eAAe;gBACvB,WAAW;YACf;YAEA,IAAI,CAAC,yBAAyB,WAAW;gBACrC,IAAI,IAAI,CAAC,YAAY,MACjB;gBAEJ,IAAI,CAAC,WAAW,aAAa;oBAAC,WAAW;gBAAK;YAClD,GAAG;QACP;IACJ;IAEA,WAAY,OAAe,EAAQ;QAC/B,IAAI,CAAC,IAAI,CAAC,mBAAmB,SAAS,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,eAAe,IAC5E;QAGJ,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC;QAEL,IAAI,CAAC,aAAa;YACd,SAAS;gBAAC;aAAQ;YAClB,OAAO,IAAI,CAAC,mBAAmB;YAC/B,OAAO,IAAI,CAAC,mBAAmB;QACnC;IACJ;IAEA,UAAW,SAAmB,EAAQ;QAClC,IAAI,CAAC,mBAAmB,QAAQ;QAChC,IAAI,CAAC,mBAAmB,QAAQ;QAEhC,IAAI,CAAC,mBAAmB,IAAI,AAAC,CAAA,IAAI,CAAC,cAAc,IAAI,CAAC,SAAS,UAAS,IAAK;QAC5E,IAAI,CAAC,mBAAmB,IAAI,AAAC,CAAA,IAAI,CAAC,eAAe,IAAI,CAAC,SAAS,WAAU,IAAK;QAE9E,IAAI,WAAW;YACX,IAAI,CAAC,qBAAqB;YAC1B,IAAI,CAAC,mBAAmB;QAC5B,OACI,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAG/C,IAAI,CAAC,YAAY,IAAI,CAAC;QACtB,IAAI,CAAC;QAEL,IAAI,WACA,IAAI,CAAC,aAAa;YACd,SAAS;gBAAC;gBAAS;aAAQ;YAC3B,OAAO,IAAI,CAAC,mBAAmB;YAC/B,OAAO,IAAI,CAAC,mBAAmB;QACnC;IAER;IAEA;;;KAGC,GACD,QAAS,SAAmB,EAAW;QACnC,0BAA0B;QAC1B,MAAM,WAAW,IAAI,CAAC,aAAa,IAAI,CAAC,mBAAmB,OAAO,IAAI;QAEtE,iCAAiC;QACjC,MAAM,kBAAkB;YACpB;gBAAC;gBAAG;aAAE;YACN;gBAAC,IAAI,CAAC,SAAS;gBAAY;aAAE;YAC7B;gBAAC,IAAI,CAAC,SAAS;gBAAY,IAAI,CAAC,SAAS;aAAY;YACrD;gBAAC;gBAAG,IAAI,CAAC,SAAS;aAAY;YAC9B;gBAAC,IAAI,CAAC,SAAS,aAAa;gBAAG,IAAI,CAAC,SAAS,cAAc;aAAE;SAChE;QAED,6BAA6B;QAC7B,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;QACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB;QAE3E,eAAe;QACf,IAAK,IAAI,IAAI,GAAG,IAAI,gBAAgB,QAAQ,IAAK;YAC7C,IAAI,SAAgB;gBAAC,eAAe,CAAC,EAAE,CAAC,EAAE;gBAAE,eAAe,CAAC,EAAE,CAAC,EAAE;gBAAE;gBAAG;aAAE;YACxE,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;YAClD,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE;YACjC,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE;QACrC;QAEA,MAAM,YAA8B,CAAC;QACrC,IAAK,IAAI,IAAI,GAAG,IAAI,gBAAgB,QAAQ,IAAK;YAC7C,IAAI,UAAU,OAAO,aAAa,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,IAChE,UAAU,KAAK,eAAe,CAAC,EAAE,CAAC,EAAE;YAExC,IAAI,UAAU,OAAO,aAAa,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,IAChE,UAAU,KAAK,eAAe,CAAC,EAAE,CAAC,EAAE;YAExC,IAAI,UAAU,OAAO,aAAa,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,IAChE,UAAU,KAAK,eAAe,CAAC,EAAE,CAAC,EAAE;YAExC,IAAI,UAAU,OAAO,aAAa,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,IAChE,UAAU,KAAK,eAAe,CAAC,EAAE,CAAC,EAAE;QAE5C;QACA,MAAM,cAAc,UAAU,KAAM,UAAU;QAC9C,MAAM,eAAe,UAAU,KAAM,UAAU;QAE/C,YAAY;QACZ,MAAM,UAAU;QAChB,MAAM,EAAE,OAAO,QAAQ,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,QAC3B,aACA,cACA,IAAI,CAAC,cAAc,SACnB,IAAI,CAAC,eAAe,SACpB;QAGJ,iBAAiB;QACjB,MAAM,SAAS,KAAK,IAAI,WAAW,WAAW;QAE9C,MAAM,wBAAwB;YAC1B,OAAO;YACP,GAAG,AAAC,IAAI,CAAC,cAAc,IAAK,AAAC,CAAA,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,eAAe,CAAC,EAAE,CAAC,EAAE,AAAD,IAAK;YAC9E,GAAG,AAAC,IAAI,CAAC,eAAe,IAAK,AAAC,CAAA,eAAe,CAAC,EAAE,CAAC,EAAE,GAAG,eAAe,CAAC,EAAE,CAAC,EAAE,AAAD,IAAK;YAC/E,OAAO;QACX;QAEA,IACI,sBAAsB,UAAU,IAAI,CAAC,mBAAmB,SACxD,KAAK,IAAI,sBAAsB,IAAI,IAAI,CAAC,mBAAmB,KAAK,gBAChE,KAAK,IAAI,sBAAsB,IAAI,IAAI,CAAC,mBAAmB,KAAK,gBAChE,sBAAsB,UAAU,IAAI,CAAC,mBAAmB,OAExD,OAAO;QAEX,IAAI,CAAC,qBAAqB;QAE1B,IAAI,WACA,IAAI,CAAC,qBAAqB;aAE1B,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAE/C,IAAI,CAAC,mBAAmB;QACxB,IAAI,CAAC;QAEL,IAAI,WACA,IAAI,CAAC,aAAa;YACd,SAAS;gBAAC;gBAAS;aAAQ;YAC3B,OAAO,IAAI,CAAC,mBAAmB;YAC/B,OAAO,IAAI,CAAC,mBAAmB;QACnC;QAEJ,OAAO;IACX;IAEA;;KAEC,GACD,iBAAwB;QACpB,MAAM,YAAY,GAAG,sCAAsC;QAC3D,IACI,CAAC,CAAA,GAAA,kBAAO,EAAE,kBACV,IAAI,CAAC,SAAS,cAAc,IAAI,CAAC,cAAc,aAC/C,IAAI,CAAC,SAAS,eAAe,IAAI,CAAC,eAAe,WAEjD,IAAI,CAAC;aAEL,IAAI,CAAC;IAEb;IAEA,SAAU,QAAgB,EAAE,UAAoB,EAAQ;QACpD,6BAA6B;QAC7B,MAAM,YAAY;YACd,GAAG,IAAI,CAAC,cAAc;YACtB,GAAG,IAAI,CAAC,eAAe;QAC3B;QAEA,MAAM,cAAc,IAAI,CAAC,mBAAmB;QAC5C,MAAM,WAAW,WAAW,MAAM,KAAK;QAEvC,IAAI,YACA,IAAI,CAAC,mBAAmB,SAAS;aAEjC,IAAI,CAAC,mBAAmB,QAAQ;QAGpC,IAAI,CAAC,mBAAmB,QAAQ,IAAI,CAAC,iBACjC,IAAI,CAAC,aACD,IAAI,CAAC,mBAAmB,OACxB,IACA;QAIR,qBAAqB;QACrB,IAAI,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO;QACvB,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,UAAU,GAAG,UAAU;QACrG,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,qBAAqB,IAAI,CAAC,mBAAmB,QAAQ;QAC3G,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,iBAAiB,QAAQ,CAAA,GAAA,MAAC,EAAE,OAAO,wBAAwB,CAAC,UAAU,GAAG,CAAC,UAAU;QAEvG,IAAI,SAAgB;YAAC,IAAI,CAAC,mBAAmB;YAAG,IAAI,CAAC,mBAAmB;YAAG;YAAG;SAAE;QAChF,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,uBAAuB,QAAQ;QAClD,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;QACrC,IAAI,CAAC,mBAAmB,IAAI,MAAM,CAAC,EAAE;QAErC,IAAI,CAAC,sBAAsB,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAC3C,IAAI,CAAC,mBAAmB;QACxB,IAAI,CAAC,SAAS;IAClB;IAEA;;;;KAIC,GACD,cAAe,EAAU,EAAE,EAAU,EAAQ;QACzC,MAAM,QAAQ;QAEd,IAAI,CAAC,mBAAmB,KAAK,KAAK;QAClC,IAAI,CAAC,mBAAmB,KAAK,KAAK;QAElC,IAAI,CAAC,mBAAmB;QACxB,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,SAAS;IAClB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC,mBAAmB;IACnC;IAEA,cAAuB;QACnB,OAAO,IAAI,CAAC,mBAAmB,QAAQ,MAAM,KAAK;IACtD;IAEA,cAAuB;QACnB,OAAO;IACX;IAEA,cAAuB;QACnB,OAAO;IACX;IAEA,eAAsB;QAClB,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC;IACT;IAEA,iBAAkB,CAAU,EAAE,CAAU,EAAE,QAAiB,EAAQ;QAC/D,IAAI,MAAM,WAAW;YACjB,IAAI,CAAC,gBAAgB;YACrB;QACJ;QAEA,IAAI,CAAC,IAAI,CAAC,eACN,IAAI,CAAC,gBAAgB;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;QAEjD,IAAI,CAAC,cAAc,IAAI;QACvB,IAAI,CAAC,cAAc,IAAI;QACvB,IAAI,CAAC,cAAc,WAAW;IAClC;AAEJ;;;AC/5DA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,+BAA+B,MAAM,KAAK;;;ACAnH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,gCAAgC,MAAM,KAAK;;;ACApH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;ACMjH;;;;;;;;;;;;;;;;;;CAkBC,GACD,uDAAa;AAxBb;AAEA,MAAM,QAAQ;AACd,MAAM,QAAQ;AAqBP,MAAM;IAOT,iBAAiB;IACjB,YACI,CAEC,CACH;aATM,YAAmC;aACnC,aAAiE,EAAE;aACnE,YAA0B;QAQ9B,IAAI,CAAC,SAAS,EAAE;IACpB;IAEA,QAAS,KAAqD,EAAQ;QAClE,IAAI,MAAM,SAAS,QAAQ;YACvB,IAAI,CAAC,YAAY;YACjB,IAAI,CAAC,YAAY;YAEjB,IAAI,MAAM,gBAAgB;gBAEtB,IAAI,CAAC,OAAO;oBACR,MAAM;oBACN,IAAI;oBACJ,IAAI;oBACJ,WAAW;oBACX,IAAI,MAAM;oBACV,IAAI,MAAM;oBACV,WAAW,MAAM;gBACrB;gBAEA,IAAI,CAAC,WAAW,KAAK;gBACrB;YACJ;QAEJ;QAEA,IAAI,MAAM,SAAS,UAAU,IAAI,CAAC,WAAW;YAEzC,IAAI,MAAM,gBAAgB;gBAEtB,IAAI,IAAI,CAAC,cAAc,MAAM;oBACzB,MAAM,KAAK,KAAK,IAAI,MAAM,IAAI,IAAI,CAAC,UAAU;oBAC7C,MAAM,KAAK,KAAK,IAAI,MAAM,IAAI,IAAI,CAAC,UAAU;oBAE7C,IAAI,KAAK,KAAK,KAAK,GAAG;wBAClB,IAAI,CAAC,YAAY,KAAK,KAAK,QAAQ;wBAEnC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,QAAQ,IAAK;4BAC7C,MAAM,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE;4BAC5B,IAAI,EAAE,SAAS;gCACX,IAAI,IAAI,CAAC,cAAc,OACnB,EAAE,IAAI,IAAI,CAAC,UAAU;qCAErB,EAAE,IAAI,IAAI,CAAC,UAAU;;4BAG7B,IAAI,CAAC,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;wBAC3B;wBACA,IAAI,CAAC,aAAa,EAAE;oBACxB;gBACJ;gBAEA,IAAI,IAAI,CAAC,cAAc,MAAM;oBACzB,IAAI,CAAC,WAAW,KAAK;oBACrB;gBACJ;gBAEA,IAAI,IAAI,CAAC,cAAc,OACnB,MAAM,IAAI,IAAI,CAAC,UAAU;qBAEzB,MAAM,IAAI,IAAI,CAAC,UAAU;YAGjC,OACI,IAAI,IAAI,CAAC,WAAW,SAAS,GAAG;gBAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,QAAQ,IACxC,IAAI,CAAC,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC,UAAU,CAAC,EAAE;gBAE7C,IAAI,CAAC,aAAa,EAAE;YACxB;QAGR;QAEA,IAAI,MAAM,SAAS,MAAM;YACrB,IAAI,CAAC,aAAa,EAAE;YACpB,IAAI,CAAC,YAAY;QACrB;QAEA,IAAI,CAAC,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;IAC3B;AACJ;;;;;8CCjHa;AAAN,MAAM,WAAsB;IAC/B,cAAc;AAClB;;;;;ACJA;;;CAGC,GACD,qDAAa;AARb;AAEA;AAMO,MAAM;IAOT,iBAAiB;IACjB,YACI,CAIC,CACH;QACE,IAAI,CAAC,SAAS,EAAE;QAEhB,MAAM,QAAQ,EAAE,QAAQ,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM;QAC1C,MAAM,QAAQ,QAAQ,IAAI,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,QAAQ,EAAE;QACtD,MAAM,SAAS,QAAQ,IAAI,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,SAAS,EAAE;QAExD,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO;QAC/B,IAAI,CAAC,qBAAqB;YACtB,IAAI,CAAC,OAAO,MAAM,kBAAkB,SAAS,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,WAAW,CAAA,GAAA,YAAI,EAAE,YAAY;QACzG;QACA,IAAI,CAAC;QACL,IAAI,CAAC,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAEvB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,OAAO;YACP,QAAQ;YACR,gBAAgB,QAAQ,IAAI,cAAc;QAC9C;QAEA,WAAW,IAAM,IAAI,CAAC,UAAU;QAChC,CAAA,GAAA,YAAI,EAAE,kBAAkB,IAAI,CAAC;IACjC;IAEA,aAAiC;QAC7B,OAAO,IAAI,CAAC;IAChB;IAEA,SAAgB;QACZ,IAAI,CAAC,IAAI,CAAC,KACN;QAGJ,IAAI,CAAC,IAAI;QACT,IAAI,CAAC,IAAI,UAAU,GAAG,GAAG,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO;QACxD,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,QAAQ,IAAK;YACzC,MAAM,QAAQ,IAAI,CAAC,MAAM,CAAC,EAAE;YAC5B,IAAI,CAAC,MAAM,aAAa,MAAM,YAAY,GACtC;YAEJ,IAAI,CAAC,IAAI,cAAc,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;YACtC,IAAI,CAAC,IAAI,2BAA2B,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;YACnD,IAAI,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,OACzC,IAAI,CAAC,IAAI,wBAAwB;YAErC,IAAI,CAAC,IAAI,UAAU,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,GAAG,GAAG,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO;QAClF;QACA,IAAI,CAAC,IAAI;IACb;IAEA,UAAiB;QACb,CAAA,GAAA,YAAI,EAAE,qBAAqB,IAAI,CAAC;IACpC;AACJ;;;;;AC5DA;;;;;;;;;;;;;;;;;;;;;;;;;;CA0BC,GACD,mDAAa;AA1Cb;AACA;;AAIA;AAqCO,MAAM;IAyCD,eAAsB;QAC1B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,kBAAkB;QACtD,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,kBAAkB;QACtD,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,kBAAkB;QAC9D,IAAI,CAAC,OAAO,SAAS,IAAI,CAAC,MAAM,SAAS,IAAI,CAAC,kBAAkB;QAChE,IAAI,CAAC,OAAO,UAAU,IAAI,CAAC,QAAQ,IAAI,CAAC;YACpC,OAAO;gBAAC,GAAG,KAAK,IAAI,IAAI,CAAC,kBAAkB;gBAAO,GAAG,KAAK,IAAI,IAAI,CAAC,kBAAkB;YAAK;QAC9F;IACJ;IAEA;;;;;;;KAOC,GACD,AAAQ,WAAY,EAAU,EAAE,EAAU,EAAa;QACnD,IAAI,CAAC,IAAI,CAAC,iBACN,OAAO;YAAC,GAAG;YAAI,GAAG;QAAE;QAExB,IAAI;QACJ,MAAM,OAOF;YACA,GAAG;YACH,GAAG;YACH,MAAM;gBACF,GAAG;gBACH,GAAG;YACP;QACJ;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;YACxC,OAAO,KAAK,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE;YAClC,IAAI,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,kBAAkB,OACjD;gBAAA,IAAI,KAAK,MAAM,aAAa,OAAO,KAAK,KAAK,GAAI;oBAC7C,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;oBACtB,KAAK,KAAK,IAAI;gBAClB;YAAA;QAER;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;YACxC,OAAO,KAAK,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE;YAClC,IAAI,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,kBAAkB,OACjD;gBAAA,IAAI,KAAK,MAAM,aAAa,OAAO,KAAK,KAAK,GAAI;oBAC7C,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;oBACtB,KAAK,KAAK,IAAI;gBAClB;YAAA;QAER;QAEA,IAAI,KAAK,MAAM,aAAa,KAAK,MAAM,WACnC,OAAO;YACH,GAAG;YACH,GAAG;QACP;QAEJ,OAAO;YACH,GAAG,KAAK,KAAK;YACb,GAAG,KAAK,KAAK;QACjB;IACJ;IAEA;;;;;;;KAOC,GACD,AAAQ,gBAAiB,WAAmB,EAAE,EAAU,EAAE,EAAU,EAAa;QAC7E,IAAI,CAAC,IAAI,CAAC,eACN,OAAO;YACH,GAAG;YACH,GAAG;QACP;QAEJ,MAAM,OAAO,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,MAAM,SAAS,IAAI,KAAK;QAC7D,OAAO,CAAA,GAAA,MAAC,EAAE,mBACN;YAAC,GAAG,IAAI,CAAC,MAAM;YAAG,GAAG,IAAI,CAAC,MAAM;QAAC,GACjC,CAAA,GAAA,gCAAW,EAAE,IAAI,CAAC,OAAO,OAAQ,CAAA;YAAC;YAAG;SAAE,CAAC,SAAS,eAAe,IAAI,EAAC,GAAI,IAAI,CAAC,QAC9E;YAAC,GAAG;YAAI,GAAG;QAAE;IAErB;IAEA;;;KAGC,GACD,AAAQ,wBAA+B;QACnC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,CAAC,IAAI,CAAC,MAAM,QAAQ,GAAI,WAAW;QACxD,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,CAAC,IAAI,CAAC,MAAM,SAAS;QAE1C,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,IAAI,CAAC,MAAM,QAAQ,GAAI,YAAY;QACxD,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,CAAC,IAAI,CAAC,MAAM,SAAS;QAE1C,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,IAAI,CAAC,MAAM,QAAQ,GAAI,eAAe;QAC3D,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,IAAI,CAAC,MAAM,SAAS;QAEzC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,CAAC,IAAI,CAAC,MAAM,QAAQ,GAAI,cAAc;QAC3D,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAK,IAAI,CAAC,MAAM,SAAS;IAC7C;IAEA;;;;;;;KAOC,GACD,AAAQ,aAAc,YAAqB,EAAE,aAAsB,EAAQ;QACvE,IAAI,CAAC,IAAI,CAAC,eACN;QAEJ,MAAM,UAAU,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO;QACvD,MAAM,YAAY,KAAK,IAAI,IAAI,CAAC,MAAM,WAAW,MAAM,QAAQ;QAC/D,IAAI,iBAAiB,CAAC,cAAc;YAChC,MAAM,YAAY,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YAC/D,IAAI,WAAW,IAAI,CAAC,QAAQ;YAC5B,IAAI,SACA,WAAW,AAAC,CAAA,YAAY,IAAI,CAAC,MAAM,IAAI,IAAI,IAAI,CAAC,MAAM,IAAI,CAAA,MAAO,IAC7D,CAAA,GAAA,MAAC,EAAE,UAAU,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY;YAEhD,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,GACxC,YAAY;YAEhB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW;YAChC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW;YAChC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,WAAW;YAC/B,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,WAAW;QACnC;QACA,IAAI,CAAC,iBAAiB,cAAc;YAChC,MAAM,WAAW,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YAC9D,IAAI,YAAY,WAAW,IAAI,CAAC;YAChC,IAAI,SACA,YAAY,AAAC,CAAA,YAAY,IAAI,CAAC,MAAM,IAAI,IAAI,IAAI,CAAC,MAAM,IAAI,CAAA,MAAO,IAC9D,CAAA,GAAA,MAAC,EAAE,UAAU,aAAa,CAAA,GAAA,MAAC,EAAE,YAAY;YAEjD,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,GACxC,aAAa;YAEjB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY;YACjC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY;YACjC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,YAAY;YAChC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,YAAY;QACpC;IACJ;IAGA;;;KAGC,GACD,AAAQ,4BAAmC;QAEvC,uCAAuC;QACvC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,aACX;YAAC,GAAG;YAAG,GAAG;QAAC,GACX;YACI,GAAG,AAAC,CAAA,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA,IAAK;YAC7C,GAAG,AAAC,CAAA,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA,IAAK;QACjD,GACA,IAAI,CAAC,MAAM;QAEf,IAAI,CAAC,MAAM,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM;QAClC,IAAI,CAAC,MAAM,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM;QAElC,cAAc;QACd,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QACvD,IAAI,CAAC,MAAM,SAAS,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAExD,kDAAkD;QAClD,IAAI,CAAC;QAEL,IAAI,CAAC;IACT;IAEA;;;KAGC,GACD,AAAQ,UAAW,YAAsB,EAAQ;QAC7C,IAAI,CAAC;QAEL,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS;YACjB,MAAM,AAAC,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,OAAO,IAAK;YACnD,KAAK,AAAC,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,OAAO,IAAK;YAClD,iBAAiB;YACjB,WAAW,YAAY,IAAI,CAAC,MAAM,WAAW;QACjD;QAEA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU;YAClB,OAAO,KAAK,IAAI,IAAI,CAAC,OAAO,SAAS;YACrC,QAAQ,KAAK,IAAI,IAAI,CAAC,OAAO,UAAU;YACvC,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;YACrE,KAAK,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;QACxE;QAEA,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAChB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAChB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAChB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAEhB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QAGd,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI,AAAC,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM,SAAS,IAAI,CAAC,kBAAkB,SAAS,IAAK;QACvF,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,cACD;YAAA,IAAI,IAAI,CAAC,UACL,IAAI,CAAC,SAAS,CAAA,GAAA,iCAAY,EAAE,IAAI,CAAC;QACrC;IAER;IAIA,iBAAiB;IACjB,YACI,MAYC,CACH;aAtRe,SAAS;YACtB,GAAG;YACH,GAAG;YACH,OAAO;YACP,QAAQ;YACR,SAAS;gBAAC;oBAAC,GAAG;oBAAG,GAAG;gBAAC;aAAE;QAC3B;aACiB,cAAc,EAAG,+CAA+C;;aAOhE,gBAAgB;YAAC;YAAM;YAAK;YAAM;YAAK;YAAM;YAAK;YAAM;SAAI;aAC5D,WAAW;aACX,WAAW;aAKX,UAAkC,EAAE;aAIpC,QAA8B,EAAE;QA8P7C,IAAI,CAAC,oBAAoB;YAAC,GAAG,OAAO,iBAAiB;QAAA;QACrD,IAAI,CAAC,QAAQ;YACT,GAAG,OAAO;YACV,GAAG,OAAO;YACV,OAAO,OAAO;YACd,QAAQ,OAAO;YACf,UAAU,OAAO;QACrB;QAEA,IAAI,CAAC,gBAAgB,OAAO;QAE5B,IAAI,CAAC,QAAQ,OAAO;QACpB,IAAI,CAAC,QAAQ,OAAO;QACpB,IAAI,CAAC,WAAW,OAAO;QACvB,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,MAAM;QAE3C,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,UAAU;YACd;QACJ;QAEA,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,KAAK;gBACD,UAAU;gBACV,QAAQ;gBACR,WAAW;YACf;QACJ;QAEA,MAAM,mBAAmB;YACrB,GAAG;YACH,GAAG;QACP;QACA,SAAS;YACL,iBAAiB,IAAI;YACrB,iBAAiB,IAAI;QACzB;QACA,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY,CAAC;QAEvC,IAAI,eAAe;YACf,GAAG;YACH,GAAG;QACP;QACA,IAAI,CAAC,wBAAwB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAChD,QAAQ,IAAI,CAAC;YACb,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,eACf,eAAe;oBAAC,GAAG,IAAI,CAAC,MAAM;oBAAG,GAAG,IAAI,CAAC,MAAM;gBAAC;gBAEpD,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,IAAI,CAAC,MAAM,IAAI,aAAa,IAAI,AAAC,CAAA,MAAM,QAAQ,MAAM,SAAS,IAAK,IAAI,CAAC,kBAAkB;oBAC1F,IAAI,CAAC,MAAM,IAAI,aAAa,IAAI,AAAC,CAAA,MAAM,QAAQ,MAAM,SAAS,IAAK,IAAI,CAAC,kBAAkB;oBAG1F,IAAI;oBACJ,IAAI,OAKA;wBACA,OAAO;wBACP,OAAO;oBACX;oBACA,IAAI,IAAI,CAAC,iBAAiB;wBACtB,IAAI;wBACJ,IAAK,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;4BACpC,OAAO,KAAK,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;4BAC5C,IAAI,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,kBAAkB,OACjD;gCAAA,IAAI,KAAK,MAAM,aAAa,OAAO,KAAK,OAAO;oCAC3C,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;oCACtB,KAAK,QAAQ;gCACjB;4BAAA;wBAER;wBACA,IAAK,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;4BACpC,OAAO,KAAK,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;4BAC5C,IAAI,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,kBAAkB,OACjD;gCAAA,IAAI,KAAK,MAAM,aAAa,OAAO,KAAK,OAAO;oCAC3C,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;oCACtB,KAAK,QAAQ;gCACjB;4BAAA;wBAER;wBAEA,IAAI;wBACJ,IAAK,IAAI,GAAG,IAAI,GAAG,IAAK;4BACpB,KAAK,CAAA,GAAA,gCAAW,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;4BAC7D,IAAI;4BACJ,IAAK,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;gCACpC,OAAO,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;gCACpC,IAAI,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,kBAAkB,OACjD;oCAAA,IAAI,KAAK,MAAM,aAAa,OAAO,KAAK,OAAO;wCAC3C,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,GAAI,CAAA,GAAG,IAAI,IAAI,CAAC,MAAM,CAAA;wCAC5C,KAAK,QAAQ;oCACjB;gCAAA;4BAER;4BACA,IAAK,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;gCACpC,OAAO,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;gCACpC,IAAI,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,kBAAkB,OACjD;oCAAA,IAAI,KAAK,MAAM,aAAa,OAAO,KAAK,OAAO;wCAC3C,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,GAAI,CAAA,GAAG,IAAI,IAAI,CAAC,MAAM,CAAA;wCAC5C,KAAK,QAAQ;oCACjB;gCAAA;4BAER;wBACJ;oBACJ;oBACA,IAAI,IAAI,CAAC,YAAY,kBAAkB,SAAS;wBAC5C,IAAI,YAAY,CAAA,GAAA,MAAC,EAAE,mBACf;4BAAC,GAAG;4BAAG,GAAG,aAAa;wBAAC,GACxB;4BAAC,GAAG;4BAAI,GAAG,aAAa;wBAAC,GACzB;4BAAC,GAAG,IAAI,CAAC,MAAM;4BAAG,GAAG,IAAI,CAAC,MAAM;wBAAC;wBACrC,IAAI,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,UAAU,GAAG,UAAU,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;wBACtE,OAAO;4BACH,GAAG,UAAU;4BACb,GAAG,UAAU;4BACb,OAAO;4BACP,OAAO;wBACX;wBAEA,YAAY,CAAA,GAAA,MAAC,EAAE,mBACX;4BAAC,GAAG,aAAa;4BAAG,GAAG;wBAAC,GACxB;4BAAC,GAAG,aAAa;4BAAG,GAAG;wBAAE,GACzB;4BAAC,GAAG,IAAI,CAAC,MAAM;4BAAG,GAAG,IAAI,CAAC,MAAM;wBAAC;wBACrC,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,UAAU,GAAG,UAAU,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;wBAClE,IAAI,OAAO,KAAK,OACZ,OAAO;4BACH,GAAG,UAAU;4BACb,GAAG,UAAU;4BACb,OAAO;4BACP,OAAO;wBACX;wBAGJ,YAAY,CAAA,GAAA,MAAC,EAAE,mBACX;4BAAC,GAAG,aAAa;4BAAG,GAAG,aAAa;wBAAC,GACrC;4BAAC,GAAG,aAAa,IAAI;4BAAG,GAAG,aAAa,IAAI;wBAAC,GAC7C;4BAAC,GAAG,IAAI,CAAC,MAAM;4BAAG,GAAG,IAAI,CAAC,MAAM;wBAAC;wBACrC,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,UAAU,GAAG,UAAU,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;wBAClE,IAAI,OAAO,KAAK,OACZ,OAAO;4BACH,GAAG,UAAU;4BACb,GAAG,UAAU;4BACb,OAAO;4BACP,OAAO;wBACX;wBAGJ,YAAY,CAAA,GAAA,MAAC,EAAE,mBACX;4BAAC,GAAG,aAAa;4BAAG,GAAG,aAAa;wBAAC,GACrC;4BAAC,GAAG,aAAa,IAAI;4BAAG,GAAG,aAAa,IAAI;wBAAC,GAC7C;4BAAC,GAAG,IAAI,CAAC,MAAM;4BAAG,GAAG,IAAI,CAAC,MAAM;wBAAC;wBACrC,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,UAAU,GAAG,UAAU,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;wBAClE,IAAI,OAAO,KAAK,OACZ,OAAO;4BACH,GAAG,UAAU;4BACb,GAAG,UAAU;4BACb,OAAO;4BACP,OAAO;wBACX;oBAER;oBACA,IAAI,KAAK,KAAK,WACV,IAAI,CAAC,MAAM,IAAI,KAAK;oBAExB,IAAI,KAAK,KAAK,WACV,IAAI,CAAC,MAAM,IAAI,KAAK;oBAGxB,iBAAiB;oBACjB,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,GAAG;wBAC1C,CAAA,GAAA,+BAAU,EAAE,IAAI,CAAC;wBACjB,IAAI,CAAC;oBACT;oBAEA,IAAI,CAAC;gBACT;YACJ;QACJ;QAEA,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,AAAC,CAAA,CAAC;YACE,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG;gBACxB,GAAG;gBACH,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;oBACN,KAAK;wBACD,OAAO,IAAI,CAAC,WAAW;wBACvB,QAAQ,IAAI,CAAC,WAAW;wBACxB,YAAY;wBACZ;;;;;iCAKK,GACL,cAAc,IAAI,CAAC,WAAW;wBAC9B,UAAU;wBACV,QAAQ;oBACZ;gBACJ;gBACA,GAAG;gBACH,GAAG;gBACH,YAAY;oBACR,GAAG;oBACH,GAAG;gBACP;YACJ;YACA,EAAE,YAAY;gBAEV,gBAAgB;gBAChB,+DAA+D;gBAC/D,MAAM,YAAY;oBAAC;wBAAC;wBAAI;qBAAG;oBAAE;wBAAC;wBAAG;qBAAG;oBAAE;wBAAC;wBAAG;qBAAE;oBAAE;wBAAC;wBAAI;qBAAE;iBAAC,CAAC,IAAI,CAAA;oBACvD,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAI,IAAI;oBACtC,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,MAAM,SAAS,IAAI,IAAI;oBACvC,OAAO;gBACX;gBACA,MAAM,aAAa,KAAK,IAAI,IAAI,CAAC,OAAO,SAAS,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,UAAU,KAAK,KAAK;gBAEhG,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,IAAI;oBACT,MAAM,AAAC,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,WAAW,IAAI,SAAS,CAAC,EAAE,CAAC,EAAE,GAAG,aAAc;oBACxF,KAAK,AAAC,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,WAAW,IAAI,SAAS,CAAC,EAAE,CAAC,EAAE,GAAG,aAAc;gBAC3F;gBAGA,SAAS;gBACT,IAAI,QAAQ,CAAA,GAAA,MAAC,EAAE,iBACX;oBACI,GAAG,IAAI,CAAC,MAAM;oBACd,GAAG,IAAI,CAAC,MAAM;gBAClB,GACA,CAAA,GAAA,gCAAW,EAAE,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,UAC5B,KAAK,oBAAoB;gBAC7B,MAAO,QAAQ,EACX,SAAS;gBAEb,MAAM,QAAQ,KAAK,MAAM,QAAQ,MAAM,IAAI,CAAC,cAAc;gBAC1D,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,IAAI;oBACT,QAAQ,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG;gBACxC;YACJ;YAEA,EAAE,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBACvC,QAAQ,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;gBACxB,aAAa;gBACb,WAAW,CAAC;oBACR,MAAM;oBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QACjD,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,aAAa,CAAA,GAAA,gCAAW,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;yBAElF,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBAChE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW,KAAK,MAAM,KAAK,IAAI,CAAC,kBAAkB;wBAClE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW,KAAK,MAAM,KAAK,IAAI,CAAC,kBAAkB;wBAElE,IAAI,KAAK;4BACL,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW;4BAC9B,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW;wBAClC;wBACA,KAAK,IAAI,CAAC,gBAAgB,GAAG,GAAG,GAAG,GAAG;wBACtC,IAAI,CAAC,IAAI,CAAC,eACN,KAAK,IAAI,CAAC,WAAW,GAAG,GAAG,GAAG;wBAGlC,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,GAAG;4BAC1C,GAAG,IAAI,KAAK,MAAM,GAAG;4BACrB,GAAG,IAAI,KAAK,MAAM,GAAG;wBACzB;wBAEA,MAAM,KAAK,CAAA,GAAA,oCAAe,EAAE,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC;wBAE7C,MAAM,KAAK,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;wBAClC,MAAM,KAAK,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;wBAClC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,GAAG;wBACvB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,GAAG;wBAEvB,IAAI,UAAoB,EAAE;wBAC1B,IAAI,MAAM,GACN,UAAU;4BAAC;4BAAG;4BAAG;yBAAE;6BAChB,IAAI,MAAM,GACb,UAAU;4BAAC;4BAAG;4BAAG;yBAAE;6BAChB,IAAI,MAAM,GACb,UAAU;4BAAC;4BAAG;4BAAG;yBAAE;6BAChB,IAAI,MAAM,GACb,UAAU;4BAAC;4BAAG;4BAAG;yBAAE;wBAGvB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;wBAC7C,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;wBAC7C,IAAI,IAAI,CAAC,YAAY,UAAU,UAAU;4BACrC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,KAAK;4BAC9B,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,KAAK;4BAC9B,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;4BACtD,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;wBAC1D;wBAEA,IAAI,CAAC;oBAET;gBACJ;YACJ;QAEJ,CAAA,EAAG;QAGP,IAAI,CAAC;QACL,IAAI,CAAC;QAEL,IAAI;QACJ,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,AAAC,CAAA,CAAC;YACE,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG;gBACZ,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;oBACN,KAAK;wBACD,OAAO,IAAI,CAAC,WAAW;wBACvB,QAAQ,IAAI,CAAC,WAAW;wBACxB;;;;;iCAKK,GACL,UAAU;oBACd;gBACJ;YACJ;YACA,MAAM,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE;YACvB,EAAE,YAAY;gBACV,IAAI,MAAM,GACN,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,IAAI;oBACT,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;oBACrE,KAAK,AAAC,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,WAAY;oBACtF,OAAO,KAAK,IAAI,IAAI,CAAC,OAAO,SAAS;oBACrC,QAAQ,IAAI,CAAC,WAAW;gBAC5B;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,IAAI;oBACT,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;oBACrE,KAAK,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;oBACpE,OAAO,IAAI,CAAC,WAAW;oBACvB,QAAQ,KAAK,IAAI,IAAI,CAAC,OAAO,UAAU;gBAC3C;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,IAAI;oBACT,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;oBACrE,KAAK,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAE,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;oBACnE,OAAO,KAAK,IAAI,IAAI,CAAC,OAAO,SAAS;oBACrC,QAAQ,IAAI,CAAC,WAAW;gBAC5B;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,IAAI;oBACT,MAAM,AAAC,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,WAAY;oBACvF,KAAK,KAAK,IAAI,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,KAAK;oBACpE,OAAO,IAAI,CAAC,WAAW;oBACvB,QAAQ,KAAK,IAAI,IAAI,CAAC,OAAO,UAAU;gBAC3C;gBAEJ,IAAI,cAAc,KAAK,MAAM,IAAI,CAAC,MAAM,WAAW;gBACnD,MAAO,cAAc,EACjB,eAAe;gBAEnB,cAAc,AAAC,CAAA,IAAI,IAAI,IAAI,WAAU,IAAK,IAAI,CAAC,cAAc;gBAC7D,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,aAAa,CAAC,YAAY,GAAG;YAE1D;YAEA,MAAM,aAAa;gBAAC;gBAAG;aAAE,CAAC,SAAS;YACnC,EAAE,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBACvC,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;gBACtB,aAAa;gBACb,WAAW,CAAC;oBACR,MAAM;oBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACzD,IAAI,YACA,aAAa,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;6BAElD,aAAa,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;wBAEtD;oBACJ;oBACA,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;wBACzD,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,aAAa;4BAAC,GAAG;4BAAG,GAAG;wBAAC,GACnC;4BAAC,GAAG,MAAM,KAAK,IAAI,CAAC,kBAAkB;4BAAO,GAAG,MAAM,KAAK,IAAI,CAAC,kBAAkB;wBAAK,GACvF,CAAC,IAAI,CAAC,MAAM;wBAChB,IAAI,KAAK;4BACL,IAAI,IAAI;4BACR,IAAI,IAAI;wBACZ;wBACA,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,GACvC,KAAK,CAAA,GAAA,MAAC,EAAE,OAAO,kBAAkB,IAAI,GAAG,IAAI;wBAGhD,IAAI,UAAoB,EAAE;wBAC1B,IAAI,MAAM,GACN,UAAU;4BAAC;4BAAG;4BAAG;4BAAG;yBAAE;6BACnB,IAAI,MAAM,GACb,UAAU;4BAAC;4BAAG;4BAAG;4BAAG;yBAAE;6BACnB,IAAI,MAAM,GACb,UAAU;4BAAC;4BAAG;4BAAG;4BAAG;yBAAE;6BACnB,IAAI,MAAM,GACb,UAAU;4BAAC;4BAAG;4BAAG;4BAAG;yBAAE;wBAG1B,MAAM,YAAY,aAAa,MAAM;wBACrC,MAAM,IAAI,aAAa,GAAG,KAAK,GAAG;wBAElC,IAAI,YAAY;4BACZ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;4BACvC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;wBAC3C,OAAO;4BACH,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;4BACvC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;wBAC3C;wBACA,IAAI,IAAI,CAAC,YAAY,UAAU;4BAC3B,IAAI,YAAY;gCACZ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;gCACvC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;4BAC3C,OAAO;gCACH,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;gCACvC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,UAAU,IAAI;4BAC3C;;wBAGJ,IAAI,YACA,IAAI,CAAC,aAAa,OAAO;6BAEzB,IAAI,CAAC,aAAa,MAAM;wBAG5B,IAAI,CAAC;oBAET;gBACJ;YACJ;QAEJ,CAAA,EAAG;QAGP,IAAI,CAAC,YAAY;YACb,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;gBACN,KAAK;oBACD,QAAQ,SAAS,CAAA,GAAA,+BAAQ,IAAI;oBAC7B,OAAO,IAAI,CAAC,WAAW;oBACvB,QAAQ,IAAI,CAAC,WAAW;oBACxB,YAAY;oBACZ,cAAc,IAAI,CAAC,WAAW;oBAC9B,UAAU;oBACV,WAAW;gBACf;YACJ;YACA,GAAG;YACH,GAAG;YACH,MAAM;YACN,WAAW;gBACP,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,UAAU,IAAI;oBACtB,MAAM,AAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,WAAW,IAAK;oBAC/C,KAAK,AAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,WAAW,IAAK;gBAClD;YACJ;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,QAAQ,IAAI,CAAC,UAAU;YACvB,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,MAAM,AAAC,IAAI,CAAC,WAAW,IAAI,IAAK;gBAChC,KAAK,IAAI,CAAC,WAAW;gBACrB,YAAY;gBACZ,UAAU;YACd;QACJ;QAEA,IAAI,CAAC,uBAAuB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,UAAU;YACvB,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBAEzD,MAAM,SAAS,IAAI,CAAC,OAAO;oBAC3B,MAAM,SAAS;wBACX,GAAG,OAAO,OAAO,IAAI,CAAC,OAAO,aAAa,IAAI,CAAC,kBAAkB;wBACjE,GAAG,OAAO,MAAM,IAAI,CAAC,OAAO,YAAY,IAAI,CAAC,kBAAkB;oBACnE;oBACA,MAAM,KAAK;wBACP,GAAG,AAAC,CAAA,MAAM,UAAU,OAAO,CAAA,IAAK,IAAI,CAAC,kBAAkB;wBACvD,GAAG,AAAC,CAAA,MAAM,UAAU,OAAO,CAAA,IAAK,IAAI,CAAC,kBAAkB;oBAC3D;oBAEA,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,iBAAiB;wBAAC,GAAG,IAAI,CAAC,MAAM;wBAAG,GAAG,IAAI,CAAC,MAAM;oBAAC,GAAG,MAAM;oBACxE,IAAI,CAAC,MAAM,WAAW;oBACtB,MAAM,UAAU,KAAK,MAAM,IAAI,MAAM,KAAK;oBAC1C,IAAI,IAAI,CAAC,YAAY,kBAAkB,SACnC,IAAI,CAAC,MAAM,WAAW;yBACnB,IAAI,IAAI,CAAC,mBAAmB,KAAK,IAAI,UAAU,KAAK,GACvD,IAAI,CAAC,MAAM,WAAW;oBAE1B,IAAI,CAAC;gBAET;gBACA,IAAI,MAAM,SAAS,aACf;oBAAA,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,GAAG;wBAC1C,CAAA,GAAA,+BAAU,EAAE,IAAI,CAAC;wBACjB,IAAI,CAAC;wBACL,IAAI,CAAC;oBACT;gBAAA;YAER;QACJ;QAEA,CAAA,GAAA,+BAAU,EAAE,IAAI,CAAC;QACjB,IAAI,CAAC,UAAU;QACf,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,SAAS;YACpB,IAAI,CAAC;YACL,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACd,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YAChB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YAChB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YAChB,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;YAChB,IAAI,CAAC,UAAU;SAClB;IAGL;IAIA,WAA4B;QACxB,OAAO,CAAA,GAAA,iCAAY,EAAE,IAAI,CAAC;IAC9B;IAEA,iBAAkB,CAAU,EAAQ;QAChC,IAAI,CAAC,gBAAgB;QACrB,IAAI,KAAK,IAAI,CAAC,MAAM,UAAU,KAAK,IAAI,CAAC,MAAM,WAAW,GACrD,IAAI,CAAC,QAAQ,KAAK,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,MAAM;IAE5D;IAEA,YAAa,CAAU,EAAQ;QAC3B,IAAI,CAAC,kBAAkB;IAC3B;IAEA,OAAQ,CAAY,EAAQ;QACxB,IAAI,CAAC,MAAM,IAAI,EAAE;QACjB,IAAI,CAAC,MAAM,IAAI,EAAE;QACjB,IAAI,CAAC,UAAU;IACnB;IAEA,KAAM,EAAU,EAAE,EAAU,EAAQ;QAChC,IAAI,CAAC,MAAM,KAAK;QAChB,IAAI,CAAC,MAAM,KAAK;QAChB,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,CAAS,EAAE,CAAS,EAAQ;QACjC,IAAI,CAAC,MAAM,QAAQ;QACnB,IAAI,CAAC,MAAM,SAAS;QACpB,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,GACvC,CAAA,GAAA,+BAAU,EAAE,IAAI,CAAC;QAErB,IAAI,CAAC;QACL,IAAI,CAAC,UAAU;IACnB;IAEA,YAAa,CAAS,EAAQ;QAC1B,IAAI,CAAC,MAAM,WAAW;QACtB,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,GAAG;YAC1C,CAAA,GAAA,+BAAU,EAAE,IAAI,CAAC;YACjB,IAAI,CAAC;QACT;QACA,IAAI,CAAC,UAAU;IACnB;IAEA,qBAAsB,SAAkD,EAAQ;QAC5E,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC;QACL,IAAI,CAAC;IACT;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,sBAAsB;QAC3B,IAAI,CAAC,QAAQ,QAAQ,CAAA,OAAQ,KAAK,gBAAgB;QAClD,IAAI,CAAC,MAAM,QAAQ,CAAA,OAAQ,KAAK,gBAAgB;QAChD,IAAI,CAAC,qBAAqB;IAC9B;AAEJ;;;ACz6BA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,+BAA+B,MAAM,KAAK;;;;;AC6BnH;;;;;;;;CAQC,GACD,iDAAgB;AAchB,mDAAgB;AAUhB;;;;;;;;;;CAUC,GACD,sDAAgB;AAiBhB;;;;;CAKC,GACD,kDAAgB;AA/FhB;AAqCO,SAAS,YAAa,SAAyB;IAClD,IAAI,KAAK,IAAI,UAAU,YAAY,OAAO,GACtC;IAGJ,UAAU,QAAQ,KAAK,MAAM,UAAU;IACvC,UAAU,SAAS,KAAK,MAAM,UAAU;IACxC,8BAA8B;IAC9B,gFAAgF;IAChF,MAAM,YAAY,KAAK,IAAI,UAAU,WAAW,MAAM,QAAQ;IAC9D,UAAU,IAAI,AAAC,AAAC,CAAA,YAAY,UAAU,SAAS,UAAU,KAAI,IAAK,MAAM,IAAK,KAAK,MAAM,UAAU,KAAK,KAAK,MAAM,UAAU,IAAI,OAAO;IACvI,UAAU,IAAI,AAAC,AAAC,CAAA,YAAY,UAAU,QAAQ,UAAU,MAAK,IAAK,MAAM,IAAM,KAAK,MAAM,UAAU,KAAK,KAAK,MAAM,UAAU,IAAI,OAAO;AAC5I;AAEO,SAAS,cAAe,SAAyB;IACpD,OAAO;QACH,GAAG,UAAU;QACb,GAAG,UAAU;QACb,OAAO,UAAU;QACjB,QAAQ,UAAU;QAClB,UAAU,UAAU;IACxB;AACJ;AAaO,SAAS,iBAAkB,CAAS,EAAE,CAAS,EAAE,SAAyB;IAC7E,IAAI,IAAI;IACR,KAAK,IAAI,UAAU;IACnB,KAAK,IAAI,UAAU;IAEnB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,aAAa;QAAC,GAAG;QAAG,GAAG;IAAC,GACnC;QAAC,GAAG;QAAI,GAAG;IAAE,GACb,CAAC,UAAU;IACf,KAAK,IAAI;IACT,KAAK,IAAI;IAET,OAAO;QACH,GAAG;QACH,GAAG;IACP;AACJ;AAQO,SAAS,aAAc,CAAS,EAAE,CAAS,EAAE,SAAyB;IACzE,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,aAAa;QAAC,GAAG;QAAG,GAAG;IAAC,GACnC;QAAC,GAAG;QAAG,GAAG;IAAC,GACX,UAAU;IACd,OAAO;QACH,GAAG,IAAI,IAAI,UAAU;QACrB,GAAG,IAAI,IAAI,UAAU;IACzB;AACJ;;;;;AC/FA;;CAEC,GACD,yDAAa;AAZb;AACA;AAGA;AAEA;AAMO,MAAM;IAaD,gBAAuB;QAC3B,MAAM,YAAY,IAAI,CAAC,cAAc;QAErC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAK,IAAI,CAAC;QACzB,IAAI;QACJ,IAAI,UAAU,GAAG,GAAG,IAAI,CAAC,cAAc,OAAO,IAAI,CAAC,cAAc;QACjE,CAAA,GAAA,MAAC,EAAE,+BACC,KACA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,OACjC,WACA,WACA,CAAA,GAAA,MAAC,EAAE,mBACC,WACA,UAAU,QAAQ,IAAI,CAAC,cAAc,OACrC,UAAU,SAAS,IAAI,CAAC,cAAc;QAG9C,IAAI;QACJ,IAAI,CAAC,QAAQ;IACjB;IAGA,mBAAmB;IACnB,YACI,CAOC,CACH;QACE,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,CAAC,cAAc,EAAE;QAErB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,OAAO,EAAE,eAAe;gBACxB,QAAQ,EAAE,gBAAgB;YAC9B;QACJ;QACA,IAAI,CAAC,OAAO,gBAAgB;YACxB,OAAO;QACX;QACA,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,CAAC,iBAAiB,EAAE;QAExB,IAAI,CAAC,kBAAkB,IAAI,CAAC,OAAO,IAAI,CAAA;YACnC,OAAO;gBACH,OAAO,KAAK;gBACZ,WAAW,KAAK;gBAChB,YAAY,KAAK,cAAc;gBAC/B,SAAS,KAAK;gBACd,aAAa;YACjB;QACJ;QACA,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC;QACrD,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,gBAAgB,SAAS,EAAE,CAAC,QAAQ,IAAI,CAAC;QAEnE,IAAI,CAAC,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACvB,OAAO,EAAE;YACT,QAAQ,EAAE;YACV,SAAS;gBACL,OAAO,EAAE;gBACT,QAAQ,EAAE;gBACV,QAAQ,IAAI,CAAC;YACjB;YACA,aAAa;YACb,cAAc,CAAC;gBACX,IAAI,CAAC,cAAc,aAAa,MAAM,gBAAgB,MAAM,SAAS,KAAK;gBAC1E,IAAI,CAAC,cAAc,aAAa,MAAM,UAAU,MAAM,SAAS,KAAK;YACxE;YACA,mBAAmB,CAAC;gBAChB,IAAI,CAAC,cAAc,qBAAqB;YAC5C;YACA,SAAS;QACb;QACA,IAAI,CAAC,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;YACxC,UAAU;YACV,YAAY;YACZ,aAAa;QACjB;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,QAAQ;QAG5B,IAAI,CAAC,gBAAgB;YACjB,GAAG,IAAI,CAAC,aAAa;YACrB,GAAG,IAAI,CAAC,cAAc;YACtB,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM;YAC9C,QAAQ,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM;QACnD;QACA,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,4BAAY,EAAE;YACnC,GAAG,IAAI,CAAC,cAAc;YACtB,GAAG,IAAI,CAAC,cAAc;YACtB,OAAO,IAAI,CAAC,cAAc;YAC1B,QAAQ,IAAI,CAAC,cAAc;YAC3B,UAAU;YACV,eAAe;YACf,OAAO;gBAAC;gBAAG,IAAI,CAAC;aAAW;YAC3B,OAAO;gBAAC;gBAAG,IAAI,CAAC;aAAY;YAC5B,mBAAmB,IAAI,CAAC,QAAQ;YAChC,UAAU;gBACN,IAAI,CAAC;YACT;QACJ;QACA,IAAI,CAAC,QAAQ,aAAa,OAAO,IAAI,CAAC,cAAc;QAExD,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,cAAc;YACpC,UAAU;YACV,MAAM;YACN,KAAK;QACT;QACA,WAAW,IAAM,IAAI,CAAC,iBAAiB;IAC3C;IAGA,sBAAsB;IACtB,KAAM,EAAU,EAAE,EAAU,EAAQ;QAChC,IAAI,CAAC,cAAc,KAAK,IAAI;IAChC;IAEA,QAAe;QACX,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM;QACjD,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM;QAEjD,IAAI,CAAC,cAAc,QAAQ,GAAG;QAC9B,IAAI,CAAC,cAAc,OAAO;YAAC,GAAG,IAAI;YAAG,GAAG,IAAI;QAAC;QAC7C,IAAI,CAAC,cAAc,YAAY;QAC/B,IAAI,CAAC;IACT;IAEA,kBAAyB;QAErB,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QACX,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,OACvC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,QACvC,IAAI,CAAC,YACL,IAAI,CAAC,aACL;QAGJ,IAAI,CAAC,cAAc,QAAQ,IAAI,OAAO,IAAI;QAC1C,IAAI,CAAC,cAAc,OAAO;YAAC,GAAG,IAAI,QAAQ;YAAG,GAAG,IAAI,SAAS;QAAC;QAC9D,IAAI,CAAC,cAAc,YAAY;QAC/B,IAAI,CAAC;IACT;IAEA,qBAA4B;QACxB,IAAI,CAAC,cAAc,OAAO;YAAC,GAAG,IAAI,CAAC,aAAa;YAAG,GAAG,IAAI,CAAC,cAAc;QAAC;QAC1E,IAAI,CAAC,cAAc,YAAY;QAC/B,IAAI,CAAC;IACT;IAEA;;KAEC,GACD,oBAAqC;QACjC,OAAO,IAAI,CAAC,cAAc;IAC9B;IAEA,iBAA2B;QACvB,MAAM,YAAY,IAAI,CAAC,cAAc;QACrC,OAAO,CAAA,GAAA,MAAC,EAAE,mBACN,WACA,UAAU,QAAQ,IAAI,CAAC,cAAc,OACrC,UAAU,SAAS,IAAI,CAAC,cAAc;IAE9C;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,QAAQ;QACb,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC;IACvB;AACJ;;;;;AC7MA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA;AAKE,OAAO,UAAU,QAAQ;;;ACL3B;AAEA,OAAO,eAAe,SAAS,cAAc;IAAE,OAAO;AAAK;AAE3D,IAAI,+CAA+C,QAAQ;AAC3D,QAAQ;AACR,QAAQ;AACR,QAAQ;AAER,IAAI,iBAAiB,4CAA4C,CAAC,UAAU,CAAC;IAC3E,KAAK;AACP,IACI,QAAQ,eAAe,OACvB,UAAU,eAAe,SACzB,KAAK,eAAe,IACpB,QAAQ,eAAe,OACvB,sBAAsB,eAAe,qBACrC,eAAe,eAAe,cAC9B,YAAY,eAAe,WAC3B,MAAM,eAAe,KACrB,QAAQ,eAAe,OACvB,QAAQ,eAAe;AAE3B,QAAQ,QAAQ;AAChB,QAAQ,MAAM;AACd,QAAQ,KAAK;AACb,QAAQ,QAAQ;AAChB,QAAQ,sBAAsB;AAC9B,QAAQ,UAAU;AAClB,QAAQ,eAAe;AACvB,QAAQ,YAAY;AACpB,QAAQ,QAAQ;AAChB,QAAQ,QAAQ;;;AChChB;AAEA,OAAO,eAAe,SAAS,cAAc;IAAE,OAAO;AAAK;AAE3D,IAAI,cAAc,QAAQ;AAC1B,IAAI,YAAY,QAAQ;AACxB,IAAI,QAAQ,QAAQ;AAEpB,SAAS,gBAAiB,CAAC;IAAI,OAAO,KAAK,EAAE,aAAa,IAAI;QAAE,WAAW;IAAE;AAAG;AAEhF,IAAI,uBAAuB,WAAW,GAAE,gBAAgB;AAExD,SAAS,qBAAqB,KAAK,EAAE,UAAU;IAC7C,IAAI,MAAM,QAAQ,CAAC,WAAW,KAAK,KAAK,WACtC,OAAO,MAAM,OAAO,IAAI,YAAY,MAAM,OAAO;AAErD;AAEA,SAAS,MAAM,UAAU,EAAE,GAAG,EAAE,SAAS;IACvC,IAAI,mBAAmB,EAAE;IACzB,IAAI,eAAe,MAAM,oBAAoB,YAAY,kBAAkB;IAE3E,IAAI,iBAAiB,SAAS,GAC5B,OAAO;IAGT,OAAO,eAAe,IAAI;AAC5B;AAEA,IAAI,gBAAgB,SAAS,cAAc,OAAO;IAChD,IAAI,QAAQ,oBAAoB,CAAC,UAAU,CAAC,UAAU,aAAa;IAEnE,MAAM,MAAM,SAAS,SAAU,KAAK;QAClC,IAA6C,IAAI,CAAC,QAAQ,GACxD,MAAM,IAAI,MAAM;QAGlB,IAAI,CAAC,WAAW;IAClB;IAEA,MAAM,SAAS;IAEf,IAAI,MAAM,SAAS;QACjB,IAAK,IAAI,OAAO,UAAU,QAAQ,OAAO,IAAI,MAAM,OAAO,OAAO,GAAG,OAAO,MAAM,OAC/E,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC,KAAK;QAG9B,IAAI,aAAa,UAAU,gBAAgB,MAAM,MAAM,YAAY;QACnE,MAAM,aAAa,OAAO,YAAY;QACtC,OAAO,MAAM,MAAM,MAAM,WAAW;IACtC;IAEA,IAAI,YAAY,SAAS;QACvB,IAAK,IAAI,QAAQ,UAAU,QAAQ,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,OAAO,QACpF,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM;QAGhC,IAAI,aAAa,UAAU,gBAAgB,MAAM,MAAM;QACvD,IAAI,YAAY,eAAe,WAAW;QAC1C,qBAAqB,OAAO;YAC1B,MAAM,WAAW;YACjB,QAAQ,gBAAgB,YAAY,MAAM,WAAW,SAAS;QAChE;QACA,OAAO;IACT;IAEA,IAAI,eAAe,SAAS;QAC1B,IAAK,IAAI,QAAQ,UAAU,QAAQ,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,OAAO,QACpF,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM;QAGhC,IAAI,aAAa,UAAU,gBAAgB,MAAM,MAAM;QACvD,qBAAqB,OAAO;IAC9B;IAEA,IAAI,KAAK,SAAS;QAChB,IAAK,IAAI,QAAQ,UAAU,QAAQ,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,OAAO,QACpF,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM;QAGhC,OAAO,MAAM,MAAM,YAAY,KAAK,WAAW;IACjD;IAEA,OAAO;QACL,KAAK;QACL,IAAI;QACJ,cAAc;QACd,WAAW;QACX,SAAS,SAAS,QAAQ,GAAG;YAC3B,IAAI,QAAQ,SAAU,GAAG;gBACvB,MAAM,QAAQ,CAAC,IAAI,GAAG;YACxB;QACF;QACA,OAAO,SAAS;YACd,MAAM,aAAa,CAAC;YACpB,MAAM,WAAW,CAAC;YAClB,MAAM,MAAM;QACd;QACA,aAAa;QACb,OAAO,MAAM;QACb,OAAO;QACP,qBAAqB,MAAM,oBAAoB,KAAK,MAAM,MAAM;QAChE,OAAO,MAAM,KAAK,MAAM,MAAM,YAAY;IAC5C;AACF;AAEA,IAAI,aAAa,SAAS,WAAW,IAAI;IACvC,IAAI,MAAM;IAEV,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,QAAQ,IAAK;QACpC,IAAI,MAAM,IAAI,CAAC,EAAE;QACjB,IAAI,OAAO,MAAM;QACjB,IAAI,QAAQ,KAAK;QAEjB,OAAQ,OAAO;YACb,KAAK;gBACH;YAEF,KAAK;gBAED,IAAI,MAAM,QAAQ,MAChB,QAAQ,WAAW;qBACd;oBACL,QAAQ;oBAER,IAAK,IAAI,KAAK,IACZ,IAAI,GAAG,CAAC,EAAE,IAAI,GAAG;wBACf,SAAU,CAAA,SAAS,GAAE;wBACrB,SAAS;oBACX;gBAEJ;gBAEA;YAGJ;gBAEI,QAAQ;QAEd;QAEA,IAAI,OAAO;YACT,OAAQ,CAAA,OAAO,GAAE;YACjB,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAEA,OAAO,CAAC,UAAU,GAAG;;;;;AC5IrB;;;CAGC,GACD,6CAAa;AAfb;AAeO,MAAM;IAgCD,SAAgB;QACpB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACd,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QACpB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QACpB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QACpB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QACpB,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QACf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QACf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QACf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QACf,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,eAAe;IACxB;IAEQ,SAAgB;QACpB,IAAI,CAAC,iBAAiB,IAAI;QAC1B,IAAI,CAAC,iBAAiB,IAAI;QAC1B,IAAI,CAAC,SAAS,IAAI,CAAC;IACvB;IAIA,mBAAmB;IACnB,YACI,MASC,CACH;QAEE,IAAI,CAAC,IAAI,OAAO;QAChB,IAAI,CAAC,IAAI,OAAO;QAChB,IAAI,CAAC,QAAQ,OAAO;QACpB,IAAI,CAAC,SAAS,OAAO;QACrB,IAAI,CAAC,QAAQ,OAAO;QACpB,IAAI,CAAC,WAAW,OAAO;QAEvB,MAAM,OAAO,OAAO;QACpB,MAAM,OAAO,OAAO;QACpB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE;QACjB,MAAM,cAAc;YAAC;YAAM;YAAK;YAAM;YAAK;YAAM;YAAK;YAAM;SAAI;QAEhE,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY,CAAC;QAEvC,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,UAAU;YACV,MAAM,AAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAS;YAC9B,KAAK,AAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAS;QACjC;QAEA,IAAI,CAAC,UAAU;YACX,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;gBACN,KAAK;oBACD,UAAU;oBACV,QAAQ;oBACR,QAAQ;gBACZ;YACJ;YACA,QAAQ;gBACJ,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ,IAAI;oBACpB,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,IAAK;oBAC3C,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,IAAK;oBAC1C,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAS;oBAC5D,QAAQ,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAS;gBACjE;YACJ;QACJ;QAEA,IAAI,CAAC,mBAAmB;YACpB,GAAG;YACH,GAAG;QACP;QACA,IAAI,CAAC,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACjD,QAAQ,IAAI,CAAC,QAAQ;YACrB,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBAEzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBAEzF,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;oBAEnB,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QAEA,IAAI,CAAC,mBAAmB;YACpB,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;gBACN,KAAK;oBACD,UAAU;oBACV,WAAW;oBACX,cAAc;gBAClB;YACJ;YACA,QAAQ;gBACJ,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,iBAAiB,IAAI;oBAC7B,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAS;oBACvC,KAAK,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,AAAC,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,CAAA,IAAK,IAAI,CAAC,QAAS;oBAClF,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAS;oBAC5D,QAAQ,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,IAAI,CAAC,QAAS;gBACrE;YACJ;QACJ;QAEA,IAAI,CAAC,iBAAiB;YAClB,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;gBACN,KAAK;oBACD,UAAU;oBACV,YAAY;oBACZ,aAAa;gBACjB;YACJ;YACA,QAAQ;gBACJ,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe,IAAI;oBAC3B,MAAM,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,AAAC,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,CAAA,IAAK,IAAI,CAAC,QAAS;oBACnF,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAS;oBACtC,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,IAAI,CAAC,QAAS;oBAChE,QAAQ,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAS;gBACjE;YACJ;QACJ;QAEA,MAAM,WAAW;QACjB,MAAM,cAAc;QAEpB,IAAI,CAAC,QAAQ;YACT;gBAAC,GAAG;gBAAG,GAAG;YAAC;YACX;gBAAC,GAAG,IAAI,CAAC;gBAAO,GAAG;YAAC;YACpB;gBAAC,GAAG,IAAI,CAAC;gBAAO,GAAG,IAAI,CAAC;YAAM;YAC9B;gBAAC,GAAG;gBAAG,GAAG,IAAI,CAAC;YAAM;SACxB;QAED,MAAM,eAAe,CAAC;YAClB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;YACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;YACtF,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACpC;QACA,MAAM,iBAAiB,CAAC;YACpB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;YACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;YACnF,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACpC;QACA,MAAM,kBAAkB,CAAC;YACrB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;YACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;YACnF,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACpC;QACA,MAAM,gBAAgB,CAAC;YACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK;YACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;YACtF,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACpC;QAKA,IAAI,CAAC,QAAQ,EAAE;QACf,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,AAAC,CAAA,CAAC;YAEE,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;gBACb,KAAK;oBACD,OAAO,WAAW;oBAClB,QAAQ,WAAW;oBACnB,qBAAqB;oBACrB,UAAU;gBACd;YACJ;YAEA,MAAM,SAAS;gBACX,IAAI,MAAM,GACN,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI;oBACP,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACrD,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,WAAW,IAAI,cAAe;oBACnE,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAQ,cAAc,IAAK;oBAC9E,QAAQ,AAAC,WAAW,IAAK;gBAC7B;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI;oBACP,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACrD,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACpD,OAAO,AAAC,WAAW,IAAK;oBACxB,QAAQ,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAQ,cAAc,IAAK;gBACnF;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI;oBACP,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACrD,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACpD,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAQ,cAAc,IAAK;oBAC9E,QAAQ,AAAC,WAAW,IAAK;gBAC7B;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI;oBACP,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,WAAW,IAAI,cAAe;oBACpE,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACpD,OAAO,AAAC,WAAW,IAAK;oBACxB,QAAQ,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAQ,cAAc,IAAK;gBACnF;gBAEJ,MAAM,cAAc,IAAI,IAAI;gBAC5B,GAAG,MAAM,SAAS,WAAW,CAAC,YAAY,GAAG;YAEjD;YAEA,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG;gBACZ;gBACA;YACJ;QACJ,CAAA,EAAG;QAGP,IAAI,CAAC,SAAS,EAAE;QAChB,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,AAAC,CAAA,CAAC;YACE,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;gBACZ,KAAK;oBACD,UAAU;oBACV,YAAY;oBACZ,SAAS;gBACb;YACJ;YACA,MAAM,SAAS;gBACX,IAAI,MAAM,GACN,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;oBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAS;oBACvC,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,OAAQ;oBAC7C,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAS;oBAC5D,QAAQ;gBACZ;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;oBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAS;oBACvC,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,OAAQ;oBAC7C,OAAO;oBACP,QAAQ;gBACZ;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;oBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAS;oBACvC,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAS;oBACtC,OAAO,AAAE,CAAA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA,IAAK,IAAI,CAAC,QAAS;oBAC5D,QAAQ;gBACZ;qBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;oBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,OAAQ;oBAC9C,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,OAAQ;oBAC7C,OAAO;oBACP,QAAQ;gBACZ;YAGR;YAEA,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG;gBACb,IAAI;gBACJ;YACJ;QACJ,CAAA,EAAG;QAGP,IAAI,CAAC,uBAAuB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACtB,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACrF,aAAa;oBACb,IAAI,IAAI,CAAC,YAAY,UAAU,UAC3B,gBAAgB,CAAC;oBAErB,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QACA,IAAI,CAAC,uBAAuB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACtB,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,eAAe;oBACf,IAAI,IAAI,CAAC,YAAY,UAAU,UAC3B,cAAc,CAAC;oBAEnB,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QACA,IAAI,CAAC,uBAAuB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACtB,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,gBAAgB;oBAChB,IAAI,IAAI,CAAC,YAAY,UAAU,UAC3B,aAAa,CAAC;oBAElB,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QACA,IAAI,CAAC,uBAAuB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACtB,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,cAAc;oBACd,IAAI,IAAI,CAAC,YAAY,UAAU,UAC3B,eAAe,CAAC;oBAEpB,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QAGA,IAAI,CAAC,cAAc,EAAE;QACpB,CAAA;YACG,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,AAAC,CAAA,CAAC;gBACE,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;oBACZ,KAAK;wBACD,qBAAqB;wBACrB,OAAO,AAAC,WAAW,IAAK;wBACxB,QAAQ,AAAC,WAAW,IAAK;wBACzB,UAAU;wBACV,QAAQ;4BAAC;4BAAe;yBAAc,CAAC,IAAI,EAAE;oBACjD;gBACJ;gBAEA,MAAM,SAAS;oBACX,IAAI,MAAM,GACN,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;wBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,WAAW,IAAI,cAAe;wBACpE,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,WAAW,IAAI,cAAe;oBACvE;yBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;wBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;wBACrD,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,WAAW,IAAI,cAAe;oBACvE;yBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;wBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;wBACrD,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACxD;yBACG,IAAI,MAAM,GACb,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG;wBACN,MAAM,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,WAAW,IAAI,cAAe;wBACpE,KAAK,AAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,cAAe;oBACxD;gBAER;gBAEA,IAAI,CAAC,WAAW,CAAC,EAAE,GAAG;oBAClB,IAAI;oBACJ;gBACJ;YACJ,CAAA,EAAG;QAEX,CAAA;QACA,UAAU;QACV,IAAI,CAAC,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACjD,QAAQ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YAC5B,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,cAAc;oBACd,aAAa;oBACb,IAAI,IAAI,CAAC,YAAY,UAAU,UAAU;wBACrC,eAAe,CAAC;wBAChB,gBAAgB,CAAC;oBACrB;oBACA,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QACA,WAAW;QACX,IAAI,CAAC,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACjD,QAAQ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YAC5B,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,eAAe;oBACf,aAAa;oBACb,IAAI,IAAI,CAAC,YAAY,UAAU,UAAU;wBACrC,cAAc,CAAC;wBACf,gBAAgB,CAAC;oBACrB;oBACA,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QACA,cAAc;QACd,IAAI,CAAC,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACjD,QAAQ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YAC5B,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,eAAe;oBACf,gBAAgB;oBAChB,IAAI,IAAI,CAAC,YAAY,UAAU,UAAU;wBACrC,cAAc,CAAC;wBACf,aAAa,CAAC;oBAClB;oBACA,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QACA,aAAa;QACb,IAAI,CAAC,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACjD,QAAQ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YAC5B,aAAa;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,SAAS,iBAAiB,MAAM,WAAW,QAAQ;oBACzD,MAAM,EAAC,EAAE,EAAE,EAAE,EAAC,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,kBAAkB,MAAM,KAAK,IAAI,CAAC,OAAO,MAAM,KAAK,IAAI,CAAC;oBACzF,cAAc;oBACd,gBAAgB;oBAChB,IAAI,IAAI,CAAC,YAAY,UAAU,UAAU;wBACrC,eAAe,CAAC;wBAChB,aAAa,CAAC;oBAClB;oBACA,IAAI,CAAC;gBACT;gBACA,IAAI,MAAM,SAAS,aACf,IAAI,CAAC;YAEb;QACJ;QAGA,IAAI,CAAC,OAAO,OACR,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IACf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IACf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IACf,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IACf,IAAI,CAAC,iBAAiB,IACtB,IAAI,CAAC,eAAe,IACpB,IAAI,CAAC,QAAQ,IAEb,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IACd,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAEd,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,IACpB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,IACpB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,IACpB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;QAGxB,IAAI,CAAC;IAET;IAEA,sBAAsB;IACtB,eAAuB;QACnB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACxB,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACxB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAClB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAClB,OAAO;YACH,GAAG,IAAI,CAAC;YACR,GAAG,IAAI,CAAC;YACR,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;YACrB,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QAC1B;IACJ;IAEA,aAAc,CAAQ,EAAQ;QAC1B,IAAI,CAAC,IAAI,EAAE;QACX,IAAI,CAAC,IAAI,EAAE;QACX,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,SAAS,EAAE;QAEhB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,MAAM,AAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAS;YAC9B,KAAK,AAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAS;QACjC;QAEA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAClB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAClB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC;QACvB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAClB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC;QACvB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC;QACvB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI;QAClB,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC;QAEvB,IAAI,CAAC;QACL,IAAI,CAAC;IACT;IAEA,SAAU,CAAS,EAAQ;QACvB,IAAI,CAAC,QAAQ;QACb,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,MAAM,AAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAS;YAC9B,KAAK,AAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAS;QACjC;QACA,IAAI,CAAC;IACT;IAEA,WAAY,CAAU,EAAQ;QAE1B,IAAI,CAAC,iBAAiB,GAAG,MAAM,UAAU,IAAI,UAAU;QACvD,IAAI,CAAC,eAAe,GAAG,MAAM,UAAU,IAAI,UAAU;IAEzD;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,qBAAqB;IAC9B;AACJ;;;;;AChnBA;;;;;;;;CAQC,GACD,kDAAa;AAnBb;AACA;AACA;AAGA;AAEA;AAYO,MAAM;IAmCD,wBAA+B;QACnC,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,oBAAoB,GAAG,CAAA,GAAA,YAAI,EAAE;QAChD,IAAI,CAAC,gCAAgC,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,mBAAmB,cAAc,SAAS;QAChG,IAAI,CAAC,4BAA4B,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,UAAU,cAAc,SAAS;IACvF;IAEQ,UAAiB;QACrB,IAAI,IAAI,CAAC,mBAAmB,GACxB;QAGJ,IAAI,CAAC;QAEL,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,UAAU,cAAc,KAAK,IAAI,AAAC,CAAA,IAAI,CAAC,kBAAkB,IAAI,CAAC,cAAa,IAAK,IAAI,CAAC,iBAAiB;QAC3G,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,iBAAiB,GAAG;QAClD,IAAI,CAAC,UAAU;QAEf,IAAI,IAAI,CAAC,iBAAiB,GACtB,sBAAsB,IAAM,IAAI,CAAC;IAEzC;IAEA;;KAEC,GACD,AAAQ,kBAAyB;QAE7B,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,UACpC;QAGJ,MAAM,cAAc,IAAI,CAAC,SAAS,QAAQ;QAE1C,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,QAAQ,YAAY,OAAO,YAAY,QAAQ,IAAI,CAAC,iBAAiB,IAAI,CAAC,iBAAiB;QACvH,IAAI,CAAC,YAAY,QAAQ,KAAK,MAAM,iBAAiB;QACrD,IAAI,CAAC,YAAY,SAAS,KAAK,MAAM,iBAAiB;QACtD,IAAI,CAAC,eAAe;QACpB,IAAI,IAAI,CAAC,YAAY,QAAQ,YAAY,OACrC,IAAI,CAAC,eAAe,wBAAwB;aACzC;YACH,IAAI,CAAC,eAAe,wBAAwB;YAC5C,IAAI,CAAC,eAAe,wBAAwB;QAChD;QACA,IAAI,CAAC,eAAe,YAAY,IAAI,CAAC;QACrC,IAAI,CAAC,eAAe,SAAS,GAAG,GAAG,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,YAAY;QAC5E,IAAI,CAAC,eAAe,UAAU,aAAa,GAAG,GAAG,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,YAAY;QAC1F,IAAI,CAAC,eAAe;QAEpB,MAAM,SAAS,IAAI,CAAC,OAAO;QAC3B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,oBAAoB;YAC5B,KAAK,KAAK,IAAI,IAAK,OAAO,MAAM,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,YAAY,SAAS,KAAM;QACtF;IAEJ;IAEQ,KAAM,SAAkB,EAAQ;QACpC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UACzB;QAGJ,MAAM,iBAAiB,IAAI,CAAC,SAAS;QACrC,IAAI,CAAC,QAAQ,cAAe,QAAQ,iBAAiB,CAAA,GAAA,cAAG,EAAE,iCAAiC,CAAA,GAAA,cAAG,EAAE;QAChG,IAAI,CAAC,QAAQ,UAAU;QACvB,IAAI,CAAC,QAAQ,MAAM,YAAY,iBAAiB,KAAK;QAErD,IAAI,CAAC,YAAY,cAAc,IAAI,CAAC,SAAS;QAC7C,IAAI,IAAI,CAAC,SAAS,WACd,IAAI,CAAC,UAAU,YAAY,CAAA,GAAA,cAAG,EAAE,aAAa,SAAS,KAAK,MAAM,IAAI,CAAC,SAAS,UAAU,OAAO;aAEhG,IAAI,CAAC,UAAU,YAAY,CAAA,GAAA,cAAG,EAAE,aAAa,YAAY,KAAK,MAAM,IAAI,CAAC,SAAS,UAAU,OAAO;QAGvG,MAAM,cAAc,IAAI,CAAC,SAAS,QAAQ;QAE1C,IAAI,YAAY,UAAU,IAAI,CAAC,cAAc,SAAS,YAAY,WAAW,IAAI,CAAC,cAAc,QAAQ;YACpG,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,QAAQ,YAAY,OAAO,YAAY,QAAQ,IAAI,CAAC,YAAY,IAAI,CAAC,YAAY;YAC7G,IAAI,CAAC,OAAO,QAAQ,KAAK,MAAM,iBAAiB;YAChD,IAAI,CAAC,OAAO,SAAS,KAAK,MAAM,iBAAiB;YAEjD,YAAY;QAChB;QAEA,IAAI,CAAC,gBAAgB,QAAQ,IAAI,CAAC,OAAO;QACzC,IAAI,CAAC,gBAAgB,SAAS,IAAI,CAAC,OAAO;QAE1C,IAAI,CAAC,mBAAmB;QACxB,IAAI,CAAC,mBAAmB,wBAAwB;QAChD,IAAI,CAAC,mBAAmB,YAAY,IAAI,CAAC;QACzC,IAAI,CAAC,mBAAmB,SAAS,GAAG,GAAG,IAAI,CAAC,gBAAgB,OAAO,IAAI,CAAC,gBAAgB;QACxF,IAAI,CAAC,mBAAmB,UAAU,aAAa,GAAG,GAAG,IAAI,CAAC,gBAAgB,OAAO,IAAI,CAAC,gBAAgB;QACtG,IAAI,CAAC,mBAAmB;QAExB,IAAI,WAAW;YACX,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,iBAAiB,GAAG;YAClD,IAAI,CAAC,UAAU;QAEnB,OAAO;YACH,IAAI,CAAC,iBAAiB,IAAI,CAAC;YAC3B,IAAI,CAAC;QAET;QAEA,IAAI,CAAC;QAEL,IAAI,CAAC,iBAAiB,CAAA,GAAA,oBAAQ,EAAE;QAChC,IAAI,CAAC,cAAc,QAAQ,YAAY;QACvC,IAAI,CAAC,cAAc,SAAS,YAAY;IAC5C;IAGA,mBAAmB;IACnB,YACI,CAIC,CACH;aAlIM,gCAA+C,CAAC;aAOhD,4BAA2C,CAAC;QA4HhD,8EAA8E;QAC9E,+BAA+B;QAC/B,oDAAoD;QACpD,wDAAwD;QAExD,yEAAyE;QAEzE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;QACf;QACA,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,aAAa,IAAI,CAAC,SAAS;QAChC,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,gBAAgB;YACjB,OAAO;YACP,QAAQ;QACZ;QACA,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,UAAU,iCAAiC;QACrE,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACtC,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,uBAAuB;QAC5B,IAAI;QACJ,MAAM,iCAAiC;QACvC,IAAI,CAAC,UAAU,EAAE;QAGjB,oBAAoB;QACpB,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC1B,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,QAAQ,IAAI,CAAC,SAAS;YAC1B;QACJ;QAGA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,KAAK;gBACD,SAAS;gBACT,gBAAgB;gBAChB,YAAY;gBACZ,OAAO;gBACP,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,QAAQ;YACR,SAAS;YACT,KAAK;gBACD,eAAe;YACnB;YACA,QAAQ;gBACJ,MAAM;gBACN,UAAU;YACd;QACJ;QAEA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC1B,KAAK;gBACD,qBAAqB;gBACrB,UAAU,IAAI,CAAC,SAAS;gBACxB,QAAQ,IAAI,CAAC,SAAS;gBACtB,SAAS;gBACT,gBAAgB;gBAChB,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC;QAC9C,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAC7B,IAAI,CAAC,OAAO,QAAQ,CAAA,GAAA,cAAG,EAAE;QACzB,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,KAAK;gBACD,qBAAqB;gBACrB,UAAU;gBACV,aAAa;gBACb,UAAU;gBACV,UAAU;gBACV,UAAU;YACd;QACJ;QACA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,SAAS;YACT,KAAK;gBACD,UAAU;gBACV,YAAY;YAChB;QACJ;QACA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,KAAK;gBACD,mCAAmC;gBACnC,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,OAAO;gBACP,QAAQ;YACZ;QACJ;QACA,IAAI,EAAE,SAAS;YACX,YAAY,iBAAiB,SAAS,IAAM,EAAE;YAC9C,IAAI,CAAC,OAAO,iBAAiB,SAAS,IAAM,EAAE;YAC9C,aAAa,iBAAiB,SAAS,IAAM,EAAE;QACnD;QACA,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,SAAS,CAAA,GAAA,cAAG,EAAE,aAAa;YAC3B,KAAK;gBACD,UAAU;gBACV,UAAU;gBACV,WAAW;YACf;QACJ;QAEA,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC5B,SAAS,CAAA,GAAA,MAAC,EAAE;YACZ,KAAK;gBACD,eAAe;gBACf,YAAY;gBACZ,UAAU;gBACV,OAAO;gBACP,KAAK;gBACL,QAAQ;gBACR,WAAW;gBACX,YAAY,aAAW,iCAA+B;gBACtD,YAAY;gBACZ,SAAS;gBACT,oBAAoB;YACxB;QACJ;QACA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,iBAAiB,IAAI,CAAC;QACxD,IAAI,CAAC,mBAAmB,OAAO,IAAI,CAAC;QACpC,IAAI,CAAC,iBAAiB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAClC,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa;YACrB,SAAS;QACb;QAGA,gBAAgB,OAAO,IAAI,CAAC;QAC5B,YAAY,OAAO,IAAI,CAAC,aAAa;QACrC,IAAI,CAAC,iBAAiB,OAAO,cAAc,iBAAiB,aAAa,IAAI,CAAC;QAC9E,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC;QAGxB,IAAI,CAAC;QACL,CAAA,GAAA,YAAI,EAAE,kBAAkB;YACpB,IAAI,CAAC;YACL,IAAI,CAAC,KAAK;QACd;QAIA,uBAAuB;QAEvB,qDAAqD;QACrD,qEAAqE;QACrE,sDAAsD;QAEtD,YAAY;YAER,IAAI,CAAC,IAAI,CAAC,UACN;YAGJ,MAAM,eAAe,CAAA,GAAA,oBAAQ,EAAE;YAC/B,IAAI,iBAAiB,IAAI,CAAC,gBACtB;YAGJ,uBAAuB;YACvB,IAAI,CAAC,SAAS,UAAU,AAAC,IAAI,CAAC,SAAS,QAAQ,OAAyB;YAExE,IAAI,CAAC,KAAK;QAEd,GAAG;QAGH,MAAM,oBAAoB;YACtB,IAAI,CAAC,mBAAmB;QAC5B;QAEA,MAAM,kBAAkB,CAAC;YACrB,IAAI,IAAI,CAAC,yBAAyB,GAC9B;YAGJ,aAAa;YACb,IAAI,CAAC,uBAAuB;YAE5B,IAAI,GACA,8BAA8B,WAAW;gBACrC,IAAI,CAAC;gBACL,IAAI,CAAC,mBAAmB,MAAM,UAAU;gBACxC,EAAE,SAAS,OAAO,IAAI,CAAC;gBACvB,WAAW;oBACP,IAAI,CAAC,mBAAmB,MAAM,UAAU;gBAC5C,GAAG;YACP,GAAG;iBAEA;gBACH,IAAI,CAAC,mBAAmB,MAAM,UAAU;gBACxC,8BAA8B,WAAW,mBAAmB,iCAAiC;YACjG;QAEJ;QAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC3C,QAAQ,IAAI,CAAC;YACb,cAAc,CAAC;gBACX,gBAAgB;YACpB;QACJ;IACJ;IAEA,sBAAsB;IAEtB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,IAAI,CAAC,cAAc,GACnB;QAEJ,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,iBAAiB,MAAM,UAAU,IAAI,CAAC,YAAY,SAAS;QAChE,IAAI,CAAC,OAAO,MAAM,eAAe,IAAI,CAAC,YAAY,KAAK;QAEvD,MAAM,eAAe,CAAA,GAAA,oBAAQ,EAAE;QAC/B,IAAI,KAAK,IAAI,CAAC,mBAAmB,cAC7B,IAAI,CAAC,KAAK;IAElB;IAEA,mCAAmC;IACnC,SAAU,gBAAgC,EAAQ;QAC9C,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,KAAK;IACd;IAEA,WAAY,QAAmB,EAAQ;QACnC,IAAI,CAAC,UAAU;QAEf,IAAI,IAAI,CAAC,YAAY,QACjB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,oBAAoB;YAC5B,MAAM;YACN,OAAO;QACX;aAEA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,oBAAoB;YAC5B,MAAM;YACN,OAAO;QACX;IAER;AAEJ;;;;;ACtaA,6DAAgB;AAThB;AACA;AACA;AAGA;AACA;AACA;AAEO,SAAS,wBACZ,MAQC;IAGD,MAAM,MAAM,SAAS,cAAc;IACnC,CAAA,GAAA,MAAC,EAAE,cAAc,KAAK,CAAA,GAAA,cAAG,EAAE;IAC3B,IAAI,OAAO,SAAS,uBAAuB;QACvC,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,KAAK;gBACD,YAAY;gBACZ,SAAS;gBACT,WAAW;gBACX,cAAc;gBACd,QAAQ;gBACR,cAAc;YAClB;QACJ;QACA,IAAI,OAAO;IACf;IACA,MAAM,UAAU,CAAA,GAAA,wBAAU;IAE1B,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;QACtB,KAAK;YACD,SAAS;QACb;IACJ;IACA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;QAC1B,SAAS;QACT,SAAS;QACT,KAAK;YACD,aAAa;QACjB;QACA,SAAS;YACL,oBAAoB;QACxB;IACJ;IACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;QACrB,SAAS;QACT,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,KAAK;YACD,aAAa;QACjB;QACA,SAAS;YACL,oBAAoB;QACxB;IACJ;IACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;QACpB,SAAS;QACT,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,KAAK;YACD,aAAa;QACjB;QACA,SAAS;YACL,oBAAoB;QACxB;IACJ;IACA,YAAY,OAAO,iBAAiB,YAAY;IAChD,IAAI,OAAO;IAIX,MAAM,SAA0B,EAAE;IAClC;QACI,MAAM,mBAAmB,OAAO,SAAS;QACzC,IAAK,IAAI,IAAI,GAAG,IAAI,iBAAiB,QAAQ,IACzC,OAAO,KAAK;YACR,OAAO,gBAAgB,CAAC,EAAE,CAAC,QAAQ;YACnC,WAAW,gBAAgB,CAAC,EAAE,CAAC;YAC/B,SAAS,gBAAgB,CAAC,EAAE,CAAC;YAC7B,YAAY,gBAAgB,CAAC,EAAE,CAAC;QACpC;IAER;IACA,OAAO,KAAK;QACR,OAAO,OAAO;QACd,WAAW;QACX,SAAS;QACT,YAAY;IAChB;IAGA,MAAM,sBAAsB,IAAI,CAAA,GAAA,wCAAkB,EAAE;QAChD,cAAc,CAAA,GAAA,4BAAc,EAAE;QAC9B,eAAe,CAAA,GAAA,6BAAe,EAAE,WAAW;QAC3C,YAAY,OAAO,SAAS,gBAAgB,GAAI,OAAO;QACvD,aAAa,OAAO,SAAS,gBAAgB,GAAI,OAAO;QACxD,QAAQ;QACR,gBAAgB,OAAO,SAAS;IACpC;IACA,CAAA,GAAA,MAAC,EAAE,IAAI,oBAAoB,cAAc;QACrC,WAAW;QACX,YAAY;IAChB;IACA,IAAI,OAAO,oBAAoB;IAE/B,SAAS,KAAM,CAAS,EAAE,CAAS;QAC/B,oBAAoB,KAAK,GAAG;IAChC;IAEA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;QACnC,QAAQ,SAAU,MAAM;YACpB,IAAI,WAAW,QACX,KAAK,IAAI;YAEb,IAAI,WAAW,SACX,KAAK,GAAG;YAEZ,IAAI,WAAW,MACX,KAAK,GAAG;YAEZ,IAAI,WAAW,QACX,KAAK,GAAG;QAEhB;IACJ;IAEA,CAAA,GAAA,oBAAQ,EAAE;QACN,QAAQ,OAAO;QACf,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,yBAAyB,IAAI,CAAC;QAClD,KAAK;QACL,OAAO,UAAU,YAAY;YACzB,OAAO;QACX;QACA,SAAS;YAAC;YAAM;SAAS;QACzB,cAAc;QACd,UAAU,SAAU,SAAS;YACzB,YAAY;YACZ,oBAAoB;YACpB,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,IAAI,cAAc,MACd,OAAO,SAAS,oBAAoB,qBAAqB,oBAAoB;iBAE7E,OAAO;QAEf;IACJ;AAEJ;;;;;AC5JA,iDAAgB;AAAT,SAAS;IACZ,OAAO,OAAO,aAAa;AAC/B;;;;;kDCFa;mDAKA;AAKb,qDAAgB;AAIhB,sDAAgB;AAdT,MAAM,eAAe;IACxB,OAAO;IACP,QAAQ;AACZ;AAEO,MAAM,gBAAgB;IACzB,OAAO;IACP,QAAQ;AACZ;AAEO,SAAS,gBAAiB,OAAgB;IAC7C,OAAO,UAAU,aAAa,QAAQ,cAAc;AACxD;AAEO,SAAS,iBAAkB,OAAgB;IAC9C,OAAO,UAAU,aAAa,SAAS,cAAc;AACzD;;;;;ACbA;;;GAGG,GACH,oDAAa;AARb;AAQO,MAAM;IAIT,mBAAmB;IACnB,YACI,CAIC,CACH;QACE,YAAY;QACZ,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS;YACT,KAAK;gBACD,YAAY;gBACZ,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,YAAY;gBACZ,OAAO;gBACP,YAAY;gBACZ,WAAW;gBACX,UAAU;YACd;QACJ;QACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,KAAK;gBACD,aAAa;gBACb,WAAW;gBACX,kBAAkB;YACtB;QACJ;QACA,MAAM,cAAc;YAChB,OAAO;YACP,SAAS;YACT,QAAQ;YACR,eAAe;YACf,cAAc;YACd,QAAQ;YACR,YAAY;YACZ,YAAY;QAChB;QACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,SAAS;YACT,KAAK;QACT;QACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,SAAS;YACT,KAAK;QACT;QAEA,IAAI,CAAC,OAAO,OAAO;QACnB,UAAU,OAAO,eAAe;QAGhC,IAAI,cAAc;QAClB,IAAI,qBAAqB;QACzB,IAAI,qBAAqB;QAEzB,MAAM,UAAU;YACZ,cAAc;YACd,qBAAqB;YACrB,qBAAqB;YACrB,IAAI,CAAC,OAAO;QAChB;QAEA;;SAEC,GACD,MAAM,iBAAiB,CAAC;YACpB,OAAO,CAAC,CAAC,MAAM,gBAAgB,CAAC,MAAM,aAAa,MAAM,SAAS;QACtE;QAEA,MAAM,gBAAgB;YAClB,MAAM,YAAY;YAClB,IAAI,qBAAqB,GAAG;gBACxB,cAAc,MAAM,YAAY;gBAChC,cAAc,MAAM,YAAY;YACpC,OAAO,IAAI,qBAAqB,GAAG;gBAC/B,cAAc,MAAM,YAAY;gBAChC,cAAc,MAAM,YAAY;YACpC,OAAO;gBACH,cAAc,MAAM,YAAY;gBAChC,cAAc,MAAM,YAAY;YACpC;QACJ;QAEA,cAAc,iBAAiB,aAAa;YACxC;YACA;QACJ;QACA,cAAc,iBAAiB,aAAa;YACxC;YACA;QACJ;QACA,cAAc,iBAAiB,aAAa;YACxC;YACA;QACJ;QACA,cAAc,iBAAiB,aAAa;YACxC;YACA;QACJ;QAGA,MAAM,eAAe,CAAC;YAClB,IAAI,CAAC,eAAe,QAChB;YAEJ,MAAM;YACN,MAAM;QACV;QAEA,MAAM,gBAAgB,CAAC;YACnB,IAAI,CAAC,EAAE,iBAAiB,CAAC,eAAe,QACpC;YAEJ,IAAI,gBAAgB,GAChB,EAAE,OAAO,OAAO,IAAI,CAAC;YAEzB;QACJ;QAEA,MAAM,gBAAgB,CAAC;YACnB,IAAI,CAAC,eAAe,UAAU,gBAAgB,GAC1C;YAEJ,cAAc,KAAK,IAAI,GAAG,cAAc;YACxC,IAAI,gBAAgB,GAChB,IAAI,CAAC,OAAO;QAEpB;QAEA,MAAM,WAAW,CAAC;YACd,IAAI,CAAC,eAAe,UAAU,CAAC,MAAM,gBAAgB,MAAM,aAAa,MAAM,WAAW,GAAG;gBACxF;gBACA;YACJ;YACA,MAAM;YACN,MAAM;YAEN,IAAI,YAAyB;YAC7B,IAAI,qBAAqB,GACrB,YAAY;iBACT,IAAI,qBAAqB,GAC5B,YAAY;YAGhB,EAAE,OAAO,MAAM,aAAa,OAAO;YAGnC,IAAI,cAAc,GACd,IAAI,CAAC,OAAO;YAEhB,cAAc;YACd,qBAAqB;YACrB,qBAAqB;YACrB;QACJ;QAEA,OAAO,iBAAiB,YAAY,cAAc;QAClD,OAAO,iBAAiB,aAAa,eAAe;QACpD,OAAO,iBAAiB,aAAa,eAAe;QACpD,OAAO,iBAAiB,QAAQ,UAAU;QAE1C,wDAAwD;QACxD,IAAI,CAAC,OAAO,iBAAiB,eAAe;YACxC;QACJ;QACA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YACnC,QAAQ,CAAC;gBACL,IAAI,cAAc,KAAK,WAAW,OAC9B;YAER;QACJ;IACJ;AAGJ;;;;;ACvLA;;;CAGC,GACD,sDAAa;AAZb;AACA;AACA;AAEA;AAQO,MAAM;IAIT,mBAAmB;IACnB,YACI,CAGC,CACH;QACE,MAAM,UAAU;YACZ,OAAO;YACP,UAAU;YACV,SAAS;YACT,cAAc;QAClB;QAEA,IAAI,YAAY;QAChB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;QACf;QACA,MAAM,YAIF;YACA,OAAO;YACP,MAAM;YACN,SAAS;QACb;QAGA,iBAAiB;QAEjB,iBAAiB;QACjB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,WAAW;QACf;QACA,MAAM,cAAc,IAAI,CAAA,GAAA,sCAAiB,EAAE;YACvC,OAAO,QAAQ;YACf,UAAU,QAAQ;YAClB,SAAS,QAAQ;YACjB,OAAO,EAAE,oBAAoB;YAC7B,UAAU,CAAC;gBACP,gBAAgB,MAAM,kBAAkB,SAAS,OAAO,IAAI,MAAM,OAAO,IAAI,MAAM,OAAO,IAAI;gBAC9F,EAAE,oBAAoB,SAAS,QAAQ;YAC3C;QACJ;QACA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC1B,KAAK;gBACD,OAAO,QAAQ,QAAQ;gBACvB,QAAQ,QAAQ,UAAU;gBAC1B,eAAe;YACnB;QACJ;QACA;YACI,MAAM,eAAe,EAAE,oBAAoB;YAC3C,gBAAgB,MAAM,kBAAkB,SAAS,aAAa,IAAI,MAAM,aAAa,IAAI,MAAM,aAAa,IAAI;QACpH;QAEA,QAAQ,OAAO,iBAAiB,YAAY;QAG5C,MAAM,cAAc,CAAC;YACjB,YAAY,SAAS;YACrB,gBAAgB,MAAM,kBAAkB,SAAS,OAAO,IAAI,MAAM,OAAO,IAAI,MAAM,OAAO,IAAI;QAClG;QAIA,kBAAkB;QAElB,MAAM,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC5B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,QAAQ;YACf,QAAQ,QAAQ;YAChB,KAAK;YACL,KAAK;YACL,OAAO;YACP,YAAY;YACZ,YAAY,OAAO;YACnB,gBAAgB,CAAC,MAAQ,MAAM;YAC/B,SAAS,CAAC,eAAiB,eAAe;YAC1C,UAAU,CAAC;gBACP,EAAE,oBAAoB,QAAQ;YAClC;YACA,YAAY,CAAC;gBACT,IAAI,eAAe,IACf,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc;qBAE9B,OAAO,KAAK,MAAM;YAE1B;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,cAAc;YAC5B,WAAW;QACf;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,QAAQ;YACf,QAAQ,QAAQ;YAChB,KAAK;YACL,KAAK;YACL,OAAO;YACP,YAAY;YACZ,YAAY,OAAO;YACnB,gBAAgB,CAAC,MAAQ,MAAM;YAC/B,SAAS,CAAC,eAAiB,eAAe;YAC1C,UAAU,CAAC;gBACP,EAAE,oBAAoB,WAAW;YACrC;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,cAAc;YAC/B,QAAQ;QACZ;QACA,IAAI,CAAC,OAAO,OAAO,WAAW,cAAc,cAAc;QAI1D,wBAAwB;QAExB,MAAM,mBAAmB,CAAC;YACtB,IAAI,MAAM,SAAS;gBACf,IAAI,CAAC,WACD,UAAU,QAAQ,MAAM;qBAExB,YAAY,MAAM;;YAG1B,IAAI,MAAM,SAAS;gBACf,IAAI,CAAC,WACD,UAAU,OAAO,MAAM;qBAEvB,WAAW,SAAS,MAAM;;YAGlC,IAAI,MAAM,SAAS;gBACf,IAAI,CAAC,WACD,UAAU,UAAU,MAAM;qBAE1B,cAAc,SAAS,MAAM;;YAGrC,IAAI,MAAM,SAAS,gBAAgB;gBAC/B,WAAW,OAAO,MAAM,MAAM;gBAC9B,cAAc,OAAO,MAAM,MAAM;YACrC;QACJ;QACA,EAAE,oBAAoB,UAAU;QAChC;YACI,MAAM,eAAe,EAAE,oBAAoB;YAC3C,WAAW,OAAO,aAAa;YAC/B,cAAc,OAAO,aAAa;YAClC,WAAW,SAAS,EAAE,oBAAoB;YAC1C,cAAc,SAAS,EAAE,oBAAoB;QACjD;QAEA,MAAM,WAAW;YAEb,8BAA8B;YAC9B,CAAA,GAAA,MAAC,EAAE;YAEH,IAAI,CAAC,OAAO,MAAM,UAAU,YAAY,UAAU;YAClD,IAAI,aAAa,UACb,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;gBAChB,MAAM,AAAC,SAAS,IAAI,KAAK,MAAM,QAAQ,QAAQ,KAAM;gBACrD,KAAK,AAAC,SAAS,IAAI,KAAK,MAAM,QAAQ,WAAW,QAAQ,UAAU,IAAI,KAAM;YACjF;QAER;QAEA,IAAI,WAA6B;QACjC,SAAS,iBAAiB,eAAe,CAAC;YACtC,WAAW;gBACP,GAAG,MAAM;gBACT,GAAG,MAAM;YACb;QACJ;QAEA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YACnC,QAAQ,CAAC,QAAQ,OAAO,UAAU;gBAC9B,IAAI,UACA;gBAEJ,IAAI,WAAW;oBACX,YAAY;oBACZ;oBACA;gBACJ;gBAEA,IAAI,CAAC,EAAE,iBAAiB,CAAC,UACrB;gBAGJ,IAAI;oBAAC;oBAAY;oBAAW;oBAAY;iBAAU,CAAC,SAAS,WAAW;oBACnE,MAAM;oBACN,YAAY;oBAEZ,IAAI,UAAU,UAAU,MAAM;wBAC1B,YAAY,UAAU;wBACtB,UAAU,QAAQ;oBACtB;oBACA,IAAI,UAAU,SAAS,MAAM;wBACzB,WAAW,SAAS,UAAU;wBAC9B,UAAU,OAAO;oBACrB;oBACA,IAAI,UAAU,YAAY,MAAM;wBAC5B,cAAc,SAAS,UAAU;wBACjC,UAAU,UAAU;oBACxB;oBAEA;gBACJ;YAEJ;YACA,MAAM,CAAC,QAAQ,OAAO;gBAClB,IAAI;oBAAC;oBAAY;oBAAW;oBAAY;iBAAU,CAAC,SAAS,gBAAgB,WAAW;oBACnF,YAAY;oBACZ,YAAY;oBACZ;gBACJ;YACJ;YACA,QAAQ;gBACJ,IAAI,WAAW;oBACX,YAAY;oBACZ,YAAY;oBACZ;gBACJ;YACJ;QACJ;IACJ;IAEA,sBAAsB;IACtB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;AChPA;;CAEC,GACD,qDAAa;AAdb;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;AAOO,MAAM;IAIT,mBAAmB;IACnB,YACI,CAQC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,QAAQ;gBACR,SAAS;YACb;QACJ;QAEA,SAAS,aACL,CAOC;YAKD,MAAM,UAAU,IAAK,CAAA,EAAE,eAAe,EAAE,eAAe,CAAA;YACvD,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;gBACb,WAAW;gBACX,OAAO,EAAE;gBACT,SAAS,EAAE;gBACX,KAAK;oBACD,SAAS,EAAE,UAAU,UAAU,SAAS;gBAC5C;YACJ;YACA,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;gBACb,WAAW,EAAE,aAAa,gBAAgB;gBAC1C,KAAK;oBACD,iBAAiB,UAAW,EAAE,QAAQ;oBACtC,kBAAkB;oBAClB,oBAAoB;oBACpB,gBAAgB,EAAE,UAAU,YAAY;oBACxC,yBAAyB;oBACzB,QAAQ;gBACZ;YACJ;YACA,GAAG,MAAM,gBAAgB;YACzB,GAAG,OAAO;YACV,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC3C,QAAQ;gBACR,cAAc,SAAU,MAAM;oBAC1B,GAAG,UAAU,OAAO,8BAA8B;gBACtD;YACJ;YACA,OAAO;gBACH;gBACA;YACJ;QACJ;QAEA,MAAM,aAAa,aAAa;YAC5B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,EAAE,UAAU,EAAE,UAAU,CAAA,GAAA,6BAAY;YAC3C,SAAS;YACT,YAAY;QAChB;QACA,WAAW,GAAG,UAAU,IAAI;QAC5B,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW,IAAI;YAClB,OAAO;QACX;QACA,MAAM,YAAY,aAAa;YAC3B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,2BAAU;YACjB,cAAc;YACd,SAAS;QACb;QACA,MAAM,eAAe,aAAa;YAC9B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,yBAAQ;YACf,cAAc;YACd,SAAS;QACb;QACA,MAAM,aAAa,aAAa;YAC5B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,yBAAQ;YACf,cAAc;YACd,SAAS;QACb;QAEA,IAAI,cAAc;QAClB,IAAI,CAAA,GAAA,MAAC,EAAE,iBACH,cAAc,aAAa;YACvB,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,wBAAO;YACd,SAAS;YACT,YAAY;QAChB;QAEJ,MAAM,aAAa,aAAa;YAC5B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,uBAAM;YACb,SAAS;YACT,YAAY;QAChB;QAEA,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,QAAQ;YACnB,WAAW;YACX,UAAU;YACV,aAAa;YACb,WAAW;YACX,cAAc,YAAY,KAAK;YAC/B,WAAW;SACd;IACL;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AACJ;;;ACrJA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,wBAAwB,MAAM,KAAK;;;ACA5G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,wBAAwB,MAAM,KAAK;;;ACA5G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,uBAAuB,MAAM,KAAK;;;ACA3G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,sBAAsB,MAAM,KAAK;;;;;ACkB1G;;CAEC,GACD,kDAAa;AArBb;AACA;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;AAaO,MAAM;IAcD,eAAgB;QACpB,IAAI,CAAC,aAAa,QAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,mBAAmB;QAChE,IAAI,CAAC,eAAe,MAAM,kBAAkB,UAAW,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,mBAAmB,GAAG;IACjG;IAIA,mBAAmB;IACnB,YACI,CAEC,CACH;aAtBe,cAAsB;aACtB,YAAyB;YAAC;YAAQ;YAAQ;YAAY;YAAQ;SAAQ;QAsBnF,IAAI,CAAC,QAAQ;YACT,CAAA,GAAA,4BAAW;YACX,CAAA,GAAA,2BAAU;YACV,CAAA,GAAA,+BAAc;YACd,CAAA,GAAA,2BAAU;YACV,CAAA,GAAA,4BAAW;SACd;QACD,IAAI,CAAC,WAAW;YACZ,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,cAAc,IAAI,CAAC;YAC3B,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,qBAAqB,IAAI,CAAC;YAClC,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,iBAAiB,IAAI,CAAC;YAC9B,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,aAAa,IAAI,CAAC;YAC1B,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,cAAc,IAAI,CAAC;SAC9B;QACD,IAAI,CAAC,qBAAqB;QAC1B,IAAI,CAAC,WAAW;QAChB,IAAI,SAAS;QAEb,gBAAgB;QAChB,WAAW;YACP,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,QAAQ,IAAK;gBACxC,MAAM,KAAK,IAAI;gBACf,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,EAAE;YAC1B;QACJ,GAAG;QAEH,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,UAAU;gBACV,UAAU;YACd;QACJ;QAEA,IAAI;QACJ,IAAI,aAAa;QACjB,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI,CAAA,GAAA,MAAC,EAAE,kBACH,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACrC,QAAQ,IAAI,CAAC;YACb,WAAW,CAAC;gBACR,IAAI,MAAM,SAAS,eAAe;oBAC9B,IAAI,QACA;oBAGJ,cAAc,WAAW;wBACrB;oBACJ,GAAG;oBACH,aAAa;oBACb,SAAS,MAAM;oBACf,SAAS,MAAM;gBAEnB,OAAO,IAAI,MAAM,SAAS,eACtB;oBAAA,IAAI,cAAc,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,KAAK,QAAQ,QAAQ,MAAM,OAAO,MAAM,SAAS,GAAG;wBAChF,aAAa;wBACb;oBACJ;gBAAA,OAEG,IAAI,MAAM,SAAS,aAAa;oBACnC,aAAa;oBACb,IAAI,UAAU,YAAY;wBACtB,MAAM,SAAS,SAAS,iBAAiB,MAAM,OAAO,MAAM;wBAC5D,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,eAAe,QAAQ,IAC5C,IAAI,WAAW,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,SAAS;4BAC3C;4BACA,IAAI,CAAC,WAAW;4BAChB,IAAI,CAAC,qBAAqB;4BAC1B,IAAI,CAAC;4BACL,EAAE,SAAS,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB;4BAClD;wBACJ;oBAER;oBACA,aAAa;gBACjB;YACJ;QACJ;QAGJ,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,mBAAmB;YAC7C,SAAS,CAAC;gBACN,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ;oBAC1B,EAAE;oBACF,EAAE;oBACF;oBACA;gBACJ;gBAEA,IAAI,CAAC,WAAW;gBAChB,EAAE,SAAS,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB;gBAClD,IAAI,QACA;YAER;YACA,KAAK;gBACD,SAAS;gBACT,eAAe;gBACf,QAAQ;gBACR,WAAW;YACf;QACJ;QAEA,IAAI,CAAC,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,kBAAkB;gBAClB,oBAAoB;gBACpB,gBAAgB;gBAChB,OAAO;gBACP,QAAQ;gBACR,eAAe;gBACf,SAAS;YACb;QACJ;QAEA,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,OAAO;gBACP,QAAQ;gBACR,OAAO;gBACP,QAAQ;gBACR,qBAAqB;gBACrB,sBAAsB;gBACtB,QAAQ;gBAER,iBAAiB,UAAW,CAAA,GAAA,4BAAW,IAAI;gBAC3C,kBAAkB;gBAClB,oBAAoB;gBACpB,gBAAgB;YACpB;YACA,OAAO;YACP,SAAS,CAAC;gBACN,EAAE;gBACF,EAAE;gBACF;YACJ;QACJ;QAGA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,KAAK;gBACD,UAAU;gBACV,kCAAkC;gBAClC,MAAM;gBACN,KAAK;gBACL,OAAO;gBACP,QAAQ;YACZ;QACJ;QACA,MAAM,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAClD,QAAQ;YACR,WAAW,CAAC;gBACR,IAAI,EAAE,SAAS,eAAe;oBAC1B,EAAE;oBACF;gBACJ;YACJ;QACJ;QAEA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC1B,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,OAAO;gBACP,QAAQ,AAAC,MAAO,CAAA,IAAI,CAAC,UAAU,SAAS,CAAA,IAAM;gBAC9C,KAAK;gBACL,MAAM;gBACN,QAAQ;gBACR,WAAW;gBACX,QAAQ;gBACR,YAAY;gBACZ,wBAAwB;gBACxB,yBAAyB;gBACzB,UAAU;YACd;QACJ;QAEA,IAAI,CAAC,iBAAiB,EAAE;QAExB,MAAM,uBAAuB,CACzB;YAQA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;gBAClB,QAAQ;gBACR,WAAW;gBACX,OAAO,EAAE;gBACT,KAAK;oBACD,SAAS;oBACT,QAAQ,AAAC,MAAO,CAAA,IAAI,CAAC,UAAU,SAAS,CAAA,IAAM;oBAC9C,WAAW;gBACf;gBACA,SAAS,CAAC;oBACN,EAAE;oBACF,EAAE;oBACF,EAAE,QAAQ,EAAE;gBAChB;YACJ;YAEA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,QAAQ;gBACR,WAAW;gBACX,KAAK;oBACD,iBAAiB,UAAW,EAAE,QAAQ;oBACtC,kBAAkB;oBAClB,oBAAoB;oBACpB,gBAAgB;oBAChB,QAAQ;oBACR,eAAe;oBACf,SAAS;gBACb;YACJ;YAEA,oBAAoB;YACpB,MAAM,OAAO,CAAC;gBACV,QAAQ,MAAM,UAAU,IAAI,UAAU;YAC1C;YAEA,MAAM,aAAa,CAAC;gBAChB,QAAQ,MAAM,UAAU,IAAI,IAAI,CAAC,cAAc;YACnD;YAEA,OAAO;gBACH;gBACA;gBACA;YACJ;QACJ;QAEA,MAAM,qBAAqB,CAAC;YACxB;YAEA,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,qBAAqB;YAE1B,IAAI,CAAC;YAEL,EAAE,SAAS,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB;QACtD;QAEA,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,eAAe,KAAK,qBAAqB;YAC1C,OAAO;YACP,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE;YACrB,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE;YACpB,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE;YACvB,SAAS;QACb;QAGJ,MAAM,eAAe;YACjB,CAAA,GAAA,yBAAY,EAAE,SAAS;YACvB,SAAS;YAET,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,KAAK,IAAI,CAAC,uBAAuB;YAG5D,IAAI,CAAC,YAAY,MAAM,UAAU;YACjC,IAAI,CAAC,OAAO,MAAM,SAAS;YAC3B,SAAS,KAAK,OAAO;YACrB,IAAI,CAAC,OAAO,OAAO;QACvB;QAEA,MAAM,gBAAgB;YAClB,CAAA,GAAA,yBAAY,EAAE,SAAS;YACvB,SAAS;YACT,IAAI,CAAC,YAAY,MAAM,eAAe;YACtC,IAAI,CAAC,OAAO,MAAM,eAAe;YACjC,QAAQ;YACR,gBAAgB;QACpB;QAEA,IAAI,CAAC;IACT;IAEA,sBAAsB;IAEtB,WAAY,CAAU,EAAQ;QAC1B,IAAI,CAAC,aAAa,MAAM,UAAU,IAAI,IAAI,CAAC,cAAc;QACzD,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,WAAW;QAEtC,IAAI,GAAG;YACH,IAAI,CAAC,YAAY,MAAM,QAAQ;YAC/B,IAAI,CAAC,YAAY,MAAM,SAAS;QACpC,OAAO;YACH,IAAI,CAAC,YAAY,MAAM,QAAQ;YAC/B,IAAI,CAAC,YAAY,MAAM,SAAS;QACpC;IACJ;IAEA,UAAW,SAAoB,EAAQ;QACnC,IAAI,IAAI,CAAC,UAAU,SAAS,YAAY;YACpC,IAAI,CAAC,WAAW;YAChB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,IAAI,CAAC,SAAS,CAAC,EAAE,KAAK,WAAW;gBACjC,IAAI,CAAC,qBAAqB;gBAC1B;YACJ;YAEJ,IAAI,CAAC,aAAa,UAAU,IAAI;YAChC,IAAI,CAAC;QACT,OAAO;YACH,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,aAAa,UAAU,OAAO;QACvC;IACJ;IAEA,YAAwB;QACpB,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB;IAClD;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AACJ;;;AC1XA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;ACAhH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,+BAA+B,MAAM,KAAK;;;ACAnH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,mBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;;;AC2BhH;;;;CAIC,GACD,sDAAa;AAhCb;AACA;AACA;;AACA;;AACA;;AACA;;AACA;AA0BO,MAAM;IAeT,mBAAmB;IAEnB,YACI,CAMC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAI;YACjB,WAAW;YACX,KAAK;gBACD,QAAQ;gBACR,SAAS;YACb;QACJ;QAEA,IAAI,CAAC,aAAa,EAAE;QACpB,IAAI,CAAC,mBAAmB,QAAQ,2BAA2B;QAG3D,MAAM,eAAe,CAAC;YAQlB,MAAM,cAAc,EAAE,YAAY,UAAU;YAE5C,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;gBACb,WAAW;gBACX,iBAAiB;gBACjB,SAAS,EAAE;gBACX,KAAK;oBACD,SAAS,EAAE,UAAU,WAAW;gBACpC;YACJ;YACA,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;gBACb,WAAW;gBACX,KAAK;oBACD,iBAAiB,UAAW,EAAE,QAAQ;oBACtC,kBAAkB;oBAClB,oBAAoB;oBACpB,gBAAgB,EAAE,UAAU,YAAY;oBACxC,yBAAyB;oBACzB,QAAQ;oBACR,WAAW,EAAE,WAAW,iBAAiB;oBACzC,eAAe;oBACf,SAAS,EAAE,YAAY,SAAS;gBACpC;YACJ;YACA,GAAG,OAAO;YACV,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC3C,QAAQ;gBACR,cAAc,CAAC;oBACX,GAAG,UAAU,OAAO,8BAA8B;gBACtD;YACJ;YACA,MAAM,aAAa,CAAC;gBAChB,GAAG,MAAM,UAAU,EAAE,UAAW,IAAI,cAAc,WAAY;YAClE;YACA,OAAO;gBACH;gBACA;gBACA;YACJ;QACJ;QAGA,MAAM,uBAAuB,CAAC;YAO1B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACjB,KAAK;oBACD,UAAU;oBACV,UAAU;gBACd;YACJ;YAEA,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,UAAU;gBACrB,aAAa;gBACb,OAAO;gBACP,QAAQ;gBACR,SAAS;gBACT,qBAAqB;YACzB;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,KAAK;gBACR,UAAU;gBACV,MAAM;gBACN,KAAK;YACT;YAEA,MAAM,aAAa;YACnB,MAAM,cAAc;YACpB,MAAM,cAAc;YAEpB,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,UAAW;gBACvB,aAAa;gBACb,aAAa;oBACT;wBACI,aAAa;wBACb,IAAI;wBACJ,IAAI;wBACJ,IAAI;wBACJ,OAAO;wBACP,QAAQ;wBACR,aAAa;4BACT;gCACI,aAAa;gCACb,IAAI;gCACJ,cAAc,KAAK;gCACnB,QAAQ;4BACZ;4BAAG;gCACC,aAAa;gCACb,IAAI,KAAK;gCACT,IAAI,KAAK;4BACb;4BAAG;gCACC,aAAa;gCACb,KAAK;gCACL,UAAU;gCACV,IAAI;gCACJ,IAAI;gCACJ,QAAQ;4BACZ;4BAEA;gCACI,aAAa;gCACb,eAAe;gCACf,iBAAiB;4BACrB;4BAAG;gCACC,aAAa;gCACb,KAAK;gCACL,UAAU;4BACd;4BAAG;gCACC,aAAa;gCACb,KAAK;gCACL,UAAU;gCACV,QAAQ;4BACZ;4BAEA;gCACI,aAAa;gCACb,IAAI;gCACJ,cAAc,KAAK;gCACnB,QAAQ;4BACZ;4BAAG;gCACC,aAAa;gCACb,IAAI,KAAK;gCACT,IAAI,KAAK;4BACb;4BAAG;gCACC,aAAa;gCACb,KAAK;gCACL,UAAU;gCACV,IAAI;gCACJ,IAAI;gCACJ,QAAQ;4BACZ;4BAEA;gCACI,aAAa;gCACb,eAAe;gCACf,iBAAiB;4BACrB;4BAAG;gCACC,aAAa;gCACb,KAAK;gCACL,UAAU;4BACd;4BAAG;gCACC,aAAa;gCACb,KAAK;gCACL,UAAU;4BACd;yBACH;oBACL;iBACH;YACL;YAGA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,UAAU;gBACjC,aAAa;gBACb,iBAAiB;gBACjB,GAAG;gBACH,MAAM;gBACN,OAAO;YACX;YACA,gBAAgB,UAAU;gBACtB,EAAE;gBACF,gBAAgB,UAAU,OAAO;YACrC;YAEA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,UAAU;gBAClC,aAAa;gBACb,iBAAiB;gBACjB,GAAG;gBACH,MAAM;gBACN,OAAO;YACX;YACA,iBAAiB,UAAU;gBACvB,EAAE;gBACF,iBAAiB,UAAU,OAAO;YACtC;YAEA,yCAAyC;YACzC,MAAM,sBAAsB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC/C,QAAQ;gBACR,cAAc,CAAC;oBACX,gBAAgB,UAAU,OAAO,uCAAuC;gBAC5E;YACJ;YACA,MAAM,uBAAuB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAChD,QAAQ;gBACR,cAAc,CAAC;oBACX,iBAAiB,UAAU,OAAO,uCAAuC;gBAC7E;YACJ;YAGA,IAAI,OAAO,MAAM,iBAAiB;YAClC,OAAO,OAAO;YAGd,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACjB,QAAQ;gBACR,WAAW;gBACX,KAAK;oBACD,iBAAiB,UAAW,EAAE,YAAY;oBAC1C,kBAAkB;oBAClB,gBAAgB;oBAChB,OAAO;oBACP,QAAQ;oBACR,UAAU;oBACV,MAAM;oBACN,KAAK;oBACL,8CAA8C;oBAC9C,eAAe;gBACnB;YACJ;YACA,OAAO,OAAO;YAGd,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;gBAClB,QAAQ;gBACR,WAAW;gBACX,KAAK;oBACD,iBAAiB,UAAY,CAAA,EAAE,aAAa,EAAE,aAAa,EAAE,SAAQ,IAAK;oBAC1E,kBAAkB;oBAClB,gBAAgB;oBAChB,OAAO;oBACP,QAAQ;oBACR,UAAU;oBACV,OAAO;oBACP,QAAQ;oBACR,WAAW,EAAE,aAAa,KAAK;oBAC/B,eAAe;gBACnB;YACJ;YAMA,MAAM,mBAAmB,CAAC;gBACtB,gBAAgB,UAAU,OAAO,iCAAiC,CAAC;gBACnE,OAAO,UAAU,OAAO,iCAAiC,CAAC;YAC9D;YAEA,MAAM,oBAAoB,CAAC;gBACvB,iBAAiB,UAAU,OAAO,iCAAiC,CAAC;gBACpE,QAAQ,UAAU,OAAO,iCAAiC,CAAC;YAC/D;YAEA,OAAO;gBACH,IAAI;gBACJ;gBACA;gBACA;gBACA;YACJ;QACJ;QAEA,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YACjC,UAAU,CAAC;gBACP,IAAI,CAAC,UAAU,WAAW;YAC9B;QACJ;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,aAAa;QAErC,IAAI,CAAC,aAAa,aAAa;YAC3B,SAAS;gBACL,IAAI,CAAC,UAAU,QAAQ;YAC3B;YACA,OAAO,CAAA,GAAA,2BAAU;YACjB,SAAS;YACT,WAAW;QACf;QACA,IAAI,CAAC,WAAW,GAAG,UAAU,IAAI;QACjC,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE;QAChC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,WAAW;QAEnC,IAAI,CAAC,mBAAmB,qBAAqB;YACzC,QAAQ,EAAE;YACV,SAAS,EAAE;YACX,WAAW,CAAA,GAAA,6BAAY;YACvB,YAAY,CAAA,GAAA,8BAAa;QAC7B;QACA,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE;QACtC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,iBAAiB;QAEzC,IAAI,CAAC,eAAe,aAAa;YAC7B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,6BAAY;YACnB,SAAS;QACb;QACA,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE;QAClC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,aAAa;QAErC,IAAI,CAAC,gBAAgB,aAAa;YAC9B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,8BAAa;YACpB,SAAS;QACb;QACA,IAAI,CAAC,cAAc,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE;QACnC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,cAAc;QAEtC,IAAI,CAAC,kBAAkB,qBAAqB;YACxC,QAAQ,EAAE;YACV,SAAS,EAAE;YACX,WAAW,CAAA,GAAA,2BAAU;YACrB,YAAY;QAChB;QACA,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE,UAAU,MAAM,CAAA,GAAA,cAAG,EAAE;QAC1D,IAAI,CAAC,gBAAgB,iBAAiB;QACtC,IAAI,CAAC,gBAAgB,kBAAkB;QACvC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,gBAAgB;QAExC,IAAI,CAAC,aAAa,aAAa;YAC3B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,2BAAU;YACjB,SAAS;QACb;QACA,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE;QAChC,IAAI,CAAC,WAAW,GAAG,UAAU,IAAI;QACjC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,WAAW;QAEnC,IAAI,CAAC,aAAa,aAAa;YAC3B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,2BAAU;YACjB,SAAS;YACT,UAAU;QACd;QACA,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAA,GAAA,cAAG,EAAE;QAChC,IAAI,CAAC,WAAW,GAAG,UAAU,IAAI;QACjC,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,WAAW;QAEnC,IAAI,CAAC,aAAa,GAAG,MAAM,UAAU;QACrC,IAAI,CAAC,cAAc,GAAG,MAAM,UAAU;QACtC,IAAI,CAAC,WAAW,GAAG,MAAM,UAAU;QACnC,IAAI,CAAC,WAAW,GAAG,MAAM,UAAU;IACvC;IAEA,sBAAsB;IAEtB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,CAAU,EAAQ;QAC1B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,QAAQ,IAAI,SAAS;QACzB;QAEA,IAAI,CAAC,aAAa,WAAW;QAC7B,IAAI,CAAC,WAAW,WAAW;QAC3B,IAAI,CAAC,aAAa,WAAW;QAC7B,IAAI,CAAC,cAAc,WAAW;QAC9B,IAAI,CAAC,WAAW,WAAW;QAC3B,IAAI,CAAC,WAAW,WAAW;QAE3B,IAAI,GAAG;YACH,IAAI,CAAC,iBAAiB,GAAG,MAAM,UAAU;YACzC,IAAI,CAAC,gBAAgB,GAAG,MAAM,UAAU;YACxC,IAAI,CAAC,aAAa,GAAG,MAAM,UAAU;YACrC,IAAI,CAAC,cAAc,GAAG,MAAM,UAAU;YACtC,IAAI,CAAC,WAAW,GAAG,MAAM,UAAU;YACnC,IAAI,CAAC,WAAW,GAAG,MAAM,UAAU;QACvC,OAAO;YACH,IAAI,CAAC,iBAAiB,GAAG,MAAM,UAAU;YACzC,IAAI,CAAC,gBAAgB,GAAG,MAAM,UAAU;YACxC,IAAI,CAAC,aAAa,GAAG,MAAM,UAAU;YACrC,IAAI,CAAC,cAAc,GAAG,MAAM,UAAU;YACtC,IAAI,CAAC,WAAW,GAAG,MAAM,UAAU;YACnC,IAAI,CAAC,WAAW,GAAG,MAAM,UAAU;QACvC;IAEJ;IAEA,gBAAiB,CAAU,EAAQ;QAC/B,IAAI,CAAC,aAAa,GAAG,UAAU,OAAO,iCAAiC,CAAC;QACxE,IAAI,CAAC,iBAAiB,iBAAiB;IAC3C;IAEA,iBAAkB,CAAU,EAAQ;QAChC,IAAI,CAAC,cAAc,GAAG,UAAU,OAAO,iCAAiC,CAAC;QACzE,IAAI,CAAC,iBAAiB,kBAAkB;IAC5C;IAEA,cAAe,CAAU,EAAQ;QAC7B,IAAI,CAAC,WAAW,GAAG,UAAU,OAAO,iCAAiC,CAAC;QACtE,IAAI,CAAC,gBAAgB,iBAAiB;IAC1C;IAEA,cAAe,CAAU,EAAQ;QAC7B,IAAI,CAAC,WAAW,GAAG,UAAU,OAAO,iCAAiC,CAAC;QACtE,IAAI,CAAC,gBAAgB,kBAAkB;IAC3C;IAEA,UAAW,SAAoB,EAAE,MAAgB,EAAQ;QACrD,IAAI,IAAI,CAAC,qBAAqB,WAC1B;QAGJ,IAAI,CAAC,mBAAmB;QAExB,IAAI,CAAC,aAAa,UAAU,IAAI,CAAC;QACjC,IAAI,CAAC,WAAW,GAAG,UAAU,OAAO,kCAAkC,IAAI,CAAC,qBAAqB;QAEhG,IAAI,QACA,IAAI,CAAC,WAAW,IAAI,CAAC;IAE7B;IAEA,YAAwB;QACpB,OAAO,IAAI,CAAC;IAChB;AACJ;;;ACxeA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;;;ACK/G;;CAEC,GACD,4DAAa;AARb;AACA;AACA;AAMO,MAAM;IAKT,mBAAmB;IACnB,YACI,CAGC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS;YACT,WAAW;YACX,SAAS,CAAA,GAAA,cAAG,EAAE,gBAAgB;YAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;QAChB;QAEA,MAAM,iBAAiB,IAAI,CAAA,GAAA,cAAK,EAAE;YAC9B,WAAW;gBACP;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;aACb;YACD,WAAW,KAAK,EAAE;YAClB,UAAU,SAAU,GAAG;gBACnB,EAAE,SAAS,SAAS;YACxB;QACJ;QACA,IAAI,CAAC,OAAO,OAAO,eAAe;QAElC,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC1C,QAAQ,IAAI,CAAC;YACb,SAAS,SAAU,CAAC;gBAChB,eAAe,cAAc,EAAE;YACnC;QACJ;IACJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;ACvBA;;CAEC,GACD,4CAAa;AAlCb;AACA;;AAiCO,MAAM;IAST,SAAS;IACT,SAAgB;QACZ,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,QAAQ,IACpC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC;IAEnC;IAEA,mBAAmB;IACnB,YACI,CAKC,CACH;QACE,MAAM,SAAS,EAAE,UAAU;QAC3B,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,QAAQ,AAAC,SAAS,IAAK;YAC3B;QACJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE,8BAA8B;QAEhD,MAAM,YAAY;QAClB,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,KAAK;gBACD,OAAO,YAAY;gBACnB,QAAQ,YAAY;gBACpB,iBAAiB,CAAC,KAAK,EAAE,CAAA,GAAA,iCAAgB,EAAE,EAAE,CAAC;gBAC9C,gBAAgB;gBAChB,UAAU;gBACV,OAAO,CAAC,YAAY;gBACpB,QAAQ;gBACR,eAAe;YACnB;QACJ;QACA,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,KAAK;gBACD,OAAO,YAAY;gBACnB,QAAQ,YAAY;gBACpB,iBAAiB,CAAC,KAAK,EAAE,CAAA,GAAA,iCAAgB,EAAE,EAAE,CAAC;gBAC9C,gBAAgB;gBAChB,UAAU;gBACV,MAAM,CAAC,YAAY;gBACnB,QAAQ;gBACR,WAAW;gBACX,eAAe;YACnB;QACJ;QAEA,MAAM,YAAY,CAAC,SAAmB,WAAmB;YACrD,MAAM,YAAY,AAAC,eAAe,WAAW,QAAQ,cAAc,YAAa,QAAQ,YAAY;YACpG,MAAM,SAAe;gBACjB,IAAI,QAAQ;gBACZ,WAAW;gBACX,QAAQ,QAAQ;gBAChB,SAAS,QAAQ;gBACjB,QAAQ,CAAC;oBACL,OAAO,GAAG,YAAY,iBAAiB,SAAU,YAAY,6CAA6C,oCAAqC;oBAC/I,OAAO,GAAG,MAAM,UAAU,OAAO,YAAY,UAAU;gBAC3D;gBACA,IAAI,CAAA,GAAA,MAAC,EAAE,GAAG;oBACN,QAAQ,IAAI,CAAC;oBACb,SAAS,WAAW,UAAU,QAAQ,QAAQ;oBAC9C,OAAO,WAAW,UAAU,QAAQ,QAAQ;oBAC5C,WAAW,cAAc,QAAQ,KAAM,YAAY,6CAA6C,oCAAqC;oBACrI,KAAK;wBACD,YAAY,SAAS;wBACrB,SAAS,YAAY,UAAU;wBAC/B,QAAQ;oBACZ;oBACA,SAAS;wBACL,IAAI,IAAI,CAAC,cAAc,QACnB;wBAEJ,IAAI,CAAC,KAAK,OAAO;oBACrB;gBACJ;gBACA,iBAAiB,CAAC;YACtB;YACA,IAAI,WAAW,SAEX,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;gBACT,QAAQ,OAAO;gBACf,WAAW;gBACX,KAAK;oBACD,iBAAiB,CAAC,KAAK,EAAE,QAAQ,MAAM,EAAE,CAAC;oBAC1C,gBAAgB;oBAChB,oBAAoB;oBACpB,kBAAkB;oBAClB,SAAS;oBACT,QAAQ,AAAC,SAAS,IAAK;oBACvB,gBAAgB;oBAChB,QAAQ;gBACZ;YACJ;YAEJ,IAAI,SAAS,WAAW,QAAQ,QAAQ,WACpC,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO,IAAI,QAAQ;YAG9B,OAAO,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC5C,QAAQ,OAAO;gBACf,cAAc,CAAC;oBACX,OAAO,GAAG,UAAU,OAAO,qBAAqB;gBACpD;YACJ;YAEA,IAAI,cAAc,OAAO,IAAI;gBACzB,OAAO;gBACP,OAAO,GAAG,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC;YAC3C,OACI,OAAO;YAGX,OAAO;QACX;QAEA,IAAI,aAAa;QACjB,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,OAAO,QAAQ,IAAK;YACtC,MAAM,MAAM,UAAU,EAAE,MAAM,CAAC,EAAE,EAAE,EAAE,WAAW,EAAE,aAAa;YAC/D,IAAI,IAAI,OAAO,EAAE,WACb,aAAa;YAEjB,IAAI,CAAC,OAAO,KAAK;QACrB;QACA,IAAI,CAAC,YACD,MAAM;QAEV,IAAI,CAAC,YAAY;IACrB;IAEA,sBAAsB;IAEtB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,KAAM,KAAa,EAAQ;QACvB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,QAAQ,IACpC,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,OAAO;YAC7B,IAAI,IAAI,CAAC,cAAc,IAAI,CAAC,MAAM,CAAC,EAAE,EACjC;YAEJ,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,YAAY,IAAI,CAAC,MAAM,CAAC,EAAE;YAC/B,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU,GAAG,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC;YAC/C,IAAI,CAAC;YACL;QACJ;QAEJ,MAAM;IACV;IAEA,iBAA0B;QACtB,OAAO,KAAK,IAAI,CAAC,UAAU;IAC/B;IAEA,aAAc,KAAa,EAAE,SAAkB,EAAQ;QACnD,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,QAAQ,IACpC,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,OAAO;YAC7B,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,YAAY;YAC3B,IAAI,CAAC;YACL;QACJ;QAEJ,MAAM;IACV;IAEA,UAAiB;QACb,IAAI,CAAC,OAAO,QAAQ,CAAA;YAChB,CAAA,GAAA,MAAC,EAAE,UAAU,KAAK;YAClB,KAAK,gBAAgB;QACzB;IACJ;AACJ;;;AC/NA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,iCAAiC,MAAM,KAAK;;;;;ACKrH;;CAEC,GACD,4CAAa;AARb;AACA;;AACA;;AACA;AAKO,MAAM;IAYD,WAAkB;QACtB,IAAI,CAAC,QAAQ,YAAY,KAAK,MAAM,IAAI,CAAC,QAAQ,OAAO;QACxD,IAAI,CAAC,QAAQ,YAAa,KAAK,MAAM,IAAI,CAAC,YAAY;QAEtD,IAAI,CAAC,QAAQ,MAAM,YAAY,YAAY,IAAI,CAAC,WAAW;QAC3D,IAAI,IAAI,CAAC,WAAW,OAAO,GACvB,IAAI,CAAC,QAAQ,MAAM,YAAY;aAE/B,IAAI,CAAC,QAAQ,MAAM,YAAY;IAEvC;IAGA,mBAAmB;IAEnB,YACI,CAMC,CACH;aA/BM,YAAqB;QAgCzB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,QAAQ,EAAE;QACf,IAAI,CAAC,WAAW,EAAE;QAClB,IAAI,CAAC,gBAAgB,EAAE;QAEvB,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,KAAK;gBACD,cAAc;gBACd,SAAS;YACb;QACJ;QACA,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,KAAK;gBACD,SAAS;gBACT,cAAc;YAClB;QACJ;QACA,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,KAAK;gBACD,SAAS;YACb;QACJ;QACA,IAAI,CAAC,OAAO,OAAO,MAAM,MAAM;QAG/B,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,KAAK;gBACD,OAAO;gBACP,YAAY;YAChB;QACJ;QACA,KAAK,OAAO,IAAI,CAAC;QAEjB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,QAAQ,MAAM,CAAA,GAAA,wBAAO;QAC1B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS;YACjB,eAAe;YACf,OAAO;YACP,QAAQ;YACR,aAAa;YACb,cAAc;YACd,YAAY;YACZ,YAAY;QAChB;QACA,KAAK,OAAO,IAAI,CAAC;QAEjB,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,QAAQ;YACR,KAAK;gBACD,YAAY;YAChB;QACJ;QAEA,IAAI,CAAC;QAGL,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,SAAS;YACT,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,SAAS,EAAE;QACf;QACA,CAAA,GAAA,MAAC,EAAE,gBAAgB;QAEnB,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,SAAS;YACT,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,KAAK;gBACD,YAAY;YAChB;YACA,SAAS,EAAE;QACf;QACA,CAAA,GAAA,MAAC,EAAE,gBAAgB;QACnB,KAAK,OAAO,aAAa;QAEzB,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC3B,SAAS;YACT,SAAS,2BAA2B,CAAA,GAAA,6BAAQ,IAAI;YAChD,SAAS;gBACL,EAAE,cAAc,KAAK;YACzB;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,gBAAgB;QAEnB,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC3B,SAAS;YACT,SAAS;YACT,KAAK;gBACD,YAAY;YAChB;YACA,SAAS;gBACL,EAAE,cAAc;YACpB;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,gBAAgB;QAEnB,MAAM,oBAAoB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC5B,SAAS;YACT,SAAS,2BAA2B,CAAA,GAAA,6BAAQ,IAAI;YAChD,KAAK;gBACD,YAAY;YAChB;YACA,SAAS;gBACL,EAAE,cAAc,IAAI;YACxB;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,gBAAgB;QACnB,KAAK,OAAO,kBAAkB,kBAAkB;IAEpD;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,UAAmB,EAAQ;QACrC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,MAAM,UAAU,IAAI,CAAC,YAAY,UAAU;QACvD,IAAI,IAAI,CAAC,WACL,IAAI,CAAC;IAEb;IAEA,OAAQ,MAAc,EAAE,SAAiB,EAAQ;QAC7C,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,WAAW;QAChB,IAAI,IAAI,CAAC,WACL,IAAI,CAAC;IAEb;AACJ;;;ACjLA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;ACQjH;;CAEC,GACD,4CAAa;AAXb;AACA;AACA;AACA;AACA;AAOO,MAAM;IAcT,mBAAmB;IAEnB,YACI,CAEC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,YAAY;QAEjB,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,cAAc;YAClB;QACJ;QAEA,IAAI,CAAC,cAAc,EAAE;QAErB,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO;YACP,SAAS,CAAC,eAAiB,eAAe;YAC1C,gBAAgB,CAAC,QAAU,QAAQ;QACvC;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,cAAc;QAEtC,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAChC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO;YACP,SAAS,CAAC,eAAiB,eAAgB;YAC3C,gBAAgB,CAAC,QAAU,QAAS;QACxC;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,cAAc;YACtC,WAAW;QACf;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,gBAAgB;QAExC,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,SAAS;gBACT,WAAW;YACf;QACJ;QAEA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,SAAS,CAAA,GAAA,cAAG,EAAE,mBAAmB;YACjC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBACD,UAAU;YACd;QACJ;QACA,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,cAAK,EAAE;YACzB,WAAW;gBACP;oBAAC;oBAAO,CAAA,GAAA,cAAG,EAAE;iBAAqB;gBAClC;oBAAC;oBAAW,CAAA,GAAA,cAAG,EAAE;iBAAwB;gBACzC;oBAAC;oBAAS,CAAA,GAAA,cAAG,EAAE;iBAAuB;aACzC;YACD,WAAW;QACf;QACA,MAAM,sBAAsB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,WAAW;YACxB,SAAS,CAAC;gBACN,IAAI,CAAC,WAAW,cAAc,EAAE;YACpC;QACJ;QACA,YAAY,OAAO,IAAI,CAAC,WAAW;QACnC,UAAU,OAAO;QAEjB,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,SAAS,CAAA,GAAA,cAAG,EAAE,iBAAiB;YAC/B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBACD,UAAU;gBACV,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,cAAK,EAAE;YACzB,WAAW;gBACP;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;gBACV;oBAAC;oBAAK;iBAAI;aACb;YACD,WAAW;QACf;QACA,MAAM,sBAAsB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC/C,QAAQ,IAAI,CAAC,WAAW;YACxB,SAAS,CAAC;gBACN,IAAI,CAAC,WAAW,cAAc,EAAE;YACpC;QACJ;QACA,YAAY,OAAO,IAAI,CAAC,WAAW;QACnC,UAAU,OAAO;QAGjB,IAAI,CAAC,eAAe;QACpB,MAAM,mBAAmB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAClC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,eAAe;YACxB;YACA,KAAK;gBACD,cAAc;gBACd,SAAS;gBACT,OAAO;YACX;QACJ;QAEA,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC7B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBAED,cAAc;gBACd,SAAS;gBACT,OAAO;YACX;QACJ;QAEA,IAAI,CAAC,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,SAAS;gBACL,iBAAiB;gBACjB,IAAI,CAAC,aAAa;aACrB;YACD,KAAK;gBACD,SAAS;gBACT,WAAW;YACf;QACJ;IACJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,UAAmB,EAAQ;QACrC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,MAAM,UAAU,IAAI,CAAC,YAAY,UAAU;QACvD,IAAI,IAAI,CAAC,WACL,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,YAAY,cAAc,IAAI,CAAC,YAAY;IAE7E;IAEA;;KAEC,GACD,eAAwB;QACpB,OAAO,IAAI,CAAC,gBAAgB;IAChC;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC,cAAc;IAC9B;IAEA,YAA4B;QACxB,OAAO,IAAI,CAAC,WAAW;IAC3B;IAEA,UAAmB;QACf,OAAO,SAAS,IAAI,CAAC,WAAW,YAAY;IAChD;IAEA,gBAA0B;QACtB,OAAO,IAAI,CAAC;IAChB;IAEA,cAAwB;QACpB,OAAO,IAAI,CAAC,aAAa;IAC7B;AAEJ;;;;;ACnNA;;CAEC,GACD,4CAAa;AAPb;AACA;AAMO,MAAM;IAOT,mBAAmB;IAEnB,YACI,CAEC,CACH;aATM,YAAqB;QAUzB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,cAAc,EAAE;QAErB,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,cAAc;YAClB;QACJ;QAEA,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ,IAAI,CAAC;YACb,SAAS,CAAA,GAAA,cAAG,EAAE;QAClB;IACJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,UAAmB,EAAQ;QACrC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,MAAM,UAAU,IAAI,CAAC,YAAY,UAAU;QACvD,IAAI,IAAI,CAAC,WACL,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,YAAY,cAAc,IAAI,CAAC,YAAY;IAE7E;AACJ;;;;;AC5CA;;CAEC,GACD,6CAAa;AAXb;AACA;AACA;AACA;AACA;AAOO,MAAM;IAiBT,mBAAmB;IAEnB,YACI,CAEC,CACH;aAjBM,QAAwB;aACxB,OAAuB;QAiB3B,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,YAAY;QAEjB,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,cAAc;YAClB;QACJ;QAEA,IAAI,CAAC,cAAc,EAAE;QAErB,MAAM,cAAc;QACpB,MAAM,iBAAiB;QAGvB,MAAM,oBAAoB,CAAA,GAAA,MAAC,EAAE,UAAU;YACnC,aAAa;YACb,GAAG,KAAK;YACR,OAAO,KAAM,CAAA,cAAc,iBAAiB,CAAA;QAChD;QACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,UAAU;YAC/B,aAAa;YACb,OAAO,KAAK;YACZ,QAAQ,KAAK;QACjB;QACA,cAAc,UAAU,IAAI;QAC5B,cAAc,OAAO;QACrB,CAAA,GAAA,MAAC,EAAE,IAAI,eAAe;YAClB,SAAS;QACb;QAEA,MAAM,oBAAoB,CAAA,GAAA,MAAC,EAAE,UAAU;YACnC,aAAa;YACb,GAAG,KAAK;YACR,OAAO,KAAM,CAAA,cAAc,iBAAiB,CAAA;QAChD;QACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,UAAU;YAC/B,aAAa;YACb,OAAO,KAAK;YACZ,QAAQ,KAAK;QACjB;QACA,cAAc,UAAU,IAAI;QAC5B,cAAc,OAAO;QACrB,CAAA,GAAA,MAAC,EAAE,IAAI,eAAe;YAClB,SAAS;QACb;QAGA,MAAM,0BAA0B,CAAA,GAAA,MAAC,EAAE,UAAU;YACzC,aAAa;YACb,IAAI,KAAM,cAAc;YACxB,IAAI,KAAM,cAAc;YACxB,IAAI,KAAM,CAAA,cAAc,IAAI,cAAa;QAC7C;QACA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,UAAU;YAClC,aAAa;YACb,OAAO,KAAK;YACZ,QAAQ,KAAK;QACjB;QACA,iBAAiB,UAAU,IAAI;QAC/B,iBAAiB,OAAO;QACxB,CAAA,GAAA,MAAC,EAAE,IAAI,kBAAkB;YACrB,SAAS;QACb;QAEA,MAAM,0BAA0B,CAAA,GAAA,MAAC,EAAE,UAAU;YACzC,aAAa;YACb,IAAI,KAAM,cAAc;YACxB,IAAI,KAAM,cAAc;YACxB,IAAI,KAAM,CAAA,cAAc,IAAI,cAAa;QAC7C;QACA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,UAAU;YAClC,aAAa;YACb,OAAO,KAAK;YACZ,QAAQ,KAAK;QACjB;QACA,iBAAiB,UAAU,IAAI;QAC/B,iBAAiB,OAAO;QACxB,CAAA,GAAA,MAAC,EAAE,IAAI,kBAAkB;YACrB,SAAS;QACb;QAGA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,UAAU;YAC7B,aAAa;YACb,IAAI,KAAK;YACT,IAAI,KAAM,CAAA,cAAc,cAAa;QACzC;QACA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,UAAU;YACzB,aAAa;YACb,OAAO,KAAK;YACZ,QAAQ,KAAK;QACjB;QACA,QAAQ,UAAU,IAAI;QACtB,QAAQ,OAAO;QACf,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS;YACZ,SAAS;QACb;QAEA,MAAM,iBAAiB;YACnB,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,MAAM,KAAK,MAAM,IAAI,CAAC,gBAAgB,aAAa,KAAK,GAAG,MAAM;YAExF,MAAM,SAAS;YAEf,CAAA,GAAA,MAAC,EAAE,IAAI,mBAAmB;gBAAE,MAAM;gBAAQ,QAAQ;gBAAS,aAAa;YAAY;YACpF,CAAA,GAAA,MAAC,EAAE,IAAI,mBAAmB;gBAAE,MAAM;gBAAS,QAAQ;YAAO;YAE1D,CAAA,GAAA,MAAC,EAAE,IAAI,yBAAyB;gBAAE,MAAM;gBAAQ,QAAQ;gBAAS,aAAa;YAAY;YAC1F,CAAA,GAAA,MAAC,EAAE,IAAI,yBAAyB;gBAAE,MAAM;gBAAS,QAAQ;YAAO;YAEhE,CAAA,GAAA,MAAC,EAAE,IACC,aACA;gBAAE,MAAM;gBAAQ,QAAQ;gBAAS,aAAa;YAAY;YAG9D,IAAI,IAAI,CAAC,YAAY,YAAY;gBAC7B,kBAAkB,aAAa,KAAK,KAAK;gBACzC,kBAAkB,aAAa,UAAU,KAAM,CAAA,cAAc,iBAAiB,CAAA;gBAC9E,kBAAkB,aAAa,KAAK,KAAK;gBACzC,kBAAkB,aAAa,UAAU,KAAM,CAAA,cAAc,iBAAiB,CAAA;gBAE9E,wBAAwB,aAAa,MAAM,KAAM,CAAA,cAAc,IAAI,cAAa;gBAChF,wBAAwB,aAAa,MAAM,KAAM,CAAA,cAAc,IAAI,cAAa;YACpF,OAAO;gBACH,kBAAkB,aAAa,KAAK,KAAM,iBAAiB;gBAC3D,kBAAkB,aAAa,UAAU,KAAM,CAAA,cAAc,iBAAiB,SAAS,CAAA;gBACvF,kBAAkB,aAAa,KAAK,KAAM,iBAAiB;gBAC3D,kBAAkB,aAAa,UAAU,KAAM,CAAA,cAAc,iBAAiB,SAAS,CAAA;gBAEvF,wBAAwB,aAAa,MAAM,KAAM,CAAA,cAAc,IAAI,iBAAiB,MAAK;gBACzF,wBAAwB,aAAa,MAAM,KAAM,CAAA,cAAc,IAAI,iBAAiB,MAAK;YAC7F;YAEA,IAAI,IAAI,CAAC,WAAW,YAAY;gBAC5B,YAAY,aAAa,MAAM,KAAM,CAAA,cAAc,cAAa;gBAChE,YAAY,aAAa,MAAM,KAAK;YACxC,OAAO;gBACH,YAAY,aAAa,MAAM,KAAM,CAAA,cAAc,iBAAiB,MAAK;gBACzE,YAAY,aAAa,MAAM,KAAM,iBAAiB;YAC1D;QACJ;QAEA,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,SAAS;gBACT,gBAAgB;gBAChB,YAAY;YAChB;QACJ;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,gBAAM,EAAE;YAC7B,WAAW;gBACP;oBACI,IAAI;oBACJ,OAAO;oBACP,OAAO,CAAA,GAAA,cAAG,EAAE,gBAAgB,MAAM,CAAA,GAAA,cAAG,EAAE;gBAC3C;gBACA;oBACI,IAAI;oBACJ,OAAO;oBACP,OAAO,CAAA,GAAA,cAAG,EAAE,mBAAmB,MAAM,CAAA,GAAA,cAAG,EAAE;gBAC9C;gBACA;oBACI,IAAI;oBACJ,OAAO;oBACP,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO;oBACP,OAAO,CAAA,GAAA,cAAG,EAAE,gBAAgB,MAAM,CAAA,GAAA,cAAG,EAAE;gBAC3C;gBACA;oBACI,IAAI;oBACJ,OAAO;oBACP,OAAO,CAAA,GAAA,cAAG,EAAE,mBAAmB,MAAM,CAAA,GAAA,cAAG,EAAE;gBAC9C;aACH;YACD,QAAQ,IAAI,CAAC,QAAQ,MAAM,IAAI,CAAC;YAChC,UAAU,CAAC;gBACP,MAAM,QAAQ,GAAG,MAAM;gBACvB,IAAI,CAAC,QAAQ,KAAK,CAAC,EAAE;gBACrB,IAAI,CAAC,OAAO,KAAK,CAAC,EAAE;gBAEpB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,YAAY,cAAc;oBAClC,SAAS,IAAI,CAAC,UAAU,SAAS,SAAS;gBAC9C;gBACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW,cAAc;oBACjC,SAAS,IAAI,CAAC,UAAU,SAAS,KAAK;gBAC1C;gBACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,cAAc;oBACtC,SAAS,AAAC,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,SAAS,SAAU,SAAS;gBACxE;YACJ;YACA,cAAc;QAClB;QACA,aAAa,aAAa,MAAM,QAAQ;QACxC,KAAK,OAAO,aAAa;QAEzB,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC7B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;gBACN;YACJ;QACJ;QAEA,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAChC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,aAAa;QACjB;QACA,IAAI,CAAC,gBAAgB,aAAa,MAAM,YAAY;QAEpD,KAAK,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACd,SAAS;gBACL,IAAI,CAAC,aAAa;gBAClB,IAAI,CAAC,gBAAgB;aACxB;QACL;QAEA,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAChC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO;YACP,OAAO;YACP,UAAU;gBACN;YACJ;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,gBAAgB,cAAc;YACtC,WAAW;QACf;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,gBAAgB;QAExC,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO;YACP,SAAS,CAAC,eAAiB,eAAe;YAC1C,gBAAgB,CAAC,QAAU,QAAQ;QACvC;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,cAAc,cAAc;YACpC,WAAW;QACf;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,cAAc;QAEtC,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,WAAW;YACf;QACJ;QAEA,IAAI,CAAC,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBACD,OAAO;gBACP,aAAa;YACjB;QACJ;QACA,KAAK,OAAO,IAAI,CAAC,eAAe;QAEhC,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC5B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;gBACN;YACJ;YACA,KAAK;gBACD,UAAU;YACd;QACJ;QACA,KAAK,OAAO,IAAI,CAAC,YAAY;QAE7B,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC3B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;gBACN;YACJ;YACA,KAAK;gBACD,UAAU;YACd;QACJ;QACA,KAAK,OAAO,IAAI,CAAC,WAAW;QAG5B;IACJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,UAAmB,EAAQ;QACrC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,MAAM,UAAU,IAAI,CAAC,YAAY,UAAU;QACvD,IAAI,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,YAAY;YACtC,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,YAAY;QACtC,WAAW;QACf;IACJ;IAEA,WAA4B;QACxB,OAAO,IAAI,CAAC;IAChB;IAEA,UAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,cAAwB;QACpB,OAAO,IAAI,CAAC,aAAa;IAC7B;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC,cAAc;IAC9B;IAEA,eAAwB;QACpB,OAAO,IAAI,CAAC,gBAAgB;IAChC;IAEA,gBAA0B;QACtB,OAAO,IAAI,CAAC,eAAe;IAC/B;IAEA,aAAuB;QACnB,OAAO,IAAI,CAAC,YAAY;IAC5B;IAEA,YAAsB;QAClB,OAAO,IAAI,CAAC,WAAW;IAC3B;IAEA,iBAA2B;QACvB,OAAO,IAAI,CAAC,gBAAgB;IAChC;AACJ;;;;;AC7XA,oDAAgB;AAXhB;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEO,SAAS,eACZ,CAUC;IAGD,MAAM,eAAe,EAAE;IACvB,MAAM,iBAAiB,EAAE;IACzB,MAAM,gBAAgB,EAAE;IACxB,MAAM,cAAc,EAAE;IACtB,MAAM,eAAe,EAAE;IACvB,MAAM,iBAAiB,EAAE;IACzB,MAAM,kBAAkB,EAAE;IAC1B,MAAM,YAAY,EAAE;IACpB,MAAM,WAAW,EAAE;IAEnB,SAAS,gBAAiB,MAAc,EAAE,MAAc,EAAE,KAAa,EAAE,MAAc,EAAE,OAAe;QACpG,OAAO,CAAA,GAAA,MAAC,EAAE,QACN,QACA,QACA,KAAK,IAAI,eAAe,QAAQ,UAAU,KAAK,IAAI,eAAe,SAAS,UAC3E;IAER;IAEA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE;IACpB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAO;IAC1C,MAAM,YAAY;QACd,OAAO;QACP,UAAU;QACV,YAAY;IAChB;IACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;QACpB,aAAa,CAAA,GAAA,cAAG,EAAE;QAClB,KAAK;IACT;IACA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAO;IAC3C,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;QACrB,aAAa,CAAA,GAAA,cAAG,EAAE;QAClB,KAAK;IACT;IAEA,WAAW,aAAa,qBAAqB;IAC7C,YAAY,aAAa,qBAAqB;IAE9C,WAAW,OAAO;IAClB,WAAW,MAAM;IACjB,WAAW,MAAM,KAAK;IACtB,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY;QACf,OAAO;IACX;IAEA,YAAY,OAAO;IACnB,YAAY,MAAM;IAClB,YAAY,MAAM,KAAK;IACvB,YAAY,MAAM,QAAQ;IAC1B,WAAW,QAAQ,KAAK;IACxB,YAAY,QAAQ,KAAK;IACzB,WAAW,UAAU;QACjB,WAAW;QACX;IACJ;IACA,YAAY,UAAU;QAClB,YAAY;QACZ;IACJ;IAGA,MAAM,YAAY,CAAA,GAAA,YAAI,EAAE;QACpB;YACI,CAAA,GAAA,cAAG,EAAE,WAAW;YAChB;YACA;SACH;QACD;YACI,CAAA,GAAA,MAAC,EAAE,GAAG;gBAAC,KAAK;oBAAC,QAAQ;gBAAK;YAAC;YAC3B;YACA;SACH;QACD;YACI,CAAA,GAAA,cAAG,EAAE,YAAY;YACjB;YACA;SACH;KACJ;IACD,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW;QACd,cAAc;IAClB;IAGA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;QACvB,KAAK;YACD,WAAW;YACX,OAAO;QACX;IACJ;IAEA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE;IAC3B,kEAAkE;IAClE,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAQ;IAC7C,gBAAgB,MAAM,eAAe;IACrC,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAQ;IACjD,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAQ;IAChD,MAAM,qBAAqB,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAQ;IACnD,MAAM,oBAAoB,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAQ;IAClD,MAAM,oBAAoB,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAQ;IAElD,iBAAiB,cAAc,CAAA,GAAA,cAAG,EAAE;IACpC,aAAa,cAAc,CAAA,GAAA,cAAG,EAAE;IAChC,kBAAkB,cAAc,CAAA,GAAA,cAAG,EAAE;IACrC,mBAAmB,cAAc,CAAA,GAAA,cAAG,EAAE;IACtC,kBAAkB,cAAc,CAAA,GAAA,cAAG,EAAE;IACrC,gBAAgB,cAAc,CAAA,GAAA,cAAG,EAAE;IAEnC,iBAAiB,MAAM,cAAc;IACrC,aAAa,MAAM,cAAc;IACjC,kBAAkB,MAAM,cAAc;IACtC,mBAAmB,MAAM,YAAY;IACrC,mBAAmB,MAAM,cAAc;IACvC,kBAAkB,MAAM,YAAY;IACpC,kBAAkB,MAAM,cAAc;IAEtC,gBAAgB,OACZ,kBACA,cACA,mBACA,iBACA,oBACA;IAGJ,MAAM,kBAAkB;IAExB,iBAAiB,UAAU;QACvB,WAAW,QAAQ,KAAK;QACxB,YAAY,QAAQ,KAAK;QACzB;IACJ;IACA,aAAa,UAAU;QACnB,WAAW,QAAQ,KAAK;QACxB,YAAY,QAAQ,KAAK;QACzB;IACJ;IACA,kBAAkB,UAAU;QACxB,WAAW,QAAQ,KAAM,CAAA,iBAAiB,GAAE;QAC5C,YAAY,QAAQ,KAAM,CAAA,kBAAkB,GAAE;QAC9C;IACJ;IACA,gBAAgB,UAAU;QACtB,MAAM,UAAU,gBAAgB,GAAG,GAAG,gBAAgB,iBAAiB;QACvE,WAAW,QAAQ,KAAK,KAAK,MAAM,QAAQ;QAC3C,YAAY,QAAQ,KAAK,KAAK,MAAM,QAAQ;QAC5C;IACJ;IACA,mBAAmB,UAAU;QACzB,MAAM,UAAU,gBAAgB,GAAG,GAAG,gBAAgB,iBAAiB;QACvE,WAAW,QAAQ,KAAK,KAAK,MAAM,QAAQ;QAC3C,YAAY,QAAQ,KAAK,KAAK,MAAM,QAAQ;QAC5C;IACJ;IACA,kBAAkB,UAAU;QACxB,MAAM,UAAU,gBAAgB,GAAG,GAAG,gBAAgB,iBAAiB;QACvE,WAAW,QAAQ,KAAK,KAAK,MAAM,QAAQ;QAC3C,YAAY,QAAQ,KAAK,KAAK,MAAM,QAAQ;QAC5C;IACJ;IAEA,MAAM,SAAS,IAAI,CAAA,GAAA,cAAK,EAAE;QACtB,aAAa;QACb,WAAW;YACP;gBAAC;gBAAU,CAAA,GAAA,cAAG,EAAE;aAAc;YAC9B;gBAAC;gBAAQ,CAAA,GAAA,cAAG,EAAE,eAAe;aAAQ;YACrC;gBAAC;gBAAO;aAAM;YACd;gBAAC;gBAAO;aAAM;YACd;gBAAC;gBAAO;aAAM;YACd;gBAAC;gBAAS,CAAA,GAAA,cAAG,EAAE,mBAAmB;aAAQ;YAC1C;gBAAC;gBAAQ;aAAO;YAChB;gBAAC;gBAAO;aAAM;YACd;gBAAC;gBAAO;aAAM;YACd;gBAAC;gBAAO;aAAM;YACd;gBAAC;gBAAwB;aAAO;SACnC;QACD,UAAU,SAAU,GAAG;YACnB,IAAI,QAAQ,UAAU;gBAClB,WAAW,QAAQ,KAAK,OAAO,OAAO;gBACtC,YAAY,QAAQ,KAAK,OAAO,OAAO;YAC3C,OAAO,IAAI,QAAQ,SAAS;gBACxB,MAAM,UAAU,gBAAgB,KAAK,KAAK,IAAI,GAAG,gBAAgB,iBAAiB;gBAClF,WAAW,QAAQ,KAAK,KAAK,MAAM,QAAQ;gBAC3C,YAAY,QAAQ,KAAK,KAAK,MAAM,QAAQ;YAChD,OAAO;gBACH,MAAM,QAAQ,IAAI,MAAM;gBACxB,MAAM,UAAU,gBAAgB,WAAW,KAAK,CAAC,EAAE,GAAG,WAAW,KAAK,CAAC,EAAE,GAAG,gBAAgB,iBAAiB;gBAC7G,WAAW,QAAQ,KAAK,KAAK,MAAM,QAAQ;gBAC3C,YAAY,QAAQ,KAAK,KAAK,MAAM,QAAQ;YAChD;YACA;YACA,OAAO,SAAS;QACpB;IACJ;IACA,WAAW;QACP,gEAAgE;QAChE,OAAO,SAAS;IACpB,GAAG;IACH,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO,cAAc;QACxB,OAAO;IACX;IACA,gBAAgB,OAAO,OAAO;IAI9B,IAAI,iBAAiB;QAAC,GAAG;QAAK,GAAG;QAAK,GAAG;QAAK,GAAG;IAAC;IAElD,MAAM,kBAAkB;QACpB;YAAC,GAAG;YAAK,GAAG;YAAK,GAAG;YAAK,GAAG;QAAC;QAC7B;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC;QACvB;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC;QACvB;YACI,GAAG,aAAa;YAChB,GAAG,aAAa;YAChB,GAAG,aAAa;YAChB,GAAG;QACP;QACA;YACI,GAAG,eAAe;YAClB,GAAG,eAAe;YAClB,GAAG,eAAe;YAClB,GAAG;QACP;KACH;IACD,IAAI,iBAAiB;IACrB,IAAI,CAAA,GAAA,YAAI,EAAE,UACN,gBAAgB,QAAQ,CAAC,MAAM;QAC3B,IAAI,KAAK,MAAM,CAAA,GAAA,uBAAU,KAAK,KAAK,MAAM,CAAA,GAAA,uBAAU,KAAK,KAAK,MAAM,CAAA,GAAA,uBAAU,GAAG;YAC5E,iBAAiB;YACjB,iBAAiB;QACrB;IACJ;IAGJ,MAAM,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;QAClC,UAAU;QACV,cAAc;QACd,UAAU,SAAU,OAAO;YACvB,iBAAiB;YACjB,QAAQ,MAAM,kBAAkB,UAAU,QAAS,IAAI,MAAM,QAAS,IAAI,MAAM,QAAS,IAAI,OAAO,QAAS,IAAI;QACrH;IACJ;IAEA,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;QACzB,WAAW;QACX,KAAK;YACD,WAAW;YACX,OAAO;YACP,QAAQ;YACR,SAAS;YACT,SAAS;YACT,WAAW;YACX,YAAY;QAChB;IACJ;IACA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;QAClB,WAAW;QACX,KAAK;YACD,OAAO;YACP,QAAQ;YACR,iBAAiB,UAAU,eAAe,IAAI,MAAM,eAAe,IAAI,MAAM,eAAe,IAAI,OAAO,eAAe,IAAI;YAC1H,YAAY;YACZ,aAAa;YACb,OAAO;YACP,UAAU;YACV,YAAY;YACZ,WAAW;YACX,eAAe;YACf,SAAS;YACT,UAAU;QACd;IACJ;IACA,CAAA,GAAA,MAAC,EAAE,GAAG;QACF,QAAQ;QACR,SAAS;QACT,KAAK;YACD,SAAS;YACT,eAAe;QACnB;IACJ;IACA,CAAA,GAAA,MAAC,EAAE,GAAG;QACF,QAAQ;QACR,KAAK;YACD,SAAS;YACT,eAAe;QACnB;IACJ;IAEA,SAAS;QACL,WAAW,QAAQ,KAAK,KAAK,IAAI,eAAe,SAAS,WAAW;QACpE,YAAY,QAAQ,KAAK,KAAK,IAAI,eAAe,SAAS,YAAY;QAEtE,SAAS,IAAK,CAAS,EAAE,CAAS;YAC9B,IAAI,IAAI,GAAG,IAAI;YACf,iDAAiD;YACjD,MAAO,KAAM;gBACT,IAAI,CAAE,CAAA,KAAK,CAAA,GACP,OAAO;gBAEX,IAAI,CAAE,CAAA,KAAK,CAAA,GACP,OAAO;YAEf;QACJ;QAEA,IAAI,IAAI,SAAS,WAAW;QAC5B,IAAI,IAAI,SAAS,YAAY;QAC7B,IAAI,IAAI,KAAK,IAAI,iBAAiB,IAAI,KAAK,IAAI,eAAe;YAC1D,IAAI,IAAI,eACJ,IAAI;iBACD,IAAI,IAAI,eACX,IAAI;YAGR,WAAW,QAAQ,KAAK;YACxB,YAAY,QAAQ,KAAK;QAC7B;QAEA,4FAA4F;QAC5F,MAAM,eAAe;YACjB;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAI;aAAE;YAAE;gBAAC;gBAAG;aAAG;YAChB;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAG;aAAE;YACd;gBAAC;gBAAO;aAAE;YAAE;gBAAC;gBAAG;aAAM;SACzB;QACD,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QAChC,IAAI,eAAe,YAAY,CAAC,EAAE;QAClC,IAAI,kBAAkB,KAAK,IAAI,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,CAAC,EAAE,GAAG,UAAU,CAAC,EAAE;QACtG,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,QAAQ,IACrC,IAAI,KAAK,IAAI,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,CAAC,EAAE,GAAG,UAAU,CAAC,EAAE,IAAI,iBAAiB;YACrG,eAAe,YAAY,CAAC,EAAE;YAC9B,kBAAkB,KAAK,IAAI,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,UAAU,CAAC,EAAE,GAAG,UAAU,CAAC,EAAE;QACtG;QAEJ,eAAe;QACf,IAAI,kBAAkB,KAAK,kBAAkB,OACzC,aAAa,YAAY,CAAA,GAAA,cAAG,EAAE,eAAe,QAAQ,YAAY,CAAC,EAAE,GAAG,MAAM,YAAY,CAAC,EAAE;aAE5F,aAAa,YAAY,CAAA,GAAA,cAAG,EAAE,eAAe,OAAO,UAAU,CAAC,EAAE,GAAG,MAAM,UAAU,CAAC,EAAE;QAG3F,MAAM,QAAQ;QACd,MAAM,IAAI,IAAI,GAAG;QACjB,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,IAAI,IAAI,KAAK;YACT,IAAI,MAAM,IAAI;YACd,IAAI;QACR;QACA,IAAI,IAAI,KAAK;YACT,IAAI,MAAM,IAAI;YACd,IAAI;QAER;QAEA,QAAQ,MAAM,QAAQ,IAAI;QAC1B,QAAQ,MAAM,SAAS,IAAI;QAC3B,CAAA,GAAA,MAAC,EAAE,qBAAqB,SAAS,KAAM,KAAM,CAAA,IAAI,KAAI,IAAM,SAAU,GAAG;YACpE,eAAe,MAAM,aAAa,SAAS,MAAM;QACrD,GAAG,CAAA,GAAA,YAAI,EAAE;IACb;IACA,CAAA,GAAA,YAAI,EAAE,kBAAkB;IAExB,WAAW,WAAW;QAClB,IAAI,WAAW,UAAU,MAAM,SAAS,WAAW,SAAS,GACxD,WAAW,QAAQ;QAEvB;IACJ;IACA,WAAW,UAAU;QACjB;IACJ;IACA,YAAY,WAAW;QACnB,IAAI,YAAY,UAAU,MAAM,WAAW,YAAY,SAAS,GAC5D,YAAY,QAAQ;QAExB;IACJ;IACA,YAAY,UAAU;QAClB;IACJ;IACA;IAEA,SAAS,OAAO;IAChB,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;QACpB,QAAQ;QACR,KAAK;YACD,SAAS;YACT,gBAAgB;YAChB,YAAY;QAChB;IACJ;IACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;QACxB,QAAQ;IACZ;IACA,cAAc,OAAO,WAAW;IAChC,UAAU,OAAO,aAAa;IAE9B,SAAS,OAAO;IAEhB,CAAA,GAAA,oBAAQ,EAAE;QACN,QAAQ,SAAS;QACjB,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,aAAa,IAAI,CAAC;QACtC,KAAK;QACL,SAAS;YAAC;YAAM;SAAS;QACzB,UAAU,SAAU,MAAM;YACtB,CAAA,GAAA,MAAC,EAAE,kBAAkB,YAAY,WAAW,YAAY;YACxD,CAAA,GAAA,MAAC,EAAE,kBAAkB,YAAY,WAAW,YAAY;YAExD,CAAA,GAAA,MAAC,EAAE,kBAAkB,kBAAkB;YACvC,CAAA,GAAA,MAAC,EAAE,kBAAkB,cAAc;YACnC,CAAA,GAAA,MAAC,EAAE,kBAAkB,mBAAmB;YACxC,CAAA,GAAA,MAAC,EAAE,kBAAkB,iBAAiB;YACtC,CAAA,GAAA,MAAC,EAAE,kBAAkB,oBAAoB;YACzC,CAAA,GAAA,MAAC,EAAE,kBAAkB,mBAAmB;YAExC,OAAO;YACP,aAAa;YACb,CAAA,GAAA,YAAI,EAAE,qBAAqB;YAE3B,IACI,WAAW,YACR,SAAS,WAAW,UAAU,KAC9B,SAAS,YAAY,UAAU,KAC/B,MAAM,SAAS,WAAW,WAC1B,MAAM,SAAS,YAAY,SAChC;gBACE;gBACA;YACJ;YACA,UACI,SAAS,WAAW,QACpB,SAAS,YAAY,QACrB;QAER;QACA,cAAc;IAClB;AAEJ;;;;;ACrdA,2CAAgB;AAFhB;AAEO,SAAS,MACZ,IAAgC,EAChC,SAA6C;IAE7C,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;QACjB,SAAS;QACT,WAAW;IACf;IACA,KAAK,QAAQ,CAAC,KAAK;QACf,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,SAAS;QACb;QACA,MAAM,UAAU,IAAI,IAAI,CAAC,IAAI;YACzB,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACjB,SAAS;gBACT,SAAS;YACb;YAEA,MAAM,MAAM,WAAW,MAAM;YAC7B,IAAI,cAAc,aAAa,OAAO,WAClC,OAAO,UAAU,SAAS,CAAC,IAAI,CAAC;YAGpC,OAAO;QACX;QACA,OAAO,OAAO;IAClB;IACA,OAAO;AACX;;;;;ACzBA;;CAEC,GACD,wDAAa;AARb;AACA;;AACA;AAMO,MAAM;IAQD,SAAgB;QACpB,IAAI,IAAI,CAAC,iBAAiB,QACtB,IAAI,CAAC,KAAK,MAAM,YAAY,IAAI,CAAC,cAAc,mBAAmB;aAElE,IAAI,CAAC,KAAK,MAAM,YAAY,IAAI,CAAC,cAAc,KAAK;IAE5D;IAEA,mBAAmB;IACnB,YACI,CAEC,CACH;QACE,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,eAAe;QAEpB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,YAAY;gBACZ,OAAO;gBACP,UAAU;gBACV,KAAK;gBACL,WAAW;gBACX,YAAY;gBACZ,QAAQ;gBACR,YAAY;gBACZ,SAAS;gBACT,WAAW;YACf;YACA,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS,CAAC;gBACN,EAAE;gBACF,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;gBACzB,IAAI,CAAC;gBACL,EAAE;YACN;QACJ;QAEA,IAAI,CAAC,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACd,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,iBAAiB,CAAC,IAAI,EAAE,CAAA,GAAA,6BAAU,EAAE,CAAC,CAAC;gBACtC,OAAO;gBACP,QAAQ;gBACR,gBAAgB;gBAChB,kBAAkB;gBAClB,oBAAoB;gBACpB,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,OAAO,gBAAgB;YACxB,OAAO;QACX;IACJ;IAEA,sBAAsB;IAEtB,SAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,MAAiB,EAAQ;QACnC,IAAI,CAAC,eAAe;QACpB,IAAI,CAAC;IACT;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;AC1FA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;ACgBjH,oDAAgB;AAhBhB;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEO,SAAS,eACZ,CASC;IAED,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG,CAAC;IACtB,IAAI,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ,EAAE;IAExB,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAG;QAC1B,WAAW,0BAAQ;IACvB;IAEA,MAAM,aAAa,IAAI,CAAA,GAAA,sCAAiB,EAAE;QACtC,MAAM;QACN,UAAU,EAAE;QACZ,YAAY,EAAE;QACd,WAAW,IAAM,KAAK,qBAAqB,SAAS,OAAO,UAAU;IACzE;IACA,WAAW;IAEX,SAAS,SAAU,CAA4B;QAC3C,OAAO;YACH,GAAG,IAAI;YACP,GAAG,CAAC;QACR;QACA,WAAW,QAAQ;IACvB;IAEA,MAAM,SAAS,IAAI,CAAA,GAAA,8BAAa,EAAE;QAC9B,GAAG,IAAI;QACP,UAAU,CAAC;YACP,SAAS;QACb;IACJ;IAEA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;QACvB,KAAK;YACD,SAAS;YACT,KAAK;YACL,eAAe;QACnB;IACJ;IACA,MAAM,SAAS,IAAI,CAAA,GAAA,8BAAa,EAAE;QAC9B,MAAM,KAAK;QACX,cAAc,EAAE;QAChB,gBAAgB,EAAE;QAClB,UAAU,CAAC;YACP,SAAS;QACb;IACJ;IACA,MAAM,WAAW,IAAI,CAAA,GAAA,kCAAe,EAAE;QAClC,QAAQ,KAAK;QACb,cAAc,EAAE;QAChB,gBAAgB,EAAE;QAClB,UAAU,CAAC;YACP,SAAS;QACb;IACJ;IACA,MAAM,SAAS,IAAI,CAAA,GAAA,8BAAa,EAAE;QAC9B,MAAM,KAAK;QACX,UAAU,CAAC;YACP,EAAE,SAAS,aAAa,MAAM,oBAAoB,EAAE,KAAK,SAAS;YAClE,SAAS;QACb;IACJ;IAEA,MAAM,OAAO,IAAI,CAAA,GAAA,cAAK,EAAE;QACpB,WAAW;QACX,QAAQ;QACR,QAAQ;YACJ;gBACI,IAAI;gBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,QAAQ;oBACJ,OAAO,aAAa,MAAM,UAAU;oBACpC,OAAO;gBACX;gBACA,SAAS;oBACL,OAAO,aAAa,MAAM,UAAU;gBACxC;YACJ;YACA;gBACI,IAAI;gBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,QAAQ;oBACJ,OAAO,aAAa,MAAM,UAAU;gBACxC;gBACA,SAAS;oBACL,OAAO,aAAa,MAAM,UAAU;gBACxC;YACJ;YACA;gBACI,IAAI;gBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,QAAQ;oBACJ,aAAa,MAAM,UAAU;gBACjC;gBACA,SAAS;oBACL,aAAa,MAAM,UAAU;gBACjC;YACJ;SACH;IACL;IACA,KAAK,aAAa,UAAU,IAAI,CAAA,GAAA,QAAE,EAAE;QAChC,UAAU;QACV,UAAU;QACV,UAAU;QACV,cAAc;IAClB;IAEA,MAAM,oBAAoB,CAAA,GAAA,QAAE,EAAE;QAC1B,UAAU;QACV,MAAM;YACF,UAAU;YACV,OAAO;YACP,KAAK;QACT;IACJ;IAEA,MAAM,gBAAgB,CAAA,GAAA,QAAE,EAAE;QACtB,SAAS;QACT,gBAAgB;QAChB,eAAe;QACf,UAAU;QACV,WAAW;QACX,YAAY;QACZ,aAAa;QACb,SAAS;QACT,qDAAqD;YACjD,SAAS;QACb;IACJ;IAIA,MAAM,YAAY,CAAA,GAAA,QAAE,EAAE;QAClB,WAAW;QACX,WAAW;QACX,qDAAqD;YACjD,SAAS;YACT,eAAe;YACf,KAAK;YACL,MAAM;gBACF,SAAS;YACb;QACJ;IACJ;IAEA,OAAO,OAAO,CAAA,GAAA,IAAA,EAAE,IAAI;QAChB,CAAA,GAAA,IAAA,EAAE,iBAAiB;YAAC,WAAW;SAAa;QAC5C,CAAA,GAAA,IAAA,EAAE,MAAM,mBAAmB;YAAC,WAAW;SAAmB;QAC1D,CAAA,GAAA,IAAA,EAAE,aAAa,eAAe;YAC1B,CAAA,GAAA,IAAA,EAAE;YACF,KAAK;SACR;QAED,CAAA,GAAA,IAAA,EAAE,MAAM,WAAW;YACf,CAAA,GAAA,IAAA,EAAE,cAAc;gBACZ,OAAO;gBACP,SAAS;aACZ;YACD,OAAO;YACP,OAAO;SACV;KACJ;IAID,MAAM,WAAW;QACb,MAAM,IAAI,gBAAgB;QAC1B,MAAM,IAAI,KAAK,KAAK,EAAE;QACtB,MAAM,IAAI,KAAK,KAAK,EAAE;QACtB,WAAW,QAAQ,GAAG;IAC1B;IACA,OAAO,iBAAiB,UAAU;IAClC,WAAW;QACP;IACJ;IACA,WAAW;QACP,OAAO;IACX,GAAG;IAGH,0CAA0C;IAC1C,SAAS;QACL,OAAO,SAAS,GAAG;IACvB;IACA,OAAO,iBAAiB,UAAU;IAElC,MAAM,cAAc,CAAC;QACjB,OAAO,oBAAoB,UAAU;QACrC,OAAO,oBAAoB,UAAU;QACrC,WAAW;QACX,OAAO;QACP,OAAO;QACP,SAAS;QACT,OAAO;QACP,KAAK;QAEL,IAAI,QAAQ,MACR,EAAE,UAAU;YACR,GAAG,WAAW,WAAW;YACzB,GAAG,OAAO,WAAW;YACrB,GAAG,OAAO,WAAW;YACrB,GAAG,SAAS,WAAW;YACvB,GAAG,OAAO,WAAW;QACzB;IAER;IAGA,MAAM,QAAQ,CAAA,GAAA,oBAAQ,EAAE;QACpB,QAAQ,SAAS;QACjB,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,cAAc,IAAI,CAAC;QACvC,KAAK;QACL,SAAS;YAAC;YAAM;SAAS;QACzB,kBAAkB,EAAE,KAAK,KAAK,SAAS;QACvC,UAAU;QACV,OAAO;YACH,OAAO;YACP,UAAU;YACV,UAAU;YACV,WAAW;QACf;QACA,cAAc;IAClB;AACJ;;;;;ACtOA,oDAAa;AAjBb;AACA;AACA;AACA;AACA;AAaO,MAAM;IAOT,mBAAmB;IACnB,YAAa,CAAgB,CAAE;QAE3B,MAAM,OAAO;YACT,EAAE,SAAS,IAAI,CAAC;QACpB;QAEA,MAAM,kBAAoC;YACtC;YACA,EAAE,OAAO;gBACL,GAAG,EAAE,KAAK,KAAK;gBACf,GAAG;YACP,IAAI;YACJ;gBACI,GAAG,EAAE,YAAY;gBACjB,GAAG;YACP;YACA;gBACI,GAAG,EAAE,cAAc;gBACnB,GAAG;YACP;YACA;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YACvB;gBAAC,GAAG;gBAAK,GAAG;gBAAK,GAAG;gBAAK,GAAG;YAAC;SAChC;QAED,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YACjC,UAAU;YACV,cAAc,EAAE,OAAO,IAAI;YAC3B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,cAAc,aAAa,MAAM,UAAU,MAAM,OAAO,KAAK;gBAClE;YACJ;QACJ;QAEA,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,EAAE,OAAO,EAAE,KAAK,MAAM,IAAI;YACjC,YAAY;YACZ,YAAY,OAAO;YACnB,SAAS,CAAC,eAAiB,eAAe;YAC1C,gBAAgB,CAAC,QAAU,QAAQ;YACnC,UAAU,IAAM;QACpB;QACA,IAAI,CAAC,cAAc,aAAa,MAAM,UAAU,EAAE,OAAO,KAAK;QAE9D,MAAM,MAAM,CAAA,GAAA,eAAQ,EAAE;YAClB,aAAa;YACb,OAAO;YACP,OAAO;YACP,QAAQ;YACR,SAAS;YAET,aAAa;gBACT;oBACI,aAAa;oBACb,QAAQ;oBACR,oBAAoB;oBACpB,WAAW;oBACX,MAAM;gBACV;aACH;QACL;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,IAAA,EAAE,8CAA8C;YAC1D;YACA,IAAI,CAAC,aAAa;YAClB,IAAI,CAAC,cAAc;SACtB;IACL;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,YAA0B;QACtB,MAAM,IAAI,IAAI,CAAC,aAAa;QAC5B,IAAI,MAAM,QAAQ,GAAG,MAAM,GACvB,OAAO;YACH,MAAM;QACV;QAEJ,MAAM,QAAQ;YACV,GAAG,CAAC;YACJ,GAAG,IAAI,CAAC,cAAc;QAC1B;QACA,OAAO;YACH,MAAM;gBACF;YACJ;QACJ;IACJ;IAEA,UAAiB;QACb,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,cAAc;IACvB;AACJ;;;;;ACjEA,oDAAa;AA9Db;AAEA;AACA;AACA;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;AACA;AACA;AAEA;AAYA,MAAM,gBAGA;IACF;QAAC,YAAY;QAAc,UAAU;IAAY;IACjD;QAAC,YAAY;QAAS,UAAU;IAAO;IACvC;QAAC,YAAY;QAAa,UAAU;IAAW;IAC/C;QAAC,YAAY;QAAW,UAAU;IAAS;IAC3C;QAAC,YAAY;QAAW,UAAU;IAAS;OACxC,CAAA,GAAA,YAAI,EAAE,IAAI,CAAA;QACT,OAAO;YACH,YAAY,KAAK;YACjB,UAAU,KAAK;QACnB;IACJ;CACH;AAED,IAAI,sBAAsB;AAC1B,eAAe;IACX,IAAI,qBACA;IAEJ,sBAAsB;IACtB,MAAM,WAA4B,EAAE;IACpC,IAAK,IAAI,IAAI,GAAG,IAAI,CAAA,GAAA,YAAI,EAAE,QAAQ,IAC9B,SAAS,KAAK,AAAC,CAAA;QACX,MAAM,OAAO,CAAA,GAAA,YAAI,CAAC,CAAC,EAAE;QACrB,MAAM,WAAW,MAAM,MAAM,KAAK;QAClC,MAAM,SAAS,MAAM,SAAS;QAC9B,MAAM,OAAO,IAAI,SAAS,KAAK,MAAM;QACrC,SAAS,MAAM,IAAI;IACvB,CAAA;IAEJ,MAAM,QAAQ,IAAI;AACtB;AAEO,MAAM;IAmBT,uDAAuD;IAC/C,mBAA0B;QAC9B,CAAC,uBAAuB,mBAAmB,KAAK;YAC5C,IAAI,CAAC,SAAS;gBACV,MAAM,IAAI,CAAC,WAAW;YAC1B;QACJ;IACJ;IAEQ,aAAoB;QACxB,MAAM,QAAQ,SAAS,cAAc;QACrC,MAAM,OAAO;QACb,MAAM,WAAW;QACjB,MAAM,SAAS;QACf,MAAM;QACN,MAAM;QACN,MAAM,WAAW;YACb,IAAI,CAAC,MAAM,SAAS,MAAM,MAAM,WAAW,GACvC;YAEJ,IAAI,WAA+B;YAEnC,MAAM,eAAe,cAAc,IAAI,CAAA,IAAK,EAAE;YAC9C,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,QAAQ,IAAK;gBACzC,MAAM,OAAO,MAAM,KAAK,CAAC,EAAE;gBAC3B,MAAM,WAAW,QAAQ,cAAc;gBACvC,IAAI,aAAa,SAAS,WACtB;gBAEJ,IAAI,CAAC,UAAU;oBACX,WAAW;oBACX,IAAI,CAAC,aAAa,WAAW;oBAC7B,IAAI,CAAC,aAAa,YAAY,CAAA,GAAA,cAAG,EAAE;gBACvC;gBAEA,MAAM,QAAQ,KAAK,KAAK,MAAM;gBAC9B,MAAM;gBAEN,cAAc,KAAK;oBACf,YAAY;oBACZ,UAAU,MAAM,KAAK;gBACzB;gBACA,MAAM,OAAO,IAAI,SAAS,UAAU,MAAM,KAAK;gBAC/C,SAAS,MAAM,IAAI;YACvB;YAEA,wBAAwB;YACxB,WAAW;gBACP,IAAI,CAAC,WAAW,aAAa,cAAc,IAAI,CAAA;oBAC3C,OAAO;wBACH,EAAE;wBACF,EAAE;wBACF;4BACI,KAAK;gCACD,YAAY,EAAE;gCACd,UAAU;4BACd;wBACJ;qBACH;gBACL;gBACA,IAAI,CAAC,WAAW,SAAS;gBACzB,IAAI,CAAC,SAAS;oBACV,MAAM;gBACV;gBACA,IAAI,CAAC,aAAa,WAAW;gBAC7B,IAAI,CAAC,aAAa,YAAY,CAAA,GAAA,cAAG,EAAE;YACvC;QACJ;IACJ;IAGA,mBAAmB;IACnB,YAAa,CAAgB,CAAE;QAC3B,IAAI,CAAC,WAAW,EAAE;QAElB,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,cAAK,EAAU;YACjC,WAAW,EAAE;YACb,WAAW,cAAc,IAAI,CAAA;gBACzB,OAAO;oBACH,EAAE;oBACF,EAAE;oBACF;wBACI,KAAK;4BACD,YAAY,EAAE;4BACd,UAAU;wBACd;oBACJ;iBACH;YACL;YACA,aAAa;YACb,KAAK;gBACD,OAAO;YACX;YACA,UAAU,CAAC;gBACP,IAAI,CAAC;gBACL,EAAE,SAAS;oBACP,MAAM;gBACV;YACJ;QACJ;QACA,IAAI,CAAC,UAAU,IAAM,IAAI,CAAC;QAC1B,IAAI,CAAC,WAAW,aAAa,iBAAiB,SAAS,IAAI,CAAC;QAC5D,IAAI,CAAC,sBAAsB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC9C,QAAQ,IAAI,CAAC,WAAW;YACxB,SAAS,CAAC,IAAM,IAAI,CAAC,WAAW,cAAc,EAAE;QACpD;QAEA,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,SAAS;YACT,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,SAAS;gBACL,IAAI,CAAC;YACT;QACJ;QAEA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,SAAS;YACT,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,SAAS;gBACT,gBAAgB;gBAChB,YAAY;gBACZ,UAAU;gBACV,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,YAAY,IAAI,CAAA,GAAA,YAAI,EAAE;YACvB,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,MAAM;YACN,KAAK;YACL,KAAK;YACL,MAAM,EAAE;YACR,UAAU,CAAC;gBACP,EAAE,SAAS;oBACP,MAAM,WAAW;gBACrB;YACJ;YACA,kBAAkB;YAClB,sBAAsB;YACtB,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,YAAI,EAAE;YAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,MAAM;YACN,KAAK;YACL,KAAK;YACL,MAAM;YACN,MAAM,EAAE,cAAc;YACtB,UAAU,CAAC;gBACP,EAAE,SAAS;oBACP,YAAY,WAAW;gBAC3B;YACJ;YACA,kBAAkB;YAClB,sBAAsB;YACtB,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,IAAI,CAAC,qBAAqB,IAAI,CAAA,GAAA,YAAI,EAAE;YAChC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,MAAM;YACN,KAAK;YACL,KAAK;YACL,MAAM,EAAE,iBAAiB;YACzB,UAAU,CAAC;gBACP,EAAE,SAAS;oBACP,eAAe,WAAW;gBAC9B;YACJ;YACA,kBAAkB;YAClB,sBAAsB;YACtB,KAAK;gBACD,OAAO;YACX;QACJ;QAIA,IAAI,CAAC,iBAAiB,IAAI,CAAA,GAAA,8BAAa,EAAe;YAClD,WAAW;gBACP;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,4BAAW;oBAClB,YAAY;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,8BAAa;oBACpB,YAAY;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,6BAAY;oBACnB,YAAY;gBAChB;aACH;YACD,QAAQ,EAAE;YACV,UAAU,CAAC,IAAM,EAAE,SAAS;oBACxB,OAAO;gBACX;QACJ;QAEA,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,wBAAU,EAAE;YAChC,OAAO,CAAA,GAAA,6BAAY;YACnB,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,WAAW,EAAE;YACb,UAAU,CAAC,IAAM,EAAE,SAAS;oBACxB,UAAU;gBACd;YACA,YAAY;QAChB;QAEA,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,wBAAU,EAAE;YAC9B,OAAO,CAAA,GAAA,2BAAU;YACjB,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,WAAW,EAAE;YACb,UAAU,CAAC,IAAM,EAAE,SAAS;oBACxB,QAAQ;gBACZ;YACA,YAAY;QAChB;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,IAAA,EAAE,yCAAyC;YACrD,CAAA,GAAA,IAAA,EAAE,4BAA4B;gBAC1B;gBACA,IAAI,CAAC,UAAU;aAClB;YACD,CAAA,GAAA,IAAA,EAAE,eAAe;gBACb,IAAI,CAAC,WAAW;gBAChB,IAAI,CAAC;aACR;YACD,CAAA,GAAA,IAAA,EAAE,eAAe;gBACb,IAAI,CAAC,eAAe;gBACpB,IAAI,CAAC,aAAa;gBAClB,IAAI,CAAC,WAAW;aACnB;YACD,IAAI,CAAC,mBAAmB;YACxB,IAAI,CAAC,gBAAgB;SACxB;IACL;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,YAA0B;QACtB,OAAO;YACH,MAAM,IAAI,CAAC,WAAW;YACtB,MAAM,CAAC,IAAI,CAAC,UAAU;YACtB,eAAe,CAAC,IAAI,CAAC,mBAAmB;YACxC,YAAY,CAAC,IAAI,CAAC,gBAAgB;YAClC,OAAO,IAAI,CAAC,eAAe;YAC3B,UAAU,IAAI,CAAC,aAAa;YAC5B,QAAQ,IAAI,CAAC,WAAW;QAC5B;IACJ;IAEA,UAAiB;QACb,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC,WAAW,aAAa,oBAAoB,SAAS,IAAI,CAAC;QAC/D,IAAI,CAAC,WAAW;QAChB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,gBAAgB;QACrB,IAAI,CAAC,mBAAmB;QACxB,IAAI,CAAC,eAAe;QACpB,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,WAAW;IACpB;AACJ;;;ACvWA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;ACAhH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;ACAlH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;;;2CCiBlG;AAjBb;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEO,MAAM,QAGP;IACF;QAAE,MAAM;QAAU,KAAK,CAAA,GAAA,kCAAS;IAAE;IAClC;QAAE,MAAM;QAAiB,KAAK,CAAA,GAAA,yDAAgB;IAAE;IAChD;QAAE,MAAM;QAAmB,KAAK,CAAA,GAAA,oCAAkB;IAAE;IACpD;QAAE,MAAM;QAAiB,KAAK,CAAA,GAAA,yCAAgB;IAAE;IAChD;QAAE,MAAM;QAAY,KAAK,CAAA,GAAA,sCAAW;IAAE;IACtC;QAAE,MAAM;QAAe,KAAK,CAAA,GAAA,uCAAc;IAAE;IAC5C;QAAE,MAAM;QAAU,KAAK,CAAA,GAAA,kCAAS;IAAE;IAClC;QAAE,MAAM;QAAa,KAAK,CAAA,GAAA,qCAAY;IAAE;IACxC;QAAE,MAAM;QAAS,KAAK,CAAA,GAAA,0BAAQ;IAAE;IAChC;QAAE,MAAM;QAAc,KAAK,CAAA,GAAA,mCAAa;IAAE;IAC1C;QAAE,MAAM;QAAgB,KAAK,CAAA,GAAA,iCAAe;IAAE;IAC9C;QAAE,MAAM;QAAe,KAAK,CAAA,GAAA,oCAAc;IAAE;IAC5C;QAAE,MAAM;QAAa,KAAK,CAAA,GAAA,mCAAiB;IAAE;IAC7C;QAAE,MAAM;QAAc,KAAK,CAAA,GAAA,sCAAa;IAAE;IAC1C;QAAE,MAAM;QAAU,KAAK,CAAA,GAAA,kCAAS;IAAE;IAClC;QAAE,MAAM;QAAS,KAAK,CAAA,GAAA,iCAAQ;IAAE;CACnC;;;ACrCD,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,kCAAkC,MAAM,KAAK;;;ACAtH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2DAA2D,MAAM,KAAK;;;ACA/I,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,mCAAmC,MAAM,KAAK;;;ACAvH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,yCAAyC,MAAM,KAAK;;;ACA7H,OAAO,UAAU,QAAQ,mBAAwB,aAAa,WAAW,uCAAuC,MAAM,KAAK;;;ACA3H,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,uCAAuC,MAAM,KAAK;;;ACA3H,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,kCAAkC,MAAM,KAAK;;;ACAtH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,yBAAyB,MAAM,KAAK;;;ACA7G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,qCAAqC,MAAM,KAAK;;;ACAzH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,mCAAmC,MAAM,KAAK;;;ACAvH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,gCAAgC,MAAM,KAAK;;;ACApH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,oCAAoC,MAAM,KAAK;;;ACAxH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,mCAAmC,MAAM,KAAK;;;ACAvH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,sCAAsC,MAAM,KAAK;;;ACA1H,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,kCAAkC,MAAM,KAAK;;;ACAtH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,iCAAiC,MAAM,KAAK;;;;;ACoBrH,sDAAa;AApBb;AAGA;AACA;AACA;AACA;AACA;AAaO,MAAM;IAST,mBAAmB;IACnB,YAAa,CAAkB,CAAE;QAI7B,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,WAAW;YACf;QACJ;QAEA,MAAM,OAAO;YACT,EAAE,SAAS,IAAI,CAAC;QACpB;QAEA,MAAM,kBAAoC;YACtC;YACA,EAAE,SAAS;gBACP,GAAG,EAAE,OAAO,KAAK;gBACjB,GAAG;YACP,IAAI;YACJ;gBACI,GAAG,EAAE,cAAc;gBACnB,GAAG;YACP;YACA;gBACI,GAAG,EAAE,YAAY;gBACjB,GAAG;YACP;YACA;gBAAC,GAAG;gBAAK,GAAG;gBAAK,GAAG;gBAAK,GAAG;YAAC;YAC7B;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;SAC1B;QAED,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YACjC,UAAU;YACV,cAAc,EAAE,SAAS,IAAI;YAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,cAAc,aAAa,MAAM,UAAU,MAAM,OAAO,KAAK;gBAClE,IAAI,CAAC,gBAAgB,aAAa,MAAM,UAAU,MAAM,OAAO,KAAK;gBACpE;YACJ;QACJ;QAEA,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,EAAE,SAAS,EAAE,OAAO,MAAM,IAAI;YACrC,YAAY;YACZ,YAAY,OAAO;YACnB,SAAS,CAAC,eAAiB,eAAe;YAC1C,gBAAgB,CAAC,QAAU,QAAQ;YACnC,UAAU,IAAM;QACpB;QAEA,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAChC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,EAAE,SAAS,EAAE,OAAO,YAAY;YACvC,YAAY,OAAO;YACnB,OAAO;YACP,UAAU,IAAM;QACpB;QAEA,IAAI,CAAC,cAAc,aAAa,MAAM,UAAU,EAAE,SAAS,KAAK;QAChE,IAAI,CAAC,gBAAgB,aAAa,MAAM,UAAU,EAAE,SAAS,KAAK;QAElE,MAAM,MAAM,CAAA,GAAA,eAAQ,EAAE;YAClB,aAAa;YACb,OAAO;YACP,OAAO;YACP,QAAQ;YACR,SAAS;YAET,aAAa;gBACT;oBACI,aAAa;oBACb,QAAQ;oBACR,MAAM;oBACN,QAAQ;oBACR,gBAAgB;oBAChB,oBAAoB;oBACpB,WAAW;gBACf;aACH;QACL;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,IAAA,EAAE,8CAA8C;YAC1D;YACA,IAAI,CAAC,aAAa;YAClB,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,gBAAgB;SACxB;IACL;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,YAA4B;QACxB,MAAM,IAAI,IAAI,CAAC,aAAa;QAC5B,IAAI,MAAM,QAAQ,GAAG,MAAM,GACvB,OAAO;YACH,QAAQ;QACZ;QAEJ,MAAM,QAAQ;YACV,GAAG,CAAC;YACJ,GAAG,IAAI,CAAC,cAAc;QAC1B;QACA,OAAO;YACH,QAAQ;gBACJ;gBACA,WAAW,IAAI,CAAC,gBAAgB;YACpC;QACJ;IACJ;IAEA,UAAiB;QACb,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,gBAAgB;IACzB;AACJ;;;;;AChJA,oDAAa;AAbb;AACA;AACA;AAWO,MAAM;IAWD,OAAc;QAClB,MAAM,OAAO,IAAI,CAAC,UAAU;QAC5B,IAAI,SAAS,IAAI,CAAC,iBACd;QAEJ,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,SAAS;YACV;QACJ;IACJ;IAEA,mBAAmB;IACnB,YAAa,CAAgB,CAAE;aAhBd,UAAU;YACvB,IAAI,CAAC;QACT;QAeI,IAAI,CAAC,kBAAkB,EAAE;QACzB,IAAI,CAAC,WAAW,EAAE;QAElB,IAAI,CAAC,SAAS,CAAA,GAAA,IAAA,EAAE;QAEhB,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,SAAS;YACT,QAAQ,IAAI,CAAC;YACb,SAAS,EAAE;YACX,QAAQ;gBACJ,aAAa,CAAA,GAAA,cAAG,EAAE;YACtB;YACA,KAAK;gBACD,YAAY;gBACZ,UAAU;gBACV,OAAO;gBACP,QAAQ;gBACR,QAAQ;YACZ;YACA,UAAU;gBACN,IAAI,CAAC;YACT;QACJ;QAEA,IAAI,CAAC,UAAU,iBAAiB,SAAS,IAAI,CAAC;IAClD;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,YAA0B;QACtB,OAAO;YACH,MAAM,IAAI,CAAC,UAAU;QACzB;IACJ;IAEA,QAAe;QACX,IAAI,CAAC,UAAU;IACnB;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,IAAI,CAAC,UAAU,oBAAoB,SAAS,IAAI,CAAC;IACrD;AACJ;;;;;ACzDA,wDAAa;AA1Bb;AACA;AACA;AACA;AAEA;AAEA;AACA;;AACA;;AACA;AAgBO,MAAM;IAgDD,QAAS,CAAS,EAAW;QACjC,OAAO,IAAI,CAAC,YAAY,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,IAAI,CAAC,UAAU;IACpE;IAEQ,cAAe,CAAS,EAAQ;QACpC,IAAI,CAAC,UAAU,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,IAAI,CAAC,UAAU;QACvD,IAAI,CAAC;QACL,IAAI,CAAC,UAAU,WAAW,CAAC,IAAI,CAAC,QAAQ;QACxC,IAAI,CAAC,WAAW,WAAW,CAAC,IAAI,CAAC,QAAQ;IAC7C;IAEA,sBAAsB,GACtB,AAAQ,KAAM,CAAS,EAAE,CAAS,EAAQ;QACtC,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG,GAAG,CAAC,IAAI,CAAC,eAAe,aAAa,KAAK,KAAK;QAC5E,IAAI,CAAC,KAAK,KAAK,QAAQ,IAAI,IAAI,CAAC;QAChC,IAAI,CAAC,KAAK,KAAK,QAAQ,IAAI,IAAI,CAAC;QAChC,IAAI,CAAC;IACT;IAGA,mBAAmB;IACnB,YAAa,CAAoB,CAAE;aA/D3B,SAAoB;YAAC,GAAG;YAAG,GAAG;QAAC;aAK/B,UAAkB;aAClB,QAAgB;aAEP,WAAkD,EAAE;aA6BpD,eAAe;YAC5B,IAAI,CAAC,iBAAiB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,WAAW,cAAc,CAAA,GAAA,MAAC,EAAE,oBAAoB,GAAG,CAAA,GAAA,YAAI,EAAE,WAAW;YAC3G,IAAI,CAAC;QACT;QAwBI,IAAI,CAAC,SAAS,CAAA,GAAA,IAAA;QACd,IAAI,CAAC,OAAO,EAAE;QACd,IAAI,CAAC,aAAa,EAAE;QAEpB,MAAM,eAAe,OAAO,aAAa;QACzC,MAAM,gBAAgB,OAAO,cAAc;QAE3C,kBAAkB;QAClB,kDAAkD;QAClD,kEAAkE;QAClE,0DAA0D;QAC1D,2FAA2F;QAC3F,sEAAsE;QAEtE,IAAI,CAAC,QAAQ,eAAe,MAAM;QAClC,IAAI,CAAC,SAAS,eAAgB,gBAAgB,MAAM,MAAQ,gBAAgB,MAAM;QAElF,IAAI,CAAC,WAAW,EAAE,SAAS;QAC3B,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,EAAE,SAAS,YAAY,EAAE,SAAS;QAC9D,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAC3B,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QAC/C,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAC7B,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QAC/C,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAC7B,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC,SAAS,0BAA0B;QACnF,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QAC9B,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,eAAe;YACvB,SAAS;QACb;QACA,IAAI,CAAC,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,UAAU;gBACV,OAAO,IAAI,CAAC,QAAQ;gBACpB,QAAQ;gBACR,aAAa;YACjB;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,QAAQ,IAAI,CAAC;YACb,WAAW;QACf;QACA,IAAI,CAAC,eAAe,OAAO,IAAI,CAAC;QAChC,IAAI,CAAC,iBAAiB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,WAAW,cAAc,CAAA,GAAA,MAAC,EAAE,oBAAoB,GAAG,CAAA,GAAA,YAAI,EAAE,WAAW;QAC3G,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QAChC,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QACrC;YACI,IAAI,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;YACtB,IAAI,SAAS,GAAG,GAAG,GAAG;YAEtB,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;YAClB,IAAI,YAAY;YAChB,IAAI,SAAS,GAAG,GAAG,GAAG;QAC1B;QAEA,CAAA,GAAA,YAAI,EAAE,kBAAkB,IAAI,CAAC;QAE7B,IAAI,CAAC,cAAc,gBAAgB,CAAC,IAAM,EAAE;QAC5C,IAAI,UAAU;QACd,IAAI,SAAS;QACb,IAAI,gBAAgB;QACpB,IAAI,CAAC,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACjD,QAAQ,IAAI,CAAC;YACb,WAAW,CAAC;gBAER,cAAc;gBACd,IAAI,EAAE,SAAS,eAAe;oBAC1B,UAAU;oBACV,SAAS;gBACb;gBACA,IAAI,EAAE,SAAS,iBAAiB,QAC5B,UAAU;gBAEd,IAAI,EAAE,SAAS,aAAa;oBACxB,IAAI,UAAU,WAAW,EAAE,gBAAgB,SACvC,sDAAsD;oBACtD,6CAA6C;oBAC7C,EAAE;oBAEN,UAAU;oBACV,SAAS;gBACb;gBAIA,IAAI,EAAE,SAAS,iBAAiB,EAAE,WAAW,QAAQ;oBACjD,EAAE;oBACF,IAAI,CAAC,SAAS;wBAAC,GAAG;wBAAG,GAAG;oBAAC;oBACzB,IAAI,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,EAAE;gBACxB;gBACA,IAAI,EAAE,SAAS,iBAAiB,EAAE,WAAW,SACzC,SAAS,KAAK,OAAO,IAAI,CAAC;gBAE9B,IAAI,EAAE,SAAS,aACX,WAAW,IAAM,IAAI,CAAC,aAAa,UAAU;gBAEjD,IAAI,EAAE,SAAS,iBAAiB,EAAE,WAAW,SAAS;oBAClD,gBAAgB;oBAChB,EAAE;oBACF,IAAI,CAAC,OAAO,KAAK,EAAE;oBACnB,IAAI,CAAC,OAAO,KAAK,EAAE;oBACnB,IAAI,CAAC;gBACT;gBACA,IAAI,EAAE,SAAS,eAAe,eAAe;oBACzC,IAAI,QAAQ;oBACZ,IAAI,CAAC,WAAW,YAAY;wBACxB,IAAI,QAAQ,GAAG;4BACX,cAAc,IAAI,CAAC;4BACnB,IAAI,CAAC,SAAS;gCAAC,GAAG;gCAAG,GAAG;4BAAC;4BACzB,IAAI,CAAC;wBACT;wBACA,IAAI,CAAC,SAAS;4BAAC,GAAG,IAAI,CAAC,OAAO,IAAI;4BAAK,GAAG,IAAI,CAAC,OAAO,IAAI;wBAAG;wBAC7D,IAAI,CAAC;wBACL;oBACJ,GAAG;oBAEH,IAAI,CAAC,SAAS;wBAAC,GAAG,IAAI,CAAC,OAAO,IAAI;wBAAK,GAAG,IAAI,CAAC,OAAO,IAAI;oBAAG;oBAC7D,IAAI,CAAC;gBACT;YACJ;YACA,SAAS,CAAC;gBACN,IAAI,CAAC,cAAc,CAAC,EAAE;YAC1B;QACJ;QAEA,MAAM,eAAe,CAAC,QAA4B,MAAM;QACxD,IAAI,CAAC,cAAc,iBAAiB,SAAS;QAG7C,IAAI,CAAC,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK,CAAC,KAAK;YACX,KAAK,KAAK;YACV,OAAO,EAAE,KAAK;YACd,YAAY;YACZ,yBAAyB;YACzB,SAAS,CAAC,MAAQ,MAAM,KAAK,KAAK;YAClC,gBAAgB,CAAC,MAAQ,MAAM,KAAK,KAAK;YACzC,UAAU;gBACN,IAAI,CAAC,SAAS;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBACzB,IAAI,CAAC;YACT;YACA,MAAM;QACV;QAEA,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,SAAS;YACT,SAAS,CAAC,sBAAsB,EAAE,CAAA,GAAA,6BAAY,EAAE,EAAE,CAAC;YACnD,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS,IAAM,IAAI,CAAC,cAAc;YAClC,KAAK;gBACD,YAAY;YAChB;QACJ;QACA,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,SAAS;YACT,SAAS,CAAC,sBAAsB,EAAE,CAAA,GAAA,8BAAa,EAAE,EAAE,CAAC;YACpD,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS,IAAM,IAAI,CAAC,cAAc;YAClC,KAAK;gBACD,YAAY;YAChB;QACJ;QAEA,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,aAAa,gBAAgB,CAAC,IAAM,EAAE;QAE3C,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YAClC,QAAQ,CAAC;gBACL,IAAI,CAAA,GAAA,MAAC,EAAE,eAAe,OAClB;gBAEJ,MAAM,SAAS,IAAI,CAAC,YAAY,UAAU,WAAW,IAAI;gBACzD,IAAI,WAAW,QACX,IAAI,CAAC,KAAK,CAAC,QAAQ;gBAEvB,IAAI,WAAW,SACX,IAAI,CAAC,KAAK,QAAQ;gBAEtB,IAAI,WAAW,MACX,IAAI,CAAC,KAAK,GAAG,CAAC;gBAElB,IAAI,WAAW,QACX,IAAI,CAAC,KAAK,GAAG;YAErB;QACJ;QAEA,IAAI,CAAC,eAAe,CAAA,GAAA,IAAA,EAAE,eAAe;YACjC,IAAI,CAAC,eAAe;YACpB,CAAA,GAAA,IAAA;YACA,IAAI,CAAC;YACL,IAAI,CAAC;SACR;IACL;IAEA,SAAgB;QACZ,+CAA+C;QAE/C,MAAM,WAAW,IAAI,CAAC,eAAe;QAErC,oBAAoB;QACpB,IAAI,CAAC,QAAQ,UAAU,GAAG,GAAG,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,WAAW;QACpE,MAAM,SAAS,CAAA,GAAA,sBAAS,EAAE,IAAI,CAAC,YAAY;YACvC,GAAG,IAAI,CAAC,IAAI;YACZ,GAAG,IAAI,CAAC,KAAK;YACb,GAAG,IAAI,CAAC,KAAK;YACb,UAAU,IAAI,CAAC,eAAe;QAClC;QAEA,mBAAmB;QACnB,MAAM,oBAAoB,CAAA,GAAA,MAAC,EAAE,KAAK,IAC9B,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,GAAG,CAAC,WAAW,KAAK,KAAK,MAC9D,IAAI,IAAI,CAAC;QAGb,+CAA+C;QAC/C,gCAAgC;QAChC,OAAO,QAAQ,KAAK,IAAI,OAAO,OAAO;QACtC,OAAO,SAAS,KAAK,IAAI,OAAO,QAAQ;QACxC,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO,GAAG,OAAO,GAAG,CAAC,WAAW,KAAK,KAAK;QACtE,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO,OAAO,OAAO,QAAQ,CAAC,WAAW,KAAK,KAAK;QAC/E,MAAM,UAAU,IAAI,CAAC,KAAK,IAAI,UAAU,IAAI,UAAU,IAAI,IAAI,kBAAkB;QAChF,MAAM,UAAU,IAAI,CAAC,KAAK,IAAI,UAAU,IAAI,UAAU,IAAI,IAAI,kBAAkB;QAEhF,MAAM,UAAU;QAChB,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,QACjB,OAAO,OAAO,OAAO,QACrB,IAAI,CAAC,QAAQ,SACb,IAAI,CAAC,SAAS;QAElB,IAAI,CAAC,QAAQ,KAAK,IAAI,GAAG,UAAU,QAAQ,OAAO;QAClD,IAAI,CAAC,QAAQ,KAAK,IAAI,GAAG,IAAI,CAAC,QAAQ,KAAK,IAAI,GAAG,IAAI,CAAC;QAGvD,wCAAwC;QACxC,IAAI,CAAC,UAAU;QAEf,IAAI,IAAI,CAAC,SAAS,GACd,IAAI,CAAC,UAAU,wBAAwB;aACpC;YACH,IAAI,CAAC,UAAU,wBAAwB;YACvC,IAAI,CAAC,UAAU,wBAAyB,IAAI,CAAC,SAAS,IAAI,QAAQ;QACtE;QAEA,IAAI,CAAC,UAAU,UAAU,GAAG,GAAG,IAAI,CAAC,cAAc,OAAO,IAAI,CAAC,cAAc;QAC5E,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS;QACvD,IAAI,CAAC,UAAU,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC;QACtC,IAAI,CAAC,UAAU,OAAO;QACtB,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,SAAS,CAAC;QAC3E,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC;QACrD,IAAI,CAAC,UAAU;QAEf,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;QAErB,iBAAiB;QACjB,IAAI,CAAC,UAAU;QAEf,IAAI,CAAC,UAAU,YAAY,SAAS,kBAAkB;QACtD,IAAI,CAAC,UAAU,SAAS,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;QAE/C;YACI,IAAI,CAAC,UAAU;YAEf,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS;YACvD,IAAI,CAAC,UAAU,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC;YACtC,IAAI,CAAC,UAAU,OAAO;YAEtB,IAAI,CAAC,UAAU,wBAAwB;YAEvC,SAAS;YACT,MAAM,aAAa,IAAI,IAAI,CAAC;YAC5B,IAAI,CAAC,UAAU,cAAc,SAAS,OAAO;YAC7C,IAAI,CAAC,UAAU,UACX,SAAS,IAAI,CAAC,mBAAmB,IAAI,CAAC,aACtC,CAAC,UAAU,YACX,CAAC,UAAU,YACX,IAAI,CAAC,WAAW,QAAQ,aAAa,GACrC,IAAI,CAAC,WAAW,SAAS,aAAa;YAE1C,IAAI,CAAC,UAAU,cAAc;YAE7B,OAAO;YACP,IAAI,CAAC,UAAU,2BAA2B;YAC1C,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,SAAS,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,WAAW;YAEtG,IAAI,CAAC,UAAU;QACnB;QAII,IAAI,IAAI,CAAC,SAAS,GACd,IAAI,CAAC,UAAU,wBAAwB;aACpC;YACH,IAAI,CAAC,UAAU,wBAAwB;YACvC,IAAI,CAAC,UAAU,wBAAyB,IAAI,CAAC,SAAS,IAAI,QAAQ;QACtE;QAEA,eAAe;QACf,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS;QACvD,IAAI,CAAC,UAAU,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC;QACtC,IAAI,CAAC,UAAU,OAAO;QACtB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,YAAY,IACjC,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,aAAa,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,UAAU,GAAG;YAC5D,IAAI,CAAC,UAAU,cAAc,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC9C,IAAI,CAAC,UAAU,2BAA2B,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC3D,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC;QACjE;QAEJ,IAAI,CAAC,UAAU;QAEf,eAAe;QACf,IAAI,CAAC,UAAU,cACX,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,UAC9B,CAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,IAAI,CAAA;QAEpD,IAAI,CAAC,UAAU,2BAA2B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC;QACzE,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,cAAc,GAAG;QAE/C,eAAe;QACf,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS;QACvD,IAAI,CAAC,UAAU,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC;QACtC,IAAI,CAAC,UAAU,OAAO;QACtB,IAAK,IAAI,IAAI,IAAI,CAAC,aAAa,GAAG,IAAI,IAAI,CAAC,SAAS,QAAQ,IACxD,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,aAAa,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,UAAU,GAAG;YAC5D,IAAI,CAAC,UAAU,cAAc,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC9C,IAAI,CAAC,UAAU,2BAA2B,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC3D,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC;QACjE;QAEJ,IAAI,CAAC,UAAU;QAInB,IAAI,CAAC,UAAU;QAIf,0BAA0B;QAC1B,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,WAAW,YAAY,IAAI,CAAC;QACjC,IAAI,CAAC,WAAW,SAAS,GAAG,GAAG,IAAI,CAAC,cAAc,OAAO,IAAI,CAAC,cAAc;QAC5E,IAAI,CAAC,WAAW,UAAU,IAAI,CAAC,cAAc,GAAG;QAChD,IAAI,CAAC,WAAW;QAEhB,SAAS;QACT,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,WAAW,2BAA2B;QAC3C,IAAI,CAAC,WAAW,cAAc;QAC9B,IAAI,CAAC,WAAW,YAAY;QAC5B,IAAI,CAAC,WAAW,UAAU,CAAC,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO;QACvD,IAAI,CAAC,WAAW,WACZ,KAAK,MAAM,IAAI,CAAC,QAAQ,IAAI,AAAC,OAAO,QAAQ,IAAK,IAAI,CAAC,SAAS,KAC/D,KAAK,MAAM,IAAI,CAAC,SAAS,IAAI,AAAC,OAAO,SAAS,IAAK,IAAI,CAAC,SAAS,KACjE,KAAK,MAAM,OAAO,QAAQ,IAAI,CAAC,QAC/B,KAAK,MAAM,OAAO,SAAS,IAAI,CAAC;QAEpC,IAAI,CAAC,WAAW;IACpB;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,mBAAiC;QAC7B,OAAO,IAAI,CAAC;IAChB;IAEA,YAA8B;QAC1B,OAAO;YACH,GAAG,IAAI,CAAC,KAAK;YACb,GAAG,IAAI,CAAC,KAAK;YACb,UAAU,IAAI,CAAC,eAAe;QAClC;IACJ;IAEA,QAAS,IAAoD,EAAQ;QACjE,MAAM,IAAI,IAAI,CAAE,KAAK;QACrB,MAAM,IAAI,IAAI,CAAE,KAAK;QACrB,MAAM,WAAW,IAAI,CAAE,KAAK;QAC5B,IAAI,CAAC,OAAO;YACR,GAAG,IAAI;YACP;YACA;YACA;QACJ;QACA,IAAI,CAAC;IACT;IAEA,QAAS,KAAa,EAAE,MAAc,EAAQ;QAC1C,IAAI,UAAU,IAAI,CAAC,SAAS,WAAW,IAAI,CAAC,QACxC;QAGJ,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QAEd,IAAI,CAAC,aAAa,QAAQ,IAAI,CAAC;QAC/B,IAAI,CAAC,aAAa,SAAS,IAAI,CAAC;QAEhC,IAAI,CAAC,aAAa,QAAQ,IAAI,CAAC;QAC/B,IAAI,CAAC,aAAa,SAAS,IAAI,CAAC;QAEhC,IAAI,CAAC,cAAc,QAAQ,IAAI,CAAC;QAChC,IAAI,CAAC,cAAc,SAAS,IAAI,CAAC;QAEjC,IAAI,CAAC,eAAe,MAAM,QAAQ,IAAI,CAAC,QAAQ;QAE/C,IAAI,CAAC;IACT;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,cAAc,IAAI,CAAC;QAEnB,IAAI,CAAC,eAAe;QACpB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,IAAI,CAAC,aAAa;QAClB,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,YAAY;QACjB,CAAA,GAAA,YAAI,EAAE,qBAAqB,IAAI,CAAC;IACpC;AACJ;;;ACvhBA,OAAO,OAAO,CAAC,kBAAkB,GAAG,CAAC,uBAAuB,CAAC;;;;;ACQ7D;;;CAGC,GACD,2DAAgB;AAZhB;AACA;AACA;AACA;AACA;AAQO,SAAS,sBACZ,CAqBC;IAED,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;IAClB,MAAM,UAAU,OAAO,aAAa,OAAO,OAAO,cAAc;IAChE,MAAM,QAAoB,UAAU,CAAC,IAAI;QAAE,OAAO;IAAQ;IAE1D,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;QACvB,KAAK;YACD,WAAW;YACX,WAAW;YACX,OAAO;YACP,YAAY;QAChB;IACJ;IAEA,MAAM,WAAW,IAAI,CAAA,GAAA,kBAAO,EAAE;QAC1B,OAAO,UAAU,MAAM;QACvB,QAAQ,UAAU,MAAM;QACxB,QAAQ,EAAE,MAAM;QAChB,WAAW;QACX,UAAU,CAAC,OAAO;YACd,IAAI,CAAC,cACD;YAEJ,iBAAiB,OAAO;QAC5B;IACJ;IACA,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS,SAAS;QACrB,YAAY;IAChB;IACA,SAAS,QAAQ,QAAQ,CAAA,GAAA,cAAG,EAAE;IAE9B,OAAO,OAAO,SAAS,SAAS;IAEhC,SAAS,iBAAkB,CAAS,EAAE,CAAS;QAC3C,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,GAAG,GAAG,EAAE,SAAS,EAAE;QAE1C,IAAI,IAAI,QAAQ,GAAG;YACf,aAAa,YAAY,CAAC,4BAA4B,EAAE,EAAE,GAAG,EAAE,EAAE,UAAU,EAAE,KAAK,MAAM,IAAI,OAAO,GAAG,EAAE,KAAK,MAAM,IAAI,QAAQ,CAAC;YAChI,aAAa,QAAQ,CAAA,GAAA,cAAG,EAAE;QAC9B,OAAO;YACH,aAAa,YAAY,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC;YACtC,aAAa,QAAQ;QACzB;IACJ;IACA,iBAAiB,EAAE,MAAM,OAAO,EAAE,MAAM;IAGxC,IAAI,YAAY;IAChB,SAAS,aAAc,aAA4B;QAC/C,MAAM,aAAa,EAAE;QACrB,MAAM,aAAa;YACf,QAAQ;YACR,YAAY;YACZ,SAAS;YACT,cAAc;YACd,gBAAgB;YAChB,gBAAgB;YAChB,cAAc;YACd,oBAAoB;QACxB;QACA,IAAK,IAAI,IAAI,GAAG,IAAI,cAAc,QAAQ,IACtC,WAAW,KAAK,OAAO,UAAU,CAAC,aAAa,CAAC,EAAE,CAAC;QAEvD,MAAM,WAAW,KAAK;IAC1B;IAEA,IAAI;IACJ,IAAI;IACJ,IAAI,EAAE,MAAM,SAAS;QACjB,IAAI,EAAE,MAAM,QAAQ;YAChB,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC3B,MAAM;gBACN,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,UAAU,CAAC;oBACP,YAAY;gBAChB;YACJ;YACA,OAAO,OAAO,gBAAgB;YAE9B,IAAI,EAAE,MAAM,YAAY;gBACpB,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;oBACjB,WAAW;oBACX,SAAS,CAAA,GAAA,cAAG,EAAE;gBAClB;gBACA,MAAM,WAAW,EAAE,MAAM;gBACzB,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;oBACf,QAAQ;oBACR,SAAS;oBACT,SAAS;oBACT,KAAK;wBAAE,YAAY;oBAAK;oBACxB,SAAS,IAAM,aAAa;gBAChC;gBACA,OAAO,OAAO;YAClB;QACJ,OAAO;YACH,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACjB,WAAW;gBACX,SAAS,CAAA,GAAA,cAAG,EAAE;YAClB;YACA,OAAO,OAAO;QAClB;;IAGJ,SAAS,SAAU,MAAc;QAC7B,MAAM,eAAe,SAAS;QAC9B,MAAM,WAAW,SAAS;QAC1B,MAAM,YAAY,EAAE,MAAM,UAAU,SAAS,SAAS,EAAE,MAAM,WAAW,SAAS;QAClF,SAAS;QACT,CAAA,GAAA,MAAC,EAAE,UAAU;QACb,IAAI,iBACA,gBAAgB;QAGpB,IAAI,WAAW,CAAA,GAAA,cAAG,EAAE,wBAAwB;YACxC,EAAE,SAAS;gBACP,MAAM;gBACN,OAAO,YAAY,eAAe,EAAE,MAAM;YAC9C;YACA,IAAI,CAAC,WACD,CAAA,GAAA,MAAC,EAAE,WAAW;QAEtB,OAAO,IAAI,WAAW,CAAA,GAAA,cAAG,EAAE,wBAAwB;YAC/C,IAAI,EAAE,MAAM,SAAS,OAAO;gBACxB,IAAI,WACA,OAAO,EAAE,MAAM;gBAEnB,EAAE,SAAS;oBACP,MAAM;oBACN,OAAO,EAAE;oBACT,SAAS;gBACb;gBACA,CAAA,GAAA,MAAC,EAAE,WAAW;YAClB,OAAO,IAAI,EAAE,MAAM,SAAS,SACxB,EAAE,SAAS;gBACP,MAAM;gBACN,OAAO;YACX;QAER,OAAO;YACH,EAAE,SAAS;gBACP,MAAM;YACV;YACA,CAAA,GAAA,MAAC,EAAE,WAAW;QAClB;IACJ;IACA,CAAA,GAAA,oBAAQ,EAAE;QACN,QAAQ,EAAE;QACV,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,gBAAgB,IAAI,CAAC;QACzC,KAAK;QACL;QACA,SAAS;YAAC,CAAA,GAAA,cAAG,EAAE;YAAwB,CAAA,GAAA,cAAG,EAAE;YAAwB;SAAS;QAC7E,WAAW;YAAC,CAAA,GAAA,cAAG,EAAE;YAAwB,CAAA,GAAA,cAAG,EAAE;SAAuB;QACrE;QACA,WAAW;IACf;AACJ;;;;;ACrJA,kDAAgB;AAKhB,kDAAgB;AAMhB;;;CAGC,GACD,6CAAgB;AA4WhB,sDAAgB;AApahB;AAGA;AACA;AACA;AACA;AAEA,IAAI;AACJ,IAAI;AAEJ,SAAS;IACL,IAAI,WACA;IAEJ,YAAY;QACR,eAAe;QAEf,UAAU;QACV,YAAY;QACZ,cAAc;QAEd,WAAW;QACX,UAAU;QACV,eAAe;QAEf,WAAW;QACX,cAAc;QACd,cAAc;QAEd,cAAc;QACd,aAAa;QAEb,OAAO;QACP,cAAc;QACd,SAAS;QACT,cAAc;IAClB;IACA,YAAY,OAAO,YAAY,OAAO,QAAQ,WAAW,IAAI,CAAA,IAAK,EAAE;AACxE;AAEO,SAAS,aAAc,GAAc;IACxC;IACA,OAAO,SAAS,CAAC,IAAI;AACzB;AAEO,SAAS,aAAc,GAAa;IACvC;IACA,OAAO,SAAS,CAAC,IAAI;AACzB;AAOO,SAAS,QAAS,MAAW;IAChC,IAAI,CAAC,OAAO,QACR,MAAM,IAAI,MAAM;IAEpB,MAAM,SAAiB;QACnB,MAAM;QACN,QAAQ,OAAO;QACf,OAAO,OAAO;QACd,QAAQ,OAAO;IACnB;IAEA,SAAS,WAAY,UAAuB;QACxC,IAAI,CAAC,OAAO,YACR,OAAO,aAAa,EAAE;QAE1B,IAAI,OAAO,WAAW,SAAS,aAC3B;QAEJ,OAAO,WAAW,KAAK;IAC3B;IAEA,SAAS,cAAe,SAAoB;QACxC,IAAI,aAAuB,aAAa;QACxC,IAAI,CAAC,YAAY;YACb,WAAW;YACX,aAAa;QACjB;QACA,OAAO;IACX;IAEA,IAAI,OAAO,mBAAmB,GAC1B,WAAW;IAGf,IAAI,CAAC,OAAO,UAAU;QAClB,OAAO,QAAQ;QACf,OAAO;IACX;IAEA,yBAAyB;IACzB,MAAM,YAAY,CAAA,GAAA,oBAAS;IAC3B,IAAI,aAAa;IACjB,SAAS,iBAAkB,QAAe;QACtC,IAAI,SAAS;QACb,IAAI,SAAS,WAAW;YACpB,MAAM,aAAa,aAAa,SAAS;YACzC,IAAI,cAAc,eAAe,eAC7B,OAAO;QAEf;QACA,IAAI,SAAS,UACT,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,SAAS,QAAQ,IAAK;YAC/C,MAAM,OAAO,SAAS,QAAQ,CAAC,EAAE;YACjC,IAAI,KAAK,YAAY,KAAK,YACtB;YAGJ,IAAI,KAAK,UAAU;gBACf,WAAW;gBACX,UAAU,iBAAiB;YAC/B,OACI;QAER;QAEJ,OAAO;IACX;IACA,cAAc,iBAAiB;IAC/B,IAAI,aAAa,WAAW;QACxB,OAAO,QAAQ;QACf,OAAO;IACX;IAEA,OAAO,SAAS,EAAE;IAElB,SAAS,YAAa,UAA6B,EAAE,YAAoB;QACrE,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,IAAI;QAC5B,MAAM,SAAS,aAAa,aAAa,GAAG,GAAG,WAAW,OAAO,WAAW;QAC5E,IAAI,iBAAiB,GACjB,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,KAAK,QAAQ,KAAK,EACzC,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG,OAAO,IAAI,CAAC,EAAE;aAGvC,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,KAAK,QAAQ,KAAK,EACzC,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG,MAAM,OAAO,IAAI,CAAC,EAAE;QAGjD,aAAa,aAAa,QAAQ,GAAG;IACzC;IAEA,SAAS,aAAc,WAAkB;QAErC,IAAI,YAA2B,EAAE;QACjC,MAAM,iBAAiB,CAAC,YAAY;QACpC,MAAM,eAAe,CAAA,GAAA,sBAAe,EAAE,YAAY,SAAS;QAC3D,MAAM,kBAAkB,cAAc,YAAY;QAClD,IAAI;QACJ,IAAI;QACJ,IAAI,oBAAoB,eAAe;YACnC,cAAc,CAAA,GAAA,0BAAW,EAAE,OAAO,OAAO,OAAO;YAChD,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI;QACtB;QAEA,qBAAqB;QACrB,IAAI,YAAY,MAAM;YAClB,WAAW;YACX,YAAY,YAAY,KAAK,QAAS,YAAY,KAAK;QAC3D;QAEA,IAAI,YAAY,UACZ,IAAK,IAAI,IAAI,GAAG,IAAI,YAAY,SAAS,QAAQ,IAAK;YAClD,MAAM,OAAO,YAAY,QAAQ,CAAC,EAAE;YACpC,IAAI,KAAK,UACL;YAEJ,IAAI,KAAK,YAAY;gBACjB,WAAW;gBACX;YACJ;YAEA,MAAM,cAAc,AAAC,CAAA,KAAK,YAAY,KAAK,MAAK,KAAM,YAAY,QAAQ,CAAC,IAAI,EAAE,IAAI,YAAY,QAAQ,CAAC,IAAI,EAAE,CAAC;YACjH,IAAI,aACA,WAAW;YAGf,IAAI,KAAK,UAAU;gBACf,MAAM,2BAA2B,aAAa;gBAE9C,IAAK,IAAI,IAAI,GAAG,IAAI,yBAAyB,QAAQ,IAAK;oBACtD,MAAM,YAAY,wBAAwB,CAAC,EAAE;oBAC7C,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU;oBAElC,WAAW;oBACX,IAAI,aAAa;wBACb,MAAM,iBAAiB,CAAA,GAAA,0BAAW,EAAE,OAAO,OAAO,OAAO;wBACzD,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,IAAI;wBAC3B,YAAY,UAAU,UAAU,OAAO,GAAG;wBAE1C,IAAK,IAAI,IAAI,IAAI,GAAG,IAAI,YAAY,SAAS,UAAU,YAAY,QAAQ,CAAC,EAAE,CAAC,UAAU,IAAK;4BAC1F,MAAM,eAAe,YAAY,QAAQ,CAAC,EAAE;4BAC5C,IAAI,aAAa,YAAY,KAAK,aAAa,QAC3C;4BAEJ,IAAI,aAAa,cAAc,WAC3B,MAAM,IAAI,MAAM;4BAEpB,IAAI,aAAa,YAAY,WACzB,MAAM,IAAI,MAAM;4BAEpB,IAAI,aAAa,WAAW,WACxB,MAAM,IAAI,MAAM;4BAEpB,IAAI,aAAa,SAAS,WACtB,MAAM,IAAI,MAAM;4BAEpB,IAAI,aAAa,QAAQ,WACrB,MAAM,IAAI,MAAM;4BAEpB,YAAY,2BAA2B,cAAc,aAAa;4BAClE,YAAY,cAAc,aAAa;4BACvC,YAAY,UAAU,aAAa,QAAQ,aAAa,MAAM,aAAa;wBAC/E;wBAEA,SAAS,2BAA2B;wBACpC,SAAS,UAAU,gBAAgB,GAAG;oBAC1C;oBAIA,aAAa;oBACb,IAAI,YAAY,MAAM;wBAClB,SAAS,2BAA2B,YAAY,KAAK,iBAAiB,IAAI,mBAAmB;wBAC7F,IAAI,YAAY,KAAK,WAAW,WAC5B,MAAM,IAAI,MAAM;wBAEpB,IAAI,YAAY,KAAK,SAAS,WAC1B,MAAM,IAAI,MAAM;wBAEpB,IAAI,YAAY,KAAK,QAAQ,WACzB,MAAM,IAAI,MAAM;wBAEpB,SAAS,UAAU,YAAY,KAAK,QAAQ,YAAY,KAAK,MAAM,YAAY,KAAK;oBACxF;oBAEA,IAAI,aAAa;wBACb,IAAI,aAAa,WACb,MAAM,IAAI,MAAM;wBAEpB,SAAS,2BAA2B,UAAU;wBAC9C,SAAS,cAAc,UAAU;wBACjC,SAAS,UAAU,UAAU,OAAO,GAAG;oBAE3C,OAAO;wBACH,UAAU,UAAU,UAAU,UAAU;wBACxC,UAAU,KAAK;oBACnB;gBACJ;gBAEA;YACJ;YAEA,MAAM,SAAS,CAAA,GAAA,0BAAW,EAAE,OAAO,OAAO,OAAO;YACjD,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YACnB,IAAI,KAAK,QAAQ;gBACb,IAAI,KAAK,QAAQ,WACb,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,SAAS,WACd,MAAM,IAAI,MAAM;gBAEpB,IAAI,UAAU,KAAK,QAAQ,KAAK,MAAM,KAAK;YAC/C;YAEA,UAAU;YACV,IAAI,KAAK,SACL,WAAW;YAGf,OAAO;YACP,IAAI,KAAK,MAAM;gBACX,WAAW;gBACX,IAAI,KAAK,KAAK,WAAW,WACrB,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,KAAK,iBAAiB,WAC3B,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,KAAK,SAAS,WACnB,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,KAAK,QAAQ,WAClB,MAAM,IAAI,MAAM;gBAEpB,YAAY,KAAK,KAAK,QAAQ,KAAK,KAAK;gBAExC,IAAI,2BAA2B,KAAK,KAAK,iBAAiB,IAAI,mBAAmB;gBACjF,IAAI,UAAU,KAAK,KAAK,QAAQ,KAAK,KAAK,MAAM,KAAK,KAAK;YAC9D;YAEA,WAAW;YACX,IAAI,aAAa;gBACb,IAAI,KAAK,UAAU,WACf,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,SAAS,WACd,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,WAAW,WAChB,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,QAAQ,WACb,MAAM,IAAI,MAAM;gBAEpB,IAAI,KAAK,WAAW,WAChB,MAAM,IAAI,MAAM;gBAEpB,MAAM,iBAAiB,CAAA,GAAA,0BAAW,EAAE,KAAK,QAAQ,KAAK,MAAM,KAAK,SAAS,KAAK;gBAC/E,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,IAAI;gBAC3B,YAAY,UAAU,KAAK,QAAQ,GAAG;gBAEtC,IAAK,IAAI,IAAI,IAAI,GAAG,IAAI,YAAY,SAAS,UAAU,YAAY,QAAQ,CAAC,EAAE,CAAC,UAAU,IAAK;oBAC1F,MAAM,eAAe,YAAY,QAAQ,CAAC,EAAE;oBAC5C,IAAI,aAAa,YAAY,KAAK,aAAa,QAC3C;oBAEJ,IAAI,aAAa,cAAc,WAC3B,MAAM,IAAI,MAAM;oBAEpB,IAAI,aAAa,YAAY,WACzB,MAAM,IAAI,MAAM;oBAEpB,IAAI,aAAa,WAAW,WACxB,MAAM,IAAI,MAAM;oBAEpB,IAAI,aAAa,SAAS,WACtB,MAAM,IAAI,MAAM;oBAEpB,IAAI,aAAa,QAAQ,WACrB,MAAM,IAAI,MAAM;oBAEpB,YAAY,2BAA2B,cAAc,aAAa;oBAClE,YAAY,cAAc,aAAa;oBACvC,YAAY,UAAU,aAAa,QAAQ,aAAa,OAAO,KAAK,MAAM,aAAa,MAAM,KAAK;gBACtG;gBAEA,IAAI,2BAA2B;gBAC/B,IAAI,UAAU,gBAAgB,KAAK,MAAM,KAAK;YAClD;YAEA,aAAa;YACb,IAAI,YAAY,MAAM;gBAClB,IAAI,2BAA2B,YAAY,KAAK,iBAAiB,IAAI,mBAAmB;gBACxF,IAAI,YAAY,KAAK,WAAW,WAC5B,MAAM,IAAI,MAAM;gBAEpB,IAAI,YAAY,KAAK,SAAS,WAC1B,MAAM,IAAI,MAAM;gBAEpB,IAAI,YAAY,KAAK,QAAQ,WACzB,MAAM,IAAI,MAAM;gBAEpB,IAAI,UAAU,YAAY,KAAK,QAAQ,YAAY,KAAK,MAAM,YAAY,KAAK;YACnF;YAEA,IAAI,KAAK,cAAc,WACnB,MAAM,IAAI,MAAM;YAEpB,IAAI,KAAK,WAAY,WACjB,MAAM,IAAI,MAAM;YAEpB,IAAI,KAAK,YAAY,WACjB,MAAM,IAAI,MAAM;YAGpB,IAAI,eAAe,UACf;gBAAA,IAAI,eAAe,GAAG;oBAClB,SAAS,2BAA2B,cAAc,KAAK;oBACvD,SAAS,cAAc,KAAK,SAAS,IAAI,KAAK;oBAC9C,SAAS,UAAU,QAAQ,GAAG;gBAClC;YAAA,OAEG;gBACH,IAAI,KAAK,SAAS,WACd,MAAM,IAAI,MAAM;gBAEpB,UAAU,KAAK;oBACX,MAAM,KAAK;oBACX,WAAW,CAAC,KAAK,UAAU;oBAC3B,SAAS,KAAK,UAAU;oBACxB,YAAY,cAAc,KAAK;oBAC/B,OAAO;gBACX;YACJ;QACJ;QAGJ,IAAI,aAAa;YACb,IAAI,YAAY,SAAS,WACrB,MAAM,IAAI,MAAM;YAEpB,YAAY;gBACR;oBACI,MAAM,YAAY;oBAClB,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,OAAO;gBACX;aACH;QACL;QAEA,OAAO;IACX;IAEA,OAAO,SAAS,aAAa;QACzB,MAAM;QACN,SAAS;QACT,WAAW;QACX,UAAU,OAAO;IACrB;IAEA,OAAO;AACX;AAEO,SAAS,iBAAkB,KAAa;IAC3C,2CAA2C;IAC3C,MAAM,SAAqB;QACvB,OAAO,MAAM;QACb,QAAQ,MAAM;QACd,QAAQ,EAAE;IACd;IACA,IAAI,MAAM,QACN,OAAO,SAAS,MAAM,OAAO,IAAI,CAAA;QAC7B,OAAO;YACH,MAAM,KAAK;YACX,WAAW,KAAK;YAChB,SAAS,KAAK;YACd,YAAY,KAAK;YACjB,OAAO,KAAK;QAChB;IACJ;SAEA,YAAY;IACZ,OAAO,SAAS;QAAC;YACb,MAAM,CAAA,GAAA,cAAG,EAAE;YACX,WAAW;YACX,SAAS;YACT,YAAY;YACZ,OAAO,MAAM;QACjB;KAAE;IAEN,OAAO;AACX;;;;;AC1bA,+CAAgB;AA0GhB,qDAAgB;AAkBhB;;CAEC,GACD,uDAAgB;AAehB;;CAEC,GACD,2CAAgB;AArJhB,MAAM,uBAAuB,CAAC,CAAC,OAAO;AACtC,IAAI,YAAY;AAChB,MAAM,iBAAiB;AAEhB,SAAS,UAAW,IAAY;IACnC,YAAY,KAAK;AACrB;AAEA;;;;;;;CAOC,GACD,SAAS,yBACL,cAAkD,EAClD,eAA2B,EAC3B,aAAyC;IAGzC,IAAI,cAAc;IAElB,SAAS;QACL,IAAI,aACA;QAEJ,cAAc;QACd;IACJ;IAEA,SAAS,QAAS,QAAgB;QAC9B,IAAI,aACA;QAEJ,cAAc;QACd,cAAc;IAClB;IAEA,IAAI,CAAC,sBAAsB;QACvB,WAAW;YACP,QAAQ;QACZ,GAAG;QACH;IACJ;IACA,IAAI;IAEJ,IAAI;QACA,aAAa,OAAO,UAAU,KAAK,WAAW;IAClD,EAAE,OAAO,GAAG;QACR,QAAQ,AAAC,EAAwB;QACjC;IACJ;IAEA,WAAW,kBAAkB;QACzB,IAAI;YACA,MAAM,KAAkB,WAAW;YACnC,MAAM,QAAQ,GAAG,kBAAkB,gBAAgB;gBAAC,SAAS;YAAI;YACjE,MAAM,YAAY,MAAM,MAAM;gBAAC,QAAQ;YAAI;QAC/C,EAAE,OAAO,GAAG;YACR,QAAQ,AAAC,EAAwB;QACrC;IACJ;IACA,WAAW,UAAU;QACjB,QAAQ,4BAA4B,WAAW;IACnD;IACA,WAAW,YAAY;QACnB,IAAI;QACJ,IAAI;QACJ,IAAI;QAEJ,IAAI;YACA,cAAc,WAAW;YACzB,IAAI,CAAC,YAAY,iBAAiB,SAAS,iBAAiB;gBACxD,8DAA8D;gBAC9D,wBAAwB;gBACxB,OAAO,UAAU,eAAe;gBAChC,QAAQ,kBAAkB,iBAAiB;gBAC3C;YACJ;YACA,iBAAiB,YAAY,YAAY,gBAAgB;YACzD,WAAW,eAAe,YAAY;YACtC,SAAS,MAAM;QACnB,EAAE,OAAO,GAAG;YACR,QAAQ,AAAC,EAAwB;YACjC;QACJ;QAEA,YAAY,UAAU;YAClB,QAAQ,qBAAqB,AAAC,YAA8C;QAChF;QAEA,IAAI;YACA,eAAe;QACnB,EAAE,OAAO,GAAG;YACR,QAAQ,AAAC,EAAwB;YACjC;QACJ;QAEA,eAAe,aAAa;YACxB;YACA,YAAY;QAChB;QACA,eAAe,UAAU;YACrB,QAAQ,wBAAwB,eAAe;QACnD;IACJ;AACJ;AAEO,SAAS,gBACZ,eAAgE,EAChE,aAAsC;IAEtC,IAAI,sBAAsB;QACtB,IAAI;QACJ,yBAAyB,SAAU,QAAQ;YACvC,QAAQ,SAAS,IAAI;QACzB,GAAG;YACC,gBAAgB,MAAM;QAC1B,GAAG,SAAU,QAAQ;YACjB,cAAc,qCAAqC;QACvD;IACJ,OACI,gBAAgB;AAExB;AAKO,SAAS,kBACZ,cAAiC,EACjC,eAA2B,EAC3B,aAAsC;IAEtC,yBAAyB,SAAU,QAAQ;QACvC,SAAS,IAAI;IACjB,GAAG;QACC;IACJ,GAAG,SAAU,QAAQ;QACjB,cAAc;IAClB;AAEJ;AAKO,SAAS,MACZ,eAA2B,EAC3B,aAAsC;IAEtC,yBAAyB,SAAU,QAAQ;QACvC,SAAS,OAAO;IACpB,GAAG;QACC;IACJ,GAAG,SAAU,KAAK;QACd,cAAc;IAClB;AAEJ;;;;;qDC3Ia;+CAGA;AA1Bb;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAKO,MAAM,kBAAkB;IAC3B,UAAU;AACd;AACO,MAAM,YAET;IACA,oBAAoB;QAChB,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,yCAAsB;QAC5B,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,OAAO;IACX;IACA,YAAY;QACR,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,2BAAY;QAClB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,QAAQ;QACJ,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,6BAAU;QAChB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,OAAO;IACX;IACA,SAAS;QACL,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,8BAAS;QACf,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,OAAO;IACX;IACA,MAAM;QACF,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,2BAAM;QACZ,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,eAAe;QACX,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,oCAAiB;QACvB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,cAAc;QACd,OAAO;IACX;IACA,QAAQ;QACJ,MAAM;YACF,MAAM;YACN,QAAQ;QACZ;QACA,MAAM,CAAA,GAAA,6BAAQ;QACd,WAAW;QACX,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,cAAc;QACd,OAAO;IACX;IACA,aAAa;QACT,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,kCAAe;QACrB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,OAAO;IACX;IACA,QAAQ;QACJ,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,6BAAQ;QACd,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,QAAQ;QACJ,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,6BAAQ;QACd,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,WAAW;QACP,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,gCAAa;QACnB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,OAAO;IACX;IACA,SAAS;QACL,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,8BAAS;QACf,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,cAAc;QACd,OAAO;IACX;IACA,WAAW;QACP,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,gCAAW;QACjB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,MAAM;QACF,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,mCAAQ;QACd,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,cAAc;QACd,OAAO;IACX;IACA,aAAa;QACT,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,kCAAe;QACrB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,cAAc;QACd,OAAO;IACX;IACA,MAAM;QACF,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,2BAAM;QACZ,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,OAAO;QACH,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,4BAAO;QACb,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;QACT,OAAO;IACX;IACA,SAAS;QACL,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,8BAAS;QACf,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;IACA,aAAa;QACT,MAAM;YACF,MAAM;YACN,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,CAAA,GAAA,kCAAa;QACnB,WAAW;QACX,WAAW;QACX,OAAO;QACP,SAAS;IACb;AACJ;;;AClRA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,0CAA0C,MAAM,KAAK;;;ACA9H,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,qCAAqC,MAAM,KAAK;;;ACAzH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,kCAAkC,MAAM,KAAK;;;ACAtH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,iCAAiC,MAAM,KAAK;;;ACArH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,+BAA+B,MAAM,KAAK;;;ACAnH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,gCAAgC,MAAM,KAAK;;;ACApH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,oCAAoC,MAAM,KAAK;;;ACAxH,OAAO,UAAU,QAAQ,mBAAwB,aAAa,WAAW,mCAAmC,MAAM,KAAK;;;ACAvH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;ACA/G,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;ACAhH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;ACAlH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,mCAAmC,MAAM,KAAK;;;ACAvH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;;;6CCiBrG;AAjBb;AACA;AACA;AACA;AACA;AACA;AACA;AAWO,MAAM,UAAU;cACnB,CAAA,GAAA,kBAAO;gBACP,CAAA,GAAA,sBAAS;kBACT,CAAA,GAAA,0BAAW;gBACX,CAAA,GAAA,sBAAS;gBACT,CAAA,GAAA,sBAAS;iBACT,CAAA,GAAA,wBAAU;iBACV,CAAA,GAAA,wBAAU;AACd;;;;;ACNA,8CAAa;AAnBb;AACA;AAEA;AASA,MAAM,eAAe;AACrB,MAAM,cAAc;AACpB,MAAM,YAAY,GAAG,cAAc;AACnC,MAAM,eAAe;AAErB,MAAM,SAAS,IAAI,KAAK;AAEjB,MAAM;IA+BD,oBAAqB;QACzB,IAAI,IAAI,CAAC,mBAAmB,gBAAgB,IAAI,CAAC,mBAAmB,cAChE;QAGJ,MAAM,iBAAgD;YAClD;gBAAC,IAAI,CAAC;gBAAgB;aAAI;YAC1B;gBAAC,IAAI,CAAC;gBAAe;aAAG;YACxB;gBAAC,IAAI,CAAC;gBAAe;aAAG;SAC3B;QAED,IAAI;QAEJ,IAAK,IAAI,IAAI,GAAG,IAAI,eAAe,QAAQ,IAAK;YAC5C,MAAM,CAAA,GAAA,MAAC,EAAE,IAAK,cAAc,CAAC,EAAE,CAAC,EAAE;YAElC,IAAI;YACJ,IAAI,UAAU,GAAG,GAAG,cAAc,CAAC,EAAE,CAAC,EAAE,EAAE,cAAc,CAAC,EAAE,CAAC,EAAE;YAE9D,IAAI,YAAY,UAAU,IAAI,CAAC,aAAa,IACtC,OAAO,IAAI,CAAC,aAAa,IACzB,OAAO,IAAI,CAAC,aAAa,IACzB,OAAO,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,eAAe,GAAG;YACzD,IAAI,SAAS,GAAG,GAAG,cAAc,CAAC,EAAE,CAAC,EAAE,EAAE,cAAc,CAAC,EAAE,CAAC,EAAE;YAE7D,IAAI,2BAA2B;YAC/B,IAAI,wBAAwB;YAC5B,IAAI,UAAU,CAAA,GAAA,yBAAS,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE,GAAG,GAAG,cAAc,CAAC,EAAE,CAAC,EAAE,EAAE,cAAc,CAAC,EAAE,CAAC,EAAE;YAE/F,IAAI;QACR;IACJ;IAEQ,YAAa,QAAgB,EAAU;QAC3C,OAAO,IAAI,CAAC,iBAAkB,CAAA,IAAI,CAAC,4BAA4B,WAAW,WAAW,CAAA;IACzF;IAEA;;;;;;;KAOC,GACD,AAAQ,QACJ,CAAS,EACT,CAAQ,EACR,IAAY,EACZ,OAAe,EACf,KAAc,EACd,MAA+D,EAC3D;QACJ,IAAI,QAAQ,GACR;QAGJ,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;QAG5C,IAAI,CAAC,UAAU,MAAM,CAAC,EAAE,KAAK,SACzB,IAAI,CAAC,QAAQ,cAAc;QAG/B,IAAI,CAAC,UAAW,CAAA,IAAI,CAAC,mBAAmB,gBAAgB,IAAI,CAAC,mBAAmB,YAAW,GACvF,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC;QAGlC,IAAI,IAAI,CAAC,mBAAmB,cAAc;YACtC,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,QAAQ,IAAI,GAAG,GAAG,MAAM,GAAG;YAChC,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,cAAc;QAEvB,OAAO,IAAI,IAAI,CAAC,mBAAmB,cAC/B;YAAA,IAAI,UAAU,WAAW;gBACrB,IAAI,CAAC,QAAQ;gBACb,IAAI,CAAC,QAAQ,UAAU,GAAG;gBAC1B,IAAI,CAAC,QAAQ,OAAO,QAAQ,MAAM,KAAK;gBACvC,IAAI,CAAC,QAAQ,SAAS,CAAC,MAAM,CAAC,MAAM,OAAO,GAAG,OAAO;gBACrD,IAAI,CAAC,QAAQ;gBACb,IAAI,CAAC,cAAc;YACvB;QAAA,OAEG;YACH,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,QAAQ,UAAU,GAAG;YAC1B,IAAI,eAAe,IAAI,CAAC;YACxB,IAAI,QAAQ,MAAM,OAAO,IACrB,eAAe,IAAI,CAAC;iBACjB,IAAI,QAAQ,IACf,eAAe,IAAI,CAAC;YAExB,IAAI,CAAC,QAAQ,MAAM,MAAM;YACzB,IAAI,IAAI,CAAC,mBAAmB,aACxB,IAAI,CAAC,QAAQ,OAAO,AAAE,CAAA,IAAI,CAAA,IAAK,QAAS,SAAS,2CAA2C;YAEhG,IAAI,CAAC,QAAQ,UAAU,cAAc,IAAI,IAAI,GAAG;YAEhD,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,cAAc;QACvB;IACJ;IAEA,eAAe;IACP,aACJ,CAAgB,EAChB,CAAgB,EAChB,IAAY,EACZ,QAAgB,EACZ;QACJ,IAAI,IAAI,CAAC,eAAe,MAAM;YAC1B,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE;YACzB,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,GAAG,GAAG,KAAO;QACtE;QAEA,MAAM,UAAoE,EAAE,EAAE,8CAA8C;QAE5H,MAAM,cAAc,CAAC;YAOjB,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW,UAAU,UAAU,IAAI;YACrE,MAAM,eAAe,IAAI,CAAC,YAAY;YACtC,MAAM,YAAY,KAAK,IAAI,KAAK,IAAI,CAAC,cAAe,CAAA,IAAI,CAAC,yBAAyB,gBAAgB,CAAA;YAClG,QAAQ,KAAK;gBAAC,IAAI;gBAAG,IAAI;gBAAG;gBAAW;gBAAc,IAAI;aAAM;QACnE;QAEA,MAAM,eAAe,OAAO,IAAI,CAAC;QACjC,IAAI,MAAM,QAAQ,MAAM,MACpB,IAAI,CAAC,WAAW,SAAS,cAAc;aAEvC,IAAI,CAAC,WAAW,IAAI,GAAG,GAAG,cAAc;QAG5C,4BAA4B;QAC5B,IAAI,CAAC,QAAQ;QACb,IAAI,SAA6C;QACjD,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAAK;YACrC,MAAM,OAAO,OAAO,CAAC,EAAE;YACvB,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE;YAC1D,SAAS;QACb;QACA,IAAI,CAAC,QAAQ;IACjB;IAGA,mBAAmB;IACnB,aAAe;aAtLP,UAAoC,CAAC;aACrC,UAA8B,IAAI,CAAA,GAAA,MAAC,EAAE;aAGrC,4BAAqC;aACrC,yBAAkC;aAClC,cAAsB;aACtB,iBAAyB;aACzB,iBAAyB;aACzB,eAAqB,CAAC;aACtB,kBAA0B;aAC1B,iBAAyB;aACzB,wBAAiC;aAEjC,cAAuB;aACvB,kBAA0B;aAC1B,YAA4B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACpD,aAA6B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACrD,WAA6B,EAAE;aAC/B,iBAA0B;aAC1B,aAAgC;QAExC,aAAa;aACI,iBAAoC,CAAA,GAAA,MAAC,EAAE,OAAO,KAAK;aACnD,gBAAmC,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI;aACjD,gBAAmC,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI;aACjD,kBAA4B;YAAC;YAAG;YAAK;YAAG;SAAE;IA4J3C;IAEhB,sBAAsB;IAEtB,UAAW,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC9C,IAAI,CAAC,eAAe;YAChB,MAAM;gBAAC;gBAAS;aAAW;YAC3B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAA0B;gBAC5C;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAuB;gBACzC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAY;gBAC9B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAa;gBAC/B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAsB;gBACxC;aACH;QACL;QAEA,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,GAAG;QACnB,MAAM,eAAe,IAAI,CAAC,YAAY;QACtC,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAEzG,IAAI,CAAC,cAAc;QAEnB,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,GAAG,GAAG,WAAW;QAC9B,IAAI,CAAC,QAAQ;QAEb,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC;QACxC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAC1B,IAAI,CAAC,WAAW,WAAW;QAE3B,IAAI,CAAC,WAAW;YAAC;gBACb;gBACA;gBACA,UAAU;YACd;SAAE;QAEF,IAAI,CAAC,aAAa,QAAS,KAAK;YAC5B,QAAQ;YACR,QAAQ;gBAAC;gBAAG;gBAAG;aAAE;QACrB;IACJ;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC3C,IAAI,CAAC,IAAI,CAAC,gBACN;QAEJ,IAAI,CAAC,aAAc,QAAS,KAAK;YAC7B,QAAQ;YACR,QAAQ;gBAAC;gBAAG;gBAAG;aAAE;QACrB;QAEA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,GAAG;QAChC,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAE/H,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,aAAa,GAAG,GAAG,WAAW,IAAI,CAAC,UAAU;QAElD;;mEAE2D,GAE3D,IAAI,CAAC,QAAQ;QAEb,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,WAAW,WAAW,IAAI,CAAC,UAAU;QAC1C,IAAI,CAAC,UAAU,WAAW;QAE1B,IAAI,CAAC,SAAS,KAAK;YACf;YACA;YACA,UAAU;QACd;IACJ;IAEA,QAAS,CAAS,EAAE,CAAS,EAAQ;QAEjC,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAC/H,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,aAAa,MAAM,MAAM,WAAW,IAAI,CAAC,UAAU;QACxD,IAAI,CAAC,QAAQ;QAEb,IAAI,CAAC,iBAAiB;QAEtB,IAAI,IAAI,CAAC,mBAAmB,gBAAgB,CAAC,IAAI,CAAC,aAAa;YAC3D,wCAAwC;YACxC,IAAI,WAAW,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC/B,IAAI,CAAC,SAAS,QAAQ,CAAA;gBAClB,IAAI,KAAK,WAAW,SAAS,UACzB,WAAW;YAEnB;YAEA,IAAI,CAAC,QAAQ;YACb,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,SAAS,UAAU,GAAG;YACzC,MAAM,eAAe,IAAI,CAAC,YAAY;YACtC,IAAI,CAAC,QAAQ,SAAS,GAAG,SAAS,GAAG,WAAW,cAAc;YAC9D,IAAI,CAAC,QAAQ;QACjB;QAEA,IAAI,CAAC,aAAa;QAElB,IAAI,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,aAAa,QAAS,KAAK;gBAC5B,QAAQ;gBACR,QAAQ;oBAAC;oBAAG;iBAAE;YAClB;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;QAEA,IAAI,CAAC,cAAc;QACnB,IAAI,CAAC,WAAW,EAAE;IACtB;IAGA,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QACnE,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAE1B,IAAI,IAAI,CAAC,kBAAkB,OAAO,WAC9B;QAGJ,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,iBAAiB;YAAC,GAAE;YAAI,GAAE;QAAE,GAAG;YAAC,GAAE;YAAI,GAAE;QAAE;QAC3D,MAAM,YAAY,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,KAAK,IAAI;QACvE,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;QACvB,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;QACvB,IAAI;QACJ,MAAM,QAAQ,IAAI,CAAC,cAAc,IAAI,CAAC;QACtC,IAAI,CAAC,kBAAkB,IAAI,CAAC,cAAc,IAAI,CAAC;QAC/C,IAAI,CAAC,QAAQ;QACb,IAAK,WAAW,IAAI,CAAC,iBAAiB,YAAY,WAAW,YAAY,MACrE,IAAI,CAAC,QAAQ,KAAK,KAAK,UAAU,KAAK,KAAK,UAAU,IAAI,CAAC,aAAa,IAAI,CAAC,gBAAgB;QAEhG,IAAI,CAAC,QAAQ;QAGb,MAAM,eAAsC;YACxC,MAAM;gBAAC;gBAAS;aAAW;YAC3B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAA0B;gBAC5C;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAuB;gBACzC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAY;gBAC9B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAa;gBAC/B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAsB;gBACxC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC;wBAAI;wBAAI;wBAAI;qBAAG;gBAC5B;aACH;QACL;QACA,IAAI,CAAC,QAAQ,KAAK;IACtB;IAEA,IAAI;IACJ,YAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,KAAK;IACL,SAAU,CAAS,EAAQ;QACvB,IAAI,IAAI,CAAC,mBAAmB,GACxB;QAEJ,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC;IACT;IAEA,SAAU,CAAO,EAAQ;QACrB,IAAI,IAAI,CAAC,iBAAiB,GACtB;QAEJ,IAAI,CAAC,eAAe;YAAC,GAAG,EAAE;YAAG,GAAG,EAAE;YAAG,GAAG,EAAE;QAAC;QAC3C,IAAI,CAAC,kBAAkB,SAAS,IAAI,CAAC,aAAa,IAAI,MAAM,IAAI,CAAC,aAAa,IAAI,MAAM,IAAI,CAAC,aAAa,IAAI;QAC9G,IAAI,CAAC;IACT;IAEA,WAAY,CAA2B,EAAQ;QAC3C,IAAI,CAAC,UAAU;IACnB;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,cAAc;IACvB;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,yBAAyB;IAClC;IAEA,gBAAiB,CAAU,EAAQ;QAC/B,IAAI,CAAC,4BAA4B;IACrC;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,wBAAwB;IACjC;IAEA,KAAK;IACL,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;;;gDCtea;AAFb;AAEO,MAAM,aAAkC,EAAE,EAAE,uBAAuB;AAC1E,UAAU,CAAC,EAAE,GAAG,CAAA,GAAA,4BAAc,EAAE;AAChC,UAAU,CAAC,EAAE,GAAG,CAAA,GAAA,4BAAc,EAAE;;;;;ACAhC,QAAQ;AACR,qDAAgB;AA+ChB,cAAc;AACd,qDAAgB;AArDhB;AACA;AAIO,SAAS,gBAAiB,CAAS;IAEtC,MAAM,WAAW,IAAI;IACrB,MAAM,IAAI;IACV,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;IAC5B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;IACnB,MAAM,SAAS,IAAI,gBAAgB,GAAG;IACtC,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;QACxB,MAAM,IAAI,AAAC,CAAA,IAAI,IAAI,CAAA,IAAK;QAExB,aAAa;QACb,MAAM,QAAQ,WAAW,CAAA,GAAA,aAAI,EAAE,SAAS,IAAI,KAAK,UAAU,IAAI,KAAK,YAAY;QAChF,IAAI,eAAe,MAAM,AAAC,CAAA,CAAA,GAAA,aAAI,EAAE,SAAS,IAAI,KAAK,OAAO,IAAI,KAAK,SAAS,CAAA,IAAK,IAAI;QACpF,gBAAgB,AAAC,CAAA,CAAA,GAAA,aAAI,EAAE,SAAS,IAAI,KAAK,UAAU,IAAI,KAAK,YAAY,CAAA,IAAK,IAAI;QAEjF,6BAA6B;QAC7B,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,GAAG,IAAI,GAAG,GAAG;QAC5C,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,MACf,IAAK,CAAA,AAAC,CAAA,aAAc,IAAI,GAAG,IAAM,CAAA,IAAI,EAAC,IAAK,CAAA,GAAA,aAAI,EAAE,SAAS,IAAI,KAAK,OAAO,IAAI,KAAK,MAAK,GACxF,GACA;QACJ,eAAe,eAAe;QAE9B,yBAAyB;QACzB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,aAAa,GAAG,GAAG,KAAK;QACtD,eAAe,eAAe;QAE9B,OAAO,IAAI,CAAC,EAAE,GAAG;QACjB,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG;QACrB,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG;QACrB,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc,GAAG;IACnD;IAGJ,IAAI,aAAa,QAAQ,GAAG;IAC5B,OAAO;AACX;AAEA,wCAAwC;AACxC,SAAS,UAAY,CAAY,EAAE,CAAY,EAAE,CAAY;IACzD,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,GAAG;IAC1B,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,GAAG;IAC1B,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,MAAO,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,IAAG,MAAM,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,IAAG,KAAK,KAAK;IAClE,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,IAAI,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,IAAI;AACvD;AAGO,SAAS,gBAAiB,CAAS;IAEtC,MAAM,QAAQ,IAAI;IAClB,IAAI,aAAa,IAAI;IACrB,IAAI,iBAAiB,IAAI;IACzB,cAAc;IACd,kBAAkB;IAClB,MAAM,KAAK;QAAC,GAAG,QAAQ;QAAG,GAAG,IAAK,IAAI;IAAM;IAC5C,MAAM,KAAK;QAAC,GAAG,IAAK,IAAI;QAAQ,GAAG,QAAQ;IAAC;IAE5C,MAAM,IAAI;IACV,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;IAC5B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;IACnB,MAAM,SAAS,IAAI,gBAAgB,GAAG;IACtC,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;QACxB,MAAM,IAAI,AAAC,CAAA,IAAI,IAAI,CAAA,IAAK;QAExB,IAAI,MAAM,UAAU;YAAC,GAAG;YAAG,GAAG;QAAC,GAAG,IAAI;QAEtC,MAAM,CAAA,GAAA,MAAC,EAAE,MACL,MAAO,AAAC,CAAA,MAAO,IAAI,UAAU,IAAM,CAAA,IAAI,cAAa,IAAK,KACzD,GACA;QAGJ,OAAO,IAAI,CAAC,EAAE,GAAG;QACjB,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG;QACrB,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG;QACrB,OAAO,IAAI,CAAC,IAAI,EAAE,GAAG;IACzB;IAGJ,IAAI,aAAa,QAAQ,GAAG;IAC5B,OAAO;AACX;;;ACxFA;;;;;;;;;;;;;;CAcC;;2CAsSY;AApSb,MAAM,WAAW,CAAC;AAElB,MAAM;IACF,YAAoB,GAAkB,GAAkB,EAAU;iBAA9C;iBAAkB;iBAAkB;IAAW;IAEnE,KAAM,CAAS,EAAE,CAAS,EAAU;QAChC,OAAO,IAAI,CAAC,IAAE,IAAI,IAAI,CAAC,IAAE;IAC7B;AACJ;AACA;;;EAGE,GAEF,MAAM,QAAQ;IAAC,IAAI,KAAK,GAAE,GAAE;IAAG,IAAI,KAAK,IAAG,GAAE;IAAG,IAAI,KAAK,GAAE,IAAG;IAAG,IAAI,KAAK,IAAG,IAAG;IAC5E,IAAI,KAAK,GAAE,GAAE;IAAG,IAAI,KAAK,IAAG,GAAE;IAAG,IAAI,KAAK,GAAE,GAAE;IAAI,IAAI,KAAK,IAAG,GAAE;IAChE,IAAI,KAAK,GAAE,GAAE;IAAG,IAAI,KAAK,GAAE,IAAG;IAAG,IAAI,KAAK,GAAE,GAAE;IAAI,IAAI,KAAK,GAAE,IAAG;CAAI;AAExE,MAAM,IAAI;IAAC;IAAI;IAAI;IAAI;IAAG;IAAG;IACzB;IAAI;IAAG;IAAI;IAAG;IAAG;IAAG;IAAI;IAAI;IAAE;IAAI;IAAI;IAAG;IAAI;IAAG;IAAG;IAAI;IAAE;IAAG;IAAG;IAAI;IAAG;IAAG;IACzE;IAAK;IAAE;IAAI;IAAI;IAAI;IAAI;IAAG;IAAE;IAAG;IAAI;IAAG;IAAG;IAAI;IAAI;IAAI;IAAI;IAAG;IAAG;IAAG;IAAG;IAAI;IACzE;IAAG;IAAI;IAAI;IAAG;IAAG;IAAI;IAAG;IAAI;IAAI;IAAI;IAAK;IAAG;IAAI;IAAG;IAAI;IAAG;IAAI;IAAI;IAAG;IAAG;IACxE;IAAG;IAAI;IAAI;IAAI;IAAG;IAAI;IAAI;IAAI;IAAG;IAAI;IAAI;IAAI;IAAI;IAAI;IAAG;IAAG;IAAG;IAAG;IAAI;IAAG;IACxE;IAAI;IAAI;IAAI;IAAG;IAAG;IAAG;IAAK;IAAE;IAAI;IAAG;IAAG;IAAI;IAAG;IAAI;IAAI;IAAK;IAAG;IAAG;IAAI;IAAI;IACxE;IAAI;IAAI;IAAI;IAAI;IAAI;IAAG;IAAI;IAAI;IAAI;IAAI;IAAI;IAAK;IAAE;IAAG;IAAG;IAAI;IAAI;IAAI;IAAI;IACxE;IAAE;IAAI;IAAG;IAAI;IAAI;IAAI;IAAI;IAAG;IAAG;IAAI;IAAI;IAAI;IAAG;IAAI;IAAG;IAAG;IAAG;IAAG;IAAI;IAAI;IAAG;IACzE;IAAI;IAAI;IAAI;IAAI;IAAI;IAAI;IAAK;IAAE;IAAG;IAAI;IAAK;IAAG;IAAI;IAAI;IAAI;IAAI;IAAK;IAAG;IAAI;IAC1E;IAAI;IAAG;IAAG;IAAK;IAAG;IAAG;IAAI;IAAI;IAAG;IAAI;IAAI;IAAI;IAAI;IAAK;IAAI;IAAI;IAAI;IAAI;IAAG;IACxE;IAAI;IAAG;IAAI;IAAI;IAAI;IAAI;IAAI;IAAG;IAAI;IAAI;IAAI;IAAK;IAAG;IAAG;IAAI;IAAI;IAAI;IAAG;IAAI;IACxE;IAAG;IAAI;IAAK;IAAG;IAAI;IAAI;IAAI;IAAI;IAAK;IAAG;IAAI;IAAI;IAAI;IAAI;IAAG;IAAG;IAAK;IAAE;IAAI;IACxE;IAAI;IAAI;IAAI;IAAG;IAAI;IAAI;IAAG;IAAG;IAAG;IAAG;IAAI;IAAI;IAAI;IAAI;IAAG;IAAG;IAAI;IAAG;IAAI;CAAI;AAC5E,6EAA6E;AAC7E,MAAM,OAAO,IAAI,MAAM;AACvB,MAAM,QAAQ,IAAI,MAAM;AAExB,6EAA6E;AAC7E,wEAAwE;AACxE,SAAS,OAAO,SAAU,IAAY;IAClC,IAAI,OAAO,KAAK,OAAO,GACnB,qBAAqB;IACrB,QAAQ;IAGZ,OAAO,KAAK,MAAM;IAClB,IAAI,OAAO,KACP,QAAQ,QAAQ;IAGpB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK;QAC1B,IAAI;QACJ,IAAI,IAAI,GACJ,IAAI,CAAC,CAAC,EAAE,GAAI,OAAO;aAEnB,IAAI,CAAC,CAAC,EAAE,GAAI,AAAC,QAAM,IAAK;QAG5B,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,IAAI,IAAI,GAAG;QAC1B,KAAK,CAAC,EAAE,GAAG,KAAK,CAAC,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,GAAG;IAC7C;AACJ;AAEA,SAAS,KAAK;AAEd;;;;CAIC,GAED,2DAA2D;AAC3D,MAAM,KAAK,MAAK,CAAA,KAAK,KAAK,KAAG,CAAA;AAC7B,MAAM,KAAK,AAAC,CAAA,IAAE,KAAK,KAAK,EAAC,IAAG;AAE5B;aACa,GAEb,mBAAmB;AACnB,SAAS,WAAW,SAAU,GAAW,EAAE,GAAW;IAClD,IAAI,IAAI,IAAI,IAAI,6CAA6C;IAC7D,gEAAgE;IAChE,MAAM,IAAI,AAAC,CAAA,MAAI,GAAE,IAAG,IAAI,sBAAsB;IAC9C,IAAI,IAAI,KAAK,MAAM,MAAI;IACvB,IAAI,IAAI,KAAK,MAAM,MAAI;IACvB,MAAM,IAAI,AAAC,CAAA,IAAE,CAAA,IAAG;IAChB,MAAM,KAAK,MAAI,IAAE,GAAG,oDAAoD;IACxE,MAAM,KAAK,MAAI,IAAE;IACjB,iEAAiE;IACjE,qCAAqC;IACrC,IAAI,IAAI,IAAI,gEAAgE;IAC5E,IAAI,KAAG,IAAI;QACP,KAAG;QAAG,KAAG;IACb,OAAO;QACH,KAAG;QAAG,KAAG;IACb;IACA,kEAAkE;IAClE,oEAAoE;IACpE,oBAAoB;IACpB,MAAM,KAAK,KAAK,KAAK,IAAI,qDAAqD;IAC9E,MAAM,KAAK,KAAK,KAAK;IACrB,MAAM,KAAK,KAAK,IAAI,IAAI,IAAI,mDAAmD;IAC/E,MAAM,KAAK,KAAK,IAAI,IAAI;IACxB,oEAAoE;IACpE,KAAK;IACL,KAAK;IACL,MAAM,MAAM,KAAK,CAAC,IAAE,IAAI,CAAC,EAAE,CAAC;IAC5B,MAAM,MAAM,KAAK,CAAC,IAAE,KAAG,IAAI,CAAC,IAAE,GAAG,CAAC;IAClC,MAAM,MAAM,KAAK,CAAC,IAAE,IAAE,IAAI,CAAC,IAAE,EAAE,CAAC;IAChC,oDAAoD;IACpD,IAAI,KAAK,MAAM,KAAG,KAAG,KAAG;IACxB,IAAI,KAAG,GACH,KAAK;SACF;QACH,MAAM;QACN,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI,KAAM,sCAAsC;IAC5E;IACA,IAAI,KAAK,MAAM,KAAG,KAAG,KAAG;IACxB,IAAI,KAAG,GACH,KAAK;SACF;QACH,MAAM;QACN,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI;IAChC;IACA,IAAI,KAAK,MAAM,KAAG,KAAG,KAAG;IACxB,IAAI,KAAG,GACH,KAAK;SACF;QACH,MAAM;QACN,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI;IAChC;IACA,mEAAmE;IACnE,gEAAgE;IAChE,OAAO,KAAM,CAAA,KAAK,KAAK,EAAC;AAC5B;AAgKO,MAAM,QAAQ;;;;;ACxRrB,gDAAa;AA5Bb;AAIA;AAQA,MAAM,WAAW;AAgBV,MAAM;IA8BD,mBAAoB,MAAe,EAAQ;QAC/C,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,cAAc;IAC3D;IAEQ,gBAAyB;QAC7B,OAAO,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,QAAQ;IACjD;IAEA;;;KAGC,GACD,AAAQ,mBAA0B;QAC9B,IAAI,CAAC,IAAI,CAAC,cACN;QAGJ,MAAM,QAA2B,IAAI,CAAC,MAAM,IAAI,IAAM;QACtD,MAAM,eAAe,IAAI,CAAC,gBAAgB,IAAI,CAAC;QAC/C,aAAa,QAAQ,CAAC,WAAW;YAC7B,IAAI,WACA,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM;QAExC;QACA,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,eAAe;IACxB;IAEQ,gBAAiB,MAAe,EAAa;QACjD,MAAM,eAAe,IAAI,CAAC,MAAM,IAAI,IAAM;QAC1C,MAAM,SAAS,IAAI,CAAC;QACpB,SAAS;YACL,IAAI,KAAK,MAAM,OAAO,KAAK;YAC3B,IAAI,KAAK,MAAM,OAAO,KAAK;YAC3B,IAAI,KAAK,MAAM,OAAO,KAAK;YAC3B,IAAI,KAAK,MAAM,OAAO,KAAK;QAC/B;QACA,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,OAAO,IAAI,IACpC,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,OAAO,IAAI,IACpC,YAAY,CAAC,IAAI,SAAS,EAAE,GAAG;QAGvC,OAAO;IACX;IAEA;;;;KAIC,GACD,AAAQ,YAAa,MAAe,EAAsC;QACtE,MAAM,SAAS,IAAI,CAAC;QACpB,MAAM,SAA6C,EAAE;QACrD,MAAM,eAAe,IAAI,CAAC,gBAAgB;QAE1C,aAAa,QAAQ,CAAC,MAAM;YACxB,IAAI,CAAC,MACD;YAGJ,MAAM,cAAc,AAAC,IAAI,SAAU;YACnC,MAAM,cAAc,KAAK,MAAM,IAAI,UAAU;YAC7C,MAAM,YAAY,IAAI,CAAC,KAAK,CAAC,EAAE,CAAE;YACjC,MAAM,aAAa,IAAI,CAAC,KAAK,CAAC,EAAE,CAAE;YAElC,MAAM,eAAe;gBACjB,IAAI,KAAK,IAAI,GAAG,OAAO,KAAK;gBAC5B,IAAI,KAAK,IAAI,GAAG,OAAO,KAAK;gBAC5B,IAAI,KAAK,IAAI,YAAY,GAAG,OAAO,KAAK;gBACxC,IAAI,KAAK,IAAI,aAAa,GAAG,OAAO,KAAK;YAC7C;YACA,IAAI,aAAa,KAAK,aAAa,MAAM,aAAa,KAAK,aAAa,IACpE;YAEJ,OAAO,KAAK;gBACR,OAAO;gBACP,QAAQ;YACZ;QACJ;QAEA,OAAO;IACX;IAEA;;KAEC,GACD,AAAQ,eAAgB,MAA2B,EAAQ;QACvD,IAAI,CAAC,QACD;QAGJ,MAAM,eAAe,IAAI,CAAC,gBAAgB;QAC1C,MAAM,SAAS,IAAI,CAAC;QAEpB,aAAa,QAAQ,CAAC,MAAM;YACxB,IAAI,CAAC,QAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,EACtB,iCAAiC;YACjC;YAEJ,MAAM,IAAI,IAAI;YACd,MAAM,IAAI,KAAK,MAAM,IAAI;YACzB,MAAM,IAAI,AAAC,CAAA,KAAK,IAAI,IAAI,WAAW,UAAU,IAAI,CAAC,QAAQ,OAAO,SAAS,CAAA,IAAK,WAAW;YAC1F,MAAM,IAAI,AAAC,CAAA,KAAK,IAAI,IAAI,WAAW,UAAU,IAAI,CAAC,QAAQ,OAAO,UAAU,CAAA,IAAK,WAAW;YAE3F,wEAAwE;YACxE,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;YAC/B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI;YACtB,OAAO,UAAU,IAAI,CAAC,QAAQ,QAAQ,CAAC,IAAI,UAAU,CAAC,IAAI;YAE1D,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,OAAO,aAAa,GAAG,GAAG,GAAG;QACjD;IACJ;IAEQ,WAAY,CAAS,EAAE,CAAS,EAAE,IAAY,EAAS;QAE3D,OAAO,KAAK,IAAI,KAAK,OAAO;QAC5B,MAAM,KAAK,KAAK,IAAI,GAAG,KAAK,MAAM,IAAI;QACtC,MAAM,KAAK,KAAK,IAAI,GAAG,KAAK,MAAM,IAAI;QACtC,MAAM,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,KAAK,KAAK,IAAI;QACjE,MAAM,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG,KAAK,KAAK,IAAI;QAClE,IAAI,KAAK,MAAM,KAAK,IAChB,OAAO;YACH,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG;QACP;QAGJ,IAAI,KAAK,GAAG,KAAK,GAAG,KAAK,GAAG,KAAK,GAAG;QAEpC,MAAM,eAAe,IAAI,CAAC,YAAY;YAAE;YAAI;YAAI;YAAI;QAAG;QACvD,aAAa,QAAQ,CAAA;YACjB,MAAM,QAAQ,IAAI,CAAC,KAAK,CAAC,MAAM,MAAM,CAAE;YACvC,MAAM,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,MAAM,CAAE;YACtC,MAAM,SAAS,MAAM;YAErB,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,OAAO,IAAI,KAAK,EACzC,IAAK,IAAI,IAAI,OAAO,IAAI,KAAK,IAAI,QAAQ,IAAI,OAAO,KAAK,GAAG,KAAK,OAAO,IAAI,KAAK,GAAG,MAAM,GAAO;gBAC7F,QAAQ,IAAI,CAAC,KAAK,EAAE;gBACpB,MAAM,IAAI,CAAC,GAAG,GAAG;gBACjB,MAAM,IAAI,CAAC,KAAK,EAAE,GAAG;gBACrB,MAAM,IAAI,CAAC,KAAK,EAAE,GAAG;gBACrB,MAAM;YACV;QAER;QAEA,IAAI,OAAO,GAAG;YACV,MAAM;YACN,MAAM;YACN,MAAM;YACN,KAAK,KAAK,IAAI,GAAG;QACrB;QACA,OAAO;YACH,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG;QACP;IACJ;IAEQ,QAAS,CAAS,EAAE,CAAS,EAAE,IAAY,EAAuB;QACtE,OAAO,KAAK,IAAI,KAAK;QACrB,MAAM,KAAK,KAAK,IAAI,GAAG,KAAK,MAAM,IAAI;QACtC,MAAM,KAAK,KAAK,IAAI,GAAG,KAAK,MAAM,IAAI;QACtC,MAAM,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,KAAK,KAAK,IAAI;QACjE,MAAM,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG,KAAK,KAAK,IAAI;QAClE,IAAI,KAAK,MAAM,KAAK,IAChB,OAAO;QAEX,OAAO;YAAE;YAAI;YAAI;YAAI;QAAG;IAC5B;IAEQ,QAAS,MAAuB,EAAQ;QAC5C,uDAAuD;QACvD,IAAI,QAAQ;QACZ,MAAM,UAAU,OAAO,OAAO,KAAK,OAAO,KAAK,4CAA4C;QAC3F,MAAM,UAAoB,EAAE;QAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,IACzB,OAAO,CAAC,EAAE,GAAG,AAAC,CAAA,KAAK,WAAW,GAAE,IAAK,QAAQ;QAGjD,0CAA0C;QAC1C,MAAM,YAAY;YAAC;YAAE;YAAE;YAAE;YAAE;YAAE;YAAE;YAAE;YAAE;YAAE;SAAE,EAAE,0BAA0B;QACnE,MAAM,UAAU,SAAS,CAAC,KAAK,MAAM,OAAO,OAAO,GAAG;QACtD,MAAM,iBAAyB,UAAU,UAAU,UAAU;QAC7D,MAAM,gBAA0B,EAAE;QAClC,IAAI,SAAS;YACT,IAAI,IAAI;YACR,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,IACzB,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,KAAK,KAAK,EAAG;gBACtC,aAAa,CAAC,EAAE,GAAG,AAAC,CAAA,IAAI,CAAA,IAAK,SAAS,WAAW;gBACjD,aAAa,CAAC,IAAI,EAAE,GAAG,AAAC,CAAA,IAAI,CAAA,IAAK,SAAS,WAAW;YACzD;QAER;QAEA,MAAM,YAAY,KAAK,IAAI,OAAO,SAAS,KAAK;QAChD,2BAA2B;QAC3B,MAAM,eAAe,IAAI;QACzB,MAAM,sBAAsB,YAAY;QACxC,MAAM,cAAc,OAAO,OAAO,OAAO;QACzC,MAAM,cAAc,cAAc,eAAe,OAAO;QACxD,MAAM,eAAe,AAAC,CAAA,IAAI,mBAAkB,IAAK,OAAO;QAGxD,MAAM,eAAe,IAAI,CAAC,YAAY;YAClC,IAAI,OAAO;YACX,IAAI,OAAO;YACX,IAAI,OAAO;YACX,IAAI,OAAO;QACf;QAEA,MAAM,SAAS,IAAI,CAAC;QACpB,aAAa,QAAQ,CAAA;YACjB,MAAM,cAAc,AAAC,MAAM,QAAQ,SAAU;YAC7C,MAAM,cAAc,KAAK,MAAM,MAAM,QAAQ,UAAU;YACvD,MAAM,YAAY,IAAI,CAAC,KAAK,CAAC,MAAM,MAAM,CAAE;YAC3C,MAAM,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,MAAM,CAAE;YAEtC,0BAA0B;YAC1B,0BAA0B;YAE1B,2BAA2B;YAE3B,mDAAmD;YACnD,mDAAmD;YAEnD,IAAK,IAAI,IAAI,MAAM,OAAO,IAAI,KAAK,IAAI,cAAc,OAAO,GAAG,KAAK,MAAM,OAAO,IAAI,KAAK,KACtF,IACI,IAAI,IAAI,MAAM,OAAO,IACjB,KAAK,IAAI,YAAY,IAAI,MAAM,OAAO,KAAK,GAC3C,KAAK,IAAI,cAAc,OAAO,GAClC,KAAK,MAAM,OAAO,IAClB,KACI,MAAM,GACN,KACN;gBACE,wBAAwB;gBACxB,qBAAqB;gBAErB,IAAI,SAAS;gBACb,IAAI,gBAAgB;oBAChB,IAAK,IAAI,IAAI,GAAG,IAAI,cAAc,QAAQ,KAAK,EAAG;wBAC9C,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,WAAW,KAAK,aAAa,CAAC,EAAE,EAAE,KAAK,aAAa,CAAC,IAAI,EAAE;wBAC3E,IAAI,QAAQ,aACR;wBAEJ,UAAU,CAAA,GAAA,WAAI,EAAE,eAAe,OAAO,aAAa,GAAG,OAAO;oBACjE;oBACA,IAAI,CAAC,QACD;oBAEJ,UAAU;gBACd,OAAO;oBACH,sEAAsE;oBACtE,MAAM,OAAO,KAAK,IAAI,IAAI,KAAK,KAAK,IAAI,IAAI;oBAC5C,IAAI,QAAQ,aACR;oBAEJ,SAAS,CAAA,GAAA,WAAI,EAAE,eAAe,OAAO,aAAa,GAAG,OAAO;gBAChE;gBAEA,MAAM,YAAY,IAAI;gBACtB,MAAM,SAAQ,IAAI,CAAC,KAAK,EAAE,GAAG;gBAE7B,IAAI,IAAI,CAAC,uBAAuB;oBAC5B,MAAM,SAAS,AAAC,OAAO,IAAI,SAAW,AAAC,IAAI,CAAC,GAAG,GAAI;oBACnD,MAAM,SAAS,AAAC,OAAO,IAAI,SAAW,AAAC,IAAI,CAAC,KAAK,EAAE,GAAI;oBACvD,MAAM,SAAS,AAAC,OAAO,IAAI,SAAW,AAAC,IAAI,CAAC,KAAK,EAAE,GAAI;oBACvD,IAAI,QAAQ;wBACR,IAAI,CAAC,GAAG,GAAG,KAAK,MAAM,SAAS,OAAO,CAAC,MAAM;wBAC7C,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,SAAS,OAAO,CAAC,MAAM;wBACjD,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,SAAS,OAAO,CAAC,MAAM;oBACrD;gBACJ,OAAO;oBACH,MAAM,SAAS,AAAC,OAAO,IAAI,SAAW,AAAC,IAAI,CAAC,GAAG,GAAG,SAAU;oBAC5D,MAAM,SAAS,AAAC,OAAO,IAAI,SAAW,AAAC,IAAI,CAAC,KAAK,EAAE,GAAG,SAAU;oBAChE,MAAM,SAAS,AAAC,OAAO,IAAI,SAAW,AAAC,IAAI,CAAC,KAAK,EAAE,GAAG,SAAU;oBAEhE,MAAM,WAAW,IAAI,YAAa,CAAA,IAAI,MAAK;oBAC3C,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,KAAK,IAAI,KAAK,WAAW,OAAO;oBAC1D,IAAI,UAAU;wBACV,IAAI,CAAC,GAAG,GAAG,KAAK,MAAM,SAAU,WAAY,OAAO,CAAC,MAAM;wBAC1D,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,SAAU,WAAY,OAAO,CAAC,MAAM;wBAC9D,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,SAAU,WAAY,OAAO,CAAC,MAAM;oBAClE;gBACJ;gBACA,QAAQ,AAAC,CAAA,QAAQ,CAAA,IAAK;YAE1B;QAGR;IACJ;IAEQ,YAAa,IAAY,EAAU;QACvC,OAAO,CAAA,GAAA,MAAC,EAAE,IACN,AAAC,OAAO,IAAK,GACb,AAAC,OAAO,IAAK,GACb,CAAA,GAAA,WAAI,EAAE,AAAC,CAAA,OAAO,GAAE,IAAM,KAAW,GAAG;IAE5C;IAEQ,aAAc,CAAqB,EAAE,CAAqB,EAAE,CAAS,EAAE,WAAoB,EAAQ;QAEvG,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI;QACJ,IAAI;QACJ,IAAI,YAAY,AAAC,IAAI,CAAC,sBAAuB,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,GAAG,IAAI,CAAC;QAE3F,MAAM,QAAQ,IAAI,CAAC,YAAY;QAE/B,MAAM,OAAO,AAAC,MAAM,YAAa,IAAI,CAAC,UAAU,IAAI;QACpD,MAAM,OAAO,AAAC,MAAM,YAAa,IAAI,CAAC,UAAU,IAAI;QAEpD,IAAI;QAEJ,IAAI,IAAI,CAAC,aAAa,GAAG;YACrB,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM;YAC3B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM;YAC3B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM;QAC/B,OAAO;YACH,IAAI;YACJ,IAAI,aACA,UAAU;gBAAC,GAAG,IAAI,CAAC,YAAY;gBAAG,GAAG,IAAI,CAAC,YAAY;gBAAG,GAAG,IAAI,CAAC,YAAY;gBAAG,GAAG;YAAC;iBACjF;gBACH,MAAM,YAAY;oBAAC;oBAAM;oBAAQ,IAAI,CAAC,sBAAuB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;iBAAO;gBACtH,MAAM,SAAS,IAAI,CAAC,QAAQ,SAAS,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE;gBACpE,IAAI,QACA,IAAI,CAAC,eAAe;gBAExB,UAAU,IAAI,CAAC,WAAW,SAAS,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE;YACtE;YACA,cAAc;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YAErC,IAAI,QAAQ,IAAI,KAAK,IAAI,CAAC,SAAS,MAAM,GAAG;gBACxC,IAAI,CAAC,SAAS,IAAI,QAAQ;gBAC1B,IAAI,CAAC,SAAS,IAAI,QAAQ;gBAC1B,IAAI,CAAC,SAAS,IAAI,QAAQ;gBAC1B,IAAI,CAAC,SAAS,IAAI,QAAQ;gBAC1B,YAAY,IAAI,IAAI,CAAC,SAAS;gBAC9B,YAAY,IAAI,IAAI,CAAC,SAAS;gBAC9B,YAAY,IAAI,IAAI,CAAC,SAAS;gBAC9B,YAAY,IAAI,IAAI,CAAC,SAAS;YAElC,OAAO;gBACH,IAAI,QAAQ,MAAM,GAAG;oBACjB,QAAQ,IAAI,IAAI,CAAC,MAAM;oBACvB,QAAQ,IAAI,IAAI,CAAC,MAAM;oBACvB,QAAQ,IAAI,IAAI,CAAC,MAAM;oBACvB,QAAQ,IAAI,IAAI,IAAI,CAAC;gBACzB;gBAEA,IAAI,CAAC,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG,QAAQ,GAAG,IAAI,CAAC,WAAW,QAAQ;gBACrG,IAAI,CAAC,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG,QAAQ,GAAG,IAAI,CAAC,WAAW,QAAQ;gBACrG,IAAI,CAAC,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS,GAAG,QAAQ,GAAG,IAAI,CAAC,WAAW,QAAQ;gBACrG,IAAI,CAAC,SAAS,IAAI,KAAK,IAAI,GAAG,IAAI,CAAC,SAAS,IAAI,QAAQ;gBACxD,YAAY,IAAI,IAAI,CAAC,SAAS;gBAC9B,YAAY,IAAI,IAAI,CAAC,SAAS;gBAC9B,YAAY,IAAI,IAAI,CAAC,SAAS;gBAC9B,YAAY,IAAI,IAAI,CAAC,SAAS;YAClC;QAEJ;QAGA,MAAM,iBAAuC,CAAC;YAC1C,IAAI,IAAI,CAAC,YAAY,KAAK,IAAI,CAAC,SAAS,KAAK,GACzC;YAEJ,MAAM,SAAS,IAAI;YACnB,gBAAgB,IAAI,CAAC,WAAW,WAAY,CAAA,IAAI,MAAK,IAAK,IAAI;YAC9D,eAAe,AAAC,IAAI,CAAC,yBAA2B,IAAI,CAAC,UAAU,gBAAgB,gBAAiB,IAAI,CAAC;YACrG,YAAY,AAAC,IAAI,CAAC,sBAAuB,KAAK,IAAI,KAAK,gBAAgB,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;YACvG,IAAI,IAAI,CAAC,YAAY,GAAG;gBACpB,IAAI,CAAC,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,YAAY,GAAG,YAAY,GAAG;gBAC1D,IAAI,CAAC,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,YAAY,GAAG,YAAY,GAAG;gBAC1D,IAAI,CAAC,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,YAAY,GAAG,YAAY,GAAG;YAC9D;YACA,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,YAAY,MAAM,GAAG;gBACjD,IAAI,CAAC,OAAO,IAAI,YAAY;gBAC5B,IAAI,CAAC,OAAO,IAAI,YAAY;gBAC5B,IAAI,CAAC,OAAO,IAAI,YAAY;YAChC;YACA,MAAM,SAAS,IAAI,CAAC,QAAQ,IAAI,GAAG,IAAI,GAAG;YAC1C,IAAI,QAAQ;gBACR,IAAI,CAAC,mBAAmB;gBACxB,IAAI,CAAC,WAAW,KAAK;oBACjB,GAAG,IAAI;oBACP,GAAG,IAAI;oBACP,MAAM;oBACN,SAAS;oBACT,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC5C,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC5C,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBAChD;YACJ;QACJ;QAEA,IAAI,MAAM,aAAa,MAAM,WACzB,IAAI,CAAC,WAAY,SAAS,OAAO;aAEjC,IAAI,CAAC,WAAY,IAAI,GAAG,GAAG,OAAO;QAGtC,IAAI,CAAC,eAAe,IAAI,CAAC;QACzB,IAAI,CAAC,WAAW,QAAQ,CAAA;YACpB,IAAI,CAAC,QAAQ;QACjB;QACA,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI,CAAC,cAAc;IACvB;IAMA,kBAAkB;IAClB,aAAe;aAtcP,YAAqB,MAAO,iEAAiE;;aAE7F,UAAoC,CAAC;aACrC,QAAc,CAAC;aACf,OAAe,GAAI,uBAAuB;;aAC1C,UAAkB,IAAK,MAAM;;aAC7B,WAAmB,KAAM,MAAM;;aAE/B,wBAAiC;aACjC,sBAA+B;aAC/B,yBAAkC;aAElC,WAAkB;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC,EAAG,YAAY;;aACxD,WAAmB,KAAM,YAAY;;aACrC,SAAe;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC,EAAG,YAAY;;aAC/C,cAAqB,CAAC,EAAY,YAAY;;aAE9C,YAAqB;aACrB,YAA4B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC,EAAG,YAAY;;aACnE,aAA6B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC,EAAG,YAAY;;aAMpE,QAAmC,EAAE;aACrC,aAAgC,EAAE;IA6a1C;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,OAAO;IAChB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,UAAU;IACnB;IAEA,cAAuB;QACnB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAa,CAAS,EAAQ;QAC1B,IAAI,CAAC,WAAW;IACpB;IAEA,SAAU,CAAO,EAAQ;QACrB,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,QAAQ;IAC5B;IAEA,WAAY,CAA2B,EAAQ;QAC3C,IAAI,CAAC,UAAU;IACnB;IAEA,gBAAiB,CAAU,EAAQ;QAC/B,IAAI,CAAC,sBAAsB;IAC/B;IAEA,mBAAoB,CAAU,EAAQ;QAClC,IAAI,CAAC,yBAAyB;IAClC;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,wBAAwB;IACjC;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,YAAY;IACrB;IAEA,UAAW,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC9C,IAAI,CAAC,eAAe;YAChB,MAAM;gBAAC;gBAAS;aAAa;YAC7B,SAAS,EAAE;QACf;QAGA,MAAM,aAAa,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,QAAQ,YAAY,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,SAAS;QAC5G,IAAI,CAAC,QAAQ,IAAI,OAAO,YAAY,MAAM,IAAI,IAAI,IAAM;QAExD,IAAI,CAAC,YAAY;QAEjB,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QAC5B,MAAM,eAAe,AAAC,IAAI,CAAC,yBAA2B,IAAI,CAAC,UAAU,IAAI,IAAK,IAAI,CAAC;QACnF,MAAM,YAAY,AAAC,IAAI,CAAC,sBAAuB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;QACjG,IAAI,IAAI,CAAC,aAAa,GAAG;YACrB,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM;YAC3B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM;YAC3B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM;QAC/B,OAAO;YACH,IAAI,CAAC,eAAe,IAAI,CAAC,QAAQ,GAAG,GAAG;YAEvC,MAAM,UAAU,IAAI,CAAC,WACjB,GACA,GACC,AAAC,IAAI,CAAC,sBAAuB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;YAEpF,IAAI,QAAQ,MAAM,GACd,IAAI,CAAC,WAAW;gBACZ,GAAG,IAAI,CAAC,MAAM;gBACd,GAAG,IAAI,CAAC,MAAM;gBACd,GAAG,IAAI,CAAC,MAAM;gBACd,GAAG,IAAI,IAAI,CAAC;YAChB;iBAEA,IAAI,CAAC,WAAW;gBACZ,GAAG,QAAQ;gBACX,GAAG,QAAQ;gBACX,GAAG,QAAQ;gBACX,GAAG,QAAQ;YACf;YAGJ,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS;YAC9B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS;YAC9B,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS;QAClC;QAEA,IAAI,CAAC,cAAc;YAAC,GAAG,IAAI,CAAC,OAAO;YAAG,GAAG,IAAI,CAAC,OAAO;YAAG,GAAG,IAAI,CAAC,OAAO;YAAG,GAAG,IAAI,CAAC,SAAS;QAAC;QAE5F,IAAI,CAAC,eAAe;QACpB,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI,IAAI,CAAC,WAAW,KAAK,IAAI,CAAC,SAAS,IAAI,GAAG;YAC1C,MAAM,SAAS,IAAI,CAAC,QAAQ,GAAG,GAAG;YAClC,IAAI,QAAQ;gBACR,IAAI,CAAC,mBAAmB;gBACxB,IAAI,CAAC,WAAW,KAAK;oBACjB,GAAG;oBACH,GAAG;oBACH,MAAM;oBACN,SAAS;oBACT,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC5C,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC5C,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBAChD;YACJ;QACJ;QAEA,IAAI,CAAC,eAAe,IAAI,CAAC;QACzB,IAAI,CAAC,WAAW,QAAQ,CAAA;YACpB,IAAI,CAAC,QAAQ;QACjB;QACA,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE;QACzB,IAAI,CAAC,WAAW,IAAI,GAAG,GAAG,GAAG,YAC7B;QAEA,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAC1B,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAElC,IAAI,CAAC,IAAI,CAAC,WACN,IAAI,CAAC;IAEb;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,WAAoB,EAAQ;QACjE,IAAI,CAAC,IAAI,CAAC,WACN;QAEJ,IAAI,CAAC,aAAa,GAAG,GAAG,IAAI,CAAC,UAAU,UAAU;QAEjD,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAClC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAE1B,IAAI,CAAC,IAAI,CAAC,WACN,IAAI,CAAC;IAEb;IAEA,UAAiB;QACb,IAAI,IAAI,CAAC,YACL,IAAI,CAAC,aAAa,WAAW,WAAW,IAAI,CAAC,UAAU,UAAU;QAGrE,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,aAAa;QAGlB,IAAI,CAAC;QAEL,IAAI,IAAI,CAAC,gBAAgB,IAAI,CAAC,WAAW,IAAI,CAAC,MAAM,KAAK,CAAA,OAAQ,CAAC,CAAC,OAAO;YACtE,IAAI,CAAC,aAAa,QAAQ,KAAK;gBAC3B,QAAQ;gBACR,QAAQ;oBAAC,IAAI,CAAC;iBAAM;YACxB;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;QACA,IAAI,CAAC,QAAQ,EAAE;IACnB;IAEA;;;KAGC,GACD,UAAW,KAAgC,EAAQ;QAC/C,MAAM,SAAS,IAAI,CAAC;QACpB,MAAM,QAAQ,CAAC,WAAW;YACtB,IAAI,CAAC,WACD;YAEJ,MAAM,cAAc,AAAC,QAAQ,SAAU;YACvC,MAAM,cAAc,KAAK,MAAM,QAAQ,UAAU;YACjD,IAAI,CAAC,QAAQ,aAAa,WAAW,aAAa;QACtD;IACJ;IAEA,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QACnE,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QAEnB,IAAI,IAAI,CAAC,aAAa,OAAO,WACzB;QAGJ,MAAM,aAAa,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,QAAQ,YAAY,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,SAAS;QAC5G,IAAI,CAAC,QAAQ,IAAI,OAAO,YAAY,MAAM,IAAI,IAAI,IAAM;QACxD,IAAI,CAAC,eAAe;QACpB,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI,CAAC,eAAe,IAAI,CAAC,QAAQ,IAAI,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC;QAC5D,MAAM,UAAU,IAAI,CAAC,WAAW,IAAI,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC;QAE3D,IAAI,QAAQ,MAAM,GACd,IAAI,CAAC,WAAW;YACZ,GAAG,IAAI,CAAC,MAAM;YACd,GAAG,IAAI,CAAC,MAAM;YACd,GAAG,IAAI,CAAC,MAAM;YACd,GAAG,IAAI,IAAI,CAAC;QAChB;aAEA,IAAI,CAAC,WAAW;YACZ,GAAG,QAAQ;YACX,GAAG,QAAQ;YACX,GAAG,QAAQ;YACX,GAAG,QAAQ;QACf;QAGJ,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,IAAK,CAAA,IAAI,IAAI,CAAC,SAAS,CAAA,IAAK,AAAC,CAAA,IAAI,CAAC,WAAW,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,IAAK,CAAA,IAAI,IAAI,CAAC,QAAO,CAAC,IAAK,IAAI,CAAC,SAAS;QAC9I,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,IAAK,CAAA,IAAI,IAAI,CAAC,SAAS,CAAA,IAAK,AAAC,CAAA,IAAI,CAAC,WAAW,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,IAAK,CAAA,IAAI,IAAI,CAAC,QAAO,CAAC,IAAK,IAAI,CAAC,SAAS;QAC9I,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,IAAK,CAAA,IAAI,IAAI,CAAC,SAAS,CAAA,IAAK,AAAC,CAAA,IAAI,CAAC,WAAW,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,IAAK,CAAA,IAAI,IAAI,CAAC,QAAO,CAAC,IAAK,IAAI,CAAC,SAAS;QAG9I,MAAM,IAAI;QACV,MAAM,eAAe,AAAC,IAAI,CAAC,yBAA2B,IAAI,CAAC,UAAU,IAAI,IAAK,IAAI,CAAC;QACnF,MAAM,YAAY,AAAC,IAAI,CAAC,sBAAuB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;QAGjG,MAAM,YAAY,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,KAAK,IAAI;QACvE,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;QACvB,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;QACvB,MAAM,QAAQ,IAAI,CAAC,YAAY;QAC/B,IAAK,IAAI,WAAW,GAAG,YAAY,WAAW,YAAY,MAAO;YAC7D,MAAM,SAAS,IAAI,CAAC,QAAQ,KAAK,KAAK,UAAU,KAAK,KAAK,UAAU;YACpE,IAAI,QAAQ;gBACR,IAAI,CAAC,eAAe;gBACpB,IAAI,CAAC,WAAW,KAAK;oBACjB,GAAG,KAAK,KAAK;oBACb,GAAG,KAAK,KAAK;oBACb,MAAM;oBACN,SAAS;oBACT,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,IAAI,OAAO;oBACX,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC5C,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC5C,GAAG,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBAChD;YACJ;QACJ;QACA,IAAI,CAAC,WAAW,QAAQ,CAAA;YACpB,IAAI,CAAC,QAAQ;QACjB;QACA,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,MAAM,KAAK,CAAA,OAAQ,CAAC,CAAC,OAAO;YACjD,IAAI,CAAC,UAAU,IAAI,CAAC;YACpB,IAAI,CAAC,eAAe;gBAChB,MAAM;oBAAC;oBAAS;iBAAa;gBAC7B,SAAS;oBAAC;wBACN,QAAQ;wBACR,QAAQ;4BAAC,IAAI,CAAC;yBAAM;oBACxB;iBAAE;YACN;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;QACA,IAAI,CAAC,QAAQ,EAAE;IACnB;AACJ;;;;;AC7vBA,kDAAa;AAbb;AAEA;AAQA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI;AACnC,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,IAAI;AAElB,MAAM;IA+BD,OAAgB;QACpB,IAAI,CAAC;QACL,OAAO,KAAK,IAAI,eAAe,KAAK,IAAI,IAAI,CAAC,cAAc,cAAc,MAAM;IACnF;IAEA,mBAAmB;IACnB,aAAe;aAnCP,UAAoC,CAAC;aACrC,eAAqB,CAAC;aACtB,cAAsB;aACtB,iBAAyB;aACzB,kBAA0B;aAC1B,eAAuB;aACvB,QAAgB;aAChB,QAAgB;aAChB,iBAA0B;aAC1B,YAA4B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACpD,UAA8B,IAAI,CAAA,GAAA,MAAC,EAAE;aAErC,cAAsB;aACtB,SAA6B,EAAE,CAAE,MAAM;;aACvC,QAAgB;aACP,UAAU;YACvB,CAAC;gBACG,OAAO;YACX;YACA,CAAC,IAAU;gBACP,MAAM,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG;gBACzC,OAAO,KAAK,GAAG,IAAI;gBACnB,OAAO,KAAK,GAAG,IAAI;gBACnB,OAAO,KAAK,GAAG,IAAI;gBACnB,OAAO;YACX;SACH;IASe;IAEhB,sBAAsB;IAEtB,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,cAAc,SAAS,KAAK;IACrC;IAEA,UAAmB;QACf,OAAO,SAAS,KAAK,IAAI,CAAC;IAC9B;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC,cAAc;IAC9B;IAEA,SAAU,CAAO,EAAQ;QACrB,IAAI,CAAC,eAAe;IACxB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,cAAuB;QACnB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAa,CAAS,EAAQ;QAC1B,IAAI,CAAC,kBAAkB;IAC3B;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,cAAc,IAAI;IAC3B;IAEA,WAAoB;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,SAAU,CAAS,EAAQ;QACvB,IAAI,CAAC,eAAe;IACxB;IAEA,WAAY,CAA2B,EAAQ;QAC3C,IAAI,CAAC,UAAU;IACnB;IAEA,UAAW,CAAS,EAAE,CAAS,EAAE,QAAgB,EAAE,KAAe,EAAQ;QACtE,IAAI,SAAS,IAAI,CAAC,UAAU,GAAG;YAC3B,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC;QACT,OAAO;YACH,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,UAAU,IAAI;YACnB,IAAI,CAAC,UAAU,IAAI;YACnB,IAAI,CAAC,eAAe;gBAChB,MAAM;oBAAC;oBAAS;iBAAe;gBAC/B,SAAS;oBACL;wBACI,QAAQ;wBACR,QAAQ;4BAAC,IAAI,CAAC;yBAAa;oBAC/B;oBACA;wBACI,QAAQ;wBACR,QAAQ;4BAAC,IAAI,CAAC,cAAc;yBAAE;oBAClC;oBACA;wBACI,QAAQ;wBACR,QAAQ;4BAAC,IAAI,CAAC;yBAAe;oBACjC;oBACA;wBACI,QAAQ;wBACR,QAAQ;4BAAC,IAAI,CAAC;yBAAa;oBAC/B;oBACA;wBACI,QAAQ;wBACR,QAAQ;4BAAC,IAAI,CAAC;yBAAgB;oBAClC;oBACA;wBACI,QAAQ;wBACR,QAAQ;4BAAC;4BAAG;4BAAG;yBAAS;oBAC5B;iBACH;YACL;QACJ;IAEJ;IAEA,OAAQ,GAAW,EAAE,GAAW,EAAE,QAAgB,EAAE,aAA+B,EAAQ;QACvF,IAAI,CAAC,IAAI,CAAC,kBAAmB,QAAQ,IAAI,CAAC,UAAU,KAAK,QAAQ,IAAI,CAAC,UAAU,GAC5E;QAGJ,IAAI,GAAG,GAAG,GAAG;QACb,MAAM,IAAI,SAAS,KAAK;QACxB,MAAM,IAAI,SAAS,KAAK;QACxB,IAAI,CAAC,OAAO,KAAK;YAAC;YAAG;SAAE;QAEvB,IAAI,OAAO,IAAI,CAAC,aAAa;QAC7B,IAAI,OAAO,IAAI,CAAC,aAAa;QAC7B,IAAI,OAAO,IAAI,CAAC,aAAa;QAE7B,IAAI,eAAe;YACf,OAAO,cAAc;YACrB,OAAO,cAAc;YACrB,OAAO,cAAc;QACzB,OAAO;YACH,IAAI,IAAI,CAAC,oBAAoB,GACzB;gBAAA,IAAI,IAAI,KAAK,KAAK,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,KAAK,IAAI,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG;oBAC7G,OAAO;oBACP,OAAO;oBACP,OAAO;oBACP,MAAM,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,KAAK,IAAI,GAAG,IAAI;oBACrE,MAAM,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG,KAAK,IAAI,GAAG,IAAI;oBACtE,IAAI,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,KAAK,IAAI,GAAG,IAAI;oBACnE,IAAI,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG,KAAK,IAAI,GAAG,IAAI;oBACpE,QAAQ;oBACR,QAAQ;oBAER,IAAI,OAAO,KAAK,OAAO,GAAG;wBACtB,MAAM,QAAQ,IAAI,CAAC,QAAQ,aAAa,MAAM,MAAM,MAAM;wBAC1D,IAAI,WAAW;wBACf,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,KAAK,QAAQ,KAAK,EAAG;4BAC3C,QAAQ,MAAM,IAAI,CAAC,IAAI,EAAE;4BACzB,QAAQ,MAAM,IAAI,CAAC,IAAI,EAAE;4BACzB,QAAQ,MAAM,IAAI,CAAC,IAAI,EAAE;4BACzB;wBACJ;wBACA,QAAQ;wBACR,QAAQ;wBACR,QAAQ;oBACZ;oBAEA,MAAM,QAAQ,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC;oBACjE,OAAO,SAAS,KAAK,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa,GAAG,MAAM,GAAG,IAAI,CAAC;oBAC/D,OAAO,SAAS,KAAK,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa,GAAG,MAAM,GAAG,IAAI,CAAC;oBAC/D,OAAO,SAAS,KAAK,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,aAAa,GAAG,MAAM,GAAG,IAAI,CAAC;gBACnE;YAAA;QAER;QAEA,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,cAAc,UAAU,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,IAAI,CAAC,iBAAiB;QACrG,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC;QAE9B,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QACrC,IAAI,CAAC,QAAQ,OAAO,GAAG;QAEvB,IAAK,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,QAAQ,IAAK;YACrC,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YAClD,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YAClD,IAAI,IAAI,IAAI,IAAI;YAChB,IAAI,IAAI,OAAO,IAAI,CAAC,eAAe,IAAI,CAAC,gBAAgB,IAAI,CAAC,SAAS,IAAI,OAAO,IAAI,CAAC,eAAe,IAAI,CAAC,cAAc;gBACpH,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAI,IAAI,KAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAI,IAAI;gBAC9F,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,GAAI,IAAI,KAAM,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,GAAI,IAAI;YAChF;QACJ;QAEA,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ;QAGb,IAAI,CAAC;QACL,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,aAAc,QAAS,KAAK;YAC7B,QAAQ;YACR,QAAQ;gBAAC;gBAAK;gBAAK;gBAAU;oBAAC,GAAG;oBAAM,GAAG;oBAAM,GAAG;gBAAI;aAAE;QAC7D;IACJ;IAEA,UAAiB;QACb,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS,EAAE;QAChB,IAAI,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,aAAa,QAAS,KAAK;gBAC5B,QAAQ;gBACR,QAAQ,EAAE;YACd;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;IACJ;IACA,gBAAgB;IAEhB,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QACnE,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QAEnB,IAAI,IAAI,CAAC,kBAAkB,OAAO,WAC9B;QAIJ,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC;QAE9B,MAAM,SAAS;YACX,GAAG,IAAI,CAAC,aAAa;YACrB,GAAG,IAAI,CAAC,aAAa;YACrB,GAAG,IAAI,CAAC,aAAa;QACzB;QACA,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG;YACjH,OAAO,IAAI;YACX,OAAO,IAAI;YACX,OAAO,IAAI;YACX,MAAM,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,KAAK,IAAI,GAAG,KAAK;YACtE,MAAM,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG,KAAK,IAAI,GAAG,KAAK;YACvE,IAAI,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,KAAK,IAAI,GAAG,KAAK;YACpE,IAAI,OAAO,KAAK,IAAI,IAAI,CAAC,QAAQ,OAAO,SAAS,GAAG,KAAK,IAAI,GAAG,KAAK;YACrE,QAAQ;YACR,QAAQ;YACR,IAAI,OAAO,KAAK,OAAO,GAAG;gBACtB,MAAM,IAAI,KAAK,IAAI,aAAa,OAAO;gBACvC,MAAM,IAAI,KAAK,IAAI,aAAa,QAAQ;gBACxC,UAAU;gBACV,UAAU,2BAA2B;gBACrC,UAAU,UAAU,IAAI,CAAC,QAAQ,QAAQ,MAAM,MAAM,MAAM,MAAM,GAAG,GAAG,GAAG;gBAC1E,UAAU;gBAEV,MAAM,QAAQ,UAAU,aAAa,MAAM,MAAM,MAAM;gBACvD,IAAI,WAAW;gBACf,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,KAAK,QAAQ,KAAK,EAAG;oBAC3C,OAAO,KAAK,MAAM,IAAI,CAAC,IAAI,EAAE;oBAC7B,OAAO,KAAK,MAAM,IAAI,CAAC,IAAI,EAAE;oBAC7B,OAAO,KAAK,MAAM,IAAI,CAAC,IAAI,EAAE;oBAC7B;gBACJ;gBACA,OAAO,KAAK;gBACZ,OAAO,KAAK;gBACZ,OAAO,KAAK;YAChB;QACJ;QACA,MAAM,QAAQ,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO,GAAG,OAAO,GAAG,OAAO,IAAI,IAAI,CAAC;QAC7E,OAAO,IAAI,SAAS,KAAM,CAAA,IAAI,CAAC,kBAAkB,MAAM,IAAI,IAAI,CAAC,aAAa,IAAK,CAAA,IAAI,IAAI,CAAC,eAAc,CAAC;QAC1G,OAAO,IAAI,SAAS,KAAM,CAAA,IAAI,CAAC,kBAAkB,MAAM,IAAI,IAAI,CAAC,aAAa,IAAK,CAAA,IAAI,IAAI,CAAC,eAAc,CAAC;QAC1G,OAAO,IAAI,SAAS,KAAM,CAAA,IAAI,CAAC,kBAAkB,MAAM,IAAI,IAAI,CAAC,aAAa,IAAK,CAAA,IAAI,IAAI,CAAC,eAAc,CAAC;QAC1G,IAAI,CAAC,QAAQ,cAAc,UAAU,OAAO,IAAI,OAAO,OAAO,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,CAAC,iBAAiB;QACjH,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,OAAO,IAAI;QACxB,IAAI,CAAC,QAAQ,OAAO,IAAI;QACxB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,cAAc,UAAU,OAAO,IAAI,OAAO,OAAO,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,CAAC,iBAAiB;QACjH,IAAI,CAAC,QAAQ;QAEb,MAAM,eAA0C;YAC5C,MAAM;gBAAC;gBAAS;aAAe;YAC/B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAa;gBAC/B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC,cAAc;qBAAE;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAa;gBAC/B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC;wBAAI;wBAAI;wBAAI;qBAAG;gBAC5B;aACH;QACL;QACA,IAAI,CAAC,QAAQ,KAAK;IACtB;IAGA,YAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;AC3UA,gDAAa;AAfb;AAEA;AAIA;AACA;AAQO,MAAM;IA4CD,eAAsB;QAC1B,IAAI,CAAC,UAAU,UAAU,GAAG,GAAG,GAAG;QAClC,IAAI,CAAC,UAAU,YAAY,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,GAAA,wBAAY,CAAC,EAAE,GAAA,wBAAY,CAAC,EAAE,GAAA,wBAAY,CAAC,CAAC,GAAG,IAAI,CAAC;QAC7G,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAI,GAAG,KAAK,MAAM,IAAI,CAAC,iBAAiB,IAAI,CAAC,UAAU,UAAU,IACtF,IAAI,CAAC,UAAU,SAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG;QAE3E,IAAI,CAAC,gBAAgB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,QAAQ,cAAc,IAAI,CAAC,cAAc;IACnF;IAEA;;KAEC,GACD,AAAQ,wBAAyB,EAAa,EAAE,EAAa,EAAE,EAAa,EAAE,EAAa,EAAE,WAAmB,EAAW;QACvH,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI;YAClB,GAAG,GAAG,IAAI,GAAG;YACb,GAAG,GAAG,IAAI,GAAG;QACjB;QACA,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI;YACnB,GAAG,GAAG,IAAI,GAAG;YACb,GAAG,GAAG,IAAI,GAAG;QACjB;QACA,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI;YACnB,GAAG,GAAG,IAAI,GAAG;YACb,GAAG,GAAG,IAAI,GAAG;QACjB;QACA,uEAAuE;QACvE,uEAAuE;QAEvE,OAAO,KAAK,IAAI,CAAA,GAAA,MAAC,EAAE,KAAK,KAAK,GAAG,KAAK,CAAA,GAAA,MAAC,EAAE,KAAK,KAAK,GAAG,OAAO;IAChE;IAEQ,oBAAqB,EAAa,EAAE,EAAa,EAAE,EAAa,EAAE,EAAa,EAAQ;QAE3F,MAAM,kBAAkB,IAAI,CAAC,wBAAwB,IAAI,IAAI,IAAI,IAAI;QAErE,GAAG,IAAI,KAAK,MAAM,GAAG;QACrB,GAAG,IAAI,KAAK,MAAM,GAAG;QACrB,GAAG,IAAI,KAAK,MAAM,GAAG;QACrB,GAAG,IAAI,KAAK,MAAM,GAAG;QAErB,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG;QAC1C,IAAI,CAAC,mBAAmB,OAAO,GAAG;YAC9B,IAAI,CAAC,SAAS,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG;YACtC;QACJ;QAEA,MAAM,IAAI,KAAK,IAAI,GAAG,KAAK,MAAM,OAAO;QACxC,MAAM,WAAW,EAAE;QACnB,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK;YACzB,MAAM,IAAI,IAAI;YACd,MAAM,IAAI,KAAK,IAAI,IAAI,GAAG;YAC1B,MAAM,IAAI,IAAI,IAAI,KAAK,IAAI,IAAI,GAAG;YAClC,MAAM,IAAI,IAAI,KAAK,IAAI,GAAG,KAAM,CAAA,IAAI,CAAA;YACpC,MAAM,IAAI,KAAK,IAAI,GAAG;YACtB,SAAS,KAAK;gBACV,GAAG,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG;gBAC3C,GAAG,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG;YAC/C;QACJ;QAEA,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,IAAI,CAAC,SACD,KAAK,MAAM,QAAQ,CAAC,EAAE,CAAC,IACvB,KAAK,MAAM,QAAQ,CAAC,EAAE,CAAC,IACvB,KAAK,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC,IAC3B,KAAK,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC,IAC3B;IAGZ;IAEQ,QAAS,CAAS,EAAE,CAAS,EAAE,IAAY,EAAE,OAAe,EAAQ;QACxE,IAAI,CAAC,QAAQ;QACb,IAAI,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC,mBAAmB,IAAI,CAAC,gBAAgB;YACtE,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;iBAExC,IAAI,CAAC,QAAQ,2BAA2B;QAEhD,OAAO;YACH,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC,mBAAmB,IAAI,CAAC,gBAAgB,IAAI,CAAC;YAC3E,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;QAEhD;QACA,IAAI,CAAC,QAAQ,cAAc,IAAI,CAAC,mBAAmB,IAAI;QACvD,IAAI,CAAC,QAAQ,SACT,KAAK,MAAM,IAAI,CAAC,OAChB,KAAK,MAAM,IAAI,CAAC,OAChB,KAAK,MAAM,OAAO,IAClB,KAAK,MAAM,OAAO;QAEtB,IAAI,CAAC,QAAQ;IACjB;IAEQ,aACJ,CAAgB,EAChB,CAAgB,EAChB,IAAY,EACZ,QAAgB,EACZ;QACJ,IAAI,IAAI,CAAC,eAAe,MAAM;YAC1B,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE;YACzB,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,GAAG,GAAG,KAAO;QACtE;QAEA,IAAI,CAAC,QAAQ;QAEb,MAAM,cAAc,CAChB;YAQA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW,UAAU,UAAU,IAAI;YACrE,MAAM,eAAe,IAAI,CAAC,iBAAkB,CAAA,IAAI,CAAC,4BAA6B,gBAAgB,gBAAiB,CAAA;YAC/G,MAAM,YAAY,KAAK,IAAI,KAAK,IAAI,CAAC,cAAe,CAAA,IAAI,CAAC,yBAAyB,gBAAgB,CAAA;YAClG,IAAI,CAAC,QAAQ,IAAI,GAAG,IAAI,GAAG,WAAW;QAC1C;QAEA,MAAM,kBAAkB,CACpB;YAOA,IAAI,CAAC,oBAAoB,WAAW,IAAI,WAAW,IAAI,WAAW,IAAI,WAAW;QACrF;QAEA,IAAI,KAAK,MAAM,IAAI,CAAC,cAAc,OAAO;YACrC,IAAI,MAAM,QAAQ,MAAM,MACpB,IAAI,CAAC,WAAW,SAAS,GAAG,WAAW;iBAEvC,IAAI,CAAC,WAAW,IAAI,GAAG,GAAG,GAAG,WAAW;eAGzC;YACH,MAAM,eAAe,OAAO,IAAI,CAAC;YAEjC,IAAI,MAAM,QAAQ,MAAM,MACpB,IAAI,CAAC,WAAW,SAAS,cAAc;iBAEvC,IAAI,CAAC,WAAW,IAAI,GAAG,GAAG,cAAc;QAEhD;QAEA,IAAI,CAAC,QAAQ;IACjB;IAGA;;KAEC,GACD,AAAQ,SAAU,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,SAAkB,EAAQ;QACxF,IAAI,CAAC,QAAQ;QAEb,IAAI,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC,mBAAmB,IAAI,CAAC,gBAAgB;YACtE,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;iBAExC,IAAI,CAAC,QAAQ,2BAA2B;QAEhD,OAAO;YACH,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC,mBAAmB,IAAI,CAAC,gBAAgB,IAAI,CAAC;YAC3E,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;QAEhD;QACA,IAAI,CAAC,QAAQ,cAAc,IAAI,CAAC,mBAAmB,IAAI,IAAI,CAAC;QAE5D,KAAK,KAAK,MAAM;QAChB,KAAK,KAAK,MAAM;QAChB,KAAK,KAAK,MAAM;QAChB,KAAK,KAAK,MAAM;QAEhB,MAAM,KAAK,KAAK,IAAI,KAAK;QACzB,MAAM,KAAK,KAAK,KAAK,IAAI;QACzB,MAAM,KAAK,CAAC,KAAK,IAAI,KAAK;QAC1B,MAAM,KAAK,KAAK,KAAK,IAAI;QACzB,IAAI,MAAM,KAAK;QACf,iDAAiD;QACjD,MAAO,KAAM;YACT,IAAI,WACA,YAAY;iBAEZ,IAAI,CAAC,QAAQ,SAAS,IAAI,IAAI,GAAG;YAErC,IAAI,OAAO,MAAM,OAAO,IACpB;YAEJ,MAAM,KAAK,IAAI;YACf,IAAI,MAAM,IAAI;gBACV,OAAO;gBACP,MAAM;YACV;YACA,IAAI,MAAM,IAAI;gBACV,OAAO;gBACP,MAAM;YACV;QACJ;QAEA,IAAI,CAAC,QAAQ;IACjB;IAIA,mBAAmB;IACnB,aAAe;aAhQP,UAA8B,IAAI,CAAA,GAAA,MAAC,EAAE;aAErC,UAAoC,CAAC;aACrC,yBAAkC;aAClC,4BAAqC;aACrC,cAAsB;aACtB,iBAAyB;aACzB,iBAAyB;aACzB,eAAqB,CAAC;aACtB,kBAA0B;aAC1B,wBAAiC;aACjC,kBAA2B;aAC3B,mBAA4B;aAC5B,iBAA0B;aAC1B,kBAA0B;aAC1B,YAA4B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACpD,aAA6B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACrD,aAAgC;aACvB,YAAgC;YAC7C;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YAEN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;YACN;gBAAC;gBAAG;aAAE;SACT;aAGO,gBAA+B,CAAC;QA0NpC,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QACjC,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;IACjC;IAEA,sBAAsB;IAEtB,UAAW,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC9C,IAAI,CAAC,eAAe;YAChB,MAAM;gBAAC;gBAAS;aAAa;YAC7B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAuB;gBACzC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAA0B;gBAC5C;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAY;gBAC9B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAa;gBAC/B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAsB;gBACxC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAiB;gBACnC;aACH;QACL;QAEA,IAAI,IAAI,CAAC,kBACL,IAAI,CAAC;QAGT,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QAC5B,MAAM,eAAe,IAAI,CAAC,4BAA6B,IAAI,CAAC,iBAAiB,IAAI,IAAK,IAAI,CAAC;QAC3F,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAEzG,IAAI,CAAC,iBAAiB;QACtB,IAAI,CAAC,QAAQ,GAAG,GAAG,WAAW;QAC9B,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC;QACxC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAC1B,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAElC,IAAI,CAAC,aAAa,QAAS,KAAK;YAC5B,QAAQ;YACR,QAAQ;gBAAC;gBAAG;gBAAG;aAAE;QACrB;IACJ;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC3C,IAAI,CAAC,IAAI,CAAC,gBACN;QAEJ,IAAI,CAAC,aAAc,QAAS,KAAK;YAC7B,QAAQ;YACR,QAAQ;gBAAC;gBAAG;gBAAG;aAAE;QACrB;QAEA,OAAO;QACP,wBAAwB;QAExB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,GAAG;QAChC,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAE/H,IAAI,CAAC,aAAa,GAAG,GAAG,WAAW,IAAI,CAAC,UAAU;QAElD,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAClC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;IAC9B;IAEA,QAAS,CAAS,EAAE,CAAS,EAAQ;QAEjC,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAC/H,IAAI,CAAC,aAAa,MAAM,MAAM,WAAW,IAAI,CAAC,UAAU;QAExD,OAAO;QACP,0CAA0C;QAC1C,yBAAyB;QAEzB,IAAI,CAAC,iBAAiB;QAEtB,IAAI,CAAC,aAAa;QAElB,IAAI,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,aAAa,QAAS,KAAK;gBAC5B,QAAQ;gBACR,QAAQ;oBAAC;oBAAG;iBAAE;YAClB;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;IACJ;IAEA,eAAe;IACf,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QACnE,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAE1B,IAAI,IAAI,CAAC,kBAAkB,OAAO,WAC9B;QAGJ,IAAI,IAAI,CAAC,kBACL,IAAI,CAAC;QAGT,IAAI,KAAK,MAAM,IAAI,CAAC,cAAc,OAAO,GACrC,IAAI,CAAC,SAAS,IAAI,IAAI,IAAI,IAAI;aAC3B;YACH,qEAAqE;YACrE,MAAM,YAAY,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,KAAK,IAAI;YACvE,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;YACvB,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;YACvB,IAAI;YACJ,MAAM,QAAQ,IAAI,CAAC,cAAc,IAAI,CAAC;YACtC,IAAI,CAAC,kBAAkB,IAAI,CAAC,cAAc,IAAI,CAAC;YAC/C,IAAK,WAAW,IAAI,CAAC,iBAAiB,YAAY,WAAW,YAAY,MACrE,IAAI,CAAC,QAAQ,KAAK,KAAK,UAAU,KAAK,KAAK,UAAU,IAAI,CAAC,aAAa,IAAI,CAAC;QAEpF;QAEA,MAAM,eAAwC;YAC1C,MAAM;gBAAC;gBAAS;aAAa;YAC7B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAuB;gBACzC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAA0B;gBAC5C;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAY;gBAC9B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAe;gBACjC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAa;gBAC/B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAsB;gBACxC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAiB;gBACnC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC;wBAAI;wBAAI;wBAAI;qBAAG;gBAC5B;aACH;QACL;QACA,IAAI,CAAC,QAAQ,KAAK;IACtB;IAEA,IAAI;IACJ,YAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,KAAK;IACL,SAAU,CAAO,EAAQ;QACrB,IAAI,IAAI,CAAC,iBAAiB,GACtB;QAEJ,IAAI,CAAC,eAAe;QACpB,IAAI,CAAC,kBAAkB,SAAS,IAAI,CAAC,aAAa,IAAI,MAAM,IAAI,CAAC,aAAa,IAAI,MAAM,IAAI,CAAC,aAAa,IAAI;IAClH;IAEA,WAAY,CAA2B,EAAQ;QAC3C,IAAI,CAAC,UAAU;IACnB;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,cAAc,KAAK,MAAM,IAAI,KAAK;IAC3C;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,yBAAyB;IAClC;IAEA,gBAAiB,CAAU,EAAQ;QAC/B,IAAI,CAAC,4BAA4B;IACrC;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,wBAAwB;IACjC;IAEA,YAAa,CAAU,EAAQ;QAC3B,IAAI,CAAC,kBAAkB;IAC3B;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,mBAAmB;IAC5B;IAEA,KAAK;IACL,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,cAAwB;QACpB,OAAO,IAAI,CAAC;IAChB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;ACrhBA,iDAAa;AAbb;AAEA;AAGA;AAQO,MAAM;IAqBD,QAAS,CAAS,EAAE,CAAS,EAAE,IAAY,EAAE,OAAe,EAAQ;QACxE,IAAI,CAAC,QAAQ;QACb,IAAI,IAAI,CAAC;YACL,IAAI,IAAI,CAAC,iBACL,IAAI,CAAC,QAAQ,2BAA2B;iBAExC,IAAI,CAAC,QAAQ,2BAA2B;eAG5C,IAAI,CAAC,QAAQ,2BAA2B;QAE5C,MAAM,UAAU,IAAI,CAAC,QAAQ,qBAAqB,MAAM,MAAM,GAAG,MAAM,MAAM;QAC7E,IAAI,YAAY,KAAK,IAAI,SAAS;QAClC,YAAY,KAAK,IAAI,GAAG,KAAK,IAAI,AAAC,CAAA,OAAO,CAAA,IAAK,MAAM;QACpD,MAAM,OAAO,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QACrC,MAAM,eAAe,IAAI,OAAO,OAAO;QACvC,QAAQ,aAAa,WAAW,CAAC,KAAK,EAAE,CAAA,GAAA,uBAAU,EAAE,EAAE,EAAE,CAAA,GAAA,uBAAU,EAAE,EAAE,EAAE,CAAA,GAAA,uBAAU,EAAE,EAAE,CAAC,GAAG,eAAe;QACzG,QAAQ,aAAa,GAAG,CAAC,KAAK,EAAE,CAAA,GAAA,uBAAU,EAAE,EAAE,EAAE,CAAA,GAAA,uBAAU,EAAE,EAAE,EAAE,CAAA,GAAA,uBAAU,EAAE,IAAI,CAAC;QACjF,IAAI,CAAC,QAAQ,YAAY;QACzB,IAAI,CAAC,QAAQ,UAAU,IAAI,MAAM,IAAI;QACrC,IAAI,CAAC,QAAQ,SAAS,GAAG,GAAG,OAAO,GAAG,OAAO;QAC7C,IAAI,CAAC,QAAQ;IACjB;IAEQ,aAAc,CAAqB,EAAE,CAAqB,EAAE,CAAS,EAAQ;QACjF,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QAC5B,IAAI;QACJ,IAAI;QACJ,IAAI,YAAY,AAAC,IAAI,CAAC,kBAAmB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;QAE3F,MAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,WAAW,YAAY,IAAI,CAAC;QAE7E,MAAM,iBAAiB,CAAC;YAOpB,MAAM,SAAS,IAAI;YACnB,gBAAgB,IAAI,CAAC,WAAW,WAAY,CAAA,IAAI,MAAK,IAAK,IAAI;YAC9D,eAAe,AAAC,IAAI,CAAC,qBAAuB,IAAI,CAAC,UAAU,gBAAgB,gBAAiB,IAAI,CAAC;YACjG,YAAY,AAAC,IAAI,CAAC,kBAAmB,KAAK,IAAI,KAAK,gBAAgB,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;YAEnG,IAAI,CAAC,QAAQ,IAAI,GAAG,IAAI,GAAG,WAAW;QAC1C;QAEA,IAAI,MAAM,aAAa,MAAM,WACzB,IAAI,CAAC,WAAY,SAAS,OAAO;aAEjC,IAAI,CAAC,WAAY,IAAI,GAAG,GAAG,OAAO;IAE1C;IAEA,oBAAoB;IACpB,aAAe;aA1EP,OAAe;aACf,UAAkB;aAClB,UAAkB;aAClB,kBAA2B;aAC3B,qBAA8B;aAC9B,kBAA2B;aAE3B,UAA8B,IAAI,CAAA,GAAA,MAAC,EAAE;aAErC,cAAuB;aACvB,UAA2B,CAAC;aAE5B,UAAmB;aAEnB,YAA4B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACpD,aAA6B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;IA2D7C;IAEhB,sBAAsB;IACtB,UAAW,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC9C,IAAI,CAAC,eAAe;YAChB,MAAM;gBAAC;gBAAS;aAAc;YAC9B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAmB;gBACrC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAK;gBACvB;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAQ;gBAC1B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC;wBAAG;wBAAG;qBAAE;gBACrB;aACH;QACL;QAEA,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,QAAQ,OAAO;QAE7C,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QAC5B,MAAM,eAAe,AAAC,IAAI,CAAC,qBAAuB,IAAI,CAAC,UAAU,IAAI,IAAK,IAAI,CAAC;QAC/E,MAAM,YAAY,AAAC,IAAI,CAAC,kBAAmB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,IAAI,CAAC;QAE7F,IAAI,CAAC,UAAU;QACf,IAAI,YAAY,GACZ,IAAI,CAAC,QAAQ,GAAG,GAAG,WAAW;QAElC,IAAI,CAAC,UAAU,YAAY,IAAI,CAAC;QAChC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAC1B,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAElC,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE;QACzB,IAAI,CAAC,WAAW,IAAI,GAAG,GAAG,GAAG,IAAM;IACvC;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC3C,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,cACvB;QAEJ,IAAI,CAAC,aAAa,SAAS,KAAK;YAC5B,QAAQ;YACR,QAAQ;gBAAC;gBAAG;gBAAG;aAAE;QACrB;QAEA,IAAI,CAAC,aAAa,GAAG,GAAG,IAAI,CAAC,UAAU;QAEvC,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;QAClC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;IAC9B;IAEA,UAAiB;QAEb,IAAI,IAAI,CAAC,YACL,IAAI,CAAC,aAAa,WAAW,WAAW,IAAI,CAAC,UAAU;QAG3D,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,aAAa;QAElB,IAAI,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,aAAa,SAAS,KAAK;gBAC5B,QAAQ;gBACR,QAAQ,EAAE;YACd;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;IACJ;IAEA,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QAEnE,IAAI,CAAC,cAAc,MAAM,IAAI,CAAC,QAAQ,OAAO;QAE7C,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QAEnB,IAAI,IAAI,CAAC,WAAW,OAAO,WACvB;QAGJ,MAAM,YAAY,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,KAAK,IAAI;QACvE,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;QACvB,MAAM,KAAK,AAAC,CAAA,KAAK,EAAC,IAAK;QACvB,IAAI;QACJ,MAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,OAAO,IAAI,CAAC;QAC7E,IAAI,CAAC,UAAU;QACf,IAAK,WAAW,IAAI,CAAC,SAAS,YAAY,WAAW,YAAY,MAC7D,IAAI,CAAC,QAAQ,KAAK,KAAK,UAAU,KAAK,KAAK,UAAU,IAAI,CAAC,MAAM,IAAI,CAAC;QAIzE,MAAM,eAAyC;YAC3C,MAAM;gBAAC;gBAAS;aAAc;YAC9B,SAAS;gBACL;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAmB;gBACrC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAK;gBACvB;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAQ;gBAC1B;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC,IAAI,CAAC;qBAAgB;gBAClC;gBACA;oBACI,QAAQ;oBACR,QAAQ;wBAAC;wBAAI;wBAAI;wBAAI;qBAAG;gBAC5B;aACH;QACL;QACA,IAAI,CAAC,QAAQ,KAAK;IACtB;IAEA,IAAI;IACJ,YAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,KAAK;IACL,WAAY,CAAkB,EAAQ;QAClC,IAAI,CAAC,UAAU;IACnB;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,OAAO;IAChB;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,UAAU;IACnB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,kBAAkB;IAC3B;IAEA,gBAAiB,CAAU,EAAQ;QAC/B,IAAI,CAAC,qBAAqB;IAC9B;IAEA,iBAAkB,CAAU,EAAQ;QAChC,IAAI,CAAC,kBAAkB;IAC3B;IAEA,KAAK;IACL,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;ACxBA,iDAAa;AA3Pb;AAGA;AAEA;AAQA,qBAAqB;AACrB,mBAAmB;AACnB,yDAAyD;AACzD,oBAAoB;AACpB,mBAAmB;AACnB,0BAA0B;AAC1B,oCAAoC;AACpC,gCAAgC;AAChC,gDAAgD;AAChD,+CAA+C;AAC/C,gDAAgD;AAChD,+DAA+D;AAE/D,MAAM,YAAY;AAkBlB;;;;;;;CAOC,GACD,SAAS,WACL,OAAe,EACf,QAAgB,EAChB,EAAa,EACb,EAAa,EACb,IAA4B;IAO5B,IAAI,GAAG,MAAM,GAAG,KAAK,GAAG,MAAM,GAAG,GAC7B,OAAO;IAGX,KAAK,CAAA,GAAA,MAAC,EAAE,QAAQ;IAChB,KAAK,CAAA,GAAA,MAAC,EAAE,QAAQ;IAChB,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;IAElB,kBAAkB;IAClB,4CAA4C;IAC5C,2DAA2D;IAC3D;QACI,IAAI,MAAM;QACV,IAAI,QAAQ;QACZ,IAAI,SAAS;QACb,IAAI,OAAO;QAEX,IAAI,GAAG,IAAI,GACP,OAAO,CAAC,GAAG;QAEf,IAAI,GAAG,IAAI,GACP,MAAM,CAAC,GAAG;QAEd,IAAI,GAAG,IAAI,GACP,OAAO,KAAK,IAAI,MAAM,CAAC,GAAG;QAE9B,IAAI,GAAG,IAAI,GACP,MAAM,KAAK,IAAI,KAAK,CAAC,GAAG;QAE5B,IAAI,GAAG,IAAI,KAAK,IAAI,SAChB,QAAQ,GAAG,IAAI,KAAK,IAAI;QAE5B,IAAI,GAAG,IAAI,KAAK,IAAI,UAChB,SAAS,GAAG,IAAI,KAAK,IAAI;QAE7B,IAAI,GAAG,IAAI,KAAK,IAAI,SAChB,QAAQ,KAAK,IAAI,OAAO,GAAG,IAAI,KAAK,IAAI;QAE5C,IAAI,GAAG,IAAI,KAAK,IAAI,UAChB,SAAS,KAAK,IAAI,QAAQ,GAAG,IAAI,KAAK,IAAI;QAG9C,GAAG,KAAK;QACR,GAAG,KAAK;QACR,GAAG,KAAK;QACR,GAAG,KAAK;QAER,KAAK,IAAI,KAAK,IAAI,OAAO;QACzB,KAAK,IAAI,KAAK,IAAI,MAAM;QACxB,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,GACzB,OAAO;IAEf;IAEA,OAAO;QACH,IAAI;YACA,GAAG,GAAG;YACN,GAAG,GAAG;QACV;QACA,IAAI;YACA,GAAG,GAAG;YACN,GAAG,GAAG;QACV;QACA,MAAM;YACF,GAAG,KAAK;YACR,GAAG,KAAK;QACZ;IACJ;AACJ;AAEA;;;;CAIC,GACD,SAAS,OAAQ,SAAoB,EAAE,CAAiB;IAEpD,IAAI,CAAA,GAAA,MAAC,EAAE,QAAQ;IAEf,MAAM,QAAQ,EAAE,MAAM;IACtB,MAAM,KAAK,EAAE,MAAM,OAAO;IAC1B,MAAM,KAAK,EAAE,MAAM,OAAO;IAE1B;;;;kCAI8B,GAG9B,mBAAmB;IACnB,MAAM,SAAS,EAAE,GAAG,IAAI,UAAU,QAAQ,EAAE,GAAG;IAC/C,MAAM,SAAS,EAAE,GAAG,IAAI,UAAU,QAAQ,EAAE,GAAG;IAC/C,MAAM,SAAS,AAAC,CAAA,SAAS,MAAK,IAAK;IAEnC,uDAAuD;IACvD,IAAI,QAAQ;IACZ,MAAM,UAAU,QAAQ,KAAK,OAAO,KAAK,4CAA4C;IACrF,MAAM,UAAoB,EAAE;IAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,IACzB,OAAO,CAAC,EAAE,GAAG,AAAC,CAAA,KAAK,WAAW,GAAE,IAAK,QAAQ;IAGjD,MAAM,aAAa,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG,EAAE,MAAM,OAAO;IAE1D,MAAM,QAAQ,CAAC,IAAY,IAAY,IAAY;QAE/C,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,KAAK,IAAI,IAAI,IAAI;QACjC,MAAM,MAAM,IAAI,EAAE,MAAM,UAAW,CAAA,IAAI,CAAA,GAAA,WAAI,EAAE,AAAC,CAAA,OAAQ,CAAA,QAAQ,UAAS,CAAC,IAAK,YAAY,GAAG,EAAC;QAE7F,IAAI,QAAQ,GACR;QAGJ,IAAI,CAAC,UAAU,IAAI,CAAC,KAAK,EAAE;aAEpB,IAAI,CAAC,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE;YAChC,UAAU,IAAI,CAAC,GAAG,GAAG,UAAU,IAAI,CAAC,GAAG;YACvC,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,UAAU,IAAI,CAAC,KAAK,EAAE;YAC/C,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,UAAU,IAAI,CAAC,KAAK,EAAE;QACnD,OAAO;YAEH,+FAA+F;YAC/F,6DAA6D;YAC7D,IAAI;YACJ,IAAI,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,UAAU,IAAI,CAAC,KAAK,EAAE,EAC/C,OAAO,IAAI,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,UAAU,IAAI,CAAC,KAAK,EAAE,GAAI,CAAA,IAAI,GAAE;iBAEpE,OAAO,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG;YAG7D,yGAAyG;YACzG,+FAA+F;YAC/F,6CAA6C;YAC7C,UAAU,IAAI,CAAC,GAAG,GAAG,KAAK,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,IAAI,CAAC,GAAG,EAAE,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,QAAQ,OAAO,CAAC,MAAM;YACzG,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,QAAQ,OAAO,CAAC,MAAM;YACjH,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,QAAQ,OAAO,CAAC,MAAM;YAEjH,QAAQ,AAAC,CAAA,QAAQ,CAAA,IAAK;QAC1B;QACA,sCAAsC;QACtC,IAAI,CAAC,EAAE,MAAM,WACT,UAAU,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,UAAU,IAAI,CAAC,KAAK,EAAE,EAAE,OAAO;IAG1G;IAEA,MAAM,MAAM,EAAE,GAAG,IAAI;IACrB,MAAM,MAAM,MAAM,AAAC,CAAA,EAAE,KAAK,IAAI,CAAA,IAAK;IAEnC,0EAA0E;IAC1E,IAAI,EAAE,GAAG,IAAI,EAAE,GAAG,GACd,IAAK,IAAI,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,EAAE,GAAG,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,GAAG,KAAK,KAAM;QACtE,MAAM,SAAS,AAAC,CAAA,IAAI,EAAE,GAAG,CAAA,IAAK,UAAU,QAAQ;QAChD,IAAK,IAAI,IAAI,MAAM,QAAQ,KAAK,MAAM,SAAS,QAAQ,KAAK,EAAE,GAAG,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,MAAM,QAAQ,KAAK,GAAG,MAAM,GAAG,KACnH,MAAM,IAAI,GAAG,IAAI;IAEzB;SACG,IAAI,EAAE,GAAG,IAAI,EAAE,GAAG,GACrB,IAAK,IAAI,IAAI,GAAG,KAAK,EAAE,GAAG,GAAG,IAAI,EAAE,KAAK,GAAG,KAAK,KAAM;QAClD,MAAM,SAAS,AAAC,CAAA,IAAI,EAAE,GAAG,CAAA,IAAK,UAAU,QAAQ;QAChD,IAAK,IAAI,IAAI,MAAM,QAAQ,KAAK,MAAM,SAAS,QAAQ,KAAK,EAAE,GAAG,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,MAAM,QAAQ,KAAK,GAAG,MAAM,GAAG,KACnH,MAAM,IAAI,GAAG,IAAI;IAEzB;SACG;QACH,IAAI,EAAE,GAAG,IAAI,EAAE,GAAG,GACd,IAAK,IAAI,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,EAAE,GAAG,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,GAAG,KAAK,KAAM;YACtE,MAAM,SAAS,AAAC,CAAA,IAAI,EAAE,GAAG,CAAA,IAAK,UAAU,QAAQ;YAChD,IAAK,IAAI,IAAI,MAAM,QAAQ,KAAK,MAAM,SAAS,QAAQ,KAAK,EAAE,GAAG,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,MAAM,QAAQ,KAAK,GAAG,MAAM,GAAG,KACnH,MAAM,IAAI,GAAG,IAAI;QAEzB;aAEA,IAAK,IAAI,IAAI,GAAG,KAAK,EAAE,GAAG,GAAG,IAAI,EAAE,KAAK,GAAG,KAAK,KAAM;YAClD,MAAM,SAAS,AAAC,CAAA,IAAI,EAAE,GAAG,CAAA,IAAK,UAAU,QAAQ;YAChD,IAAK,IAAI,IAAI,MAAM,QAAQ,KAAK,MAAM,SAAS,QAAQ,KAAK,EAAE,GAAG,GAAG,IAAI,MAAM,QAAQ,KAAK,GAAG,MAAM,GAAG,KACnG,MAAM,IAAI,GAAG,IAAI;QAEzB;IAER;AAEA,cAAc;AACd,uCAAuC;AAC3C;AAEO,MAAM;IAgCT,sEAAsE;IAC9D,oBAA2B;QAC/B,IAAI,CAAC,eAAe;IACxB;IAEQ,mBAAoB,MAAe,EAAQ;QAC/C,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,cAAc;IAC3D;IAEQ,2BAA4B,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QACtF,IAAI,CAAC,uBAAuB,CAAA,GAAA,MAAC,EAAE,aAC3B,IAAI,CAAC,sBACL;YAAE;YAAI;YAAI;YAAI;QAAG;IAEzB;IAEA;;KAEC,GACD,iBAAwB;QAEpB,MAAM,eAAe,IAAI,CAAC,YAAY,IAAI,IAAM;QAEhD,MAAM,SAAoB,EAAE;QAC5B,MAAM,SAAS,KAAK,KAAK,IAAI,CAAC,cAAc,QAAQ;QAEpD,IAAI,CAAC,IAAI,CAAC,cACN;QAEJ,OAAO,KAAK;YACR,IAAI,KAAK,MAAM,IAAI,CAAC,aAAa,KAAK;YACtC,IAAI,KAAK,MAAM,IAAI,CAAC,aAAa,KAAK;YACtC,IAAI,KAAK,MAAM,IAAI,CAAC,aAAa,KAAK;YACtC,IAAI,KAAK,MAAM,IAAI,CAAC,aAAa,KAAK;QAC1C;QACA,OAAO,QAAQ,CAAA;YACX,IAAK,IAAI,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,IAChC,IAAK,IAAI,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,IAChC,YAAY,CAAC,IAAI,SAAS,EAAE,GAAG;QAG3C;QAEA,aAAa,QAAQ,CAAC,MAAM;YACxB,IAAI,CAAC,QAAQ,IAAI,CAAC,WAAW,CAAC,EAAE,EAC5B,iCAAiC;YACjC;YAEJ,IAAI,CAAC,WAAW,CAAC,EAAE,GAAG;YACtB,MAAM,IAAI,IAAI;YACd,MAAM,IAAI,KAAK,MAAM,IAAI;YACzB,MAAM,IAAI,AAAC,CAAA,KAAK,IAAI,IAAI,YAAY,WAAW,IAAI,CAAC,cAAc,SAAS,CAAA,IAAK,YAAY;YAC5F,MAAM,IAAI,AAAC,CAAA,KAAK,IAAI,IAAI,YAAY,WAAW,IAAI,CAAC,cAAc,UAAU,CAAA,IAAK,YAAY;YAE7F,wEAAwE;YACxE,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;YAC/B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI;YACtB,OAAO,UAAU,IAAI,CAAC,QAAQ,QAAQ,CAAC,IAAI,WAAW,CAAC,IAAI;YAE3D,MAAM,OAAO,OAAO,aAAa,GAAG,GAAG,GAAG;YAE1C,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IACnB,IAAK,IAAI,IAAI,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,AAAC,CAAA,AAAC,CAAA,IAAI,YAAY,CAAA,IAAK,IAAI,CAAC,cAAc,QAAQ,IAAI,SAAQ,IAAK,GAAG,IAAI,GAAG,KAAK,MAAM,GAAG,MAAM,EAAG;gBACrI,IAAI,CAAC,cAAc,IAAI,CAAC,GAAG,GAAG,KAAK,IAAI,CAAC,GAAG;gBAC3C,IAAI,CAAC,cAAc,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,IAAI,CAAC,KAAK,EAAE;gBACnD,IAAI,CAAC,cAAc,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,IAAI,CAAC,KAAK,EAAE;gBACnD,IAAI,CAAC,cAAc,IAAI,CAAC,KAAK,EAAE,GAAG,KAAK,IAAI,CAAC,KAAK,EAAE;YACvD;QAER;IACJ;IAGA;;;;;;KAMC,GACD,QAAS,CAAS,EAAE,CAAS,EAAE,IAAY,EAAE,OAAe,EAAQ;QAChE,IAAI,CAAC,IAAI,CAAC,SAAS;YACf,IAAI,CAAC,UAAU;gBACX,GAAG;gBACH,GAAG;YACP;YACA;QACJ;QAEA,OAAO,KAAK,MAAM;QAGlB,MAAM,IAAI,KAAK,MAAM,OAAO;QAC5B,MAAM,IAAI,KAAK,MAAM,OAAO;QAE5B,MAAM,SAAS,WACX,IAAI,CAAC,cAAc,OACnB,IAAI,CAAC,cAAc,QACnB;YACI,GAAG,KAAK,MAAM,IAAI,CAAC,QAAQ,IAAI;YAC/B,GAAG,KAAK,MAAM,IAAI,CAAC,QAAQ,IAAI;QACnC,GACA;YACI,GAAG,KAAK,MAAM,IAAI;YAClB,GAAG,KAAK,MAAM,IAAI;QACtB,GACA;YACI;YACA;QACJ;QAGJ,IAAI,QAAQ;YACR,MAAM,SAAwB;gBAC1B,IAAI,OAAO;gBACX,IAAI,OAAO;gBACX,MAAM,OAAO;gBACb,OAAO;oBACH,QAAQ;wBAAE;wBAAG;oBAAE;oBACf;oBACA;oBACA,WAAW,IAAI,CAAC;gBACpB;YACJ;YACA,IAAI,CAAC,mBAAmB;gBACpB,IAAI,OAAO,GAAG;gBACd,IAAI,OAAO,GAAG;gBACd,IAAI,OAAO,GAAG,IAAI,OAAO,MAAM,OAAO;gBACtC,IAAI,OAAO,GAAG,IAAI,OAAO,MAAM,OAAO;YAC1C;YACA,IAAI,CAAC,WAAW,KAAK;QACzB;QAEA,IAAI,CAAC,UAAU;YACX,GAAG;YACH,GAAG;QACP;IACJ;IAEA,aAAc,CAAqB,EAAE,CAAqB,EAAE,IAAY,EAAE,QAAgB,EAAQ;QAC9F,IAAI,CAAC,aAAa,EAAE;QAEpB,IAAI,CAAC,IAAI,CAAC,YAAY;YAClB,IAAI,CAAC,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE;YACzB,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,GAAG,GAAG,YAAY;QAC3E;QAEA,MAAM,UAA6C,EAAE,EAAE,8CAA8C;QAErG,MAAM,cAAmC,CAAC;YACtC,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW,UAAU,UAAU,IAAI;YACrE,MAAM,eAAe,IAAI,CAAC,iBAAkB,CAAA,IAAI,CAAC,4BAA6B,gBAAgB,gBAAiB,CAAA;YAC/G,MAAM,YAAY,KAAK,IAAI,KAAK,IAAI,CAAC,cAAe,CAAA,IAAI,CAAC,yBAAyB,gBAAgB,CAAA;YAClG,QAAQ,KAAK;gBAAC,IAAI;gBAAG,IAAI;gBAAG;gBAAW;aAAa,GAAE,gBAAgB;QAC1E;QAEA,MAAM,eAAe,OAAO,IAAI,CAAC,iBAAiB;QAClD,IAAI,MAAM,aAAa,MAAM,WACzB,IAAI,CAAC,WAAW,SAAS,cAAc;aAEvC,IAAI,CAAC,WAAW,IAAI,GAAG,GAAG,cAAc;QAG5C,4BAA4B;QAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAAK;YACrC,MAAM,OAAO,OAAO,CAAC,EAAE;YACvB,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE;QACnD;QAEA,IAAI,CAAC;QAEL,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,WAAW,QAAQ,IACxC,OAAO,IAAI,CAAC,eAAe,IAAI,CAAC,UAAU,CAAC,EAAE;IAErD;IAIA,mBAAmB;IAEnB,aAAe;aAlNP,UAAoC,CAAC;aACrC,UAA8B,IAAI,CAAA,GAAA,MAAC,EAAE;aAGrC,eAAqB;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC;aACtC,cAAsB;aACtB,iBAAyB;aACzB,iBAAyB;aACzB,yBAAkC;aAClC,4BAAqC;aACrC,wBAAiC;aAEjC,kBAA0B;aAC1B,YAA4B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aACpD,aAA6B;YAAC,GAAG;YAAG,GAAG;YAAG,UAAU;QAAC;aAGrD,YAAqB;aAOrB,gBAA2B,CAAC;aAE5B,aAA8B,EAAE;aAEhC,cAAyB,EAAE;IAsLlB;IAEjB,UAAW,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC9C,IAAI,CAAC,eAAe;YAChB,MAAM;gBAAC;gBAAS;aAAc;YAC9B,SAAS,EAAE;QACf;QAEA,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,GAAG;QACnB,MAAM,eAAe,IAAI,CAAC,4BAA6B,IAAI,CAAC,iBAAiB,IAAI,IAAK,IAAI,CAAC;QAC3F,MAAM,YAAY,IAAI,CAAC,yBAAyB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAEzG,IAAI,CAAC,UAAU;QACf,IAAI,CAAC,YAAY;QAEjB,IAAI,CAAC,gBAAgB,IAAI,UAAU,IAAI,CAAC,QAAQ,OAAO,OAAO,IAAI,CAAC,QAAQ,OAAO;QAClF,MAAM,aAAa,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,QAAQ,aAAa,KAAK,KAAK,IAAI,CAAC,QAAQ,OAAO,SAAS;QAC7G,IAAI,CAAC,cAAc,IAAI,OAAO,YAAY,MAAM,IAAI,IAAI,IAAM;QAE9D,IAAI,CAAC,QAAQ,GAAG,GAAG,WAAW;QAE9B,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC;QACxC,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,WAAW;QAC1B,IAAI,CAAC,WAAW,WAAW;QAE3B,IAAI,CAAC,uBAAuB;IAChC;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC3C,IAAI,CAAC,IAAI,CAAC,WACN;QAGJ,IAAI,CAAC;QACL,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,GAAG;QAChC,MAAM,YAAY,IAAI,CAAC,yBACnB,KAAK,IAAI,KAAK,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QAEnF,IAAI,CAAC,aAAa,GAAG,GAAG,WAAW,IAAI,CAAC,UAAU;QAGlD,IAAI,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,QAAQ,aACT,IAAI,CAAC,eACL,GACA,GACA,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,aAAa,KAAK,GAC9C,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,aAAa,KAAK;YAElD,IAAI,CAAC,2BACD,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa;QAE1B;QAEA,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,UAAU,IAAI;QACnB,IAAI,CAAC,WAAW,WAAW,IAAI,CAAC,UAAU;QAC1C,IAAI,CAAC,UAAU,WAAW;IAC9B;IAEA,UAAiB;QACb,IAAI,CAAC;QACL,MAAM,YAAY,IAAI,CAAC,yBACnB,KAAK,IAAI,KAAK,IAAI,CAAC,UAAU,WAAW,IAAI,CAAC,eAAe,KAAK,IAAI,KAAK,IAAI,CAAC;QACnF,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,aAAa,WAAW,WAAW,WAAW,IAAI,CAAC,UAAU;QAClE,IAAI,CAAC,QAAQ;QAEb,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,aAAa;QAElB,IAAI,IAAI,CAAC,cAAc;YACnB,IAAI,CAAC,QAAQ,aACT,IAAI,CAAC,eACL,GACA,GACA,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,aAAa,KAAK,GAC9C,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,aAAa,KAAK;YAElD,IAAI,CAAC,2BACD,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa,IAClB,IAAI,CAAC,aAAa;QAE1B;QAEA,IAAI,IAAI,CAAC,gBAAgB,IAAI,CAAC,sBAAsB;YAChD,IAAI,YAA2C,IAAI,CAAC;YACpD,IAAI,CACA,CAAA,IAAI,CAAC,qBAAqB,OAAO,KACjC,IAAI,CAAC,qBAAqB,OAAO,KACjC,IAAI,CAAC,qBAAqB,MAAM,IAAI,CAAC,QAAQ,OAAO,QAAQ,KAC5D,IAAI,CAAC,qBAAqB,MAAM,IAAI,CAAC,QAAQ,OAAO,SAAS,CAAA,GAC9D;gBAEC,wEAAwE;gBACxE,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,OACjB,IAAI,CAAC,qBAAqB,KAAK,IAAI,CAAC,qBAAqB,KAAK,GAC9D,IAAI,CAAC,qBAAqB,KAAK,IAAI,CAAC,qBAAqB,KAAK;gBAElE,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,IAAI;gBACtB,OAAO,UAAU,IAAI,CAAC,QAAQ,QAAQ,CAAC,IAAI,CAAC,qBAAqB,IAAI,CAAC,IAAI,CAAC,qBAAqB;gBAEhG,YAAY,WAAW,sEAAsE;YACjG;YACA,IAAI,CAAC,aAAa,QAAQ,KAAK;gBAC3B,QAAQ;gBACR,QAAQ;oBACJ;oBACA,IAAI,CAAC,qBAAqB;oBAC1B,IAAI,CAAC,qBAAqB;iBAC7B;YACL;YACA,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC;YACvB,IAAI,CAAC,eAAe;QACxB;QACA,IAAI,CAAC,gBAAgB,CAAC;IAC1B;IAEA,UAAW,EAAiC,EAAE,CAAS,EAAE,CAAS,EAAQ;QACtE,IAAI,cAAc,WACd,IAAI,CAAC,QAAQ,aAAa,IAAI,GAAG;aAC9B;YACH,IAAI,CAAC,QAAQ,UAAU,GAAG,GAAG,GAAG,OAAO,GAAG;YAC1C,IAAI,CAAC,QAAQ,UAAU,IAAI,GAAG;QAClC;IACJ;IAEA,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;QACnE;IACA;;;;;;;;;;;;;;;;;;;;;;;;;;;kCA2B0B,GAC9B;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,SAAU,CAAO,EAAQ;QACrB,IAAI,IAAI,CAAC,aAAa,MAAM,EAAE,KAAK,IAAI,CAAC,aAAa,MAAM,EAAE,KAAK,IAAI,CAAC,aAAa,MAAM,EAAE,GACxF;QAEJ,IAAI,CAAC,eAAe;YAAC,GAAG,EAAE;YAAG,GAAG,EAAE;YAAG,GAAG,EAAE;QAAC;IAC/C;IAEA,WAAY,CAA2B,EAAQ;QAC3C,IAAI,CAAC,UAAU;IACnB;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,cAAc;IACvB;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,yBAAyB;IAClC;IAEA,gBAAiB,CAAU,EAAQ;QAC/B,IAAI,CAAC,4BAA4B;IACrC;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,wBAAwB;IACjC;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;;;ACtqBA,gDAAa;AAdb;AAIA;AACA;AASO,MAAM;IAwBD,2BAA4B,CAAS,EAAE,CAAS,EAAQ;QAC5D,IAAI,SAAS;YAAE,IAAI;YAAG,IAAI;YAAG,IAAI;YAAG,IAAI;QAAC;QACzC,IAAI,IAAI,CAAC,kBACL,SAAS,CAAA,GAAA,MAAC,EAAE,aACR,QACA;YACI,IAAI,CAAC,IAAI,IAAI,CAAC,WAAW;YACzB,IAAI;YACJ,IAAI,CAAC,IAAI,IAAI,CAAC,WAAW;YACzB,IAAI;QACR;QAGR,IAAI,IAAI,CAAC,kBACL,SAAS,CAAA,GAAA,MAAC,EAAE,aACR,QACA;YACI,IAAI;YACJ,IAAI,CAAC,IAAI,IAAI,CAAC,WAAW;YACzB,IAAI;YACJ,IAAI,CAAC,IAAI,IAAI,CAAC,WAAW;QAC7B;QAGR,MAAM,SAAS,IAAI,CAAC,gBAAgB,WAAW,IAAI,CAAC,cAAc,IAAI;QACtE,OAAO,KAAK,KAAK,MAAM,OAAO,KAAK;QACnC,OAAO,KAAK,KAAK,MAAM,OAAO,KAAK;QACnC,OAAO,KAAK,KAAK,KAAK,OAAO,KAAK;QAClC,OAAO,KAAK,KAAK,KAAK,OAAO,KAAK;QAElC,IAAI,CAAC,uBAAuB,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,sBAAsB;IAC3E;IAEQ,YAAmB;QACvB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,UAAU,GAAG,GAAG,IAAI,CAAC,QAAQ,OAAO,OAAO,IAAI,CAAC,QAAQ,OAAO;QAC5E,IAAI,CAAC,QAAQ,UAAU,IAAI,CAAC,YAAY,GAAG;QAE3C,MAAM,QAAQ;YAAC,GAAG,IAAI,CAAC,YAAY;QAAA;QACnC,IAAI,IAAI,CAAC,iBAAiB;YACtB,MAAM,IAAI,CAAA,GAAA,uBAAU;YACpB,MAAM,IAAI,CAAA,GAAA,uBAAU;YACpB,MAAM,IAAI,CAAA,GAAA,uBAAU;YACpB,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;iBAExC,IAAI,CAAC,QAAQ,2BAA2B;QAEhD,OACI,IAAI,IAAI,CAAC,uBACL,IAAI,CAAC,QAAQ,2BAA2B;QAIhD,IAAI,IAAI,CAAC,KAAK,SAAS,GAAG;YAEtB,OAAO;YACP,MAAM,OAAO,IAAI;YACjB,IAAI,CAAC,KAAK,QAAQ,CAAC,MAAM;gBACrB,IAAI,UAAU,GACV,KAAK,OAAO,KAAK,GAAG,KAAK;qBAEzB,KAAK,OAAO,KAAK,GAAG,KAAK;YAEjC;YAEA,IAAI,QAAiC,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;gBAC7D,GAAG,MAAM;gBACT,GAAG,MAAM;gBACT,GAAG,MAAM;gBACT,GAAG,IAAI,CAAC;YACZ;YACA,IAAI,IAAI,CAAC,iBAAiB;gBACtB,MAAM,aAAa,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE,CAAC;gBACpE,MAAM,WAAW,IAAI,CAAC,QAAQ,qBAC1B,GAAG,aAAa,IAAI,CAAC,OAAO,IAAI,CAAC,MACjC,GAAG,aAAa,IAAI,CAAC,OAAO,IAAI,CAAC;gBAErC,SAAS,aACL,GACA,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;oBACxB,GAAG,MAAM;oBACT,GAAG,MAAM;oBACT,GAAG,MAAM;oBACT,GAAG,IAAI,CAAC;gBACZ;gBAEJ,SAAS,aACL,GACA,CAAA,GAAA,MAAC,EAAE,eAAe,UAAU;oBACxB,GAAG,MAAM;oBACT,GAAG,MAAM;oBACT,GAAG,MAAM;oBACT,GAAG;gBACP;gBAEJ,QAAQ;YACZ;YAEA,eAAe;YACf,IAAI,IAAI,CAAC,gBAAgB,QACrB,IAAI,CAAC,QAAQ,YAAY;iBAEtB;gBACH,IAAI,CAAC,QAAQ,YAAY,IAAI,CAAC,cAAc;gBAC5C,IAAI,CAAC,QAAQ,WAAW;gBACxB,IAAI,CAAC,QAAQ,cAAc;YAC/B;YAEA,OAAO;YACP,MAAM,OAAO;gBACT,IAAI,IAAI,CAAC,gBAAgB,QACrB,IAAI,CAAC,QAAQ,KAAK;qBAElB,IAAI,CAAC,QAAQ,OAAO;YAE5B;YAEA;YACA,IAAI,IAAI,CAAC,kBAAkB;gBACvB,IAAI,CAAC,QAAQ;gBACb,IAAI,CAAC,QAAQ,UAAU,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG;gBACtD,IAAI,CAAC,QAAQ,MAAM,IAAI;gBACvB,IAAI,CAAC,QAAQ,UAAU,CAAC,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG;gBACvD;gBACA,IAAI,CAAC,QAAQ;YACjB;YACA,IAAI,IAAI,CAAC,kBAAkB;gBACvB,IAAI,CAAC,QAAQ;gBACb,IAAI,CAAC,QAAQ,UAAU,GAAG,IAAI,CAAC,QAAQ,OAAO,SAAS;gBACvD,IAAI,CAAC,QAAQ,MAAM,GAAG;gBACtB,IAAI,CAAC,QAAQ,UAAU,GAAG,CAAC,IAAI,CAAC,QAAQ,OAAO,SAAS;gBACxD;gBACA,IAAI,CAAC,QAAQ;gBACb,IAAI,IAAI,CAAC,kBAAkB;oBACvB,IAAI,CAAC,QAAQ;oBACb,IAAI,CAAC,QAAQ,UAAU,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,IAAI,CAAC,QAAQ,OAAO,SAAS;oBACnF,IAAI,CAAC,QAAQ,MAAM,IAAI;oBACvB,IAAI,CAAC,QAAQ,UAAU,CAAC,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,CAAC,IAAI,CAAC,QAAQ,OAAO,SAAS;oBACrF;oBACA,IAAI,CAAC,QAAQ;gBACjB;YACJ;QACJ;QAEA,IAAI,CAAC,QAAQ;IACjB;IAEA,kBAAkB;IAClB,aAAe;aA3KP,UAAoC,CAAC;aACrC,eAAqB,CAAC;aACtB,cAAsB,KAAM,uBAAuB;;aACnD,iBAAyB,EAAG,MAAM;;aAClC,wBAAiC;aACjC,kBAA2B;aAC3B,cAA0B;aAC1B,iBAAyB,EAAG,QAAQ;;aACpC,mBAA4B;aAC5B,mBAA4B;aAC5B,kBAA2B;aAE3B,YAAqB;aAErB,UAA8B,IAAI,CAAA,GAAA,MAAC,EAAE;aAErC,aAAgC,CAAC;aACjC,OAAiC,EAAE;aACnC,OAAe;aACf,OAAe;IAyJvB;IAEA,WAAY,CAAqB,EAAQ;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC,gBAAgB,WAAW,IAAI,CAAC,cAAc;IAC9D;IAEA,QAAS,CAAS,EAAQ;QACtB,IAAI,CAAC,cAAc;IACvB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,CAAS,EAAQ;QACzB,IAAI,CAAC,iBAAiB;IAC1B;IAEA,SAAU,CAAO,EAAQ;QACrB,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,QAAQ;IACnC;IAEA,WAAY,CAA2B,EAAE;QACrC,IAAI,CAAC,UAAU;IACnB;IAEA,QAAS,IAAgB,EAAQ;QAC7B,IAAI,CAAC,cAAc;IACvB;IAEA,UAAuB;QACnB,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,OAAe,EAAQ;QAC/B,IAAI,CAAC,iBAAiB,CAAA,GAAA,MAAC,EAAE,MAAM,SAAS,GAAG;IAC/C;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,mBAAmB;IAC5B;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,mBAAmB;IAC5B;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAa,CAAU,EAAQ;QAC3B,IAAI,CAAC,kBAAkB;IAC3B;IAEA,cAAwB;QACpB,OAAO,IAAI,CAAC;IAChB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,CAAU,EAAQ;QAC5B,IAAI,CAAC,wBAAwB;IACjC;IAEA,cAAwB;QACpB,OAAO,IAAI,CAAC;IAChB;IAEA,YAAa,CAAU,EAAQ;QAC3B,IAAI,CAAC,kBAAkB;IAC3B;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAW,CAAS,EAAE,CAAS,EAAQ;QACnC,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,OAAO;YAAC;gBAAC;gBAAG;YAAC;SAAE;QACpB,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,QAAQ,OAAO,OAAO,IAAI,CAAC,QAAQ,OAAO;QAC3E,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,YAAY,UAAU,IAAI,CAAC,QAAQ,QAAQ,GAAG;QAC1D,IAAI,CAAC,uBAAuB;QAC5B,IAAI,CAAC,2BAA2B,GAAG;IACvC;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAQ;QAChC,IAAI,CAAC,IAAI,CAAC,WACN;QAGJ,MAAM,MAAM;YAAE;YAAG;QAAE;QACnB,IAAI,IAAI,CAAC,iBAAiB,GAAG;YACzB,IAAI,KAAK,AAAC,CAAA,KAAK,WAAW,GAAE,IAAK,IAAI,CAAC,iBAAiB;YACvD,IAAI,KAAK,AAAC,CAAA,KAAK,WAAW,GAAE,IAAK,IAAI,CAAC,iBAAiB;QAC3D;QAEA,IAAI,CAAC,OAAO,KAAK,IAAI,IAAI,CAAC,MAAM,IAAI;QACpC,IAAI,CAAC,OAAO,KAAK,IAAI,IAAI,CAAC,MAAM,IAAI;QACpC,IAAI,CAAC,KAAK,KAAK;QACf,IAAI,CAAC,2BAA2B,GAAG;QACnC,IAAI,CAAC;IACT;IAEA,UAAiB;QACb,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,uBAAuB,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,sBAAsB,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,WAAW;QAC9G,IAAI,IAAI,CAAC,KAAK,SAAS,KAAK,IAAI,CAAC,sBAAsB;YACnD,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,OACrB,IAAI,CAAC,qBAAqB,KAAK,IAAI,CAAC,qBAAqB,KAAK,GAC9D,IAAI,CAAC,qBAAqB,KAAK,IAAI,CAAC,qBAAqB,KAAK;YAElE,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;YAC1B,WAAW,UAAU,IAAI,CAAC,QAAQ,QAAQ,CAAC,IAAI,CAAC,qBAAqB,IAAI,CAAC,IAAI,CAAC,qBAAqB;YAEpG,IAAI,CAAC,QAAQ,KAAK;gBACd,MAAM;oBAAC;oBAAS;iBAAa;gBAC7B,SAAS;oBACL;wBACI,QAAQ;wBACR,QAAQ;4BACJ;4BACA,IAAI,CAAC,qBAAqB;4BAC1B,IAAI,CAAC,qBAAqB;yBAC7B;oBACL;iBACH;YACL;QACJ;QACA,IAAI,CAAC,OAAO,EAAE;QACd,IAAI,CAAC,aAAa,CAAC;IACvB;IAEA,UAAW,EAAqB,EAAE,CAAS,EAAE,CAAS,EAAQ;QAC1D,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,QAAQ,UAAU,GAAG,GAAG,GAAG,OAAO,GAAG;QAC1C,IAAI,CAAC,QAAQ,UAAU,IAAI,GAAG;QAC9B,IAAI,CAAC,QAAQ;IACjB;IAEA,gBAAiB,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAQ;IACnE,8BAA8B;IAClC;AACJ;;;;;+CC3Ua;AAfb;AACA;AACA;AACA;AACA;AACA;AACA;AASO,MAAM,YAET;IACA,UAAU,CAAA,GAAA,sBAAS;IACnB,YAAY,CAAA,GAAA,0BAAW;IACvB,cAAc,CAAA,GAAA,8BAAa;IAC3B,YAAY,CAAA,GAAA,0BAAW;IACvB,YAAY,CAAA,GAAA,0BAAW;IACvB,aAAa,CAAA,GAAA,4BAAY;IACzB,aAAa,CAAA,GAAA,4BAAY;AAC7B;;;;;gDCVa;AAfb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AAIO,MAAM,aAAa,AAAC;IACvB,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,2BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,YAAY;YACR,KAAK;YACL,KAAK;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,KAAK,KAAK;QAC7C;QACA,eAAe;YACX,KAAK;YACL,KAAK;YACL,OAAO;gBAAC;oBAAC;oBAAG;iBAAM;gBAAE;oBAAC;oBAAK;iBAAO;gBAAE;oBAAC;oBAAG;iBAAE;aAAC;QAC9C;IACJ;IAEA,IAAI,aAAa;QACb,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;QACL,CAAA,GAAA,cAAG,EAAE;KACR;IACD,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE;QAC9B,aAAa;YACT,CAAA,GAAA,cAAG,EAAE;YACL,CAAA,GAAA,cAAG,EAAE;YACL,CAAA,GAAA,cAAG,EAAE;YACL,CAAA,GAAA,cAAG,EAAE;SACR;IACL;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QACrB,IAAI;QACJ,IAAI;QAEJ,MAAM,eAAe,IAAI,CAAA,GAAA,gBAAM,EAAE;YAC7B,WAAW;gBAAC;gBAAG;gBAAG;gBAAG;aAAE,CAAC,IAAI,CAAA;gBAExB,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;oBAChB,WAAW;oBACX,KAAK;wBACD,OAAO;wBACP,QAAQ;wBACR,gBAAgB;wBAChB,QAAQ;oBACZ;gBACJ;gBACA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI;gBAC7B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;gBACnB,IAAI,OAAO,KAAK,OAAO;oBACnB,IAAI,OAAO,GAAG;wBACV,IAAI;wBACJ,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,KAAK;wBAChC,IAAI;wBACJ,IAAI;oBACR,OACI,IAAI,SAAS,GAAG,GAAG,IAAI;uBAExB,IAAI,OAAO,GACd,IAAI,UAAU,CAAA,GAAA,4BAAc,EAAE,KAAK,GAAG;qBACnC,IAAI,OAAO,GACd,IAAI,UAAU,CAAA,GAAA,4BAAc,EAAE,KAAK,GAAG;gBAE1C,MAAM,MAAM,kBAAkB,SAAS,OAAO,UAAU,eAAe;gBAEvE,OAAO;oBACH,IAAI;oBACJ,OAAO;oBACP,OAAO,UAAU,CAAC,GAAG;gBACzB;YACJ;YACA,QAAQ;YACR,UAAU,CAAC;gBACP,MAAM,SAAS;YACnB;QACJ;QAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACjC,MAAM,MAAM;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,SAAU,CAAC;gBACjB,MAAM,aAAa;YACvB;YACA,aAAa;YACb,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBACD,SAAS;YACb;QACJ;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;YAAC;gBAAC;gBAAG;aAAG;YAAE;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAI;aAAE;YAAE;gBAAC;gBAAI;aAAE;YAAE;gBAAC;gBAAI;aAAI;YAAE;gBAAC;gBAAK;aAAE;SAAC;QAExG,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;YACd,MAAM,WAAW,KAAK,IAAI,GAAG,cAAc,YAAY,SAAS;QACpE;QAEA,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO,MAAM;gBACb,OAAO,eAAe,WAAW;gBACjC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,QAAQ;oBACR,EAAE,aAAa;gBACnB;gBACA,YAAY,CAAC;oBACT,IAAI,eAAe,IACf,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc;yBAE9B,OAAO,KAAK,MAAM;gBAE1B;gBACA,wBAAwB;YAC5B;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,eAAe,cAAc;gBACpC,OAAO,eAAe,cAAc;gBACpC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YAEA,MAAM,qBAAqB,CAAA,GAAA,gDAAsB,EAAE,MAAM,SAAU,CAAC;gBAChE,MAAM,aAAa;YACvB;YACA,MAAM,wBAAwB,CAAA,GAAA,gDAAsB,EAAE,OAAO,SAAU,CAAC;gBACpE,MAAM,gBAAgB;YAC1B;YAEA,IAAI,OACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,WAAW;oBACX;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;oBACZ,cAAc;gBAClB;YACJ,IACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,cAAc;oBACd;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;gBAChB;YACJ,IACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS,aAAa;gBACtB,KAAK;oBACD,WAAW;gBACf;YACJ,IACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS,gBAAgB;gBACzB,KAAK;oBACD,WAAW;gBACf;YACJ;QAGR;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB,CAAC;QAEtC;QAEA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS;QACxB;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS;QAC3B;QAEA,IAAI,CAAC,WAAW,SAAU,CAAC;YACvB,MAAM,SAAS;QACnB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC9B,MAAM,UAAU,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC3B,MAAM,OAAO,GAAG,GAAG;QACvB;QACA,IAAI,CAAC,UAAU,SAAU,CAAC,EAAE,CAAC;YACzB,MAAM,QAAQ,GAAG;QACrB;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IACA,OAAO;AACX;;;;;gDCnQa;AAAN,MAAM,aAAa;;;ACD1B,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;;;kDCYlG;AAZb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAGO,MAAM,eAAe,AAAC;IACzB,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,6BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,YAAY;YACR,KAAK;YACL,KAAK;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,KAAK,KAAK;QAC7C;QACA,eAAe;YACX,KAAK;YACL,KAAK;QACT;IACJ;IAEA,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE;IAClC;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QAErB,IAAI;QACJ,IAAI;QAEJ,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;QAClB;QAEA,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO;gBACP,OAAO,eAAe,WAAW;gBACjC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,QAAQ;oBACR,EAAE,aAAa;gBACnB;YACJ;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,MAAM;gBACb,OAAO,eAAe,cAAc;gBACpC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YACA,MAAM,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAChC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,MAAM;gBACb,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,SAAU,GAAG;oBACnB,MAAM,YAAY;gBACtB;YACJ;YACA,eAAe,aAAa,MAAM,YAAY;YAE9C,MAAM,qBAAqB,CAAA,GAAA,gDAAsB,EAAE,MAAM,SAAU,CAAC;gBAChE,MAAM,gBAAgB;YAC1B;YACA,MAAM,wBAAwB,CAAA,GAAA,gDAAsB,EAAE,OAAO,SAAU,CAAC;gBACpE,MAAM,mBAAmB;YAC7B;YAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACjC,MAAM,MAAM;gBACZ,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,UAAU,SAAU,CAAC;oBACjB,MAAM,aAAa;gBACvB;gBACA,aAAa;gBACb,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,KAAK;oBACD,WAAW;oBACX,SAAS;gBACb;YACJ;YAGA,IAAI,OACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,WAAW;oBACX;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;oBACZ,cAAc;gBAClB;YACJ,IACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,cAAc;oBACd;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;gBAChB;YACJ,IACA,eAAe,cACf,gBAAgB;QAExB;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,gBACP,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,gBACP,WAAW,kBAAkB,CAAC;QAEtC;QAEA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS;QACxB;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS;QAC3B;QAEA,IAAI,CAAC,WAAW,SAAU,CAAC;YACvB,MAAM,SAAS;QACnB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC9B,MAAM,UAAU,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,WAAW;YACxC,MAAM,OAAO,GAAG,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,UAAU;YACX,MAAM;QACV;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IAEA,OAAO;AACX;;;ACvMA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;oDCUpG;AAVb;AACA;AACA;AACA;AACA;;AAEA;AACA;AAGO,MAAM,iBAAiB,AAAC;IAC3B,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,+BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,YAAY;YACR,KAAK;YACL,KAAK;QACT;QACA,eAAe;YACX,KAAK;YACL,KAAK;QACT;IACJ;IAEA,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE;IAClC;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QACrB,IAAI;QACJ,IAAI;QAEJ,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;QAClB;QAEA,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO,MAAM,YAAY;gBACzB,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,SAAU,GAAG;oBACnB,MAAM,QAAQ;oBACd,EAAE,aAAa;gBACnB;gBACA,YAAY,CAAC;oBACT,IAAI,eAAe,IACf,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc;yBAE9B,OAAO,KAAK,MAAM;gBAE1B;gBACA,wBAAwB;YAC5B;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,MAAM;gBACb,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YACA,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,MAAM;gBACb,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,SAAU,GAAG;oBACnB,MAAM,YAAY;gBACtB;YACJ;YACA,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,MAAM;gBACb,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,MAAM,SAAS;gBACnB;YACJ;YACA,cAAc,aAAa,MAAM,YAAY;YAC7C,YAAY,aAAa,MAAM,YAAY;YAC3C,YAAY,aAAa,MAAM,YAAY;YAC3C,IAAI,OACA,WAAW,cACX,cAAc,cACd,YAAY,cACZ,YAAY;QAEpB;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB,CAAC;QAEtC;QACA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS;QACxB;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS;QAC3B;QACA,IAAI,CAAC,WAAW,SAAU,CAAC;YACvB,MAAM,SAAS;QACnB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,QAAQ;YACrC,MAAM,UAAU,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,QAAQ;YAClC,MAAM,OAAO,GAAG,GAAG,UAAU;QACjC;QACA,IAAI,CAAC,UAAU;YACX,MAAM;QACV;QACA,IAAI,CAAC,UAAU;YACX,OAAO,SAAS,KAAK,MAAM;QAC/B;QACA,IAAI,CAAC,UAAU,SAAU,CAAC;YACtB,MAAM,QAAQ,SAAS,KAAK;QAChC;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IAEA,OAAO;AACX;;;AC/KA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,+BAA+B,MAAM,KAAK;;;;;kDCYtG;AAZb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAGO,MAAM,eAAe,AAAC;IACzB,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,6BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,YAAY;YACR,KAAK;YACL,KAAK;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,KAAK,KAAK;QAC7C;QACA,eAAe;YACX,KAAK;YACL,KAAK;YACL,OAAO;gBAAC;oBAAC;oBAAG;iBAAQ;gBAAE;oBAAC;oBAAK;iBAAI;gBAAE;oBAAC;oBAAG;iBAAE;aAAC;QAC7C;IACJ;IAEA,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE;IAClC;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QACrB,IAAI;QACJ,IAAI;QAEJ,MAAM,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACjC,MAAM,MAAM;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,SAAU,CAAC;gBACjB,MAAM,aAAa;YACvB;YACA,aAAa;YACb,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,KAAK;gBACD,aAAa;YACjB;QACJ;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,MAAM,MAAM;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,SAAU,CAAC;gBACjB,MAAM,YAAY;YACtB;YACA,KAAK;gBACD,aAAa;YACjB;QACJ;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,MAAM,MAAM;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,SAAU,CAAC;gBACjB,MAAM,aAAa;YACvB;QACJ;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;YAAC;gBAAC;gBAAK;aAAK;YAAE;gBAAC;gBAAK;aAAE;SAAC;QAEvE,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;YACd,MAAM,WAAW,cAAc,YAAY,QAAQ;QACvD;QAEA,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO,MAAM;gBACb,OAAO,eAAe,WAAW;gBACjC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,QAAQ;oBACR,EAAE,aAAa;gBACnB;YACJ;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,eAAe,cAAc;gBACpC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YAEA,MAAM,qBAAqB,CAAA,GAAA,gDAAsB,EAAE,MAAM,SAAU,CAAC;gBAChE,MAAM,aAAa;YACvB;YAEA,IAAI,OACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,WAAW;oBACX;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;oBACZ,cAAc;gBAClB;YACJ,IACA,cAAc;YAGlB,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;gBACpB,QAAQ;gBACR,KAAK;oBACD,SAAS;oBACT,WAAW;gBACf;YACJ;YAEA,UAAU,OACN,gBAAgB,cAChB,aAAa,cACb,aAAa;QAErB;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB,CAAC;QAEtC;QAEA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS,OAAO;QAC/B;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS,UAAU;QACrC;QAEA,IAAI,CAAC,WAAW,SAAU,CAAC;YACvB,MAAM,SAAS;QACnB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC9B,MAAM,UAAU,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC3B,MAAM,OAAO,GAAG,GAAG;QACvB;QACA,IAAI,CAAC,UAAU,SAAU,CAAC,EAAE,CAAC;YACzB,MAAM,QAAQ,GAAG;QACrB;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,eAAe;YAChB,aAAa,SAAS,CAAC,aAAa;YACpC,MAAM,YAAY,aAAa;QACnC;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IACA,OAAO;AACX;;;AC7MA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;mDCYpG;AAZb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAGO,MAAM,gBAAgB,AAAC;IAC1B,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,8BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE,YAAY;QAC1B,YAAY;YACR,KAAK;YACL,KAAK;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,KAAK,KAAK;QAC7C;QACA,eAAe;YACX,KAAK;YACL,KAAK;QACT;IACJ;IAEA,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE,YAAY;IAC9C;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QAErB,IAAI;QACJ,IAAI;QACJ,IAAI,kBAAkB;QAEtB,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;QAClB;QAEA,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO;gBACP,OAAO,eAAe,WAAW;gBACjC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,QAAQ;oBACR,EAAE,aAAa;gBACnB;gBACA,YAAY,CAAC;oBACT,IAAI,eAAe,IACf,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc;yBAE9B,OAAO,KAAK,MAAM;gBAE1B;gBACA,wBAAwB;YAC5B;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,eAAe,cAAc;gBACpC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YAEA,MAAM,qBAAqB,CAAA,GAAA,gDAAsB,EAAE,MAAM,SAAU,CAAC;gBAChE,MAAM,aAAa;YACvB;YACA,MAAM,wBAAwB,CAAA,GAAA,gDAAsB,EAAE,OAAO,SAAU,CAAC;gBACpE,MAAM,gBAAgB;YAC1B;YAEA,IAAI,OACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,WAAW;oBACX;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;oBACZ,cAAc;gBAClB;YACJ,IACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,cAAc;oBACd;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;gBAChB;YACJ;YAGJ,MAAM,qBAAqB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACpC,MAAM;gBACN,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,UAAU,SAAU,CAAC;oBACjB,kBAAkB;oBAClB,MAAM,iBAAiB;gBAC3B;gBACA,KAAK;oBACD,WAAW;gBACf;YACJ;YACA,IAAI,OAAO,mBAAmB;QAClC;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,aACP,WAAW,kBAAkB,CAAC;QAEtC;QACA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS;QACxB;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS;QAC3B;QACA,IAAI,CAAC,WAAW,YAChB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC9B,MAAM,UAAU,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC3B,MAAM,OAAO,GAAG,GAAG;QACvB;QACA,IAAI,CAAC,UAAU;YACX,MAAM;QACV;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,qBAAqB;YACtB,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IAEA,OAAO;AACX;;;AC5LA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;;;mDCYrG;AAZb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAGO,MAAM,gBAAgB,AAAC;IAC1B,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,8BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,YAAY;YACR,KAAK;YACL,KAAK;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,KAAK,KAAK;QAC7C;QACA,eAAe;YACX,KAAK;YACL,KAAK;YACL,OAAO;gBAAC;oBAAC;oBAAG;iBAAQ;gBAAE;oBAAC;oBAAK;iBAAI;gBAAE;oBAAC;oBAAG;iBAAE;aAAC;QAC7C;IACJ;IAEA,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE;IAClC;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QACrB,IAAI;QACJ,IAAI;QAEJ,MAAM,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACjC,MAAM,MAAM;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,SAAU,CAAC;gBACjB,MAAM,aAAa;YACvB;YACA,aAAa;YACb,OAAO,CAAA,GAAA,cAAG,EAAE;QAChB;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;YAAC;gBAAC;gBAAG;aAAG;YAAE;gBAAC;gBAAG;aAAE;YAAE;gBAAC;gBAAI;aAAE;YAAE;gBAAC;gBAAI;aAAE;YAAE;gBAAC;gBAAI;aAAI;YAAE;gBAAC;gBAAK;aAAE;SAAC;QAExG,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;YACd,MAAM,WAAW,KAAK,IAAI,GAAG,cAAc,YAAY,SAAS;QACpE;QAEA,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO,MAAM;gBACb,OAAO,eAAe,WAAW;gBACjC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,QAAQ;oBACR,EAAE,aAAa;gBACnB;gBACA,YAAY,CAAC;oBACT,IAAI,eAAe,IACf,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc;yBAE9B,OAAO,KAAK,MAAM;gBAE1B;gBACA,wBAAwB;YAC5B;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,MAAM;gBACb,OAAO,eAAe,cAAc;gBACpC,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YAEA,MAAM,qBAAqB,CAAA,GAAA,gDAAsB,EAAE,OAAO,SAAU,CAAC;gBACjE,MAAM,aAAa;YACvB;YACA,MAAM,wBAAwB,CAAA,GAAA,gDAAsB,EAAE,OAAO,SAAU,CAAC;gBACpE,MAAM,gBAAgB;YAC1B;YAEA,IAAI,OACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,WAAW;oBACX;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;oBACZ,cAAc;gBAClB;YACJ,IACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,cAAc;oBACd;iBACH;gBACD,KAAK;oBACD,SAAS;oBACT,gBAAgB;oBAChB,YAAY;gBAChB;YACJ;YAGJ,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;gBACpB,QAAQ;gBACR,KAAK;oBACD,WAAW;gBACf;YACJ;YACA,UAAU,OAAO,gBAAgB;QAErC;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,gBACP,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,gBACP,WAAW,kBAAkB,CAAC;QAEtC;QAEA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS;QACxB;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS;QAC3B;QAEA,IAAI,CAAC,WAAW,SAAU,CAAC;YACvB,MAAM,SAAS;QACnB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC9B,MAAM,UAAU,GAAG,GAAG;QAC1B;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC3B,MAAM,OAAO,GAAG,GAAG;QACvB;QACA,IAAI,CAAC,UAAU;YACX,MAAM;QACV;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IACA,OAAO;AACX;;;ACpMA,OAAO,UAAU,QAAQ,mBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;;;kDCarG;AAbb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAGO,MAAM,eAAe,AAAC;IACzB,MAAM,iBAAiB;QACnB,OAAO,CAAA,GAAA,6BAAW;QAClB,SAAS,CAAA,GAAA,cAAG,EAAE;QACd,YAAY;YACR,KAAK;YACL,KAAK;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,MAAM,IAAI;YACzC,YAAY;QAChB;QACA,eAAe;YACX,KAAK;YACL,KAAK;QACT;IACJ;IAEA,CAAA,GAAA,yBAAc,EAAE,UAAU;QACtB,eAAe,UAAU,CAAA,GAAA,cAAG,EAAE;IAClC;IAEA,eAAe,KAAK,SAAU,CAAC;QAC3B,MAAM,MAAM,SAAS,cAAc,QAAQ,UAAU;QACrD,MAAM,QAAQ,IAAI,CAAA,GAAA,gBAAM,EAAE;QAC1B,MAAM,WAAW,CAAA,GAAA,oBAAQ;QACzB,EAAE,aAAa,MAAM;QAErB,IAAI;QACJ,IAAI;QAEJ,SAAS,QAAS,IAAY;YAC1B,MAAM,QAAQ;QAClB;QAEA,IAAI;QAEJ,SAAS;YACL,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,WAAW;gBAC/B,KAAK,eAAe,WAAW;gBAC/B,OAAO,MAAM;gBACb,OAAO,eAAe,WAAW;gBACjC,YAAY,CAAA,GAAA,yBAAS;gBACrB,WAAW,MAAM,cAAc;gBAC/B,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,QAAQ;oBACR,EAAE,aAAa;gBACnB;gBACA,YAAY,CAAC;oBACT,IAAI,eAAe,GACf,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,cAAc;yBAE9B,OAAO,KAAK,MAAM;gBAE1B;gBACA,wBAAwB;YAC5B;YACA,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACzB,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK,eAAe,cAAc;gBAClC,KAAK,eAAe,cAAc;gBAClC,OAAO,MAAM;gBACb,YAAY,CAAA,GAAA,yBAAS;gBACrB,gBAAgB,CAAC,MAAQ,MAAM;gBAC/B,SAAS,CAAC,eAAiB,eAAe;gBAC1C,UAAU,CAAC;oBACP,MAAM,WAAW;oBACjB,EAAE,gBAAgB;gBACtB;YACJ;YAEA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,cAAc;gBAC/B,WAAW;YACf;YAEA,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACxB,MAAM,MAAM;gBACZ,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,UAAU,SAAU,CAAC;oBACjB,MAAM,YAAY;gBACtB;gBACA,KAAK;oBACD,WAAW;oBACX,YAAY;gBAChB;YACJ;YAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBACjC,MAAM,MAAM;gBACZ,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,UAAU,SAAU,CAAC;oBACjB,MAAM,aAAa;gBACvB;gBACA,aAAa;gBACb,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,KAAK;oBACD,WAAW;gBACf;YACJ;YAEA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;gBACpB,KAAK;oBACD,SAAS;oBACT,WAAW;gBACf;YACJ;YAEA,MAAM,WAAW;YACjB,MAAM,UAAU;YAChB,MAAM,iBAAiB,WAAW,UAAU;YAC5C,MAAM,WAAW,iBAAiB;YAElC,MAAM,cAAc,IAAI,CAAA,GAAA,gBAAM,EAAE;gBAC5B,WAAW;oBACP;wBACI,IAAI;wBACJ,OAAO,CAAA,GAAA,MAAC,EAAE,UAAU;4BAChB,OAAO;4BACP,aAAa;4BACb,OAAO,WAAW;4BAClB,QAAQ,WAAW;4BACnB,aAAa;gCACT;oCACI,aAAa;oCACb,MAAM;oCACN,OAAO,CAAC,kEAAkE,EAAE,eAAe,EAAE,EAAE,eAAe,yBAAyB,CAAC;oCACxI,GAAG;gCACP;6BACH;wBACL;wBACA,OAAO,CAAA,GAAA,cAAG,EAAE;oBAChB;oBACA;wBACI,IAAI;wBACJ,OAAO,CAAA,GAAA,MAAC,EAAE,UAAU;4BAChB,OAAO;4BACP,aAAa;4BACb,OAAO,WAAW;4BAClB,QAAQ,WAAW;4BACnB,aAAa;gCACT;oCACI,aAAa;oCACb,MAAM;oCACN,QAAQ;oCACR,OAAO,CAAC,wFAAwF,EAAE,eAAe,EAAE,EAAE,eAAe,yBAAyB,CAAC;oCAC9J,GAAG;gCACP;6BACH;wBACL;wBACA,OAAO,CAAA,GAAA,cAAG,EAAE;oBAChB;iBACH;gBACD,QAAQ,MAAM;gBACd,UAAU,CAAC;oBACP,MAAM,QAAQ;oBACd,eAAe,WAAW,aAAa,MAAM,cAAc;oBAC3D,WAAW,aAAa,CAAC,eAAe,WAAW;oBAEnD,MAAM,YAAY,MAAM;oBACxB,WAAW,SAAS;oBACpB,EAAE,aAAa;oBACf,EAAE;gBACN;YACJ;YAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,oBAAQ,EAAE;gBAChC,OAAO,CAAA,GAAA,MAAC,EAAE,UAAU;oBAChB,OAAO;oBACP,aAAa;oBACb,OAAO,WAAW;oBAClB,QAAQ,WAAW;oBACnB,aAAa;wBACT;4BACI,aAAa;4BACb,MAAM;4BACN,QAAQ;4BACR,OAAO;4BACP,GAAG,CAAC,EAAE,EAAE,WAAW,QAAQ,CAAC,EAAE,QAAQ,CAAC,EAAE,WAAW,QAAQ,CAAC,EAAE,iBAAiB,QAAQ,CAAC;wBAC7F;qBACH;gBACL;gBACA,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,MAAM,MAAM;gBACZ,UAAU,CAAC;oBACP,MAAM,aAAa;gBACvB;YACJ;YAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,oBAAQ,EAAE;gBAChC,OAAO,CAAA,GAAA,MAAC,EAAE,UAAU;oBAChB,OAAO;oBACP,aAAa;oBACb,OAAO,WAAW;oBAClB,QAAQ,WAAW;oBACnB,aAAa;wBACT;4BACI,aAAa;4BACb,MAAM;4BACN,QAAQ;4BACR,OAAO;4BACP,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,WAAW,QAAQ,CAAC,EAAE,iBAAiB,QAAQ,CAAC,EAAE,WAAW,QAAQ,CAAC;wBAC7F;qBACH;gBACL;gBACA,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,MAAM,MAAM;gBACZ,UAAU,CAAC;oBACP,MAAM,aAAa;gBACvB;YACJ;YAEA,MAAM,iBAAiB,IAAI,CAAA,GAAA,oBAAQ,EAAE;gBACjC,OAAO,CAAA,GAAA,MAAC,EAAE,UAAU;oBAChB,OAAO;oBACP,aAAa;oBACb,OAAO,WAAW;oBAClB,QAAQ,WAAW;oBACnB,aAAa;wBACT;4BACI,aAAa;4BACb,aAAa;gCACT;oCACI,aAAa;oCACb,IAAI;oCACJ,IAAI;oCACJ,IAAI;oCACJ,IAAI;oCACJ,IAAI;oCACJ,aAAa;wCACT;4CACI,aAAa;4CACb,QAAQ;4CACR,cAAc;wCAClB;wCACA;4CACI,aAAa;4CACb,QAAQ;4CACR,cAAc;wCAClB;qCACH;gCACL;6BACH;wBACL;wBACA;4BACI,aAAa;4BACb,MAAM;4BACN,GAAG,KAAK;4BACR,GAAG,KAAK;4BACR,OAAO,KAAK;4BACZ,QAAQ,KAAK;wBACjB;qBACH;gBACL;gBACA,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,MAAM,MAAM;gBACZ,UAAU,CAAC;oBACP,MAAM,YAAY;gBACtB;YACJ;YAEA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,cAAc;gBAC/B,YAAY;YAChB;YACA;gBACI,MAAM,SAAS;oBACX,YAAY;gBAChB;gBACA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,cAAc;gBACnC,CAAA,GAAA,MAAC,EAAE,IAAI,eAAe,cAAc;YACxC;YAEA,UAAU,OACN,YAAY,cACZ,cAAc,cACd,cAAc,cACd,eAAe;YAGnB,IAAI,OACA,WAAW,cACX,cAAc,cACd,WACA,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;oBACL,gBAAgB;oBAChB,aAAa;iBAChB;gBACD,KAAK;oBACD,SAAS;gBACb;YACJ;QAER;QAEA;QAEA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,kBAAkB,MAAM,cAAc,UAC7C,WAAW,kBAAkB;QAErC;QACA,IAAI,CAAC,eAAe,SAAU,CAAC;YAC3B,IAAI,CAAC,MAAM,kBAAkB,MAAM,cAAc,UAC7C,WAAW,kBAAkB,CAAC;QAEtC;QAEA,IAAI,CAAC,UAAU;YACX,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,UAAU,SAAU,IAAI;YACzB,QAAQ;YACR,WAAW,SAAS;QACxB;QACA,IAAI,CAAC,aAAa;YACd,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,aAAa,SAAU,OAAO;YAC/B,MAAM,WAAW;YACjB,cAAc,SAAS;QAC3B;QAEA,IAAI,CAAC,WAAW,SAAU,CAAC;YACvB,MAAM,SAAS;QACnB;QACA,IAAI,CAAC,aAAa,SAAU,CAAC;YACzB,MAAM,WAAW;QACrB;QACA,IAAI,CAAC,YAAY,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC;YAC9B,MAAM,UAAU,GAAG;QACvB;QACA,IAAI,CAAC,SAAS,SAAU,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,WAAW;YACxC,MAAM,OAAO,GAAG;QACpB;QACA,IAAI,CAAC,UAAU;YACX,MAAM;QACV;QACA,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,IAAI,CAAC,YAAY;YACb,OAAO,MAAM;QACjB;QACA,IAAI,CAAC,eAAe;YAChB,aAAa,SAAS,CAAC,aAAa;YACpC,MAAM,YAAY,aAAa;QACnC;QACA,IAAI,CAAC,aAAa;YACd,OAAO;QACX;IACJ;IAEA,OAAO;AACX;;;ACpXA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;;;ACIjH,qDAAgB;AAJhB;AACA;AACA;AAEO,SAAS,gBACZ,GAAW,EACX,OAAgB;IAGhB,0CAA0C;IAC1C,IAAI,CAAC,WAAY,CAAA,OAAO,cAAc,OAAO,OAAO,aAAa,GAAE,GAAI;QACnE,OAAO,KAAK;QACZ;IACJ;IAEA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;QACjB,SAAS;QACT,QAAQ;YACJ,KAAK;QACT;QACA,KAAK;YACD,OAAO;YACP,QAAQ;YACR,SAAS;QACb;IACJ;IACA,WAAW;QACP,OAAO,MAAM,UAAU,IAAI,WAAW;IAC1C,GAAG;IAEH,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE;IAEnB,IAAI;IACJ,IAAI,CAAC,SAAS;QACV,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YACX,SAAS;YACT,QAAQ;YACR,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,QAAQ;gBACJ,MAAM;gBACN,QAAQ;YACZ;YACA,SAAS;gBACL,MAAM;YACV;QACJ;QACA,OAAO,SAAS;YACZ,IAAI,UAAU,OAAO,eACjB,CAAA,GAAA,MAAC,EAAE,cAAc,QAAQ;gBACrB,MAAM,KAAK,OAAO,cAAc;YACpC;YAEJ,OAAO,MAAM,UAAU;QAC3B;IACJ;IAGA,MAAM,QAAQ,IAAI,CAAA,GAAA,0BAAW,EAAE;QAC3B,OAAO;QACP,SAAS;QACT,OAAO;QACP,aAAa;QACb,SAAS;YACL,IAAI,QAAQ;gBACR,OAAO,MAAM;gBACb,CAAA,GAAA,MAAC,EAAE,UAAU;gBACb,SAAS;YACb;QACJ;IACJ;AAEJ;;;;;ACrEA,+CAAa;AAFb;AAEO,MAAM;IAKT,YAAa,EAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,WAAW,EAQ3C,CAAE;aAVH,SAA6B,EAAE;QAW3B,IAAI,CAAC,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;YACZ,WAAW;QACf;QAEA,MAAM,QAAQ,CAAA;YACV,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;gBAChB,SAAS;YACb;YACA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;gBAChB,SAAS;gBACT,QAAQ;gBACR,QAAQ;oBACJ,MAAM;oBACN,OAAO,KAAK;oBACZ,MAAM;gBACV;YACJ;YACA,IAAI,aACA,MAAM,aAAa,qBAAqB;YAE5C,IAAI,SAAS,KAAK,OACd,MAAM,UAAU;YAEpB,MAAM,OAAO,KAAK;YAClB,IAAI,CAAC,GAAG,OAAO;YACf,IAAI,CAAC,OAAO,KAAK;QACrB;IACJ;IAGA,WAA2B;QACvB,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,OAAO,QAAQ,IAAK;YACzC,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,SACf,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QAE9B;QACA,OAAO;IACX;IAEA,aAAc;QACV,OAAO,IAAI,CAAC;IAChB;AAEJ;;;;;AChDA,sDAAa;AAXb;AAEA;;AAEA;AAGA;AACA;AACA;AAEO,MAAM;IAaD,YAAa;QACjB,IAAI,CAAC,IAAI,CAAC,WACN;QAEJ,IAAI,MAAM,IAAI,OAAO,YAAY,IAAI,CAAC;QACtC,IAAI;QACJ,MAAM,KAAK,MAAM,MAAM,OAAO;QAC9B,SAAS,CAAA,GAAA,cAAG,EAAE,wBAAwB,QAAQ,OAAO,KAAK;QAC1D,IAAI,MAAM,IAAI;YACV,MAAM,KAAK,MAAM,MAAM;YACvB,SAAS,CAAA,GAAA,cAAG,EAAE,0BAA0B,QAAQ,OAAO,KAAK;YAC5D,IAAI,MAAM,IAAI;gBACV,MAAM,KAAK,MAAM,MAAM;gBACvB,SAAS,CAAA,GAAA,cAAG,EAAE,yBAAyB,QAAQ,OAAO,KAAK;gBAC3D,IAAI,MAAM,IACN,SAAS,CAAA,GAAA,cAAG,EAAE;YAEtB;QACJ;QACA,IAAI,CAAC,MAAM,cAAc;IAC7B;IAEQ,eAAgB;QACpB,IAAI,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,cAAc,cAAc,CAAA,GAAA,cAAG,EAAE;YACtC,IAAI,CAAC,cAAc,WAAW;YAC9B,IAAI,CAAC,cAAc,WAAW;QAClC,OAAO;YACH,IAAI,CAAC,cAAc,cAAc,CAAA,GAAA,cAAG,EAAE;YACtC,IAAI,CAAC,cAAc,WAAW;YAC9B,IAAI,CAAC,cAAc,WAAW;QAClC;IACJ;IAEQ,YAAa,SAAkB,EAAE,SAAgD,EAAE;QACvF,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC,YAAY;QACjB,IAAI,IAAI,CAAC,aAAa,WAAW;YAC7B,UAAU,UAAU,IAAI;YACxB,IAAI,CAAC,UAAU,YAAY;YAC3B,IAAI,CAAC;YACL,IAAI,CAAC,UAAU,OAAO,WAAW,IAAI,CAAC;QAC1C,OACI,IAAI,CAAC,UAAU,YAAY,CAAA,GAAA,cAAG,EAAE;QAEpC,IAAI,CAAC;IACT;IAEA,MAAc,QAAS;QACnB,IAAI,CAAC,cAAc,cAAc,CAAA,GAAA,cAAG,EAAE;QACtC,IAAI,CAAC,cAAc,WAAW;QAC9B,IAAI,CAAC,cAAc,WAAW;QAC9B,MAAM,IAAI,QAAQ,CAAC;YACf,WAAW,IAAM,QAAQ,OAAO;QACpC;QACA,IAAI;YACA,MAAM,IAAI,CAAC,aAAa,MAAM,IAAI,CAAC;YACnC,IAAI,CAAC,aAAa;QACtB,EAAE,OAAO,GAAG;YACR,IAAI,CAAC;YACL,CAAA,GAAA,MAAC,EAAE,MAAM;gBACL,QAAQ,IAAI,CAAC;gBACb,MAAM;gBACN,SAAS;oBACL,CAAC,EAAE,CAAA,GAAA,cAAG,EAAE,yBAAyB,IAAI,CAAC;oBACtC,CAAC,IAAI,EAAE,CAAA,GAAA,cAAG,EAAE,yBAAyB,KAAK,CAAC;oBAC3C,CAAC,IAAI,EAAE,CAAA,GAAA,cAAG,EAAE,yBAAyB,KAAK,CAAC;oBAC3C,CAAC,IAAI,EAAE,CAAA,GAAA,cAAG,EAAE,yBAAyB,KAAK,CAAC;oBAC3C;iBACH,CAAC,KAAK;gBACP,SAAS;oBAAC;iBAAK;YACnB;YACA,WAAW;gBACP,MAAM,IAAI,MAAM,kDAAkD;YACtE,GAAG;QACP;IACJ;IAEA,MAAc,QAAS;QACnB,IAAI,CAAC,cAAc,WAAW;QAC9B,IAAI,CAAC,cAAc,WAAW;QAC9B,IAAI;YACA,MAAM,IAAI,CAAC,aAAa;QAC5B,EAAE,OAAO,GAAG;YACR,IAAI,CAAC;YACL,CAAA,GAAA,MAAC,EAAE,MAAM;gBACL,QAAQ,IAAI,CAAC;gBACb,MAAM;gBACN,SAAS,CAAA,GAAA,cAAG,EAAE;gBACd,SAAS;oBAAC;iBAAK;YACnB;YACA,WAAW;gBACP,MAAM,IAAI,MAAM,kDAAkD;YACtE,GAAG;QACP;IACJ;IAIA,YACY,cACA,YACA,cACA,UACA,QACV;4BALU;0BACA;4BACA;wBACA;uBACA;aAnHJ,YAA4B,CAAC;aACpB,SAAsB,CAAC;aACvB,QAAqB,CAAC;aACtB,gBAAmC,CAAC;aACpC,gBAAmC,CAAC;aACpC,gBAAuC,CAAC;aACxC,qBAAiC,KAAO;QA+GrD,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,KAAK;gBACD,SAAS;gBACT,qBAAqB;gBACrB,kBAAkB;gBAClB,KAAK;gBACL,mBAAmB;YACvB;QACJ;QAGA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ,IAAI,CAAC;YACb,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,KAAK;gBACD,UAAU;gBACV,SAAS;gBACT,QAAQ;gBACR,KAAK;YAET;QACJ;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ;YACR,SAAS;YACT,WAAW;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS;gBACL,CAAA,GAAA,gCAAc,EAAE,gCAAgC;YACpD;QACJ;QAEA,IAAI,IAAI,CAAC,aAAa,YAAY;YAC9B,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,QAAQ,IAAI,CAAC;gBACb,SAAS,kBAAQ,CAAA,GAAA,cAAG,EAAE;gBACtB,KAAK;oBACD,WAAW;gBACf;YACJ;YACA;QACJ;QAEA,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,QAAQ,IAAI,CAAC;YACb,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,WAAW;QACf;QACA,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,KAAK;gBACD,UAAU;gBACV,OAAO;gBACP,QAAQ;gBACR,OAAO;gBACP,WAAW;gBACX,YAAY;gBACZ,OAAO;gBACP,UAAU;YACd;QACJ;QACA,MAAM,YAAuC,SAAS,cAAe,CAAC,IAAI;YACtE,UAAU;QACd;QACA,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,QAAQ,IAAI,CAAC;YACb,SAAS;YACT,WAAW;YACX,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,KAAK;gBACD,UAAU;YAEd;YACA,QAAQ;YACR,SAAS,IAAM,IAAI,CAAC;QACxB;QACA,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,QAAQ,IAAI,CAAC;YACb,SAAS;YACT,WAAW;YACX,SAAS,eAAe,CAAA,GAAA,8BAAa,IAAI,qBAAqB,CAAA,GAAA,cAAG,EAAE;YACnE,KAAK;gBACD,UAAU;YAEd;YACA,QAAQ;YACR,SAAS,IAAM,IAAI,CAAC;QACxB;QAEA,IAAI,IAAI,CAAC,SAAS,iBACd,IAAI,CAAC,cAAc,MAAM,aAAa;QAG1C,IAAI,CAAC,gBAAgB;YACjB,UAAU,CAAC,WAAW;gBAClB,IAAI,CAAC,YAAY,WAAW;YAChC;QACJ;QACA,IAAI,CAAC,aAAa,UAAU,IAAI,CAAC;QAEjC,IAAI,CAAC,qBAAqB;YACtB,IAAI,CAAC,IAAI,CAAC,WACN;YAEJ,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;gBACnB,YAAY,UAAU,CAAA,GAAA,MAAC,EAAE,oBAAoB,GAAG,CAAA,GAAA,YAAI,EAAE,UAAU,UAAU,eAAe;YAC7F;QACJ;QACA,CAAA,GAAA,YAAI,EAAE,kBAAkB,IAAI,CAAC;QAE7B,YAAY,IAAM,IAAI,CAAC,aAAa;QAEnC,CAAA;YACG,IAAI;gBACA,MAAM,aAAa,MAAM,IAAI,CAAC,aAAa;gBAC3C,IAAI,YACA,IAAI,CAAC,YAAY,WAAW,WAAW,WAAW;qBAElD,IAAI,CAAC;YAEb,EAAE,OAAO,GAAG;gBACR,WAAW;oBACP,MAAM,IAAI,MAAM,sDAAsD;gBAC1E,GAAG;YACP;QACJ,CAAA;IACJ;IAGA,aAAc;QACV,OAAO,IAAI,CAAC;IAChB;IAEA,OAAQ;IACJ,OAAO;IACX;IAEA,OAAQ;IACJ,OAAO;IACX;IAEA,UAAW;QACP,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAC;QAClB,CAAA,GAAA,YAAI,EAAE,qBAAqB,IAAI,CAAC;QAChC,IAAI,CAAC,aAAa,YAAY,IAAI,CAAC;IACvC;AACJ;;;;;ACjQA;;CAEC,GACD,kDAAa;AAvBb;AACA;AACA;AAOA,SAAS,UACL,YAGS;IAET,OAAO,IAAI,QAAW,CAAC,SAAS;QAC5B,aAAa,SAAS;IAC1B;AACJ;AAKO,MAAM;IAKT,MAAM,cAAe,OAA0B,EAAiB;QAC5D,MAAM,IAAI,QAAc,CAAC,SAAS;YAC9B,CAAA,GAAA,4BAAgB,EAAE,SAAS,SAAS;QACxC;IACJ;IAEA,MAAM,eAA4C;QAC9C,OAAO,MAAM,UAAU,CAAA,GAAA,0BAAc;IACzC;IAEA,MAAM,gBAAgC;QAClC,MAAM,UAAgB,CAAA,GAAA,gBAAI;IAC9B;IAIQ,KAAM,SAAkB,EAAE,SAAgD,EAAQ;QACtF,IAAI,CAAC,UAAU,QAAQ,CAAA;YACnB,KAAK,SAAS,WAAW;QAC7B;IACJ;IAEQ,kBAAyB;QAC7B,CAAA,GAAA,0BAAW,EAAE,QAAQ,sBAAsB,KAAK,IAAI,OAAO;IAC/D;IAEA,iBAAiB;IAEjB,aAAe;aA/BP,YAAqC,EAAE;aACvC,kBAA2B;QA+B/B,OAAO,iBAAiB,WAAW,CAAC;YAChC,IAAI,EAAE,QAAQ,wBAAwB,IAAI,CAAC,UAAU,WAAW,GAC5D;YAEJ,IAAI;gBACE,CAAA;oBACE,MAAM,aAAa,MAAM,IAAI,CAAC;oBAC9B,IAAI,YACA,IAAI,CAAC,KAAK,WAAW,WAAW,WAAW;yBAE3C,IAAI,CAAC;gBAEb,CAAA;YACJ,EAAE,OAAO,GAAG;gBACR,IAAI,aAAa,SAAS,EAAE,QAAQ,QAAQ,gBAAgB,GACxD,IAAI,CAAC,kBAAkB;YAE/B;QAEJ;IACJ;IAEA,MAAM,OAIS;QACX,IAAI;QACJ,IAAI;YACA,iBAAiB,MAAM,IAAI,CAAC;QAChC,EAAE,OAAO,GAAG;YACR,IAAI,CAAC,kBAAkB;YACvB,MAAM,IAAI,MAAM,eAAe;QACnC;QACA,IAAI,CAAC,gBACD,OAAO;QAEX,IAAI;QACJ,IAAI;YACA,SAAS,MAAM,CAAA,GAAA,kCAAe,EAAE,mBAAmB;QACvD,EAAE,OAAO,GAAG;YACR,MAAM,IAAI,MAAM,mBAAmB;QACvC;QACA,OAAO;IACX;IAEA,MAAM,MAAO,OAAmB,EAAiB;QAC7C,IAAI;YACA,MAAM,iBAAiB,CAAA,GAAA,kCAAe,EAAE,qBAAqB;YAC7D,MAAM,IAAI,CAAC,cAAc;QAC7B,EAAE,OAAO,GAAG;YACR,IAAI,CAAC,kBAAkB;YACvB,MAAM,IAAI,MAAM,eAAe;QACnC;QACA;YACI,qCAAqC;YACrC,MAAM,iBAAiB,MAAM,IAAI,CAAC;YAClC,IAAI;YACJ,IAAI;gBACA,aAAa,MAAM,CAAA,GAAA,kCAAe,EAAE,mBAAmB;YAC3D,EAAE,OAAO,GAAG;gBACR,MAAM,IAAI,CAAC;gBACX,IAAI,CAAC;gBACL,WAAW,IAAM,IAAI,CAAC,QAAQ;gBAC9B,MAAM,IAAI,MAAM,mBAAmB;YACvC;YACA,IAAI,CAAC;YACL,WAAW,IAAM,IAAI,CAAC,KAAK,WAAW,WAAW,WAAW,YAAY;QAC5E;IACJ;IAEA,MAAM,QAAwB;QAC1B,MAAM,IAAI,CAAC;QACX,IAAI,CAAC;QACL,WAAW,IAAM,IAAI,CAAC,QAAQ;IAClC;IAEA,UAAW,QAA+B,EAAQ;QAC9C,IAAI,IAAI,CAAC,UAAU,SAAS,WACxB;QAEJ,IAAI,CAAC,UAAU,KAAK;IACxB;IAEA,YAAa,QAA+B,EAAQ;QAChD,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,UAAU,QAAQ,IACvC,IAAI,aAAa,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE;YAChC,IAAI,CAAC,UAAU,OAAO,GAAG;YACzB;QACJ;IAER;IAEA,WAAqB;QACjB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;;;ACxHA;;;;CAIC,GACD,sDAAa;AAvCb;AACA;AACA;AAQA,MAAM,YAAY;AAElB,SAAS,UAAW,IAAU;IAC1B,OAAO,IAAI,QAA0B,CAAC,SAAS;QAC3C,MAAM,KAAK,IAAI;QACf,IAAI;YACA,GAAG,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe;QAC/B,EAAE,OAAO,GAAG;YACR,OAAO,qBAAsB,CAAA,aAAa,QAAQ,EAAE,UAAU,EAAC;YAC/D;QACJ;QACA,GAAG,SAAS;YACR,IAAI,gBAAgB,GAAG;YACvB,QAAQ;QACZ;QACA,GAAG,UAAU;YACT,OAAO;QACX;QACA,GAAG,UAAU;YACT,OAAO;QACX;IACJ;AACJ;AAOO,MAAM;IAET,OAAe,gBAAiB,OAAmB,EAAqB;QACpE,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ,QAAQ,OAAO,QAAQ,QAAQ,WAAW;QAClE,MAAM,SAAS,KAAK,QAAQ,QAAQ;QACpC,OAAO,CAAA,GAAA,wBAAU,EAAE,SAAS;IAChC;IAEA,OAAO,qBAAsB,OAAmB,EAAqB;QACjE,OAAO;YACH,IAAI;YACJ,WAAW,IAAI,OAAO;YACtB,WAAW,CAAA,GAAA,0BAAW,EAAE,iBAAiB,gBAAgB,SAAS,UAAU;YAC5E,OAAO,QAAQ;YACf,QAAQ,QAAQ;YAChB,QAAQ,QAAQ,OAAO,IAAI,CAAA;gBACvB,IAAI;gBACJ,IAAI,KAAK,iBAAiB,mBACtB,OAAO,CAAA,GAAA,0BAAW,EAAE,AAAC,KAAK,MAA4B,UAAU;qBAEhE,aAAa;gBACb,MAAM,IAAI,MAAM;gBAEpB,OAAO;oBACH,MAAM,KAAK;oBACX,WAAW,KAAK;oBAChB,SAAS,KAAK;oBACd,YAAY,KAAK;oBACjB;gBACJ;YACJ;QACJ;IACJ;IAEA,aAAa,mBAAoB,cAAiC,EAAsC;QACpG,IACI,CAAC,eAAe,SAAS,CAAC,eAAe,UACzC,MAAM,eAAe,UAAU,MAAM,eAAe,WACpD,eAAe,QAAQ,KAAK,eAAe,SAAS,GAEpD,MAAM,IAAI,MAAM,6CAA6C,eAAe,QAAQ,OAAO,eAAe;QAE9G,MAAM,UAAsB;YACxB,OAAO,eAAe;YACtB,QAAQ,eAAe;YACvB,QAAQ,AAAC,CAAA,MAAM,QAAQ,IAAI,eAAe,OAAO,IAAI,CAAA,QAAS,UAAU,MAAM,OAAM,EAC/E,IAAI,CAAC,OAAO;gBACT,MAAM,eAAe,eAAe,MAAM,CAAC,EAAE;gBAC7C,OAAO;oBACH,MAAM,aAAa;oBACnB,WAAW,eAAe,eAAe,aAAa,YAAY;oBAClE,SAAS,aAAa;oBACtB,YAAY,aAAa;oBACzB;gBACJ;YACJ;QACR;QAEA,IAAI;QACJ,IAAI,eAAe,WACf,YAAY,MAAM,UAAU,eAAe;aAE3C,YAAY,iBAAiB,gBAAgB;QAGjD,OAAO;YACH,SAAS;YACT,WAAW,eAAe;YAC1B,WAAW;QACf;IACJ;AAEJ;;;;;AC/GA,kDAAgB;AAAT,SAAS,aAAc,SAAiB;IAC3C,MAAM,QAAQ,UAAU,MAAM;IAC9B,MAAM,SAAS,KAAK,KAAK,CAAC,EAAE;IAC5B,MAAM,MAAM,IAAI,YAAY,OAAO;IACnC,MAAM,OAAO,IAAI,WAAW;IAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,QAAQ,IAC7B,IAAI,CAAC,EAAE,GAAG,OAAO,WAAW;IAEhC,OAAO,IAAI,KAAK;QAAC;KAAK,EAAE;QAAC,QAAQ,KAAK,CAAC,EAAE;IAAA;AAC7C;;;;;ACIA,6CAAa;AAdb;AACA;AACA;AAIA;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEO,MAAM;IAMT,YACI,QAAqB,EACrB,YAA0B,EAC1B,UAA4B,EACpB,YACR,kBAA+C,EAC/C,YAAkE,EAClE,qBAAiC,EACjC,UAAsB,EACtB,YAA4C,EAC5C,QAAoB,EACpB,iBAA6B,EAC7B,YAA0B,CAC5B;0BATU;QAUR,IAAI,CAAC,SAAS,SAAS,cAAc;QAErC,MAAM,gBAAgB;YAClB,MAAM,WAAW,SAAS,cAAc;YACxC,MAAM,YAAY,SAAS,cAAc;YACzC,MAAM,aAAa,SAAS,cAAc;YAC1C,MAAM,cAAc,SAAS,cAAc;YAC3C,MAAM,oBAAoB,SAAS,cAAc;YACjD,MAAM,kBAAkB,SAAS,cAAc;YAE/C,UAAU,MAAM,WAAW;YAC3B,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY;gBACf,UAAU;gBACV,OAAO;gBACP,UAAU;YACd;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,iBAAiB;gBACpB,UAAU;gBACV,OAAO;YACX;YAEA,UAAU,WAAW;YACrB,WAAW,WAAW;YACtB,YAAY,WAAW;YACvB,kBAAkB,WAAW;YAC7B,gBAAgB,WAAW;YAE3B,UAAU,YAAY,CAAC,iCAAiC,EAAE,GAAA,4BAAY,0BAA0B,EAAE,CAAA,GAAA,cAAG,EAAE,YAAY,CAAC;YACpH,WAAW,YAAY,CAAC,UAAU,EAAE,GAAA,0BAAU,0BAA0B,EAAE,CAAA,GAAA,cAAG,EAAE,aAAa,CAAC;YAC7F,YAAY,YAAY,CAAC,UAAU,EAAE,GAAA,yBAAS,0BAA0B,EAAE,CAAA,GAAA,cAAG,EAAE,cAAc,CAAC;YAC9F,kBAAkB,YAAY,CAAC,6BAA6B,EAAE,GAAA,0BAAU,0BAA0B,EAAE,CAAA,GAAA,cAAG,EAAE,eAAe,CAAC;YACzH,gBAAgB,YAAY,CAAC,UAAU,EAAE,GAAA,wBAAQ,0BAA0B,EAAE,CAAA,GAAA,cAAG,EAAE,aAAa,CAAC;YAChG,gBAAgB,QAAQ,CAAA,GAAA,cAAG,EAAE;YAC7B,UAAU,YAAY;YACtB,WAAW,YAAY;YACvB,YAAY,YAAY;YACxB,kBAAkB,YAAY;YAC9B,gBAAgB,YAAY;YAE5B,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;gBACxB,WAAW;gBACX,KAAK;oBACD,UAAU;oBACV,QAAQ;oBACR,UAAU;gBACd;YACJ;YACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;gBACpB,QAAQ;gBACR,KAAK;oBACD,OAAO;oBACP,QAAQ;oBACR,UAAU;oBACV,QAAQ;oBACR,UAAU;gBACd;YACJ;YACA,IAAI,CAAC,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;gBACtB,SAAS;gBACT,QAAQ;gBACR,KAAK;oBACD,SAAS;gBACb;YACJ;YACA,IAAI,CAAC,aAAa,WAAW;YAC7B,IAAI,CAAC,aAAa,OAAO;YACzB,IAAI,CAAC,aAAa,WAAW;YAC7B,IAAI,CAAC,aAAa,SAAS;YAC3B,IAAI,CAAC,aAAa,OAAO;YACzB,IAAI,CAAC,aAAa,WAAW;gBACzB,IAAI,CAAC,IAAI,CAAC,cACN;gBAEJ,IAAI,CAAC,aAAa,SAAS,aAAa,IAAI,CAAC,aAAa,OAAO;gBACjE,IAAI,CAAC,aAAa,QAAQ;YAC9B;YAEA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;gBAC3B,SAAS;gBACT,QAAQ;gBACR,SAAS,uEAAuE,CAAA,GAAA,yBAAQ,IAAI,mBAAmB,CAAA,GAAA,cAAG,EAAE;gBACpH,KAAK;oBACD,OAAO;oBACP,SAAS;oBACT,UAAU;oBACV,MAAM;oBACN,KAAK;oBACL,QAAQ;gBACZ;YACJ;YACA,iBAAiB,WAAW;YAC5B,iBAAiB,UAAU,IAAM,IAAI,CAAC,gBAAgB,IAAI,CAAC,aAAa;YAExE,mCAAmC;YACnC,MAAM,mBAAmB,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;gBACnC,WAAW;oBACP;wBAAC;wBAAO;qBAAM;oBACd;wBAAC;wBAAO;qBAAM;oBACd;wBAAC;wBAAU,CAAA,GAAA,cAAG,EAAE,YAAY;qBAAS;iBACxC;gBACD,WAAW,IAAI,CAAC;gBAChB,UAAU,CAAC;oBACP,IAAI,CAAC,aAAa;oBAClB,mBAAmB,IAAI,CAAC;oBACxB;gBACJ;gBACA,OAAO,CAAA,GAAA,cAAG,EAAE;YAChB;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,iBAAiB,cAAc;gBAClC,OAAO;gBACP,QAAQ;gBACR,WAAW;gBACX,YAAY;YAChB;YAIA,UAAU,UAAU;YACpB,WAAW,UAAU;gBACjB;YACJ;YACA,YAAY,UAAU;gBAClB,YAAY,WAAW;gBACvB,aAAa;oBACT,YAAY,WAAW;gBAC3B;YACJ;YACA,kBAAkB,UAAU,IAAM;YAElC,gBAAgB,UAAU;gBACtB,gBAAgB;gBAChB;YACJ;YAEA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;gBACnB,WAAW;gBACX,aAAa,CAAA,GAAA,cAAG,EAAE;gBAClB,KAAK;oBACD,QAAQ;gBACZ;YACJ;YAEA,MAAM,eAAe;gBACjB,MAAM,KAAK,SAAS,cAAc;gBAClC,MAAM,UAAU,SAAS,cAAc;gBACvC,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;oBACf,WAAW;gBACf;gBACA,GAAG,OAAO,SAAS;gBACnB,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS;oBACZ,OAAO;gBACX;gBACA,OAAO;YACX;YAEA,IAAI,CAAC,qBAAqB,IAAI,CAAA,GAAA,kCAAe,EAAE,cAAc,YAAY,cAAc;YACvF,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,mBAAmB,cAAc;gBACzC,oBAAoB;gBACpB,QAAQ;YACZ;YAEA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;gBAClB,SAAS;oBAAC;oBAAY,iBAAiB;iBAAa;gBACpD,WAAW;YACf;YAEA,kBAAkB;YAClB,CAAA,GAAA,MAAC,EAAE,OAAO,UAAU;gBAChB;gBACA;gBACA;gBACA,CAAA,GAAA,MAAC,EAAE,GAAG;oBAAC,KAAK;wBAAC,OAAO;oBAAM;gBAAC;gBAE3B;gBAEA;gBACA,CAAA,GAAA,MAAC,EAAE,kBAAkB,cAAc;gBACnC,CAAA,GAAA,MAAC,EAAE,GAAG;oBAAC,KAAK;wBAAC,OAAO;oBAAM;gBAAC;gBAE3B;gBACA,IAAI,CAAC,mBAAmB;gBACxB;gBACA;aACH;YAED,IAAI,CAAC,OAAO,OAAO;QACvB;QAEA,WAAW,eAAe;IAC9B;IAEA,UAAiB,CACjB;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,SAAkB,EAAQ;QACpC,IAAI,WACA,IAAI,CAAC;IAEb;IAEA,gBAAuB;QACnB,IAAI,CAAC,gBAAgB,IAAI,CAAC,aAAa;IAC3C;AACJ;;;ACjPA,OAAO,UAAU,QAAQ,mBAAwB,aAAa,WAAW,wBAAwB,MAAM,KAAK;;;;;ACiB5G,+CAAa;AAjBb;AACA;AACA;AAKA;AAMA;AACA;AAGO,MAAM;IAKD,eAAyB;QAC7B,OAAO,CAAC,CAAC,CAAA,GAAA,qBAAU;IACvB;IAEA,YACY,UACA,eACA,cACA,mBACA,QACA,iBACA,oBACA,aACA,oBACA,SACA,cACV;wBAXU;6BACA;4BACA;iCACA;sBACA;+BACA;kCACA;2BACA;kCACA;uBACA;6BACA;aAjBJ,SAAS;QAmBb,IAAI,CAAC,SAAS,SAAS,cAAc;IACzC;IAEQ,OAAc;QAClB,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE;QACnB,MAAM,UAAU,EAAE;QAElB,IAAI,CAAC,CAAA,GAAA,MAAC,EAAE,gBAAgB,UACpB,MAAM,IAAI,MAAM;QAGpB,MAAM,WAAoB,IAAI,CAAC;QAE/B,IAAI,CAAC,UAAU;YACX,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;gBACf,QAAQ,IAAI,CAAC;gBACb,WAAW;gBACX,SAAS;gBACT,KAAK;oBACD,QAAQ;oBACR,cAAc;gBAClB;YACJ;YACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;gBACrB,QAAQ;gBACR,SAAS;gBACT,aAAa;gBACb,KAAK;oBACD,YAAY;gBAChB;YACJ;YACA,WAAW,UAAU;gBACjB,CAAA,GAAA,MAAC,EAAE,MAAM;oBACL,QAAQ,IAAI,CAAC;oBACb,SAAS;oBACT,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;wBACP,SAAS,CAAC;;;;;AAKlC,CAAC;oBACmB;oBACA,SAAS;wBAAC;qBAAK;oBACf,cAAc;gBAClB;YACJ;QACJ;QAEA,MAAM,eAAe,CAAC;YAClB,MAAM,SAAS,OAAO,CAAC,UAAU;YAEjC,MAAM,SAAS,SAAS,cAAc;YACtC,MAAM,cAAc,CAAA,GAAA,cAAG,EAAE,OAAO,KAAK;YACrC,MAAM,UAAU,OAAO,eAAe,2BAA2B;YACjE,MAAM,KAAK,UAAU,UAAU,kCAAkC,OAAO,OAAO;YAC/E,OAAO,YAAY,KAAK;YACxB,OAAO,YAAY;YACnB,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ;gBACX,YAAY;gBACZ,UAAU;YACd;YACA,OAAO,WAAW;YAElB,MAAM,aAAa,CAAA,GAAA,cAAG,EAAE,OAAO,KAAK;YAEpC,IAAI,YAAY;YAChB,IAAI,OAAO,SAAS,CAAC,UACjB,YAAY;YAGhB,IAAI,WACA,OAAO,UAAU;gBAGb,MAAM,gBAA4B;oBAAC;oBAAM;iBAAS;gBAElD,MAAM,iBAAiB,CAAC,QAAkB;oBACtC,IAAI,WAAW,cACX;oBAEJ,IAAI,UAAU,UAAU;wBACpB,IAAI,aAAa,SACb,aAAa;wBAEjB;oBACJ;oBACA,IAAI;oBACJ,IAAI;wBACA,QAAQ,aAAa,YAAa,gBAAgB;oBACtD,EAAE,OAAO,GAAG;wBACR,IAAI,AAAC,EAAY,QAAQ,QAAQ,mCAAmC,IAChE,MAAM,sDAAsD;6BAE5D,MAAM;oBAEd;oBACA,YAAY;gBAChB;gBAEA,IAAI,CAAE,CAAA,WAAW,OAAO,CAAC,UAAU,AAAD,GAAI;oBAClC,CAAA,GAAA,MAAC,EAAE,MAAM;wBACL,QAAQ,IAAI,CAAC;wBACb,SAAS;wBACT,MAAM;oBACV;oBACA;gBACJ;gBAEA,MAAM,cAAc,CAAC;oBACjB,MAAM,eAAe,OAAO,CAAC,UAAU,CAAC,MAAO;wBAC3C,SAAS,IAAI,CAAC;wBACd,UAAU,IAAI,CAAC;wBACf,SAAS,CAAA,GAAA,oBAAQ;wBACjB,OAAO;oBACX;oBACA,IAAI,iBAAiB,OACjB,CAAA,GAAA,MAAC,EAAE,MAAM;wBACL,QAAQ,IAAI,CAAC;wBACb,SAAS;wBACT,MAAM;oBACV;oBAEJ,IAAI,OAAO,CAAC,UAAU,CAAC,cAAc,MAAM;wBACvC,IAAI,CAAC,kBAAkB;wBACvB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;oBACjF;oBACA,IAAI,CAAC,aAAa;gBACtB;gBAEA,IAAI,OAAO,CAAC,UAAU,CAAC,WAAU;oBAC7B,OAAO;oBACP,YAAY;oBACZ,IAAI,CAAC,cAAc,IAAI,MAAM,aAAa,OAAO,CAAA,GAAA,cAAG,EAAE,mBAAmB;gBAC7E,OAAO;oBACH,MAAM,oBAAoB,IAAI,CAAC,cAAc;oBAC7C,IAAI,eAAwD;oBAE5D,IAAI;wBACA,eAAe,OAAO,CAAC,UAAU,CAAC,UAAW;4BACzC,SAAS,IAAI,CAAC;4BACd,UAAU,IAAI,CAAC;4BACf,UAAU,IAAI,CAAC;4BACf,WAAW,IAAI,CAAC;4BAChB,iBAAiB;gCAAC,GAAG,IAAI,CAAC,kBAAkB;gCAAG,GAAG,IAAI,CAAC,kBAAkB;gCAAG,GAAG,IAAI,CAAC,kBAAkB;4BAAC;4BACvG,mBAAmB;gCAAC,GAAG,kBAAkB;gCAAG,GAAG,kBAAkB;gCAAG,GAAG,kBAAkB;4BAAC;wBAC9F;oBACJ,EAAE,OAAO,GAAG;wBACR,WAAW;4BACP,MAAM;wBACV;oBACJ;oBAEA,IAAI,CAAC,gBAAgB,WAAW,cAAc;wBAC1C,CAAA,GAAA,MAAC,EAAE,MAAM;4BACL,QAAQ,IAAI,CAAC;4BACb,SAAS,eAAe,aAAa,QAAQ;4BAC7C,MAAM;wBACV;wBACA;oBACJ;oBAEA,IAAI;oBACJ,wCAAwC;oBACxC,aAAa,gBAAgB,CAAC;wBAC1B,CAAA,GAAA,MAAC,EAAE,MAAM;4BACL,QAAQ,IAAI,CAAC;4BACb,SAAS;4BACT,MAAM;wBACV;wBACA,WAAW;4BACP,MAAM;wBACV,GAAG;wBACH;oBACJ;oBAGA,MAAM,QAAoB,CAAC;oBAC3B,IAAI,WAAW,cACX,MAAM,QAAQ,aAAa,QAAQ;oBAGvC,IAAI;oBACJ;wBACI,MAAM,MAAqB;4BACvB,CAAA,GAAA,IAAA,EAAE,KAAK;yBACV;wBACD,IAAI,OAAO,KAAK,gBAAgB,WAC5B,IAAI,KAAK,CAAA,GAAA,IAAA,EAAE;4BACP,WAAW;4BACX,SAAS;gCACL,CAAA,GAAA,MAAC,EAAE,MAAM;oCACL,QAAQ,IAAI,CAAC;oCACb,SAAS,CAAA,GAAA,cAAG,EAAE,OAAO,KAAK;gCAC9B;4BACJ;4BACA,OAAO,CAAA,GAAA,cAAG,EAAE,OAAO,KAAK;4BACxB,OAAO;wBACX,GAAG;wBAEP,QAAQ,CAAA,GAAA,IAAA,EAAE,eAAe;oBAC7B;oBAKA,CAAA,GAAA,MAAC,EAAE,MAAM;wBACL,QAAQ,IAAI,CAAC;wBACb,SAAS;wBACT,KAAK,aAAa;wBAClB,OAAO;wBACP,SAAS;wBACT,cAAc;wBACd,UAAU,CAAC;4BACP,eAAe,QAAoB;wBACvC;wBACA,WAAW,CAAC;4BACR,YAAY;wBAChB;oBACJ;gBACJ;YACJ;iBAEA,OAAO,WAAW;YAGtB,QAAQ,KAAK;YACb,OAAO;QACX;QAEA,MAAM,WAAW,CAAC;YACd,OAAO,QAAQ,SAAS,QAAQ,CAAC,CAAC,WAAW,OAAO;gBAChD,IAAI,CAAC,SAAS,SAAS,YACnB;gBAEJ,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,SACxB;gBAEJ,IAAI,CAAC,OAAO,OAAO,aAAa;YACpC;QACJ;QAEA,MAAM,SAAS;YACX;YACA;YACA;YACA;YACA;YACA;SACH;QACD,MAAM,SAAS;YACX;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACH;QACD,MAAM,SAAS;YACX;YACA;YACA;YACA;SACH;QAED,SAAS;QACT,IAAI,CAAC,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,WAAW;QAAS;QAC9C,SAAS;QACT,IAAI,CAAC,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,WAAW;QAAS;QAC9C,SAAS;QAET,IAAI,CAAC,SAAS;IAClB;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,OAAc;QACV,IAAI,CAAC,IAAI,CAAC,QACN,IAAI,CAAC;QAET,IAAI,CAAC,OAAO,MAAM,UAAU;IAChC;IAEA,OAAc;QACV,IAAI,CAAC,OAAO,MAAM,UAAU;IAChC;AAEJ;;;;;ACrUA,iDAAgB;AANhB;AAGA,IAAI,SAAS;AACb,IAAI,KAAuB;AAEpB,SAAS;IACZ,8CAA8C;IAC9C,IAAI,QACA,OAAO;IAGX,IAAI,CAAC,MAAM,GAAG,EAAE,GAAG,iBACf,IAAI;QACA,KAAK,CAAA,GAAA,kBAAO;IAChB,EAAE,OAAO,GAAG;QACR,SAAS;QACT,KAAK;QACL,WAAW;YACP,MAAM;QACV;IACJ;IAEJ,OAAO;AACX;;;;;8CCaa;AArCb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAmBO,MAAM,WAA8B,AAAC;IAExC,SAAS,YAAa,OAAkB;QACpC,OAAO;YACH,GAAG;YACH,gBAAgB,SAAU,OAAO;gBAC7B,8DAA8D;gBAC9D,CAAA,GAAA,SAAI,EAAE,IAAI,CAAC,EAAE;gBACb,IAAI,CAAC,EAAE,eAAe;YAC1B;YACA,SAAS;gBACL,8DAA8D;gBAC9D,CAAA,GAAA,SAAI,EAAE,IAAI,CAAC,EAAE;gBACb,IAAI,CAAC,EAAE;YACX;QACJ;IACJ;IAEA,SAAS,QAAS,OAA6B;QAC3C,OAAO,YAAY,CAAA,GAAA,oBAAQ,EAAE,YAAY;IAC7C;IAEA,SAAS;QACL,IAAI,cAAsB,CAAA,GAAA,MAAC,EAAE;QAE7B,wEAAwE;QACxE,yEAAyE;QACzE,uEAAuE;QACvE,oDAAoD;QACpD,IACI,CAAA,GAAA,MAAC,EAAE,aAAa,+BAA+B,0CAA0C;QACzF,CAAA,GAAA,MAAC,EAAE,aAAa,wBAChB,CAAA,GAAA,MAAC,EAAE,aAAa,6BAClB;YACE,MAAM,cAAc,IAAI,CAAA,GAAA,oBAAQ,EAAE,KAAK,KAAK,CAAA,GAAA,MAAC,EAAE,MAAM,CAAA,GAAA,MAAC,EAAE;YACxD,IAAI;gBACA,2CAA2C;gBAC3C,YAAY,OAAO;oBACf,cAAc,CAAA,GAAA,MAAC,EAAE;gBACrB;YACJ,EAAE,OAAO,GAAG;YACR,SAAS,GACb;YACA,YAAY;QAChB;QACA,OAAO;IACX;IAEA,SAAS,WAA6B,KAAa,EAAE,MAAc;QAC/D,MAAM,cAAc;QACpB,IAAI,IAAI,CAAC,EAAE,SACP,IAAI,CAAC,EAAE,QAAQ;QAEnB,IAAI,IAAI,CAAC,EAAE,cACP,IAAI,CAAC,EAAE,aAAa;QAExB,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,EAAE,UAAU,IAAI,CAAA,GAAA,oBAAQ,EAAE,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM;QACvD,IAAI,CAAC,EAAE,eAAe,IAAI,CAAA,GAAA,oBAAQ,EAAE,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM;QAC5D,IAAI,CAAC,EAAE,eAAe,IAAI,CAAC,EAAE,gBAAgB,IAAI,CAAA,GAAA,oBAAQ,EAAE,GAAG,GAAG,CAAA,GAAA,MAAC,EAAE,MAAM;QAC1E,IAAI,CAAC,EAAE,gBAAgB,IAAI,CAAC,EAAE,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,CAAC;;;;;;QAMnE,CAAC,EAAE;QACH,IAAI,CAAC,EAAE,gBAAgB;IAC3B;IAEA,SAAS,KAAuB,OAAwB,EAAE,KAAc,EAAE,MAAe;QACrF,IAAI,CAAC,IAAI,CAAC,EAAE,iBAAiB,QAAQ,EAAE,SAAS,IAAI,CAAC,SAAS,QAAQ,EAAE,UAAU,IAAI,CAAC,QACnF,WAAW,KAAK,IAAI,EAAE,QAAQ,QAAQ,QAAQ,EAAE,OAAO,SAAS,SAAS,QAAQ,EAAE;QAGvF,QAAQ,EAAE;QACV,IAAI,CAAC,EAAE,QAAQ,OAAO;YAClB,CAAA,GAAA,kBAAO,EAAE,mBAAmB;QAChC;QAEA,OAAO,IAAI;IACf;IAEA,SAAS;QACL,IAAI,CAAC,EAAE,QAAQ;QACf,IAAI,CAAC,EAAE,cAAc;QACrB,OAAO,IAAI;IACf;IAEA,SAAS;QACL,MAAM,UAAU,IAAI,CAAA,GAAA,oBAAQ,EAAE,IAAI,CAAC,EAAE,QAAQ,OAAO,IAAI,CAAC,EAAE,QAAQ,QAAQ,CAAA,GAAA,MAAC,EAAE,MAAM,CAAA,GAAA,MAAC,EAAE;QACvF,IAAI,CAAC,EAAE,QAAQ;QACf,QAAQ,OAAO;YACX,CAAA,GAAA,kBAAO,EAAE,mBAAmB;QAChC;QACA,OAAO,YAAY;IACvB;IAEA;;;IAGA,GACA,SAAS;QACL,MAAM,IAAI,IAAI,CAAC,EAAE,QAAQ;QACzB,MAAM,IAAI,IAAI,CAAC,EAAE,QAAQ;QACzB,MAAM,QAAQ,IAAI,WAAW,IAAI,IAAI;QACrC,IAAI,CAAC,EAAE,QAAQ,OAAO;YAClB,CAAA,GAAA,MAAC,EAAE,WAAW,GAAG,GAAG,GAAG,GAAG,CAAA,GAAA,MAAC,EAAE,MAAM,CAAA,GAAA,MAAC,EAAE,eAAe;QACzD;QACA,OAAO;IACX;IAEA,SAAS,KAA4C,EAAK;QACtD,OAAU,SAA2B,GAAG,IAAW;YAC/C,8DAA8D;YAC9D,CAAA,GAAA,SAAI,EAAE,IAAI,CAAC,EAAE;YACb,2EAA2E;YAC3E,OAAO,GAAG,MAAM,IAAI,EAAE;QAC1B;IACJ;IAEA,SAAS,gBAAiB,MAAyB,EAAE,OAAgC;QACjF,MAAM,eAAe;YAAC;YAAS;YAAsB;SAAS;QAC9D,IAAI,UAAwC;QAC5C,aAAa,QAAQ,CAAA;YACjB,IAAI,SACA;YAEJ,iCAAiC;YACjC,IAAI;gBACA,UAAU,OAAO,WAAW,MAAM;YACtC,EAAE,OAAO,GAAG;YACR,SAAS,GACb;QACJ;QACA,OAAO;IACX;IAEA,OAAO;QACH,IAAI,CAAC,OAAO,uBACR,MAAM;QAGV,MAAM,SAAoB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QACvC,MAAM,UAAU,gBAAgB,QAAQ;YAAC,oBAAoB;QAAK;QAClE,IAAI,CAAC,SACD,MAAM;QAEV,CAAA,GAAA,SAAI,EAAE;QAEN,OAAO,IAAI;gBACP,CAAA,GAAA,MAAC;YACD,eAAe;YACf,SAAS;YACT,cAAc;YACd,eAAe;QACnB;QAEA,eAAe;QACf,OAAO,UAAU,KAAK;QACtB,OAAO,OAAO,KAAK;QACnB,OAAO,SAAS,KAAK;QACrB,OAAO,WAAW,KAAK;QACvB,OAAO,gBAAgB,KAAK;QAE5B,iBAAiB;QACjB,OAAO,qBAAqB,KAAK,CAAA,GAAA,sCAAiB;QAClD,OAAO,gBAAgB,KAAK,CAAA,GAAA,4BAAY;QACxC,OAAO,eAAe,KAAK,CAAA,GAAA,0BAAW;QACtC,OAAO,cAAc,KAAK,CAAA,GAAA,wBAAU;QACpC,OAAO,cAAc,KAAK,CAAA,GAAA,wBAAU;QACpC,OAAO,aAAa,KAAK,CAAA,GAAA,sBAAS;QAClC,OAAO,YAAY,KAAK,CAAA,GAAA,oBAAQ;QAChC,OAAO,QAAQ,KAAK,CAAA,GAAA,YAAI;QACxB,OAAO,SAAS,KAAK,CAAA,GAAA,cAAK;QAC1B,OAAO,SAAS,KAAK,CAAA,GAAA,cAAK;QAC1B,OAAO,gBAAgB,KAAK,CAAA,GAAA,4BAAY;QACxC,OAAO,kBAAkB,KAAK,CAAA,GAAA,gCAAc;QAC5C,OAAO,UAAU,KAAK,CAAA,GAAA,gBAAM;QAC5B,OAAO,UAAU,KAAK,CAAA,GAAA,gBAAM;QAE5B,OAAO;IACX;AACJ;;;;;wDC3Ma;AAlBb;AACA;AACA;AACA;AAeO,MAAM,qBAAgD,SAAU,UAAU,EAAE,QAAQ;IACvF,CAAA,GAAA,MAAC,EAAE,qBAAqB,CAAA,GAAA,MAAC,EAAE,sBAAsB,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,ifAejE;IAEH,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,oBAAoB;QAC3C,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM,YAAY,IAAI;QACrC,UAAU,CAAA,GAAA,MAAC,EAAE,MAAM,UAAU,IAAI;IACrC;IAEA,OAAO,IAAI;AACf;;;;;ACtCA,kDAAgB;AAAT,SAAS,aAEZ,MAAgB,EAChB,QAAsC,EACtC,SAAqB,EACrB,UAAsB;IAErB,CAAA,aAAa,IAAI,CAAC,EAAE,OAAM,EAAG;IAC9B,IAAI,CAAC,EAAE,aAAa,OAAO;QACvB,OAAO,SAAS,UAAU;IAC9B;IACA,IAAI,CAAC,EAAE,aAAa,SAAS,cAAc,IAAI,CAAC,EAAE;AACtD;;;;;ACiBA,8CAAa;AAjCb;AAEA;AAKA,MAAM,sBAAsB;AAS5B,MAAM,wBAAwB;AAO9B,SAAS,QAAS,GAAY;IAC1B,OAAO,OAAO,UAAU,SAAS,KAAK,QAAQ;AAClD;AAEA,SAAS,SAAU,GAAY;IAC3B,OAAO,OAAO,UAAU,SAAS,KAAK,QAAQ;AAClD;AAEA,IAAI;AAEG,MAAM;IAET,mBAAmB;IACnB,OAAO,mBAA8B;QACjC,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE,iBAAiB,IAAI;QAC3C,OAAO,CAAA,GAAA,MAAC,EAAE;IACd;IAGA,oBAAoB;IAEZ,cAAe,IAAiB,EAAE,MAAc,EAAE,OAAe,EAAe;QACpF,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,aAAa;QAC9C,CAAA,GAAA,MAAC,EAAE,aAAa,QAAQ,OAAO,QAAQ,aAAa,MAAM,uDAAuD;QACjH,CAAA,GAAA,MAAC,EAAE,cAAc;QACjB,IAAI,CAAC,CAAA,GAAA,MAAC,EAAE,mBAAmB,QAAQ,CAAA,GAAA,MAAC,EAAE,iBAClC,MAAM,oBAAoB,UAAU,QAAQ,CAAA,GAAA,MAAC,EAAE,iBAAiB;QAEpE,OAAO;IACX;IAEA;;KAEC,GACD,AAAQ,qBAAsB,aAAqB,EAAW;QAC1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,yBAAyB,CAAA,GAAA,MAAC,EAAE,iBAAiB;QAC/D,OAAO,WAAW,QAAQ,OAAO,cAAc;IACnD;IAEA,mBAAmB;IACnB,YACI,YAA4B,EAC5B,cAA8B,EAC9B,OAAgB,CAClB;QACE,IAAI,CAAC,kBAAkB;QACvB,IAAI,CAAC,oBAAoB;QACzB,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE;QACjC,eAAe,gBAAgB;QAC/B,iBAAiB,kBAAkB;QACnC,IAAI,CAAC,gBACD,iBAAiB,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,cAAc,UAAW,IAAI,CAAC,qBAAqB,CAAA,GAAA,MAAC,EAAE,gBAAgB,YAAY;QAEpI,iBAAiB,eAAe,iBAAiB,YAAY,gBAAgB,mCAAmC;QAChH,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,SAAS,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,eAAe,cAAc,UAAU;QAC3F,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAC,SAAS,IAAI,CAAC,cAAc,CAAA,GAAA,MAAC,EAAE,iBAAiB,gBAAgB,UAAU;QAC/F,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC;QACpB,IAAI,CAAC,CAAA,GAAA,MAAC,EAAE,oBAAoB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,cACzC,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,kBAAkB,IAAI,CAAC;IAEzD;IAQA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,cAAc,IAAI,CAAC;QACtB,IAAI,CAAC,UAAU;IACnB;IAEA,SAAU,QAAsC,EAAY;QACxD,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC;QACnB,OAAO,QAAQ,UAAU,QAAQ,CAAC,CAAC,MAAM,MAAM;YAE3C,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,mBAAmB,IAAI,CAAC,SAAU;YACtD,IAAI,aAAa,MACb,uDAAuD;YACvD;YAGJ,IAAI,QAAQ,QACR,OAAQ,MAAM;gBACV,KAAK;oBACD,CAAA,GAAA,MAAC,EAAE,WAAW,UAAU,IAAI,aAAa;oBACzC;gBACJ,KAAK;oBACD,CAAA,GAAA,MAAC,EAAE,WAAW,UAAU,IAAI,aAAa;oBACzC;gBACJ,KAAK;oBACD,CAAA,GAAA,MAAC,EAAE,WAAW,UAAU,IAAI,aAAa;oBACzC;gBACJ,KAAK;oBACD,CAAA,GAAA,MAAC,EAAE,WAAW,UAAU,IAAI,aAAa;oBACzC;gBACJ,KAAK;oBACD,CAAA,GAAA,MAAC,EAAE,iBAAiB,UAAU,OAAO,IAAI,aAAa;oBACtD;gBACJ,KAAK;oBACD,CAAA,GAAA,MAAC,EAAE,iBAAiB,UAAU,OAAO,IAAI,aAAa;oBACtD;gBACJ;oBACI,MAAM,uCAAuC,OAAO,iBAAiB,MAAM;YACnF;iBACG,IAAI,SAAS,QAChB,CAAA,GAAA,MAAC,EAAE,UAAU,UAAU;iBAEvB,MAAM,+BAA+B,OAAO,wBAAwB,AAAC,CAAA,AAAC,SAAiB,WAAU,EAAG;QAE5G;QACA,iBAAiB;QACjB,OAAO,IAAI;IACf;IAEA,EAAE;IACF;;;KAGC,GACD,SAAU,QAA+B,EAAY;QACjD,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC;QAEnB,OAAO,QAAQ,UAAU,QAAQ,CAAC,CAAC,MAAM,MAAM;YAC3C,CAAA,GAAA,MAAC,EAAE,UAAU,CAAA,GAAA,MAAC,EAAE,mBAAmB,IAAI,CAAC,SAAU,OAAO;QAC7D;QAEA,iBAAiB;QACjB,OAAO,IAAI;IACf;IAED,SAAU,IAAa,EAAE,GAAY,EAAE,KAAc,EAAE,MAAe,EAAQ;QACzE,IAAI;QACJ,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,aAAa,CAAA,GAAA,MAAC,EAAE;QACpC,MAAM,QAAQ,YAAY,AAAC,CAAA,MAAM,QAAQ,CAAC,EAAE,AAAD,IAAK,QAAQ,CAAC,EAAE,GAAG;QAC9D,OAAO,SAAS,YAAY,AAAC,CAAA,OAAO,QAAQ,CAAC,EAAE,AAAD,IAAK,QAAQ,CAAC,EAAE,GAAG;QACjE,QAAQ,UAAU,YAAY,AAAC,CAAA,QAAQ,QAAQ,CAAC,EAAE,AAAD,IAAK,QAAQ,CAAC,EAAE,GAAG;QACpE,SAAS,WAAW,YAAY,AAAC,CAAA,SAAS,QAAQ,CAAC,EAAE,AAAD,IAAK,QAAQ,CAAC,EAAE,GAAG;QACvE,IAAI,CAAA,GAAA,MAAC,EAAE,iBAAiB,aAAa,CAAA,GAAA,MAAC,EAAE,iBAAiB,MACrD,CAAA,GAAA,MAAC,EAAE,eAAe,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE;QAExC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE;QAClC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,cAAc,IAAI,aAAa;YAAC;YAAM;YAAK;YAAM;YAAQ;YAAO;YAAK;YAAO;SAAO,GAAG,CAAA,GAAA,MAAC,EAAE;QAC1G,IAAI,CAAA,GAAA,MAAC,EAAE,kBAAkB,MAAM;YAC3B,CAAA,GAAA,MAAC,EAAE,iBAAiB,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE;YACtC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE;YAClC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,cAAc,IAAI,aAAa;gBAAC;gBAAG;gBAAG;gBAAG;gBAAG;gBAAG;gBAAG;gBAAG;aAAE,GAAG,CAAA,GAAA,MAAC,EAAE;QAClF;QACA,IAAI,IAAI,CAAC,mBAAmB,MAAM;YAC9B,IAAI,CAAC,kBAAkB,CAAA,GAAA,MAAC,EAAE,kBAAkB,IAAI,CAAC,SAAU;YAC3D,CAAA,GAAA,MAAC,EAAE,wBAAwB,IAAI,CAAC;QACpC;QACA,IAAI,IAAI,CAAC,qBAAqB,MAAM;YAChC,IAAI,CAAC,oBAAoB,CAAA,GAAA,MAAC,EAAE,kBAAkB,IAAI,CAAC,SAAU;YAC7D,CAAA,GAAA,MAAC,EAAE,wBAAwB,IAAI,CAAC;QACpC;QACA,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC;QACnB,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE;QAClC,CAAA,GAAA,MAAC,EAAE,oBAAoB,IAAI,CAAC,iBAAiB,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO,GAAG;QACpE,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE;QAClC,CAAA,GAAA,MAAC,EAAE,oBAAoB,IAAI,CAAC,mBAAmB,GAAG,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO,GAAG;QACtE,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,gBAAgB,GAAG;IACxC;AAEJ;;;;;wCC1LW;AAEX,2CAAgB;AAFT,IAAI;AAEJ,SAAS,MAAO,KAAmB;IACtC,qCAAqC;IACrC,KAAK;AACT;;;;;ACcA,+CAAa;AArBb;AACA;AAoBO,MAAM;IAET,mBAAmB;IACnB,OAAO,YAAa,OAA6B,EAAa;QAC1D,MAAM,UAAU,IAAI,UAAU,GAAG,GAAG,CAAA,GAAA,MAAC,EAAE,MAAM,CAAA,GAAA,MAAC,EAAE;QAChD,QAAQ,eAAe;QACvB,OAAO;IACX;IAOA;;;;;;;;;;;KAWC,GAGD,mBAAmB;IACnB,YACI,KAAa,EACb,MAAc,EACd,MAAsB,EACtB,IAAkB,CACpB;QACE,IAAI,CAAC,KAAK,CAAA,GAAA,MAAC;QACX,IAAI,CAAC,KAAK,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE;QAC5B,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,SAAS;QAEd,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC;QACnC,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,oBAAoB,CAAA,GAAA,MAAC,EAAE;QAC1D,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,oBAAoB,CAAA,GAAA,MAAC,EAAE;QAC1D,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE;QACtD,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE;QACtD,IAAI,SAAS,QACT,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,YAAY,GAAG,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM;IAE/F;IAUA,eAAgB,OAA6B,EAAQ;QACjD,IAAI,CAAC,QAAQ,QAAQ,SAAS,AAAC,QAA6B;QAC5D,IAAI,CAAC,SAAS,QAAQ,UAAU,AAAC,QAA6B;QAC9D,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC;QACnC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,YAAY,GAAG,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM;IACzE;IAEA,cAAe,KAAa,EAAE,MAAc,EAAE,IAAc,EAAQ;QAChE,IAAI,CAAC,QAAQ;QACb,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE;QACjB,IAAI,CAAC,OAAO,CAAA,GAAA,MAAC,EAAE;QACf,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC;QACnC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,YAAY,GAAG,CAAA,GAAA,MAAC,EAAE,MAAM,OAAO,QAAQ,GAAG,CAAA,GAAA,MAAC,EAAE,MAAM,IAAI,CAAC,MAAM,IAAI,WAAW;IAClG;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,cAAc,IAAI,CAAC;QACtB,IAAI,CAAC,KAAK;IACd;IAEA,IAAK,IAAa,EAAQ;QACtB,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,WAAY,CAAA,QAAQ,CAAA;QACxC,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC;IACvC;IAEA,MAAO,IAAY,EAAQ;QACvB,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,WAAY,CAAA,QAAQ,CAAA;QACxC,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY;IAClC;IAEA,aAAc,KAAa,EAAE,MAAc,EAAE,MAAsB,EAAE,IAAkB,EAAQ;QAC3F,qCAAqC;QACrC,IAAI,SAAS,IAAI,CAAC,SAAS,UAAU,IAAI,CAAC,UAAU,UAAU,IAAI,CAAC,UAAU,QAAQ,IAAI,CAAC,MAAM;YAC5F,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,SAAS;YACd,IAAI,CAAC,SAAS;YACd,IAAI,CAAC,OAAO;YACZ,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC;YACnC,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,MAAC,EAAE,YAAY,GAAG,IAAI,CAAC,QAAQ,OAAO,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM;QAC3F;IACJ;IAEA,uBAAwB,OAAkB,EAAQ;QAC9C,IAAI,CAAC,aAAa,QAAQ,OAAO,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ;IAC7E;IAEA,OAAQ,QAAoB,EAAQ;QAChC,kCAAkC;QAClC,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,eAAe,CAAA,GAAA,MAAC,EAAE;QACtC,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE,aAAa,CAAA,GAAA,MAAC,EAAE;QACtC,CAAA,GAAA,MAAC,EAAE,qBAAqB,CAAA,GAAA,MAAC,EAAE,aAAa,CAAA,GAAA,MAAC,EAAE,mBAAmB,CAAA,GAAA,MAAC,EAAE,YAAY,IAAI,CAAC,IAAI;QACtF,IAAI,CAAA,GAAA,MAAC,EAAE,uBAAuB,CAAA,GAAA,MAAC,EAAE,iBAAiB,CAAA,GAAA,MAAC,EAAE,sBACjD,MAAM,IAAI,MAAM;QAEpB,CAAA,GAAA,MAAC,EAAE,SAAS,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,CAAC;QAEnC,iBAAiB;QACjB;QAEA,iCAAiC;QACjC,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE,aAAa;IACvC;IAGA;;;;;;;;;;;;;;;;;;;;;;;;;;KA0BC,GAED,SAAU,KAAgB,EAAQ;QAC9B,IAAI;QAEJ,OAAO,MAAM;QACb,MAAM,KAAK,IAAI,CAAC;QAChB,IAAI,CAAC,KAAK;QAEV,OAAO,MAAM;QACb,MAAM,QAAQ,IAAI,CAAC;QACnB,IAAI,CAAC,QAAQ;QAEb,OAAO,MAAM;QACb,MAAM,SAAS,IAAI,CAAC;QACpB,IAAI,CAAC,SAAS;QAEd,OAAO,MAAM;QACb,MAAM,SAAS,IAAI,CAAC;QACpB,IAAI,CAAC,SAAS;IAEd,QAAQ;IACZ;AACJ;;;;;4CCtKa;AA9Bb;AACA;AACA;AACA;AA2BO,MAAM,SAAwB,SAAU,GAAG,EAAE,KAAK,EAAE,IAAI;IAC3D,0BAA0B;IAC1B,MAAM,UAAU,CAAA,GAAA,oCAAgB,EAAE;IAClC,MAAM,YAAY,CAAA,GAAA,oCAAgB,EAAE;IACpC,MAAM,WAAW,CAAA,GAAA,oCAAgB,EAAE;IACnC,MAAM,QAAkB,EAAE;IAC1B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IACrB,MAAM,OAAO,MAAM,QAAQ,GAAG,OAAO,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE;IAEzE,IAAI,CAAC,EAAE,aAAa,cAAc,KAAK,GAAG;IAC1C,IAAI,CAAC,EAAE,aAAa,IAAI;IAExB,CAAA,GAAA,MAAC,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,6XAWzC;IAEH,CAAA,GAAA,MAAC,EAAE,OAAO,SAAS;QACf,KAAK;IACT;IACA,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,QAAQ,CAAC;IAEpC,OAAO,IAAI;AACf;;;;;AC3DA,uDAAgB;AAFhB;AAEO,SAAS,kBAAmB,MAA0B;IACzD,MAAM,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;IAC/C,MAAM,QAAQ,EAAE;IAChB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IACrB,MAAM,KACF,CAAA,GAAA,MAAC,EAAE,MACC,KAAK,MAAM,aAAa,YAAY,IAAI,OAAO,MAC/C,GACA;IAIZ,OAAO;AACX;;;;;mDCSa;AAxBb;AACA;AACA;AACA;AAqBO,MAAM,gBAAsC,SAAU,GAAG,EAAE,UAAU;IACxE,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,mlCA6BvD;IAEH,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,eAAe;QACtC,KAAK,CAAA,GAAA,MAAC,EAAE,MAAM,KAAK,IAAI;QACvB,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM,YAAY,IAAI;IACzC;IAEA,OAAO,IAAI;AACf;;;;;2CCnCa;AA3Bb;AACA;AACA;AACA;;AAwBO,MAAM,QAAsB,SAC/B,IAAI,EACJ,IAAI,EACJ,KAAK,EACL,MAAM,EACN,OAAO,EACP,OAAO,EACP,KAAK,EACL,UAAU,EACV,QAAQ,EACR,UAAU,EACV,IAAI,EACJ,IAAI,EACJ,QAAQ;IAER,CAAA,GAAA,MAAC,EAAE,QAAQ,CAAA,GAAA,MAAC,EAAE,SAAS,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,CAAA,GAAA,+BAAU,EAAE,QAAQ,aAAa,KAAK;IAChF,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,OAAO;QAC9B,MAAM,QAAQ;QACd;QACA,OAAO;YAAC,KAAK,CAAC,EAAE;YAAE,KAAK,CAAC,EAAE;SAAC;QAC3B;QACA;QACA;QACA,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;QAClC;QACA;QACA;QACA,YAAY,aAAa,MAAM;QAC/B,MAAM,OAAO;YAAC,KAAK,IAAI;YAAK,KAAK,IAAI;YAAK,KAAK,IAAI;SAAI,GAAG;YAAC;YAAG;YAAG;SAAE;QACnE,MAAM,OAAO;YAAC,KAAK,IAAI;YAAK,KAAK,IAAI;YAAK,KAAK,IAAI;SAAI,GAAG;YAAC;YAAG;YAAG;SAAE;QACnE,UAAU,aAAa,QAAQ,IAAI;IACvC;IAEA,OAAO,IAAI;AACf;;;AC7DA,OAAO,UAAQ;;;;;kDCoBF;AApBb;AACA;AACA;AACA;AAiBO,MAAM,eAAoC,SAAU,MAAM;IAC7D,CAAA,GAAA,MAAC,EAAE,eAAe,CAAA,GAAA,MAAC,EAAE,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,wGAIhD,CAAA,GAAA,kCAAe,IAAI,+pBAmBxB;IAEH,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,cAAc;QACrC,OAAO;YAAC,SAAS,IAAI,CAAC;YAAO;SAAE;IACnC;IACA,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,cAAc;QACrC,OAAO;YAAC;YAAG,SAAS,IAAI,CAAC;SAAO;IACpC;IAEA,OAAO,IAAI;AACf;;;ACtDA,0CAA0C;;;sDAC7B;AAAN,MAAM,mBAAmB;;;;;+CCkCnB;AAnCb;AACA;AACA;AACA;AAgCO,MAAM,YAA8B,SACvC,MAAM,EACN,MAAM,EACN,IAAI,EACJ,IAAI,EACJ,UAAU,EACV,cAAc;IAEd,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,MAAC,EAAE,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,+PAS1C,CAAA,GAAA,kCAAe,IAAI,03BAqBxB;IAEH,MAAM,KAAK,OAAO;IAClB,MAAM,KAAK,OAAO;IAClB,MAAM,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;IACnC,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,WAAW;QAClC,YAAY;QACZ,gBAAgB;QAChB,OAAO;YAAC;YAAQ;SAAO;QACvB,KAAK;YAAC;YAAM;SAAK;QACjB,OAAO;YAAC,KAAK;YAAG,KAAK;SAAE;QACvB,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IACA,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,WAAW;QAClC,YAAY;QACZ,gBAAgB;QAChB,OAAO;YAAC;YAAQ;SAAO;QACvB,KAAK;YAAC;YAAM;SAAK;QACjB,OAAO;YAAC,CAAC,KAAK;YAAG,KAAK;SAAE;QACxB,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IAEA,OAAO,IAAI;AACf;;;;;gDCnEa;AA7Bb;AACA;AACA;AACA;AA0BO,MAAM,aAAgC,SAAU,MAAM,EAAE,OAAO,EAAE,eAAe;IACnF,CAAA,GAAA,MAAC,EAAE,aAAa,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,sBAAS,EAAE,yEAGzC;IAOH,kDAAkD;IAClD,SAAS,OAAO;IAEhB,4CAA4C;IAC5C,IAAI,OAAO,UAAU,GACjB,SAAS;QACL,MAAM,CAAC,EAAE;QAAE,MAAM,CAAC,EAAE;QAAE;QACtB,MAAM,CAAC,EAAE;QAAE,MAAM,CAAC,EAAE;QAAE;QACtB;QAAG;QAAG;KACT;SACE,IAAI,OAAO,UAAU,GACxB,MAAM;IAGV,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,YAAY;QACnC,QAAQ,UAAU,CAAA,GAAA,kBAAS,EAAE,UAAU;QACvC,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;QAClC,iBAAiB,kBAAkB,IAAI;IAC3C;IAEA,OAAO,IAAI;AACf;;;;;AC3DA,gDAAgB;AAFhB;AAEO,SAAS,WAAY,WAAmB,EAAE,OAAe;IAC5D,OAAO,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,cAAc,uJAMhC,UAAU,0TAOd;AACR;;;;;ACfA,4CAA4C;AAE5C;;CAEC,GACD,qDAAgB;AA0BhB,gDAAgB;AAYhB,8CAAgB;AAtCT,SAAS,gBACZ,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU;IAEV,MAAM,MAAM,KAAK;IACjB,MAAM,MAAM,KAAK;IACjB,MAAM,MAAM,KAAK;IACjB,MAAM,MAAM,KAAK;IACjB,MAAM,MAAM,KAAK,KAAK,KAAK;IAC3B,MAAM,MAAM,KAAK,KAAK,KAAK;IAC3B,MAAM,MAAM,MAAM,MAAM,MAAM;IAC9B,MAAM,IAAI,AAAC,CAAA,MAAM,MAAM,MAAM,GAAE,IAAK;IACpC,MAAM,IAAI,AAAC,CAAA,MAAM,MAAM,MAAM,GAAE,IAAK;IACpC,OAAO;QACH,KAAK,KAAK,IAAI;QAAI,KAAK,KAAK,IAAI;QAAI;QACpC,KAAK,KAAK,IAAI;QAAI,KAAK,KAAK,IAAI;QAAI;QACpC;QAAI;QAAI;KACX;AACL;AAEO,SAAS,WAAY,CAAU;IAClC,MAAM,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE;IAClC,MAAM,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE;IAClC,MAAM,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE;IAClC,MAAM,MAAM,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;IAChF,OAAO;QACF,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAAM,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAAM,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAC/D,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAAM,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAAM,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAC/D,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAAM,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;QAAM,CAAA,IAAI,IAAI,IAAI,CAAA,IAAK;KACnE;AACL;AAEO,SAAS,SAAU,CAAU,EAAE,CAAU;IAC5C,OAAO;QACH,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;KAC1C;AACL;;;;;iDCvCa;AAlBb;AACA;AACA;AAgBO,MAAM,cAAkC,SAAU,MAAM,EAAE,QAAQ;IACrE,CAAA,GAAA,MAAC,EAAE,cAAc,CAAA,GAAA,MAAC,EAAE,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,wZAWnD;IAEH,iEAAiE;IACjE,IAAI,CAAC,EAAE,aAAa,uBAAuB,IAAI,CAAC,EAAE;IAClD,IAAI,CAAC,EAAE,QAAQ;IACf,IAAI,CAAC,EAAE,aAAa,OAAO;QACvB,CAAA,GAAA,kBAAO,EAAE,mBAAmB;IAChC;IAEA,wEAAwE;IACxE,IAAI,CAAC,EAAE,aAAa,IAAI;IACxB,IAAI,CAAC,aAAa;IAClB,CAAA,GAAA,MAAC,EAAE,YAAY,SAAS;QACpB,iBAAiB;IACrB;IACA,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,aAAa;QACpC,UAAU;IACd;IACA,IAAI,CAAC,EAAE,aAAa,MAAM;IAE1B,OAAO,IAAI;AACf;;;;;6CCjCa;AAlBb;AACA;AACA;AAgBO,MAAM,UAA0B,SAAU,UAAU,EAAE,WAAW;IACpE,CAAA,GAAA,MAAC,EAAE,UAAU,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,2cAe/C;IAEC,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,SAAS;QAChC,YAAY,aAAa,IAAI;QAC7B,SAAS,cAAc;YAAC,YAAY,IAAI;YAAK,YAAY,IAAI;YAAK,YAAY,IAAI;YAAK,YAAY;SAAE,GAAG;YAAC;YAAG;YAAG;YAAG;SAAE;QACpH,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IAEA,OAAO,IAAI;AACf;;;;;4CC9Ba;AAbb;AACA;AACA;AAWO,MAAM,SAAwB;IACjC,CAAA,GAAA,MAAC,EAAE,SAAS,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,kOAU7C;IAEC,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,QAAQ;QAC/B,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IAEA,OAAO,IAAI;AACf;;;;;iDCJa;AA3Bb;AA2BO,MAAM,cAAkC,SAAU,MAAM,EAAE,KAAK;IAClE,MAAM,IAAI,CAAA,GAAA,uBAAc,KAAK;IAC7B,MAAM,IAAI,CAAA,GAAA,uBAAc,KAAK;IAC7B,MAAM,IAAI,CAAA,GAAA,gBAAO,EAAE,CAAA,GAAA,kBAAS,EAAE,IAAI;IAClC,OAAO,IAAI,CAAC,WAAW;AAC3B;;;;;qDCnBa;AAbb;AACA;AACA;AAWO,MAAM,kBAA0C;IACnD,CAAA,GAAA,MAAC,EAAE,kBAAkB,CAAA,GAAA,MAAC,EAAE,mBAAmB,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,mQAY/D;IAEC,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,iBAAiB;QACxC,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IAEA,OAAO,IAAI;AACf;;;;;6CCJa;AA7Bb;AACA;AACA;AA2BO,MAAM,UAA0B,SAAU,QAAQ;IACrD,CAAA,GAAA,MAAC,EAAE,UAAU,CAAA,GAAA,MAAC,EAAE,WAAW,CAAA,GAAA,sBAAS,EAAE,CAAC;;;;;;;AAO3C,CAAC,EAAE,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;AAyBJ,CAAC;IAEG,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,SAAS;QAChC,UAAU,SAAS;QACnB,MAAM,SAAS;QACf,OAAO;YAAC,SAAS,MAAM;YAAG,SAAS,MAAM;SAAE;QAC3C,UAAU;YAAC,SAAS,SAAS;YAAG,SAAS,SAAS;SAAE;QACpD,OAAO;YAAC,SAAS,MAAM;YAAG,SAAS,MAAM;SAAE;QAC3C,QAAQ;YAAC,SAAS,OAAO;YAAG,SAAS,OAAO;SAAE;QAC9C,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IAEA,OAAO,IAAI;AACf;;;;;mDC9Da;AAbb;AACA;AACA;AAWO,MAAM,gBAAsC;IAC/C,CAAA,GAAA,MAAC,EAAE,gBAAgB,CAAA,GAAA,MAAC,EAAE,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE,MAAM,2NAU3D;IAEC,CAAA,GAAA,0BAAW,EAAE,KAAK,IAAI,EAAE,CAAA,GAAA,MAAC,EAAE,eAAe;QACtC,SAAS;YAAC,IAAI,CAAC;YAAO,IAAI,CAAC;SAAO;IACtC;IAEA,OAAO,IAAI;AACf;;;;;ACuEA,iDAAgB;AAtGhB;AACA;AAEA;AAEA;AACA;;AAcA;;CAEC,GACD,eAAe,OACX,MAAyB,EACzB,KAAa,EACb,WAAmB,EACnB,IAAoB,EACpB,QAAgB;IAEhB,MAAM,MAAM,CAAA,GAAA,0BAAW,EAAE,OAAO,UAAU,WAAW;IAErD,MAAM,IAAI,OAAO;IAEjB,IAAI,CAAC,GACD,MAAM,IAAI,MAAM;IAGpB,MAAM,QAAQ,EAAE,SAAS,cAAc;IACvC,MAAM,MAAM,EAAE,SAAS,cAAc;IACrC,IAAI,MAAM,CAAA,GAAA,0BAAS;IACnB,MAAM,OAAO;IACb,CAAA,GAAA,MAAC,EAAE,IAAI,KAAK;QACR,QAAQ;IACZ;IACA,CAAA,GAAA,MAAC,EAAE,IAAI,EAAE,SAAS,MAAM;QACpB,iBAAiB;QACjB,iBAAiB;QACjB,kBAAkB;IACtB;IAEA,MAAM,YAAY,EAAE,SAAS,cAAc;IAC3C,UAAU,MAAM,YAAY;IAC5B,MAAM,OAAO;IACb,UAAU,cAAc,CAAA,GAAA,cAAG,EAAE;IAE7B,EAAE,SAAS,KAAK,OAAO;IACvB,CAAA,GAAA,MAAC,EAAE,IAAI,OAAO;QACV,YAAY;QACZ,aAAa;QACb,WAAW;QACX,YAAY;QACZ,UAAU;QACV,WAAW;QACX,YAAY;QACZ,SAAS;QACT,OAAO;IACX;IACA,WAAW;QACP,MAAM,MAAM,UAAU;IAC1B,GAAG;IAEH,IAAI;IACJ,IAAI;QACA,MAAM,WAAW,IAAI;QACrB,SAAS,OAAO,SAAS;QACzB,SAAS,OAAO,eAAe;QAC/B,SAAS,OAAO,SAAS;QACzB,WAAW,MAAM,MAAM,iCAAkC;YACrD,QAAQ;YACR,SAAS;gBACL,eAAe,eAAe;YAClC;YACA,MAAM;QACV;IAEJ,EAAE,OAAO,GAAG;QACR,EAAE;QACF,MAAM;IACV;IACA,IAAI,CAAC,SAAS,IAAI;QACd,EAAE;QACF,MAAM,IAAI;IACd;IACA,MAAM,OAA6B,AAAC,CAAA,MAAM,SAAS,MAAK,EAAG;IAE3D,EAAE,SAAS,OAAO,KAAK,KAAK,QAAQ,eAAe;IAEnD,OAAO;AACX;AAGO,SAAS,YACZ,QAAkB,EAClB,QAAqB,EACrB,YAA0B,EAC1B,QAAgB;IAEhB,IAAI,CAAC,UACD,MAAM,IAAI,MAAM;IAGpB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;QAAC,SAAS;IAAO;IAC1C,WAAW,OAAO;IAClB,WAAW,QAAQ,CAAA,GAAA,cAAG,EAAE;IACxB,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;QAC3B,SAAS;QACT,QAAQ;YACJ,MAAM;QACV;QACA,KAAK;YACD,OAAO;YACP,UAAU;QACd;IACJ;IAEA,MAAM,aAAc,CAAA,GAAA,MAAC,EAAE,GAAG;QACtB,aAAa,CAAA,GAAA,cAAG,EAAE,iBAAiB;IACvC;IACA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;QAC3B,aAAa,CAAA,GAAA,cAAG,EAAE,oBAAoB;QACtC,KAAK;YACD,WAAW;QACf;IACJ;IAEA,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,GAAG;QACd,SAAS,CAAC,+EAA+E,EAAE,CAAA,GAAA,cAAG,EAAE,oBAAoB,IAAI,CAAC;IAC7H;IAEA,MAAM,YAAY,IAAI,CAAA,GAAA,MAAC,EAAE,UAAU;QAC/B,MAAM;QACN,MAAM;QACN,OAAO;YACH;gBAAE,OAAO;gBAAO,OAAO;YAAO;YAC9B;gBAAE,OAAO;gBAAO,OAAO;YAAM;SAChC;QACD,aAAa;IACjB;IACA,CAAA,GAAA,MAAC,EAAE,IAAI,UAAU,cAAc;QAC3B,cAAc;IAClB;IAGA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;IAClB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;QACnB,WAAW;QACX,aAAa,CAAA,GAAA,cAAG,EAAE;IACtB;IACA,OAAO,OACH,UACA,UAAU,cACV,YACA,YACA,kBACA,kBACA;IAEJ,CAAA,GAAA,MAAC,EAAE,MAAM;QACL,QAAQ;QACR,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,gBAAgB,IAAI,CAAC;QACzC,MAAM;QACN,KAAK;QACL,SAAS;YAAC,CAAA,GAAA,cAAG,EAAE;YAAkB;SAAS;QAC1C,cAAc,CAAA,GAAA,cAAG,EAAE;QACnB,WAAW;YAAC,CAAA,GAAA,cAAG,EAAE;SAAiB;QAClC,WAAW,CAAA,GAAA,cAAG,EAAE;QAChB,UAAU,eAAgB,GAAG;YACzB,IAAI,QAAQ,CAAA,GAAA,cAAG,EAAE,oBAAoB,QAAQ,SAAS,QAAQ,MAC1D,IAAI;gBACA,MAAM,SAAS,MAAM,OACjB,SAAS,kBAAkB,IAC3B,WAAW,OACX,iBAAiB,OACjB,UAAU,YACV;gBAGJ,CAAA,GAAA,MAAC,EAAE,MAAM;oBACL,QAAQ;oBACR,MAAM;oBACN,SAAS,CAAC,IAAI,EAAE,CAAA,GAAA,cAAG,EAAE,kBAAkB,SAAS,EAAE,CAAA,GAAA,cAAG,EAAE,iBAAiB,gFAAgF,EAAE,OAAO,WAAW,mBAAmB,EAAE,OAAO,WAAW,YAAY,CAAC;oBAChO,SAAS;wBAAC;qBAAK;gBACnB;gBACA,aAAa;YAEjB,EAAE,OAAM,GAAG;gBACP,CAAA,GAAA,MAAC,EAAE,MAAM;oBACL,QAAQ;oBACR,MAAM;oBACN,SAAS,CAAA,GAAA,cAAG,EAAE;oBACd,SAAS;wBAAC;qBAAK;gBACnB;YACJ;QAER;IACJ;AACJ;;;AC/MA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,yBAAyB,MAAM,KAAK;;;;;ACI7G,+CAAsB;AAFtB,IAAI;AAEG,eAAe;IAClB,IAAI,CAAC,WACD,YAAY,MAAM,QAAO;IAE7B,OAAO;AACX;;;ACTA,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,qBAAqB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;;;ACazP;;CAEC,GACD,kDAAa;AAhBb;AACA;AAEA;AACA;AAMA,MAAM,sBAAsB,KAAK,6CAA6C;AAC9E,MAAM,kBAAkB;AAKjB,MAAM;IAUT,YAAmB;QACf,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,YAC5B,MAAM,IAAI,MAAM;QAGpB,MAAM,MAAM,KAAK,MAAM,AAAC,CAAA,YAAY,QAAQ,IAAI,CAAC,WAAU,IAAK,OAAO;QAEvE,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE;QAErB,UAAU,OACN,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,SAAS,CAAA,GAAA,cAAG,EACR,sBACA;gBACI,GAAG,aAAa;gBAChB,GAAG;YACP;YAEJ,KAAK;gBACD,cAAc;YAClB;QACJ;QAGJ,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,KAAK;gBACD,WAAW;gBACX,QAAQ;gBACR,SAAS;YACb;QACJ;QACA,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,KAAK;gBACD,WAAW;gBACX,QAAQ;gBACR,SAAS;gBACT,eAAe;YACnB;QACJ;QACA,UAAU,OAAO,YAAY;QAG7B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,SAAS;YACT,WAAW;YACX,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,SAAS,IAAM,IAAI,CAAC;QACxB;QACA,WAAW,OACP,QACA,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,KAAK;gBACD,WAAW;YACf;QACJ;QAIJ,MAAM,YAAY,IAAI,CAAA,GAAA,kCAAe,EACjC,IAAI,CAAC,cACL,IAAI,CAAC,YACL,IAAI,EACJ,SAAS,MACT;YACI,iBAAiB;YACjB,aAAa;QACjB;QAEJ,eAAe,OAAO,UAAU;QAGhC,CAAA,GAAA,MAAC,EAAE,MAAM;YACL,QAAQ,SAAS;YACjB,SAAS,CAAC,GAAG,EAAE,CAAA,GAAA,cAAG,EAAE,uBAAuB,IAAI,CAAC;YAChD,KAAK;YACL,kBAAkB;YAClB,UAAU;gBACN,UAAU;gBACV,CAAA,GAAA,MAAC,EAAE,UAAU;gBACb,IAAI,CAAC,YAAY;gBACjB,IAAI,CAAC,sBAAsB,YAAY;YAC3C;YACA,WAAW,CAAC;gBACR,IAAI,CAAC,YAAY;YACrB;QACJ;QACA,WAAW;YACP,OAAO;QACX,GAAG;IACP;IAEA,YACY,SACA,cACA,aACA,aACA,WACA,cACA,YACA,QAAgB,QAAQ,CAClC;uBARU;4BACA;2BACA;2BACA;yBACA;4BACA;0BACA;qBACA;aA1GJ,cAAsB;aAEtB,sBAA8B;QA0GlC,IAAI,CAAC,UAAU,AAAC,aAAa,QAAQ,oBAAoD;IAC7F;IAEA,OAAc;QACV,IAAI,IAAI,CAAC,0BAA0B,WAC/B;QAEJ,IAAI,CAAC,wBAAwB,IAAI,CAAC,QAAQ;QAC1C,IAAI,CAAC,sBAAsB,YAAY;QACvC,IAAI,CAAC,cAAc,YAAY;QAE/B,IAAI,IAAI,CAAC,cACL,YAAY;YACR,IAAI,SAAS,oBAAoB,WAC7B;YAGJ,MAAM,iBAAiB,KAAK,IAAI,IAAI,CAAC,QAAQ,oBAAoB,IAAI,CAAC;YAEtE,MAAM,cAAc,QAAY,CAAA;gBAC5B,SAAS;gBACT,SAAS;gBACT,YAAY;YAChB,CAAA,CAAC,CAAC,IAAI,CAAC,QAAQ;YAEf,IACI,cAAc,KACd,CAAA,GAAA,MAAC,EAAE,cAAc,UAAU,KAC3B,CAAC,IAAI,CAAC,eACN,IAAI,CAAC,sBAAsB,cAAc,YAAY,SACrD,kBAAkB,qBAElB,IAAI,CAAC;QAEb,GAAG;QAGP,uCAAuC;QACvC,SAAS,eAAgB,CAAoB;YACzC,EAAE;YACF,EAAE,cAAc;QACpB;QAEA,IAAI,CAAC,QAAQ,YAAY;YACrB,MAAM,eAAe,IAAI,CAAC,QAAQ;YAClC,IAAI,IAAI,CAAC,0BAA0B,cAC/B,OAAO,iBAAkB;iBAEzB,OAAO,iBAAiB;QAEhC;QAEA,IAAI,IAAI,CAAC,aACL,SAAS,iBAAiB,oBAAoB;YAC1C,IAAI,SAAS,oBAAoB,WAAW;gBACxC,SAAS,QAAQ,IAAI,CAAC;gBACtB,cAAc,IAAI,CAAC;YACvB,OAAO;gBACH,MAAM,eAAe,IAAI,CAAC,QAAQ;gBAClC,IAAI,IAAI,CAAC,0BAA0B,cAAc;oBAC7C,SAAS,QAAQ,CAAA,GAAA,cAAG,EAAE,aAAa,QAAQ,IAAI,CAAC;oBAChD,IAAI,QAAQ;oBACZ,IAAI,CAAC,kBAAkB,YAAY;wBAC/B,QAAQ,AAAC,CAAA,QAAQ,CAAA,IAAK;wBACtB,IAAI,UAAU,GACV,SAAS,QAAQ,CAAA,GAAA,cAAG,EAAE,aAAa,WAAQ,IAAI,CAAC;6BAEhD,SAAS,QAAQ,CAAA,GAAA,cAAG,EAAE,aAAa,QAAQ,IAAI,CAAC;oBAExD,GAAG;gBACP;YACJ;QACJ;IAER;IAEA,QAAe;QACX,IAAI,IAAI,CAAC,0BAA0B,WAC/B;QAGJ,IAAI,CAAC,wBAAwB,IAAI,CAAC,QAAQ;QAC1C,IAAI,CAAC,sBAAsB,YAAY;QACvC,IAAI,CAAC,cAAc,YAAY;QAC/B,OAAO,iBAAiB;QAExB,IAAI,IAAI,CAAC,WACL,IAAI,CAAC;IAEb;IAEA,aAAoC;QAChC,OAAO,IAAI,CAAC;IAChB;IAEA,WAAY,OAA6B,EAAQ;QAC7C,IAAI,CAAC,UAAU;QACf,aAAa,QAAQ,iBAAiB,IAAI,CAAC;IAC/C;AACJ;;;;;AC1NA,oDAAa;AATb;AACA;AAIA;AAEA;AAEO,MAAM;IAET;;;KAGC,GACD,AAAQ,UAAW,MAAyB,EAAE,QAAgB,EAAE,QAAgB,EAAQ;QACpF,MAAM,QAAQ,OAAO,UAAU,UAAU,MAAM;QAE/C,IAAI,CAAC,OACD,MAAM,IAAI,MAAM;QAGpB,wBAAwB;QACxB,MAAM,SAAS,KAAK,KAAK,CAAC,EAAE;QAC5B,kCAAkC;QAClC,MAAM,MAAM,IAAI,YAAY,OAAO;QACnC,MAAM,OAAO,IAAI,WAAW;QAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,QAAQ,IAC7B,IAAI,CAAC,EAAE,GAAG,OAAO,WAAW;QAEhC,MAAM,OAAO,IAAI,KAAK;YAAC;SAAK,EAAE;YAAC,QAAQ,KAAK,CAAC,EAAE;QAAA;QAC/C,CAAA,GAAA,cAAK,EAAE,MAAM;IACjB;IAEA,YACY,cACA,eACA,YACV;4BAHU;6BACA;2BACA;IACT;IAEH,KAAM,MAAiC,EAAQ;QAC3C,IAAI,CAAC,aAAa;QAElB,IAAI,CAAC,QACD,SAAS,IAAI,CAAC;QAGlB,IAAI,WAAW,OAAO;YAClB,MAAM,YAAY;YAClB,MAAM,WAAW;YACjB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,kBAAO,EAAE,eAAe,MAAM;YAC9D,MAAM,aAAa,IAAI,CAAC,cAAc,kBAAkB;YACxD,IAAI;gBACA,IAAI,CAAC,UAAU,YAAY,UAAU;YACzC,EAAE,OAAO,OAAO;gBACZ,MAAM;gBACN,MAAM,IAAI,MAAM;YACpB;QACJ,OAAO,IAAI,WAAW,UAAU;YAC5B,MAAM,YAAY;YAClB,MAAM,WAAW;YACjB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,kBAAO,EAAE;YACzC,MAAM,WAAW,IAAI,CAAC,cAAc;YACpC,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,QAAQ,IAAK;gBACtC,MAAM,OAAO,QAAQ,CAAC,EAAE;gBACxB,MAAM,WAAW;oBACb;oBACA;oBACC,CAAA,KAAM,CAAA,IAAI,CAAA,CAAC,EAAG,SAAS,GAAG;oBAC3B;oBACA,KAAK;oBACL;oBACA;iBACH;gBACD,IAAI,CAAC,UAAU,KAAK,QAAQ,SAAS,KAAK,KAAK;YACnD;QACJ,OAAO,IAAI,WAAW,OAAO;YAEzB,MAAM,WAAW,IAAI,CAAC,cAAc;YAEpC,MAAM,YAAiB;gBACnB,OAAO,IAAI,CAAC,cAAc;gBAC1B,QAAQ,IAAI,CAAC,cAAc;gBAC3B,UAAU,EAAE;gBACZ,QAAQ,IAAI,CAAC,cAAc,kBAAkB;YACjD;YACA,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,QAAQ,IAAK;gBACtC,MAAM,OAAO,QAAQ,CAAC,EAAE;gBACxB,UAAU,SAAU,KAAK;oBACrB,MAAM,KAAK;oBACX,QAAQ,CAAC,KAAK;oBACd,SAAS,KAAK;oBACd,QAAQ,KAAK;oBACb,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI,aAAa,KAAK;oBACpC,MAAM;oBACN,KAAK;gBACT;YACJ;YAEA,CAAA,GAAA,MAAC,EAAE,YAAY,KAAK,CAAC;gBACjB,MAAM,SAAS,UAAU,eAAe;gBACxC,MAAM,OAAO,IAAI,KAAK;oBAAC;iBAAO,EAAE;oBAAE,MAAM;gBAA2B;gBACnE,CAAA,GAAA,cAAK,EAAE,MAAM,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,kBAAO,EAAE,eAAe;YACxD,GAAG,MAAM;gBACL,MAAM;YACV;QAEJ;IAEJ;AAEJ;;;AC/GA,qDAAqD;AACrD,yGAAyG;;;AAEzG,4CAAgB;AAAT,SAAS,OAAQ,IAAU,EAAE,IAAY;IAC5C,qIAAqI;IACrI,MAAM,IAAI,SAAS,gBAAgB,gCAAgC;IACnE,EAAE,WAAW;IACb,EAAE,MAAM;IACR,EAAE,OAAO,IAAI,gBAAgB;IAE7B,WAAW,IAAM,IAAI,gBAAgB,EAAE,OAAO;IAC9C,WAAW,IAAM,EAAE,SAAS;AAChC;;;;;ACsDA,qDAAa;AAlEb;AACA;AAOA;AAGA,SAAS,iBACL,YAA2B,EAC3B,UAAkB,EAClB,QAAkB,EAClB,OAAiB,EACjB,kBAA2D,EAC3D,kBAAkD;IAElD,IAAI,aAAa,IAAI,CAAC,EAAE,KAAK,SAAS;QAClC,MAAM,IAAI,OAAO,CAAC,aAAa,IAAI,CAAC,EAAE,CAAQ;QAC9C,aAAa,QAAS,QAAQ,CAAA;YACzB,CAAC,CAAC,OAAO,OAAuB,IAAY,OAAO;QACxD;IAEJ,OAAO,IAAI,aAAa,IAAI,CAAC,EAAE,KAAK,UAAU;QAC1C,MAAM,IAAI,aAAa;QACvB,MAAM,KAAK,AAAC,QAAQ,CAAC,aAAa,OAAyB,IAAY;QACvE,IAAI,OAAO,OAAO,UAAU;YACxB,aAAa;YACb,MAAM,MAAM,CAAA,GAAA,iBAAU,EAAE,SAAS,gBAAgB;YACjD,mBAAmB;YACnB,OAAO,QAAQ,SAAS,QAAQ,CAAC,GAAG,MAAM,GAAK,MAAM,WAAW;QACpE;IAEJ,OAAO,IAAI,aAAa,IAAI,CAAC,EAAE,KAAK,UAAU;QAC1C,MAAM,IAAI;YAAC;gBACP,SAAS;gBACT;gBACA,OAAO,aAAa,MAAO,CAAC,EAAE,CAAC;gBAC/B,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE;YACpB;SAAkB;QACjB,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,aAAa,IAAI,CAAC,EAAE,CAAC,CAAC,aAAa,OAAyB,IAAY;IAE1F,OAAO,IAAI,aAAa,IAAI,CAAC,EAAE,KAAK,UAAU,aAAa,WAAW,cAAc;QAChF,aAAa,aAAa,MAAO,CAAC,EAAE;QACpC,MAAM,MAAM,CAAA,GAAA,iBAAU,EAAE,SAAS,gBAAgB;QACjD,mBAAmB;QACnB,OAAO,QAAQ,SAAS,QAAQ,CAAC,GAAG,MAAM,GAAK,MAAM,WAAW;IAEpE,OAAO,IAAI,aAAa,IAAI,CAAC,EAAE,KAAK,UAAU,aAAa,WAAW,eAAe;QACjF,MAAM,KAAK,SAAS;QACpB,IAAI,OAAO,OAAO,UAAU;YACxB,aAAa;YACb,IAAI,aAAa,MAAO,CAAC,EAAE,EACvB,SAAS,YAAY,YAAY,aAAa,MAAO,CAAC,EAAE;YAE5D,MAAM,MAAM,CAAA,GAAA,iBAAU,EAAE,SAAS,gBAAgB;YACjD,mBAAmB;YACnB,OAAO,QAAQ,SAAS,QAAQ,CAAC,GAAG,MAAM,GAAK,MAAM,WAAW;QACpE;QACA,qBAAqB,UAAU,aAAa,MAAO,CAAC,EAAE,EAAE,GAAG;IAC/D;IACA,OAAO;AACX;AAEO,MAAM;IAIT;;;KAGC,GACD,AAAQ,mBAA6B;QACjC,IAAI,IAAI,CAAC,UACL,OAAO;QAEX,IAAI,CAAC,WAAW;QAChB,WAAW;YACP,IAAI,CAAC,WAAW;QACpB,GAAG;QACH,OAAO;IACX;IAGA,mBAAmB;IAEnB,YACY,YACA,cACA,cACA,QACA,mBACA,cACA,aACA,oBACA,oBACA,gBACV;0BAVU;4BACA;4BACA;sBACA;iCACA;4BACA;2BACA;kCACA;kCACA;+BACA;aA9BJ,WAAW;IA+Bf;IAEJ,OAAiB;QACb,IAAI,IAAI,CAAC,sBAAsB,CAAC,CAAA,GAAA,oBAAQ,EAAE,WACtC,OAAO;QAEX,MAAM,UAA2B,CAAA,GAAA,oBAAQ,EAAE;QAC3C,MAAM,WAAW,IAAI,CAAC;QACtB,CAAA,GAAA,oBAAQ,EAAE,MAAM;QAChB,MAAM,YAAwB,IAAI,CAAC;QACnC,MAAM,UAAU;YAAC,GAAG,SAAS;YAAY,GAAG,SAAS;QAAW;QAChE,SAAS,KAAK,UAAU;QACxB,IAAI,aAAa,UAAU;QAC3B,IAAI,CAAC,mBAAmB,CAAA,GAAA,iBAAU,EAAE,SAAS,gBAAgB;QAC7D,MAAM,UAAe,CAAC;QACtB,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,SAAS,QAAQ,CAAC,CAAC,GAAG,MAAM;YAC1C,OAAO,CAAC,EAAE,GAAG,IAAI;YACjB,OAAO,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC;QAC/B;QACA,QAAQ,aAAa,QAAQ,UAAU,QAAQ,aAAa;QAC5D,QAAQ,QAAQ,CAAA;YACZ,aAAa,iBACT,OACA,YACA,UACA,SACA,CAAC,MAAQ,IAAI,CAAC,mBAAmB,MACjC,IAAM,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC;QAE/B;QACA,IAAI,QAAQ,MAAM,SAAS,cAAc,QAAQ,MAAM,SAAS,aAAa;YACzE,IAAI,CAAC,kBAAkB;YACvB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;QACjF;QACA,IAAI,CAAC,aAAa,OAAO;QACzB,IAAI,CAAC,aAAa,SAAS,CAAA,GAAA,iBAAU,EAAE,SAAS,SAAS;QACzD,IAAI,CAAC,WAAW,aAAa,QAAQ,QAAQ,aAAa;QAC1D,IAAI,CAAC,kBAAkB,WAAW,IAAI,CAAC;QACvC,IAAI,CAAC,kBAAkB;QAEvB,CAAA,GAAA,oBAAQ,EAAE,MAAM;QAChB,OAAO;IACX;IAEA,OAAiB;QACb,IAAI,IAAI,CAAC,sBAAsB,CAAC,CAAA,GAAA,oBAAQ,EAAE,WACtC,OAAO;QAEX,MAAM,QAAQ,CAAA,GAAA,oBAAQ,EAAE;QACxB,IAAI,CAAC,OAAO;YACR,WAAW;gBACP,MAAM,IAAI,MAAM;YACpB;YACA,OAAO;QACX;QACA,MAAM,WAAW,IAAI,CAAC;QACtB,CAAA,GAAA,oBAAQ,EAAE,MAAM;QAChB,MAAM,UAAU;YAAC,GAAG,SAAS;YAAY,GAAG,SAAS;QAAW;QAChE,MAAM,UAAe,CAAC;QACtB,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,SAAS,QAAQ,CAAC,CAAC,GAAG,MAAM;YAC1C,OAAO,CAAC,EAAE,GAAG,IAAI;YACjB,OAAO,CAAC,EAAE,CAAC,WAAW,IAAI,CAAC;QAC/B;QACA,QAAQ,aAAa,QAAQ,IAAI,CAAC,WAAW,aAAa;QAC1D,iBACI,OACA,GACA,UACA,SACA,CAAC,MAAQ,IAAI,CAAC,mBAAmB,MACjC,IAAM,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC;QAG3B,IAAI,QAAQ,MAAM,SAAS,cAAc,QAAQ,MAAM,SAAS,aAAa;YACzE,IAAI,CAAC,kBAAkB;YACvB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;QACjF;QACA,MAAM,oBAAoB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,IAAI,CAAC,qBAAsB;QACxF,IAAI,CAAC,aAAa,OAAO;QACzB,IAAI,CAAC,aAAa,SAAS,SAAS,SAAS;QAC7C,IAAI,CAAC,WAAW,aAAa,QAAQ,QAAQ,aAAa;QAC1D,IAAI,CAAC,kBAAkB,WAAW,IAAI,CAAC;QACvC,IAAI,CAAC,kBAAkB;QACvB,CAAA,GAAA,oBAAQ,EAAE,MAAM;QAEhB,OAAO;IACX;IAEA,QAAS,QAAkC,EAAQ;QAC/C,mCAAmC;QACnC,wDAAwD;QAExD,IAAI,CAAC,YAAY,CAAC,SAAS,cACvB;QAGJ,MAAM,YAAwB,IAAI,CAAC;QACnC,IAAI,uBAAuB,UAAU,OAAO,gBAAgB,UAAU;QAEtE,UAAU,QAAQ,iBACd,SAAS,cACT,UAAU,OACV,UAAU,QACV,UAAU,SACV,CAAC;YACG,uBAAuB;QAC3B,GACA,IAAM,CAAA,GAAA,iBAAU,EAAE;IAGtB,qDAAqD;IACzD;AAGJ;;;;;AC5MA;;CAEC,GACD,yDAAa;AAAN,MAAM;IAKD,KAAM,GAAsB,EAAE,cAAwC,EAAQ;QAClF,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,QAAQ,IAAK;YAChD,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,KAAK,gBAC1B;YAEJ,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC;QAC1B;IACJ;IAEA,iBAAiB;IAEjB,YACY,YACA,WACA,cACA,YACA,WACA,cACA,kBACV;0BAPU;yBACA;4BACA;0BACA;yBACA;4BACA;iCACA;aApBZ,gBAA2C,EAAE;QAsBzC,IAAI,oBAAoB,UACpB,MAAM,IAAI,MAAM;QAEpB,oBAAoB,WAAW,IAAI;IACvC;IAEA,UAAW,KAAW,EAAE,cAAwC,EAAQ;QACpE,IAAI,CAAC,KACD;YACI,MAAM;YACN,OAAO;QACX,GACA;IAER;IAEA,SAAU,IAAY,EAAE,cAAwC,EAAQ;QACpE,IAAI,CAAC,KACD;YACI,MAAM;YACN,OAAO;QACX,GACA;IAER;IAEA,YAAa,OAAe,EAAE,cAAwC,EAAQ;QAC1E,IAAI,CAAC,KACD;YACI,MAAM;YACN,OAAO;QACX,GACA;IAER;IAEA,iBAAkB,YAA2B,EAAE,cAAwC,EAAE;QACrF,IAAI,CAAC,KACD;YACI,MAAM;YACN,OAAO;QACX,GACA;IAER;IAEA;;;;KAIC,GACD,SAAU,KAAW,EAAE,cAAwC,EAAE;QAC7D,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,UAAU,OAAO;IAC1B;IAEA;;;;KAIC,GACD,QAAS,IAAY,EAAE,cAAwC,EAAE;QAC7D,IAAI,CAAC,UAAU;IACf,oBAAoB;IACxB;IAEA;;;;KAIC,GACD,WAAY,OAAe,EAAE,cAAwC,EAAE;QACnE,IAAI,CAAC,aAAa;IAClB,oBAAoB;IACxB;IAEA;;KAEC,GACD,WAAkB;QACd,OAAO,IAAI,CAAC;IAChB;IAEA,UAAmB;QACf,OAAO,IAAI,CAAC;IAChB;IAEA,aAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,kBAAkC;QAC9B,OAAO,IAAI,CAAC;IAChB;IAEA;;;KAGC,GACD,UAAW,IAA6B,EAAQ;QAC5C,IAAI,IAAI,CAAC,cAAc,SAAS,OAC5B;QAEJ,IAAI,CAAC,cAAc,KAAK;IAC5B;IAEA,YAAa,IAA6B,EAAQ;QAC9C,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,QAAQ,IAC3C,IAAI,SAAS,IAAI,CAAC,aAAa,CAAC,EAAE,EAAE;YAChC,IAAI,CAAC,cAAc,OAAO,GAAG;YAC7B;QACJ;IAER;AACJ;;;;;ACxIA,iDAAa;AAfb;AACA;AACA;AACA;AACA;;AACA;;AACA;;AACA;AACA;AACA;AACA;AACA;AAEA;AAEO,MAAM;IAIT,iBAAiB;IACjB,YACI,WAAuB,EACvB,YAAsC,EACtC,WAAyB,CAC3B;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,QAAQ;YACZ;QACJ;QAEA,qBAAqB;QACrB,MAAM,eAAe,CAAA,GAAA,yBAAc,EAAE;QAErC,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,QAAQ,IAAI,CAAC;YACb,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACX,SAAS,CAAA,GAAA,cAAG,EAAE,uBAAuB;gBACrC,KAAK;oBACD,aAAa;oBACb,cAAc;gBAClB;YACJ;YACA,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,UAAU;YACd;QACJ;QAEA,MAAM,UAA8B;YAChC;gBAAC;gBAAQ,CAAA,GAAA,cAAG,EAAE,UAAU,CAAC,GAAG,EAAE,aAAa,KAAK,EAAE,EAAE,aAAa,KAAK,CAAC,CAAC;aAAC;eACtE,CAAA,GAAA,oBAAQ,EAAE,IAAI,CAAA;gBACb,OAAO;oBAAC,KAAK;oBAAM,KAAK,OAAO,CAAC,EAAE,EAAE,KAAK,KAAK,CAAC,CAAC;iBAAC;YACrD;SACH;QACD,MAAM,iBAAiB,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YACjC,WAAW,CAAA,GAAA,qBAAc,EAAE,CAAA,GAAA,0BAAW,EAAE,QAAQ,CAAA,GAAA,yBAAc,KAAK,CAAA,GAAA,0BAAW,EAAE,QAAQ,CAAA,GAAA,yBAAc,KAAK;YAC3G,WAAW;YACX,UAAU,CAAC;gBACP,IAAI,QAAQ,QACR,CAAA,GAAA,0BAAW,EAAE,WAAW,CAAA,GAAA,yBAAc;qBAEtC,CAAA,GAAA,0BAAW,EAAE,QAAQ,CAAA,GAAA,yBAAc,GAAG;gBAE1C,aAAa,MAAM,UAAU;YACjC;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,eAAe,cAAc;YAChC,UAAU;QACd;QACA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,WAAW;YACX,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,KAAK;gBACD,SAAS;gBACT,WAAW;gBACX,UAAU;YACd;QACJ;QAEA,YAAY,OACR,eAAe,cACf;QAIJ,kBAAkB;QAClB,SAAS,aAAc,KAAa;YAChC,OAAO,UAAU,SAAS,OAAO,CAAA,GAAA,cAAG,EAAE,gBAAgB,OAAO,CAAA,GAAA,cAAG,EAAE;QACtE;QACA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YAC9B,WAAW;gBACP;oBAAC;oBAAQ,CAAA,GAAA,cAAG,EAAE,UAAU,QAAQ,aAAa,CAAA,GAAA,YAAI,EAAE;iBAAsB;gBACzE;oBAAC;oBAAS,aAAa;iBAAS;gBAChC;oBAAC;oBAAQ,aAAa;iBAAQ;aACjC;YACD,WAAW,CAAA,GAAA,YAAI,EAAE,oBAAoB;YACrC,UAAU,CAAC;gBACP,CAAA,GAAA,YAAI,EAAE,eAAe,QAAQ,SAAS,YAAY;YACtD;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY,cAAc;YAC7B,UAAU;QACd;QACA,CAAA,GAAA,uBAAgB,EAAE;YACd,YAAY,YAAY,QAAQ,CAAA,GAAA,cAAG,EAAE,UAAU,QAAQ,aAAa,CAAA,GAAA,YAAI,EAAE;QAC9E;QACA,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,QAAQ,IAAI,CAAC;YACb,SAAS;gBACL,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,SAAS,CAAA,GAAA,cAAG,EAAE,oBAAoB;oBAClC,KAAK;wBACD,aAAa;wBACb,cAAc;oBAClB;gBACJ;gBACA,YAAY;aACf;YACD,KAAK;gBACD,WAAW;gBACX,SAAS;gBACT,YAAY;gBACZ,UAAU;YACd;QACJ;QAEA,0BAA0B;QAC1B,IAAI,cAAc;YACd,MAAM,iBAAiB,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;gBACjC,WAAW;oBACP;wBAAC;wBAAS,CAAA,GAAA,cAAG,EAAE,aAAa;4BAAC,GAAG;wBAAI;qBAAG;oBACvC;wBAAC;wBAAS,CAAA,GAAA,cAAG,EAAE,aAAa;4BAAC,GAAG;wBAAI;qBAAG;oBACvC;wBAAC;wBAAY,QAAQ,CAAA,GAAA,cAAG,EAAE;qBAAmC;iBAChE;gBACD,WAAW,aAAa;gBACxB,UAAU,CAAC;oBACP,IAAI,QAAQ,YAAY;wBACpB,aAAa,WAAW;wBACxB;oBACJ;oBACA,MAAM,aAAa,CAAA,GAAA,cAAG,EAAE;oBACxB,CAAA,GAAA,oBAAQ,EAAE;wBACN,QAAQ,SAAS;wBACjB,SAAS,OAAO,CAAA,GAAA,cAAG,EAAE;wBACrB,KAAK,CAAA,GAAA,IAAA,EAAE,IAAI;4BACP,CAAA,GAAA,IAAA,EAAE,cAAc,CAAA,GAAA,cAAG,EAAE;4BACrB,CAAA,GAAA,cAAG,EAAE;yBACR;wBACD,SAAS;4BAAC;4BAAY;yBAAS;wBAC/B,UAAU,CAAC;4BACP,IAAI,WAAW,YACX,aAAa,WAAW;iCAExB,eAAe,SAAS,aAAa;wBAE7C;oBACJ;gBACJ;YACJ;YACA,eAAe,aAAa,MAAM,WAAW;YAE7C,IAAI,CAAC,OAAO,OAAO,CAAA,GAAA,IAAA,EAAE,2CAA2C;gBAC5D,CAAA,GAAA,cAAG,EAAE,kCAAkC;gBACvC,eAAe;aAClB;QACL;QAEA,oBAAoB;QACpB,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,SAAS;YACT,QAAQ,IAAI,CAAC;YACb,SAAS,sCAAsC,CAAA,GAAA,2BAAQ,IAAI,6CAA6C,CAAA,GAAA,cAAG,EAAE;YAC7G,SAAS,IAAM;YACf,KAAK;gBACD,WAAW;YACf;YACA,QAAQ;gBACJ,UAAU;YACd;QACJ;QAGA,kBAAkB;QAClB,IAAI,CAAC,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,WAAW;YAAW,KAAK;gBAAC,QAAQ;YAAQ;QAAC;QAEvE,SAAS;YACL,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;gBACT,SAAS;gBACT,SAAS,CAAA,GAAA,cAAG,EAAE;gBACd,SAAS,IAAM,CAAA,GAAA,sCAAiB;YACpC;QACJ;QAEA,IAAI,aAAa;YACb,IAAI,CAAC,OAAO,OAAO;YACnB,IAAI,CAAC,YAAY,WAAW;gBACxB,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;oBACvB,QAAQ;oBACR,KAAK;wBACF,WAAW;oBACf;gBACH;gBACA,aAAa,OACT,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,SAAS,CAAC,+DAA+D,EAAE,CAAA,GAAA,6BAAY,EAAE,mFAAmF,CAAC;gBACjL,IACA;YAER;QACJ,OAAO;YACH,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;gBACpB,QAAQ,IAAI,CAAC;gBACb,KAAK;oBACD,WAAW;gBACf;gBACA,SAAS,CAAC;uDAC6B,EAAE,CAAA,GAAA,6BAAY,EAAE;+DACR,EAAE,CAAA,GAAA,6BAAY,EAAE,mFAAmF,CAAC;YACvJ;YAEA,UAAU,OACN,gBACA,SAAS,eAAe,QACxB,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;gBACT,SAAS,CAAA,GAAA,cAAG,EAAE;gBACd,QAAQ;oBACJ,MAAM;oBACN,QAAQ;gBACZ;YACJ,IACA,SAAS,eAAe,QACxB,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,SAAS;gBACT,SAAS,CAAA,GAAA,cAAG,EAAE;gBACd,QAAQ;oBACJ,MAAM;oBACN,QAAQ;gBACZ;YACJ;QAIR;QAEA,OAAO,iBAAiB,WAAW,CAAC;YAChC,IAAI,EAAE,QAAQ,CAAA,GAAA,yBAAc,GACxB;YAEJ,eAAe,SACX,CAAA,GAAA,qBAAc,EAAE,CAAA,GAAA,0BAAW,EAAE,QAAQ,CAAA,GAAA,yBAAc,KAAK,CAAA,GAAA,0BAAW,EAAE,QAAQ,CAAA,GAAA,yBAAc,KAAK;QAExG;IAEJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AAEJ;;;ACtQA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,6BAA6B,MAAM,KAAK;;;ACAjH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;;;ACMhH,wDAAgB;AANhB;AACA;AACA;AACA;AACA;AAEO,SAAS;IACZ,MAAM,cAAc,CAAA,GAAA,QAAS,EAAE;QAC3B,SAAS;QACT,eAAe;QACf,KAAK;QACL,iBAAiB;YACb,SAAS;YACT,WAAW;YACX,WAAW;YACX,YAAY;YACZ,YAAY;YACZ,UAAU;QACd;QACA,WAAW;YACP,QAAQ;YACR,YAAY;QAChB;IACJ;IAEA,MAAM,YAAY,CAAA,GAAA,IAAA,EAAE,MAAM,aAAa,CAAA,GAAA,cAAG,EAAE;IAC5C,MAAM,QAAQ,CAAA,GAAA,IAAA,EAAE,MAAM,aAAa,CAAA,GAAA,cAAG,EAAE;IAExC,MAAM,UAAU,CAAA,GAAA,IAAA,EAAE,wBAAwB;QACtC;QACA;KACH;IAED,IAAI,CAAA,GAAA,0BAAW,EAAE;QACb,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACT,SAAS,CAAA,GAAA,cAAG,EAAE;QAClB;QACA,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YACX;YACA,KAAK;gBACD,QAAQ;gBACR,WAAW;gBACX,SAAS;gBACT,WAAW;YACf;QACJ;QACA,OAAO;QACP,aAAa;QACb,SAAS;YACL,IAAI,OAAO,SAAS,SAAS,aACzB,QAAQ,aAAa,IAAI,SAAS,OAAO,OAAO,SAAS,WACnD,OAAO,SAAS;QAE9B;IACJ;IAEA,QAAO,oBAAc,KAAK,CAAA;QACtB,UAAU,YAAY;QACtB,OAAO,SAAS,QAAQ,CAAA;YACpB,UAAU,OAAO,CAAA,GAAA,IAAA,EAAE,WAAW;gBAC1B,CAAA,GAAA,IAAA,EAAE,WAAW,KAAK;gBAClB,CAAA,GAAA,IAAA,EAAE,IAAI,KAAK,KAAK,QAAQ,OAAO;aAClC;QACL;IACJ;IAEA,QAAO,oBAAsC,KAAK,CAAA;QAC9C,MAAM,YAAY;QAClB,OAAO,aAAa,QAAQ,CAAA;YACxB,MAAM,OAAO,CAAA,GAAA,IAAA,EAAE,WAAW;gBACtB,CAAA,GAAA,IAAA,EAAE,WAAW,WAAW,KAAK;gBAC7B,CAAA,GAAA,IAAA,EAAE,IAAI,KAAK,KAAK,QAAQ,OAAO;aAClC;QACL;IACJ;AACJ;;;AC3EA,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,yBAAyB,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;ACA7P,OAAO,UAAU,AAAC,QAAQ,oBAA+B,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK,OAAO,MAAM,CAAA;IAAQ,OAAO,OAAO,OAAO,KAAK,CAAC,OAAO,GAAG;IAAE,MAAM;AAAI,GAAI,KAAK,IAAM,OAAO,OAAO,KAAK;;;;;ACIlQ;;;;CAIC,GACD,uDAAa;AATb;AACA;AACA;AAOO,MAAM;IAQD,SAAgB;QACpB,IAAI,eAAe,IAAI,CAAC,MAAM,MAAM;QACpC,IAAI,iBAAiB,IAAI,CAAC,QAAQ,MAAM;QACxC,IAAI,IAAI,CAAC,UAAU,eAAe,IAAI,CAAC,UAAU,eAAe,GAAG;YAC/D,IAAI,CAAC,IAAI,CAAC,YACN,eAAe,IAAI,CAAC,UAAU,cAAc,IAAI,SAAS;YAE7D,IAAI,CAAC,IAAI,CAAC,cACN,iBACI,IAAI,CAAC,UAAU,YAAY,IAAI,CAAC,UAAU,eAAe,KAAK,IAAI,CAAC,UAAU,eACzE,SAAS;QAGzB,OAAO;YACH,eAAe;YACf,iBAAiB;QACrB;QACA,+DAA+D;QAC/D,IAAI,iBAAiB,IAAI,CAAC,MAAM,MAAM,SAClC,IAAI,CAAC,MAAM,MAAM,UAAU;QAE/B,IAAI,mBAAmB,IAAI,CAAC,QAAQ,MAAM,SACtC,IAAI,CAAC,QAAQ,MAAM,UAAU;IAErC;IAEA,iBAAiB;IACjB,YAAa,CAAsD,CAAE;QACjE,IAAI,CAAC,YAAY,EAAE;QACnB,IAAI,CAAC,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ,IAAI,CAAC;YACb,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,WAAW;YACX,KAAK;gBACD,KAAK;gBACL,WAAW;YACf;QACJ;QACA,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,QAAQ,IAAI,CAAC;YACb,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,WAAW;YACX,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,cAAc,EAAE;QAErB,MAAM,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACtC,QAAQ,IAAI,CAAC;YACb,WAAW,CAAC;gBACR,IAAI,EAAE,SAAS,eACX,IAAI,CAAC,aAAa,YAAY;oBAC1B,IAAI,CAAC,UAAU,SAAS,GAAG;oBAC3B,IAAI,CAAC;gBACT,GAAG;gBAEP,IAAI,EAAE,SAAS,aAAa;oBACxB,cAAc,IAAI,CAAC;oBACnB,WAAW;wBACP,IAAI,CAAC,aAAa;wBAClB,IAAI,CAAC;oBACT,GAAG;gBACP;YACJ;QACJ;QACA,MAAM,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACxC,QAAQ,IAAI,CAAC;YACb,WAAW,CAAC;gBACR,IAAI,EAAE,SAAS,eACX,IAAI,CAAC,eAAe,YAAY;oBAC5B,IAAI,CAAC,UAAU,SAAS,GAAG;oBAC3B,IAAI,CAAC;gBACT,GAAG;gBAEP,IAAI,EAAE,SAAS,aAAa;oBACxB,cAAc,IAAI,CAAC;oBACnB,WAAW;wBACP,IAAI,CAAC,eAAe;wBACpB,IAAI,CAAC;oBACT,GAAG;gBACP;YACJ;QACJ;QAEA,MAAM,gBAAgB,CAAC;YACnB,IAAI,CAAC,UAAU,SAAS,GAAG,KAAK,MAAM,MAAM,EAAE;YAC9C,IAAI,CAAC;QACT;QACA,IAAI,CAAC,MAAM,iBAAiB,SAAS;QACrC,IAAI,CAAC,QAAQ,iBAAiB,SAAS;QAEvC,IAAI,CAAC;QAEL,MAAM,WAAW,IAAI,iBAAiB,IAAM,IAAI,CAAC;QACjD,SAAS,QACL,IAAI,CAAC,WACL;YACI,YAAY;YACZ,WAAW;YACX,SAAS;QACb;QAEJ,OAAO,iBAAiB,UAAU,IAAM,IAAI,CAAC;QAE7C,4DAA4D;QAC5D,CAAA,GAAA,yBAAY,EAAE,UAAU,CAAC;YACrB,mCAAmC;YACnC,IAAI,CAAC,MAAM,MAAM,UAAU,KAAK,IAAI,MAAM;YAC1C,IAAI,CAAC,QAAQ,MAAM,UAAU,KAAK,IAAI,MAAM;QAChD;IACJ;IAEA,cAAe,OAAyB,EAAQ;QAC5C,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,OAAO;YACf,MAAM,YAAY,SAAS,MAAM;YACjC,OAAO,YAAY,UAAU,MAAM;QACvC;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,SAAS;YACjB,MAAM,YAAY,SAAS,MAAM;YACjC,OAAO,YAAY,UAAU,MAAM;QACvC;IACJ;AACJ;;;;;AC1HA;;;;;CAKC,GACD,gDAAa;AAxBb;AACA;AACA;AACA;AACA;AAoBO,MAAM;IAiBD,cAAqB;QACzB,MAAM,OAAO,IAAI,CAAC,SAAS,aAAa,UAAU;QAClD,MAAM,OAAO,IAAI,CAAC,SAAS,aAAa,SAAS;QACjD,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,aAAa,CAAC,gBAAgB,EAAE,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;QACtE,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,aAAa,CAAC,gBAAgB,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;QAC/E,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,aAAa,CAAC,gBAAgB,EAAE,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;IAC1E;IAEA,uBAAuB;IAEvB,YACI,CAEC,CACH;aAvBM,WAAgC;YACpC,SAAS;YACT,MAAM;YACN,aAAa;YACb,QAAQ;YACR,YAAY;YACZ,UAAU;QACd;QAiBI,IAAI,CAAC,cAAc,EAAE;QACrB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,YAAY;QAEjB,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,cAAc;YAClB;QACJ;QAEA,IAAI,CAAC,UAAU,EAAE;QACjB;YACI,MAAM,OAAO;YACb;gBAAC;gBAAG;gBAAG;aAAE,CAAC,QAAQ;gBACd,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;oBACb,WAAW;oBACX,KAAK;wBACD,OAAO,OAAO;wBACd,QAAQ,OAAO;wBACf,cAAc;wBACd,QAAQ;oBACZ;gBACJ;gBACA,IAAI,CAAC,QAAQ,KAAK;YACtB;QACJ;QACA,IAAI,CAAC;QAEL,MAAM,cAAc,IAAI,CAAA,GAAA,gBAAM,EAAiB;YAC3C,WAAW;gBACP;oBACI,IAAI;oBACJ,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;oBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;oBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;oBACtB,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;aACH;YACD,QAAQ;YACR,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,OAAO;YACzB;QACJ;QACA,IAAI,CAAC,OAAO,OAAO,YAAY;QAE/B,MAAM,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,IAAI,CAAC,SAAS;YACrB,SAAS,CAAC,eAAiB,eAAe;YAC1C,gBAAgB,CAAC,QAAU,QAAQ;YACnC,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,UAAU;YAC5B;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,cAAc;YAC/B,WAAW;QACf;QACA,IAAI,CAAC,OAAO,OAAO,cAAc;QAIjC,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,WAAW;YACf;QACJ;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,aAAa;gBAC3B,IAAI,CAAC;YACT;YACA,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,SAAS;YAC3B;YACA,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,KAAK,OACD,cAAc,cACd,aAAa;QAIjB,MAAM,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YACf,QAAQ,IAAI,CAAC;YACb,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,WAAW;YACf;QACJ;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC9B,MAAM,IAAI,CAAC,SAAS;YACpB,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,WAAW;YAC7B;YACA,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACjC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,IAAI,CAAC,SAAS,cAAc;YAChC;YACA,aAAa;YACb,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,KAAK,OACD,aAAa,cACb,gBAAgB;IAIxB;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,aAAc,SAAkB,EAAQ;QACpC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC,OAAO,MAAM,UAAU,YAAY,UAAU;QAClD,IAAI,WACA,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,YAAY,cAAc,IAAI,CAAC,YAAY;IAE7E;IAEA,cAAoC;QAChC,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ,IAAI,CAAC;IAC3B;AAEJ;;;;;AC/JA,2CAAa;AAvEb;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AAKA;AACA;AACA;AACA;AASA;AACA;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAGA;AACA;AACA;AACA;AAoBA,CAAA,GAAA,0BAAY;AAEL,MAAM;IAyBD,iBAAwB;QAE5B,WAAW;QACX,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,mBAAmB;YACvC,IAAI,CAAC,mBAAmB,aAAa,MAAM,UAAU;YAErD,IAAI,CAAC,mBAAmB,aAAa,IAAI,CAAC;YAC1C,IAAI,IAAI,CAAC,mBAAmB,UAAU;gBAClC,IAAI,IAAI,CAAC,YAAY,QAAQ;oBACzB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,mBAAmB,cAAc;wBACzC,MAAM;wBACN,OAAO;oBACX;oBACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;wBACxC,MAAM;oBACV;gBACJ,OAAO;oBACH,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,mBAAmB,cAAc;wBACzC,MAAM;wBACN,OAAO;oBACX;oBACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;wBACxC,MAAM;oBACV;gBACJ;gBACA,IAAI,CAAC,UAAU,MAAM,UAAU;gBAC/B,IAAI,CAAC,kBAAkB,QAAQ,KAAK,IAAI,GAAG,IAAI,CAAC,UAAU,IAAI,CAAC,YAAY,IAAI,CAAC;gBAChF,IAAI,CAAC,cAAc,QAAQ;YAE/B,OAAO;gBACH,IAAI,IAAI,CAAC,YAAY,QAAQ;oBACzB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,mBAAmB,cAAc;wBACzC,MAAM;wBACN,OAAO;oBACX;oBACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;wBACxC,MAAM;oBACV;gBACJ,OAAO;oBACH,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,mBAAmB,cAAc;wBACzC,MAAM;wBACN,OAAO;oBACX;oBACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;wBACxC,MAAM;oBACV;gBACJ;gBACA,IAAI,CAAC,UAAU,MAAM,UAAU;gBAC/B,IAAI,CAAC,kBAAkB,QAAQ,KAAK,IAAI,GAAG,IAAI,CAAC,UAAU,IAAI,CAAC;gBAC/D,IAAI,CAAC,cAAc,QAAQ;YAE/B;QAEJ,OAAO;YACH,IAAI,CAAC,mBAAmB,aAAa,MAAM,UAAU;YACrD,IAAI,IAAI,CAAC,YAAY,QACjB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;gBACxC,MAAM;YACV;iBAEA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;gBACxC,MAAM;YACV;YAEJ,IAAI,CAAC,UAAU,MAAM,UAAU;YAC/B,IAAI,CAAC,kBAAkB,QAAQ,KAAK,IAAI,GAAG,IAAI,CAAC,UAAU,IAAI,CAAC,YAAY,IAAI,CAAC;YAChF,IAAI,CAAC,cAAc,QAAQ;QAC/B;IACJ;IAEQ,kBAAyB;QAC7B,IAAI,CAAC,IAAI,CAAC,WACN;QAEJ,MAAM,YAAa,IAAI,CAAC,eAAe,eAAe,KAAK,OAAO;QAClE,MAAM,aAAa,YAAY,KAAK;QACpC,+DAA+D;QAC/D,IAAI,eAAe,IAAI,CAAC,iBAAiB,MAAM,SAC3C,IAAI,CAAC,iBAAiB,MAAM,UAAU;IAE9C;IAEQ,WAAkB;QACtB,IAAI,CAAC,UAAU,UAAU,OAAO,sBAAsB,IAAI,CAAC,YAAY;QACvE,IAAI,CAAC,UAAU,UAAU,OAAO,uBAAuB,IAAI,CAAC,YAAY;QACxE,IAAI,IAAI,CAAC,YAAY,QAAQ;YACzB,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;gBACnB,MAAM;gBACN,OAAO;YACX;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;gBACxC,MAAM;YACV;QACJ,OAAO;YACH,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,WAAW;gBACnB,MAAM;gBACN,OAAO;YACX;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,kBAAkB,cAAc;gBACxC,MAAM;YACV;QACJ;QACA,IAAI,CAAC,cAAc,WAAW,IAAI,CAAC;QACnC,IAAI,CAAC,aAAa,WAAW,IAAI,CAAC;QAClC,IAAI,CAAC,aAAa,WAAW,IAAI,CAAC;QAClC,IAAI,CAAC;QACL,IAAI,CAAC,kBAAkB,cAAc,IAAI,CAAC;IAC9C;IAEA,2BAA2B;IAC3B,YACI,QAA2B,EAC3B,QAAuB,CACzB;aA3He,oBAA4B;aAI5B,YAAoB;aAqjDrC,SAAS;YACL,OAAO,MAAM,CAAA,GAAA,oCAAgB,EAAE,IAAI,CAAC;QACxC;QA/7CI,IAAI,CAAC,QAAQ,SAAS;QACtB,iHAAiH;QACjH,yDAAyD;QACzD,MAAM,kBAAkB,KAAK,IAAI,MAAM,KAAK,IAAI,MAAM,KAAK,IAAI,OAAO,OAAO,OAAO,OAAO,OAAO;QAClG,IAAI,CAAC,UAAW,IAAI,CAAC,QAAQ,SAAU,CAAA,GAAA,0BAAW,EAAE,QAAQ,aAAa,CAAA,GAAA,0BAAW,EAAE,QAAQ,aAAa;QAC3G,MAAM,eAAe,SAAS;QAC9B,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,OAAO;gBACP,QAAQ;YACZ;QACJ;QACA,IAAI,CAAC,UAAU,KAAK,IAAI,GAAG,OAAO;QAClC,IAAI,CAAC,WAAW,KAAK,IAAI,GAAG,OAAO;QACnC,IAAI,aAA0B;QAC9B,IAAI,CAAC,WAAW,IAAI,CAAA,GAAA,MAAC,EAAE,SACnB,WAAW;YACP,YAAY;QAChB,IAAI;YACA,OAAO,KAAK,IAAI,IAAI,KAAK,IAAI,iBAAiB,OAAO,aAAa,IAAI,CAAC,oBAAoB,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,IAAI,CAAC;YAC9H,QAAQ,KAAK,IAAI,IAAI,KAAK,IAAI,iBAAiB,IAAI,CAAC;QACxD,GAAG,IAAI,CAAC,QAAQ,KAAK;QACzB,IAAI,CAAC,SAAS,WAAW,CAAA,GAAA,oBAAQ;QACjC,IAAI;QACJ,IAAI,aAAiC;QAErC,IAAI,CAAC,SAAS,cACV,SAAS,eAAe;YAAC,MAAM,KAAO;YAAG,OAAO,KAAO;QAAC;QAG5D,IAAI,UAAU;YACV,4BAA4B;YAC5B,SAAS,OAAO,QAAQ,CAAA;gBACpB,MAAM,QAAQ;YAClB;YACA,WAAW;QACf,OAAO;YACH,CAAA,GAAA,oBAAQ,EAAE,MAAM;YAChB,IAAI,CAAC,SAAS;YACd,IAAI,CAAC,SAAS,UAAU,GAAG;gBAAC,GAAG,CAAA,GAAA,uBAAU;gBAAG,GAAG,CAAA,GAAA,uBAAU;gBAAG,GAAG,CAAA,GAAA,uBAAU;YAAC;YAC1E,CAAA,GAAA,oBAAQ,EAAE,MAAM;QACpB;QACA,IAAI;YACA,YAAY;gBACR,QAAQ,IAAI,CAAA,GAAA,MAAC,EAAE,SAAS;oBAAC,MAAM,IAAI,CAAC;gBAAQ,GAAG,IAAI,CAAC,QAAQ,KAAK;gBACjE,OAAO,IAAI,CAAC,SAAS,kBAAkB;gBACvC,SAAS,CAAC;YACd;QACJ,EAAE,OAAO,GAAG;YACR,IAAI,AAAC,EAAY,YAAY,0BACzB,IAAI,CAAC,SAAS;YAElB,MAAM;QACV;QACA,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,SAAS,QAAQ,CAAC,CAAC,GAAG,MAAM;YAC1C,UAAU,OAAO,CAAC,EAAE,GAAG,IAAI;YAC3B,IAAI,UAAU,QACV,UAAU,OAAO,CAAC,EAAE,CAAC,WAAW,UAAU,OAAO,gBAAgB,UAAU;QAEnF;QAGA,IAAI,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG,GAAG;QACpC,IAAI,gBAAqB,OAAO;QAChC,IAAI;QACJ,IAAI;QACJ,IAAI,kBAAkB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,gBAAgB,IAAI,CAAC,SAAS,kBAAkB;QAEhG,0EAA0E;QAC1E,MAAM,iBAAiB;YACnB,IAAI,mBAAmB,eACnB,OAAO;YAEX,MAAM,SAAS,OAAO,KAAK,YAAY,OAAO,CAAA,OAAQ,SAAS;YAC/D,MAAM,IAAI,OAAO,UAAU,CAAA,OAAQ,SAAS;YAC5C,OAAO,MAAM,CAAC,AAAC,CAAA,IAAI,CAAA,IAAK,OAAO,OAAO;QAC1C;QAEA,MAAM,cAAc,CAAC;YACjB,oBAAoB,SAAS;YAC7B,IAAI,IAAI,CAAC,mBACL,IAAI,CAAC,kBAAkB,cAAc,MAAM;QAEnD;QAEA,MAAM,sBAAsB,IAAI,CAAA,GAAA,MAAC,EAAE,oBAC/B,CAAC;YACG,IAAI,CAAC,cAAc,SAAS;YAC5B,eAAe,SAAS;YACxB,eAAe,CAAA,GAAA,MAAC,EAAE,QAAQ;QAC9B,GACA,CAAC;YACG,eAAe,QAAQ;YACvB,IAAI,CAAC,kBAAkB,cAAc,OAAO;QAChD,GACA,CAAC;YACG,eAAe,WAAW;QAC9B,GACA,IAAM,IAAI,CAAC,cAAc,YACzB,IAAM,UAAU,CAAC,eAAe,CAAC,WACjC,IAAM,UAAU,CAAC,eAAe,CAAC,cACjC;YACI,OAAO;gBACH,YAAY,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,eAAe,CAAC;gBACzC,eAAe,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,eAAe,CAAC;YAChD;QACJ;QAGJ,MAAM,gBAAgB,IAAI,CAAA,GAAA,4BAAY,EAAE;YACpC,WAAW,CAAA,GAAA,sCAAiB,EAAE;QAClC;QACA,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,4BAAY;QAErC,MAAM,iBAAiB,IAAI,CAAA,GAAA,MAAC,EAAE,WAAW;YACrC,UAAU;gBACN,IAAI,CAAC;gBACL;aACH;QACL;QAEA,eAAe,YAAa,CAAC;YACzB,IAAI,MAAM,SAAS,QAAQ;gBACvB,IAAI,CAAC,UAAU,MAAM,gBAAgB;gBACrC,eAAe,UAAU,MAAM,GAAG,MAAM,GAAG,MAAM;gBACjD,IAAI,CAAC,kBAAkB;YAC3B;YACA,IAAI,MAAM,SAAS,QAAQ;gBACvB,eAAe,OAAO,MAAM,GAAG,MAAM,GAAG,MAAM,UAAU,OAAO,MAAM;gBACrE,IAAI,CAAC,kBAAkB,iBAAiB,MAAM,GAAG,MAAM,GAAG,MAAM;gBAChE,IAAI,CAAC,kBAAkB;YAC3B;YACA,IAAI,MAAM,SAAS,MAAM;gBACrB,IAAI,CAAC,UAAU,MAAM,gBAAgB;gBACrC,eAAe;gBACf,IAAI,CAAC,kBAAkB;YAC3B;YACA,IAAI,MAAM,SAAS,QAAQ;gBACvB,eAAe,WAAW,gBAAgB,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM;gBAC9E,IAAI,CAAC,kBAAkB;YAC3B;QACJ;QAEA,IAAI,mBAAmB;YACnB,MAAM;YACN,OAAO;YACP,QAAQ;YACR,UAAU;YACV,MAAM;YACN,eAAe;YACf,YAAY;YACZ,MAAM;gBACF,OAAO;oBAAC,GAAG;oBAAG,GAAG;oBAAG,GAAG;oBAAG,GAAG;gBAAC;YAClC;QACJ;QAEA,IAAI,CAAC,oBAAoB,IAAI,CAAA,GAAA,MAAC,EAAE,kBAAkB;YAC9C,UAAU,IAAI,CAAC;YACf,OAAO,KAAK,IAAI,GAAG,IAAI,CAAC,UAAU,IAAI,CAAC;YACvC,QAAQ,IAAI,CAAC;YACb,QAAQ,CAAC,IAAM,eAAe,QAAQ;YACtC,QAAQ,CAAC,QAAQ;gBACb,oBAAoB,SAAS;gBAC7B,IAAI,YAAY;oBACZ,IAAI,CAAC,cAAc;oBACnB,IAAI,CAAC,kBAAkB,QAAQ,IAAI,CAAC,iBAAiB;gBACzD;YACJ;YACA,QAAQ,CAAC,SAAS;gBACd,MAAM,aAAa,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB;gBAC3E,IAAI,CAAC,SAAS,UACV,YACA,SACA,SACA,OAAO,gBAAgB,OAAO,IAAI,CAAC,cAAc,YACjD,OAAO,cACP,OAAO,gBACP,OAAO,aACP,OAAO,WACP,OAAO;gBAEX,IAAI,CAAC,kBAAkB;YAC3B;YACA,YAAY,CAAC,SAAS,SAAS,SAAS;gBACpC,IAAI,YAAY,QACZ,aAAa,OAAO,SAAS,SAAS;gBAE1C,IAAI,YAAY,QACZ,aAAa,OAAO,SAAS;gBAEjC,IAAI,YAAY,MACZ,aAAa,KAAK,SAAS;YAEnC;YACA,QAAQ,CAAC,SAAS,SAAS;gBACvB,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc,QAAQ,GACzB;gBAGJ,CAAA,GAAA,MAAC,EAAE,eAAe;oBACd,UAAU,IAAI,CAAC;oBACf,YAAY,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB;oBACpE,cAAc,IAAI,CAAC,cAAc;oBACjC,gBAAgB,IAAI,CAAC,cAAc;oBAEnC,MAAM;wBACF,GAAG,gBAAgB;wBACnB,MAAM;wBACN,GAAG;wBACH,GAAG;wBACH,UAAU;wBACV,MAAO,iBAAiB,OAAO;4BAC3B,OAAO;gCACH,GAAG,IAAI,CAAC,cAAc,UAAU;gCAChC,GAAG,iBAAiB,KAAK,MAAM;4BACnC;wBACJ,IAAI;wBACJ,QAAS,iBAAiB,SAAS;4BAC/B,GAAG,iBAAiB,MAAM;4BAC1B,OAAO;gCACH,GAAG,IAAI,CAAC,cAAc,iBAAiB;gCACvC,GAAG,iBAAiB,OAAO,MAAM;4BACrC;wBACJ,IAAI;oBACR;oBAEA,WAAW,CAAC;wBACR,mBAAmB;4BACf,GAAG,GAAG;4BACN,MAAM;wBACV;wBACA,MAAM,aAAa,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB;wBAC3E,IAAI,CAAC,SAAS,KAAK,YAAY;wBAC/B,IAAI,CAAC,kBAAkB;oBAC3B;gBACJ;YAEJ;YACA,SAAS,CAAC,SAAS,SAAS,SAAS;gBACjC,IAAI,YAAY,QACZ,UAAU,OAAO,SAAS,SAAS;gBAEvC,IAAI,YAAY,QACZ,UAAU,OAAO,SAAS;gBAE9B,IAAI,YAAY,MACZ,UAAU,KAAK,SAAS;YAEhC;YAEA,cAAc,CAAC;gBAEX,IAAI,cAAc,QAAQ,SAAS,UAC/B,IAAI,CAAC,cAAc,IAAI;oBACnB,MAAM;oBACN,OAAO,cAAc;oBACrB,UAAU,cAAc,QAAQ,MAAM,KAAK;gBAC/C;gBAGJ,IAAI,CAAC,iBAAiB,gBAAgB,cAAc,UAAU,IAAI,CAAC,kBAAkB;gBACrF,IAAI,CAAC,iBAAiB,iBAAiB,cAAc,UAAU,IAAI,CAAC,kBAAkB;gBAEtF,OAAO,OAAO,cAAc,OAAO,cAAc,QAAQ,MAAM,KAAK;YACxE;YACA,QAAQ;gBACJ,IAAI,CAAA,GAAA,oBAAQ,EAAE,WACV;oBAAA,IAAI,gBAAgB,QAChB,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,cAAG,EAAE,SAAS;gBACzC;YAER;YACA,QAAQ;gBACJ,IAAI,CAAA,GAAA,oBAAQ,EAAE,WACV;oBAAA,IAAI,gBAAgB,QAChB,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,cAAG,EAAE,SAAS;gBACzC;YAER;QACJ;QAEA,MAAM,0BAA0B;YAC5B,IAAI,CAAC,YACD;YAGJ,MAAM,UAAU;gBACZ,QAAQ,CAAC;gBACT,QAAQ,CAAC;gBACT,QAAQ,CAAC;gBACT,YAAY,CAAC;gBACb,QAAQ,CAAC;gBACT,SAAS,CAAC;YACd;YAEA,MAAM,YAAY,IAAI,CAAC,iBAAiB;YACxC,MAAM,WAAW,WAAW;YAE5B,MAAM,UAAU,OAAO,KAAK;YAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAChC,IAAI,cAAc,OAAO,CAAC,EAAE,EACxB,WAAW,aAAa,OAAO,CAAC,EAAE,EAAE;iBACjC;gBACH,WAAW,aAAa,OAAO,CAAC,EAAE,EAAE;gBACpC,IAAI,aAAa,OAAO,CAAC,EAAE,EACvB,WAAW,KAAK;YAExB;QAGR;QAEA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YACnC,QAAQ,CAAC,QAAQ,OAAO;gBACpB,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc,QAAQ,KAAK,CAAA,GAAA,MAAC,EAAE,eAAe,OAChD;gBAGJ,MAAM,YAAY,IAAI,CAAC,cAAc,kBAAkB,IAAI,CAAC,kBAAkB;gBAC9E,IAAI,WACA;gBAGJ,IAAI,aAAa,QACb,IAAI,CAAC,kBAAkB,WAAW,YAAY,UAAU,WAAW,IAAE,IAAI;gBAE7E,IAAI,aAAa,SACb,IAAI,CAAC,kBAAkB,WAAW,YAAY,UAAU,WAAW,KAAG,IAAI;gBAE9E,IAAI,aAAa,QACb,IAAI,CAAC,kBAAkB,QAAQ;gBAEnC,IAAI,aAAa,OACb,IAAI,CAAC,kBAAkB,UAAU;gBAErC,IAAI;oBAAC;oBAAU;iBAAQ,CAAC,SAAS,WAAW;oBACxC,MAAM;oBACN,gBAAgB;gBACpB;gBACA,IACI;oBAAC;oBAAU;iBAAQ,CAAC,SAAS,aAEzB,AACI,CAAA,CAAA,GAAA,MAAC,EAAE,SAAS,gBAAgB,aAC5B,CAAA,GAAA,MAAC,EAAE,SAAS,eAAe,SAAQ,KAClC,WAAW,KAEtB;oBACE,MAAM;oBACN,gBAAgB;gBACpB;gBACA,IAAI,CAAC,IAAI,CAAC,OAAO;oBACb,IAAI;wBAAC;wBAAU;qBAAQ,CAAC,SAAS,WAAW;wBACxC,MAAM;wBACN,IAAI,CAAC,eAAe;oBACxB;oBACA,IAAI;wBAAC;wBAAgB;qBAAc,CAAC,SAAS,WAAW;wBACpD,MAAM;wBAEL,CAAA;4BACG,IAAI,UAAU;4BACd,IAAI;gCACA,MAAM,aAAc,MAAM,IAAI,CAAC,SAAS;4BAC5C,EAAE,OAAO,GAAG;gCACR,UAAU;gCACV,WAAW;oCACP,MAAM,IAAI,MAAM,yDAAyD;gCAC7E,GAAG;gCACH,IAAI,CAAC,cAAc,IAAI,OAAO,CAAA,GAAA,cAAG,EAAE,wBAAwB;4BAC/D;4BACA,IAAI,SAAS;gCACT,SAAS,aAAc;gCACvB,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,cAAG,EAAE,wBAAwB;4BACxD;wBACJ,CAAA;oBACJ;oBACA,IAAI;wBAAC;wBAAU;qBAAQ,CAAC,SAAS,WAAW;wBACxC,MAAM;wBACN,gBAAgB;oBACpB;gBACJ;gBACA,IAAI;oBAAC;oBAAU;iBAAQ,CAAC,SAAS,WAC7B,MAAM;gBAIV,IAAI,YAAY,kBAAkB;oBAAC;oBAAQ;oBAAS;oBAAM;iBAAO,GAAG;oBAChE,IAAI,WAAW,QACX,IAAI,CAAC,kBAAkB,cAAc,GAAG;oBAE5C,IAAI,WAAW,SACX,IAAI,CAAC,kBAAkB,cAAc,IAAI;oBAE7C,IAAI,WAAW,MACX,IAAI,CAAC,kBAAkB,cAAc,GAAG;oBAE5C,IAAI,WAAW,QACX,IAAI,CAAC,kBAAkB,cAAc,GAAG;gBAEhD;gBAGA,IAAI;oBAAC;oBAAS;iBAAU,CAAC,SAAS,WAAW;oBACzC,IAAI,WAAW,QAAQ;wBACnB,IAAI,CAAC,kBAAkB,SAAS,KAAK;wBACrC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;oBAC5E;oBACA,IAAI,WAAW,SAAS;wBACpB,IAAI,CAAC,kBAAkB,SAAS,IAAI;wBACpC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;oBAC5E;gBACJ;gBACA,IAAI;oBAAC;iBAAO,CAAC,SAAS,WAAW;oBAC7B,IAAI,CAAC,kBAAkB,SAAS;oBAChC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;gBAC5E;gBAGA,IAAI,aAAa,aACb,eAAe,aAAa,OAAO,IAAI,CAAC,kBAAkB;gBAE9D,IAAI,aAAa,cACb,eAAe,aAAa,OAAO,IAAI,CAAC,kBAAkB;gBAE9D,IAAI,aAAa,SAAS;oBACtB,IAAI,CAAC,SAAS,UACV,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB,UACxD,IAAI,CAAC,cAAc;oBAEvB,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,cAAG,EAAE,WAAW;gBAC3C;gBACA,IAAI;oBAAC;oBAAU;iBAAY,CAAC,SAAS,WAAW;oBAC5C,MAAM,aAAa,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB;oBAC3E,IAAI,eAAe,KAAK,CAAC,WAAW,YAAY,sBAC5C,IAAI,CAAC,SAAS,UAAU,YAAY;wBAAC,GAAG;wBAAK,GAAG;wBAAK,GAAG;oBAAG,GAAG;yBAE9D,IAAI,CAAC,SAAS,WAAW;oBAE7B,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,cAAG,EAAE,kBAAkB;gBAClD;gBACA,IAAI,aAAa,WAAW;oBACxB,MAAM;oBACN,eAAe,gBAAgB,eAAe;gBAElD,OAAO,IAAI,aAAa,KAAK;oBACzB,MAAM;oBACN,IAAI,CAAC,kBAAkB,QAAQ;oBAC/B,IAAI,CAAC,iBAAiB,UAAU;oBAChC,cAAc,WAAW,KAAK;oBAC9B;oBACA,YAAY,KAAK;gBACrB;gBACA,IAAI,aAAa,KAAK;oBAClB,MAAM;oBACN,MAAM,WAAW,IAAI,CAAC,kBAAkB;oBACxC,IAAI,CAAC,kBAAkB,QAAQ;oBAC/B,IAAI,CAAC,iBAAiB,UAAU;oBAChC,cAAc,WAAW,KAAK;oBAC9B;oBACA,YAAY,KAAK,aAAa,SAAS,mBAAmB;gBAC9D;gBACA,IAAI,aAAa,KAAK;oBAClB,MAAM;oBACN,MAAM,UAAU,IAAI,CAAC,kBAAkB,cAAc,SAAS,aAAa;oBAC3E,IAAI,CAAC,kBAAkB,QAAQ;oBAC/B,IAAI,CAAC,iBAAiB,UAAU;oBAChC,cAAc,WAAW,KAAK;oBAC9B;gBACJ;gBACA,IAAI,aAAa,KAAK;oBAClB,MAAM;oBACN,IAAI,CAAC,kBAAkB,QAAQ;oBAC/B,IAAI,CAAC,iBAAiB,UAAU;oBAChC,cAAc,WAAW,KAAK;oBAC9B;gBACJ;gBACA,IAAI,aAAa,KAAK;oBAClB,MAAM;oBACN,IAAI,CAAC,kBAAkB,QAAQ;oBAC/B,IAAI,CAAC,iBAAiB,UAAU;oBAChC,cAAc,WAAW,KAAK;oBAC9B;gBACJ;gBACA,IAAI,aAAa,KAAK;oBAClB,MAAM;oBACN,IAAI,CAAC,cAAc;gBACvB;YAGJ;YACA,MAAM,CAAC,QAAQ,SACf;QACJ;QAEA,MAAM,aAEF,CAAC;QACL,mBAAmB;QACnB,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,WAAW,QAAQ,CAAC,CAAC,GAAG,QAAQ;YAC9C,MAAM,KAAK,IAAK,QAAQ,GAAW;gBAC/B,cAAc;gBACd,iBAAiB,CAAC;oBACd,oBAAoB,YAAY;gBACpC;gBACA,gBAAgB;oBACZ,oBAAoB,iBAAiB;wBACjC,YAAY,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,eAAe,CAAC;wBACzC,eAAe,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,eAAe,CAAC;oBAChD;gBACJ;YACJ;YACA,UAAU,CAAC,EAAE,GAAG;YAChB,GAAG,aAAa,MAAM,UAAU;QACpC;QAEA,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,MAAC,EAAE;QAE5B,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,OAAO;gBACP,KAAK;gBACL,QAAQ;gBACR,OAAO,AAAC,IAAI,CAAC,YAAa;gBAC1B,UAAU;gBACV,YAAY;gBACZ,aAAa;YACjB;QACJ;QACA,IAAI,CAAC,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,QAAQ,IAAI,CAAC;QACjB;QACA,IAAI,CAAC,UAAU,gBAAgB;YAC3B,OAAO;QACX;QACA,IAAI,CAAC,UAAU,UAAU,CAAA,GAAA,MAAC,EAAE;QAG5B,IAAI,CAAC,qBAAqB,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;YAChD,UAAU;gBACN,IAAI,CAAC;YACT;QACJ;QAEA,IAAI,CAAC;QAML,IAAI;QACJ,WAAW;YACP,mBAAmB,IAAI,CAAA,GAAA,MAAC,EAAE,iBAAiB;gBACvC,aAAa;oBACT,OAAO,CAAA,GAAA,MAAC,EAAE,cAAc,UAAU,KAAK,CAAC,IAAI,CAAC,cAAc;gBAC/D;gBACA;YACJ;YACA,IAAI,CAAC,SAAS,OAAO,iBAAiB;QAC1C,GAAG;QAEH,CAAA,GAAA,MAAC,EAAE,OACC,IAAI,CAAC,UACL;YACI,IAAI,CAAC,kBAAkB;YACvB,IAAI,CAAC;YACL,IAAI,CAAC,mBAAmB;SAC3B;QAGL,IAAI;QACJ,IAAI,IAAI,CAAC,OACL,kBAAkB,IAAI,CAAA,GAAA,0CAAmB,EAAE;YACvC,QAAQ;gBACJ,CAAA,GAAA,gCAAc,EAAE,IAAI,CAAC,MAAO,MAAM,cAAc,CAAC,CAAC,IAAI,CAAC;YAC3D;YACA,UAAU;gBACN,MAAM,YAAY;oBACd,IAAI;oBACJ,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;wBAClB,SAAS;wBACT,aAAa,CAAA,GAAA,cAAG,EAAE;wBAClB,KAAK;4BACD,SAAS;wBACb;oBACJ;oBACA,QAAQ,UAAU;wBACd,IAAI,CAAC;wBACL;oBACJ;oBACA,CAAA,GAAA,MAAC,EAAE,MAAM;wBACL,QAAQ,IAAI,CAAC;wBACb,SAAS,QAAQ,CAAA,GAAA,cAAG,EAAE,mBAAmB;wBACzC,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;4BACH,SAAS;gCACL,CAAA,GAAA,MAAC,EAAE,GAAG;oCACF,SAAS,CAAA,GAAA,cAAG,EAAE;oCACd,KAAK;wCACD,cAAc;oCAClB;gCACJ;gCACA;6BACH;wBACL;wBACJ,kBAAkB;wBAClB,WAAW,CAAC;4BACR,YAAY;wBAChB;oBACJ;gBACJ;gBAEA,CAAA,GAAA,MAAC,EAAE,MAAM;oBACL,QAAQ,IAAI,CAAC;oBACb,SAAS,CAAA,GAAA,cAAG,EAAE;oBACd,SAAS;wBAAC,CAAA,GAAA,cAAG,EAAE;wBAAW;qBAAS;oBACnC,UAAU,OAAO;wBACb,IAAI,WAAW,CAAA,GAAA,cAAG,EAAE,WAChB;wBAGJ,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;4BAClB,QAAQ,IAAI,CAAC;4BACb,WAAW;4BACX,SAAS,iCAAiC,CAAA,GAAA,cAAG,EAAE;wBACnD;wBAEA,IAAI,CAAC,MAAO,SACR;4BACI,SAAS,aAAc;4BACvB,QAAQ;wBACZ,GACA;4BACI,QAAQ;4BACR;wBACJ;oBACR;gBACJ;YACJ;YACA,aAAa;gBACT,IAAI,CAAC,UAAU,IAAI,CAAC,YAAY,SAAS,UAAU;gBACnD,IAAI,CAAC;YACT;QACJ;aAEA,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YACrC,SAAS,SAAS;YAClB,QAAQ;gBACJ,CAAA,GAAA,gCAAc,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC;YACtC;YACA,OAAO;gBACH;YACJ;YACA,UAAU;gBACN,QAAS;YACb;YACA,QAAQ;gBACJ,IAAI,CAAC,eAAe;YACxB;YACA,SAAS;gBACL;YACJ;YACA,QAAQ;gBACJ,CAAA,GAAA,gCAAc,EAAE,WAAW,CAAC,CAAC,IAAI,CAAC;YACtC;QACJ;QAEJ,gBAAgB,aAAa,MAAM,eAAe;QAClD,IAAI,CAAC,eAAe,OAAO,gBAAgB;QAE3C,IAAI,CAAC,mBAAmB,IAAI,CAAA,GAAA,MAAC,EAAE,iBAAiB;YAC5C,YAAY,CAAC;gBACT,IAAI,cAAc,QACd,IAAI,CAAC,kBAAkB,QAAQ;qBAC5B,IAAI,cAAc,QACrB,IAAI,CAAC,kBAAkB,QAAQ;qBAC5B,IAAI,cAAc,QACrB,IAAI,CAAC,kBAAkB,QAAQ;qBAC5B,IAAI,cAAc,YACrB,IAAI,CAAC,kBAAkB,QAAQ;qBAC5B,IAAI,cAAc,QACrB,IAAI,CAAC,kBAAkB,QAAQ;qBAC5B,IAAI,cAAc,SACrB,IAAI,CAAC,kBAAkB,QAAQ;qBAE/B,MAAM,IAAI,MAAM;gBAEpB,cAAc,WAAW,KAAK;gBAC9B;gBACA,IAAI,CAAC,cAAc;YACvB;YACA,UAAU;gBACN,IAAI,CAAC,kBAAkB,WAAW,YAAY,UAAU,WAAW,IAAE,IAAI;YAC7E;YACA,WAAW;gBACP,IAAI,CAAC,kBAAkB,WAAW,YAAY,UAAU,WAAW,KAAG,IAAI;YAC9E;YACA,QAAQ;gBACJ,gBAAgB;YACpB;YACA,QAAQ;gBACJ,gBAAgB;YACpB;QACJ;QACA,IAAI,CAAC,iBAAiB,WAAW,IAAI,CAAC,WAAW;QACjD,CAAA,GAAA,oBAAQ,EAAE,YAAY;YAClB,IAAI,CAAC,iBAAiB,cAAc,CAAA,GAAA,oBAAQ,EAAE;YAC9C,IAAI,CAAC,iBAAiB,cAAc,CAAA,GAAA,oBAAQ,EAAE;QAClD;QACA,IAAI,CAAC,eAAe,OAAO,IAAI,CAAC,iBAAiB;QAEjD,MAAM,gBAAgB,CAAC;YACnB,eAAe;YACf,eAAe,SAAS;YACxB,oBAAoB,UAAU;YAC9B,IAAI,CAAC,cAAc;QACvB;QAEA,IAAI,CAAC,gBAAgB,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc;YACtC,OAAO;YACP,QAAQ;YACR,UAAU;YACV,YAAY,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,GAAG,GAAG;YAC7B,QAAQ;QACZ;QACA,IAAI,CAAC,cAAc,UAAU,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,IAAI,CAAC,WAAW;QACzE,IAAI,CAAC,cAAc,gBAAgB,CAAC;YAEhC,IAAI,QACA,IAAI,CAAC,kBAAkB,QAAQ;iBAC5B;gBACH,IAAI,CAAC,kBAAkB,QAAQ,IAAI,CAAC,iBAAiB;gBACrD;YACJ;QAEJ;QAEA,MAAM,kBAAkB,CAAC;YACrB,IAAI,YAAY,eACZ,uBAAuB;YAG3B,IAAI,IAAI,CAAC;gBACL,IAAI,YAAY,eACZ,IAAI,CAAC,cAAc,OAAO;qBAE1B,IAAI,CAAC,cAAc,OAAO;;YAIlC,iBAAiB;YACjB,iBAAiB,UAAU,CAAC,QAAQ;YACpC,eAAe,SAAS;YACxB,eAAe,WAAW;YAC1B,IAAI,CAAC,kBAAkB,QAAQ;YAC/B,IAAI,CAAC,iBAAiB,UAAU;YAChC;QACJ;QAEA,MAAM,kBAAkB,CAAC;YACrB,kBAAkB,MAAM;YACxB,eAAe,WAAW,MAAM;YAChC,IAAI,CAAC,aAAa,SAAS;QAC/B;QAEA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE;QACpB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,KAAK;gBACD,QAAQ;gBACR,SAAS;gBACT,UAAU;gBACV,gBAAgB;gBAChB,YAAY;YAChB;QACJ;QACA,MAAM,yBAAyB,IAAI,CAAA,GAAA,MAAC,EAAE,uBAAuB;YACzD,WAAW;YACX,UAAU,CAAC;gBACP,cAAc,aAAa,CAAA,GAAA,sCAAiB,EAAE;YAClD;QACJ;QAGA,SAAS,OAAO;QAChB,CAAA,GAAA,MAAC,EAAE,OACC,UACA;YAAC,IAAI,CAAC,cAAc;YAAc,IAAI,CAAC,cAAc;YAAoB,uBAAuB;SAAa;QAGjH,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YAC9B,WAAW;YACX,WAAW;YACX,QAAQ,AAAC,CAAA;gBACL,MAAM,SAAS,EAAE;gBAEjB,MAAM,YAAY,CAAC;oBACf,OAAO;wBACH,IAAI;wBACJ,OAAO,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,OAAO,CAAC;wBAC5B,OAAO,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,OAAO,CAAC;wBAC5B,QAAQ;4BACJ,UAAU,CAAC,OAAO,CAAC,aAAa,MAAM,UAAU;4BAChD,gBAAgB;4BAChB,IAAI,CAAC,cAAc;4BACnB,oBAAoB,iBAAiB;gCACjC,YAAY,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,OAAO,CAAC;gCACjC,eAAe,CAAA,GAAA,MAAC,EAAE,SAAS,CAAC,OAAO,CAAC;4BACxC;4BACA,YAAY,UAAU,CAAC,OAAO,CAAC;4BAC/B,oBAAoB,YAAY,UAAU,CAAC,OAAO,CAAC;wBACvD;wBACA,SAAS;4BACL,UAAU,CAAC,OAAO,CAAC,aAAa,MAAM,UAAU;wBACpD;oBACJ;gBACJ;gBAEA,MAAM,SAAS,OAAO,KAAK;gBAC3B,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,OAAO,KAAK,UAAU,MAAM,CAAC,EAAE;gBAEnC,OAAO;YACX,CAAA;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,OAAO,UAAU;YAChB,YAAY;eACT,OAAO,QAAQ,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC,CAAC,EAAE,GAAK,UAAU,CAAC,EAAE,CAAC;SAC9D;QAED,MAAM,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YACzB,OAAO,IAAI,CAAC,kBAAkB;YAC9B,UAAU;YACV,SAAS;gBACL,IAAI,CAAC,kBAAkB,UAAU;gBACjC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;YAC5E;YACA,OAAO;gBACH,IAAI,CAAC,kBAAkB,QAAQ;gBAC/B,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;YAC5E;YACA,eAAe,CAAC,UAAU;gBACtB,IAAI,CAAC,kBAAkB,SAAS,UAAU;gBAC1C,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;YAC5E;QACJ;QAEA,MAAM,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YACzB,aAAa,IAAI,CAAC;QACtB;QAEA,MAAM,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE,WAAW;YACjC,aAAa,IAAI,CAAC;QACtB;QAEA,MAAM,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YACzB,aAAa,IAAI,CAAC;QACtB;QAEA,MAAM,UAAU,IAAI,CAAA,GAAA,MAAC,EAAE,QAAQ;YAC3B,aAAa,IAAI,CAAC;QACtB;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,aAAa;YACrC,YAAY,CAAC,QAAQ,IAAI,IAAI,IAAI,IAAI;gBACjC,MAAM,aAAa,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB;gBAC3E,MAAM,WAAW,WAAW;gBAC5B,MAAM,cAAyB;oBAC3B,MAAM,SAAS;oBACf,QAAQ,IAAI,CAAC,cAAc;oBAC3B,YAAY,SAAS;oBACrB,SAAS,SAAS;oBAClB,aAAa,SAAS;oBACtB,UAAU,SAAS;oBACnB,QAAQ,YAAY,UAAU,YAAY,SAAS;oBACnD;oBACA;oBACA;oBACA;oBACA;gBACJ;gBAEA,IAAI,QAAQ;oBACR,IAAI,CAAC,SAAS,aAAa,YAAY;oBACvC,IAAI,CAAC,SAAS,aAAa,YAAY;gBAC3C,OACI,IAAI,CAAC,SAAS,aAAa,YAAY;oBACnC,MAAM,CAAC;wBACH,CAAA,GAAA,MAAC,EAAE,aAAa,KAAK;oBACzB;gBACJ;gBAEJ,IAAI,CAAC,kBAAkB;YAC3B;QACJ;QAEA,MAAM,YAAY,IAAI,CAAA,GAAA,MAAC,EAAE,UAAU;YAC/B,SAAS,CAAC,QAAQ,IAAI,IAAI,IAAI,IAAI;gBAE9B,MAAM,aAAa,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,cAAc,gBAAgB;gBAE3E,MAAM,WAAgB;oBAClB,MAAM,QAAQ;oBACd,IAAI;oBACJ,IAAI;oBACJ,IAAI;oBACJ,IAAI;oBACJ,UAAU;oBACV,YAAY,QAAQ;oBACpB,SAAS,QAAQ;oBACjB,UAAU,QAAQ;oBAClB,aAAa,QAAQ;gBACzB;gBACA,IAAI,QAAQ,eAAe,QAAQ;oBAC/B,SAAS,YAAY,IAAI,CAAC,cAAc;oBACxC,SAAS,YAAY,QAAQ;oBAC7B,SAAS,cAAc,QAAQ,eAAe,YAAY,UAAU;gBACxE,OAAO;oBACH,SAAS,eAAe,QAAQ,gBAAgB,YAAY,UAAU;oBACtE,IAAI,QAAQ,cAAc,UAAU;wBAChC,SAAS,YAAY,IAAI,CAAC,cAAc;wBACxC,SAAS,YAAY,QAAQ;oBACjC,OACI,SAAS,UAAU,IAAI,CAAC,cAAc;gBAE9C;gBAEA,IAAI,QAAQ;oBACR,IAAI,CAAC,SAAS,aAAa,YAAY;oBACvC,IAAI,CAAC,SAAS,UAAU,YAAY;gBACxC,OACI,IAAI,CAAC,SAAS,aAAa,YAAY;oBACnC,MAAM,CAAC;wBACH,CAAA,GAAA,MAAC,EAAE,UAAU,KAAK;oBACtB;gBACJ;gBAEJ,IAAI,CAAC,kBAAkB;YAE3B;QACJ;QAEA,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,aACvB,IAAI,CAAC,UACL,CAAC;YACG,gBAAgB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,SAAS;YACnD,CAAA,GAAA,oBAAQ,EAAE,KAAK;gBACX,MAAM;oBAAC;iBAAO;gBACd,QAAQ;gBACR,QAAQ;oBAAC;iBAAI;YACjB;QACJ,GACA,IAAI,CAAC,UACL,IAAI,CAAC;QAET,IAAI,CAAC,eAAe,IAAI,CAAA,GAAA,MAAC,EAAE,aAAa;YACpC,UAAU,IAAI,CAAC;YACf,SAAS;gBACL,cAAc,WAAW,KAAK;YAClC;YACA,SAAS,IAAI,CAAC;QAClB;QACA,IAAI,CAAC,aAAa,aAAa,IAAI,CAAC,YAAY;QAChD,IAAI,CAAC,aAAa,SAAS,IAAI,CAAC,SAAS,SAAS,IAAI,CAAC,SAAS,cAAc,gBAAgB;QAE9F,MAAM,YAAY,IAAI,CAAA,GAAA,MAAC,EAAE,UACrB,IAAI,CAAC,UACL,IAAI,CAAC,eACL,IAAI,CAAC,cACL,IAAI,CAAC,mBACL,QACA,IAAM,cACN,IAAM,iBACN,IAAM,IAAI,CAAC,UACX,IAAM,iBACN,CAAC,CAAC,IAAI,CAAC,OACP,IAAI,CAAC;QAGT,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAC3B,YACA,IAAI,CAAC,cACL,IAAI,CAAC,cACL,QACA,IAAI,CAAC,mBACL;YACI,IAAI,CAAC,WACD,MAAM,IAAI,MAAM;YAEpB,OAAO;QACX,GACA,IAAM,IAAI,CAAC,UACX,IAAM,iBACN,CAAC;YACG,kBAAkB;QACtB,GACA,IAAM;QAEV,CAAA,GAAA,oBAAQ,EAAE,YAAY,CAAC;YACnB,gBAAgB,QAAQ;QAC5B;QAEA,MAAM,qBAAqB;YACvB,CAAA,GAAA,MAAC,EAAE,eAAe;gBACd,cAAc;gBACd,gBAAgB,IAAI,CAAC,cAAc;gBACnC,eAAe;gBACf,aAAa,IAAI,CAAC,SAAS;gBAC3B,cAAc,IAAI,CAAC,SAAS;gBAC5B,gBAAgB,OAAO,aAAa,IAAI,CAAC,oBAAoB,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,IAAI,CAAC;gBAChG,iBAAiB,IAAI,CAAC;gBACtB,WAAW,CAAC,OAAO,QAAQ;oBACvB,IAAI,CAAC,SAAS,MAAM;wBAChB,OAAO;wBACP,QAAQ;wBACR,OAAO,MAAM,MAAM,IAAI,QAAQ;oBACnC;oBAEA,IAAI,CAAC,aAAa,OAAO;oBACzB,gBAAgB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,SAAS;oBACnD,IAAI,CAAC,kBAAkB;oBACvB,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;gBAC5E;gBACA,UAAU,KAAO;YACrB;QACJ;QAEA,MAAM,aAAa,CAAC;YAChB,CAAA,GAAA,MAAC,EAAE,YAAY;gBACX,QAAQ,IAAI,CAAC,SAAS,kBAAkB;gBACxC,UAAU,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,kBAAO,EAAE,eAAe;gBACjD,OAAO,CAAA,GAAA,MAAC,EAAE,YAAY,CAAA,GAAA,kBAAO,EAAE,eAAe;gBAC9C,UAAU,WAAW,WAAW,KAAO;YAC3C;QACJ;QAEA,IAAI,CAAC,iBAAiB,IAAI,CAAA,GAAA,MAAC,EAAE,eACzB,SAAS,cACT,IAAM,YACN,IAAM,IAAI,CAAC;QAGf,MAAM,kBAAkB,CAAC;YACrB,CAAA,GAAA,MAAC,EAAE,gBACC,IAAI,CAAC,UACL,IAAI,CAAC,SAAS,kBAAkB,IAChC,CAAC;gBACG,IAAI,SAAS,SAAS,KAAK,SAAS,UAAU,KAAK,SAAS,QAAQ,KAAK,SAAS,WAAW,GACzF;gBAEJ,WAAW;gBACX,CAAA,GAAA,MAAC,EAAE,UAAU,WAAW,MAAO;oBAC3B,SAAS;oBACT,UAAU,IAAI,CAAC;oBACf,OAAO;oBACP,SAAS,CAAA,GAAA,oBAAQ;gBACrB;gBACA,IAAI,CAAC,aAAa;gBAClB,IAAI,CAAC,kBAAkB;gBACvB,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;YAC5E,GACA,IAAI,CAAC,eACL,YAAY;QAEpB;QAEA,MAAM,UAAU,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAA,GAAA,MAAC,EAAE,QACvC,IAAI,CAAC,UACL,cACA,IAAM,IAAI,CAAC,SAAS,cACpB,YACA,CAAC;YACG,aAAa;QACjB,GACA,CAAC,OAAO,aAAe,cAAc,iBAAiB,OAAO,aAC7D,IAAM,IAAI,CAAC,eAAe,QAC1B,oBACA,YACA;YACI,CAAA,GAAA,MAAC,EAAE,YACC,IAAI,CAAC,UACL,IAAI,CAAC,UACL,SAAS,cACT,SAAS,OAAO,SAAS,IAAI,WAAW,SAAS,IAAI,WAAW;QAExE,GACA,iBACA,SAAS;QAGb,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YACvB;YACI,IAAI,CAAC,UAAU,IAAI,CAAC,YAAY,SAAS,UAAU;YACnD,IAAI,CAAC;YACL,IAAI,CAAC,IAAI,CAAC,OACN,CAAA,GAAA,0BAAW,EAAE,QAAQ,WAAW,IAAI,CAAC;QAE7C,GACA,IAAI,CAAC,QAAQ,YAAY,SAAS,cAClC,SAAS;QAGb,aAAa,IAAI,CAAA,GAAA,MAAC,EAAE,OAAO;YACvB,WAAW;YACX,QAAQ;gBACJ;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,4BAAW;oBAClB,QAAQ;wBACJ,IAAI,mBAAmB,eACnB,IAAI,CAAC,cAAc,OAAO;wBAE9B,CAAA,GAAA,MAAC,EAAE,OACC,UACA;4BAAC,IAAI,CAAC,cAAc;4BAAc,IAAI,CAAC,cAAc;4BAAoB,uBAAuB;yBAAa;wBAEjH,SAAS,MAAM,UAAU;oBAC7B;oBACA,SAAS;wBACL,SAAS,MAAM,UAAU;oBAC7B;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,2BAAU;oBACjB,WAAW;oBACX,QAAQ;wBACJ,OAAO,aAAa;oBACxB;oBACA,SAAS;wBACL,OAAO,aAAa;oBACxB;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,2BAAU;oBACjB,WAAW;oBACX,QAAQ;wBACJ,IAAI,CAAC,cAAc,OAAO;wBAC1B,OAAO,aAAa;oBACxB;oBACA,SAAS;wBACL,OAAO,aAAa;oBACxB;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,+BAAc;oBACrB,WAAW;oBACX,QAAQ;wBACJ,IAAI,CAAC,cAAc,OAAO;wBAC1B,WAAW,aAAa;oBAC5B;oBACA,SAAS;wBACL,WAAW,aAAa;oBAC5B;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,2BAAU;oBACjB,WAAW;oBACX,QAAQ;wBACJ,IAAI,CAAC,cAAc,OAAO;wBAC1B,OAAO,aAAa;oBACxB;oBACA,SAAS;wBACL,OAAO,aAAa;oBACxB;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,4BAAW;oBAClB,WAAW;oBACX,QAAQ;wBACJ,IAAI,CAAC,cAAc,OAAO;wBAC1B,QAAQ,aAAa;oBACzB;oBACA,SAAS;wBACL,QAAQ,aAAa;oBACzB;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,4BAAW;oBAClB,QAAQ;wBACJ,IAAI,CAAC,aAAa;wBAClB,IAAI,CAAC,aAAa,aAAa,MAAM,UAAU;oBACnD;oBACA,SAAS;wBACL,IAAI,CAAC,aAAa,aAAa,MAAM,UAAU;oBACnD;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,QAAQ;wBACJ,UAAU;oBACd;oBACA,SAAS;wBACL,UAAU;oBACd;oBACA,KAAK;wBACD,SAAS;oBACb;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,WAAW,CAAC,CAAC;oBACb,QAAQ;wBACJ,IAAI,CAAC,SACD;wBAEJ,QAAQ,aAAa,MAAM,UAAU;wBACrC,QAAQ,aAAa;oBACzB;oBACA,SAAS;wBACL,IAAI,CAAC,SACD;wBAEJ,QAAQ,aAAa,MAAM,UAAU;wBACrC,QAAQ,aAAa;oBACzB;oBACA,KAAK;wBACD,SAAS;oBACb;gBACJ;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBACZ,OAAO,CAAA,GAAA,8BAAa;oBACpB,QAAQ;wBACJ,YAAY,aAAa,MAAM,UAAU;oBACzC,kCAAkC;oBACtC;oBACA,SAAS;wBACL,YAAY,aAAa,MAAM,UAAU;oBACzC,mCAAmC;oBACvC;oBACA,KAAK;wBACD,UAAU;oBACd;gBACJ;aACH;QACL;QAEA,IAAI,CAAC,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC1B,KAAK;gBACD,OAAO;gBACP,UAAU;gBACV,QAAQ;gBACR,MAAM;YACV;QACJ;QACA,IAAI,SAAS,WAAW;YACpB,IAAI,CAAC,YAAY,SAAS;YAC1B,IAAI,CAAC,iBAAiB,OAAO,IAAI,CAAC;YAClC,MAAM,WAAW,IAAI,iBAAiB,IAAM,IAAI,CAAC;YACjD,SAAS,QACL,IAAI,CAAC,gBACL;gBACI,YAAY;gBACZ,WAAW;gBACX,SAAS;YACb;QAER;QAKA,CAAA,GAAA,MAAC,EAAE,OAAO,IAAI,CAAC,gBAAgB;YAC3B,IAAI,CAAC,aAAa;YAClB,WAAW;YACX;YACA,OAAO;YACP,OAAO;YACP,WAAW;YACX,OAAO;YACP,QAAQ;YACR,IAAI,CAAC,aAAa;YAClB,UAAU;YACV,UAAU,QAAQ,eAAe;YACjC,YAAY;YACZ,CAAA,GAAA,MAAC,EAAE,GAAG;gBACF,KAAK;oBACD,QAAQ;gBACZ;YACJ;YACA,IAAI,CAAC,mBAAmB,IAAI,CAAC,mBAAmB;SACnD;QAED,IAAI,CAAC,oBAAoB,IAAI,CAAA,GAAA,MAAC,EAAE,kBAAkB;YAC9C,WAAW,IAAI,CAAC;YAChB,SAAS,IAAI,CAAC;QAClB;QAEA,IAAI,CAAC,IAAI,CAAC,OACN,OAAO,eAAe,QAAQ,MAAM;YAChC,OAAO,CAAA,GAAA,4BAAe,EAAE;gBACpB,QAAQ,CAAC;oBACL,IAAI,CAAC,QAAQ,KAAK,WAAW,GACzB;oBAEJ,KAAK,QAAQ,CAAC,GAAG;wBACb,IAAI,UAAU,GACV,eAAe,UAAU,EAAE,GAAG,EAAE,GAAG;6BAEnC,eAAe,OAAO,EAAE,GAAG,EAAE,GAAG;oBAExC;oBACA,eAAe;oBACf,IAAI,CAAC,kBAAkB;gBAC3B;YACJ;YACA,UAAU;QACd;QAGJ,IAAI,CAAC,OAAO,IAAI,CAAC,SAAS,IAAI,CAAC;QAC/B,IAAI,CAAC;QAEL,MAAM,gBAAgB,IAAI,CAAA,GAAA,4BAAY,EAAE;YACpC,UAAU,IAAI,CAAC;YACf;YACA,cAAc,IAAI,CAAC;YACnB;YACA,UAAU,IAAI,CAAC;YACf,mBAAmB,IAAI,CAAC;YACxB;QACJ,GAAG;YACC,SAAS,CAAC,MAAQ,oBAAoB,SAAS;QACnD;QAEA,IAAI,CAAC,IAAI,CAAC,OAAO;YACb,IAAI,CAAA,GAAA,MAAC,EAAE,eAAe;gBAClB,QAAQ,SAAS;gBACjB,QAAQ,CAAC,OAAO;oBACZ,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc,QAAQ,GACzB;oBAEJ,cAAc,iBAAiB,OAAO;gBAC1C;gBACA,aAAa;oBACT,OAAO,CAAA,GAAA,MAAC,EAAE,cAAc,UAAU;gBACtC;YACJ;YAEA,OAAO,SAAS,iBACZ,SACA,CAAC,IAAsB,cAAc,QAAQ,IAC7C;QAER;QAEA;YACI,OAAO,iBAAiB,UAAU;gBAC9B,IAAI,CAAC,OAAO,OAAO,YAAY,OAAO;YAC1C;YACA,OAAO,iBAAiB,qBAAqB;gBACzC,IAAI,CAAC,OAAO,OAAO,YAAY,OAAO;YAC1C;YAEA,+FAA+F;YAC/F,sFAAsF;YACtF,MAAM,sBAAsB,CAAA,GAAA,MAAC,EAAE,GAAG;gBAC9B,QAAQ,SAAS;gBACjB,KAAK;oBACD,UAAU;oBACV,MAAM;oBACN,KAAK;oBACL,OAAO;oBACP,QAAQ;oBACR,eAAe;oBACf,QAAQ;oBACR,YAAY;gBAChB;YACJ;YACA,IAAI;gBACA,gEAAgE;gBAChE,MAAM,WAAW,IAAI,eAAe,IAAM,IAAI,CAAC,OAAO,OAAO,YAAY,OAAO;gBAChF,SAAS,QAAQ;YACrB,EAAE,OAAO,GAAG;gBACR,oBAAoB;YACxB;YAEA,sCAAsC;YACtC,IAAI,CAAC,SAAS,iBAAiB,SAAS,CAAC;gBACrC,IAAI,YAAY,UAAU,SACtB,MAAM;YAEd;YACA,6DAA6D;YAC7D,MAAM,UAAU,CAAC;gBACb,EAAE;YACN;YACA,OAAO,iBAAiB,gBAAgB;YACxC,OAAO,iBAAiB,iBAAiB;YACzC,OAAO,iBAAiB,cAAc;QAC1C;IACJ;IAEA,8BAA8B;IAE9B,QAAsB;QAClB,OAAO,IAAI,CAAC;IAChB;IAEA,OAAQ,CAAS,EAAE,CAAS,EAAQ;QAEhC,8CAA8C;QAC9C,IAAI,OAAO,UAAU,GACjB,OAAO,SAAS,GAAG;QAGvB,IAAI,IAAI,CAAC,YAAY,KAAK,IAAI,GAAG,MAAM,IAAI,CAAC,aAAa,KAAK,IAAI,GAAG,IACjE;QAGJ,IAAI,CAAC,UAAU,KAAK,IAAI,GAAG;QAC3B,IAAI,CAAC,WAAW,KAAK,IAAI,GAAG;QAE5B,IAAI,CAAC;QACL,IAAI,CAAC;QAEL,IAAI,CAAC,aAAa,aAAa,IAAI,CAAC,YAAY;QAChD,IAAI,CAAC,cAAc,UAAU,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,IAAI,CAAC,WAAW;QACzE,IAAI,CAAC,iBAAiB,WAAW,IAAI,CAAC,WAAW;IACrD;IAEA,IAAK,GAAW,EAAQ;QACpB,IAAI,CAAC,cAAc,IAAI;IAC3B;IAEA,SAAgB;QACZ,OAAO,CAAA,GAAA,0BAAW,EAAE,IAAI,CAAC,SAAS,kBAAkB,GAAG,UAAU;IACrE;IAMA,aAA0B;QACtB,OAAO,IAAI,CAAC,SAAS;IACzB;IAEA,kBAAyB;QACrB,IAAI,CAAC,UAAU,IAAI,CAAC,YAAY,SAAS,UAAU;QACnD,IAAI,CAAC,IAAI,CAAC,OACN,CAAA,GAAA,0BAAW,EAAE,QAAQ,WAAW,IAAI,CAAC;QAEzC,IAAI,CAAC;IACT;IAEA,YAAmB;QACf,IAAI,CAAC,eAAe,KAAK;IAC7B;IAEA,YAAsB;QAClB,OAAO,IAAI,CAAC,cAAc,kBAAkB,IAAI,CAAC,kBAAkB;IACvE;AACJ;;;;;AChqDA;;;;;CAKC,GACD,0DAAa;AAZb;AACA;;AACA;;AACA;AASO,MAAM;IAIT,mBAAmB;IAEnB,YAAa,CAAsE,CAAE;QACjF,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;YACX,KAAK;gBACD,QAAQ;gBACR,SAAS;YACb;QACJ;QAEA,SAAS,aAAc,CAOtB;YAIG,MAAM,UAAU,IAAK,CAAA,EAAE,eAAe,EAAE,eAAe,CAAA;YACvD,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;gBACb,WAAW;gBACX,OAAO,EAAE;gBACT,SAAS,EAAE;gBACX,KAAK;oBACD,SAAS,EAAE,UAAU,KAAM,EAAE,UAAU,UAAU,SAAS;gBAC9D;YACJ;YACA,IAAI,EAAE,SACF,GAAG,OAAO,EAAE;iBACT;gBACH,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,GAAG;oBACb,WAAW;oBACX,KAAK;wBACD,iBAAiB,UAAW,EAAE,QAAQ;wBACtC,kBAAkB;wBAClB,oBAAoB;wBACpB,gBAAgB,EAAE,UAAU,YAAY;wBACxC,yBAAyB;wBACzB,QAAQ;oBACZ;gBACJ;gBACA,GAAG,MAAM,gBAAgB;gBACzB,GAAG,OAAO;YACd;YACA,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC3C,QAAQ;gBACR,cAAc,SAAU,MAAM;oBAC1B,GAAG,UAAU,OAAO,8BAA8B;gBACtD;YACJ;YAEA,OAAO;gBACH;gBACA;YACJ;QACJ;QAEA,MAAM,eAAe,aAAa;YAC9B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;gBACX,SAAS,CAAA,GAAA,cAAG,EAAE;gBACd,WAAW;gBACX,KAAK;oBACD,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,OAAO;oBACP,QAAQ;gBACZ;YACJ;YACA,SAAS;QACb;QACA,aAAa,GAAG,MAAM,QAAQ;QAE9B,MAAM,aAAa,aAAa;YAC5B,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,uBAAM;YACb,SAAS;QACb;QAEA,MAAM,kBAAkB,aAAa;YACjC,SAAS,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,2BAAQ;YACf,SAAS;QACb;QAEA,IAAI,CAAC,OAAO,OAAO,aAAa,IAAI,gBAAgB,IAAI,WAAW;IACvE;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;ACnFA,mDAAgB;AAhChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA,SAAS,aAAc,MAAe,EAAE,SAAwB;IAC5D,IAAI,UAAU,WACV,OAAO,YAAY,UAAU;IAEjC,OAAO,QAAQ,UAAU;AAC7B;AAGO,SAAS;IACZ,IAAI,CAAA,GAAA,wBAAc,EAAE,UAChB;IAEJ,aAAa,CAAA,GAAA,kBAAQ,EAAE,oBAAoB,CAAA,GAAA,kDAAuB;IAClE,aAAa,CAAA,GAAA,kBAAQ,EAAE,YAAY,CAAA,GAAA,kCAAe;IAClD,aAAa,CAAA,GAAA,kBAAQ,EAAE,QAAQ,CAAA,GAAA,0BAAW;IAC1C,aAAa,CAAA,GAAA,kBAAQ,EAAE,MAAM,CAAA,GAAA,sBAAS;IACtC,aAAa,CAAA,GAAA,kBAAQ,EAAE,eAAe,CAAA,GAAA,wCAAkB;IACxD,aAAa,CAAA,GAAA,kBAAQ,EAAE,QAAQ,CAAA,GAAA,0BAAW;IAC1C,aAAa,CAAA,GAAA,kBAAQ,EAAE,aAAa,CAAA,GAAA,oCAAgB;IACpD,aAAa,CAAA,GAAA,kBAAQ,EAAE,QAAQ,CAAA,GAAA,0BAAW;IAC1C,aAAa,CAAA,GAAA,kBAAQ,EAAE,QAAQ,CAAA,GAAA,0BAAW;IAC1C,aAAa,CAAA,GAAA,kBAAQ,EAAE,WAAW,CAAA,GAAA,gCAAc;IAChD,aAAa,CAAA,GAAA,kBAAQ,EAAE,WAAW,CAAA,GAAA,gCAAc;IAChD,aAAa,CAAA,GAAA,kBAAQ,EAAE,MAAM,CAAA,GAAA,sBAAS;IACtC,aAAa,CAAA,GAAA,kBAAQ,EAAE,aAAa,CAAA,GAAA,oCAAgB;IACpD,aAAa,CAAA,GAAA,kBAAQ,EAAE,SAAS,CAAA,GAAA,4BAAY;IAC5C,aAAa,CAAA,GAAA,kBAAQ,EAAE,MAAM,CAAA,GAAA,sBAAS;IACtC,aAAa,CAAA,GAAA,kBAAQ,EAAE,OAAO,CAAA,GAAA,wBAAU;IACxC,aAAa,CAAA,GAAA,kBAAQ,EAAE,SAAS,CAAA,GAAA,4BAAY;IAC5C,aAAa,CAAA,GAAA,kBAAQ,EAAE,SAAS,CAAA,GAAA,4BAAY;IAC5C,aAAa,CAAA,GAAA,kBAAQ,EAAE,aAAa,CAAA,GAAA,oCAAgB;IAEpD,CAAA,GAAA,wBAAc,EAAE,WAAW;AAC/B;;;;;8DClCa;AAvBb;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAWO,MAAM,2BAA2B;IACpC,WAAW,MAA6B;QAEpC,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAiE;YACnE,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,IAAI,aAAa,GAAG,WAAW;QAC/B,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC;gBACP,OAAO,SAAS,mBAAmB,YAAY;YACnD;QACJ;QAEA,SAAS;YAEL,MAAM,mBAAmB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAClC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,AAAC,CAAA,aAAa,CAAA,IAAK;gBAC1B,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,aAAa,MAAM,KAAK;oBACxB,QAAQ;gBACZ;YACJ;YACA,MAAM,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAChC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,AAAC,CAAA,WAAW,CAAA,IAAK;gBACxB,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,WAAW,MAAM,KAAK;oBACtB,QAAQ;gBACZ;YACJ;YACA,iBAAiB,aAAa,MAAM,eAAe;YACnD,eAAe,aAAa,MAAM,eAAe;YACjD,OAAO,OAAO,iBAAiB,cAAc,eAAe;YAE5D,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YACA,QAAQ;YACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;gBACnC,YAAY;gBACZ,aAAa;YACjB;YACA,OAAO,OAAO,QAAQ;YAGtB,OAAO,UAAU;gBACb,iBAAiB;gBACjB,eAAe;gBACf,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,YAAY;oBACZ,UAAU;gBACd;YACJ;QACJ;QAEA,WAAW,YAAY,IAAI,yCAAyC;QAEpE,OAAO;IACX;IAEA,OAAO,MAAoD;QACvD,MAAM,UAAU,OAAO;QACvB,MAAM,aAAa,OAAO,MAAM;QAChC,MAAM,WAAW,OAAO,MAAM;QAC9B,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,SACb,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,mBAAmB,YAAY,UAAU;QAChE,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAqB;YACtC,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QAEA,OAAO;IACX;AACJ;;;;;gDClKa;AAAN,MAAM,aAAa;;;;;ACmB1B,uDAAa;AAlBb;AACA;AACA;AAEA;AACA;AAaO,MAAM;IAqBT,iBAAiB;IACjB,YAAa,CAA2B,CAAE;aAnBlC,UAAuC;aAGvC,mBAAmB;YACvB,cAAc;YACd,eAAe;YACf,WAAW;gBACP,QAAQ;gBACR,QAAQ;gBACR,UAAU;gBACV,GAAG;gBACH,GAAG;YACP;QACJ;aAeA,SAAoC,CAAC,mBAAmB,eAAe;YACnE,MAAM,cAAc,CAAA,GAAA,4CAAoB,EAAE;YAC1C,MAAM,UAAU,GAAG,4CAA4C;YAE/D,IAAI,qBAA4B,yDAAyD;YACzF;gBACI,MAAM,UAAU,CAAA,GAAA,kCAAW,EAAE,aAAa;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBACrD,MAAM,cAAc,CAAA,GAAA,kCAAW,EAAE,aAAa;oBAAC,GAAG,IAAI,CAAC,SAAS;oBAAO,GAAG,IAAI,CAAC,SAAS;gBAAM;gBAC9F,YAAY,IAAI,KAAK,MAAM,YAAY;gBACvC,YAAY,IAAI,KAAK,MAAM,YAAY;gBACvC,MAAM,YAAY;oBACd,GAAG,KAAK,IAAI,SAAS,QAAQ;oBAC7B,GAAG,KAAK,IAAI,SAAS,QAAQ;gBACjC;gBACA,MAAM,YAAY;oBACd,GAAG,KAAK,IAAI,gBAAgB,SAAU,YAAY;oBAClD,GAAG,KAAK,IAAI,iBAAiB,SAAU,YAAY;gBACvD;gBACA,sBAAsB;oBAClB,GAAG,UAAU;oBACb,GAAG,UAAU;oBACb,OAAO,UAAU,IAAI,UAAU;oBAC/B,QAAQ,UAAU,IAAI,UAAU;gBACpC;gBAEA,IAAI,oBAAoB,SAAS,KAAK,oBAAoB,UAAU,GAAG;oBACnE,IAAI,CAAC,cAAc,QAAQ;oBAC3B,IAAI,CAAC,cAAc,SAAS;oBAC5B,OAAO,IAAI,CAAC;gBAChB;YACJ;YAEA,IAAI,kBAAkB,CAAA,GAAA,6BAAM,EACxB,CAAA,GAAA,6BAAM,EAAE,cACR,CAAA,GAAA,+BAAQ,EAAE,SAAS,UACnB,CAAA,GAAA,+BAAQ,EAAE,oBAAoB,IAAI,SAAS,oBAAoB,IAAI;YAGvE,MAAM,gBAAgB;gBAClB,cAAc,KAAK,KAAK,oBAAoB;gBAC5C,eAAe,KAAK,KAAK,oBAAoB;gBAC7C,WAAW;oBACP,QAAQ,kBAAkB;oBAC1B,QAAQ,kBAAkB;oBAC1B,UAAU,kBAAkB;oBAC5B,GAAG,kBAAkB,IAAI,oBAAoB;oBAC7C,GAAG,kBAAkB,IAAI,oBAAoB;gBACjD;YACJ;YAEA,IAAI,YAAY;YAChB,IAAI,YAAY;YAGhB,IAAI,kBAAkB,SAAS,GAAG;gBAC9B,sDAAsD;gBACtD,MAAM,gBAAgB,CAAA,GAAA,kCAAW,EAAE,iBAAiB;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBAC/D,YAAY,CAAC,cAAc;gBAC3B,YAAY,CAAC,cAAc;gBAC3B,cAAc,IAAI,KAAK,IAAI,GAAG,KAAK,MAAM,cAAc;gBACvD,cAAc,IAAI,KAAK,IAAI,GAAG,KAAK,MAAM,cAAc;gBACvD,aAAa,cAAc;gBAC3B,aAAa,cAAc;gBAE3B,MAAM,oBAAoB,CAAA,GAAA,kCAAW,EAAE,iBAAiB;oBAAC,GAAG,oBAAoB;oBAAO,GAAG,oBAAoB;gBAAM;gBACpH,kBAAkB,IAAI,KAAK,IAAI,IAAI,CAAC,SAAS,OAAO,KAAK,KAAK,kBAAkB;gBAChF,kBAAkB,IAAI,KAAK,IAAI,IAAI,CAAC,SAAS,QAAQ,KAAK,KAAK,kBAAkB;gBAGjF,MAAM,KAAK,kBAAkB,IAAI,cAAc;gBAC/C,MAAM,KAAK,kBAAkB,IAAI,cAAc;gBAE/C,cAAc,eAAe;gBAC7B,cAAc,gBAAgB;gBAC9B,cAAc,YAAY;oBACtB,QAAQ;oBACR,QAAQ;oBACR,UAAU;oBACV,GAAG,CAAC,cAAc;oBAClB,GAAG,CAAC,cAAc;gBACtB;gBAEA,kBAAkB,CAAA,GAAA,6BAAM,EACpB,iBACA,CAAA,GAAA,2BAAI,EAAE,kBAAkB,QAAQ,kBAAkB,SAClD,CAAA,GAAA,+BAAQ,EAAE,WAAW;YAE7B;YAGA,IAAI,CAAC,IAAI,CAAC,WAAW,KAAK,UAAU,mBAAmB,KAAK,UAAU,IAAI,CAAC,qBAAqB,IAAI,CAAC,SAAS;gBAC1G,iBAAiB;gBACjB,IAAI,CAAC,cAAc,QAAQ,cAAc;gBACzC,IAAI,CAAC,cAAc,SAAS,cAAc;gBAE1C,iCAAiC;gBACjC,IAAI,CAAC,IAAI;gBACT,IAAI,CAAC,IAAI,wBAAwB;gBACjC,IAAI,kBAAkB,SAAS,GAC3B,IAAI,CAAC,IAAI,aAAa,CAAA,GAAA,4CAAoB,EAAE,cAAc;qBAE1D,IAAI,CAAC,IAAI,aAAa,CAAA,GAAA,6BAAM,EAAE;gBAElC,IAAI,CAAC,IAAI,UAAU,IAAI,CAAC,UAAU,GAAG;gBACrC,IAAI,CAAC,IAAI;gBACT,QAAQ;gBACR;;;;;;;8CAOkC,GAElC,IAAI,CAAC,IAAI,CAAC,WAAW,KAAK,UAAU,mBAAmB,KAAK,UAAU,IAAI,CAAC,mBAAmB;oBAC1F,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;oBAC7B,IAAI,CAAC,UAAU,IAAI,CAAC,SAAS,QAAQ,IAAI,CAAC;gBAC9C;gBAEA,IAAI,CAAC,IAAI,CAAC,SAAS;oBACf,IAAI,CAAC,cAAc,QAAQ;oBAC3B,IAAI,CAAC,cAAc,SAAS;gBAChC;YACJ;YACA,IAAI,CAAC,mBAAmB;YAExB,MAAM,WAAW,IAAI,CAAC,SAClB,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,UACxB,cAAc,WAChB;YAEF,IAAI,IAAI,CAAC,SAAS;gBACd,IAAI,CAAC,IAAI;gBACT,IAAI,CAAC,IAAI,cAAc,IAAI,CAAC,QAAQ;gBACpC,IAAI,CAAC,IAAI,2BAA2B,IAAI,CAAC,QAAQ;gBACjD,IAAI,CAAC,IAAI,UAAU,UAAU,GAAG;gBAChC,IAAI,CAAC,IAAI;gBACT,OAAO;oBACH,OAAO,IAAI,CAAC;oBACZ,WAAW;gBACf;YACJ;YAEA,OAAO;gBACH,OAAO;gBACP,WAAW;YACf;QACJ;QA5JI,IAAI,CAAC,WAAW,EAAE;QAClB,IAAI,CAAC,WAAW,EAAE;QAClB,IAAI,CAAC,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAE;QACjC,IAAI,CAAC,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC;QACvB,IAAI,CAAC,WAAW,CAAA,GAAA,iBAAU,EAAE,CAAA,GAAA,qBAAU;QACtC,IAAI,CAAC,UAAU,EAAE;IACrB;IAwJA,WAAY,OAAiB,EAAQ;QACjC,IAAI,CAAC,UAAU;IACnB;IAEA,UAAiB;QACb,CAAA,GAAA,MAAC,EAAE,WAAW,IAAI,CAAC;QACnB,IAAI,IAAI,CAAC,SAAS;YACd,IAAI,CAAC,UAAU,IAAI,CAAC,SAAS,QAAQ,IAAI,CAAC;YAC1C,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,SAAS;YACjC,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;QACjC;IACJ;AACJ;;;;;sDC7La;AAxBb;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAcO,MAAM,mBAAmB;IAE5B,WAAW,MAA6B;QACpC,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,UACD,OAAO;QAEX,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE;QACtB;YACI,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,SAAS,YAAY,SAAS,aAAa,KAAK,KAAK;YAC5E,MAAM,IAAI,SAAS,KAAK,IAAI,QAAQ,IAAI,SAAS,KAAK,IAAI;YAC1D,MAAM,gBAAgB,IAAI,SAAS;YACnC,WAAW,QAAQ;YACnB,WAAW,SAAS;YACpB,WAAW,MAAM,UAAU;YAC3B,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY,UAAU,SAAS,kBAAkB,gBAAgB,GAAG,GAAG,GAAG;QACrF;QAEA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAyD;YAC3D,SAAS;QACb;QACA,IAAI,OAAO,GAAG,QAAQ,GAAG,MAAM,GAAG,SAAS;QAC3C,IAAI,cAAc,OAAO,eAAe,OAAO,aAAa,OAAO,gBAAgB;QACnF,MAAM,WAAW,OAAO,UAAU,YAAY,OAAO;QACrD,IAAI,QAAgB;QAIpB,yBAAyB;QAEzB,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,KAAK;gBAAC,YAAY;gBAAQ,QAAQ;YAAM;QAC5C;QACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,KAAK;gBAAC,YAAY;gBAAQ,QAAQ;YAAM;QAC5C;QACA,OAAO,OAAO,WAAW;QAEzB,MAAM,YAAY,CAAA,GAAA,YAAI,EAAE;YACpB,MAAM;YACN,MAAM;YACN,KAAK,CAAC,SAAS;YACf,KAAK;YACL,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU;gBACN,cAAc;gBACd;YACJ;QACJ;QACA,MAAM,aAAa,CAAA,GAAA,YAAI,EAAE;YACrB,MAAM;YACN,MAAM;YACN,KAAK,CAAC,SAAS;YACf,KAAK;YACL,KAAK;gBAAC,OAAO;YAAM;YACnB,UAAU;gBACN,eAAe;gBACf;YACJ;QACJ;QACA,MAAM,WAAW,CAAA,GAAA,YAAI,EAAE;YACnB,MAAM;YACN,MAAM;YACN,KAAK,CAAC,SAAS;YACf,KAAK;YACL,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU;gBACN,aAAa;gBACb;YACJ;QACJ;QACA,MAAM,cAAc,CAAA,GAAA,YAAI,EAAE;YACtB,MAAM;YACN,MAAM;YACN,KAAK,CAAC,SAAS;YACf,KAAK;YACL,KAAK;gBAAC,OAAO;YAAM;YACnB,UAAU;gBACN,gBAAgB;gBAChB;YACJ;QACJ;QAEA,MAAM,aAAa;YACf,SAAS;YACT,OAAO;QACX;QACA,UAAU,OACN,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS,CAAA,GAAA,cAAG,EAAE,sBAAsB;YAAK,KAAK;QAAU,IAC/D,WACA,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS,CAAA,GAAA,cAAG,EAAE,uBAAuB;YAAK,KAAK;QAAU,IAChE;QAEJ,UAAU,OACN,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS,CAAA,GAAA,cAAG,EAAE,qBAAqB;YAAK,KAAK;QAAU,IAC9D,UACA,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS,CAAA,GAAA,cAAG,EAAE,wBAAwB;YAAK,KAAK;QAAU,IACjE;QAGJ,SAAS;YACL,OAAO,SAAS,UAAU;YAC1B,QAAQ,SAAS,WAAW;YAC5B,MAAM,SAAS,SAAS;YACxB,SAAS,SAAS,YAAY;YAC9B,IAAI,WAAW,SAAS,aAAa,OAAO;YAC5C,IAAI,YAAY,SAAS,cAAc,MAAM;YAE7C,IAAI,YAAY,GAAG;gBACf,IAAI,aAAa;oBACb,OAAO,CAAC,SAAS,aAAa,QAAQ;oBACtC,UAAU,QAAQ,KAAK;gBAC3B;gBACA,IAAI,cAAc;oBACd,QAAQ,CAAC,SAAS,aAAa,OAAO;oBACtC,WAAW,QAAQ,KAAK;gBAC5B;gBACA,WAAW;YACf;YACA,IAAI,WAAW,UAAU;gBACrB,IAAI,aAAa;oBACb,OAAO,CAAC,SAAS,aAAa,QAAQ;oBACtC,UAAU,QAAQ,KAAK;gBAC3B;gBACA,IAAI,cAAc;oBACd,QAAQ,CAAC,SAAS,aAAa,OAAO;oBACtC,WAAW,QAAQ,KAAK;gBAC5B;gBACA,WAAW;YACf;YACA,IAAI,aAAa,GAAG;gBAChB,IAAI,YAAY;oBACZ,MAAM,CAAC,SAAS,cAAc,SAAS;oBACvC,SAAS,QAAQ,KAAK;gBAC1B;gBACA,IAAI,eAAe;oBACf,SAAS,CAAC,SAAS,cAAc,MAAM;oBACvC,YAAY,QAAQ,KAAK;gBAC7B;gBACA,YAAY;YAChB;YACA,IAAI,YAAY,WAAW;gBACvB,IAAI,YAAY;oBACZ,MAAM,CAAC,SAAS,cAAc,SAAS;oBACvC,SAAS,QAAQ,KAAK;gBAC1B;gBACA,IAAI,eAAe;oBACf,SAAS,CAAC,SAAS,cAAc,MAAM;oBACvC,YAAY,QAAQ,KAAK;gBAC7B;gBACA,YAAY;YAChB;YACA,QAAQ,aAAa;gBACjB,GAAG,CAAC;gBACJ,GAAG,CAAC;gBACJ,OAAO;gBACP,QAAQ;YACZ;YAGA,cAAc;YACd,eAAe;YACf,aAAa;YACb,gBAAgB;QACpB;QAEA,IAAI,kBAAkB;QACtB,MAAM,sBAAsB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACrC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,CAAC;gBACjB,kBAAkB;gBAClB,QAAQ,WAAW;YACvB;QACJ;QACA,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,OAAO;YACX;QACJ;QAEA,IAAI,kBAAkB;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC;QAC7C,MAAM,kBAAkB;YACpB;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YACvB;gBAAC,GAAG;gBAAK,GAAG;gBAAK,GAAG;gBAAK,GAAG;YAAC;YAC7B;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;SAC1B;QACD,gBAAgB,KAAK;YACjB,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,gBAAgB;YAC1B,GAAG;QACP;QACA,gBAAgB,KAAK;YACjB,GAAG,OAAO,kBAAkB;YAC5B,GAAG,OAAO,kBAAkB;YAC5B,GAAG,OAAO,kBAAkB;YAC5B,GAAG;QACP;QAEA,MAAM,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YAClC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,OAAO;gBACvB,kBAAkB;gBAClB;YACJ;QACJ;QAGA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,KAAK;gBACD,SAAS;gBACT,gBAAgB;gBAChB,YAAY;gBACZ,WAAW;YACf;QACJ;QACA,OAAO,OAAO;QACd,QAAQ,OAAO,oBAAoB,cAAc,aAAa;QAG9D,4DAA4D;QAC5D,mBAAmB;QACnB,SAAS,OAAQ,SAAgB;YAC7B,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,UAAU,OAAO,UAAU,QAAQ,KAAK,KAAK;YACpE,QAAQ,IAAI,QAAQ,UAAU;YAE9B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,aAAa,CAAA,GAAA,yBAAW,EAAE,OAAO,eAAe,IAAI,OAAO,IAAI;YAEjF,WAAW,MAAM,QAAQ,SAAS,aAAa,QAAQ;YACvD,WAAW,MAAM,SAAS,SAAS,cAAc,QAAQ;YAEzD,cAAc,MAAM,OAAO,AAAC,OAAO,IAAI,UAAU,IAAI,QAAS;YAC9D,cAAc,MAAM,MAAM,AAAC,OAAO,IAAI,UAAU,IAAI,QAAS;YAE7D,OAAO,SAAS,KAAK,CAAC,UAAU;YAChC,MAAM,SAAS,KAAK,CAAC,UAAU;YAC/B,QAAQ,SAAS,KAAM,CAAA,UAAU,IAAI,UAAU,QAAQ,SAAS,UAAS;YACzE,SAAS,SAAS,KAAM,CAAA,UAAU,IAAI,UAAU,SAAS,SAAS,WAAU;YAC5E,UAAU,QAAQ,KAAK;YACvB,SAAS,QAAQ,KAAK;YACtB,WAAW,QAAQ,KAAK;YACxB,YAAY,QAAQ,KAAK;YAEzB,CAAA,GAAA,MAAC,EAAE,qBAAqB,SAAS,KAAM,KAAK,QAAS,SAAU,GAAG;gBAC9D,eAAe,MAAM,aAAa,SAAS,MAAM;gBACjD,IAAI,gBAAgB,MAAM,GACtB,WAAW,MAAM,aAAa,SAAS,MAAM;YAErD,GAAG,CAAA,GAAA,YAAI,EAAE;YACT,eAAe,MAAM,qBAAqB,AAAC,OAAO,IAAK,QAAS,OAAO,IAAK;YAE5E,QAAQ,SAAS;QACrB;QAEA,MAAM,gBAAgB,CAAA,GAAA,yBAAW,EAAE,SAAS,GAAG,6BAA6B;QAC5E,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,WAAW;YACX,KAAK;gBACD,OAAO,CAAA,GAAA,yBAAW,EAAE,QAAQ;gBAC5B,WAAW;gBACX,YAAY;gBACZ,QAAQ,gBAAgB;gBACxB,iBAAiB;gBACjB,UAAU;gBACV,WAAW;gBACX,cAAc;gBACd,UAAU;gBACV,YAAY;gBACZ,aAAa;YACjB;QACJ;QACA,eAAe,gBAAgB;YAC3B,OAAO;QACX;QACA,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;gBACL,QAAQ;gBACR,OAAO;YACX;QACJ;QACA,eAAe,OAAO;QAEtB,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,QAAQ;YACR,KAAK;gBACD,UAAU;gBACV,MAAM;gBACN,KAAK;YACT;QACJ;QAEA,CAAA,GAAA,MAAC,EAAE,GAAG;YACF,QAAQ;YACR,SAAS;YACT,KAAK;gBACD,WAAW;gBACX,UAAU;gBACV,MAAM;gBACN,KAAK;YACT;QACJ;QAGA,OAAO,OAAO;QACd,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACxB,GAAG;YACH,GAAG;YACH,OAAO,SAAS;YAChB,QAAQ,SAAS;YACjB,OAAO;YACP,UAAU;YACV,MAAM;YACN,MAAM;QACV;QACA,OAAO,QAAQ;QACf,cAAc,OAAO,QAAQ;QAE7B,SAAS;YACL,IAAI,gBAAgB,MAAM,GAAG;gBACzB,eAAe,MAAM,aAAa;gBAClC,WAAW,MAAM,aAAa;YAClC,OAAO;gBACH,eAAe,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS;gBAE7D,CAAA,GAAA,MAAC,EAAE,qBAAqB,SAAS,KAAM,KAAK,QAAS,SAAU,GAAG;oBAC9D,WAAW,MAAM,aAAa,SAAS,MAAM;gBACjD,GAAG,CAAA,GAAA,YAAI,EAAE;YACb;QACJ;QAEA,SAAS;YACL;QACJ;QACA,CAAA,GAAA,YAAI,EAAE,kBAAkB;QAExB,OAAO,UAAU;YACb,QAAQ;YACR,oBAAoB;YACpB,CAAA,GAAA,YAAI,EAAE,qBAAqB;YAC3B,aAAa;QACjB;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO;gBACH,MAAM;gBACN,OAAO;gBACP,KAAK;gBACL,QAAQ;gBACR,WAAW,gBAAgB,MAAM,IAAI,YAAY;YACrD;QACJ;QACA,OAAO;IACX;IAEA,OAAO,MAA4C;QAC/C,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,IACI,CAAC,YACD,CAAC,WACD,MAAM,OAAO,MAAM,SACnB,MAAM,OAAO,MAAM,UACnB,MAAM,OAAO,MAAM,QACnB,MAAM,OAAO,MAAM,SAEnB,OAAO;QAEX,QAAQ,MAAM;QACd,SAAS,aAAa,OAAO;QAC7B,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAa;YAC9B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ,OAAO;gBAC7B;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;kDCtYa;AArBb;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AAUO,MAAM,eAAe;IAExB,WAAW,MAA6B;QAEpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAqD;YACvD,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,IAAI,SAAuB,CAAA,GAAA,kCAAoB;QAC/C,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC;gBACP,OAAO,SAAS,OAAO,OAAO,GAAG,OAAO,GAAG,OAAO;YACtD;QACJ;QAGA,SAAS;YAEL,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YACA,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;gBACnC,YAAY;gBACZ,aAAa;YACjB;YAEA,MAAM,QAAQ,IAAI,CAAA,GAAA,wBAAU,EAAE;gBAC1B;gBACA,UAAU,SAAU,GAAG;oBACnB,SAAS;oBACT,QAAQ;gBACZ;YACJ;YACA,MAAM,cAA+B,MAAM;YAG3C,OAAO,OAAO,MAAM,cAAa,QAAQ;YAEzC,OAAO,UAAU;gBACb,MAAM;gBACN,YAAY;gBACZ,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,QAAQ;gBACZ;YACJ;QACJ;QAEA,WAAW,YAAY;QAEvB,OAAO;IACX;IAEA,OAAO,MAAwC;QAC3C,MAAM,UAAU,OAAO;QACvB,MAAM,SAAS,OAAO,MAAM;QAC5B,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,SACb,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,OAAO,OAAO,GAAG,OAAO,GAAG,OAAO,GAAG;QAC5D,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAS;YAC1B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QAEA,OAAO;IACX;AAGJ;;;;;AC5HA,2DAAgB;AAQhB,iDAAa;AA1Bb;AACA;AACA;AAgBO,SAAS;IACZ,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;QACd,GAAG;YAAC;gBAAC;gBAAG;aAAE;YAAE;gBAAC,IAAI;gBAAG,IAAI;aAAE;YAAE;gBAAC,IAAI;gBAAG,IAAI;aAAE;YAAE;gBAAC;gBAAG;aAAE;SAAC;QACnD,GAAG;YAAC;gBAAC;gBAAG;aAAE;YAAE;gBAAC,IAAI;gBAAG,IAAI;aAAE;YAAE;gBAAC,IAAI;gBAAG,IAAI;aAAE;YAAE;gBAAC;gBAAG;aAAE;SAAC;QACnD,GAAG;YAAC;gBAAC;gBAAG;aAAE;YAAE;gBAAC,IAAI;gBAAG,IAAI;aAAE;YAAE;gBAAC,IAAI;gBAAG,IAAI;aAAE;YAAE;gBAAC;gBAAG;aAAE;SAAC;IACvD;AACJ;AAEO,MAAM;IAST,mBAAmB;IACnB,YACI,CAGC,CACH;QACE,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,UAAU;gBACV,cAAc;YAClB;QACJ;QACA,IAAI,CAAC,OAAO,gBAAgB,IAAM;QAClC,IAAI,OAAO;QACX,IAAI,SAAS,EAAE;QACf,IAAI,CAAC,cAAc,IAAI,CAAA,GAAA,gBAAM,EAAG;YAC5B,WAAW;gBACP;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;aACH;YACD,QAAQ;YACR,UAAU,CAAC;gBACP,OAAO;gBACP,IAAI,SAAS,OACT,SAAS;gBAEb,IAAI,QAAQ,OAAO;gBACnB,IAAI,SAAS,SACT,QAAQ,OAAO;gBAEnB,IAAI,SAAS,QACT,QAAQ,OAAO;gBAEnB,IAAI,CAAC,GAAG,OAAO,GAAG,QAAQ,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG;gBACxC,IAAI,CAAC,GAAG,OAAO,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG,OAAO,QAAQ,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG;gBAC1D,IAAI,CAAC,GAAG,OAAO,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG,OAAO,QAAQ,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG;gBAC1D,IAAI,CAAC,GAAG,OAAO,OAAO,QAAQ,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG;gBAE5C;YACJ;QACJ;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,YAAY;QAEpC,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,QAAQ,IAAI,CAAC;YACb,WAAW;YACX,KAAK;gBACD,UAAU;gBACV,WAAW;YACf;QACJ;QAEA,MAAM,QAAQ,KAAK,QAAQ;QAC3B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO;QAChC,IAAI,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;QACjB,UAAU,OAAO;QAEjB,MAAM,MAAM,CAAC;YACT,OAAO,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;QACnC;QAEA,MAAM,cAAc,CAChB,GACA,GACA,UACA;YAEA,MAAM,WAAW;YACjB,IAAI,YAAY,GAAG,YAAY;YAC/B,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;gBAClB,WAAW;gBACX,KAAK;oBACD,MAAM,AAAC,IAAI,WAAW,IAAK;oBAC3B,KAAK,AAAC,IAAI,WAAW,IAAK;oBAC1B,OAAO,WAAW;oBAClB,QAAQ,WAAW;oBACnB,cAAc,WAAW;gBAC7B;YACJ;YAEA,MAAM,SAAS;gBACX,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS;oBACZ,MAAM,AAAC,IAAI,WAAW,IAAK;oBAC3B,KAAK,AAAC,IAAI,WAAW,IAAK;gBAC9B;YACJ;YAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;gBAC3C,QAAQ;gBACR,WAAW,CAAC;oBACR,MAAM;oBACN,IAAI,MAAM,SAAS,eAAe;wBAC9B,YAAY;wBACZ,YAAY;oBAChB;oBACA,IAAI,MAAM,WAAW,UAAU,MAAM,SAAS,eAAe;wBACzD,IAAI,CAAC,MACD,aAAa,MAAM;wBAEvB,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO;wBAChC,aAAa,MAAM;wBACnB,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO;wBAChC;wBACA,SAAS;4BACL,GAAG;4BACH,GAAG;wBACP;oBACJ;gBACJ;YACJ;YAEA,UAAU,OAAO;YAEjB,MAAM,SAAS,CAAC,MAAc;gBAC1B,IAAI;gBACJ,IAAI;gBACJ,YAAY;gBACZ,YAAY;gBACZ,CAAA,GAAA,MAAC,EAAE,IAAI,SAAS;oBACZ,MAAM,AAAC,IAAI,WAAW,IAAK;oBAC3B,KAAK,AAAC,IAAI,WAAW,IAAK;gBAC9B;YACJ;YAEA,OAAO;gBACH,IAAI;gBACJ;gBACA;YACJ;QACJ;QAEA,MAAM,gBAAgB,CAAC,GAAW,GAAW;YACzC,IAAI,SAAS,OAAO;gBAChB,OAAO,CAAC,CAAC,EAAE,GAAG;oBAAC,IAAI,IAAI;oBAAQ,IAAI,IAAI,IAAI;iBAAO;gBAClD,OAAO,CAAC,CAAC,EAAE,GAAG;oBAAC,IAAI,IAAI;oBAAQ,IAAI,IAAI,IAAI;iBAAO;gBAClD,OAAO,CAAC,CAAC,EAAE,GAAG;oBAAC,IAAI,IAAI;oBAAQ,IAAI,IAAI,IAAI;iBAAO;YACtD;YACA,IAAI,SAAS,OACT,OAAO,CAAC,CAAC,EAAE,GAAG;gBAAC,IAAI,IAAI;gBAAQ,IAAI,IAAI,IAAI;aAAO;YAEtD,IAAI,SAAS,SACT,OAAO,CAAC,CAAC,EAAE,GAAG;gBAAC,IAAI,IAAI;gBAAQ,IAAI,IAAI,IAAI;aAAO;YAEtD,IAAI,SAAS,QACT,OAAO,CAAC,CAAC,EAAE,GAAG;gBAAC,IAAI,IAAI;gBAAQ,IAAI,IAAI,IAAI;aAAO;QAE1D;QAEA,IAAI,CAAC,KAAK,YAAY,GAAG,OAAO,CAAC;YAC7B,cAAc,GAAG,IAAI,GAAG,IAAI;YAC5B;QACJ,GAAG;QACH,IAAI,CAAC,KAAK,YAAY,QAAQ,GAAG,QAAQ,IAAI,GAAG,CAAC;YAC7C,cAAc,GAAG,IAAI,GAAG,IAAI;YAC5B;QACJ;QACA,IAAI,CAAC,KAAK,YAAY,QAAQ,IAAI,GAAG,QAAQ,GAAG,CAAC;YAC7C,cAAc,GAAG,IAAI,GAAG,IAAI;YAC5B;QACJ;QACA,IAAI,CAAC,KAAK,YAAY,OAAO,GAAG,CAAC;YAC7B,cAAc,GAAG,IAAI,GAAG,IAAI;YAC5B;QACJ,GAAG;QAGH,MAAM,SAAS;YACX,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YACb,IAAI,UAAU,GAAG,GAAG,OAAO,OAAO,OAAO;YAEzC,MAAM,YAA0B;gBAC5B,GAAG,EAAE;gBACL,GAAG,EAAE;gBACL,GAAG,EAAE;YACT;YACA,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,EAAE,QAAQ,IAAK;gBACtC,UAAU,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE;gBAC5B,UAAU,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE;gBAC5B,UAAU,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE;YAChC;YAEA,MAAM,YAAY,CAAC;gBACf,IAAI;gBACJ,MAAM,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,mBAAmB;gBACzC,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK;oBAC1B,IAAI,IAAI,OAAO,YAAY,IAAI;oBAC/B,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG;oBAE5B,IAAI,MAAM,GACN,IAAI,OAAO,IAAI,MAAM,OAAO,QAAQ,IAAI;yBAExC,IAAI,OAAO,IAAI,MAAM,OAAO,QAAQ,IAAI;gBAEhD;gBACA,IAAI;YACR;YAEA,IAAI;YACJ,IAAI,SAAS,OAAO;gBAChB,IAAI,cAAc;gBAClB,UAAU,UAAU;YACxB,OAAO;gBACH,IAAI,cAAc;gBAClB,IAAI,cAAc;gBAClB,UAAU,UAAU;gBACpB,IAAI,cAAc;gBAClB,UAAU,UAAU;gBACpB,IAAI,cAAc;gBAClB,UAAU,UAAU;YACxB;YACA,IAAI;YACJ,EAAE,SAAS;QACf;QAEA;IACJ;IAEA,sBAAsB;IACtB,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,GAAG,gBAAgB;QACxB,IAAI,CAAC,GAAG,gBAAgB;QACxB,IAAI,CAAC,GAAG,gBAAgB;QACxB,IAAI,CAAC,GAAG,gBAAgB;IAC5B;IAEA,iBAAmC;QAC/B,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;gDCtQa;AApBb;AACA;AACA;AAEA;AACA;AAEA;AACA;AAYO,MAAM,aAAa;IAEtB,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,QAAQ,OAAO,OAAO,QAAQ,OAAO,QAAQ,KAAK,KAAK;QAC9E,MAAM,IAAI,SAAS,KAAK,IAAI,QAAQ,IAAI,SAAS,KAAK,IAAI;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAmD;YACrD,SAAS;QACb;QACA,IAAI,eAAe;QACnB,IAAI,aAAa;QACjB,IAAI,eAAe;QAGnB,MAAM,qBAAqB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACpC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE,4BAA4B;YACxC,UAAU;YACV,UAAU,SAAU,CAAC;gBACjB,eAAe;gBACf;YACJ;YACA,KAAK;gBACD,cAAc;YAClB;QACJ;QACA,MAAM,mBAAmB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAClC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE,0BAA0B;YACtC,UAAU;YACV,UAAU,SAAU,CAAC;gBACjB,aAAa;gBACb;YACJ;YACA,KAAK;gBACD,cAAc;YAClB;QACJ;QACA,OAAO,OAAO,mBAAmB;QACjC,OAAO,OAAO,iBAAiB;QAE/B,MAAM,gBAAgB,IAAI,CAAA,GAAA,gBAAM,EAAW;YACvC,WAAW;gBACP;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;gBACA;oBACI,IAAI;oBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;gBAChB;aACH;YACD,UAAU,CAAC;gBACP,eAAe;gBACf;YACJ;QACJ;QAEA,OAAO,OAAO,cAAc;QAG5B,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,WAAW;YACX,KAAK;gBACD,OAAO,CAAA,GAAA,yBAAW,EAAE,QAAQ;gBAC5B,QAAQ,CAAA,GAAA,yBAAW,EAAE,SAAS;YAClC;QACJ;QAEA,MAAM,eAA8B;YAChC,OAAO,CAAA,GAAA,MAAC,EAAE,OAAO,KAAK,MAAM,IAAI,KAAK,MAAM;YAC3C,WAAW;YACX,SAAS;YACT,YAAY;QAChB;QACA,MAAM,kBAAkB,IAAI,CAAA,GAAA,8BAAc,EAAE;YACxC,OAAO,KAAK,MAAM;YAClB,QAAQ,KAAK,MAAM;YACnB,QAAQ;gBAAC;aAAa;QAC1B;QAEA,MAAM,sBAAsB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC9B,WAAW;YACX,KAAK;gBACD,OAAO,SAAS,KAAK,KAAK;gBAC1B,QAAQ,SAAS,KAAK,KAAK;YAC/B;QACJ;QACA,oBAAoB,OAAO,gBAAgB;QAC3C,eAAe,OAAO;QAEtB,SAAS;YACL,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAK,aAAa;YACjC,IAAI;YACJ,IAAI,UAAU,GAAG,GAAG,aAAa,MAAM,OAAO,aAAa,MAAM;YAEjE,IAAI,cAAc;gBACd,IAAI,cAAc;oBACd,IAAI,UAAU,aAAa,MAAM,OAAO;oBACxC,IAAI,MAAM,IAAI;gBAClB;gBACA,IAAI,YAAY;oBACZ,IAAI,UAAU,GAAG,aAAa,MAAM;oBACpC,IAAI,MAAM,GAAG;gBACjB;YACJ;YAEA,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAAK;gBACpC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,WACX;gBAGJ,IAAI;gBACJ,IAAI,CAAC,gBAAgB,uBAAuB,GAAG;oBAC3C,IAAI,cAAc;wBACd,IAAI,UAAU,aAAa,MAAM,OAAO;wBACxC,IAAI,MAAM,IAAI;oBAClB;oBACA,IAAI,YAAY;wBACZ,IAAI,UAAU,GAAG,aAAa,MAAM;wBACpC,IAAI,MAAM,GAAG;oBACjB;gBACJ;gBACA,IAAI,IAAI,OAAO,QAAQ,MAAM,CAAC,EAAE,CAAC,QAAQ,OAAO,OAC5C,IAAI,wBAAwB;gBAEhC,IAAI,cAAc,MAAM,CAAC,EAAE,CAAC;gBAC5B,IAAI,2BAA2B,MAAM,CAAC,EAAE,CAAC;gBACzC,IAAI,UAAU,MAAM,CAAC,EAAE,CAAC,QAAQ,QAAQ,GAAG,GAAG,aAAa,MAAM,OAAO,aAAa,MAAM;gBAC3F,IAAI;YACR;YACA,gBAAgB;YAChB,IAAI;QACR;QACA,WAAW,eAAe;QAG1B,OAAO,OAAO;QACd,OAAO,UAAU;YACb,mBAAmB;YACnB,iBAAiB;YACjB,cAAc;YACd,gBAAgB;QACpB;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO;gBACH,YAAY;gBACZ,UAAU;gBACV,YAAY;YAChB;QACJ;QACA,OAAO;IACX;IAEA,OAAO,MAAsC;QACzC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,MAAM,aAAa,OAAO,MAAM;QAChC,MAAM,WAAW,OAAO,MAAM;QAC9B,MAAM,aAAa,OAAO,MAAM;QAChC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAC1B,OAAO;QAGX,QAAQ,MAAM;QACd,SAAS,KACL,YACA,UACA,aAAa,YAAY,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAExE,QAAQ,MAAM;QAEd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAO;YACxB,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;yDC/La;AAvBb;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAWO,MAAM,sBAAsB;IAE/B,WAAW,MAA6B;QAEpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAA4D;YAC9D,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,IAAI,MAAM,GAAG,aAAa;QAC1B,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC;gBACP,OAAO,SAAS,cAAc,KAAK;YACvC;QACJ;QAEA,SAAS;YAEL,MAAM,YAAY,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC3B,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,MAAM;gBACb,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,MAAM,MAAM;oBACZ,QAAQ;gBACZ;YACJ;YACA,MAAM,mBAAmB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAClC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,AAAC,CAAA,aAAa,CAAA,IAAK;gBAC1B,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,aAAa,MAAM,KAAK;oBACxB,QAAQ;gBACZ;YACJ;YACA,UAAU,aAAa,MAAM,eAAe;YAC5C,iBAAiB,aAAa,MAAM,eAAe;YACnD,OAAO,OAAO,UAAU,cAAc,iBAAiB;YAGvD,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YACA,QAAQ;YACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;gBACnC,YAAY;gBACZ,aAAa;YACjB;YACA,OAAO,OAAO,QAAQ;YAEtB,OAAO,UAAU;gBACb,UAAU;gBACV,iBAAiB;gBACjB,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,KAAK;oBACL,YAAY;gBAChB;YACJ;QACJ;QAEA,WAAW,YAAY;QACvB,OAAO;IACX;IAEA,OAAO,MAA+C;QAClD,MAAM,UAAU,OAAO;QACvB,MAAM,MAAM,OAAO,MAAM;QACzB,MAAM,UAAU,OAAO;QACvB,MAAM,aAAa,OAAO,MAAM;QAChC,IAAI,CAAC,WAAW,QAAQ,QAAQ,eAAe,QAAQ,CAAC,SACpD,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,cAAc,KAAK,YAAY;QACtD,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAgB;YACjC,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;kDCzJa;AAVb;AAUO,MAAM,eAAe;IAExB,OAAO,MAAwC;QAC3C,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,SACb,OAAO;QAGX,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO;QAGX,QAAQ,MAAM;QAEd,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,SAAS;QAChC,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QAER,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAS;YAC1B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;uDCnBa;AAxBb;AACA;AAEA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAWO,MAAM,oBAAoB;IAE7B,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAA0D;YAC5D,SAAS;QACb;QACA,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,0BAAY,EAAE;QAGjC,SAAS;YAEL,MAAM,WAAW,CAAA,GAAA,iBAAU,EAAE,CAAA,GAAA,qBAAU;YACvC,MAAM,UAAU,CAAA,GAAA,sBAAe,EAAE,UAAU,QAAQ,QAAQ;YAE3D,SAAS;gBACL,IAAI,UACA,SAAS,KAAK,SAAS;qBAEvB,SAAS,KAAK,SAAS,YACnB,WAAW,eACX,WAAW,cACb;gBAEN,QAAQ;YACZ;YAEA,MAAM,aAAa;gBACf;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBACX;oBAAC,GAAG,QAAQ,OAAO;oBAAO,GAAG;gBAAC;gBAC9B;oBAAC,GAAG,QAAQ,OAAO;oBAAO,GAAG,QAAQ,OAAO;gBAAM;gBAClD;oBAAC,GAAG;oBAAG,GAAG,QAAQ,OAAO;gBAAM;aAClC;YACD,MAAM,eAAe,WAAW,IAAI,CAAA;gBAChC,OAAO,IAAI,CAAA,GAAA,8BAAa,EAAE;oBACtB,OAAO;oBACP,UAAU;wBACN;oBACJ;gBACJ;YACJ;YACA,aAAa,QAAQ,CAAA,OAAQ,KAAK,aAAa,MAAM,UAAU;YAC/D,MAAM,cAAc,WAAW,IAAI,CAAA;gBAC/B,OAAO,IAAI,CAAA,GAAA,8BAAa,EAAE;oBACtB,OAAO;oBACP,UAAU;wBACN;oBACJ;gBACJ;YACJ;YACA,SAAS,WAAY,MAAwB,EAAE,MAAe;gBAC1D,OAAO,OAAO,QAAQ,CAAA;oBAClB,IAAI,QAAQ,KAAK;oBACjB,IAAI,QACA,QAAQ,CAAA,GAAA,kCAAW,EAAE,QAAQ;oBAEjC,OAAO;wBAAC,MAAM;wBAAG,MAAM;qBAAE;gBAC7B;YACJ;YAEA,IAAI,WAAW;YAEf,MAAM,kBAAkB,IAAI,CAAA,GAAA,gBAAM,EAAE;gBAChC,MAAM,CAAA,GAAA,cAAG,EAAE;gBACX,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,MAAM;gBACN,UAAU,CAAC;oBACP,WAAW,QAAQ;oBACnB,IAAI,UAAU;wBACV,aAAa,QAAQ,CAAA,OAAQ,KAAK,aAAa,MAAM,UAAU;wBAC/D,YAAY,QAAQ,CAAA,OAAQ,KAAK,aAAa,MAAM,UAAU;oBAClE,OAAO;wBACH,aAAa,QAAQ,CAAC,MAAM;4BACxB,WAAW,CAAC,MAAM,CAAC,SAAS,KAAK;wBACrC;wBACA,aAAa,QAAQ,CAAA,OAAQ,KAAK,aAAa,MAAM,UAAU;wBAC/D,YAAY,QAAQ,CAAA,OAAQ,KAAK,aAAa,MAAM,UAAU;oBAClE;oBACA;gBACJ;YACJ;YACA,OAAO,OAAO,gBAAgB;YAE9B,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,WAAW,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/D,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;gBACA,mBAAmB,CAAC;oBAChB,aAAa,QAAQ,CAAA,OAAQ,KAAK,aAAa;oBAC/C,YAAY,QAAQ,CAAA,OAAQ,KAAK,aAAa;gBAClD;YACJ;YACA,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,cAAc;gBACzB,UAAU;gBACV,YAAY;gBACZ,aAAa;YACjB;YAEA,QAAQ,aAAa,UACd,aAAa,IAAI,CAAA,OAAQ,KAAK,kBAC9B,YAAY,IAAI,CAAA,OAAQ,KAAK;YAEpC,OAAO,OAAO,QAAQ;YAGtB;YACA,OAAO,UAAU;gBACb,QAAQ;gBACR,QAAQ;gBACR,aAAa,QAAQ,CAAA,OAAQ,KAAK;gBAClC,YAAY,QAAQ,CAAA,OAAQ,KAAK;YACrC;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,QAAQ,WAAW;oBACnB,OAAO,WAAW;gBACtB;YACJ;QACJ;QAEA,WAAW,YAAY;QAEvB,OAAO;IACX;IAEA,OAAO,MAA6C;QAChD,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,MAAM,SAAS,OAAO,MAAM;QAC5B,MAAM,QAAQ,OAAO,MAAM;QAC3B,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,SAClC,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,gBAAgB,YAAY,QAAQ,OAAO,kBAAkB;QACpF,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAc;YAC/B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;AC7MA;;CAEC,GACD,6CAAa;AALb;AAKO,MAAM;IAOD,SAAgB;QACpB,IAAI,CAAC,QAAQ,UAAU,OAAO,qBAAqB,IAAI,CAAC,UAAU;QAClE,IAAI,CAAC,SAAS,UAAU,OAAO,qBAAqB,IAAI,CAAC,UAAU;IACvE;IAEA,mBAAmB;IACnB,YAAa,MAKZ,CAAE;QACC,IAAI,CAAC,QAAQ,OAAO;QAEpB,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,WAAW;QACf;QAEA,IAAI,CAAC,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,QAAQ,IAAI,CAAC;YACb,SAAS,OAAO;YAChB,WAAW;QACf;QACA,IAAI,CAAC,QAAQ,gBAAgB,IAAM;QAEnC,IAAI,CAAC,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ,IAAI,CAAC;YACb,SAAS,OAAO;YAChB,WAAW;QACf;QACA,IAAI,CAAC,SAAS,gBAAgB,IAAM;QAEpC,IAAI,CAAC;QAEL,IAAI,CAAC,QAAQ,UAAU;YACnB,IAAI,IAAI,CAAC,UAAU,GACf;YAEJ,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC;YACL,OAAO,SAAS,IAAI,CAAC;QACzB;QAEA,IAAI,CAAC,SAAS,UAAU;YACpB,IAAI,IAAI,CAAC,UAAU,GACf;YAEJ,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC;YACL,OAAO,SAAS,IAAI,CAAC;QACzB;IACJ;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;AACJ;;;;;ACrDA,oDAAa;AAdb;AAEA;AACA;AASA,MAAM,OAAO;AAEN,MAAM;IAMD,SAAgB;QACpB,MAAM,IAAI,CAAA,GAAA,kCAAW,EACjB,CAAA,GAAA,4CAAoB,EAAE,IAAI,CAAC,YAC3B,IAAI,CAAC;QAET,CAAA,GAAA,MAAC,EAAE,IAAI,IAAI,CAAC,QAAQ;YAChB,MAAM,AAAC,EAAE,IAAI,OAAO,IAAK;YACzB,KAAK,AAAC,EAAE,IAAI,OAAO,IAAK;QAC5B;IACJ;IAEA,uBAAuB;IACvB,YAAa,CAAwB,CAAE;QACnC,IAAI,CAAC,QAAQ;YAAC,GAAG,EAAE,KAAK;QAAA;QACxB,IAAI,CAAC,YAAY;YACb,GAAG;YACH,GAAG;YACH,OAAO;YACP,UAAU;QACd;QAEA,IAAI,CAAC,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,OAAO,OAAO;gBACd,QAAQ,OAAO;gBACf,iBAAiB;gBACjB,QAAQ;gBACR,cAAc,OAAO;gBACrB,UAAU;gBACV,QAAQ;gBACR,YAAY;gBACZ,aAAa;YACjB;QACJ;QAEA,IAAI,CAAC,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC1C,QAAQ,IAAI,CAAC;YACb,WAAW,CAAC;gBACR,MAAM;gBACN,IAAI,MAAM,WAAW,UAAU,MAAM,SAAS,eAAe;oBACzD,IAAI,CAAC,MAAM,KAAK,MAAM,KAAK,IAAI,CAAC,UAAU;oBAC1C,IAAI,CAAC,MAAM,KAAK,MAAM,KAAK,IAAI,CAAC,UAAU;oBAC1C,IAAI,CAAC;oBACL,EAAE,SAAS,IAAI,CAAC;gBACpB;YACJ;QACJ;IACJ;IAEA,aAAc,SAA6B,EAAQ;QAC/C,IAAI,KAAK,UAAU,IAAI,CAAC,eAAe,KAAK,UAAU,YAClD;QAEJ,IAAI,CAAC,YAAY;QACjB,IAAI,CAAC;IACT;IAEA,WAAuB;QACnB,OAAO,IAAI,CAAC;IAChB;IAEA,SAAU,CAAY,EAAQ;QAC1B,IAAI,CAAC,QAAQ;YAAC,GAAG,CAAC;QAAA;QAClB,IAAI,CAAC;IACT;IAEA,aAA2B;QACvB,OAAO,IAAI,CAAC;IAChB;IAEA,UAAiB;QACb,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,gBAAgB;IACzB;AACJ;;;;;kDC1Ea;AArBb;AACA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AAYO,MAAM,eAAe;IAExB,WAAW,MAA6B;QACpC,iBAAiB;QACjB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,UACD,OAAO;QAGX,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAS,SAAS,YAAY,SAAS,aAAa,KAAK,KAAI;QAC5E,MAAM,IAAI,SAAS,KAAK,IAAI,QAAQ,IAAI,SAAS,KAAK,IAAI;QAE1D,IAAI,gBAAgB,IAAI,SAAS;QACjC,MAAM,aAAa,SAAS,kBAAkB;QAG9C,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAqD;YACvD,SAAS;QACb;QACA,IAAI,WAAW,SAAS,YAAY,YAAY,SAAS;QAEzD,MAAM,WAAW,OAAO,UAAU,YAAY,OAAO;QAErD,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,YAAY;YAChB;QACJ;QACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,KAAK;gBACD,OAAO;gBACP,QAAQ;gBACR,YAAY;YAChB;QACJ;QACA,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,GAAG;YACrB,SAAS;YACT,KAAK;gBACD,UAAU;gBACV,OAAO;YACX;YACA,QAAQ;gBACJ,MAAM;gBACN,KAAK;gBACL,KAAK,KAAK;gBACV,OAAO,KAAK,SAAS;YACzB;QACJ;QACA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,SAAS;YACT,KAAK;gBACD,UAAU;gBACV,OAAO;YACX;YACA,QAAQ;gBACJ,MAAM;gBACN,KAAK;gBACL,KAAK,KAAK;gBACV,OAAO,KAAK,SAAS;YACzB;QACJ;QACA,WAAW,UAAU;YACjB,AAAC,IAAI,CAAS;YACd,eAAe;YACf;QACJ;QACA,YAAY,UAAU;YAClB,AAAC,IAAI,CAAS;YACd,gBAAgB;YAChB;QACJ;QACA,WAAW,WAAW;YAClB,eAAe;YACf;QACJ;QACA,YAAY,WAAW;YACnB,gBAAgB;YAChB;QACJ;QACA,aAAa,OAAO,CAAA,GAAA,cAAG,EAAE,WAAW,MAAM;QAC1C,cAAc,OAAO,CAAA,GAAA,cAAG,EAAE,YAAY,MAAM;QAC5C,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,KAAK;gBACD,YAAY,SAAS,CAAA,GAAA,4BAAW,IAAI;gBACpC,gBAAgB;YACpB;QACJ;QACA,aAAa,OAAO,cAAc;QAClC,MAAM,cAAc,IAAI;QACxB,YAAY,MAAM,CAAA,GAAA,4BAAW;QAC7B,YAAY,SAAS;QAErB,MAAM,YAAY,CAAA,GAAA,YAAI,EAAE;YACpB;gBACI,CAAA,GAAA,cAAG,EAAE,WAAW;gBAChB;gBACA;aACH;YACD;gBACI,CAAA,GAAA,MAAC,EAAE,GAAG;oBAAC,KAAK;wBAAC,QAAQ;oBAAK;gBAAC;gBAC3B;gBACA;aACH;YACD;gBACI,CAAA,GAAA,cAAG,EAAE,YAAY;gBACjB;aACH;SACJ,EAAE;YACC,OAAO;gBAAC,SAAS;YAAC;QACtB;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,WAAW;YACd,cAAc;QAClB;QAEA,OAAO,OAAO;QAEd,mBAAmB;QACnB,IAAI,gBAAgB,OAAO,eAAe;QAC1C,MAAM,QAAQ,SAAS,aAAa,SAAS;QAE7C,SAAS;YACL,YAAY,MAAM,UAAU,gBAAgB,KAAK;YACjD,IAAI,eAAe;gBACf,WAAW,QAAQ,KAAK,SAAS;gBACjC,YAAY,QAAQ,KAAK,SAAS;gBAClC;YACJ;QACJ;QAEA,IAAI,gBAAgB;QACpB,MAAM,oBAAoB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACnC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,CAAC;gBACjB,gBAAgB;gBAChB;YACJ;QACJ;QACA,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,OAAO;YACX;QACJ;QAGA,MAAM,kBAAkB,IAAI,CAAA,GAAA,cAAK,EAAE;YAC/B,aAAa;YACb,WAAW;gBACP;oBAAC;oBAAU,CAAA,GAAA,cAAG,EAAE;iBAAoB;gBACpC;oBAAC;oBAAa,CAAA,GAAA,cAAG,EAAE;iBAAuB;aAC7C;YACD,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,WAAW;YACX,UAAU;gBACN;YACJ;QACJ;QAEA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC3B,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,gBAAgB;gBAChB,cAAc;YAClB;QACJ;QACA,iBAAiB,OAAO,kBAAkB,cAAc,gBAAgB;QAExE,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QACnC,cAAc,MAAM,iBAAiB;QAGrC,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;QAG1B,SAAS;YACL,IAAI,gBAAgB,eAAe,UAAU;gBACzC,cAAc,MAAM,iBAAiB,gBAAgB,IAAI,cAAc;gBAEvE,cAAc,QAAQ,SAAS;gBAC/B,cAAc,SAAS,SAAS;gBAEhC,WAAW;gBACX,WAAW,wBAAwB;gBACnC,WAAW,UAAU,YAAY,GAAG;gBACpC,CAAA,GAAA,MAAC,EAAE,aAAa,eAAe,UAAU;gBACzC,WAAW;YAEf,OAAO;gBACH,cAAc,MAAM,iBAAiB;gBAErC,cAAc,QAAQ;gBACtB,cAAc,SAAS;gBACvB,WAAW;gBACX,WAAW,wBAAwB;gBACnC,WAAW,UAAU,YAAY,GAAG,GAAG,cAAc,OAAO,cAAc;gBAC1E,WAAW;YACf;QAEJ;QAEA,SAAS;YACL,IAAI,AAAC,WAAW,MAAM,WAAW,KAAK,gBAAkB,YAAY,MAAM,WAAW,KAAK,eAAgB;gBACtG,gBAAgB;gBAChB,eAAe;gBACf;YACJ;YACA,WAAW,QAAQ,KAAK,KAAK,IAAI,GAAG,SAAS,WAAW;YACxD,YAAY,QAAQ,KAAK,KAAK,IAAI,GAAG,SAAS,YAAY;YAC1D,IAAI,eAAe;gBACf,IAAI,eACA,WAAW,QAAQ,KAAK,SAAS,KAAM,SAAS,YAAY,SAAS;gBAEzE,IAAI,cACA,YAAY,QAAQ,KAAK,SAAS,KAAM,SAAS,WAAW,SAAS;gBAGzE,IAAI,SAAS,WAAW,SAAS,YAAY,SAAS,YAAY,SAAS,WAAW;oBAClF,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,SAAS,WAAW,QAAQ,SAAS,YAAY,QAAQ,UAAU,WAAW;oBACrG,WAAW,QAAQ,KAAK,SAAS,KAAK,IAAI;oBAC1C,YAAY,QAAQ,KAAK,SAAS,KAAK,IAAI;gBAC/C;YACJ;YAEA,IAAI,SAAS,WAAW,SAAS,UAC7B,WAAW,QAAQ,KAAK;YAE5B,IAAI,SAAS,YAAY,SAAS,WAC9B,YAAY,QAAQ,KAAK;YAG7B,gBAAgB;YAChB,eAAe;YAEf,WAAW,SAAS,WAAW;YAC/B,YAAY,SAAS,YAAY;YAEjC,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,QAAQ,UAAU,WAAW,KAAK,KAAK;YAC1D,MAAM,WAAW,SAAS,KAAK,QAAQ,QAAQ,WAAW,SAAS,KAAK,QAAQ;YAChF,gBAAgB,WAAW;YAE3B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,aAAa,CAAA,GAAA,yBAAW,EAAE,OAAO,CAAA,GAAA,yBAAW,EAAE,QAAQ,UAAU;YAElF;YAEA,cAAc,MAAM,QAAQ,KAAK,IAAI,GAAG,YAAY;YACpD,cAAc,MAAM,SAAS,KAAK,IAAI,GAAG,YAAY;YACrD,cAAc,MAAM,OAAO,OAAO,IAAI;YACtC,cAAc,MAAM,MAAM,OAAO,IAAI;YACrC,cAAc,MAAM,QAAQ,KAAK,IAAI,GAAG,YAAY;YACpD,cAAc,MAAM,SAAS,KAAK,IAAI,GAAG,YAAY;QACzD;QAEA,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,WAAW;YACX,KAAK;gBACD,OAAO,CAAA,GAAA,yBAAW,EAAE,QAAQ;gBAC5B,QAAQ,CAAA,GAAA,yBAAW,EAAE,SAAS;gBAC9B,YAAY;gBACZ,SAAS;gBACT,WAAW;gBACX,UAAU;gBACV,YAAY;YAChB;QACJ;QAEA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,QAAQ;YACR,SAAS;YACT,WAAW;YACX,KAAK;gBACD,OAAO,IAAI;gBACX,QAAQ,IAAI;gBACZ,UAAU;gBACV,UAAU;YACd;QACJ;QAEA,SAAS;YACL,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,SAAU,GAAG;gBACpC,eAAe,MAAM,aAAa,SAAS,MAAM;YACrD,GAAG,CAAA,GAAA,YAAI,EAAE;QACb;QACA,CAAA,GAAA,YAAI,EAAE,kBAAkB;QACxB;QAGA,OAAO,OAAO;QACd;QAEA,OAAO,UAAU;YACb,kBAAkB;YAClB,CAAA,GAAA,YAAI,EAAE,qBAAqB;QAC/B;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO;gBACH,OAAO;gBACP,QAAQ;gBACR,WAAW,gBAAgB;YAC/B;QACJ;QACA,OAAO;IACX;IAEA,OAAO,MAAwC;QAC3C,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,MAAM,QAAQ,OAAO,MAAM;QAC3B,MAAM,SAAS,OAAO,MAAM;QAC5B,MAAM,YAAY,OAAO,MAAM;QAC/B,IAAI,CAAC,YAAY,CAAC,SACd,OAAO;QAEX,QAAQ,MAAM;QACd,SAAS,OAAO,OAAO,QAAQ;QAC/B,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAS;YAC1B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;AChWA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,2BAA2B,MAAM,KAAK;;;;;kDCclG;AAdb;AAGA;AACA;AAUO,MAAM,eAAe;IAExB,WAAW,MAA6B;QACpC,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,UACD,OAAO;QAGX,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,SAAS,YAAY,SAAS,aAAa,KAAK,KAAK;QAC5E,MAAM,IAAI,SAAS,KAAK,IAAI,QAAQ,IAAI,SAAS,KAAK,IAAI;QAE1D,MAAM,gBAAgB,IAAI,SAAS;QACnC,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QAChC,WAAW,MAAM,UAAU;QAC3B,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY,UAAU,SAAS,kBAAkB,gBAAgB,GAAG,GAAG,GAAG;QAGjF,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAqD;YACvD,SAAS;QACb;QACA,IAAI,MAAM;QAEV,SAAS;YACL,cAAc,MAAM,YAAY,YAAY,MAAM;YAClD,IAAI,KAAK,IAAI,MAAM,SAAS,IAAI;gBAC5B,6CAA6C;gBAC7C,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,GAAG,GAAG,KAAK,KAAK;gBACvC,MAAM,QAAQ,SAAS,KAAK,IAAI,UAAU;gBAC1C,cAAc,MAAM,YAAY,YAAY,MAAM,gBAAgB,QAAQ;YAC9E;QACJ;QAEA,MAAM,UAAU,SAAS,cAAc;QACvC,QAAQ,YAAY;QACpB,MAAM,WAAW,SAAS,cAAc;QACxC,SAAS,YAAY;QACrB,SAAS,MAAM,cAAc;QAG7B,QAAQ,UAAU;YACd,OAAO;YACP;QACJ;QACA,SAAS,UAAU;YACf,OAAO;YACP;QACJ;QAEA,OAAO,OAAO,UAAU;QAExB,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,WAAW;YACX,KAAK;gBACD,OAAO,CAAA,GAAA,yBAAW,EAAE,QAAQ;gBAC5B,QAAQ,CAAA,GAAA,yBAAW,EAAE,SAAS;gBAC9B,SAAS;YACb;QACJ;QAEA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,GAAG;YACtB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,eAAe;YACnB;QACJ;QACA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,GAAG;YACxB,QAAQ;YACR,SAAS;YACT,WAAW;YACX,KAAK;gBACD,OAAO,IAAI;gBACX,QAAQ,IAAI;gBACZ,YAAY;gBACZ,aAAa;gBACb,UAAU;YACd;QACJ;QAGA,SAAS;YACL,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,SAAU,GAAG;gBACpC,cAAc,MAAM,aAAa,SAAS,MAAM;YACpD,GAAG,CAAA,GAAA,YAAI,EAAE;QACb;QACA,CAAA,GAAA,YAAI,EAAE,kBAAkB;QACxB;QAEA,cAAc,MAAM,aAAa;QAEjC,OAAO,OAAO;QACd;QAEA,OAAO,UAAU;YACb,CAAA,GAAA,YAAI,EAAE,qBAAqB;QAC/B;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO;gBACH,KAAK;YACT;QACJ;QACA,OAAO;IACX;IAEA,OAAO,MAAwC;QAC3C,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,YAAY,CAAC,SACd,OAAO;QAEX,QAAQ,MAAM;QACd,SAAS,OAAO,OAAO,MAAM;QAC7B,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAS;YAC1B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;qDC/Ga;AA5Bb;AACA;AACA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AAaO,MAAM,kBAAkB;IAE3B,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAwD;YAC1D,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,IAAI,OAAO,IAAI,WAAW;QAC1B,IAAI,oBAAuC;YAAC,SAAS,KAAO;QAAC;QAE7D,SAAS;YAEL,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;gBACtC,UAAU,QAAQ;gBAClB,UAAU,CAAC,UAAU;oBACjB,GAAG,aAAa,QAAQ;oBACxB,GAAG,aAAc,QAAQ;oBAEzB,MAAM,IAAI,CAAA,GAAA,4CAAoB,EAAE;oBAChC,MAAM,IAAI,CAAA,GAAA,kCAAW,EAAE,GAAG,GAAG;oBAC7B,MAAM,IAAI,CAAA,GAAA,kCAAW,EAAE,GAAG,GAAG;oBAC7B,OAAO,SAAS,gBAAgB,UAC5B,EAAE,GACF,EAAE,GACF,EAAE,GACF,EAAE,GACF,OAAO,UAAU,QACjB,WAAW,UAAU,QACvB;gBACN;YACJ;YAEA,SAAS;gBACL,QAAQ;YACZ;YAEA,4BAA4B;YAC5B,MAAM,KAAK,IAAI,CAAA,GAAA,8BAAa,EAAE;gBAC1B,OAAO;oBAAC,GAAG,QAAQ,OAAO,QAAQ;oBAAG,GAAG,QAAQ,OAAO,SAAS;gBAAC;gBACjE,UAAU;oBACN;gBACJ;YACJ;YACA,MAAM,KAAK,IAAI,CAAA,GAAA,8BAAa,EAAE;gBAC1B,OAAO;oBAAC,GAAG,IAAI,QAAQ,OAAO,QAAQ;oBAAG,GAAG,QAAQ,OAAO,SAAS;gBAAC;gBACrE,UAAU;oBACN;gBACJ;YACJ;YAEA,MAAM,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAChC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,WAAW;oBACX;gBACJ;YACJ;YACA,eAAe,aAAa,MAAM,eAAe;YACjD,OAAO,OAAO,eAAe;YAC7B,MAAM,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC5B,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,SAAU,GAAG;oBACnB,OAAO;oBACP;gBACJ;YACJ;YACA,WAAW,aAAa,MAAM,eAAe;YAC7C,OAAO,OAAO,WAAW;YAGzB,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YAEA,QAAQ;YACR,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,cAAc;gBACzB,UAAU;gBACV,YAAY;gBACZ,aAAa;YACjB;YAEA,QAAQ,aAAa,OAAO,GAAG,cAAc,GAAG;YAChD,OAAO,OAAO,QAAQ;YAEtB,OAAO,UAAU;gBACb,WAAW;gBACX,eAAe;gBACf,GAAG;gBACH,GAAG;gBACH,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,GAAG,GAAG;oBACN,GAAG,GAAG;oBACN,MAAM;oBACN,UAAU;gBACd;YACJ;QACJ;QAEA,WAAW,YAAY;QAGvB,OAAO;IACX;IAEA,OAAO,MAA2C;QAC9C,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,MAAM,IAAI,OAAO,MAAM;QACvB,MAAM,IAAI,OAAO,MAAM;QACvB,MAAM,OAAO,OAAO,MAAM;QAC1B,MAAM,WAAW,OAAO,MAAM;QAC9B,IAAI,CAAC,WAAW,CAAC,SACb,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,gBAAgB,UAAU,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,MAAM,UAAU,kBAAkB;QACvG,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAY;YAC7B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;qDC5La;AAzBb;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAYO,MAAM,kBAAkB;IAE3B,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAEtE,8CAA8C;QAC9C,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,aAAa;QAClC,IAAI,CAAC,WACD,OAAO;YAAE,OAAO,CAAA,GAAA,cAAG,EAAE;QAA0B;QAEnD,MAAM,gBAAgB;YAClB,GAAG,UAAU,IAAI,UAAU,QAAQ;YACnC,GAAG,UAAU,IAAI,UAAU,SAAS;YACpC,OAAO,UAAU;YACjB,QAAQ,UAAU;YAClB,UAAU;QACd;QAGA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAwD;YAC1D,SAAS;QACb;QACA,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,0BAAY,EAAE;QAGjC,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY;YACnC,QAAQ,SAAU,MAAM;gBACpB,IAAI,CAAA,GAAA,MAAC,EAAE,eAAe,OAClB;gBAGJ,IAAI,WAAW,QAAQ;oBACnB,OAAO,QAAQ,KAAM,CAAA,WAAW,OAAO,SAAS,CAAA;oBAChD;gBACJ;gBACA,IAAI,WAAW,SAAS;oBACpB,OAAO,QAAQ,KAAM,CAAA,WAAW,OAAO,SAAS,CAAA;oBAChD;gBACJ;gBACA,IAAI,WAAW,MAAM;oBACjB,OAAO,QAAQ,KAAM,CAAA,WAAW,OAAO,SAAS,CAAA;oBAChD;gBACJ;gBACA,IAAI,WAAW,QAAQ;oBACnB,OAAO,QAAQ,KAAM,CAAA,WAAW,OAAO,SAAS,CAAA;oBAChD;gBACJ;YACJ;QAEJ;QAEA,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE;QACvB,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE;QACxB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE;QACtB,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAO;QACtC,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAO;QACtC,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;QAAO;QACtC,YAAY,MAAM,QAAQ;QAC1B,YAAY,MAAM,SAAS;QAC3B,aAAa,MAAM,QAAQ;QAC3B,aAAa,MAAM,SAAS;QAC5B,aAAa,MAAM,UAAU;QAC7B,YAAY,MAAM,UAAU;QAC5B,WAAW,MAAM,UAAU;QAC3B,WAAW,MAAM,QAAQ;QACzB,WAAW,MAAM,SAAS;QAC1B,OAAO,OAAO;QACd,OAAO,OAAO;QACd,OAAO,OAAO;QACd,OAAO,MAAM,QAAQ;QACrB,OAAO,MAAM,QAAQ;QACrB,OAAO,MAAM,QAAQ;QACrB,OAAO,QAAQ;QACf,OAAO,QAAQ;QACf,OAAO,QAAQ;QACf,OAAO,UAAU;YACb,OAAO;YACP;QACJ;QACA,OAAO,UAAU;YACb,OAAO;YACP;QACJ;QACA,OAAO,UAAU;YACb,OAAO;YACP;QACJ;QACA,OAAO,WAAW;YACd;QACJ;QACA,OAAO,WAAW;YACd;QACJ;QACA,OAAO,WAAW;YACd;QACJ;QACA,OAAO,UAAU;YACb;QACJ;QACA,OAAO,UAAU;YACb;QACJ;QACA,OAAO,UAAU;YACb;QACJ;QACA,YAAY,OAAO,OAAO;QAC1B,aAAa,OAAO,OAAO;QAC3B,WAAW,OAAO,CAAA,GAAA,cAAG,EAAE,+BAA+B,MAAM;QAC5D,IAAI,CAAC,SAAS;YACV,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;gBACnB,QAAQ;gBACR,KAAK;oBACD,WAAW;gBACf;YACJ;YACA,SAAS,OAAO,aAAa,cAAc;QAC/C;QAEA,UAAU;QACV,MAAM,eAAe;YACjB,YAAY;YACZ,WAAW;QACf;QACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAI;YACrB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,UAAU;gBACV,YAAY;YAChB;QACJ;QACA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAI;YACpB,QAAQ;YACR,SAAS;YACT,SAAS,CAAA,GAAA,cAAG,EAAE,2BAA2B;YACzC,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,cAAc,QAAQ,CAAC,EAAE,OAAO,EAAE;YACtC;YACA,KAAK;QACT;QACA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAI;YACpB,QAAQ;YACR,SAAS;YACT,SAAS,CAAA,GAAA,cAAG,EAAE,2BAA2B;YACzC,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,cAAc,QAAQ,EAAE,OAAO,CAAC,EAAE;YACtC;YACA,KAAK;QACT;QACA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE,GAAI;YAC3B,QAAQ;YACR,SAAS;YACT,SAAS;YACT,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,EAAE,YAAY;gBACd,EAAE,YAAY;gBACd,cAAc,YAAY,EAAE;gBAC5B,OAAO,QAAQ,KAAK,KAAK,MAAM,EAAE;gBACjC;YACJ;YACA,KAAK;QACT;QACA,MAAM,mBAAmB,CAAA,GAAA,MAAC,EAAE,GAAI;YAC5B,QAAQ;YACR,SAAS;YACT,SAAS;YACT,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,EAAE,YAAY;gBACd,EAAE,YAAY;gBACd,cAAc,YAAY,EAAE;gBAC5B,OAAO,QAAQ,KAAK,KAAK,MAAM,EAAE;gBACjC;YACJ;YACA,KAAK;QACT;QACA,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAI;YAC1B,QAAQ;YACR,SAAS;YACT,SAAS;YACT,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,IAAI,kBAAkB,YAClB,cAAc,QAAQ,cAAc,aAAa,EAAE,SAAS,GAAG,EAAE,SAAS;qBAE1E,cAAc,QAAQ,EAAE,QAAQ,GAAG,EAAE,SAAS;YAEtD;YACA,KAAK;QACT;QACA,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAI;YACxB,QAAQ;YACR,SAAS;YACT,SAAS;YACT,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,cAAc,QAAQ,KAAK,MAAM,EAAE,QAAQ,IAAI,KAAK,MAAM,EAAE,SAAS;YACzE;YACA,KAAK;QACT;QACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAI;YACrB,QAAQ;YACR,SAAS;YACT,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,SAAS;gBACL,MAAM,IAAI,cAAc;gBACxB,cAAc,OAAO;oBAAE,GAAG,QAAQ,OAAO,QAAQ;oBAAG,GAAG,QAAQ,OAAO,SAAS;gBAAE;gBACjF,cAAc,YAAY,EAAE;gBAC5B;YACJ;YACA,KAAK;QACT;QAMA,IAAI,gBAAgB;QACpB,MAAM,oBAAoB,IAAI,CAAA,GAAA,kBAAO,EAAE;YACnC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,CAAC;gBACjB,gBAAgB;gBAChB,cAAc,iBAAiB;YACnC;YACA,KAAK;gBACD,SAAS;YACb;QACJ;QACA,IAAI,aAAa;QACjB,MAAM,mBAAmB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAClC,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,CAAC;gBACjB,aAAa;gBACb,cAAc,YAAY;YAC9B;YACA,KAAK;gBACD,SAAS;gBACT,YAAY;YAChB;QACJ;QACA,MAAM,kBAAkB,CAAA,GAAA,MAAC,EAAE;QAC3B,gBAAgB,OAAO,kBAAkB,cAAc,iBAAiB;QAExE,OAAO,OAAO,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,KAAK;gBACD,OAAO;gBACP,QAAQ;YACZ;QACJ;QAEA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,GAAG;YACpB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,gBAAgB;gBAChB,YAAY;gBACZ,cAAc;YAClB;QACJ;QAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,cAAK,EAAE;YAC/B,aAAa;YACb,WAAW;gBACP;oBAAC;oBAAU,CAAA,GAAA,cAAG,EAAE;iBAAoB;gBACpC;oBAAC;oBAAa,CAAA,GAAA,cAAG,EAAE;iBAAuB;aAC7C;YACD,WAAW;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;gBACN,cAAc;YAClB;QACJ;QACA,UAAU,OAAO,iBAAiB,gBAAgB;QAElD,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,QAAQ,OAAO,OAAO,QAAQ,OAAO;QACrE,MAAM,kBAAqD,EAAE;QAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;YACjB,OAAO,MAAM,qBAAqB,gBAAgB,MAAM,CAAC,EAAE,CAAC,QAAQ;YACpE,WAAW,MAAM,CAAC,EAAE,CAAC;YACrB,SAAS,MAAM,CAAC,EAAE,CAAC;YACnB,YAAY,MAAM,CAAC,EAAE,CAAC;YACtB,aAAa;QACjB;QAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;YACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;YACzB,SAAS;gBACL,OAAO,QAAQ,OAAO;gBACtB,QAAQ,QAAQ,OAAO;gBACvB,QAAQ;YACZ;YACA,aAAa;YACb,cAAc,CAAC;gBACX,cAAc,aAAa,MAAM,gBAAgB,MAAM,SAAS,KAAK;gBACrE,cAAc,aAAa,MAAM,UAAU,MAAM,SAAS,KAAK;YACnE;YACA,mBAAmB,CAAC;gBAChB,cAAc,qBAAqB;YACvC;YACA,SAAS;QACb;QACA,QAAQ;QACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;YACnC,UAAU;YACV,YAAY;YACZ,aAAa;QACjB;QACA,OAAO,OAAO,QAAQ;QAGtB,IAAI,wBAAwB;QAC5B,SAAS,cAAe,UAAmB,KAAK;YAC5C,IAAI,CAAC,eACD;YAEJ,MAAM,YAAY,cAAc;YAChC,IAAI,KAAK,UAAU,eAAe,yBAAyB,CAAC,SACxD;YAEJ,wBAAwB,KAAK,UAAU;YAEvC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YACnB,IAAI;YACJ,IAAI,UAAU,GAAG,GAAG,cAAc,OAAO,cAAc;YACvD,CAAA,GAAA,MAAC,EAAE,+BACC,KACA,MAAM,CAAC,mBAAmB,CAAC,QAAQ,QACnC,WACA,WACA,gBAAgB,eAAe,eAC/B,CAAA,GAAA,MAAC,EAAE,mBAAmB,WAAW,UAAU,QAAQ,cAAc,OAAO,UAAU,SAAS,cAAc;YAE7G,IAAI;YACJ,QAAQ;QACZ;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,4BAAY,EAAE;YACpC,GAAG,cAAc;YACjB,GAAG,cAAc;YACjB,OAAO,cAAc;YACrB,QAAQ,cAAc;YACtB,UAAU,cAAc;YACxB,eAAe;YACf,OAAO;gBAAC;gBAAG,QAAQ,OAAO;aAAM;YAChC,OAAO;gBAAC;gBAAG,QAAQ,OAAO;aAAO;YACjC,UAAU,SAAU,CAAC;gBACjB,OAAO,QAAQ,KAAK,KAAK,MAAM,EAAE,IAAI,cAAc;gBACnD,OAAO,QAAQ,KAAK,KAAK,MAAM,EAAE,IAAI,cAAc;gBACnD,OAAO,QAAQ,KAAK,KAAK,MAAM,EAAE;gBACjC;YACJ;YACA,mBAAmB,QAAQ;QAC/B;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,cAAc;YAC/B,UAAU;YACV,MAAM;YACN,KAAK;QACT;QACA,QAAQ,aAAa,OAAO,cAAc;QAE1C,SAAS;YACL,cAAc,OAAO;gBACjB,GAAG,SAAS,OAAO,SAAS,cAAc;gBAC1C,GAAG,SAAS,OAAO,SAAS,cAAc;YAAC;YAE/C,cAAc,YAAY,SAAS,OAAO;YAC1C;QACJ;QAEA;QAEA,OAAO,UAAU;YACb,YAAY;YACZ,cAAc;YACd,kBAAkB;YAClB,iBAAiB;YACjB,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,CAAA,GAAA,MAAC,EAAE,UAAU;YACb,QAAQ;YACR,CAAA,GAAA,MAAC,EAAE,WAAW;QAClB;QACA,OAAO,WAAW;YACd,MAAM,YAAY,cAAc;YAChC,MAAM,QAA+B;gBACjC;gBACA,QAAQ;gBACR,aAAa,gBAAgB,eAAe,eACxC,CAAA,GAAA,MAAC,EAAE,mBAAmB,WAAW,UAAU,QAAQ,cAAc,OAAO,UAAU,SAAS,cAAc;YACjH;YACA,OAAO;YACP,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;QACtB;QACA,OAAO;IACX;IAEA,OAAO,MAA2C;QAC9C,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,SACb,OAAO;QAEX,QAAQ,MAAM;QAEd,MAAM,QAAQ,OAAO;QAErB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,WAAW,QAAQ;QACzC,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,CAAA,GAAA,MAAC,EAAE,+BACC,SACA,YACA,MAAM,WACN,MAAM,QACN,MAAM;QAGV,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAY;YAC7B,QAAQ;YACR,QAAQ;gBAAC;oBAAC;gBAAK;aAAE;QACrB;QACA,OAAO;IACX;AAEJ;;;;;gDCvca;AAvBb;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAWO,MAAM,aAAa;IAEtB,WAAW,MAA6B;QACpC,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,YAAY,CAAC,SACd,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAmD;YACrD,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,IAAI,SAAS;QACb,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC,UAAU;gBACjB,OAAO,SAAS,gBAAgB,aAAa,SAAS,UAAU,QAAQ;YAC5E;QACJ;QAGA,SAAS;YAEL,MAAM,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,CAAC;oBACP,SAAS;oBACT,QAAQ;gBACZ;YACJ;YACA,aAAa,aAAa,MAAM,eAAe;YAC/C,OAAO,OAAO,aAAa;YAE3B,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YACA,QAAQ;YACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;gBACnC,YAAY;gBACZ,aAAa;YACjB;YACA,OAAO,OAAO,QAAQ;YAEtB,OAAO,UAAU;gBACb,aAAa;gBACb,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,QAAQ;gBACZ;YACJ;QACJ;QAEA,WAAW,YAAY;QAEvB,OAAO;IACX;IAEA,OAAO,MAAsC;QACzC,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,MAAM,SAAS,OAAO,MAAM;QAC5B,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,SACxB,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,gBAAgB,aAAa,QAAQ,kBAAkB;QAC9E,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAO;YACxB,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;uDC5Ha;AAtBb;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAWO,MAAM,oBAAoB;IAE7B,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAA0D;YAC5D,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,IAAI,SAAS,GAAG,WAAW;QAC3B,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC,UAAU;gBACjB,OAAO,SAAS,YAAY,SAAS,UAAU,QAAQ;YAC3D;QACJ;QAEA,SAAS;YAEL,SAAS;gBACL,QAAQ;YACZ;YAEA,MAAM,eAAe,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC9B,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,yBAAyB;gBACzB,UAAU,SAAU,GAAG;oBACnB,SAAS;oBACT;gBACJ;gBACA,OAAO;oBAAC;wBAAC;wBAAG;qBAAE;oBAAE;wBAAC;wBAAK;qBAAE;oBAAE;wBAAC;wBAAK;qBAAG;oBAAE;wBAAC;wBAAG;qBAAI;iBAAC;YAClD;YACA,MAAM,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAChC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,yBAAyB;gBACzB,UAAU,SAAU,GAAG;oBACnB,WAAW,MAAM;oBACjB;gBAEJ;gBACA,OAAO;oBAAC;wBAAC;wBAAG;qBAAE;oBAAE;wBAAC;wBAAK;qBAAE;oBAAE;wBAAC;wBAAK;qBAAG;oBAAE;wBAAC;wBAAG;qBAAG;iBAAC;YACjD;YACA,aAAa,aAAa,MAAM,eAAe;YAC/C,eAAe,aAAa,MAAM,eAAe;YACjD,OAAO,OAAO,aAAa;YAC3B,OAAO,OAAO,eAAe;YAE7B,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YACA;YACA,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,QAAE,EAAE;gBACnC,YAAY;gBACZ,aAAa;YACjB;YACA,OAAO,OAAO,QAAQ;YAEtB,OAAO,UAAU;gBACb,aAAa;gBACb,eAAe;gBACf,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,QAAQ;oBACR,UAAU;gBACd;YACJ;QACJ;QAEA,WAAW,YAAY;QAEvB,OAAO;IACX;IAGA,OAAO,MAA6C;QAChD,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,MAAM,SAAS,OAAO,MAAM;QAC5B,MAAM,WAAW,OAAO,MAAM;QAC9B,IAAI,CAAC,WAAW,WAAW,QAAQ,aAAa,QAAQ,CAAC,SACrD,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,YAAY,QAAQ,UAAU;QACrD,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAc;YAC/B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;mDCnJa;AAvBb;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAWO,MAAM,gBAAgB;IAEzB,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,SAAS,cAAc,QAAQ;QAE1D,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAsD;YACxD,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,SAAS;YAEL,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;gBAC5C,UAAU,QAAQ;gBAClB,UAAU,CAAC;oBACP,OAAO,SAAS,QAAQ,aAAa,sBAAsB;gBAC/D;YACJ;YAEA,SAAS;YACT,IAAI,WAAW;YACf,MAAM,gBAAgB,IAAI,CAAA,GAAA,gBAAM,EAAE;gBAC9B,WAAW;oBACP;wBACI,IAAI;wBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBAChB;oBACA;wBACI,IAAI;wBACJ,OAAO,CAAA,GAAA,cAAG,EAAE;oBAChB;iBACH;gBACD,QAAQ;gBACR,UAAU,SAAU,EAAE;oBAClB,WAAW;oBACX,QAAQ;gBACZ;YACJ;YACA,OAAO,OAAO,cAAc;YAE5B,QAAQ;YACR,IAAI,kBAAgC;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YAC3D,MAAM,kBAAkB;gBACpB;gBACA;oBAAC,GAAG;oBAAG,GAAG;oBAAG,GAAG;oBAAG,GAAG;gBAAC;gBACvB;oBAAC,GAAG;oBAAK,GAAG;oBAAK,GAAG;oBAAK,GAAG;gBAAC;gBAC7B;oBACI,GAAG,OAAO,gBAAgB;oBAC1B,GAAG,OAAO,gBAAgB;oBAC1B,GAAG,OAAO,gBAAgB;oBAC1B,GAAG;gBACP;gBACA;oBACI,GAAG,OAAO,kBAAkB;oBAC5B,GAAG,OAAO,kBAAkB;oBAC5B,GAAG,OAAO,kBAAkB;oBAC5B,GAAG;gBACP;aACH;YAED,MAAM,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;gBAClC,OAAO,CAAA,GAAA,cAAG,EAAE;gBACZ,UAAU;gBACV,cAAc;gBACd,UAAU,SAAU,OAAO;oBACvB,kBAAkB;oBAClB,QAAQ;gBACZ;YACJ;YACA,aAAa,aAAa,MAAM,YAAY;YAC5C,aAAa,aAAa,MAAM,eAAe;YAC/C,OAAO,OAAO,aAAa;YAG3B,MAAM,kBAAqD,EAAE;YAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;gBACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;gBAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;gBACrB,SAAS,MAAM,CAAC,EAAE,CAAC;gBACnB,YAAY,MAAM,CAAC,EAAE,CAAC;gBACtB,aAAa;YACjB;YAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;gBACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;gBACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;gBACzB,SAAS;oBACL,OAAO,QAAQ,OAAO;oBACtB,QAAQ,QAAQ,OAAO;oBACvB,QAAQ;gBACZ;YACJ;YACA,QAAQ;YACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;gBACnC,YAAY;gBACZ,aAAa;YACjB;YACA,OAAO,OAAO,QAAQ;YAEtB,OAAO,UAAU;gBACb,cAAc;gBACd,aAAa;gBACb,kBAAkB;gBAClB,QAAQ;YACZ;YACA,OAAO,WAAW;gBACd,OAAO;gBACP,OAAO;oBACH,UAAU;oBACV,iBAAiB;gBACrB;YACJ;QACJ;QAEA,WAAW,YAAY;QAEvB,OAAO;IACX;IAGA,OAAO,MAAyC;QAC5C,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO,MAAM;QAC9B,MAAM,kBAAkB,OAAO,MAAM;QACrC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAC1B,OAAO;QAEX,QAAQ,MAAM;QACd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,QAAQ,aAAa,sBAAsB,iBAAiB;QACnF,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QACR,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAU;YAC3B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;gDClKa;AAzBb;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAcO,MAAM,aAAa;IAEtB,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAEtE,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAmD;YACrD,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,MAAM,cAAgC;YAClC,GAAG;YACH,GAAG;YACH,WAAW;YACX,OAAO;YACP,SAAS;QACb;QAEA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,YAAY;YAChB;QACJ;QACA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,WAAW;gBACX,cAAc;YAClB;QACJ;QACA,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;YACjB,MAAM;YACN,MAAM;YACN,KAAK;YACL,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU,SAAU,CAAC;gBACjB,YAAY,IAAI,WAAW;gBAC3B;YACJ;QACJ;QACA,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;YACjB,MAAM;YACN,MAAM;YACN,KAAK;YACL,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU,SAAU,CAAC;gBACjB,YAAY,IAAI,WAAW;gBAC3B;YACJ;QACJ;QACA,MAAM,iBAAiB,CAAA,GAAA,YAAI,EAAE;YACzB,MAAM,YAAY;YAClB,MAAM;YACN,KAAK;YACL,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU,SAAU,CAAC;gBACjB,YAAY,YAAY,WAAW;gBACnC;YACJ;QACJ;QAEA,IAAI,kBAAkB;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC;QAC7C,MAAM,kBAAkB;YACpB;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YACvB;gBAAC,GAAG;gBAAK,GAAG;gBAAK,GAAG;gBAAK,GAAG;YAAC;SAChC;QACD,gBAAgB,KAAK;YACjB,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,gBAAgB;YAC1B,GAAG;QACP;QACA,gBAAgB,KAAK;YACjB,GAAG,OAAO,kBAAkB;YAC5B,GAAG,OAAO,kBAAkB;YAC5B,GAAG,OAAO,kBAAkB;YAC5B,GAAG;QACP;QACA,YAAY,QAAQ,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS;QAE/C,MAAM,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YAClC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,OAAO;gBACvB,kBAAkB;gBAClB,YAAY,QAAQ,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS;gBAC/C;YACJ;QACJ;QAEA,MAAM,aAAa;YACf,SAAS;YACT,aAAa;QACjB;QACA,MAAM,OACF,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;YAAM,KAAK;QAAU,IACrC,QACA,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;YAAM,KAAK;QAAU,IACrC;QAEJ,MAAM,OACF,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS,CAAA,GAAA,cAAG,EAAE,sBAAsB;YAAK,KAAK;QAAU,IAC/D,gBACA,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,KAAI;gBAAC,UAAU;YAAG;QAAC,IAC1B,aAAa;QAGjB,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,QAAQ,OAAO,OAAO,QAAQ,OAAO;QACrE,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;QAC1B,MAAM,kBAAkB,OAAO,IAAI,CAAC,MAAM;YACtC,OAAO;gBACH,OAAO,MAAM,qBAAqB,gBAAgB,KAAK,QAAQ;gBAC/D,WAAW,KAAK;gBAChB,SAAS,KAAK;gBACd,YAAY,KAAK;gBACjB,aAAa;YACjB;QACJ;QAEA,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;YACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;YACzB,SAAS;gBACL,OAAO,QAAQ,OAAO;gBACtB,QAAQ,QAAQ,OAAO;gBACvB,QAAQ;YACZ;QACJ;QAEA,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;YACnC,YAAY;YACZ,aAAa;QACjB;QACA,OAAO,OAAO,QAAQ;QAEtB,SAAS;YACL,MAAM,MAAM;YACZ,IAAI;YACJ,IAAI,UAAU,GAAG,GAAG,cAAc,OAAO,cAAc;YACvD,IAAI,UAAU,QAAQ,QAAQ,GAAG;YACjC,CAAA,GAAA,kBAAO,EAAE,KAAK,YAAY,GAAG,YAAY,GAAG,KAAK,IAAI,YAAY,WAAW,IAAI,YAAY,OAAO,YAAY;YAC/G,IAAI;YACJ,QAAQ;QACZ;QACA;QACA,QAAQ;QAGR,OAAO,UAAU;YACb,QAAQ;YACR,CAAA,GAAA,MAAC,EAAE,WAAW;YACd,aAAa;QACjB;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;QACtB;QACA,OAAO;IACX;IAEA,OAAO,MAAsC;QACzC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAC1B,OAAO;QAGX,QAAQ,MAAM;QACd,CAAA,GAAA,kBAAO,EACH,SACA,OAAO,MAAM,GACb,OAAO,MAAM,GACb,OAAO,MAAM,WACb,OAAO,MAAM,OACb,OAAO,MAAM;QAEjB,QAAQ,MAAM;QAEd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAO;YACxB,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;ACpOA,uCAAuC;;;AAEvC,8CAAgB;AAAT,SAAS,SACZ,GAA6B,EAC7B,MAAc,EACd,MAAc,EACd,SAAiB,EACjB,KAAa,EACb,OAAe;IAEf,IAAI;IACJ,MAAM,IAAI,IAAI,OAAO;IACrB,MAAM,IAAI,IAAI,OAAO;IACrB,YAAY,KAAK,MAAM;IACvB,MAAM,eAAe,YAAY,MAAM;IAEvC,IAAI;IACJ,IAAI,YAAY;IAChB,IAAI,cAAc;IAClB,IAAI,cAAc;IAElB,IAAI,IAAI,IAAI,GAAG,IAAI,SAAS,GAAG,IAAK;QAChC,MAAM,KAAK,IAAK;QAChB,IAAI,MAAM,KAAM,CAAA,IAAI,CAAA;QACpB,IAAI,cACA,MAAM,KAAK,MAAM;aAEjB,MAAM,KAAK,MAAM,MAAM,OAAO;QAElC,IAAI,OAAO,KAAK;QAChB,IAAI,OAAO,KAAK;IAEpB;IACA,IAAI,IAAI,IAAI,GAAG,IAAI,SAAS,GAAG,IAAK;QAChC,MAAM,KAAK,IAAK;QAChB,IAAI,MAAM,KAAM,CAAA,IAAI,CAAA;QACpB,IAAI,cACA,MAAM,KAAK,MAAM;aAEjB,MAAM,KAAK,MAAM,MAAM,OAAO;QAGlC,IAAI,OAAO,GAAG;QACd,IAAI,OAAO,GAAG;IAClB;IAEA,IAAI;IACJ,IAAI;AACR;;;;;iDCwDa;AAzGb;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAwCA,MAAM,YAA4B;IAC9B,0BAA0B;IAC1B;QAAC,MAAM;QAAG,QAAQ;QAAG,QAAQ;QAAG,SAAS;QAAG,SAAS;QAAG,SAAS;QAAG,SAAS;QAAG,OAAO;QAAG,YAAY;QAAG,UAAU;QAAG,YAAY;IAAI;IAEtI,QAAQ;IACR;QAAC,MAAM;QAAG,QAAQ;QAAK,QAAQ;QAAK,SAAS;QAAK,SAAS;QAAI,SAAS;QAAG,SAAS;QAAG,OAAO;QAAG,YAAY;QAAO,UAAU;QAAM,YAAY;IAAI;IAEpJ,aAAa;IACb;QAAC,MAAM;QAAG,QAAQ;QAAK,QAAQ;QAAK,SAAS;QAAM,SAAS;QAAM,SAAS;QAAG,SAAS;QAAI,OAAO;QAAI,YAAY;QAAQ,UAAU;QAAG,YAAY;IAAK;IAExJ,oCAAoC;IACpC;QAAC,MAAM;QAAG,QAAQ;QAAI,QAAQ;QAAI,SAAS;QAAG,SAAS;QAAG,SAAS;QAAG,SAAS;QAAG,OAAO;QAAG,YAAY;QAAG,UAAU;QAAG,YAAY;IAAK;IAEzI,yBAAyB;IACzB;QAAC,MAAM;QAAG,QAAQ;QAAI,QAAQ;QAAI,SAAS;QAAK,SAAS;QAAK,SAAS;QAAG,SAAS;QAAG,OAAO;QAAG,YAAY;QAAM,UAAU;QAAG,YAAY;IAAI;IAE/I,QAAQ;IACR;QAAC,MAAM;QAAG,QAAQ;QAAM,QAAQ;QAAM,SAAS;QAAK,SAAS;QAAM,SAAS;QAAG,SAAS;QAAI,OAAO;QAAQ,YAAY;QAAM,UAAU;QAAG,YAAY;IAAI;IAE1J,sBAAsB;IACtB;QAAC,MAAM;QAAG,QAAQ;QAAI,QAAQ;QAAI,SAAS;QAAM,SAAS;QAAM,SAAS;QAAG,SAAS;QAAI,OAAO;QAAG,YAAY;QAAQ,UAAU;QAAG,YAAY;IAAI;IAEpJ,gBAAgB;IAChB;QAAC,MAAM;QAAG,QAAQ;QAAI,QAAQ;QAAI,SAAS;QAAM,SAAS;QAAM,SAAS;QAAG,SAAS;QAAG,OAAO;QAAM,YAAY;QAAG,UAAU;QAAG,YAAY;IAAK;CACrJ;AAED,SAAS,UAAW,QAAmB,EAAE,QAAwB;IAC7D,SAAS,MACL,SAAS,MACT,SAAS,MACT;QAAC,SAAS;QAAQ,SAAS;KAAO,EAClC;QAAC,SAAS,QAAQ;QAAG,SAAS,SAAS;KAAE,EACzC,SAAS,SACT,SAAS,SACT,SAAS,OACT,SAAS,YACT,SAAS,UACT,SAAS,YACT,SAAS,MACT,SAAS,MACT,SAAS,WAAW,SAAS,WAAW,OAC1C;AACN;AAGO,MAAM,cAAc;IAEvB,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAEtE,MAAM,cAAkC,EAAE;QAC1C,MAAM,YAAY;QAClB;YACI,MAAM,WAAW,CAAA,GAAA,iBAAU,EAAE,CAAA,GAAA,qBAAU;YACvC,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,WAAW;YACpC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YACnB,MAAM,UAAU,SAAS,QAAQ;YACjC,SAAS,KAAK,SAAS,UAAU,uBAAuB;YACxD,QAAQ;YAER,UAAU,QAAQ,CAAC;gBACf,MAAM,WAAW,IAAI;gBACrB,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,QAAQ;gBAC9B,WAAW,UAAU;gBACrB,WAAW,UAAU;gBACrB,UAAU,UAAU;gBACpB,IAAI,UAAU,UAAU,GAAG;gBAC3B,SAAS,MAAM,OAAO,UAAU;gBAChC,YAAY,KAAK;YACrB;YAEA,QAAQ;QACZ;QAEA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAAoD;YACtD,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,MAAM,cAAiC;YACnC,MAAM,KAAK,WAAW;YACtB,aAAa;YACb,OAAO;YACP,SAAS;YACT,YAAY;YACZ,UAAU;YACV,YAAY;YACZ,MAAM;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YACvB,MAAM;gBAAC,GAAG;gBAAK,GAAG;gBAAK,GAAG;YAAG;QACjC;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,gBAAM,EAAE;YAC9B,WAAW,YAAY,IAAI,CAAC,KAAK;gBAC7B,CAAA,GAAA,MAAC,EAAE,IAAI,KAAK;oBACR,QAAQ;oBACR,cAAc;oBACd,YAAY;gBAChB;gBACA,OAAO;oBACH,IAAI,KAAK;oBACT,OAAO;gBACX;YACJ;YACA,QAAQ;YACR,UAAU,CAAC;gBACP,YAAY,cAAc,OAAO;gBACjC;YACJ;QACJ;QACA,cAAc,aAAa,MAAM,eAAe;QAChD,OAAO,OAAO,cAAc;QAE5B,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,YAAY;YACnB,YAAY,CAAA,GAAA,yBAAS;YACrB,OAAO,CAAA,GAAA,MAAC,EAAE,qBAAqB,GAAG,MAAM;YACxC,UAAU,CAAC;gBACP,YAAY,QAAQ;gBACpB;YACJ;QACJ;QACA,YAAY,aAAa,MAAM,eAAe;QAE9C,MAAM,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,YAAY;YACnB,YAAY,CAAA,GAAA,yBAAS;YACrB,SAAS,CAAC,eAAiB,eAAe;YAC1C,gBAAgB,CAAC,QAAU,QAAQ;YACnC,UAAU,CAAC;gBACP,YAAY,UAAU;gBACtB;YACJ;QACJ;QACA,cAAc,aAAa,MAAM,eAAe;QAEhD,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,cAAc;YAClB;QACJ;QAEA,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,GAAG;YACjB,KAAK;gBACD,SAAS;gBACT,cAAc;YAClB;QACJ;QAEA,MAAM,kBAAkB,IAAI,CAAA,GAAA,gBAAM,EAAkB;YAChD,WAAW;gBACP;oBAAC,IAAI;oBAAO,OAAO;gBAAK;gBACxB;oBAAC,IAAI;oBAAS,OAAO,CAAA,GAAA,cAAG,EAAE;gBAAqB;aAClD;YACD,QAAQ;YACR,UAAU,CAAC;gBACP,YAAY,WAAW;gBACvB,IAAI,OAAO,OACP,OAAO,MAAM,aAAa;qBAE1B,OAAO,MAAM,aAAa;gBAE9B;YACJ;QACJ;QAEA,MAAM,gBAAgB,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC/B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,YAAY,aAAa;gBACzB;YACJ;YACA,UAAU;QACd;QAEA,MAAM,WAAqC;YACvC;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACH;QAED,MAAM,cAAc,IAAI,CAAA,GAAA,cAAK,EAAE;YAC3B,aAAa;YACb,WAAW,SAAS,IAAI,CAAA;gBACpB,OAAO,OAAQ;oBAAC;oBAAM,CAAA,GAAA,oCAAgB,EAAE;iBAAM,GAA0B;YAC5E;YACA,WAAW,YAAY;YACvB,UAAU,CAAC;gBACP,YAAY,aAAa;gBACzB;YACJ;QACJ;QACA,YAAY,aAAa,QAAQ,CAAA,GAAA,cAAG,EAAE;QAEtC,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,GAAG;YACvB,KAAK;gBACD,SAAS;YACb;QACJ;QAEA,MAAM,gBAAgB;YAClB,OAAO;YACP,QAAQ;YACR,aAAa;QACjB;QACA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM;YACvB,MAAM;YACN,MAAM,MAAM,CAAA,GAAA,qBAAa,EAAE,YAAY,YAAY;YACnD,UAAU,CAAC;gBACP,MAAM,WAAW,CAAA,GAAA,qBAAa,EAAE,SAAS;gBACzC,IAAI,UAAU;oBACV,YAAY,OAAO;oBACnB;gBACJ;YACJ;YACA,KAAK;QACT;QAEA,MAAM,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM;YACvB,MAAM;YACN,MAAM,MAAM,CAAA,GAAA,qBAAa,EAAE,YAAY,YAAY;YACnD,UAAU,CAAC;gBACP,MAAM,WAAW,CAAA,GAAA,qBAAa,EAAE,SAAS;gBACzC,IAAI,UAAU;oBACV,YAAY,OAAO;oBACnB;gBACJ;YACJ;YACA,KAAK;QACT;QAEA,aAAa,OACT,WACA;QAIJ,OAAO,OACH,gBAAgB,cAChB,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,KAAI;gBAAC,UAAU;YAAG;QAAC,IAC1B,cAAc;QAGlB,OAAO,OACH,YAAY,cACZ,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,KAAI;gBAAC,UAAU;YAAG;QAAC,IAC1B;QAGJ,OAAO,OACH,YAAY,cACZ,cAAc,cACd,QACA;QAMJ,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC,UAAU;gBACjB,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,QAAQ,SAAS,CAAC,YAAY,YAAY;gBAClE,aAAa,OAAO,YAAY;gBAChC,aAAa,SAAS,aAAa,SAAU,YAAY,QAAQ,KAAK,UAAU;gBAChF,aAAa,SAAS,aAAa,SAAU,YAAY,QAAQ,KAAK,UAAU;gBAChF,aAAa,OAAO,YAAY;gBAChC,aAAa,OAAO,YAAY;gBAChC,aAAa,aAAa,YAAY,aAAa,CAAC,aAAa,aAAa,aAAa;gBAC3F,aAAa,WAAY,YAAY;gBACrC,aAAa,UAAU,QAAQ,OAAO,QAAQ,IAAI,UAAU,SAAS,UAAU;gBAC/E,aAAa,UAAU,QAAQ,OAAO,SAAS,IAAI,UAAU,SAAS,UAAU;gBAEhF,OAAO,SAAS,MACZ,aAAa,MACb,aAAa,MACb;oBAAC,aAAa;oBAAQ,aAAa;iBAAO,EAC1C;oBAAC,aAAa;oBAAS,aAAa;iBAAQ,EAC5C,aAAa,SACb,aAAa,SACb,aAAa,OACb,aAAa,YACb,aAAa,UACb,aAAa,YACb,aAAa,MACb,aAAa,MACb,aAAa,WAAW,aAAa,WAAW;YAExD;YACA,SAAS;gBACL,SAAS,YAAY;gBACrB,WAAW,YAAY,aAAa,UAAU,oBAAoB,YAAY;YAClF;QACJ;QAEA,MAAM,kBAAqD,EAAE;QAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;YACjB,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,MAAM,CAAC,EAAE,CAAC,QAAQ;YAC/E,WAAW,MAAM,CAAC,EAAE,CAAC;YACrB,SAAS,MAAM,CAAC,EAAE,CAAC;YACnB,YAAY,MAAM,CAAC,EAAE,CAAC;YACtB,aAAa;QACjB;QAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;YACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;YACzB,SAAS;gBACL,OAAO,QAAQ,OAAO;gBACtB,QAAQ,QAAQ,OAAO;gBACvB,QAAQ;YACZ;QACJ;QACA,QAAQ;QACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;YACnC,YAAY;YACZ,aAAa;QACjB;QACA,OAAO,OAAO,QAAQ;QAEtB,SAAS;YACL,kBAAkB,WAAW;gBACzB,SAAS,YAAY;gBACrB,WAAW,YAAY,aAAa,UAAU,oBAAoB,YAAY;YAClF;YACA,QAAQ;QACZ;QAGA,OAAO,UAAU;YACb,cAAc;YACd,YAAY;YACZ,cAAc;YACd,cAAc;YACd,gBAAgB;YAChB,YAAY;YACZ,QAAQ;YACR,kBAAkB;QACtB;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;QACtB;QAEA,OAAO;IACX;IAEA,OAAO,MAAuC;QAC1C,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAC1B,OAAO;QAGX,QAAQ,MAAM;QAEd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS;QACvB,QAAQ;QAER,MAAM,QAAQ,OAAO;QAErB,MAAM,aAA6B,CAAA,GAAA,MAAC,EAAE,QAAQ,SAAS,CAAC,MAAM,YAAY;QAC1E,WAAW,OAAO,MAAM;QACxB,WAAW,SAAS,WAAW,SAAU,MAAM,QAAQ;QACvD,WAAW,SAAS,WAAW,SAAU,MAAM,QAAQ;QACvD,WAAW,OAAO,MAAM;QACxB,WAAW,OAAO,MAAM;QACxB,WAAW,aAAa,MAAM,aAAa,CAAC,WAAW,aAAa,WAAW;QAC/E,WAAW,WAAY,MAAM;QAC7B,UAAU,UAAU;QAEpB,QAAQ;QACR,QAAQ,cAAc,MAAM;QAC5B,IAAI,MAAM,aAAa,SACnB,QAAQ,2BAA2B;aAEnC,QAAQ,2BAA2B,MAAM;QAE7C,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QAER,QAAQ,MAAM;QAEd,QAAQ,KAAK;YACT,MAAM;gBAAC;aAAS;YAChB,QAAQ;YACR,QAAQ;gBACJ,SAAS,cAAc,QAAQ;gBAC/B,QAAQ,aAAa,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;aACnE;QACL;QACA,OAAO;IACX;AAEJ;;;;;mDC1Wa;AA9Ib;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAiBA;;;;;;CAMC,GACD,SAAS,YAAa,OAAiC,EAAE,QAA6B;IAElF,mCAAmC;IACnC,6CAA6C;IAC7C,MAAM,eAAe,SAAS,QAAQ,KAAK,MAAM,SAAS,QAAQ,SAAS,QAAQ,KAAK;IACxF,MAAM,eAAe,SAAS,QAAQ,KAAK,MAAM,SAAS,QAAQ,SAAS,SAAS,KAAK;IAEzF,MAAM,qBAAqB,CAAA,GAAA,MAAC,EAAE,OAAO,SAAS,OAAO,SAAS;IAE9D,IAAI,SAAS,OAAO;QAChB,wCAAwC;QAExC,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,OAAO,SAAS,QAAQ,GAAG,SAAS,SAAS;QACpE,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI;QACxB,MAAM,iBAAiB;QACvB,MAAM,YAAY;QAElB,iCAAiC;QACjC,SAAS,UACL,QAAQ,QACR,CAAC,SAAS,IAAI,cACd,CAAC,SAAS,IAAI;QAGlB,qDAAqD;QAErD,sCAAsC;QACtC,SAAS;QACT,IAAI,gBAAgB,SAAS,qBAAqB,GAAG,SAAS,QAAQ,GAAG,SAAS,SAAS;QAC3F,cAAc,aAAa,GAAG;QAC9B,cAAc,aAAa,SAAS,OAAO;QAC3C,SAAS,2BAA2B;QACpC,SAAS,YAAY;QACrB,SAAS,SAAS,GAAG,GAAG,YAAY,OAAO,YAAY;QACvD,SAAS;QAET,mCAAmC;QACnC,SAAS;QACT,gBAAgB,SAAS,qBAAqB,GAAG,GAAG,GAAG,SAAS;QAChE,cAAc,aAAa,GAAG;QAC9B,cAAc,aAAa,SAAS,OAAO;QAC3C,SAAS,2BAA2B;QACpC,SAAS,YAAY;QACrB,SAAS,SAAS,GAAG,GAAG,SAAS,QAAQ,GAAG,SAAS,SAAS;QAC9D,SAAS;QAET,iCAAiC;QACjC,SAAS;QACT,yCAAyC;QACzC,SAAS,2BAA2B;QACpC,SAAS,UAAU,aAAa,GAAG,CAAC,SAAS;QAC7C,SAAS;QAIT,uDAAuD;QAEvD,uCAAuC;QACvC,SAAS;QACT,gBAAgB,SAAS,qBAAqB,SAAS,OAAO,GAAG,SAAS,QAAQ,GAAG;QACrF,cAAc,aAAa,GAAG;QAC9B,cAAc,aAAa,SAAS,OAAO;QAC3C,SAAS,2BAA2B;QACpC,SAAS,YAAY;QACrB,SAAS,SAAS,GAAG,GAAG,YAAY,OAAO,YAAY;QACvD,SAAS;QAET,sCAAsC;QACtC,SAAS;QACT,gBAAgB,SAAS,qBAAqB,GAAG,GAAG,SAAS,OAAO;QACpE,cAAc,aAAa,GAAG;QAC9B,cAAc,aAAa,SAAS,OAAO;QAC3C,SAAS,2BAA2B;QACpC,SAAS,YAAY;QACrB,SAAS,SAAS,GAAG,GAAG,SAAS,QAAQ,GAAG,SAAS,SAAS;QAC9D,SAAS;QAET,iCAAiC;QACjC,SAAS;QACT,yCAAyC;QACzC,SAAS,2BAA2B;QACpC,SAAS,UAAU,aAAa,CAAC,SAAS,OAAO;QACjD,SAAS;QAET,6BAA6B;QAC7B,CAAA,GAAA,MAAC,EAAE,IAAI,oBAAoB,UAAU,aAAa,GAAG;IAEzD,OACI,CAAA,GAAA,MAAC,EAAE,IAAI,oBAAoB,UACvB,QAAQ,QACR,CAAC,SAAS,GACV,CAAC,SAAS;IAIlB,QAAQ;IAER,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;IAC7D,QAAQ,UAAU,SAAS,UAAU,cAAc,SAAS,UAAU;IACtE,QAAQ,YAAY,CAAA,GAAA,iBAAU,EAAE,QAAQ,cAAc,oBAAoB;IAC1E,QAAQ,SAAS,CAAC,SAAS,UAAU,cAAc,CAAC,SAAS,UAAU,cAAc,QAAQ,OAAO,OAAO,QAAQ,OAAO;IAE1H,QAAQ;AACZ;AAGO,MAAM,gBAAgB;IAEzB,WAAW,MAA6B;QAEpC,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,MAAM,UAAU;QAChB,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,UAAU,OAAO;QACvB,MAAM,QAAQ,QAAQ,OAAO;QAC7B,MAAM,SAAS,QAAQ,OAAO;QAE9B,IAAI,WAAgC;YAChC,GAAG;YACH,GAAG;YACH,OAAO,SAAS,MAAM,KAAK,MAAM,QAAQ,KAAK;YAC9C,QAAQ,UAAU,MAAM,KAAK,MAAM,SAAS,KAAK;YACjD,OAAO;YACP,SAAS;YACT,SAAS;QACb;QACA,IAAI;QAEJ,mBAAmB;QACnB,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,aAAa;QAC/B,sCAAsC;QACtC,IACI,UACC,OAAO,SAAS,WAAW,OAAO,UAAU,WAAY,wBAAwB;QAChF,CAAA,OAAO,QAAQ,QAAQ,QAAQ,OAAO,SAAS,SAAS,KAAM,+BAA+B;QAAlC,GAC9D;YACE,SAAS,IAAI,OAAO;YACpB,SAAS,IAAI,OAAO;YACpB,SAAS,QAAQ,OAAO;YACxB,SAAS,SAAS,OAAO;QAC7B,OAAO;YACH,SAAS,IAAI,KAAK,MAAM,QAAQ,IAAI,SAAS,QAAQ;YACrD,SAAS,IAAI,KAAK,MAAM,SAAS,IAAI,SAAS,SAAS;QAC3D;QAEA,qBAAqB;QAErB,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;YACjB,MAAM,SAAS;YACf,MAAM;YACN,KAAK;YACL,KAAK;YACL,KAAK;gBAAC,OAAO;YAAM;YACnB,UAAU,SAAU,CAAC;gBACjB,SAAS,IAAI,OAAO;gBACpB;YACJ;QACJ;QACA,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;YACjB,MAAM,SAAS;YACf,MAAM;YACN,KAAK;YACL,KAAK;YACL,KAAK;gBAAC,OAAO;YAAM;YACnB,UAAU,SAAU,CAAC;gBACjB,SAAS,IAAI,OAAO;gBACpB;YACJ;QACJ;QACA,MAAM,aAAa,CAAA,GAAA,YAAI,EAAE;YACrB,MAAM,SAAS;YACf,MAAM;YACN,KAAK;YACL,KAAK,KAAK,IAAI,SAAS;YACvB,KAAK;gBAAC,OAAO;YAAM;YACnB,UAAU,SAAU,CAAC;gBACjB,SAAS,QAAQ,OAAO;gBACxB;YACJ;QACJ;QACA,MAAM,cAAc,CAAA,GAAA,YAAI,EAAE;YACtB,MAAM,SAAS;YACf,MAAM;YACN,KAAK;YACL,KAAK,KAAK,IAAI,SAAS;YACvB,KAAK;gBAAC,OAAO;YAAM;YACnB,UAAU,SAAU,CAAC;gBACjB,SAAS,SAAS,OAAO;gBACzB;YACJ;QACJ;QAEA,MAAM,aAAa;YACf,YAAY;YACZ,MAAM;QACV;QACA,OAAO,OACH,CAAA,GAAA,MAAC,EAAE,GAAG;YACH,SAAS;gBAEL,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,SAAS;oBACT,SAAS;wBACL;wBACA;qBACH;oBACD,KAAK;gBACT;gBAEA,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,SAAS;oBACT,SAAS;wBACL;wBACA;qBACH;oBACD,KAAK;gBACT;gBAEA,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,SAAS;oBACT,SAAS;wBACL,CAAA,GAAA,cAAG,EAAE,WAAW;wBAChB;qBACH;oBACD,KAAK;gBACT;gBAEA,CAAA,GAAA,MAAC,EAAE,GAAG;oBACF,SAAS;oBACT,SAAS;wBACL,CAAA,GAAA,cAAG,EAAE,YAAY;wBACjB;qBACH;oBACD,KAAK;gBACT;aACH;YACD,KAAK;gBACD,SAAS;gBACT,YAAY;YAChB;QACH;QAIJ,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,SAAS;YAChB,YAAY,CAAA,GAAA,yBAAS;YACrB,UAAU,SAAU,GAAG;gBACnB,SAAS,QAAQ;gBACjB;YACJ;YACA,YAAY,CAAC;gBACT,OAAO,CAAA,GAAA,MAAC,EAAE,MAAM,KAAK;YACzB;YACA,wBAAwB;QAC5B;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY,cAAc;YAC7B,QAAQ;QACZ;QAEA,OAAO,OACH,YAAY;QAGhB,yBAAyB;QACzB,IAAI,cAAc,GAAG,oBAAoB;QACzC,MAAM,kBAAkB,IAAI,CAAA,GAAA,gBAAM,EAAE;YAChC,MAAM,CAAA,GAAA,cAAG,EAAE;YACX,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,MAAM;YACN,UAAU,CAAC;gBACP,cAAc;gBACd,cAAc,MAAM,UAAU,QAAQ,IAAI,UAAU;gBACpD,cAAc;YAClB;QACJ;QACA,OAAO,OAAO,gBAAgB;QAE9B,qBAAqB;QAErB,MAAM,WAAW,OAAO;QACxB,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAEtE,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,QAAQ,QAAQ,OAAO,OAAO,QAAQ,OAAO,QAAQ,UAAU,MAAM,KAAK,UAAU,MAAM,KAAK;QAC9G,MAAM,IAAI,SAAS,KAAK,IAAI,QAAQ,IAAI,SAAS,KAAK,IAAI;QAC1D,MAAM,UAAU,KAAK,IAAI,GAAG,QAAQ,OAAO;QAC3C,MAAM,UAAU,KAAK,IAAI,GAAG,QAAQ,OAAO;QAC3C,uDAAuD;QACvD,MAAM,gBAAgB,IAAI,QAAQ,OAAO;QAEzC,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,GAAG;YACzB,WAAW;YACX,KAAK;gBACD,OAAO,CAAA,GAAA,4BAAc,EAAE,WAAW;gBAClC,QAAQ,CAAA,GAAA,6BAAe,EAAE,WAAW;gBACpC,WAAW;YACf;QACJ;QAEA,MAAM,eAA8B;YAChC,OAAO,CAAA,GAAA,MAAC,EAAE,OAAO,SAAS;YAC1B,WAAW,MAAM,CAAC,mBAAmB,CAAC;YACtC,SAAS,MAAM,CAAC,mBAAmB,CAAC;YACpC,YAAY,MAAM,CAAC,mBAAmB,CAAC;QAC3C;QACA,MAAM,kBAAkB,OAAO,IAAI,CAAC,MAAM;YACtC,IAAI,MAAM,oBACN,OAAO;iBAEP,OAAO;gBACH,OAAO,KAAK,QAAQ;gBACpB,WAAW,KAAK;gBAChB,SAAS,KAAK;gBACd,YAAY,KAAK;YACrB;QAER;QACA,MAAM,kBAAkB,IAAI,CAAA,GAAA,8BAAc,EAAE;YACxC,OAAO,KAAK,MAAM;YAClB,QAAQ,KAAK,MAAM;YACnB,QAAQ;QACZ;QAEA,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,GAAG;QACnC,CAAA,GAAA,MAAC,EAAE,IAAI,eAAe;YAClB,UAAU;YACV,MAAM;YACN,KAAK;YACL,cAAc;YACd,gBAAgB;QACpB;QAEA,MAAM,sBAAsB,CAAA,GAAA,MAAC,EAAE,GAAG;YAC9B,WAAW;YACX,KAAK;gBACD,OAAO,SAAS,KAAK,KAAK;gBAC1B,QAAQ,SAAS,KAAK,KAAK;YAC/B;QACJ;QACA,oBAAoB,OAChB,gBAAgB,cAChB;QAEJ,eAAe,OAAO;QACtB,OAAO,OAAO;QAGd,qCAAqC;QACrC,MAAM,SAAS,CAAC;QAOhB,SAAS;YACL,OAAO,QAAQ,KAAK,SAAS;YAC7B,OAAO,QAAQ,KAAK,SAAS;YAC7B,WAAW,QAAQ,KAAK,SAAS;YACjC,YAAY,QAAQ,KAAK,SAAS;QACtC;QAEA,MAAM,cAAc,IAAI,CAAA,GAAA,MAAC,EAAE,YAAY,CACvC;QAEA,eAAe,gBAAgB;YAC3B,OAAO;QACX;QACA,oBAAoB,MAAM,cAAc;QACxC,MAAM,kBAAkB,IAAI,CAAA,GAAA,MAAC,EAAE,gBAAgB;YAC3C,QAAQ;YACR,WAAW,CAAC;gBACR,IAAI,gBAAgB,GAAG;oBACnB,IAAI,MAAM,SAAS,eACf;wBAAA,IAAI,CAAC,OAAO,OAAO;4BACf,OAAO,cAAc,CAAA,GAAA,MAAC,EAAE,QAAQ;4BAEhC,MAAM,IAAI,MAAM,OAAO;4BACvB,MAAM,IAAI,MAAM,OAAO;4BAEvB,IAAI,CAAA,GAAA,MAAC,EAAE,aACH;gCAAC;gCAAG;4BAAC,GACL;gCAAC,GAAG,SAAS;gCAAG,GAAG,SAAS;gCAAG,OAAO,SAAS;gCAAO,QAAQ,SAAS;4BAAM,IAE7E,OAAO,QAAQ;iCAEf,OAAO,QAAQ;4BAEnB,OAAO,QAAQ;gCAAC;gCAAG;4BAAC;wBACxB;oBAAA,OACG,IAAI,MAAM,SAAS,eAAe;wBAErC,MAAM,IAAI,MAAM,OAAO;wBACvB,MAAM,IAAI,MAAM,OAAO;wBAEvB,IAAI,OAAO,UAAU,UAAU;4BAC3B,OAAO,MAAM;gCAAC;gCAAG;4BAAC;4BAElB,MAAM,KAAK,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO,MAAM,GAAG,OAAO,IAAI;4BAC3D,MAAM,KAAK,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO,MAAM,GAAG,OAAO,IAAI;4BAC3D,MAAM,KAAK,KAAK,IAAI,OAAO,KAAK,IAAI,OAAO,MAAM,GAAG,OAAO,IAAI;4BAC/D,MAAM,KAAK,KAAK,IAAI,QAAQ,KAAK,IAAI,OAAO,MAAM,GAAG,OAAO,IAAI;4BAEhE,SAAS,IAAI,KAAK,MAAM;4BACxB,SAAS,IAAI,KAAK,MAAM;4BACxB,SAAS,QAAQ,KAAK,IAAI,SAAS,KAAK,KAAK,KAAK,SAAS;4BAC3D,SAAS,SAAS,KAAK,IAAI,SAAS,KAAK,KAAK,KAAK,SAAS;4BAE5D,IAAI,YAAY,UAAU,UAAU;gCAChC,SAAS,QAAQ,KAAK,IAAI,SAAS,OAAO,SAAS;gCACnD,SAAS,SAAS,KAAK,IAAI,SAAS,OAAO,SAAS;4BACxD;4BAEA,IAAI,SAAS,UAAU,KAAK,SAAS,WAAW,GAC5C,WAAW,CAAA,GAAA,MAAC,EAAE,QAAQ,OAAO;4BAGjC;4BACA;wBACJ,OAAO,IAAI,OAAO,UAAU,QAAQ;4BAChC,MAAM,KAAK,KAAK,MAAM,IAAI,OAAO,MAAM;4BACvC,MAAM,KAAK,KAAK,MAAM,IAAI,OAAO,MAAM;4BAEvC,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,OAAO,YAAY,IAAI,IAAI,GAAG,QAAQ,SAAS;4BACrE,SAAS,IAAI,CAAA,GAAA,MAAC,EAAE,MAAM,OAAO,YAAY,IAAI,IAAI,GAAG,SAAS,SAAS;4BAEtE;4BACA;wBACJ;oBACJ,OAAO,IAAI,MAAM,SAAS,aACtB;wBAAA,IAAI,OAAO,OACP,OAAO,QAAQ;oBACnB;gBAER,OAAO;oBACH,IAAI,MAAM,SAAS,eACf;wBAAA,IAAI,CAAC,OAAO,OAAO;4BACf,OAAO,QAAQ;4BACf,OAAO,cAAc,CAAA,GAAA,MAAC,EAAE,QAAQ;4BAChC,OAAO,QAAQ;gCAAC,GAAG,MAAM,OAAO;gCAAe,GAAG,MAAM,OAAO;4BAAa;4BAC5E,OAAO,MAAM;wBACjB;oBAAA,OACG,IAAI,MAAM,SAAS,eACtB;wBAAA,IAAI,OAAO,OAAO;4BACd,OAAO,MAAM;gCAAC,GAAG,MAAM,OAAO;gCAAe,GAAG,MAAM,OAAO;4BAAa;4BAE1E,SAAS,UAAU,KAAK,MAAM,OAAO,IAAI,IAAI,OAAO,MAAM,KAAK,OAAO,YAAY;4BAClF,SAAS,UAAU,KAAK,MAAM,OAAO,IAAI,IAAI,OAAO,MAAM,KAAK,OAAO,YAAY;4BAElF;wBACJ;oBAAA,OACG,IAAI,MAAM,SAAS,aACtB;wBAAA,IAAI,OAAO,OAAO;4BACd,IAAI,CAAC,OAAO,KAAK;gCACb,SAAS,UAAU;gCACnB,SAAS,UAAU;gCACnB;4BACJ;4BACA,OAAO,QAAQ;wBACnB;oBAAA;gBAER;YACJ;QACJ;QAEA,6CAA6C;QAC7C,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO;QACxC,MAAM,cAAc,CAAA,GAAA,MAAC,EAAE,IAAI;QAE3B,SAAS,gBACL,OAAiC,EACjC,CAAS,EACT,CAAS,EACT,KAAa,EACb,MAAc;YAEd,MAAM,QAAQ,KAAK,MAAM,IAAI,OAAO;YACpC,MAAM,QAAQ,KAAK,MAAM,IAAI,OAAO;YACpC,MAAM,YAAY,KAAK,MAAM,IAAI,QAAQ;YACzC,MAAM,aAAa,KAAK,MAAM,IAAI,SAAS;YAC3C,QAAQ,WAAW,OAAO,OAAO,WAAW;QAChD;QAEA,SAAS,cAAe,OAAiB;YACrC,IAAI,CAAC,WAAW,qBAAqB,KAAK,UAAU,uBAAuB,KAAK,UAAU,WACtF;YAGJ,IAAI,gBAAgB,GAAG;gBACnB,YAAY,UAAU,GAAG,GAAG,OAAO;gBACnC,YAAY,UAAU,QAAQ,QAAQ,GAAG;gBAEzC,MAAM,gBAAgB,aAAa;gBACnC,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;gBAC1B,WAAW;gBACX,WAAW,UAAU,GAAG,GAAG,SAAS;gBACpC,WAAW,UAAU,gBAAgB,GAAG,GAAG,SAAS;gBACpD,WAAW;gBAEX,MAAM,KAAK,SAAS,QAAQ;gBAC5B,MAAM,KAAK,SAAS,SAAS;gBAE7B,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;gBAC1B,WAAW;gBACX,WAAW,UAAU,GAAG,GAAG,GAAG;gBAC9B,WAAW,cAAc;gBACzB,gBACI,YACA,SAAS,IAAI,eACb,SAAS,IAAI,eACb,IACA;gBAEJ,IAAI,SAAS,QAAQ,MAAM;oBACvB,WAAW,cAAc;oBACzB,gBACI,YACA,SAAS,IAAI,gBAAgB,KAAK,IAAI,SAAS,OAC/C,SAAS,IAAI,gBAAgB,KAAK,IAAI,SAAS,OAC/C,KAAM,CAAA,IAAI,SAAS,KAAI,GACvB,KAAM,CAAA,IAAI,SAAS,KAAI;gBAE/B;gBACA,WAAW;YAIf,OAAO;gBACH,YAAY,UAAU,GAAG,GAAG,OAAO;gBACnC,YAAY,UAAU,QAAQ,QAAQ,GAAG;gBACzC,YAAY,aAAa;gBAEzB,MAAM,gBAAgB,aAAa;gBACnC,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;gBAC1B,WAAW,UAAU,GAAG,GAAG,SAAS;gBACpC,WAAW,UAAU,gBAAgB,GAAG,GAAG,SAAS;YACxD;YAGA,gBAAgB;YAChB,oBAAoB,CAAA,GAAA,MAAC,EAAE,QAAQ;QACnC;QAEA;QAGA,mCAAmC;QACnC,MAAM,UAAU;YACZ,YAAY;YACZ,YAAY;YACZ,gBAAgB;YAChB,gBAAgB;QACpB;QACA,MAAM,SAAsD;YACxD,SAAS;YACT;YACA,UAAU;gBACN;gBACA,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;YACtB;QACJ;QACA,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,0BAAY,EAAE;QAEjC,OAAO;IACX;IAEA,OAAO,MAAyC;QAC5C,MAAM,WAAW,OAAO;QACxB,MAAM,MAAM,OAAO;QACnB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,YAAY,CAAC,SACd,OAAO;QAEX,QAAQ,MAAM;QAEd,YAAY,KAAK,OAAO;QAExB,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAU;YAC3B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;mDCtlBa;AAjCb;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAiBO,MAAM,gBAAgB;IAEzB,WAAW,MAA6B;QAEpC,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,UAAU,OAAO;QAEvB,IAAI,WAAW;QACf,MAAM,WAAgC;YAClC,UAAU;YACV,aAAa;YACb,OAAO;gBAAC,GAAG;gBAAK,GAAG;YAAG;YACtB,UAAU;gBAAC,GAAG;gBAAI,GAAG;YAAE;YACvB,OAAO;gBAAC,GAAG;gBAAG,GAAG;YAAC;YAClB,QAAQ;gBAAC,GAAG;gBAAG,GAAG;YAAC;QACvB;QACA,gCAAgC;QAEhC,qBAAqB;QACrB,MAAM,cAAkC,EAAE;QAC1C,MAAM,YAAY;QAClB;YACI,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,OAAO,WAAW;YACpC,MAAM,MAAM,CAAA,GAAA,MAAC,EAAE,IAAI;YAEnB,IAAI;YACJ,IAAI,IAAI,YAAY,GAAG,YAAY,GAAG,YAAY,KAAK,GAAG,KAAK,KAAK;YACpE,IAAI;YAEJ,IAAI,WAAW,IAAI,qBAAqB,GAAG,GAAG,WAAW;YACzD,SAAS,aAAa,GAAG;YACzB,SAAS,aAAa,KAAK;YAC3B,SAAS,aAAa,GAAG;YACzB,IAAI,YAAY;YAChB,IAAI,2BAA2B;YAC/B,IAAI,SAAS,GAAG,GAAG,WAAW;YAE9B,WAAW,IAAI,qBAAqB,WAAW,GAAG,GAAG;YACrD,SAAS,aAAa,GAAG;YACzB,SAAS,aAAa,GAAG;YACzB,IAAI,YAAY;YAChB,IAAI,2BAA2B;YAC/B,IAAI,SAAS,GAAG,GAAG,WAAW;YAE9B,MAAM,WAAW,CAAA,GAAA,iBAAU,EAAE,CAAA,GAAA,qBAAU;YACvC,MAAM,UAAU,SAAS,QAAQ;YACjC,SAAS,KAAK,SAAS,UAAU,uBAAuB;YAExD,MAAM,cAAc;YAEnB;gBAAC;gBAAG;gBAAG;aAAE,CAAW,QAAQ,CAAA;gBACzB,MAAM,WAAW,IAAI;gBACrB,MAAM,eAAuC,CAAA,GAAA,MAAC,EAAE,QAAQ;gBACxD,aAAa,cAAc;gBAC3B,aAAa,MAAM,KAAK;gBACxB,aAAa,MAAM,KAAK;gBACxB,aAAa,SAAS,KAAK;gBAC3B,aAAa,SAAS,KAAK;gBAC3B,SAAS,KAAK,SAAS,gBAAgB,QAAQ,cAAc,kBAAkB;gBAC/E,IAAI,UAAU,GAAG,GAAG,WAAW;gBAC/B,IAAI,UAAU,UAAU,GAAG;gBAC3B,SAAS,MAAM,OAAO,UAAU;gBAChC,YAAY,KAAK;YACrB;YAEA,QAAQ;QACZ;QAGA,qBAAqB;QAErB,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YACnB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,YAAY;YAChB;QACJ;QAEA,MAAM,cAAc,IAAI,CAAA,GAAA,gBAAM,EAAE;YAC5B,WAAW,YAAY,IAAI,CAAC,KAAK;gBAC7B,CAAA,GAAA,MAAC,EAAE,IAAI,KAAK;oBACR,QAAQ;oBACR,cAAc;oBACd,YAAY;gBAChB;gBACA,OAAO;oBACH,IAAI,KAAK;oBACT,OAAO;gBACX;YACJ;YACA,QAAQ;YACR,UAAU,CAAC;gBACP,SAAS,cAAc,OAAO;gBAC9B,QAAQ;YACZ;QACJ;QAEA,SAAS,KAAM,IAAe;YAC1B,IAAI,SAAS,KAAK;gBACd,SAAS,MAAM,IAAK,SAAS,MAAM;gBACnC,SAAS,SAAS,IAAK,SAAS,SAAS;gBACzC,SAAS,MAAM,IAAK,SAAS,MAAM;gBAEnC,SAAS,CAAC,EAAE,CAAC,SAAS,SAAS,MAAM;gBACrC,SAAS,CAAC,EAAE,CAAC,SAAS,SAAS,SAAS;gBACxC,SAAS,CAAC,EAAE,CAAC,SAAS,SAAS,MAAM;YACzC,OAAO;gBACH,SAAS,MAAM,IAAK,SAAS,MAAM;gBACnC,SAAS,SAAS,IAAK,SAAS,SAAS;gBACzC,SAAS,MAAM,IAAK,SAAS,MAAM;gBAEnC,SAAS,CAAC,EAAE,CAAC,SAAS,SAAS,MAAM;gBACrC,SAAS,CAAC,EAAE,CAAC,SAAS,SAAS,SAAS;gBACxC,SAAS,CAAC,EAAE,CAAC,SAAS,SAAS,MAAM;YACzC;YACA,QAAQ;QACZ;QAEA,MAAM,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC5B,MAAM;YACN,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU,CAAC;gBACP,WAAW;gBACX,IAAI,UACA,KAAK;YAEb;QACJ;QAEA,SAAS,OACL,YAAY,cACZ,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,KAAK;gBAAC,UAAU;YAAG;QAAC,IAC3B,WAAW;QAGf,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,UAAU;YACd;QACJ;QACA,MAAM,UAAU,CAAA,GAAA,MAAC,EAAE,GAAG;YAClB,QAAQ;YACR,KAAK;gBACD,aAAa;YACjB;QACJ;QACA,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,QAAQ;QAAO;QAEvC,MAAM,cAAc,UAAU,MAAM;QACpC,MAAM,YAAwB,EAAE;QAE/B;YAAC;YAAK;SAAI,CAAW,QAAQ,CAAC,MAAM;YACjC,MAAM,WAAW,UAAU,IAAI,UAAU;YAEzC,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC7B,OAAO,CAAA,GAAA,cAAG,EAAE,wBAAwB,MAAM,KAAK;gBAC/C,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,OAAO,SAAS,KAAK,CAAC,KAAK;gBAC3B,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,CAAC;oBACP,SAAS,KAAK,CAAC,KAAK,GAAG;oBACvB,IAAI,UACA,KAAK;yBAEL,QAAQ;gBAEhB;YACJ;YACA,YAAY,aAAa,MAAM,YAAY;YAC3C,SAAS,OAAO,YAAY;YAE5B,MAAM,iBAAiB,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAChC,OAAO,CAAA,GAAA,cAAG,EAAE,kCAAkC,MAAM,KAAK;gBACzD,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO;gBACP,OAAO,SAAS,QAAQ,CAAC,KAAK;gBAC9B,YAAY,CAAA,GAAA,yBAAS;gBACrB,UAAU,CAAC;oBACP,SAAS,QAAQ,CAAC,KAAK,GAAG;oBAC1B,IAAI,UACA,KAAK;yBAEL,QAAQ;gBAEhB;YACJ;YACA,eAAe,aAAa,MAAM,YAAY;YAC9C,SAAS,OAAO,eAAe;YAE/B,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;gBAC7B,OAAO,CAAA,GAAA,cAAG,EAAE,0BAA0B,MAAM,KAAK;gBACjD,OAAO;gBACP,QAAQ;gBACR,KAAK;gBACL,KAAK;gBACL,OAAO,SAAS,KAAK,CAAC,KAAK;gBAC3B,wBAAwB;gBACxB,YAAY,CAAA,GAAA,yBAAS;gBACrB,YAAY,CAAC,MAAQ,CAAA,GAAA,MAAC,EAAE,MAAM,KAAK;gBACnC,UAAU,CAAC;oBACP,SAAS,KAAK,CAAC,KAAK,GAAG;oBACvB,IAAI,UACA,KAAK;yBAEL,QAAQ;gBAEhB;YACJ;YACA,YAAY,aAAa,MAAM,YAAY;YAC3C,SAAS,OAAO,YAAY;YAE5B,UAAU,KAAK;YACf,UAAU,KAAK;YACf,UAAU,KAAK;QACnB;QAEA,MAAM,aAAa,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC5B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO;YACP,OAAO,SAAS;YAChB,YAAY,CAAA,GAAA,yBAAS;YACrB,UAAU,CAAC;gBACP,SAAS,WAAW,KAAK,MAAM;gBAC/B,QAAQ;YACZ;QACJ;QAEA,WAAW,aAAa,MAAM,YAAY;QAC1C,WAAW,aAAa,MAAM,eAAe;QAC7C,OAAO,OAAO,WAAW;QAGzB,oBAAoB;QAEpB,MAAM,WAAW,OAAO;QACxB,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAGtE,MAAM,oBAAoB,IAAI,CAAA,GAAA,oCAAgB,EAAE;YAC5C,UAAU,QAAQ;YAClB,UAAU,CAAC,UAAU;gBACjB,MAAM,iBAAiB,CAAA,GAAA,MAAC,EAAE,QAAQ;gBAClC,eAAe,YAAY,UAAU;gBACrC,eAAe,SAAS,KAAK,UAAU;gBACvC,eAAe,SAAS,KAAK,UAAU;gBACvC,IAAI,eAAe,gBAAgB,GAAG;oBAClC,eAAe,MAAM,KAAK,UAAU;oBACpC,eAAe,MAAM,KAAK,UAAU;gBACxC;gBACA,eAAe,OAAO,IAAI,CAAC,UAAU;gBACrC,eAAe,OAAO,IAAI,CAAC,UAAU;gBAErC,OAAO,SAAS,gBAAgB,QAAQ,gBAAgB;YAC5D;QACJ;QAEA,MAAM,kBAAqD,OAAO,IAAI,CAAC,MAAM;YACzE,OAAO;gBACH,OAAO,MAAM,qBAAqB,kBAAkB,SAAS,KAAK,QAAQ;gBAC1E,WAAW,KAAK;gBAChB,SAAS,KAAK;gBACd,YAAY,KAAK;gBACjB,aAAa;YACjB;QACJ;QACA,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;YACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;YACzB,SAAS;gBACL,OAAO,QAAQ,OAAO;gBACtB,QAAQ,QAAQ,OAAO;gBACvB,QAAQ;YACZ;QACJ;QACA,QAAQ;QACR,QAAQ,aAAa,UAAU,IAAI,CAAA,GAAA,kBAAE,EAAE;YACnC,YAAY;YACZ,aAAa;QACjB;QACA,OAAO,OAAO,QAAQ;QAEtB,MAAM,UAAU;YACZ,YAAY;YACZ,UAAU,QAAQ,CAAA,OAAQ,KAAK;YAC/B,WAAW;YACX,WAAW;YACX,kBAAkB;YAClB,QAAQ;QACZ;QAEA,mCAAmC;QACnC,MAAM,SAAsD;YACxD,SAAS;YACT;YACA,UAAU;gBACN;gBACA,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;YACtB;QACJ;QACA,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,0BAAY,EAAE;QAEjC,OAAO;IACX;IAEA,OAAO,MAAyC;QAC5C,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,YAAY,CAAC,SACd,OAAO;QAEX,QAAQ,MAAM;QAEd,MAAM,WAAW,CAAA,GAAA,qBAAU;QAC3B,IAAI,CAAC,UACD,OAAO,OAAO,4BAA4B;QAE9C,MAAM,UAAU,SAAS,QAAQ,QAAQ;QACzC,SAAS,KAAK,SAAS,gBAAgB,QAAQ,OAAO,OAAO,kBAAkB;QAC/E,QAAQ,UAAU,GAAG,GAAG,QAAQ,OAAO,OAAO,QAAQ,OAAO;QAC7D,QAAQ,UAAU,UAAU,GAAG;QAC/B,QAAQ;QAER,QAAQ,MAAM;QACd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAU;YAC3B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;uDCnWa;AA7Bb;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAeO,MAAM,oBAAoB;IAE7B,WAAW,MAA6B;QACpC,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,IAAI,CAAC,WAAW,CAAC,UACb,OAAO;QAGX,MAAM,SAAS,SAAS;QACxB,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,SAAS,cAAc,QAAQ;QAEtE,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,OAAO,QAAQ,OAAO,OAAO,QAAQ,OAAO;QACrE,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,IAAI;QAE1B,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE;QAClB,MAAM,SAA0D;YAC5D,SAAS;QACb;QACA,MAAM,UAAU,CAAA,GAAA,wBAAU;QAC1B,IAAI,CAAC,SACD,OAAO,QAAQ,CAAA,GAAA,4BAAc,EAAE;QAGnC,MAAM,cAAuC;YACzC,GAAG,QAAQ,OAAO,QAAQ;YAC1B,GAAG,QAAQ,OAAO,SAAS;YAC3B,OAAO;YACP,WAAW;YACX,OAAO;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YACxB,SAAS;QACb;QAEA,MAAM,cAAc,IAAI,CAAA,GAAA,kBAAO,EAAE;YAC7B,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,OAAO;YACP,QAAQ;YACR,KAAK;YACL,KAAK;YACL,OAAO,YAAY;YACnB,OAAO;YACP,YAAY,CAAA,GAAA,yBAAS;YACrB,UAAU,SAAU,GAAG;gBACnB,YAAY,QAAQ,KAAK,MAAM;gBAC/B;YACJ;QACJ;QACA,YAAY,aAAa,MAAM,eAAe;QAC9C,OAAO,OAAO,YAAY;QAE1B,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,YAAY;YAChB;QACJ;QACA,MAAM,QAAQ,CAAA,GAAA,MAAC,EAAE,GAAG;YAChB,QAAQ;YACR,KAAK;gBACD,SAAS;gBACT,YAAY;gBACZ,WAAW;gBACX,cAAc;YAClB;QACJ;QACA,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;YACjB,MAAM,YAAY;YAClB,MAAM;YACN,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU,SAAU,CAAC;gBACjB,YAAY,IAAI,WAAW;gBAC3B,UAAU,SAAS;oBACf,GAAG,YAAY;oBACf,GAAG,YAAY;gBACnB;gBACA;YACJ;QACJ;QACA,MAAM,SAAS,CAAA,GAAA,YAAI,EAAE;YACjB,MAAM,YAAY;YAClB,MAAM;YACN,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU,SAAU,CAAC;gBACjB,YAAY,IAAI,WAAW;gBAC3B,UAAU,SAAS;oBACf,GAAG,YAAY;oBACf,GAAG,YAAY;gBACnB;gBACA;YACJ;QACJ;QACA,MAAM,iBAAiB,CAAA,GAAA,YAAI,EAAE;YACzB,MAAM;YACN,MAAM;YACN,KAAK;YACL,KAAK;gBAAC,OAAO;gBAAQ,aAAa;YAAM;YACxC,UAAU,SAAU,CAAC;gBACjB,YAAY,YAAY,WAAW;gBACnC;YACJ;QACJ;QAEA,IAAI,kBAAkB;YAAC,GAAG;YAAG,GAAG;YAAG,GAAG;YAAG,GAAG;QAAC;QAC7C,MAAM,kBAAkB;YACpB;gBAAC,GAAG;gBAAG,GAAG;gBAAG,GAAG;gBAAG,GAAG;YAAC;YACvB;gBAAC,GAAG;gBAAK,GAAG;gBAAK,GAAG;gBAAK,GAAG;YAAC;SAChC;QACD,gBAAgB,KAAK;YACjB,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,gBAAgB;YAC1B,GAAG;QACP;QACA,gBAAgB,KAAK;YACjB,GAAG,OAAO,kBAAkB;YAC5B,GAAG,OAAO,kBAAkB;YAC5B,GAAG,OAAO,kBAAkB;YAC5B,GAAG;QACP;QACA,YAAY,QAAQ,CAAA,GAAA,MAAC,EAAE,QAAQ;QAE/B,MAAM,eAAe,IAAI,CAAA,GAAA,0BAAW,EAAE;YAClC,OAAO,CAAA,GAAA,cAAG,EAAE;YACZ,UAAU;YACV,UAAU,SAAU,OAAO;gBACvB,kBAAkB;gBAClB,YAAY,QAAQ,CAAA,GAAA,MAAC,EAAE,QAAQ;gBAC/B;YACJ;QACJ;QAEA,MAAM,aAAa;YACf,SAAS;YACT,aAAa;QACjB;QACA,MAAM,OACF,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;YAAM,KAAK;QAAU,IACrC,QACA,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS;YAAM,KAAK;QAAU,IACrC;QAEJ,MAAM,OACF,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,SAAS,CAAA,GAAA,cAAG,EAAE,sBAAsB;YAAK,KAAK;QAAU,IAC/D,gBACA,CAAA,GAAA,MAAC,EAAE,GAAG;YAAC,KAAI;gBAAC,UAAU;YAAG;QAAC,IAC1B,aAAa;QAGjB,qCAAqC;QACrC,SAAS;YACL,OAAO,QAAQ,KAAK,YAAY;YAChC,OAAO,QAAQ,KAAK,YAAY;QACpC;QAEA,SAAS;YACL,MAAM,MAAM;YACZ,MAAM,IAAI,cAAc;YACxB,MAAM,IAAI,cAAc;YAExB,IAAI;YACJ,IAAI,UAAU,GAAG,GAAG,GAAG;YACvB,IAAI,UAAU,QAAQ,QAAQ,GAAG,GAAG,GAAG;YACvC,CAAA,GAAA,gCAAc,EACV,KACA,YAAY,GACZ,YAAY,GACZ,YAAY,OACZ,KAAK,IAAI,YAAY,WAAW,IAChC,YAAY,OACZ,YAAY;YAGhB,IAAI;YACJ,QAAQ;QACZ;QAEA,MAAM,WAAW;YACb,UAAU,aAAa,QAAQ;YAC/B,OAAO;QACX;QAEA,MAAM,kBAAqD,EAAE;QAEzD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,QAAQ,IAC/B,gBAAgB,KAAK;YACjB,OAAO,MAAM,qBAAqB,WAAW,MAAM,CAAC,EAAE,CAAC,QAAQ;YAC/D,WAAW,MAAM,CAAC,EAAE,CAAC;YACrB,SAAS,MAAM,CAAC,EAAE,CAAC;YACnB,YAAY,MAAM,CAAC,EAAE,CAAC;YACtB,aAAa;QACjB;QAIR,MAAM,UAAU,IAAI,CAAA,GAAA,gBAAM,EAAE;YACxB,OAAO,CAAA,GAAA,4BAAc,EAAE;YACvB,QAAQ,CAAA,GAAA,6BAAe,EAAE;YACzB,SAAS;gBACL,OAAO,QAAQ,OAAO;gBACtB,QAAQ,QAAQ,OAAO;gBACvB,QAAQ;YACZ;QACJ;QACA,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,cAAc;YACzB,YAAY;YACZ,aAAa;YACb,UAAU;QACd;QAEA,MAAM,YAAY,IAAI,CAAA,GAAA,8BAAa,EAAE;YACjC,OAAO;gBACH,GAAG,YAAY;gBACf,GAAG,YAAY;YACnB;YACA,UAAU,CAAC;gBACP,YAAY,IAAI,KAAK,MAAM,IAAI;gBAC/B,YAAY,IAAI,KAAK,MAAM,IAAI;gBAC/B;gBACA;YACJ;QACJ;QAEA;QAEA,QAAQ,aAAa,OAAO,UAAU;QACtC,OAAO,OAAO,QAAQ;QAItB,OAAO,UAAU;YACb,YAAY;YACZ,aAAa;YACb,QAAQ;QACZ;QACA,OAAO,WAAW;YACd,OAAO;YACP,OAAO,CAAA,GAAA,MAAC,EAAE,QAAQ;QACtB;QACA,OAAO;IACX;IAEA,OAAO,MAA6C;QAChD,MAAM,UAAU,OAAO;QACvB,MAAM,WAAW,OAAO;QACxB,MAAM,UAAU,OAAO;QACvB,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,SAC1B,OAAO;QAGX,QAAQ,MAAM;QACd,CAAA,GAAA,gCAAc,EACV,SACA,OAAO,MAAM,GACb,OAAO,MAAM,GACb,OAAO,MAAM,OACb,OAAO,MAAM,WACb,OAAO,MAAM,OACb,OAAO,MAAM;QAEjB,QAAQ,MAAM;QAEd,QAAQ,KAAK;YACT,MAAM;gBAAC;gBAAU;aAAc;YAC/B,QAAQ;YACR,QAAQ;gBAAC;oBACL,OAAO,OAAO;gBAClB;aAAE;QACN;QACA,OAAO;IACX;AAEJ;;;;;ACzSA,qDAAgB;AAJhB;AACA;AAGO,SAAS,gBACZ,GAA6B,EAC7B,CAAS,EACT,CAAS,EACT,KAAa,EACb,SAAiB,EACjB,KAAW,EACX,OAAe;IAEf,IAAI;IAEJ,MAAM,eAAe,MAAM;IAC3B,IAAK,IAAI,MAAM,GAAG,MAAM,KAAK,OAAO,aAAc;QAC9C,MAAM,KAAK,CAAA,GAAA,MAAC,EAAE,aAAa;YAAC;YAAG;QAAC,GAAG;YAAC,GAAG,IAAI;YAAM;QAAC,GAAG;QACrD,CAAA,GAAA,oBAAQ,EACJ,KACA;YACI,MAAM;YACN,IAAI;YACJ,IAAI;YACJ,IAAI,GAAG;YACP,IAAI,GAAG;YACP,cAAc;YACd,YAAY;YACZ;YACA,kBAAkB;YAClB,WAAW;YACX,WAAW;QAEf;IAER;IAEA,IAAI;AACR;;;;;ACjCA,uDAAsB;AALtB;AAGA;AAEO,eAAe,kBAAmB,QAAkB;IACvD,MAAM,WAAW,SAAS;IAE1B,MAAM,YAAiB;QACnB,OAAO,SAAS;QAChB,QAAQ,SAAS;QACjB,mEAAmE;QACnE,UAAU,SAAS,IAAI,CAAA;YACnB,gDAAgD;YAChD,OAAO;gBACH,MAAM,KAAK;gBACX,QAAQ,CAAC,KAAK;gBACd,SAAS,KAAK;gBACd,QAAQ,KAAK;gBACb,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI,aAAa,KAAK;gBACpC,MAAM;gBACN,KAAK;YACT;QACJ;IACJ;IAEA,MAAM,QAAQ,MAAM,CAAA,GAAA,oBAAQ;IAC5B,MAAM,SAAS,MAAM,eAAe;IACpC,OAAO,IAAI,KAAK;QAAC;KAAO,EAAE;QAAE,MAAM;IAA2B;AACjE;;;;;AC1BA;;;;;;;;CAQC,GACD,mDAAa;AAZb;AAYO,MAAM;IAYT,iBAAiB;IACjB,YACI,CAEC,CACH;QACE,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM,EAAE,WAAW,GAAG;IAC9C;IAEA,QAAS,KAAiB,EAAqB;QAC3C,QAAQ,CAAA,GAAA,MAAC,EAAE,QAAQ;QACnB,IAAI,CAAC,WAAW,aAAa,IAAI,CAAC;QAClC,IAAI,CAAC,YAAY,cAAc,IAAI,CAAC;QAEpC,IAAI,MAAM,SAAS,QACf,IAAI,CAAC,iBAAiB;YAClB,GAAG,MAAM;YACT,GAAG,MAAM;YACT,UAAU,MAAM;QACpB;QAGJ,IAAI,MAAM,SAAS,QAAQ;YAEvB,MAAM,SAAS,MAAM;YACrB,MAAM,SAAS,MAAM;YACrB,MAAM,gBAAgB,MAAM;YAE5B,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,GAAG,IAAI,CAAC,eAAgB,GAAG,IAAI,CAAC;YACvD,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,GAAG,IAAI,CAAC,eAAgB,GAAG,IAAI,CAAC;YACvD,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI,MAAM,UAAU,IAAI,CAAC,eAAgB,UAAU,IAAI,CAAC;YAC5E,IAAI,CAAC,iBAAiB;gBAClB,GAAG,MAAM;gBACT,GAAG,MAAM;gBACT,UAAU,MAAM;YACpB;YAEA,IAAI,IAAI,CAAC,YAAY,GACjB,IAAI,CAAC,UAAU,WAAW;gBACtB,IAAI,CAAC,WAAW,YAAY;oBACxB,QAAQ,KAAK,MAAM,KAAK,UAAU;oBAElC,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,IAAI,CAAC,eAAgB,GAAG,IAAI,CAAC;oBACtD,MAAM,IAAI,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ,IAAI,CAAC,eAAgB,GAAG,IAAI,CAAC;oBACtD,MAAM,WAAW,CAAA,GAAA,MAAC,EAAE,IAAI,eAAe,IAAI,CAAC,eAAgB,UAAU,IAAI,CAAC;oBAC3E,IAAI,CAAC,iBAAiB;wBAClB,GAAG,MAAM;wBACT,GAAG,MAAM;wBACT,UAAU,MAAM;oBACpB;oBAEA,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS;gBACnC,GAAG;YACP,GAAG;QAGX;QAEA,OAAO;IACX;IAEA,YAAa,IAAqC,EAAQ;QACtD,IAAI,CAAC,WAAW;IACpB;IAEA,aAAc,CAAS,EAAQ;QAC3B,IAAI,CAAC,YAAY,CAAA,GAAA,MAAC,EAAE,MAAM,GAAG,GAAG;IACpC;AACJ;;;;;AC1FA;;;;;;;;CAQC,GACD,mDAAa;AAAN,MAAM;IAKT,iBAAiB;IAEjB,QAAS,KAAiB,EAAqB;QAE3C,IAAI,MAAM,SAAS;YACf,IAAI,IAAI,CAAC,WACL,4DAA4D;YAC5D,IAAI,CAAC,YAAY,IAAI,CAAC,SAAS;gBAC3B,MAAM;gBACN,OAAO,MAAM;gBACb,gBAAgB,MAAM;gBACtB,aAAa;YACjB;iBAEA,IAAI,CAAC,YAAY;;QAGzB,IAAI,CAAC,IAAI,CAAC,aAAc,CAAA,MAAM,SAAS,UAAU,MAAM,SAAS,IAAG,GAC/D,qEAAqE;QACrE,OAAO;QAGX,IAAI,MAAM,SAAS,QAAQ,IAAI,CAAC,WAC5B,IAAI,CAAC,YAAY;QAGrB,OAAO;IACX;IAEA,YAAa,IAAqC,EAAQ;QACtD,IAAI,CAAC,WAAW;IACpB;IAEA,eAAyB;QACrB,OAAO,IAAI,CAAC;IAChB;;aArCQ,YAAqB;;AAsCjC;;;ACpDA;;;CAGC;;AACD,wDAAgB;AAAT,SAAS,mBAAoB,CAAS;IACzC,IAAI,KAAK,GACL,OAAO;IAEX,IAAI,KAAK,GACL,OAAO;IAEX,IAAI,KAAK,GACL,OAAO;IAEX,IAAI,KAAK,GACL,OAAO;IAEX,IAAI,KAAK,GACL,OAAO;IAEX,OAAO;AACX;;;;;ACTA,cAAc;AACd,yCAAyC;AACzC,gFAAgF;AAEhF,mDAAa;AAfb;AACA;AACA;AACA;AAMA;AAMO,MAAM;IAaT;;;;;KAKC,GACD,AAAQ,sBACJ,aAKC,EACD,QAA4B,EAC5B,SAAwC,EACpC;QACJ,IAAI,CAAC,iBAAiB,MAAM,cAAc,UAAU,MAAM,cAAc,WAAW,cAAc,SAAS,KAAK,cAAc,UAAU,GAAG;YACtI,CAAA,GAAA,MAAC,EAAE,MAAM;gBACL,QAAQ,IAAI,CAAC;gBACb,MAAM;gBACN,SAAS,CAAA,GAAA,cAAG,EAAE;gBACd,SAAS;oBAAC;iBAAK;YACnB;YACA;QACJ;QAEA,MAAM,uBAAuB,CAAC,OAAe;YACzC,IAAI,IAAI,SAAS,KAAK;YACtB,IAAI,IAAI,SAAS,KAAK;YACtB,IAAI,IAAI,IAAI,CAAC,iBAAiB;gBAC1B,IAAI,IAAI,CAAC,kBAAkB,IAAI;gBAC/B,IAAI,IAAI,CAAC;YACb;YACA,IAAI,IAAI,IAAI,CAAC,iBAAiB;gBAC1B,IAAI,IAAI,CAAC,kBAAkB,IAAI;gBAC/B,IAAI,IAAI,CAAC;YACb;YACA,IAAI,SAAS,KAAK;YAClB,IAAI,SAAS,KAAK;YAClB,OAAO;gBACH,OAAO;gBACP,QAAQ;YACZ;QACJ;QAEA,MAAM,gBAAgB,CAAC;YACnB,MAAM,oBAAoB,qBAAqB,OAAO,OAAO,OAAO;YAEpE,cAAc;YACd,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,OAAO,OAAO,OAAO;YAClD,MAAM,gBAAgB,CAAA,GAAA,MAAC,EAAE,IAAI;YAC7B,cAAc,UAAU,QAAQ,GAAG;YAEnC,CAAA,GAAA,MAAC,EAAE,aAAa,YAAY,kBAAkB,OAAO,kBAAkB;YAEvE,IAAI,CAAC,SAAS,MAAM;gBAChB,OAAO,kBAAkB;gBACzB,QAAQ,kBAAkB;gBAC1B,OAAO;gBACP,WAAW;YACf;YAEA,IAAI,CAAC,aAAa,OAAO;YACzB,IAAI,CAAC,gBAAgB,IAAI,CAAC,SAAS,SAAS;YAC5C,IAAI,CAAC,kBAAkB;YACvB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;QACjF;QAEA;;;;SAIC,GACD,MAAM,mBAAmB,CAAC,iBAAyB;YAC/C,OAAO;YACP,MAAM,OAAO,CACT,cACA,YACA;gBAEA,0CAA0C;gBAC1C,WAAW,QAAQ,WAAW;gBAC9B,CAAA,GAAA,MAAC,EAAE,IAAI,YAAY,UAAU,cAAc,CAAC,QAAQ,GAAG,CAAC,QAAQ;gBAChE,aAAa,QAAQ,QAAQ;gBAC7B,aAAa,SAAS,QAAQ;gBAC9B,CAAA,GAAA,MAAC,EAAE,IAAI,cAAc,UAAU,YAAY,GAAG;YAClD;YACA,IAAI,WAAY,CAAA,QAAQ,UAAU,gBAAgB,SAAQ,QAAQ,WAAW,gBAAgB,MAAK,GAAI;gBAClG,MAAM,aAAa,CAAA,GAAA,MAAC,EAAE,OAAO,QAAQ,OAAO,QAAQ;gBACpD,gBAAgB,QAAQ,QAAQ;gBAChC,gBAAgB,SAAS,QAAQ;gBAEjC,IAAI,CAAC,gBAAgB,QACjB,KAAK,gBAAgB,QAAQ,YAAY;gBAE7C,IAAI,gBAAgB,QAChB,IAAK,IAAI,IAAI,GAAG,IAAI,gBAAgB,OAAO,QAAQ,IAAK;oBACpD,MAAM,OAAO,gBAAgB,MAAM,CAAC,EAAE;oBACtC,KAAK,KAAK,OAAO,YAAY;gBACjC;YAER;YAEA,SAAS;YACT,MAAM,oBAAoB,qBAAqB,gBAAgB,OAAO,gBAAgB;YACtF,gBAAgB,QAAQ,kBAAkB;YAC1C,gBAAgB,SAAS,kBAAkB;YAC3C,IAAI,CAAC,gBAAgB,QACjB,CAAA,GAAA,MAAC,EAAE,aAAa,gBAAgB,QAAQ,gBAAgB,OAAO,gBAAgB;YAEnF,IAAI,gBAAgB,QAChB,IAAK,IAAI,IAAI,GAAG,IAAI,gBAAgB,OAAO,QAAQ,IAAK;gBACpD,MAAM,OAAO,gBAAgB,MAAM,CAAC,EAAE;gBACtC,CAAA,GAAA,MAAC,EAAE,aAAa,KAAK,OAAO,gBAAgB,OAAO,gBAAgB;YACvE;YAGJ,IAAI;YACJ,IAAI,gBAAgB,QAChB,aAAa,IAAI,CAAC,SAAS,MAAM;gBAC7B,OAAO,gBAAgB;gBACvB,QAAQ,gBAAgB;gBACxB,QAAQ,gBAAgB;YAC5B;iBAEA,aAAa,IAAI,CAAC,SAAS,MAAM;gBAC7B,OAAO,gBAAgB;gBACvB,QAAQ,gBAAgB;gBACxB,OAAO,gBAAgB;YAC3B;YAEJ,IAAI,CAAC,aAAa,OAAO;YACzB,IAAI,CAAC,gBAAgB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,SAAS;YACxD,IAAI,CAAC,kBAAkB;YACvB,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,kBAAkB,YAAY,IAAI,CAAC,kBAAkB;QACjF;QAEA,MAAM,gBAAgB,CAAC;YACnB,CAAA,GAAA,MAAC,EAAE,wBAAwB;gBACvB,QAAQ,IAAI,CAAC;gBACb,UAAU,IAAI,CAAC;gBACf,aAAa;gBACb,UAAU,CAAC,cAAc;oBACrB,IAAI,CAAC,cACD;oBAGJ,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAChB,IAAI,CAAC,SAAS;oBACd,MAAM,SAAS,IAAI,CAAC,SAAS;oBAC7B,MAAM,mBAAmB,OAAO,SAAS;oBACzC,IAAI,UACA,IAAI,CAAC,SAAS,YAAY,kBAAkB;oBAEhD,MAAM,qBAAqB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,gBAAgB;oBACrE,CAAA,GAAA,MAAC,EAAE,+BAA+B,oBAAoB,QAAQ,cAAc,WAAW;oBACvF,IAAI,CAAC,gBAAgB,CAAA,GAAA,iBAAU,EAAE,IAAI,CAAC,SAAS,SAAS;oBACxD,IAAI,CAAC,aAAa,OAAO;oBAEzB,CAAA,GAAA,oBAAQ,EAAE,MAAM;oBAEhB,CAAA,GAAA,oBAAQ,EAAE,KAAK;wBACX,MAAM;4BAAC;yBAAO;wBACd,QAAQ;wBACR,QAAQ;4BAAC,CAAA,GAAA,MAAC,EAAE,WAAW,mBAAmB;4BAAS;yBAAS;oBAChE;gBACJ;YACJ;QACJ;QAGA,IAAI,cAAc,aAAa,CAAC,WAC5B,CAAA,GAAA,MAAC,EAAE,sBAAsB;YACrB,OAAO;YACP,QAAQ,IAAI,CAAC;YACb,SAAS,IAAI,CAAC;YACd,UAAU,CAAC;gBACP,IAAI,IAAI,SAAS,YACb,cAAc,IAAI;qBACf,IAAI,IAAI,SAAS,gBACpB,iBAAiB,IAAI,OAAO,IAAI;qBAC7B,IAAI,IAAI,SAAS,YACpB,cAAc,IAAI;qBACX,IAAI;YAGnB;QACJ;QAGJ,IAAI,cAAc,SACd,cAAc,cAAc;QAEhC,IAAI,cAAc;YACd,IAAI,cAAc,SAAS,OACvB,iBAAiB;iBAEjB,cAAc,cAAc;;IAIxC;IAEA,mBAAmB;IACnB,YACI,KAQC,EACD,QAEC,CACH;QACE,IAAI,CAAC,WAAW,MAAM;QACtB,IAAI,CAAC,kBAAkB,MAAM;QAC7B,IAAI,CAAC,eAAe,MAAM;QAC1B,IAAI,CAAC,kBAAkB,MAAM;QAC7B,IAAI,CAAC,WAAW,MAAM;QACtB,IAAI,CAAC,oBAAoB,MAAM;QAC/B,IAAI,CAAC,SAAS,MAAM;QAEpB,IAAI,CAAC,UAAU,SAAS;IAC5B;IAIA,sBAAsB;IAEtB,QAAS,CAAiB,EAAO;QAC7B,IAAI,CAAA,GAAA,MAAC,EAAE,cAAc,QAAQ,GACzB;QAGJ,MAAM,mCAAmC,CACrC,OACA;YAEA,IAAI,CAAC,OACD;YAEJ,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,IAAK;gBACnC,IAAI,KAAK,CAAC,EAAE,CAAC,KAAK,QAAQ,YAAY,IAClC;gBAEJ,MAAM,OAAO,KAAK,CAAC,EAAE,CAAC;gBACtB,QAAQ,SAAS;YACrB;QACJ;QAEA,EAAE;QACF,EAAE;QAEF,IAAI,CAAC,EAAE,eACH;QAGJ,IAAI,EAAE,cAAc,KAAK,CAAC,EAAE,EACxB,iCAAiC,EAAE,cAAc,OAAO,CAAC;YACrD,gDAAgD;YAChD,MAAM,MAAM,IAAI;YAChB,IAAI,SAAS;gBACT,IAAI,gBAAgB,IAAI;gBACxB,IAAI,CAAC,sBAAsB;oBACvB,MAAM;oBACN,OAAO,IAAI;oBACX,QAAQ,IAAI;oBACZ,QAAQ;gBACZ,GAAG,WAAW;YAClB;YACA,MAAM,SAAS,OAAO,OAAO,OAAO;YACpC,IAAI,MAAM,OAAO,gBAAgB;QACrC;aACG,IAAI,EAAE,cAAc,KAAK,CAAC,EAAE,EAC/B,EAAE,cAAc,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC;YAClC,WAAW,SAAS;YACpB,IAAI,SAAS,MAAM,YAAY;gBAC3B,MAAM;gBACN,MAAM,MAAM,IAAI;gBAChB,IAAI,SAAS;oBACT,IAAI,CAAC,sBAAsB;wBACvB,MAAM;wBACN,OAAO,IAAI;wBACX,QAAQ,IAAI;wBACZ,QAAQ;oBACZ,GAAG,WAAW;gBAClB;gBACA,IAAI,UAAU,CAAC;oBACX,QAAQ,IAAI,iBAAiB;gBACjC;gBACA,IAAI,cAAc;gBAClB,IAAI,MAAM;YAEd,OAAO,IAAI,SAAS,MAAM,wCAAwC;gBAC9D,MAAM;gBACN,MAAM,SAAS,CAAA,GAAA,MAAC,EAAE,eAAe,SAAS,SAAS,QAAQ,KAAK;gBAChE,UAAU,IAAI,CAAC,QAAQ;YAC3B;QACJ;IAGR;IAEA,iBAAkB,KAAe,EAAE,SAAsB,EAAQ;QAE7D,MAAM,0BAA0B;YAC5B,CAAA,GAAA,MAAC,EAAE,MAAM;gBACL,QAAQ,IAAI,CAAC;gBACb,MAAM;gBACN,SAAS,CAAA,GAAA,cAAG,EAAE,4BAA4B;gBAC1C,SAAS;oBAAC;iBAAK;YACnB;QACJ;QAEA,IAAI,qBAAqB;QACzB,0CAA0C;QAC1C,IAAK,IAAI,IAAI,GAAG,MAAM,OAAO,KAAK,CAAC,EAAE,EAAE,IAAK;YACxC,MAAM,YAAY,KAAK,KAAK,MAAM;YAClC,MAAM,YAAY,SAAS,CAAC,UAAU,SAAS,EAAE,CAAC;YAClD,IAAI,cAAc,OAEd,AAAC,CAAA,CAAC;gBACE,MAAM,kBAAkB,UAAkB,OAAO;gBACjD,MAAM,eAAe,YAAoB,MAAM;gBAC/C,MAAM,gBAAgB;gBAEtB,IAAI,EAAE,QAAQ,cAAc;oBACxB,CAAA,GAAA,MAAC,EAAE,MAAM;wBACL,QAAQ,IAAI,CAAC;wBACb,MAAM;wBACN,SAAS;wBACT,SAAS;4BAAC;yBAAK;oBACnB;oBACA;gBACJ;gBAEA,MAAM,eAAe,MAAM,WAAW,KAAK,EAAE,QAAQ;gBACrD,IAAI,eAAe;gBACnB,IAAI;gBAEJ,IAAI,cACA,CAAA,GAAA,MAAC,EAAE,MAAM;oBACL,QAAQ,IAAI,CAAC;oBACb,SAAS,CAAA,GAAA,cAAG,EAAE;oBACd,UAAU,CAAC;wBACP,eAAe;wBACf,cAAc;oBAClB;oBACA,WAAW,CAAC;wBACR,cAAc;oBAClB;gBACJ;gBAIJ,MAAM,SAAS,IAAI;gBACnB,OAAO,SAAS,CAAC;oBACb,MAAM,SAAS,CAAA,GAAA,iBAAU,EAAE,aAAa;oBAExC,CAAA,GAAA,MAAC,EAAE,YAAY,KAAK,CAAC;wBAEjB,IAAI,gBAAgB,CAAC,cACjB;wBAGJ,IAAI;4BACA,IAAI;4BAEJ,iCAAiC;4BACjC,MAAM,UAAU,QACX,OAAO,QACR;gCACI,oBAAoB;gCACpB,eAAe;gCACf,wBAAwB;4BAC5B;4BACJ,IAAI,IAAI,QAAQ,iBAAiB,IAAI,SAAS,eAAe;gCACzD,IAAI,aACA;gCAEJ,CAAA,GAAA,MAAC,EAAE,MAAM;oCACL,QAAQ,IAAI,CAAC;oCACb,MAAM;oCACN,SAAS,CAAA,GAAA,cAAG,EAAE,wBAAwB,QAAQ,QAAQ,KAAK,iBACrD,iBACA,CAAA,GAAA,cAAG,EAAE,qBAAqB,OAAO,IAAI,QAAQ,QAAQ,IAAI,SAAS,YAClE;oCAEN,SAAS;wCAAC;qCAAK;gCACnB;gCACA;4BACJ;4BAGA,qCAAqC;4BACrC,MAAM;4BAEN,IAAI;gCACA,MAAM,UAAU,QAAS,OAAO;4BACpC,EAAE,OAAO,GAAG;4BACR,8CAA8C;4BAClD;4BACA,IAAI,KAAK;gCACL,0BAA0B;gCAC1B,MAAM,eAAe,CAAA,GAAA,MAAC,EAAE,IAAI,QAAQ;gCACpC,yCAAyC;gCACzC,IAAI,cAAc,WAAW,aAAa,OACtC;gCAGJ,IAAI,aACA;gCAEJ,IAAI,CAAC,sBAAsB,cAAc,EAAE,MAAM;4BACrD,OAAO;gCACH,MAAM,UAAU,QAAS,OAAO,QAAgB;oCAAE,oBAAoB;oCAAM,eAAe;gCAAK;gCAEhG,IAAI,cAAc,SACd;gCAGJ,IAAI,aACA;gCAEJ,IAAI,CAAC,sBAAsB;oCACvB,MAAM;oCACN,OAAO,IAAI;oCACX,QAAQ,IAAI;oCACZ,QAAQ,CAAA,GAAA,sBAAe,EAAE,IAAI;oCAC7B,OAAO;gCACX,GAAG,EAAE,MAAM;4BACf;wBAEJ,EAAE,OAAO,GAAG;4BACR,eAAe;4BACf,CAAA,GAAA,MAAC,EAAE,MAAM;gCACL,QAAQ,IAAI,CAAC;gCACb,MAAM;gCACN,SAAS;gCACT,SAAS;oCAAC;iCAAK;4BACnB;4BACA,QAAQ,IAAI;4BACZ,WAAW;gCACP,MAAM,IAAI,MAAM;4BACpB;wBACJ;oBACJ,GAAG,MAAM,CAAC;wBACN,eAAe;wBACf,MAAM;oBACV;gBAEJ;gBACA,OAAO,kBAAkB;YAC7B,CAAA,EAAG;iBAEA,IAAI,KAAK,KAAK,MAAM,YACvB,AAAC,CAAA,CAAC;gBACE,OAAO,MAAM,OAAO,OAAO,OAAO;gBAClC,MAAM,MAAM,OAAO,IAAI,gBAAgB;gBACvC,MAAM,KAAK,IAAI;gBACf,GAAG,MAAM;gBACT,CAAA,GAAA,MAAC,EAAE,UAAU,IAAI;oBACb,IAAI,CAAC,sBAAsB;wBACvB,MAAM;wBACN,OAAO,GAAG;wBACV,QAAQ,GAAG;wBACX,QAAQ;oBACZ,GAAG,EAAE,MAAM;gBACf;YACJ,CAAA,EAAG;iBAEH,qBAAqB;QAE7B;QACA,IAAI,oBACA,CAAA,GAAA,MAAC,EAAE,MAAM;YACL,QAAQ,IAAI,CAAC;YACb,SAAS,CAAA,GAAA,cAAG,EAAE;YACd,MAAM;YACN,SAAS;gBAAC;aAAK;QACnB;IAER;AACJ;;;ACpgBA,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,8BAA8B,MAAM,KAAK;;;ACAlH,OAAO,UAAU,QAAQ,oBAAwB,aAAa,WAAW,4BAA4B,MAAM,KAAK;;;;;ACShH,sDAAgB;AAAT,SAAS,iBACZ,CAEC;IAGD,MAAM,SAAS;QAAC;QAAiD;KAAiC;IAClG,UAAW,UAAkB,QAAQ,QAAQ,UAAU,QAAQ,OAAO;IAEtE,OAAO,OAAO,OAAO;QACjB,MAAM,CAAC;YACH,EAAE,OAAO;QACb;QACA,MAAM;YACF,QAAQ,IAAI,CAAC;;AAEzB,CAAC;QACO;IACJ;AACJ","sources":["node_modules/@parcel/runtime-browser-hmr/lib/runtime-1f54771bdf68d5ad.js","src/app/script/main-standalone.ts","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/bb/base/base.ts","node_modules/@parcel/transformer-js/src/esmodule-helpers.js","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/math/math.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/language/language.ts","src/app/languages/languages.ts","src/app/languages/en.json","node_modules/@parcel/runtime-js/lib/runtime-011175784a2cf923.js","node_modules/@parcel/runtime-js/lib/helpers/browser/js-loader.js","node_modules/@parcel/runtime-js/lib/helpers/cacheLoader.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/runtime-179c36d9a8bac963.js","node_modules/@parcel/runtime-js/lib/runtime-230639fcd7faa690.js","node_modules/@parcel/runtime-js/lib/runtime-f4e47e72717c7b25.js","node_modules/@parcel/runtime-js/lib/runtime-d8106bf9ba40c08b.js","node_modules/@parcel/runtime-js/lib/runtime-fcfb94f499cdb00e.js","node_modules/@parcel/runtime-js/lib/runtime-bb8a7967b07dde2b.js","node_modules/@parcel/runtime-js/lib/runtime-c7c052b7b9fcaeba.js","node_modules/@parcel/runtime-js/lib/runtime-9b76580816c7f5ad.js","node_modules/@parcel/runtime-js/lib/runtime-0d95367398109618.js","node_modules/@parcel/runtime-js/lib/runtime-9c603a92f782c218.js","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-abe93a3bcffa1caa.js","node_modules/@parcel/runtime-js/lib/runtime-310a52bec968a7b8.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-32fa6c35233e0ef7.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-26d80cd110136e38.js","src/app/script/bb/base/c.ts","node_modules/@emotion/css/dist/emotion-css.esm.js","node_modules/@emotion/css/create-instance/dist/emotion-css-create-instance.esm.js","node_modules/@emotion/cache/dist/emotion-cache.browser.esm.js","node_modules/@emotion/sheet/dist/emotion-sheet.browser.esm.js","node_modules/stylis/dist/stylis.mjs","node_modules/stylis/src/Enum.js","node_modules/stylis/src/Utility.js","node_modules/stylis/src/Tokenizer.js","node_modules/stylis/src/Parser.js","node_modules/stylis/src/Prefixer.js","node_modules/stylis/src/Serializer.js","node_modules/stylis/src/Middleware.js","node_modules/@emotion/weak-memoize/dist/emotion-weak-memoize.esm.js","node_modules/@emotion/memoize/dist/emotion-memoize.esm.js","node_modules/@emotion/serialize/dist/emotion-serialize.browser.esm.js","node_modules/@emotion/hash/dist/emotion-hash.esm.js","node_modules/@emotion/unitless/dist/emotion-unitless.esm.js","node_modules/@emotion/utils/dist/emotion-utils.browser.esm.js","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-16746adc96c31815.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/theme/theme.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-217c6460d9a478a6.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/project-viewport/preview.ts","src/app/script/klecks/ui/project-viewport/project-viewport.ts","node_modules/transformation-matrix/src/index.js","node_modules/transformation-matrix/src/applyToPoint.js","node_modules/transformation-matrix/src/fromObject.js","node_modules/transformation-matrix/src/fromString.js","node_modules/transformation-matrix/src/identity.js","node_modules/transformation-matrix/src/inverse.js","node_modules/transformation-matrix/src/isAffineMatrix.js","node_modules/transformation-matrix/src/utils.js","node_modules/transformation-matrix/src/rotate.js","node_modules/transformation-matrix/src/translate.js","node_modules/transformation-matrix/src/transform.js","node_modules/transformation-matrix/src/scale.js","node_modules/transformation-matrix/src/shear.js","node_modules/transformation-matrix/src/skew.js","node_modules/transformation-matrix/src/toString.js","node_modules/transformation-matrix/src/fromTriangles.js","node_modules/transformation-matrix/src/smoothMatrix.js","node_modules/transformation-matrix/src/fromDefinition.js","node_modules/transformation-matrix/src/fromTransformAttribute.js","node_modules/transformation-matrix/src/fromTransformAttribute.autogenerated.js","node_modules/transformation-matrix/src/decompose.js","node_modules/transformation-matrix/src/flip.js","node_modules/transformation-matrix/src/fromMovingPoints.js","src/app/script/klecks/ui/project-viewport/utils/create-transform-matrix.ts","node_modules/@parcel/runtime-js/lib/runtime-a22f16efe9cf305b.js","node_modules/@parcel/runtime-js/lib/runtime-ba9a92e6e0dfda24.js","node_modules/@parcel/runtime-js/lib/runtime-98c024d227630933.js","node_modules/@parcel/runtime-js/lib/runtime-0ce93ee0957ff131.js","node_modules/@parcel/runtime-js/lib/runtime-38f2dc19a4166317.js","src/app/script/klecks/ui/project-viewport/utils/zoom-by-step.ts","src/app/script/klecks/ui/project-viewport/utils/create-transform.ts","src/app/script/klecks/ui/project-viewport/utils/to-meta-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7d9a4aee20f27655.js","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/layer-manager.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/rename-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-0cc2b2e16628b39f.js","src/app/script/klecks/ui/tool-tabs/layer-manager/merge-layer-dialog.ts","src/app/script/klecks/ui/components/dropdown-menu.ts","node_modules/@parcel/runtime-js/lib/runtime-508a42d6c368d1b8.js","node_modules/@parcel/runtime-js/lib/runtime-1b6afff04da7377d.js","node_modules/@parcel/runtime-js/lib/runtime-cb6eda809594e130.js","node_modules/@parcel/runtime-js/lib/runtime-7da78bc8a9f24402.js","node_modules/@parcel/runtime-js/lib/runtime-58eef8074ca1213e.js","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-21d5d7539365245f.js","node_modules/@parcel/runtime-js/lib/runtime-d5a8c924459f53a8.js","node_modules/@parcel/runtime-js/lib/runtime-dd8d10d5f727e024.js","node_modules/@parcel/runtime-js/lib/runtime-2d5f249b6e06ce35.js","src/app/script/klecks/events/linetool-processor.ts","src/app/script/klecks/kl-config.ts","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-102474cba6fe9f11.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","node_modules/@emotion/css/dist/emotion-css.cjs.mjs","node_modules/@emotion/css/dist/emotion-css.cjs.js","node_modules/@emotion/css/dist/emotion-css.cjs.dev.js","node_modules/@emotion/css/create-instance/dist/emotion-css-create-instance.cjs.dev.js","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/utils/test-is-small.ts","src/app/script/klecks/ui/utils/preview-size.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-e7396b14933b9d4f.js","node_modules/@parcel/runtime-js/lib/runtime-b94e3fd51bd5a1fb.js","node_modules/@parcel/runtime-js/lib/runtime-cd55bd5b29b0854d.js","node_modules/@parcel/runtime-js/lib/runtime-5a58ee17dd2b408c.js","node_modules/@parcel/runtime-js/lib/runtime-64502057c89fe24c.js","node_modules/@parcel/runtime-js/lib/runtime-44a54c1f729adf05.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-49f9830dd7e4a8a5.js","node_modules/@parcel/runtime-js/lib/runtime-312d8ca59f25beec.js","node_modules/@parcel/runtime-js/lib/runtime-620a789fed1c47c3.js","node_modules/@parcel/runtime-js/lib/runtime-aed34e5e50e2dd7f.js","node_modules/@parcel/runtime-js/lib/runtime-65c456ee6ace9cf7.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-de1db8c5ebfb630a.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-d1dcd610da41d36b.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72f76e60a021d8cb.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-5c55ef953690d4c5.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-fill-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-font-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-f40149dff242be9d.js","node_modules/@parcel/runtime-js/lib/runtime-3aeed648e8325c99.js","node_modules/@parcel/runtime-js/lib/runtime-58ed3760030d82d7.js","node_modules/@parcel/runtime-js/lib/runtime-319b4c825d45f4e9.js","node_modules/@parcel/runtime-js/lib/runtime-6bfe24ba75ce782e.js","src/app/fonts/fonts.ts","node_modules/@parcel/runtime-js/lib/runtime-0f1da7ed4e63dbb5.js","node_modules/@parcel/runtime-js/lib/runtime-b8b7962c1aa0d865.js","node_modules/@parcel/runtime-js/lib/runtime-e6829cfec19ef754.js","node_modules/@parcel/runtime-js/lib/runtime-e81b66f18d80e319.js","node_modules/@parcel/runtime-js/lib/runtime-d3ae0861ed71e315.js","node_modules/@parcel/runtime-js/lib/runtime-0b8ff7c0434545d0.js","node_modules/@parcel/runtime-js/lib/runtime-6dc1b7552f9fee58.js","node_modules/@parcel/runtime-js/lib/runtime-0dcf1e55065122e6.js","node_modules/@parcel/runtime-js/lib/runtime-4d76ed0a66b72322.js","node_modules/@parcel/runtime-js/lib/runtime-85053dd042557158.js","node_modules/@parcel/runtime-js/lib/runtime-8ec4e00b8de552bf.js","node_modules/@parcel/runtime-js/lib/runtime-7e3e8a7c13a6d1e5.js","node_modules/@parcel/runtime-js/lib/runtime-65ab6d701d3647ac.js","node_modules/@parcel/runtime-js/lib/runtime-3ce9f1db30e5b164.js","node_modules/@parcel/runtime-js/lib/runtime-911990b4f0be5b4c.js","node_modules/@parcel/runtime-js/lib/runtime-7647cb1a99dae3e5.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-stroke-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-text-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-viewport-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.module.scss","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-ad1b25bb1f7bc3ad.js","node_modules/@parcel/runtime-js/lib/runtime-9741eb00e96cb4ca.js","node_modules/@parcel/runtime-js/lib/runtime-2f26d740b9ef7889.js","node_modules/@parcel/runtime-js/lib/runtime-089e92220538a765.js","node_modules/@parcel/runtime-js/lib/runtime-41b63628d361ca3b.js","node_modules/@parcel/runtime-js/lib/runtime-a86153298cb62b3d.js","node_modules/@parcel/runtime-js/lib/runtime-48734b705d571a44.js","node_modules/@parcel/runtime-js/lib/runtime-6bee880d01411c88.js","node_modules/@parcel/runtime-js/lib/runtime-6b59219d6384452e.js","node_modules/@parcel/runtime-js/lib/runtime-26627c52e1cc3d30.js","node_modules/@parcel/runtime-js/lib/runtime-1792366011c68b02.js","node_modules/@parcel/runtime-js/lib/runtime-2d106067af2f3a0d.js","node_modules/@parcel/runtime-js/lib/runtime-46c1165dace1cbb4.js","node_modules/@parcel/runtime-js/lib/runtime-0b9398bd90a6c890.js","node_modules/@parcel/runtime-js/lib/runtime-26a63c0e1f58ab81.js","node_modules/@parcel/runtime-js/lib/runtime-4b1bb49680b9c7c0.js","node_modules/@parcel/runtime-js/lib/runtime-b4ccdad4a99f46a3.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f7ae82d8265fcc8f.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-636f02c6546cfa74.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-704b428f3592744a.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9a4e09b50b958ea3.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-10d37433f8d5ecf5.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-8357f1f0cdcec91a.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c758102f63a97e0c.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-2a75d5e1b333cb2c.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-529fb3e091bf7796.js","src/app/script/klecks/storage/load-ag-psd.ts","node_modules/@parcel/runtime-js/lib/runtime-a25489f9c47fa74e.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-e2587b0dace1a81b.js","node_modules/@parcel/runtime-js/lib/runtime-aa8850f432ce0937.js","src/app/script/klecks/ui/modals/licenses-dialog/show-licenses-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-9fde973ff1fc0c70.js","node_modules/@parcel/runtime-js/lib/runtime-7868f7f5081f9cff.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/app/kl-app.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/ui/project-viewport/fx-preview-renderer.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/ui/components/draggable-input.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-3011cf002b4be48c.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/import-handler.ts","node_modules/@parcel/runtime-js/lib/runtime-32a5b5edc49a71eb.js","node_modules/@parcel/runtime-js/lib/runtime-7d5d7a9198fe07c9.js","src/app/script/app/console-api.ts"],"sourcesContent":["var HMR_HOST = null;var HMR_PORT = null;var HMR_SECURE = false;var HMR_ENV_HASH = \"d6ea1d42532a7575\";module.bundle.HMR_BUNDLE_ID = \"9808432d9aa0ef6a\";\"use strict\";\n\n/* global HMR_HOST, HMR_PORT, HMR_ENV_HASH, HMR_SECURE, chrome, browser, __parcel__import__, __parcel__importScripts__, ServiceWorkerGlobalScope */\n/*::\nimport type {\n  HMRAsset,\n  HMRMessage,\n} from '@parcel/reporter-dev-server/src/HMRServer.js';\ninterface ParcelRequire {\n  (string): mixed;\n  cache: {|[string]: ParcelModule|};\n  hotData: {|[string]: mixed|};\n  Module: any;\n  parent: ?ParcelRequire;\n  isParcelRequire: true;\n  modules: {|[string]: [Function, {|[string]: string|}]|};\n  HMR_BUNDLE_ID: string;\n  root: ParcelRequire;\n}\ninterface ParcelModule {\n  hot: {|\n    data: mixed,\n    accept(cb: (Function) => void): void,\n    dispose(cb: (mixed) => void): void,\n    // accept(deps: Array<string> | string, cb: (Function) => void): void,\n    // decline(): void,\n    _acceptCallbacks: Array<(Function) => void>,\n    _disposeCallbacks: Array<(mixed) => void>,\n  |};\n}\ninterface ExtensionContext {\n  runtime: {|\n    reload(): void,\n    getURL(url: string): string;\n    getManifest(): {manifest_version: number, ...};\n  |};\n}\ndeclare var module: {bundle: ParcelRequire, ...};\ndeclare var HMR_HOST: string;\ndeclare var HMR_PORT: string;\ndeclare var HMR_ENV_HASH: string;\ndeclare var HMR_SECURE: boolean;\ndeclare var chrome: ExtensionContext;\ndeclare var browser: ExtensionContext;\ndeclare var __parcel__import__: (string) => Promise<void>;\ndeclare var __parcel__importScripts__: (string) => Promise<void>;\ndeclare var globalThis: typeof self;\ndeclare var ServiceWorkerGlobalScope: Object;\n*/\nvar OVERLAY_ID = '__parcel__error__overlay__';\nvar OldModule = module.bundle.Module;\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData[moduleName],\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n  module.bundle.hotData[moduleName] = undefined;\n}\nmodule.bundle.Module = Module;\nmodule.bundle.hotData = {};\nvar checkedAssets /*: {|[string]: boolean|} */, assetsToDispose /*: Array<[ParcelRequire, string]> */, assetsToAccept /*: Array<[ParcelRequire, string]> */;\n\nfunction getHostname() {\n  return HMR_HOST || (location.protocol.indexOf('http') === 0 ? location.hostname : 'localhost');\n}\nfunction getPort() {\n  return HMR_PORT || location.port;\n}\n\n// eslint-disable-next-line no-redeclare\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = getHostname();\n  var port = getPort();\n  var protocol = HMR_SECURE || location.protocol == 'https:' && !/localhost|127.0.0.1|0.0.0.0/.test(hostname) ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + (port ? ':' + port : '') + '/');\n\n  // Web extension context\n  var extCtx = typeof chrome === 'undefined' ? typeof browser === 'undefined' ? null : browser : chrome;\n\n  // Safari doesn't support sourceURL in error stacks.\n  // eval may also be disabled via CSP, so do a quick check.\n  var supportsSourceURL = false;\n  try {\n    (0, eval)('throw new Error(\"test\"); //# sourceURL=test.js');\n  } catch (err) {\n    supportsSourceURL = err.stack.includes('test.js');\n  }\n\n  // $FlowFixMe\n  ws.onmessage = async function (event /*: {data: string, ...} */) {\n    checkedAssets = {} /*: {|[string]: boolean|} */;\n    assetsToAccept = [];\n    assetsToDispose = [];\n    var data /*: HMRMessage */ = JSON.parse(event.data);\n    if (data.type === 'update') {\n      // Remove error overlay if there is one\n      if (typeof document !== 'undefined') {\n        removeErrorOverlay();\n      }\n      let assets = data.assets.filter(asset => asset.envHash === HMR_ENV_HASH);\n\n      // Handle HMR Update\n      let handled = assets.every(asset => {\n        return asset.type === 'css' || asset.type === 'js' && hmrAcceptCheck(module.bundle.root, asset.id, asset.depsByBundle);\n      });\n      if (handled) {\n        console.clear();\n\n        // Dispatch custom event so other runtimes (e.g React Refresh) are aware.\n        if (typeof window !== 'undefined' && typeof CustomEvent !== 'undefined') {\n          window.dispatchEvent(new CustomEvent('parcelhmraccept'));\n        }\n        await hmrApplyUpdates(assets);\n\n        // Dispose all old assets.\n        let processedAssets = {} /*: {|[string]: boolean|} */;\n        for (let i = 0; i < assetsToDispose.length; i++) {\n          let id = assetsToDispose[i][1];\n          if (!processedAssets[id]) {\n            hmrDispose(assetsToDispose[i][0], id);\n            processedAssets[id] = true;\n          }\n        }\n\n        // Run accept callbacks. This will also re-execute other disposed assets in topological order.\n        processedAssets = {};\n        for (let i = 0; i < assetsToAccept.length; i++) {\n          let id = assetsToAccept[i][1];\n          if (!processedAssets[id]) {\n            hmrAccept(assetsToAccept[i][0], id);\n            processedAssets[id] = true;\n          }\n        }\n      } else fullReload();\n    }\n    if (data.type === 'error') {\n      // Log parcel errors to console\n      for (let ansiDiagnostic of data.diagnostics.ansi) {\n        let stack = ansiDiagnostic.codeframe ? ansiDiagnostic.codeframe : ansiDiagnostic.stack;\n        console.error(' [parcel]: ' + ansiDiagnostic.message + '\\n' + stack + '\\n\\n' + ansiDiagnostic.hints.join('\\n'));\n      }\n      if (typeof document !== 'undefined') {\n        // Render the fancy html overlay\n        removeErrorOverlay();\n        var overlay = createErrorOverlay(data.diagnostics.html);\n        // $FlowFixMe\n        document.body.appendChild(overlay);\n      }\n    }\n  };\n  ws.onerror = function (e) {\n    console.error(e.message);\n  };\n  ws.onclose = function () {\n    console.warn('[parcel]  Connection to the HMR server was lost');\n  };\n}\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n    console.log('[parcel]  Error resolved');\n  }\n}\nfunction createErrorOverlay(diagnostics) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n  let errorHTML = '<div style=\"background: black; opacity: 0.85; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; font-family: Menlo, Consolas, monospace; z-index: 9999;\">';\n  for (let diagnostic of diagnostics) {\n    let stack = diagnostic.frames.length ? diagnostic.frames.reduce((p, frame) => {\n      return `${p}\n<a href=\"/__parcel_launch_editor?file=${encodeURIComponent(frame.location)}\" style=\"text-decoration: underline; color: #888\" onclick=\"fetch(this.href); return false\">${frame.location}</a>\n${frame.code}`;\n    }, '') : diagnostic.stack;\n    errorHTML += `\n      <div>\n        <div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">\n           ${diagnostic.message}\n        </div>\n        <pre>${stack}</pre>\n        <div>\n          ${diagnostic.hints.map(hint => '<div> ' + hint + '</div>').join('')}\n        </div>\n        ${diagnostic.documentation ? `<div> <a style=\"color: violet\" href=\"${diagnostic.documentation}\" target=\"_blank\">Learn more</a></div>` : ''}\n      </div>\n    `;\n  }\n  errorHTML += '</div>';\n  overlay.innerHTML = errorHTML;\n  return overlay;\n}\nfunction fullReload() {\n  if ('reload' in location) {\n    location.reload();\n  } else if (extCtx && extCtx.runtime && extCtx.runtime.reload) {\n    extCtx.runtime.reload();\n  }\n}\nfunction getParents(bundle, id) /*: Array<[ParcelRequire, string]> */{\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n  var parents = [];\n  var k, d, dep;\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || Array.isArray(dep) && dep[dep.length - 1] === id) {\n        parents.push([bundle, k]);\n      }\n    }\n  }\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n  return parents;\n}\nfunction updateLink(link) {\n  var href = link.getAttribute('href');\n  if (!href) {\n    return;\n  }\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    if (link.parentNode !== null) {\n      // $FlowFixMe\n      link.parentNode.removeChild(link);\n    }\n  };\n  newLink.setAttribute('href',\n  // $FlowFixMe\n  href.split('?')[0] + '?' + Date.now());\n  // $FlowFixMe\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout) {\n    return;\n  }\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      // $FlowFixMe[incompatible-type]\n      var href /*: string */ = links[i].getAttribute('href');\n      var hostname = getHostname();\n      var servedFromHMRServer = hostname === 'localhost' ? new RegExp('^(https?:\\\\/\\\\/(0.0.0.0|127.0.0.1)|localhost):' + getPort()).test(href) : href.indexOf(hostname + ':' + getPort());\n      var absolute = /^https?:\\/\\//i.test(href) && href.indexOf(location.origin) !== 0 && !servedFromHMRServer;\n      if (!absolute) {\n        updateLink(links[i]);\n      }\n    }\n    cssTimeout = null;\n  }, 50);\n}\nfunction hmrDownload(asset) {\n  if (asset.type === 'js') {\n    if (typeof document !== 'undefined') {\n      let script = document.createElement('script');\n      script.src = asset.url + '?t=' + Date.now();\n      if (asset.outputFormat === 'esmodule') {\n        script.type = 'module';\n      }\n      return new Promise((resolve, reject) => {\n        var _document$head;\n        script.onload = () => resolve(script);\n        script.onerror = reject;\n        (_document$head = document.head) === null || _document$head === void 0 ? void 0 : _document$head.appendChild(script);\n      });\n    } else if (typeof importScripts === 'function') {\n      // Worker scripts\n      if (asset.outputFormat === 'esmodule') {\n        return __parcel__import__(asset.url + '?t=' + Date.now());\n      } else {\n        return new Promise((resolve, reject) => {\n          try {\n            __parcel__importScripts__(asset.url + '?t=' + Date.now());\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        });\n      }\n    }\n  }\n}\nasync function hmrApplyUpdates(assets) {\n  global.parcelHotUpdate = Object.create(null);\n  let scriptsToRemove;\n  try {\n    // If sourceURL comments aren't supported in eval, we need to load\n    // the update from the dev server over HTTP so that stack traces\n    // are correct in errors/logs. This is much slower than eval, so\n    // we only do it if needed (currently just Safari).\n    // https://bugs.webkit.org/show_bug.cgi?id=137297\n    // This path is also taken if a CSP disallows eval.\n    if (!supportsSourceURL) {\n      let promises = assets.map(asset => {\n        var _hmrDownload;\n        return (_hmrDownload = hmrDownload(asset)) === null || _hmrDownload === void 0 ? void 0 : _hmrDownload.catch(err => {\n          // Web extension bugfix for Chromium\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=1255412#c12\n          if (extCtx && extCtx.runtime && extCtx.runtime.getManifest().manifest_version == 3) {\n            if (typeof ServiceWorkerGlobalScope != 'undefined' && global instanceof ServiceWorkerGlobalScope) {\n              extCtx.runtime.reload();\n              return;\n            }\n            asset.url = extCtx.runtime.getURL('/__parcel_hmr_proxy__?url=' + encodeURIComponent(asset.url + '?t=' + Date.now()));\n            return hmrDownload(asset);\n          }\n          throw err;\n        });\n      });\n      scriptsToRemove = await Promise.all(promises);\n    }\n    assets.forEach(function (asset) {\n      hmrApply(module.bundle.root, asset);\n    });\n  } finally {\n    delete global.parcelHotUpdate;\n    if (scriptsToRemove) {\n      scriptsToRemove.forEach(script => {\n        if (script) {\n          var _document$head2;\n          (_document$head2 = document.head) === null || _document$head2 === void 0 ? void 0 : _document$head2.removeChild(script);\n        }\n      });\n    }\n  }\n}\nfunction hmrApply(bundle /*: ParcelRequire */, asset /*:  HMRAsset */) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (asset.type === 'css') {\n    reloadCSS();\n  } else if (asset.type === 'js') {\n    let deps = asset.depsByBundle[bundle.HMR_BUNDLE_ID];\n    if (deps) {\n      if (modules[asset.id]) {\n        // Remove dependencies that are removed and will become orphaned.\n        // This is necessary so that if the asset is added back again, the cache is gone, and we prevent a full page reload.\n        let oldDeps = modules[asset.id][1];\n        for (let dep in oldDeps) {\n          if (!deps[dep] || deps[dep] !== oldDeps[dep]) {\n            let id = oldDeps[dep];\n            let parents = getParents(module.bundle.root, id);\n            if (parents.length === 1) {\n              hmrDelete(module.bundle.root, id);\n            }\n          }\n        }\n      }\n      if (supportsSourceURL) {\n        // Global eval. We would use `new Function` here but browser\n        // support for source maps is better with eval.\n        (0, eval)(asset.output);\n      }\n\n      // $FlowFixMe\n      let fn = global.parcelHotUpdate[asset.id];\n      modules[asset.id] = [fn, deps];\n    } else if (bundle.parent) {\n      hmrApply(bundle.parent, asset);\n    }\n  }\n}\nfunction hmrDelete(bundle, id) {\n  let modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (modules[id]) {\n    // Collect dependencies that will become orphaned when this module is deleted.\n    let deps = modules[id][1];\n    let orphans = [];\n    for (let dep in deps) {\n      let parents = getParents(module.bundle.root, deps[dep]);\n      if (parents.length === 1) {\n        orphans.push(deps[dep]);\n      }\n    }\n\n    // Delete the module. This must be done before deleting dependencies in case of circular dependencies.\n    delete modules[id];\n    delete bundle.cache[id];\n\n    // Now delete the orphans.\n    orphans.forEach(id => {\n      hmrDelete(module.bundle.root, id);\n    });\n  } else if (bundle.parent) {\n    hmrDelete(bundle.parent, id);\n  }\n}\nfunction hmrAcceptCheck(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  if (hmrAcceptCheckOne(bundle, id, depsByBundle)) {\n    return true;\n  }\n\n  // Traverse parents breadth first. All possible ancestries must accept the HMR update, or we'll reload.\n  let parents = getParents(module.bundle.root, id);\n  let accepted = false;\n  while (parents.length > 0) {\n    let v = parents.shift();\n    let a = hmrAcceptCheckOne(v[0], v[1], null);\n    if (a) {\n      // If this parent accepts, stop traversing upward, but still consider siblings.\n      accepted = true;\n    } else {\n      // Otherwise, queue the parents in the next level upward.\n      let p = getParents(module.bundle.root, v[1]);\n      if (p.length === 0) {\n        // If there are no parents, then we've reached an entry without accepting. Reload.\n        accepted = false;\n        break;\n      }\n      parents.push(...p);\n    }\n  }\n  return accepted;\n}\nfunction hmrAcceptCheckOne(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (depsByBundle && !depsByBundle[bundle.HMR_BUNDLE_ID]) {\n    // If we reached the root bundle without finding where the asset should go,\n    // there's nothing to do. Mark as \"accepted\" so we don't reload the page.\n    if (!bundle.parent) {\n      return true;\n    }\n    return hmrAcceptCheck(bundle.parent, id, depsByBundle);\n  }\n  if (checkedAssets[id]) {\n    return true;\n  }\n  checkedAssets[id] = true;\n  var cached = bundle.cache[id];\n  assetsToDispose.push([bundle, id]);\n  if (!cached || cached.hot && cached.hot._acceptCallbacks.length) {\n    assetsToAccept.push([bundle, id]);\n    return true;\n  }\n}\nfunction hmrDispose(bundle /*: ParcelRequire */, id /*: string */) {\n  var cached = bundle.cache[id];\n  bundle.hotData[id] = {};\n  if (cached && cached.hot) {\n    cached.hot.data = bundle.hotData[id];\n  }\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData[id]);\n    });\n  }\n  delete bundle.cache[id];\n}\nfunction hmrAccept(bundle /*: ParcelRequire */, id /*: string */) {\n  // Execute the module.\n  bundle(id);\n\n  // Run the accept callbacks in the new version of the module.\n  var cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      var assetsToAlsoAccept = cb(function () {\n        return getParents(module.bundle.root, id);\n      });\n      if (assetsToAlsoAccept && assetsToAccept.length) {\n        assetsToAlsoAccept.forEach(function (a) {\n          hmrDispose(a[0], a[1]);\n        });\n\n        // $FlowFixMe[method-unbinding]\n        assetsToAccept.push.apply(assetsToAccept, assetsToAlsoAccept);\n      }\n    });\n  }\n}","/**\n * by bitbof (bitbof.com)\n */\n\nimport './polyfills/polyfills';\nimport {KL} from './klecks/kl';\nimport {klHistory} from './klecks/history/kl-history';\nimport {KlApp} from './app/kl-app';\nimport {IKlProject} from './klecks/kl-types';\nimport {ProjectStore} from './klecks/storage/project-store';\nimport {initLANG, LANG} from './language/language';\nimport '../script/theme/theme';\n\nfunction initError (e: Error): void {\n    const el = document.createElement('div');\n    el.style.textAlign = 'center';\n    el.style.background = '#fff';\n    el.style.padding = '20px';\n    el.innerHTML = '<h1>App failed to initialize</h1>';\n    const errorMsg = document.createElement('div');\n    errorMsg.textContent = 'Error: ' + (e.message ? e.message : ('' + e));\n    el.append(errorMsg);\n    document.body.append(el);\n    console.error(e);\n}\n\n(async () => {\n    let klApp: KlApp;\n    let domIsLoaded = false;\n\n    try {\n        window.addEventListener('DOMContentLoaded', () => {\n            domIsLoaded = true;\n        });\n        await initLANG();\n    } catch (e) {\n        initError(e as Error);\n        return;\n    }\n\n    function onProjectLoaded (project: IKlProject | null, projectStore: ProjectStore) {\n        if (klApp) {\n            throw 'onKlProjectObjLoaded called more than once';\n        }\n        // in case an extension manipulated the page\n        const loadingScreenEl = document.getElementById('loading-screen');\n        loadingScreenEl?.remove();\n\n        const saveReminder = new KL.SaveReminder(\n            klHistory,\n            true,\n            true,\n            () => klApp.saveAsPsd(),\n            () => {\n                return klApp ? klApp.isDrawing() : false;\n            },\n            null,\n            null,\n        );\n        klApp = new KlApp(\n            project,\n            {\n                saveReminder,\n                projectStore,\n            }\n        );\n        saveReminder.init();\n        if (project) {\n            setTimeout(() => {\n                klApp.out(LANG('file-storage-restored'));\n            }, 100);\n        }\n\n        document.body.append(klApp.getEl());\n    }\n\n    async function onDomLoaded () {\n        try {\n            window.removeEventListener('DOMContentLoaded', onDomLoaded);\n            const projectStore = new KL.ProjectStore();\n            let project: IKlProject | null = null;\n            try {\n                const readResult = await projectStore.read();\n                if (readResult) {\n                    project = readResult.project;\n                }\n            } catch(e) {\n                let message: string;\n                if ((e as Error).message.indexOf('db-error') === 0) {\n                    message = 'Failed to access Browser Storage';\n                } else if ((e as Error).message.indexOf('format-error') === 0) {\n                    message = 'Failed to restore from Browser Storage';\n                } else {\n                    message = 'Failed to restore from Browser Storage';\n                }\n                if (message) {\n                    setTimeout(function () {\n                        klApp && klApp.out(message);\n                        throw new Error('Initial browser storage error, ' + e);\n                    }, 100);\n                }\n            }\n            onProjectLoaded(project, projectStore);\n        } catch (e) {\n            initError(e as Error);\n        }\n\n    }\n    if (domIsLoaded) {\n        onDomLoaded();\n    } else {\n        window.addEventListener('DOMContentLoaded', onDomLoaded);\n    }\n})();\n\n","import './polyfills-nomodule';\n\n/*\n * ---- Below ----------------------\n * features that didn't have support until *after* browsers supported the modules script tag:\n * Chrome 61\n * Edge 16\n * Safari 11\n * Firefox 60\n * https://caniuse.com/es6-module\n */\n\n// chrome 61, edge 79, safari 16, firefox 107\nif (!('scrollTo' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollTo', {\n        value: function (x: number, y: number) {\n            this.scrollLeft = x;\n            this.scrollTop = y;\n        },\n    });\n}\n\n// chrome 61, edge 79, safari 16, firefox 107\nif (!('scrollBy' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollBy', {\n        value: function (x: number, y: number) {\n            this.scrollLeft += x;\n            this.scrollTop += y;\n        },\n    });\n}\n\n// chrome 69, edge 79, safari 12, firefox 62\nif (!Array.prototype.flat) {\n    Object.defineProperty(Array.prototype, 'flat', {\n        configurable: true,\n        value: function flat (...args: any[]) {\n            const depth = isNaN(args[0]) ? 1 : Number(args[0]);\n\n            return depth ? Array.prototype.reduce.call(this, function (acc: any, cur) {\n                if (Array.isArray(cur)) {\n                    // eslint-disable-next-line prefer-spread\n                    acc.push.apply(acc, flat.call(cur, depth - 1));\n                } else {\n                    acc.push(cur);\n                }\n\n                return acc;\n            }, []) : Array.prototype.slice.call(this);\n        },\n        writable: true,\n    });\n}\n\n// Chrome 85, Firefox 77, Safari 13.1\n// if there are problems, maybe use core-js\nif (!String.prototype.replaceAll) {\n    Object.defineProperty(String.prototype, 'replaceAll', {\n        value: function (searchValue: string | RegExp, replaceValue: string): string {\n            if (typeof replaceValue === 'function') {\n                throw new Error('replaceAll polyfill does not support replaceValue: function');\n            }\n            return this.replace(new RegExp(searchValue, 'g'), replaceValue);\n        },\n    });\n}\n\n/*\n    Copyright 2018  Alfredo Mungo <alfredo.mungo@protonmail.ch>\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to\n    deal in the Software without restriction, including without limitation the\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in\n    all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n    IN THE SOFTWARE.\n*/\nif (!Object.fromEntries) {\n    Object.defineProperty(Object, 'fromEntries', {\n        value (entries: any) {\n            if (!entries || !entries[Symbol.iterator]) {\n                throw new Error('Object.fromEntries() requires a single iterable argument');\n            }\n            const o: any = {};\n            Object.keys(entries).forEach((key) => {\n                const [k, v] = entries[key];\n                o[k] = v;\n            });\n            return o;\n        },\n    });\n}\n\n// sometimes Android WebView has no localStorage\nif (!('localStorage' in window)) {\n    try {\n        (window as any).localStorage = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n        };\n    } catch (e) {\n        // maybe it fails?\n    }\n}\n","/**\n * features that were available before module script tags:\n * chrome 61\n * edge 16\n * safari 11\n * firefox 60\n * https://caniuse.com/es6-module\n */\n\nimport 'mdn-polyfills/Node.prototype.append';\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\nimport 'mdn-polyfills/String.prototype.padStart';\nimport 'mdn-polyfills/Array.prototype.findIndex';","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {DecoyKlHistory, klHistory} from './history/kl-history';\nimport {showModal} from './ui/modals/base/showModal';\nimport {DynamicModal} from './ui/modals/base/dynamic-modal';\nimport {dialogCounter} from './ui/modals/modal-count';\nimport {Checkbox} from './ui/components/checkbox';\nimport {input} from './ui/components/input';\nimport {Select} from './ui/components/select';\nimport {ImageToggle} from './ui/components/image-toggle';\nimport {ImageRadioList} from './ui/components/image-radio-list';\nimport {createPenPressureToggle} from './ui/components/create-pen-pressure-toggle';\nimport {KlSlider} from './ui/components/kl-slider';\nimport {calcSliderFalloffFactor} from './ui/components/slider-falloff';\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\nimport {KlColorSlider} from './ui/components/kl-color-slider';\nimport {KlColorSliderSmall} from './ui/components/kl-color-slider-small';\nimport {PointSlider} from './ui/components/point-slider';\nimport {ColorOptions} from './ui/components/color-options';\nimport {Options} from './ui/components/options';\nimport {StatusOverlay} from './ui/components/status-overlay';\nimport {CropCopy} from './ui/components/crop-copy';\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\nimport {LayerManager} from './ui/tool-tabs/layer-manager/layer-manager';\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\nimport {FreeTransform} from './ui/components/free-transform';\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\nimport {Cropper} from './ui/components/cropper';\nimport {LayerPreview} from './ui/components/layer-preview';\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\nimport {ToolDropdown} from './ui/components/tool-dropdown';\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\nimport {TabRow} from './ui/components/tab-row';\nimport {HandUi} from './ui/tool-tabs/hand-ui';\nimport {FillUi} from './ui/tool-tabs/fill-ui';\nimport {TextUi} from './ui/tool-tabs/text-ui';\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\nimport {newImageDialog} from './ui/modals/new-image-dialog';\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\nimport {renderText} from './image-operations/render-text';\nimport {textToolDialog} from './ui/modals/text-tool-dialog/text-tool-dialog';\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\nimport {floodFillBits} from './image-operations/flood-fill';\nimport * as PSD from './storage/psd';\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\nimport {KlCanvas} from './canvas/kl-canvas';\nimport * as indexedDb from './storage/indexed-db';\nimport {setDbName} from './storage/indexed-db';\nimport {filterLib, filterLibStatus} from './filters/filters';\nimport {brushes} from './brushes/brushes';\nimport {brushesUI} from './brushes-ui/brushes-ui';\nimport {showIframeModal} from './ui/modals/show-iframe-modal';\nimport {RadioList} from './ui/components/radio-list';\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\nimport {drawProject} from './canvas/draw-project';\nimport {ProjectStore} from './storage/project-store';\nimport {FileTab} from './ui/tool-tabs/file-tab';\nimport {FilterTab} from './ui/tool-tabs/filter-tab';\nimport {imgurUpload} from './ui/modals/imgur-upload';\nimport {loadAgPsd} from './storage/load-ag-psd';\nimport {SaveReminder} from './ui/components/save-reminder';\nimport {SaveToComputer} from './storage/save-to-computer';\nimport {UndoRedoCatchup} from './history/undo-redo-catchup';\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\nimport {BoxToggle} from './ui/components/box-toggle';\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\n\n/**\n * paint tool functionality\n */\nexport const KL = {\n\n    // --- brushes ---\n    brushes,\n    brushesUI,\n    BrushSettingService,\n\n    // --- canvas ---\n    KlCanvas,\n    drawProject,\n\n    // --- canvas ui ---\n    WorkspaceSvgOverlay,\n    KlCanvasWorkspace,\n    KlCanvasPreview,\n\n    // --- filters ---\n    filterLibStatus,\n    filterLib,\n\n    // --- history ---\n    UndoRedoCatchup,\n\n    // --- image operations ---\n    renderText,\n    floodFillBits,\n    ShapeTool,\n    drawShape,\n    GradientTool,\n    drawGradient,\n\n    // --- storage ---\n    PSD,\n    setDbName,\n    indexedDb,\n    ProjectStore,\n    loadAgPsd,\n    SaveToComputer,\n    \n    // --- ui - components ---\n    calcSliderFalloffFactor,\n    Checkbox,\n    input,\n    Select,\n    ImageToggle,\n    ImageRadioList,\n    RadioList,\n    createPenPressureToggle,\n    KlSlider,\n    HexColorDialog,\n    KlColorSlider,\n    KlColorSliderSmall,\n    PointSlider,\n    ColorOptions,\n    Options,\n    BoxToggle,\n    StatusOverlay,\n    CropCopy,\n    FreeTransform,\n    FreeTransformCanvas,\n    Cropper,\n    LayerPreview,\n    KlImageDropper,\n    OverlayToolspace,\n    ToolspaceTopRow,\n    ToolDropdown,\n    ToolspaceToolRow,\n    ToolspaceStabilizerRow,\n    TabRow,\n    ToolspaceCollapser,\n    BrowserStorageUi,\n    SaveReminder,\n    ToolspaceScroller,\n\n    // --- ui - modals ---\n    dialogCounter,\n    popup: showModal,\n    Popup: DynamicModal,\n    clipboardDialog,\n    showImportAsLayerDialog,\n    newImageDialog,\n    textToolDialog,\n    showImportImageDialog,\n    showIframePopup: showIframeModal,\n    imgurUpload,\n\n    // --- ui - tool tabs ---\n    HandUi,\n    FillUi,\n    GradientUi,\n    TextUi,\n    ShapeUi,\n    FileTab,\n    FilterTab,\n    SettingsTab,\n    LayerManager,\n\n    klHistory,\n    DecoyKlHistory,\n};\n\nObject.keys(KL); // without this, parcel build may break this object","\n\n// --------- history entry types ------------------------------\nimport {throwIfNull} from '../../bb/base/base';\n\nexport interface IHistoryAction {\n    action: string;\n    params: any[];\n}\n\nexport interface IHistoryEntry {\n    tool: string[];\n    action?: string;\n    params?: any[];\n    actions?: IHistoryAction[];\n}\n\ntype THistoryActionParams<T> = T extends (...args: infer A) => void ? A : never;\nexport type THistoryActions<ToolName, T> = {\n    [K in keyof T]: {\n        tool: [ToolName];\n        action: K;\n        params: THistoryActionParams<T[K]>;\n    }\n}[keyof T];\n\nexport type THistoryInnerActions<T> = {\n    [K in keyof T]: {\n        action: K;\n        params: THistoryActionParams<T[K]>;\n    }\n}[keyof T];\n\nexport type THistoryEntryG<Tool extends string[], Action extends string, Params extends unknown[]> = {\n    tool: Tool;\n    action: Action;\n    params: Params;\n}\n\nexport type TMiscImportImageHistoryEntry = THistoryEntryG<\n    ['misc'],\n    'importImage',\n    [HTMLCanvasElement, string | undefined]>;\n\nexport type TMiscFocusLayerHistoryEntry = THistoryEntryG<\n    ['misc'],\n    'focusLayer',\n    [number]>;\n\n// --------- classes etc ------------------------------\n\nexport interface IHistoryBroadcast {\n    bufferUpdate: IHistoryEntry;\n}\n\nlet historyInstance: boolean = false;\n\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\n\nexport interface KlHistoryInterface {\n    pause (b: boolean): void;\n    addListener (l: IHistoryListener): void;\n    push (e: IHistoryEntry): void;\n    undo (): IHistoryEntry[];\n    redo (): IHistoryEntry | undefined;\n    getAll (): (IHistoryEntry | null)[];\n    canRedo (): boolean;\n    canUndo (): boolean;\n    getState (): number;\n    getActionNumber (): number;\n}\n\nexport class DecoyKlHistory implements KlHistoryInterface {\n    pause (): void {}\n    addListener (): void {}\n    push (): void {}\n    undo (): IHistoryEntry[] { return []; }\n    redo (): (IHistoryEntry | undefined) { return undefined; }\n    getAll (): (IHistoryEntry | null)[] { return []; }\n    canRedo (): boolean { return false; }\n    canUndo (): boolean { return false; }\n    getState (): number { return 0; }\n    getActionNumber (): number { return 0; }\n}\n\nconst DO_DELETE_OLD = true;\n\nexport class KlHistory implements KlHistoryInterface {\n\n    private state: number; // on .push state increments by one\n    private readonly entries: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\n    private readonly listeners: IHistoryListener[];\n    private pauseStack: number; // how often paused without unpause\n    private readonly max: number = 20; // max number undo steps\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\n    \n    private broadcast (p: IHistoryBroadcast | null): void {\n        setTimeout(() => {\n            for (let i = 0; i < this.listeners.length; i++) {\n                this.listeners[i](p);\n            }\n            this.state++;\n        }, 1);\n    }\n    \n    // ---- public ----\n    \n    constructor () {\n        if (historyInstance) {\n            throw new Error('klHistory already instantiated');\n        }\n        historyInstance = true;\n        this.state = 0;\n        this.entries = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n\n    /**\n     * Needed, because sometimes there are actions that would cause other undo steps.\n     * For example a filter that does something with two layers and then merges them.\n     * That should be a single undo step, and prevent merging from creating its own undo step.\n     * Pause prevents creation of unintended undo steps.\n     */\n    pause (b: boolean): void {\n        if (b) {\n            this.pauseStack++;\n        } else {\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\n        }\n    }\n\n    addListener (l: IHistoryListener): void {\n        this.listeners.push(l);\n    }\n\n    push (newEntry: IHistoryEntry): void {\n        if (this.pauseStack > 0) {\n            return;\n        }\n        while (this.actionNumber < this.entries.length - 1) {\n            this.entries.pop();\n        }\n\n        //taking care of actions that shouldn't cause a new undo step\n        const lastEntry = this.entries[this.entries.length - 1];\n        // opacity\n        if (\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\n            newEntry.action === 'layerOpacity' && lastEntry.action === 'layerOpacity' &&\n            lastEntry.params![0] === newEntry.params![0]\n        ) {\n            this.entries[this.entries.length - 1] = newEntry;\n            this.state++; //still needs to increment because something changed\n            return;\n        }\n        // layer visibility\n        if (\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\n            newEntry.action === 'setLayerIsVisible' && lastEntry.action === 'setLayerIsVisible' &&\n            lastEntry.params![0] === newEntry.params![0] &&\n            lastEntry.params![1] != newEntry.params![1]\n        ) {\n            // if last and current step toggle visibility -> that means it's the way it was before\n            this.entries.pop();\n            this.actionNumber--;\n            this.state++; //still needs to increment because something changed\n            this.broadcast(null);\n            return;\n        }\n        // select layer\n        if (newEntry.action === 'focusLayer' && lastEntry && lastEntry.action === 'focusLayer') {\n            this.entries[this.entries.length - 1] = newEntry;\n            this.state++;\n            return;\n        }\n\n        this.entries[this.entries.length] = newEntry;\n        this.actionNumber = this.entries.length - 1;\n        const maxBefore = this.maxState;\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n        if (maxBefore < this.maxState) {\n            const item = this.entries[this.maxState];\n            if (!item) {\n                throw new Error('this.dataArr[this.maxState] null');\n            }\n            this.broadcast({bufferUpdate: item});\n        } else {\n            this.broadcast(null);\n        }\n        if (DO_DELETE_OLD && this.maxState >= 0) {\n            this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\n        }\n    }\n\n    /**\n     * lowers action number, returns all entries that need to be executed\n     * on trailing snapshot to represent the canvas one undo step back.\n     * Empty array if it can't undo\n     */\n    undo (): IHistoryEntry[] {\n        const result: IHistoryEntry[] = [];\n        if (!this.canUndo()) {\n            return result;\n        }\n        for (let i = this.maxState + 1; i < this.actionNumber; i++) {\n            result.push(throwIfNull(this.entries[i]));\n        }\n        this.actionNumber--;\n        this.broadcast(null);\n        return result;\n    }\n\n    /**\n     * raises action number, returns the action to be redone\n     */\n    redo (): (IHistoryEntry | undefined) {\n        if (!this.canRedo()) {\n            return undefined;\n        }\n        this.actionNumber++;\n        this.broadcast(null);\n        return throwIfNull(this.entries[this.actionNumber]);\n    }\n\n    getAll (): (IHistoryEntry | null)[] {\n        return [...this.entries];\n    }\n\n    canRedo (): boolean {\n        return this.actionNumber < this.entries.length - 1;\n    }\n\n    canUndo (): boolean {\n        return this.actionNumber > this.maxState;\n    }\n\n    getState (): number {\n        return this.state;\n    }\n\n    /**\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\n     */\n    getActionNumber (): number {\n        return (this.actionNumber + 1);\n    }\n    \n}\n\nexport const klHistory = new KlHistory();\n","import {IKeyString, IKeyStringOptional, ISize2D, ISVG, IVector2D} from '../bb-types';\n\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\n    if (referenceNode.parentNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n}\n\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\n    let counter = 0;\n\n    function check (): void {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else {\n            setTimeout(check, 1);\n        }\n    }\n\n    check();\n}\n\nexport function asyncLoadImage (src: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n        img.src = src;\n    });\n}\n\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyStringOptional): void {\n    const keyArr = Object.keys(styleObj);\n    let keyStr: string;\n    const style = (el.style as unknown) as IKeyStringOptional;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        style[keyStr] = styleObj[keyStr];\n        if (keyStr === 'userSelect') {\n            style.webkitUserSelect = styleObj[keyStr]; // safari\n        }\n    }\n}\n\nexport function setAttributes (el: Element, attrObj: IKeyString): void {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\n\n/**\n * append a list to DOM element\n */\nexport function append (target: HTMLElement, els: (HTMLElement | string | undefined)[]): void {\n    const fragment = document.createDocumentFragment();\n    els.forEach(item => item && fragment.append(item));\n    target.append(fragment);\n}\n\n/**\n * a needs to fit into b\n */\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\n    let width = aw * bw, height = ah * bw;\n    if (width > bw) {\n        height = bw / width * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = bh / height * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return {width, height};\n}\n\n/**\n * center b in a\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n */\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2,\n    };\n}\n\nexport function getDate (): string {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\n\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\n}\n\nexport function gcd (a: number, b: number): number {\n    return b ? gcd(b, a % b) : a;\n}\n\nexport function reduce (numerator: number, denominator: number): [number, number] {\n    const g = gcd(numerator, denominator);\n    return [numerator / g, denominator / g];\n}\n\nexport function decToFraction (decimalNumber: number): [number, number] {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return reduce(numerator, denominator);\n}\n\n/**\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\n * @param blobObj\n * @returns {string}\n */\nexport function imageBlobToUrl (blobObj: Blob): string {\n    if (!blobObj) {\n        throw new Error('blobObj is undefined or null');\n    }\n    if (window.Blob && blobObj instanceof Blob) {\n        return URL.createObjectURL(blobObj); // object url\n    } else if (blobObj.constructor.name === 'Object') {\n        const fauxBlob = (blobObj as unknown) as {type: string; encoding: string; data: string};\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\n    } else {\n        throw new Error('unknown blob format');\n    }\n}\n\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\n}\n\nexport function copyObj<T> (obj: T): T {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * triggers Web Share API - share feature on mobile devices\n * Only works if they support file sharing - e.g. Safari can't do this yet\n * only call if BB.canShareFiles() -> true\n *\n * p = {\n *     canvas: Canvas,\n *     fileName: string,\n *     title: string\n * }\n *\n * @param p\n */\nexport function shareCanvas (p: {canvas: HTMLCanvasElement; fileName:string; title: string; callback: () => void}): void {\n    const mimetype = 'image/png';\n    const err = (): void => alert('sharing not supported');\n    p.canvas.toBlob(function (blob) {\n        if (!blob) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\n            navigator.share({\n                title: p.title,\n                files: filesArray,\n            } as any)\n                .then(() => {})\n                .catch(() => {\n                    err();\n            });\n        } catch(e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\n\n/**\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\n * Give it your click event\n *\n * @param clickEvent\n * @returns {boolean}\n */\nexport function handleClick (clickEvent: Event): boolean {\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\n    if (!target) {\n        return false;\n    }\n    if (['A', 'LABEL', 'INPUT', 'SUMMARY'].includes(target.tagName) || (target as any).allowClick) {\n        return true;\n    }\n    clickEvent.preventDefault();\n    return false;\n}\n\n\nexport function createSvg (p: ISVG): SVGElement {\n    const result = document.createElementNS('http://www.w3.org/2000/svg', p.elementType);\n    Object.entries(p).forEach(([keyStr, item]) => {\n        if (keyStr === 'childrenArr') {\n            (item as ISVG[]).forEach(child => {\n                result.append(createSvg(child));\n            });\n        } else if (keyStr !== 'elementType') {\n            result.setAttribute(keyStr, item as string);\n        }\n    });\n    return result;\n}\n\nexport function throwIfNull<T> (v: T | null): T {\n    // (disabled) eslint-disable-next-line no-null/no-null\n    if (v === null) {\n        throw new Error('value is null');\n    }\n    return v;\n}\n\nexport function throwIfUndefined<T> (v: T | undefined, message = 'value is undefined'): T {\n    if (v === undefined) {\n        throw new Error(message);\n    }\n    return v;\n}\n\nexport function nullToUndefined<T> (v: T | null): T | undefined {\n    return v === null ? undefined : v;\n}\n\nconst matchMediaDark = ('matchMedia' in window) ? window.matchMedia('(prefers-color-scheme: dark)') : false;\n\nexport function isDark (): boolean {\n    return matchMediaDark && matchMediaDark.matches;\n}\n\nexport function addIsDarkListener (func: () => void): void {\n    matchMediaDark && 'addEventListener' in matchMediaDark && matchMediaDark.addEventListener('change', func);\n}\n\nexport function removeIsDarkListener (func: () => void): void {\n    matchMediaDark && 'removeEventListener' in matchMediaDark && matchMediaDark.removeEventListener('change', func);\n}","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (key === 'default' || key === '__esModule' || dest.hasOwnProperty(key)) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n","import {IKeyString} from '../../../../bb/bb-types';\nimport {dialogCounter} from '../modal-count';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport './scroll-fix';\nimport cancelImg from '/src/app/img/ui/cancel.svg';\nimport checkImg from '/src/app/img/ui/check.svg';\n\nexport function showModal (\n    p: {\n        target: HTMLElement;\n        div?: HTMLElement; // node with content\n        message: string | Element; // can be html\n        callback?: (result: string) => void;\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\n        primaries?: string[];\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\n        closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\n        style?: IKeyString;\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\n        ignoreBackground?: boolean; // default false; if true clicking on background doesn't close\n    }\n): {\n    setIgnoreBackground: (b: boolean) => void;\n} {\n    dialogCounter.increase();\n    let isClosed = false;\n    let ignoreBackground = !!p.ignoreBackground;\n\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\n    const rootRootEl = BB.el({\n        parent: document.body,\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            right: '0',\n            bottom: '0',\n            overflow: 'hidden',\n        },\n    });\n    const rootEl = BB.el({\n        parent: rootRootEl,\n        className: 'kl-popup',\n    });\n\n    const scrollContent = BB.el({\n        parent: rootEl,\n        css: {\n            width: '100%',\n            minHeight: '100%',\n            // padding: '10px 0',\n            position: 'relative',\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n    });\n\n    const bgEl = BB.el({\n        parent: scrollContent,\n        onClick: () => {\n            if (ignoreBackground) {\n                return;\n            }\n            close('Cancel');\n        },\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            zIndex: '0',\n            width: '100%',\n            height: '100%',\n        },\n    });\n\n    const titleHeight = 40;\n    const xButton = BB.el({\n        tagName: 'button',\n        className: 'popup-x',\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n        title: LANG('modal-close'),\n        onClick: () => {\n            close('Cancel');\n        },\n        css: {\n            width: titleHeight + 'px',\n            height: titleHeight + 'px',\n            lineHeight: titleHeight + 'px',\n            position: 'absolute',\n            right: '0',\n            top: '0',\n            background: 'none',\n            boxShadow: 'none',\n        },\n    });\n\n    let icon: HTMLElement | undefined = undefined;\n    if (p.type) {\n\n        icon = BB.el({\n            className: {\n                error: 'kl-popup__icon-error',\n                ok: 'kl-popup__icon-ok',\n                warning: 'kl-popup__icon-warning',\n                upload: 'kl-popup__icon-upload',\n            }[p.type],\n        });\n    }\n\n    const boxClasses = ['kl-popup-box'];\n    boxClasses.push('kl-popup-box--sm');\n    const boxEl = BB.el({\n        content: [\n            xButton,\n            icon,\n            BB.el({\n                content: p.message,\n                css: {\n                    marginRight: '15px',\n                    marginBottom: p.div ? '10px' : undefined,\n                },\n            }),\n            p.div,\n        ],\n        className: boxClasses.join(' '),\n        css: p.style ? p.style : undefined,\n    });\n\n    scrollContent.append(\n        BB.el({\n            css: {\n                flex: '0.5',\n            },\n        }),\n        boxEl,\n        BB.el({\n            css: {\n                flex: '1',\n            },\n        })\n    );\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr, e, comboStr): void {\n            if (isClosed) {\n                return;\n            }\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\n                e.stopPropagation();\n                setTimeout(() => {\n                    clickOnEnterBtn && clickOnEnterBtn.click();\n                }, 10);\n            }\n            if (comboStr === 'esc') {\n                e.stopPropagation();\n                close('Cancel');\n            }\n        },\n    });\n    // prevent ctrl scroll -> zooming page\n    const wheelPrevent = (event: WheelEvent): void => {\n        if (keyListener.isPressed('ctrl')) {\n            event.preventDefault();\n        }\n    };\n    rootEl.addEventListener('wheel', wheelPrevent);\n    rootEl.onclick = BB.handleClick;\n\n    let autoFocus: string | undefined;\n    if (p.autoFocus) {\n        autoFocus = p.autoFocus;\n    } else if (p.autoFocus === false) {\n        autoFocus = undefined;\n    } else {\n        autoFocus = 'Ok';\n    }\n\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\n        parent: boxEl,\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            justifyContent: 'flex-end',\n            marginTop: '12px', // 8px already via buttons\n            marginLeft: '-8px',\n        },\n    }) : undefined;\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\n    const btnElArr: HTMLButtonElement[] = [];\n    if (p.buttons) {\n        p.buttons.forEach(buttonName => {\n            const btnClasses = ['kl-popup__btn'];\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\n                btnClasses.push('kl-button-primary');\n            }\n            let iconUrl;\n            let label = buttonName;\n            if (buttonName === 'Ok') {\n                label = LANG('modal-ok');\n                iconUrl = checkImg;\n            }\n            if (buttonName === 'Cancel') {\n                label = LANG('modal-cancel');\n                iconUrl = cancelImg;\n                btnClasses.push('kl-button-cancel');\n            }\n            let iconImg: HTMLElement | undefined = undefined;\n            if (iconUrl) {\n                iconImg = BB.el({\n                    tagName: 'img',\n                    custom: {\n                        src: iconUrl,\n                        height: '17',\n                    },\n                });\n            }\n            const btn = BB.el({\n                parent: buttonRowEl,\n                tagName: 'button',\n                className: btnClasses.join(' '),\n                content: [\n                    iconImg,\n                    BB.el({\n                        className: 'kl-popup__btn__text',\n                        content: label,\n                    }),\n                ],\n                onClick: () => {\n                    close(buttonName);\n                },\n            });\n            btnElArr.push(btn);\n            if (autoFocus === buttonName) {\n                setTimeout(() => {\n                    btn.focus();\n                    rootEl.scrollTo(0, 0);\n                }, 10);\n                setTimeout(() => {\n                    // safari needs a separate timeout\n                    rootEl.scrollTo(0, 0);\n                }, 20);\n            }\n            if (buttonName === p.clickOnEnter) {\n                clickOnEnterBtn = btn;\n            }\n        });\n    }\n\n    function close (value: string): void {\n        if (isClosed) {\n            return;\n        }\n\n        isClosed = true;\n        BB.clearSelection();\n        BB.unfocusAnyInput();\n        rootRootEl.remove();\n        dialogCounter.decrease();\n        BB.destroyEl(xButton);\n        BB.destroyEl(bgEl);\n        keyListener.destroy();\n        rootEl.removeEventListener('wheel', wheelPrevent);\n        // (disabled) eslint-disable-next-line no-null/no-null\n        rootEl.onclick = null;\n        btnElArr.forEach(item => BB.destroyEl(item));\n        btnElArr.splice(0, btnElArr.length);\n\n        if (p.callback) {\n            p.callback(value);\n        }\n    }\n\n    if (p.closeFunc) {\n        p.closeFunc(function () {\n            close('Cancel');\n        });\n    }\n\n    return {\n        setIgnoreBackground: (b: boolean) => {\n            ignoreBackground = b;\n        },\n    } as const;\n}","\n// not the best\n\n/**\n * how many modals are open\n */\n\nexport class DialogCounter {\n    private listeners: ((v: number) => void)[] = [];\n    private count = 0;\n\n    private emit (): void {\n        this.listeners.forEach(item => {\n            item(this.count);\n        });\n    }\n\n    increase (v?: number): void {\n        if (v !== undefined) {\n            this.count += v;\n        } else {\n            this.count++;\n        }\n        this.emit();\n    }\n    decrease (v?: number): void {\n        if (v !== undefined) {\n            this.count -= v;\n        } else {\n            this.count--;\n        }\n        this.emit();\n    }\n    get (): number {\n        return this.count;\n    }\n    subscribe (listener: (v: number) => void): void {\n        this.listeners.push(listener);\n    }\n}\n\nexport const dialogCounter = new DialogCounter();\n","import {\n    append,\n    centerWithin,\n    copyObj,\n    createSvg,\n    css,\n    dateDayDifference,\n    decToFraction,\n    fitInto,\n    gcd,\n    getDate,\n    handleClick,\n    imageBlobToUrl,\n    insertAfter, isDark,\n    loadImage, nullToUndefined,\n    reduce,\n    setAttributes,\n    shareCanvas,\n    throwIfNull,\n} from './base/base';\nimport {\n    canShareFiles,\n    eventUsesHighResTimeStamp,\n    hasPointerEvents,\n    isCssMinMaxSupported, unsetEventHandler,\n} from './base/browser';\nimport {KeyListener, sameKeys} from './input/key-listener';\nimport {PointerListener} from './input/pointer-listener';\nimport {\n    canvasBounds,\n    convertToAlphaChannelCanvas,\n    copyCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    ctx,\n    drawTransformedImageOnCanvas,\n    drawTransformedImageWithBounds,\n    freeCanvas,\n    resizeCanvas,\n    testShouldPixelate,\n} from './base/canvas';\nimport {Matrix} from './math/matrix';\nimport {Vec2} from './math/vec2';\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\nimport {\n    appendTextDiv,\n    clearSelection,\n    destroyEl,\n    el,\n    isInputFocused,\n    makeUnfocusable,\n    unfocusAnyInput,\n} from './base/ui';\nimport {\n    boundsInArea,\n    clamp,\n    dist,\n    distSquared,\n    intDxy,\n    isInsideRect,\n    lenSquared,\n    mix,\n    pointsToAngleDeg,\n    pointsToAngleRad,\n    rotate,\n    rotateAround,\n    round,\n    roundEven,\n    roundUneven,\n    updateBounds,\n} from './math/math';\nimport {createCanvas} from './base/create-canvas';\nimport {BbLog} from './base/bb-log';\nimport {LocalStorage} from './base/local-storage';\nimport {CoalescedExploder} from './input/event-chain/coalesced-exploder';\nimport {NFingerTapper} from './input/event-chain/n-finger-tapper';\nimport {PinchZoomer} from './input/event-chain/pinch-zoomer';\nimport {DoubleTapper} from './input/event-chain/double-tapper';\nimport {OnePointerLimiter} from './input/event-chain/one-pointer-limiter';\nimport {EventChain} from './input/event-chain/event-chain';\n\nexport const BB = {\n\n    // ---- browser ----\n    eventUsesHighResTimeStamp,\n    hasPointerEvents,\n    isCssMinMaxSupported,\n    canShareFiles,\n    unsetEventHandler,\n\n    // ---- base ----\n    insertAfter,\n    loadImage,\n    css,\n    setAttributes,\n    append,\n    fitInto,\n    centerWithin,\n    getDate,\n    gcd,\n    reduce,\n    decToFraction,\n    imageBlobToUrl,\n    dateDayDifference,\n    copyObj,\n    shareCanvas,\n    handleClick,\n    createSvg,\n    BbLog,\n    LocalStorage,\n    throwIfNull,\n    nullToUndefined,\n    isDark,\n\n    // ---- math ----\n    mix,\n    dist,\n    distSquared,\n    lenSquared,\n    pointsToAngleRad,\n    pointsToAngleDeg,\n    isInsideRect,\n    clamp,\n    rotate,\n    rotateAround,\n    Matrix,\n    Vec2,\n    intDxy,\n    roundEven,\n    roundUneven,\n    round,\n    updateBounds,\n    boundsInArea,\n\n    // ---- line ----\n    projectPointOnLine,\n    PointLine,\n    BezierLine,\n    SplineInterpolator,\n    quadraticSplineInput,\n\n    // ---- canvas ----\n    canvas: createCanvas,\n    ctx,\n    copyCanvas,\n    testShouldPixelate,\n    drawTransformedImageWithBounds,\n    drawTransformedImageOnCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    resizeCanvas,\n    convertToAlphaChannelCanvas,\n    freeCanvas,\n    canvasBounds,\n\n    // ---- color ----\n    HSV,\n    RGB,\n    CMYK,\n    ColorConverter,\n    testIsWhiteBestContrast,\n\n    // ---- UI ----\n    appendTextDiv,\n    clearSelection,\n    makeUnfocusable,\n    el,\n    destroyEl,\n    isInputFocused,\n    unfocusAnyInput,\n\n\n    // ---- events / input ----\n\n    KeyListener,\n    PointerListener,\n    sameKeys,\n\n    EventChain,\n    DoubleTapper,\n    NFingerTapper,\n    PinchZoomer,\n    CoalescedExploder,\n    OnePointerLimiter,\n};\n\nObject.keys(BB); // without this, parcel build may break this object","\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const eventUsesHighResTimeStamp = (function (): (() => boolean) {\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\n    return function (): boolean {\n        return eventUsesHighResTimeStamp;\n    };\n})();\n\nexport const hasPointerEvents = !!window.PointerEvent;\n\nexport const isCssMinMaxSupported = (function (): (() => boolean) {\n    let result: boolean | undefined;\n\n    function test (): void {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.style.top = '0';\n        div.style.left = 'max(0px, 25px)';\n        document.body.append(div);\n        setTimeout(function () {\n            result = div.offsetLeft === 25;\n            div.remove();\n        }, 25);\n    }\n\n    if (document.body) {\n        test();\n    } else {\n        window.addEventListener('DOMContentLoaded', function () {\n            test();\n        });\n    }\n\n    return function (): boolean {\n        if (result === undefined) {\n            throw new Error('isCssMinMaxSupported not initialized');\n        }\n        return result;\n    };\n})();\n\nexport const canShareFiles = function (): boolean {\n    return 'share' in navigator && 'canShare' in navigator;\n};\n\ntype THandler = 'onchange' | 'onclick' | 'onkeyup';\nexport function unsetEventHandler (obj: HTMLElement, ...handlers: [...THandler[]]): void {\n    handlers.forEach(handler => {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        obj[handler] = null;\n    });\n}","import {IKeyString} from '../bb-types';\n\ntype TGlobalKey = {\n    add: (keyListenerRef: TKeyListenerRef) => void;\n    remove: (keyListenerRef: TKeyListenerRef) => void;\n    getIsDown: () => TIsDown;\n    getCombo: () => string[];\n}\n\ntype TIsDown = {\n    [key: string]: boolean;\n};\n\nexport type TOnKeyDown = (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\nexport type TOnKeyUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\ntype TOnBlur = () => void;\ntype TKeyListenerRef = [\n    TOnKeyDown | undefined,\n    TOnKeyUp | undefined,\n    TOnBlur | undefined,\n];\n\n\nconst globalKey = ((): TGlobalKey => {\n\n    // keyStr - our key naming system\n    // key - KeyboardEvent.key\n    // code - KeyboardEvent.code\n\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\n        'space': [' ', 'Spacebar'], // Spacebar in IE\n        'alt': ['Alt', 'AltGraph'],\n        'shift': 'Shift',\n        'ctrl': 'Control',\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\n        'enter': 'Enter',\n        'esc': 'Escape',\n        'backspace': 'Backspace',\n        'delete': 'Delete',\n        'sqbr_open': '[',\n        'sqbr_close': ']',\n        'a': ['a', 'A'],\n        'b': ['b', 'B'],\n        'c': ['c', 'C'],\n        'e': ['e', 'E'],\n        'f': ['f', 'F'],\n        'g': ['g', 'G'],\n        'r': ['r', 'R'], // when holding shift\n        's': ['s', 'S'],\n        't': ['t', 'T'],\n        'u': ['u', 'U'],\n        'x': ['x', 'X'],\n        'y': ['y', 'Y'],\n        'z': ['z', 'Z'],\n        'plus': '+',\n        'minus': '-',\n        'left': 'ArrowLeft',\n        'right': 'ArrowRight',\n        'up': 'ArrowUp',\n        'down': 'ArrowDown',\n        'home': 'Home',\n        'end': 'End',\n    };\n\n    // ['space', 'alt', ... ]\n    const keyStrArr = Object.keys(keyStrToKeyObj);\n\n    // { space: false, ... }\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\n        acc[key] = false;\n        return acc;\n    }, {} as TIsDown);\n\n    // event.key to keyStr\n    // { ArrowLeft: 'left', ... }\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\n        if (typeof code === 'string') {\n            acc[code] = key;\n        } else {\n            code.forEach(item => {\n                acc[item] = key;\n            });\n        }\n        return acc;\n    }, {} as IKeyString);\n\n    let comboArr: string[] = [];\n\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\n    let codeIsDownObj: {\n        [key: string]: string | undefined;\n    } = {};\n    const listenerArr: TKeyListenerRef[] = [];\n\n\n    const emitDown: TOnKeyDown = function (a, b, c, d?): void {\n        listenerArr.forEach(item => {\n            if (!item[0]) {\n                return;\n            }\n            item[0](a, b, c, d);\n        });\n    };\n\n    const emitUp: TOnKeyUp = function (a, b, c): void {\n        listenerArr.forEach(item => {\n            if (!item[1]) {\n                return;\n            }\n            item[1](a, b, c);\n        });\n    };\n\n    const emitBlur: TOnBlur = function (): void {\n        listenerArr.forEach(item => {\n            if (!item[2]) {\n                return;\n            }\n            item[2]();\n        });\n    };\n\n    function keyDown (e: KeyboardEvent): void {\n        const key = e.key;\n        const code = e.code;\n\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join('+'), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n\n            //add to combo\n            comboArr.push(keyStr);\n\n            emitDown(keyStr, e, comboArr.join('+'));\n        }\n    }\n\n\n    function keyUp (e: KeyboardEvent): void {\n        const code = e.code;\n        const oldComboStr = comboArr.join('+');\n\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            'Meta', 'MetaLeft', 'MetaRight',\n            'OSLeft', 'OSRight', // Firefox\n        ].includes(code)) {\n            blur();\n            return;\n        }\n\n        const keyStr = codeIsDownObj[code];\n        if (keyStr !== undefined) {\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = undefined;\n\n            // remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n\n    function blur (): void {\n        const oldComboStr = comboArr.join('+');\n        comboArr = [];\n        codeIsDownObj = {};\n\n        const eventArr: string[] = [];\n        keyStrArr.forEach(keyStr => {\n            if (isDownObj[keyStr]) {\n                isDownObj[keyStr] = false;\n                eventArr.push(keyStr);\n            }\n        });\n        for (let i = 0; i < eventArr.length; i++) {\n            emitUp(\n                eventArr[i],\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                } as KeyboardEvent,\n                oldComboStr,\n            );\n        }\n        emitBlur();\n    }\n\n\n\n    return {\n        add: (keyListenerRef: TKeyListenerRef): void => {\n            if (listenerArr.includes(keyListenerRef)) {\n                return;\n            }\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListenerRef);\n\n            if (first) {\n                document.addEventListener('keydown', keyDown);\n                document.addEventListener('keyup', keyUp);\n                window.addEventListener('blur', blur);\n            }\n        },\n        remove: (keyListenerRef: TKeyListenerRef): void => {\n            if (!listenerArr.includes(keyListenerRef)) {\n                return;\n            }\n            const last = listenerArr.length === 1;\n            for (let i = 0; i < listenerArr.length; i++) {\n                if (listenerArr[i] === keyListenerRef) {\n                    listenerArr.splice(i, 1);\n                    break;\n                }\n            }\n            if (last) {\n                document.removeEventListener('keydown', keyDown);\n                document.removeEventListener('keyup', keyUp);\n                window.removeEventListener('blur', blur);\n            }\n        },\n        getIsDown: (): TIsDown => isDownObj,\n        getCombo: (): string[] => comboArr,\n    };\n})();\n\n\n\n/**\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\n *\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\n * comboStr - string joins currently pressed keyStr with a +\n *              e.g. 'ctrl+z'\n *\n */\nexport class KeyListener {\n\n    private readonly onDown: TOnKeyDown | undefined;\n    private readonly onUp: TOnKeyUp | undefined;\n    private readonly onBlur: TOnBlur | undefined;\n    private readonly ref: TKeyListenerRef;\n\n    constructor (\n        p: {\n            onDown?: TOnKeyDown;\n            onUp?: TOnKeyUp;\n            onBlur?: TOnBlur;\n        },\n    ) {\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [this.onDown, this.onUp, this.onBlur];\n        globalKey.add(this.ref);\n    }\n\n    isPressed (keyStr: string): boolean {\n        if (!(keyStr in globalKey.getIsDown())) {\n            throw 'key \"' + keyStr + '\" not found';\n        }\n        return globalKey.getIsDown()[keyStr];\n    }\n\n    getComboStr (): string {\n        return globalKey.getCombo().join('+');\n    }\n\n    comboOnlyContains (keyStrArr: string[]): boolean {\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    destroy (): void {\n        globalKey.remove(this.ref);\n    }\n}\n\n/**\n * Test, are the same keys pressed. Order does not matter.\n */\nexport function sameKeys (comboAStr: string, comboBStr: string): boolean {\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\n}","import {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\nimport {WheelCleaner} from './wheel-cleaner';\nimport {IPointerEvent, IWheelEvent, TPointerButton, TPointerEventType, TPointerType} from './event.types';\nimport {PressureNormalizer} from './pressure-normalizer';\n\nexport interface IPointerListenerParams {\n    target: HTMLElement | SVGElement;\n    onPointer?: (pointerEvent: IPointerEvent) => void;\n    onWheel?: (wheelEvent: IWheelEvent) => void;\n    onEnterLeave?: (isOver: boolean) => void; // optional\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\n}\n\ninterface IPointer {\n    pointerId: number;\n    lastPageX: number | null;\n    lastPageY: number | null;\n}\n\ninterface IDragObj {\n    pointerId: number; // long\n    pointerType?: TPointerType;\n    downPageX: number; //where was pointer when down-event occurred\n    downPageY: number;\n    buttons: number; // long\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\n    lastPageY: number;\n    lastTimeStamp?: number;\n}\n\ninterface ICoalescedPointerEvent {\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n    movementX: number;\n    movementY: number;\n    timeStamp: number;\n    pressure: number;\n}\n\ninterface ICorrectedPointerEvent {\n    pointerId: number;\n    pointerType: string;\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n    movementX: number;\n    movementY: number;\n    timeStamp: number;\n    pressure: number; // normalized\n    buttons: number;\n    button: number;\n    coalescedArr: ICoalescedPointerEvent[];\n    eventPreventDefault: () => void;\n    eventStopPropagation: () => void;\n}\n\ninterface TExtendedDOMPointerEvent extends PointerEvent {\n    corrected: ICorrectedPointerEvent;\n}\n\n\n// keeping track of pointers for movement fallback\nconst pointerArr: IPointer[] = [];\n\nfunction addPointer (event: ICorrectedPointerEvent): IPointer {\n    const pointerObj: IPointer = {\n        pointerId: event.pointerId,\n        lastPageX: null,\n        lastPageY: null,\n    };\n    pointerArr.push(pointerObj);\n\n    if (pointerArr.length > 15) {\n        pointerArr.shift();\n    }\n\n    return pointerObj;\n}\n\nfunction getPointer (event: ICorrectedPointerEvent): IPointer | null {\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\n        if (event.pointerId === pointerArr[i].pointerId) {\n            return pointerArr[i];\n        }\n    }\n    return null;\n}\n\nfunction getButtonStr (buttons: number): TPointerButton | undefined {\n    switch (buttons) {\n        case 1:\n            return 'left';\n        case 2:\n            return 'right';\n        case 4:\n            return 'middle';\n        default:\n            return undefined;\n    }\n}\n\nconst pressureNormalizer = new PressureNormalizer();\nconst timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\n\n\nconst pointerDownEvt = (hasPointerEvents ? 'pointerdown' : 'mousedown') as 'pointerdown';\nconst pointerMoveEvt = (hasPointerEvents ? 'pointermove' : 'mousemove') as 'pointermove';\nconst pointerUpEvt = (hasPointerEvents ? 'pointerup' : 'mouseup') as 'pointerup';\nconst pointerCancelEvt = (hasPointerEvents ? 'pointercancel' : 'mousecancel') as 'pointercancel';\nconst pointerLeaveEvt = (hasPointerEvents ? 'pointerleave' : 'mouseleave') as 'pointerleave';\nconst pointerEnterEvt = (hasPointerEvents ? 'pointerenter' : 'mouseenter') as 'pointerenter';\n\n\n/**\n * More trustworthy pointer attributes. that behave the same across browsers.\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\n */\nfunction correctPointerEvent (event: PointerEvent | TExtendedDOMPointerEvent): ICorrectedPointerEvent {\n    if ('corrected' in event) {\n        return event.corrected;\n    }\n\n    function determineButtons (): number {\n        if (event.buttons !== undefined) {\n            return event.buttons;\n        }\n        /*\n                button -> buttons\n        none:\tundefined -> 0\n        left:\t0 -> 1\n        middle:\t1 -> 4\n        right:\t2 -> 2\n        fourth:\t3 -> 8\n        fifth:\t4 -> 16\n         */\n        if (event.button !== undefined) { // old safari on mac has no buttons. remove eventually.\n            return [1,4,2,8,16][event.button];\n        }\n        return 0;\n    }\n\n    const correctedObj: ICorrectedPointerEvent = {\n        pointerId: event.pointerId,\n        pointerType: event.pointerType,\n        pageX: event.pageX,\n        pageY: event.pageY,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        movementX: event.movementX,\n        movementY: event.movementY,\n        timeStamp: event.timeStamp + timeStampOffset,\n        pressure: pressureNormalizer.normalize(event.pressure),\n        buttons: determineButtons(),\n        button: event.button,\n        coalescedArr: [],\n        eventPreventDefault: () => event.preventDefault(),\n        eventStopPropagation: () => event.stopPropagation(),\n    };\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\n\n    let customPressure = null;\n    if ('pointerId' in event) {\n        if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\n            correctedObj.pressure = 1;\n            customPressure = 1;\n        }\n    } else {\n        correctedObj.pointerId = 0;\n        correctedObj.pointerType = 'mouse';\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\n        customPressure = correctedObj.pressure;\n    }\n\n    if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\n    }\n\n    let coalescedEventArr: PointerEvent[] = [];\n    if ('getCoalescedEvents' in event) {\n        coalescedEventArr = event.getCoalescedEvents();\n    }\n\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\n    // so make my own\n\n    const pointerObj: IPointer = getPointer(correctedObj) || addPointer(correctedObj);\n\n    const totalLastX = pointerObj.lastPageX;\n    const totalLastY = pointerObj.lastPageY;\n\n    for (let i = 0; i < coalescedEventArr.length; i++) {\n        const eventItem = coalescedEventArr[i];\n\n        correctedObj.coalescedArr.push({\n            pageX: eventItem.pageX,\n            pageY: eventItem.pageY,\n            clientX: eventItem.clientX,\n            clientY: eventItem.clientY,\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\n            pressure: customPressure === null ? pressureNormalizer.normalize(eventItem.pressure) : customPressure,\n        });\n\n        pointerObj.lastPageX = eventItem.pageX;\n        pointerObj.lastPageY = eventItem.pageY;\n    }\n\n    pointerObj.lastPageX = correctedObj.pageX;\n    pointerObj.lastPageY = correctedObj.pageY;\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n\n    return correctedObj;\n}\n\n/**\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\n */\nexport class PointerListener {\n\n    private isDestroyed: boolean = false;\n\n    // ts has problems with (HTMLElement|SVGElement) when adding event listeners\n    // https://github.com/microsoft/TypeScript/issues/46819\n    private readonly targetElement: HTMLElement;\n    private readonly onPointerCallback: undefined | ((pointerEvent: IPointerEvent) => void);\n    private readonly onWheelCallback: undefined | ((wheelEvent: IWheelEvent) => void);\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\n    private readonly maxPointers: number;\n    private readonly wheelCleaner: WheelCleaner;\n    private isOverCounter: number = 0;\n\n    // pointers that are pressing a button\n    private dragObjArr: IDragObj[] = [];\n    private dragPointerIdArr: number[] = [];\n\n    // chrome input glitch workaround\n    private lastPointerType: TPointerType | null = null;\n    private didSkip: boolean = false;\n\n    // listeners\n    private readonly onPointerEnter: (() => void) | undefined;\n    private readonly onPointerLeave: (() => void) | undefined;\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\n    private readonly onPointerDown: ((event: PointerEvent, skipGlobal?: boolean) => void) | undefined;\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\n\n\n    private getDragObj (pointerId: number): IDragObj | null {\n        for (let i = 0; i < this.dragObjArr.length; i++) {\n            if (pointerId === this.dragObjArr[i].pointerId) {\n                return this.dragObjArr[i];\n            }\n        }\n        return null;\n    }\n\n    private removeDragObj (pointerId: number): IDragObj | null {\n        let removedDragObj: IDragObj | null = null;\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\n            if (this.dragPointerIdArr[i] === pointerId) {\n                removedDragObj = this.dragObjArr[i];\n                this.dragObjArr.splice(i, 1);\n                this.dragPointerIdArr.splice(i, 1);\n                i--;\n            }\n        }\n        return removedDragObj;\n    }\n\n    /**\n     * Creates a value for onPointer, from a pointer event handler.\n     */\n    private createPointerOutEvent (\n        typeStr: TPointerEventType,\n        correctedEvent: ICorrectedPointerEvent,\n        custom?: Partial<IPointerEvent>,\n    ): IPointerEvent {\n\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\n        const result: IPointerEvent = {\n            type: typeStr,\n            pointerId: correctedEvent.pointerId,\n            pointerType: correctedEvent.pointerType as TPointerType,\n            pageX: correctedEvent.pageX,\n            pageY: correctedEvent.pageY,\n            clientX: correctedEvent.clientX,\n            clientY: correctedEvent.clientY,\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\n            dX: correctedEvent.movementX,\n            dY: correctedEvent.movementY,\n            time: correctedEvent.timeStamp,\n            eventPreventDefault: correctedEvent.eventPreventDefault,\n            eventStopPropagation: correctedEvent.eventStopPropagation,\n            ...custom,\n        };\n\n        if (typeStr === 'pointermove') {\n            result.coalescedArr = [];\n            if (correctedEvent.coalescedArr.length > 1) {\n                let coalescedItem;\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\n                    coalescedItem = correctedEvent.coalescedArr[i];\n                    result.coalescedArr.push({\n                        pageX: coalescedItem.pageX,\n                        pageY: coalescedItem.pageY,\n                        clientX: coalescedItem.clientX,\n                        clientY: coalescedItem.clientY,\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\n                        dX: coalescedItem.movementX,\n                        dY: coalescedItem.movementY,\n                        time: coalescedItem.timeStamp,\n                    });\n                }\n            }\n        }\n\n        return result;\n    }\n\n    private setupDocumentListeners () {\n        this.windowOnPointerMove && document.addEventListener(pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp && document.addEventListener(pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave && document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave && document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n\n    private destroyDocumentListeners () {\n        this.windowOnPointerMove && document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp && document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave && document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave && document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n\n\n    // ---- public ----\n\n    constructor (p: IPointerListenerParams) {\n        this.targetElement = p.target as HTMLElement;\n        this.onPointerCallback = p.onPointer;\n        this.onWheelCallback = p.onWheel;\n        this.onEnterLeaveCallback = p.onEnterLeave;\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\n\n\n        this.wheelCleaner = new WheelCleaner((cleanerEvent) => {\n            if (this.isDestroyed || !this.onWheelCallback) {\n                return;\n            }\n            const bounds = this.targetElement.getBoundingClientRect();\n            const whlEvent = {\n                ...cleanerEvent,\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop,\n            };\n            this.onWheelCallback(whlEvent);\n        });\n\n        if (this.onPointerCallback) {\n            this.onPointerMove = (event: PointerEvent) => {\n                const correctedEvent = correctPointerEvent(event);\n\n                const tempLastPointerType = this.lastPointerType;\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\n\n                if (\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\n                    this.dragPointerIdArr.length === this.maxPointers ||\n                    correctedEvent.pointerType === 'touch'\n                ) {\n                    this.didSkip = false;\n                    return;\n                }\n\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n                if (!this.didSkip && correctedEvent.pointerType === 'mouse' && tempLastPointerType === 'pen') {\n                    this.didSkip = true;\n                    return;\n                }\n                this.didSkip = false;\n\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal? : boolean) => {\n\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![1, 2, 4].includes(correctedEvent.buttons)) {\n                    //BB.throwOut('pointerdown ignored');\n                    return;\n                }\n\n                //set up global listeners\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\n                    this.setupDocumentListeners();\n                }\n                const dragObj: IDragObj = {\n                    pointerId: correctedEvent.pointerId,\n                    pointerType: correctedEvent.pointerType as TPointerType,\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    buttons: correctedEvent.buttons,\n                    lastPageX: correctedEvent.pageX,\n                    lastPageY: correctedEvent.pageY,\n                    lastTimeStamp: correctedEvent.timeStamp,\n                };\n                this.dragObjArr.push(dragObj);\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\n\n                const outEvent: IPointerEvent = this.createPointerOutEvent('pointerdown', correctedEvent, {\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    button: getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure,\n                });\n\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.windowOnPointerMove = (event: PointerEvent) => {\n                //BB.throwOut('pointermove ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\n                    return;\n                }\n\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\n\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                //if pointer changes button its pressing -> turn into pointerup\n                if (correctedEvent.buttons !== dragObj.buttons) {\n                    //pointer up\n\n                    //remove listener\n                    if (this.dragObjArr.length === 1) {\n                        this.destroyDocumentListeners();\n                    }\n                    this.removeDragObj(correctedEvent.pointerId);\n\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                    });\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\n                    return;\n                }\n\n                // ipad likes to do this\n                if (\n                    correctedEvent.pointerType === 'pen' &&\n                    correctedEvent.pageX === dragObj.lastPageX &&\n                    correctedEvent.pageY === dragObj.lastPageY &&\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\n                ) {\n                    //ignore\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                    button: getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure,\n                });\n\n                dragObj.lastPageX = correctedEvent.pageX;\n                dragObj.lastPageY = correctedEvent.pageY;\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\n\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.windowOnPointerUp = (event: PointerEvent) => {\n                //BB.throwOut('pointerup ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\n                    return;\n                }\n\n                //remove listener\n                if (this.dragObjArr.length === 1) {\n                    this.destroyDocumentListeners();\n                }\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n\n            };\n\n            this.windowOnPointerLeave = (event: PointerEvent) => {\n                //BB.throwOut('pointerleave ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) { //} || event.target !== document) {\n                    return;\n                }\n\n                //remove listener\n                if (this.dragObjArr.length === 1) {\n                    this.destroyDocumentListeners();\n                }\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.targetElement.addEventListener(pointerMoveEvt, this.onPointerMove);\n            this.targetElement.addEventListener(pointerDownEvt, this.onPointerDown);\n\n            if (!hasPointerEvents) {\n                const touchToFakePointer = (touch: Touch, touchEvent: TouchEvent, isDown: boolean) => {\n                    return {\n                        pointerId: touch.identifier,\n                        pointerType: 'touch',\n                        pageX: touch.pageX,\n                        pageY: touch.pageY,\n                        clientX: touch.clientX,\n                        clientY: touch.clientY,\n                        button: isDown ? 0 : undefined,\n                        buttons: isDown ? 1 : 0,\n                        timeStamp: touchEvent.timeStamp,\n                        target: touchEvent.target,\n                        pressure: isDown ? 1 : 0,\n                        preventDefault: () => touchEvent.preventDefault(),\n                        stopPropagation: () => touchEvent.stopPropagation(),\n                    };\n                };\n\n                const handleTouch = (e: TouchEvent, type: 'start' | 'move' | 'end' | 'cancel'): void => {\n                    for (let i = 0; i < e.changedTouches.length; i++) {\n                        const touch = e.changedTouches[i];\n                        const fakePointer = touchToFakePointer(touch, e, ['start', 'move'].includes(type));\n                        if (type === 'start') {\n                            this.onPointerDown!(fakePointer as PointerEvent, false);\n                        } else if (type === 'move') {\n                            this.windowOnPointerMove!(fakePointer as PointerEvent);\n                        } else if (type === 'end') {\n                            this.windowOnPointerUp!(fakePointer as PointerEvent);\n                        } else {\n                            this.windowOnPointerLeave!(fakePointer as PointerEvent);\n                        }\n                    }\n                };\n\n                this.onTouchStart = (e: TouchEvent): void => {\n                    e.preventDefault();\n                    handleTouch(e, 'start');\n                };\n                this.onTouchMove = (e: TouchEvent): void => {\n                    handleTouch(e, 'move');\n                };\n                this.onTouchEnd = (e: TouchEvent): void => {\n                    handleTouch(e, 'end');\n                };\n                this.onTouchCancel = (e: TouchEvent): void => {\n                    handleTouch(e, 'cancel');\n                };\n\n                this.targetElement.addEventListener('touchstart', this.onTouchStart);\n                this.targetElement.addEventListener('touchmove', this.onTouchMove);\n                this.targetElement.addEventListener('touchend', this.onTouchEnd);\n                this.targetElement.addEventListener('touchcancel', this.onTouchCancel);\n            }\n        }\n        if (this.onWheelCallback) {\n            this.onWheel = (e: WheelEvent) => {\n                this.wheelCleaner.process(e);\n            };\n            this.targetElement.addEventListener('wheel', this.onWheel);\n        }\n        if (this.onEnterLeaveCallback) {\n            this.onPointerEnter = () => {\n                this.isOverCounter++;\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\n            };\n\n            this.onPointerLeave = () => {\n                this.isOverCounter--;\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\n            };\n\n            this.targetElement.addEventListener(pointerEnterEvt, this.onPointerEnter);\n            this.targetElement.addEventListener(pointerLeaveEvt, this.onPointerLeave);\n        }\n\n        if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\n            this.targetElement.addEventListener('touchmove', this.onTouchMoveScribbleFix);\n        }\n    }\n\n    destroy (): void {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.isDestroyed = true;\n        this.onPointerEnter && this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\n        this.onPointerLeave && this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\n        this.onPointerMove && this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\n        this.onPointerDown && this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\n        this.destroyDocumentListeners();\n        this.onTouchMoveScribbleFix && document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\n\n        this.onTouchStart && this.targetElement.removeEventListener('touchstart', this.onTouchStart);\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\n        this.onTouchCancel && this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\n    }\n\n}","export interface IWheelCleanerEvent {\n    deltaY: number;\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n}\n\nconst SEQUENCE_TIMEOUT_MS = 200;\n\n/**\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\n * Normalizes regular scrolls.\n *\n * Why:\n * - trackpad scrolling is different from old school mouse scrolling\n * - but there is no way to learn from the browser if it's trackpad scrolling\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\n *      continue an arbitrary amount, at an arbitrary scale\n * - each browser does this differently. So you can't offer a consistent/controlled experience\n *\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\n */\nexport class WheelCleaner {\n\n    private readonly knownUnitArr: number[] = [100];\n    private sequenceLength: number = 0;\n    private sequenceUnit: null | number = null;\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\n    private toEmitDelta: null | number = null;\n    private position: null | {\n        pageX: number;\n        pageY: number;\n        clientX: number;\n        clientY: number;\n    } = null;\n\n\n    private emit (delta: number): void {\n        if (this.position === null || this.sequenceUnit === null) {\n            return;\n        }\n        this.callback({\n            deltaY: Math.round(delta / this.sequenceUnit),\n            pageX: this.position.pageX,\n            pageY: this.position.pageY,\n            clientX: this.position.clientX,\n            clientY: this.position.clientY,\n        });\n    }\n\n    private endSequence (): void {\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        if (this.sequenceUnit !== null && !(this.knownUnitArr.includes(this.sequenceUnit))) {\n            this.knownUnitArr.push(this.sequenceUnit);\n        }\n        this.sequenceLength = 0;\n        this.sequenceUnit = null;\n    }\n\n\n    // ---- public ----\n\n    constructor (private callback: (p: IWheelCleanerEvent) => void) {}\n\n    process (event: WheelEvent): void {\n        this.position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n\n        if (this.endSequenceTimeout) {\n            clearTimeout(this.endSequenceTimeout);\n        }\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\n\n        //prep delta\n        let delta = event.deltaY;\n        if ('deltaMode' in event && event.deltaMode === 1) {\n            delta *= 100 / 3;\n        }\n        const absDelta = Math.abs(delta);\n\n        //sequence begins\n        if (this.sequenceLength === 0) {\n            this.sequenceLength++;\n            if (absDelta < 50) {\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\n                return;\n            }\n\n            this.sequenceUnit = absDelta;\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\n                //we know this unit - emit right away\n                this.emit(delta);\n            } else {\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                this.toEmitDelta = delta;\n            }\n            return;\n        }\n\n        if (this.sequenceUnit === null) {\n            //previously determined dirty sequence\n            this.toEmitDelta = null;\n            return;\n        }\n\n        //sequence continues\n        if (absDelta === 0) {\n            //ignore zero scroll\n            return;\n        }\n        if (\n            absDelta === this.sequenceUnit ||\n            (absDelta / this.sequenceUnit) % 1 < 0.0001// a multiple\n        ) {\n            //fine\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\n            //unit was actually a multiple - update it\n            this.sequenceUnit = absDelta;\n\n        } else if (absDelta !== this.sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            this.sequenceUnit = null;\n            this.toEmitDelta = null;\n            return;\n        }\n\n\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        this.emit(delta);\n    }\n\n}\n","import {mix} from '../math/math';\n\n/**\n * different devices/browsers have different pressure curves\n * pressure normalize attempts to achieve similar mapping\n *\n * pressure range [0, 1]\n */\nexport class PressureNormalizer {\n    \n    private count: number = 0;\n    private avgPressure: number = 0; // float [0, 1]\n    private normalizeIsComplete: boolean = false;\n    private normalizeFactor: number = 1;\n    \n    // ---- public ----\n    normalize (pressure: number): number {\n        if (pressure === 0 || pressure === 1) {\n            return pressure;\n        }\n\n        if (this.count < 60) {\n            if (this.count === 0 || this.count === null) {\n                this.avgPressure = pressure;\n            } else {\n                this.avgPressure = mix(pressure, this.avgPressure, 0.95);\n            }\n            this.count++;\n        } else if (!this.normalizeIsComplete) {\n            this.normalizeIsComplete = true;\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\n            if (this.avgPressure < 0.13) { // absurd pressure needed\n                this.normalizeFactor = 2.3;\n            }\n        }\n\n        return Math.pow(pressure, 1 / this.normalizeFactor);\n    }\n    \n}","import {IBounds, IRect, IVector2D} from '../bb-types';\n\nexport function mix (a: number, b: number, f: number): number {\n    return a * (1 - f) + b * f;\n}\n\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\n\nexport function lenSquared (x: number, y: number): number {\n    // faster because no square-root\n    return x * x + y * y;\n}\n\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\n\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\n}\n\nexport function isInsideRect (p: IVector2D, rect: IRect): boolean {\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\n        rect.y <= p.y && p.y <= rect.y + rect.height;\n}\n\nexport function clamp (num: number, min: number, max: number): number {\n    return num < min\n        ? min\n        : num > max\n            ? max\n            : num;\n}\n\nexport function rotate (x: number, y: number, deg: number): IVector2D {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs,\n    };\n}\n\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\n\nexport function intDxy (remainder: IVector2D, fDx: number, fDy: number): {dX: number; dY: number} {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX,\n        dY,\n    };\n}\n\n/**\n * return closest even number\n * @param f\n */\nexport function roundEven (f: number): number {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f;\n        }\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * return closest uneven number\n * @param f\n */\nexport function roundUneven (f: number): number {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f + 1;\n        }\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * round number to certain precision.\n * round(1.2345, 2) = 1.23\n * round(1.2345, 0) = 0\n * round(123, -1) = 120\n *\n * @param f\n * @param digits\n */\nexport function round (f: number, digits: number): number {\n    const digitMult = Math.pow(10, digits);\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\n}\n\n/**\n * update target so it includes bounds\n * @param target\n * @param bounds\n */\nexport function updateBounds (target: IBounds | undefined, bounds: IBounds | undefined): IBounds {\n    if (!bounds && !target) {\n        throw new Error('at least one param needs to be defined');\n    }\n    if (!bounds) {\n        return target!;\n    }\n    if (!target) {\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\n    } else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\n\n/**\n * determine overlap of bounds with width&height\n */\nexport function boundsInArea (bounds: IBounds | undefined, width: number, height: number): IBounds | undefined {\n    if (!bounds) {\n        return undefined;\n    }\n    const x1 = Math.max(0, bounds.x1);\n    const y1 = Math.max(0, bounds.y1);\n    const x2 = Math.min(width - 1, bounds.x2);\n    const y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) {\n        return undefined;\n    }\n    return { x1, y1, x2, y2 };\n}","import {IBounds, IKeyString, IRect} from '../bb-types';\nimport {createCanvas} from './create-canvas';\nimport {copyObj} from './base';\n\nexport function copyCanvas (canvas: HTMLCanvasElement): HTMLCanvasElement {\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\n\nexport function ctx (canvas: HTMLCanvasElement, options?: CanvasRenderingContext2DSettings): CanvasRenderingContext2D {\n    const ctx = canvas.getContext('2d', options);\n    if (!ctx) {\n        throw new Error(\"couldn't get 2d context\");\n    }\n    return ctx;\n}\n\n/**\n * Determine if we should disable imageSmoothing for transformation.\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\n */\nexport function testShouldPixelate (\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\n    scaleX: number,\n    scaleY: number,\n): boolean {\n    if (\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\n        Math.abs(transform.angleDeg) % 90 !== 0\n    ) {\n        return false;\n    }\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\n        ) &&\n        (\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\n        );\n}\n\n\n/**\n * @param destCtx - the canvas that will be drawn on\n * @param transformImage - image that will be drawn on canvas\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\n * @param pixelated\n */\nexport function drawTransformedImageWithBounds (\n    destCtx: CanvasRenderingContext2D,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\n    bounds?: {x: number; y: number; width: number; height: number},\n    pixelated?: boolean,\n): void {\n    if (!bounds) {\n        bounds = {\n            x: 0,\n            y: 0,\n            width: transformImage.width,\n            height: transformImage.height,\n        };\n    }\n\n    destCtx.save();\n    if (pixelated) {\n        destCtx.imageSmoothingEnabled = false;\n    } else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = 'high';\n    }\n\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(\n        transformImage,\n        bounds.x, bounds.y, bounds.width, bounds.height,\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n\n    destCtx.restore();\n}\n\n/**\n * all transformations are optional\n * center is the point around which will be scaled and rotated\n *\n * @param baseCanvas canvas - the canvas that will be drawn on\n * @param transformImage image|canvas - image that will be drawn on canvas\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\n */\nexport function drawTransformedImageOnCanvas (\n    baseCanvas: HTMLCanvasElement,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transformObj: {\n        center: {x: number; y: number};\n        scale: {x: number; y: number};\n        translate: {x: number; y: number};\n        angleDegree: number;\n    },\n): void {\n    transformObj = copyObj(transformObj);\n    if (!transformObj.center) {\n        transformObj.center = {\n            x: transformImage.width / 2,\n            y: transformImage.height / 2,\n        };\n    }\n    if (!transformObj.scale) {\n        transformObj.scale = {\n            x: 1,\n            y: 1,\n        };\n    }\n    if (!transformObj.angleDegree) {\n        transformObj.angleDegree = 0;\n    }\n    if (!transformObj.translate) {\n        transformObj.translate = {\n            x: 0,\n            y: 0,\n        };\n    }\n\n    const ctx = baseCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.save();\n    if (\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\n    ) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n    } else {\n        ctx.imageSmoothingEnabled = false;\n    }\n\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n\n    ctx.restore();\n}\n\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\n    const canvas = createCanvas();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(128, 128, 128)';\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)': 'rgb(200, 200, 200)';\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\n\nexport const createCheckerDataUrl = (function () {\n    const cache: IKeyString = { // previously created dataUrls\n        '8l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\n        '4l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC',\n    };\n\n    return function (size: number, callback?: (s: string) => void, isDark?: boolean): string | void {\n        const modeStr = isDark ? 'd' : 'l';\n\n        function create (size: number): string {\n            size = parseInt('' + size);\n            if (cache['' + size + modeStr]) {\n                return cache['' + size + modeStr];\n            }\n            const canvas = createCheckerCanvas(size, isDark);\n            const result = canvas.toDataURL('image/png');\n            cache['' + size + modeStr] = result;\n            return result;\n        }\n\n        if (callback) { //async\n            setTimeout(function () {\n                callback(create(size));\n            }, 1);\n        } else { //sync\n            return create(size);\n        }\n    };\n})();\n\n/**\n * smooth resize image\n * @param canvas canvas - will be resized (modified)\n * @param w\n * @param h\n * @param tmp1 canvas - optional, provide to save resources\n * @param tmp2 canvas - optional, provide to save resources\n */\nexport function resizeCanvas (\n    canvas: HTMLCanvasElement,\n    w: number,\n    h: number,\n    tmp1?: HTMLCanvasElement,\n    tmp2?: HTMLCanvasElement,\n): void {\n\n    //determine base 2 exponents of old and new size\n    function getBase2Obj (oldW: number, oldH: number, newW: number, newH: number) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH)),\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\n        return;\n    }\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\n\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext('2d')!.save();\n        tmp2.getContext('2d')!.save();\n\n        let ew, eh;\n        let buffer1 = tmp1, buffer2 = tmp2;\n\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n\n        let bufferCtx = buffer2.getContext('2d')!;\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality  = 'high';\n        bufferCtx.globalCompositeOperation  = 'copy';\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n\n        //stepwise half the size\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\n            bufferCtx = buffer1.getContext('2d')!;\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality  = 'high';\n            bufferCtx.globalCompositeOperation  = 'copy';\n\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\n\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n\n            bufferCtx.drawImage(\n                buffer2,\n                0, 0,\n                currentWidth, currentHeight,\n                0, 0,\n                newWidth, newHeight\n            );\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext('2d')!;\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality  = 'high';\n        canvasCtx.drawImage(\n            buffer2,\n            0, 0,\n            currentWidth, currentHeight,\n            0, 0,\n            w, h\n        );\n        canvasCtx.restore();\n        tmp1.getContext('2d')!.restore();\n        tmp2.getContext('2d')!.restore();\n\n    } else if (w >= canvas.width && h >= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext('2d')!;\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality  = 'high';\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\n\n    } else {\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\n    }\n}\n\n/**\n * puts naive greyscale version of image into alpha channel.\n * only writes a, doesn't write rgb\n * @param canvas\n */\nexport function convertToAlphaChannelCanvas (canvas: HTMLCanvasElement): void {\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < imdat.data.length; i += 4) {\n        if (imdat.data[i + 3] === 0) {\n            continue;\n        }\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\n}\n\n/**\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\n * or in the worst case there is a hard to fix memory leak.\n * This function manually makes the canvas use as little memory as possible.\n */\nexport function freeCanvas (canvas: HTMLCanvasElement): void {\n    canvas.width = 1;\n    canvas.height = 1;\n    canvas.remove();\n}\n\n/**\n * Determine bounding box that describes all pixels which are not fully transparent.\n * Returns null if empty.\n *\n * @param context\n */\nexport function canvasBounds (context: CanvasRenderingContext2D): IRect | undefined {\n    const boundsObj: {\n        x: number;\n        y: number;\n        width: number;\n        height: number;\n    } = { x: 0, y: 0, width: 0, height: 0 };\n    {\n        const tempBounds: Partial<IBounds> = {\n            x1: undefined,\n            y1: undefined,\n            x2: undefined,\n            y2: undefined,\n        };\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\n            tempBounds.x1 = 0;\n            tempBounds.y1 = 0;\n            tempBounds.x2 = context.canvas.width - 1;\n            tempBounds.y2 = context.canvas.height - 1;\n        } else {\n            for (let i = 3; i < imdat.data.length; i += 4) {\n                if (imdat.data[i] > 0 ) {\n                    const x = ((i - 3) / 4) %  context.canvas.width;\n                    const y = Math.floor((i - 3) / 4 / context.canvas.width);\n                    if (tempBounds.x1 === undefined || tempBounds.x1 > x) {\n                        tempBounds.x1 = x;\n                    }\n                    if (tempBounds.y1 === undefined) {\n                        tempBounds.y1 = y;\n                    }\n                    if (tempBounds.x2 === undefined || tempBounds.x2 < x) {\n                        tempBounds.x2 = x;\n                    }\n                    if (tempBounds.y2 === undefined || tempBounds.y2 < y) {\n                        tempBounds.y2 = y;\n                    }\n                }\n            }\n        }\n        if (tempBounds.x1 === undefined || tempBounds.y1 === undefined || tempBounds.x2 === undefined || tempBounds.y2 === undefined) {\n            return undefined;\n        }\n        boundsObj.x = tempBounds.x1;\n        boundsObj.y = tempBounds.y1;\n        boundsObj.width = tempBounds.x2! - tempBounds.x1 + 1;\n        boundsObj.height = tempBounds.y2! - tempBounds.y1 + 1;\n    }\n    return boundsObj;\n}","/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/\n\nexport function createCanvas (w?: number, h?: number): HTMLCanvasElement {\n    const result = document.createElement('canvas');\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}","\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n// not optimized\n\ntype TMatrix4x4 = [\n    number, number, number, number,\n    number, number, number, number,\n    number, number, number, number,\n    number, number, number, number,\n];\n\nexport type TVec4 = [number, number, number, number];\n\nfunction getIdentity (): TMatrix4x4 {\n    return [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n}\n\n// point  matrix\nfunction multiplyMatrixAndPoint (matrix: TMatrix4x4, point: TVec4): TVec4 {\n    return [\n        (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\n        (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\n        (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\n        (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]), // w\n    ];\n}\n\n//matrixB  matrixA\nfunction multiplyMatrices (matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\n\n    // Slice the second matrix up into rows\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\n\n    // Multiply each row by matrixA\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\n\n    // Turn the result rows back into a single matrix\n    return [\n        result0[0], result0[1], result0[2], result0[3],\n        result1[0], result1[1], result1[2], result1[3],\n        result2[0], result2[1], result2[2], result2[3],\n        result3[0], result3[1], result3[2], result3[3],\n    ];\n}\n\nfunction createTranslationMatrix (x: number, y: number): TMatrix4x4 {\n    return [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        x, y, 0, 1,\n    ];\n}\n\nfunction createRotationMatrix (angleRad: number): TMatrix4x4 {\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\n    return [\n        Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\n        Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n}\n\nfunction createScaleMatrix (f: number): TMatrix4x4 {\n    return [\n        f, 0, 0, 0,\n        0, f, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n}\n\nexport const Matrix = Object.freeze({\n    getIdentity,\n    multiplyMatrixAndPoint,\n    multiplyMatrices,\n    createTranslationMatrix,\n    createRotationMatrix,\n    createScaleMatrix,\n});\n","import {IVector2D} from '../bb-types';\n\nexport const Vec2 = {\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\n    },\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\n    },\n    nor: function (p: IVector2D): IVector2D {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {x: p.x / len, y: p.y / len};\n    },\n    len: function (p: IVector2D): number {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function (p1: IVector2D, p2: IVector2D): number {\n        return Vec2.len(Vec2.sub(p1, p2));\n    },\n    mul: function (p: IVector2D, s: number): IVector2D {\n        return {x: p.x * s, y: p.y * s};\n    },\n    angle: function (p1: IVector2D, p2: IVector2D): number {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function (a: IVector2D, b: IVector2D): number {\n        const aArr = [a.x, a.y];\n        const bArr = [b.x, b.y];\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\n    },\n};","import {Vec2} from './vec2';\nimport {clamp, dist, mix, pointsToAngleDeg} from './math';\nimport {IVector2D} from '../bb-types';\nimport {copyObj} from '../base/base';\n\n/**\n * project p onto line\n * @param lineStart\n * @param lineEnd\n * @param p\n */\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n\n        return {\n            x: x,\n            y: y,\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - (m * lineStart.x);\n\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n\n    return {\n        x: x,\n        y: y,\n    };\n};\n\n\n/**\n * Operations on a line made up of points\n */\nexport class PointLine {\n\n    private readonly segmentArr: {\n        x: number;\n        y: number;\n        length: number; // last is 0\n    }[];\n\n    // ---- public ----\n    constructor (\n        p: {\n            points: IVector2D[];\n        }\n    ) {\n        this.segmentArr = [];\n\n        for (let i = 0; i < p.points.length; i++) {\n            ((i) => {\n                let length = 0;\n                if (i < p.points.length - 1) {\n                    length = dist(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\n                }\n                this.segmentArr[i] = {\n                    x: p.points[i].x,\n                    y: p.points[i].y,\n                    length: length,\n                };\n            })(i);\n        }\n    }\n\n    // ---- interface ----\n\n    /**\n     * returns point when traveling *dist* along the line, > 0\n     * @param dist\n     */\n    getAtDist (dist: number): IVector2D {\n        let remainder = Math.min(this.getLength(), dist);\n        let i = 0;\n\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\n            remainder -= this.segmentArr[i].length;\n        }\n\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\n\n        return {\n            x: (this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac),\n            y: (this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac),\n        };\n    }\n\n    /**\n     * total length of line\n     */\n    getLength (): number {\n        let result = 0;\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\n            result += this.segmentArr[i].length;\n        }\n        return result;\n    }\n}\n\nexport type TBezierLineCallback = (\n    v: {\n        x: number;\n        y: number;\n        t: number; // [0, 1] - how far along\n        angle?: number;\n        dAngle: number;\n    }\n) => void;\ntype TBezierLineControlsCallback = (\n    v: {\n        p1: IVector2D;\n        p2: IVector2D;\n        p3: IVector2D;\n        p4: IVector2D;\n    }\n) => void;\n\ntype TBezierLinePoint = {\n    x: number;\n    y: number;\n    spacing: number;\n    dir: IVector2D;\n};\n\n/**\n * Each instance is one line made up of bezier interpolated segments.\n * You feed it points. It calculates control points on its own, and the resulting curve.\n */\nexport class BezierLine {\n\n    private readonly pointArr: TBezierLinePoint[];\n    private lastDot: number = 0;\n    private lastPoint: IVector2D | undefined;\n    private lastCallbackPoint: IVector2D | undefined;\n    private lastAngle: number | undefined;\n    private lastSpacing: number | undefined;\n\n    /**\n     * creates bezier curve from control points\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns bezier curve made up of points {x: float, y: float}\n     */\n    private getBezierPoints (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, resolution: number): IVector2D[] {\n        const curvePoints = [];\n        let t;\n        for (let i = 0; i <= resolution; i++) {\n            t = i / resolution;\n            curvePoints[curvePoints.length] = {\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y,\n            };\n        }\n        return curvePoints;\n    }\n\n    // ---- public ----\n    constructor () {\n        this.pointArr = [];\n    }\n\n    // ---- interface ----\n\n    /**\n     * Add new point to line. \"Drawn\" line will go until the previous point.\n     *\n     * @param x - coord of new point\n     * @param y\n     * @param spacing - space between each step\n     * @param callback - calls for each step\n     * @param controlsCallback - calls that callback with the bezier control points\n     */\n    add (\n        x: number,\n        y: number,\n        spacing: number,\n        callback?: TBezierLineCallback,\n        controlsCallback?: TBezierLineControlsCallback,\n    ): void {\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\n            return;\n        }\n        this.lastPoint = {x, y};\n        this.pointArr[this.pointArr.length] = {\n            x,\n            y,\n            spacing,\n        } as TBezierLinePoint;\n\n        //calculate directions\n        if (this.pointArr.length === 1) {\n            this.lastSpacing = spacing;\n            return;\n        } else if (this.pointArr.length === 2) {\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\n            this.lastDot = spacing;\n            this.lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\n                //when xy -3 == -1\n                pointM2.dir = copyObj(pointM3.dir);\n            }\n        }\n\n        //get bezier curve\n        const a = this.pointArr[this.pointArr.length - 3];\n        const b = this.pointArr[this.pointArr.length - 2];\n        const p1 = a;\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\n        const p4 = b;\n\n\n        let pointLine: PointLine;\n        if (callback) {\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new PointLine({points: curvePoints});\n        } else {\n            pointLine = new PointLine({points: [p1, p4]});\n        }\n\n        //iterate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\n        let d = this.lastDot;\n        for (; d <= len; d += tempSpacing) {\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = this.lastCallbackPoint ? pointsToAngleDeg(this.lastCallbackPoint, point) : undefined;\n            if (callback) {\n                callback({\n                    x: point.x,\n                    y: point.y,\n                    t: d / len,\n                    angle: angle,\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\n                });\n            }\n            this.lastCallbackPoint = point;\n            this.lastAngle = angle;\n        }\n\n        if (callback) {\n            this.lastDot = d - len;\n        } else {\n            this.lastDot = 0;\n            controlsCallback && controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\n        }\n\n        this.lastSpacing = spacing;\n    }\n\n    addFinal (\n        spacing: number,\n        callback?: TBezierLineCallback,\n        controlsCallback?: TBezierLineControlsCallback,\n    ): void {\n        if (this.pointArr.length < 2) {\n            return;\n        }\n\n        const p1 = this.pointArr[this.pointArr.length - 2];\n        const p2 = this.pointArr[this.pointArr.length - 1];\n\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\n\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    }\n}\n\n/**\n * from SplineInterpolator.cs in the Paint.NET source code\n */\nexport class SplineInterpolator {\n\n    private readonly xa: number[];\n    private readonly ya: number[];\n    private readonly u: number[];\n    private readonly y2: number[];\n    private readonly first: number;\n    private readonly last: number;\n\n\n    // ---- public ----\n    constructor (\n        points: [number, number][],\n    ) {\n        const n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n        let i;\n\n        this.first = points[0][0];\n        this.last = points[points.length - 1][0];\n\n        points.sort(function (a, b) {\n            return a[0] - b[0];\n        });\n        for (i = 0; i < n; i++) {\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n\n        this.u[0] = 0;\n        this.y2[0] = 0;\n\n        for (i = 1; i < n - 1; ++i) {\n            // This is the decomposition loop of the tridiagonal algorithm.\n            // y2 and u are used for temporary storage of the decomposed factors.\n            const wx = this.xa[i + 1] - this.xa[i - 1];\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            const p = sig * this.y2[i - 1] + 2.0;\n\n            this.y2[i] = (sig - 1.0) / p;\n\n            const ddydx =\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n        }\n\n        this.y2[n - 1] = 0;\n\n        // This is the backsubstitution loop of the tridiagonal algorithm\n        for (i = n - 2; i >= 0; --i) {\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n        }\n    }\n\n    // ---- interface ----\n\n    getFirstX (): number {\n        return this.first;\n    }\n\n    getLastX (): number {\n        return this.last;\n    }\n\n    interpolate (x: number): number {\n        const n = this.ya.length;\n        let klo = 0;\n        let khi = n - 1;\n\n        // We will find the right place in the table by means of\n        // bisection. This is optimal if sequential calls to this\n        // routine are at random values of x. If sequential calls\n        // are in order, and closely spaced, one would do better\n        // to store previous values of klo and khi.\n        while (khi - klo > 1) {\n            const k = (khi + klo) >> 1;\n\n            if (this.xa[k] > x) {\n                khi = k;\n            } else {\n                klo = k;\n            }\n        }\n\n        const h = this.xa[khi] - this.xa[klo];\n        const a = (this.xa[khi] - x) / h;\n        const b = (x - this.xa[klo]) / h;\n\n        // Cubic spline polynomial is now evaluated.\n        return a * this.ya[klo] + b * this.ya[khi] +\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n    }\n\n    /**\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\n     * searches in x 0-1 range\n     */\n    findX (y: number, resolution: number): number | undefined {\n        let x;\n        let dist: number;\n        for (let i = 0; i <= resolution; i++) {\n            const tempX = i / resolution;\n            const tempY = this.interpolate(tempX);\n            if (x === undefined) {\n                x = tempX;\n                dist = Math.abs(tempY - y);\n                continue;\n            }\n\n            const tempDist = Math.abs(tempY - y);\n\n            if (tempDist < dist!) {\n                x = tempX;\n                dist = tempDist;\n            } else {\n                //distance increasing\n                break;\n            }\n        }\n        return x;\n    }\n}\n\n\n/**\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\n * returns [[0, startVal], ..., [1, endVal]]\n * @param startVal\n * @param endVal\n * @param stepSize\n */\nexport function quadraticSplineInput (\n    startVal: number,\n    endVal: number,\n    stepSize: number,\n): [number, number][] {\n    function round (v: number, dec: number): number {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n\n    const resultArr: [number, number][] = [];\n    for (let i = 0; i <= 1; i += stepSize) {\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\n    }\n    return resultArr;\n}","\n\n\n// based on js color conversion http://www.webtoolkit.info/\n\n\nexport class HSV {\n    h: number;\n    s: number;\n    v: number;\n    constructor (h: number, s: number, v: number) {\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\n\nexport class RGB {\n    r : number;\n    g: number;\n    b: number;\n    constructor (r: number, g: number, b: number) {\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\n\nexport class CMYK {\n    c: number;\n    m: number;\n    y: number;\n    k: number;\n    constructor (c: number, m: number, y: number, k: number) {\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\n\nexport const ColorConverter = {\n\n    _RGBtoHSV: function (RGB: RGB): HSV {\n        const result = new HSV(0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n\n        result.v = maxVal;\n\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\n\n            if (r == maxVal) {\n                result.h = del_B - del_G;\n            } else if (g == maxVal) {\n                result.h = (1 / 3) + del_R - del_B;\n            } else if (b == maxVal) {\n                result.h = (2 / 3) + del_G - del_R;\n            }\n\n            if (result.h < 0) {\n                result.h += 1;\n            }\n            if (result.h > 1) {\n                result.h -= 1;\n            }\n        }\n\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n\n        return result;\n    },\n\n    _HSVtoRGB: function (HSV: HSV): RGB {\n        const result = new RGB(0, 0, 0);\n\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n\n        const h = (HSV.h / 360) % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1;\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1;\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3;\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v;\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v;\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2;\n            }\n\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n\n        return result;\n    },\n\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\n        const result = new RGB(0, 0, 0);\n\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n\n        return result;\n    },\n\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\n        const result = new CMYK(0, 0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n\n        return result;\n    },\n\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\n        if (o instanceof RGB) {\n            return o;\n        }\n        if (o instanceof HSV) {\n            return this._HSVtoRGB(o);\n        }\n        if (o instanceof CMYK) {\n            return this._CMYKtoRGB(o);\n        }\n        throw new Error('unknown type');\n    },\n\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\n        if (o instanceof HSV) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoHSV(o);\n        }\n        if (o instanceof CMYK) {\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\n        }\n        throw new Error('unknown type');\n    },\n\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\n        if (o instanceof CMYK) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoCMYK(o);\n        }\n        if (o instanceof HSV) {\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\n        }\n        throw new Error('unknown type');\n    },\n    toHexString: function (o: RGB): string {\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\n            let ha = (parseInt('' + o.r)).toString(16);\n            let hb = (parseInt('' + o.g)).toString(16);\n            let hc = (parseInt('' + o.b)).toString(16);\n            if (ha.length == 1) {\n                ha = '0' + ha;\n            }\n            if (hb.length == 1) {\n                hb = '0' + hb;\n            }\n            if (hc.length == 1) {\n                hc = '0' + hc;\n            }\n            return ha + hb + hc;\n        }\n        return '#000';\n    },\n    toRgbStr: function (rgbObj: {r: number; g: number; b: number}): string {\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\n    },\n    toRgbaStr: function (rgbaObj: {r: number; g: number; b: number; a: number}): string {\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\n    },\n    hexToRGB: function (hexStr: string): RGB | undefined {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new RGB(\n            parseInt(result[1], 16),\n            parseInt(result[2], 16),\n            parseInt(result[3], 16)\n        ) : undefined;\n    },\n\n};\n\nexport function testIsWhiteBestContrast (rgbObj: {r: number; g: number; b: number}): boolean {\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\n}","import {css} from './base';\nimport {BB} from '../bb';\nimport {IKeyStringOptional} from '../bb-types';\n\n\nexport function appendTextDiv (target: HTMLElement, text: string): HTMLDivElement {\n    const div = document.createElement('div');\n    div.innerHTML = text;\n    target.append(div);\n    return div;\n}\n\n/**\n * Is an input element focused.\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\n *\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\n */\nexport function isInputFocused (getAll: boolean = false): boolean {\n    const result: boolean = !!document.activeElement && ['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName);\n    if (getAll) {\n        return result;\n    } else {\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\n    }\n}\n\nexport function unfocusAnyInput (): void {\n    if (isInputFocused(true)) {\n        /*\n            Unfocus anything that is focused.\n\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\n            that isn't its direct parent, then Firefox will keep anything attached to this\n            Input in memory. It will not be garbage collected until a new Input is focused.\n\n            Workaround: Temporarily create an input, focus it, detach it.\n             */\n        const focusEl = BB.el({\n            parent: document.body,\n            tagName: 'input',\n            css: {\n                opacity: '0',\n                width: '0',\n                height: '0',\n            },\n        });\n        setTimeout(() => {\n            focusEl.select();\n            focusEl.focus();\n            focusEl.remove();\n        }, 10);\n    }\n}\n\n/**\n * clears text selection in window\n */\nexport function clearSelection (): void {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) {\n                sel.empty();\n            } else if (sel.removeAllRanges) {\n                sel.removeAllRanges();\n            }\n        }\n    }\n}\n\n/**\n * prevents being able to focus element.\n * warning: it creates a listener\n *\n * @param el - dom element\n */\nexport const makeUnfocusable = (function (): ((el: HTMLElement) => void) {\n\n    function preventFocus (event: FocusEvent): void {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) {\n            try {\n                (event.relatedTarget as HTMLElement).focus();\n                didFocusRelated = true;\n            } catch(e) {\n                console.error('failed to focus');\n            }\n        }\n        if (!didFocusRelated) {\n            (event.currentTarget as HTMLElement).blur();\n        }\n    }\n\n    return function (el) {\n        el.setAttribute('tabindex', '-1');\n        el.addEventListener('focus', preventFocus);\n    };\n})();\n\n\nconst els: {\n    el: HTMLElement;\n    listeners: [keyof HTMLElementEventMap, EventListener][];\n}[] = [];\n// window['els'] = els;\n\n/**\n *\n * Create DOM element - div by default\n * params = {\n * \t    parent: someOtherDiv,\n * \t    css: {\n * \t\t    width: \"500px\",\n * \t\t    backgroundColor: \"#fff\"\n * \t    },\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\n * \t    className: \"bla\",\n *      id: \"bla\"\n * }\n *\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\n *  to prevent a memory leak.\n *\n * @param params\n */\nexport function el <GTag extends keyof HTMLElementTagNameMap = 'div'> (\n    params?: {\n        parent?: HTMLElement;\n        css?: IKeyStringOptional;\n        custom?: { [key: string]: string };\n        content?: string | (HTMLElement | string | undefined)[] | Element;\n        textContent?: string;\n        className?: string;\n        title?: string;\n        id?: string;\n        tagName?: GTag;\n        onClick?: (e: Event) => void;\n        onChange?: (e: Event) => void;\n        noRef?: boolean; // don't keep references of listeners\n    }\n) {\n    if (!params) {\n        return document.createElement('div') as HTMLElementTagNameMap[GTag];\n    }\n    const result = document.createElement(params.tagName ? params.tagName : 'div');\n    params.css && css(result, params.css);\n\n    if (params.content) {\n        if (typeof params.content === typeof 'aa') {\n            result.innerHTML = params.content as string;\n\n        } else if (Array.isArray(params.content)) {\n            BB.append(result, params.content);\n\n        } else {\n            result.append(params.content as HTMLElement);\n\n        }\n    }\n    if (params.textContent) {\n        result.textContent = params.textContent;\n    }\n    if (params.className) {\n        result.className = params.className;\n    }\n    if (params.id) {\n        result.id = params.id;\n    }\n    if (params.parent) {\n        params.parent.append(result);\n    }\n    if ('title' in params && params.title !== undefined) {\n        result.title = params.title;\n    }\n    const listeners: [keyof HTMLElementEventMap, EventListener][] = [];\n    if (params.onClick !== undefined) {\n        result.addEventListener('click', params.onClick);\n        !params.noRef && listeners.push(['click', params.onClick as EventListener]);\n    }\n    if (params.onChange !== undefined) {\n        result.addEventListener('change', params.onChange);\n        !params.noRef && listeners.push(['change', params.onChange]);\n    }\n    if (listeners.length > 0) {\n        els.push({\n            el: result,\n            listeners,\n        });\n        /*div.style.backgroundColor = '#ff0';\n        div.style.border = '1px solid #ff0';*/\n    }\n    if ('custom' in params && params.custom) {\n        const customKeyArr = Object.keys(params.custom);\n        for (let i = 0; i < customKeyArr.length; i++) {\n            result.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n        }\n    }\n    return result as HTMLElementTagNameMap[GTag];\n}\n\n/**\n * removes event listeners for Elements created via el()\n * @param el\n */\nexport function destroyEl (el?: HTMLElement): void {\n    if (!el) {\n        return;\n    }\n    for (let i = 0; i < els.length; i++) {\n        const item = els[i];\n        if (item.el === el) {\n            item.listeners.forEach(item => {\n                el.removeEventListener(item[0], item[1]);\n            });\n            els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n","\ntype TLogListener = (msg: any) => void;\n\nexport class BbLog {\n\n    private static listeners: TLogListener[] = [];\n\n    constructor () {\n    }\n\n    static subscribe (listener: TLogListener): void {\n        if (BbLog.listeners.includes(listener)) {\n            return;\n        }\n        BbLog.listeners.push(listener);\n    }\n\n    static unsubscribe (listener: TLogListener): void {\n        for (let i = 0; i < BbLog.listeners.length; i++) {\n            if (listener === BbLog.listeners[i]) {\n                BbLog.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    static emit (msg: any): void {\n        BbLog.listeners.forEach(item => {\n            item(msg);\n        });\n    }\n}","/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */\nexport class LocalStorage {\n\n    private static error: unknown | undefined;\n\n    static getItem (key: string): string | null {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n\n    static setItem (key: string, value: string): void {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static removeItem (key: string): void {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static getError (): unknown {\n        return this.error;\n    }\n}","import {IPointerEvent} from '../event.types';\nimport {copyObj} from '../../base/base';\n\nexport interface ICoalescedPointerEvent extends IPointerEvent {\n    isCoalesced?: true;\n}\n\n/**\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\n *\n * in: IPointerEvent\n * out: IPointerEvent with property isCoalesced: boolean\n *\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\n * but how could that even work?\n */\nexport class CoalescedExploder {\n\n    private chainOut: ((e: ICoalescedPointerEvent) => void) | undefined;\n\n    // ---- public ----\n\n    setChainOut (func: (e: ICoalescedPointerEvent) => void) {\n        this.chainOut = func;\n    }\n\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n        if (event.type === 'pointermove') {\n\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\n                for (let i = 0; i < event.coalescedArr.length; i++) {\n                    const eventCopy: ICoalescedPointerEvent = copyObj(event);\n                    if (i === 0) {\n                        eventCopy.coalescedArr = [];\n                    }\n                    const coalescedItem = event.coalescedArr[i];\n\n                    eventCopy.pageX = coalescedItem.pageX;\n                    eventCopy.pageY = coalescedItem.pageY;\n                    eventCopy.relX = coalescedItem.relX;\n                    eventCopy.relY = coalescedItem.relY;\n                    eventCopy.dX = coalescedItem.dX;\n                    eventCopy.dY = coalescedItem.dY;\n                    eventCopy.time = coalescedItem.time;\n                    if (i < event.coalescedArr.length - 1) {\n                        eventCopy.isCoalesced = true;\n                    }\n\n                    this.chainOut && this.chainOut(eventCopy);\n                }\n\n            } else {\n                return event;\n            }\n        } else {\n            return event;\n        }\n\n        return null;\n    }\n\n}\n","import {dist} from '../../math/math';\nimport {IPointerEvent} from '../event.types';\n\n/**\n * A ChainElement. Detects a single tap with N 'touch' pointers\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class NFingerTapper {\n\n    private readonly minSilenceBeforeDurationMs = 50;\n    private readonly maxTapMs = 500;\n    private readonly maxFirstLastFingerDownMs = 250;\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\n\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\n    private fingerArr: {\n        pointerId: number;\n        downTimeMs: number;\n        downPageX: number;\n        downPageY: number;\n        isUp?: boolean;\n    }[] = [];\n    private eventQueueArr: IPointerEvent[] = [];\n    private firstDownTime: number = 0;\n    private lastEventTime: number = 0;\n    private nowTime: number = performance.now();\n    private readonly pointersDownIdArr: number[] = [];\n    private readonly fingers: number;\n    private readonly onTap: () => void;\n    private readonly timeoutObj: {\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\n        tapTimeout: ReturnType<typeof setTimeout> | null;\n    } = {\n        firstLastDownTimeout: null,\n        tapTimeout: null,\n    };\n\n    private failGesture (): void {\n        if (this.eventQueueArr.length === 0) {\n            return;\n        }\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\n        }\n        this.eventQueueArr = [];\n        this.fingerArr = [];\n    }\n\n    private success (): void {\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        this.eventQueueArr = []; // events get swallowed\n        this.fingerArr = [];\n        this.onTap();\n    }\n\n    private setupTimeout (timeoutStr: 'firstLastDownTimeout' | 'tapTimeout', timeMS: number): boolean {\n        const diff = timeMS - this.nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\n        return true;\n    }\n\n    private processEvent (event: IPointerEvent): true | void {\n\n        const tempLastEventTime = this.lastEventTime;\n        this.lastEventTime = event.time;\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (event.pointerType !== 'touch') {\n            if (this.fingerArr.length > 0) { // already in gesture -> fail\n                this.failGesture();\n            }\n            return;\n        }\n\n        this.nowTime = performance.now();\n\n        if (event.type === 'pointerdown') {\n            //console.log('down');\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === this.fingers) { // too many fingers down -> fail\n                //console.log(fingers + ': too many fingers down -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) { // took too long to touch with all fingers -> fail\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\n                //console.log(fingers + ': not enough silence before -> fail');\n                this.failGesture();\n                return;\n            }\n\n            if (this.fingerArr.length === 0) {\n                this.firstDownTime = event.time;\n\n                if (!this.setupTimeout('firstLastDownTimeout', event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)) { // timeouts already up -> fail\n                    this.failGesture();\n                    return;\n                }\n\n            }\n            this.fingerArr.push({\n                pointerId: event.pointerId,\n                downTimeMs: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n            });\n            return;\n\n        }\n\n        if (event.type === 'pointermove') {\n\n            if (this.fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            let fingerObj = null;\n            for (let i = 0; i < this.fingerArr.length; i++) {\n                if (this.fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = this.fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\n                this.failGesture();\n                return;\n            }\n\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                this.failGesture();\n                return;\n            }\n\n        }\n\n        if (event.type === 'pointerup') {\n\n            if (this.fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            //console.log('up', event.pageX, event.pageY);\n            if (this.fingerArr.length !== this.fingers) { // not enough fingers -> fail\n                //console.log(fingers + ': not enough fingers -> fail');\n                this.failGesture();\n                return;\n            }\n\n            let fingerObj = null;\n            let i = 0;\n            for (; i < this.fingerArr.length; i++) {\n                if (this.fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = this.fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                //do nothing\n                return;\n            }\n\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                this.failGesture();\n                return;\n            }\n\n            fingerObj.isUp = true;\n\n            let allAreUp = true;\n            for (let i = 0; i < this.fingerArr.length; i++) {\n                if (!this.fingerArr[i].isUp) {\n                    allAreUp = false;\n                    break;\n                }\n            }\n            //console.log('fingerArr', fingerArr);\n\n            if (allAreUp) { // success\n                this.success();\n                return true;\n            }\n\n        }\n\n\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            fingers: number;\n            onTap: () => void;\n        }\n    ) {\n        this.fingers = p.fingers;\n        this.onTap = p.onTap;\n    }\n\n\n    chainIn (event: IPointerEvent): (IPointerEvent | null) {\n\n        const result = this.processEvent(event);\n\n        //console.log(fingerArr.length);\n\n        if (result === true) {\n            //tap success -> event gets swallowed\n            return null;\n        }\n        if (this.fingerArr.length === 0) {\n            return event;\n        } else {\n            this.eventQueueArr.push(event);\n        }\n\n        return null;\n\n    }\n\n    setChainOut (func: (e: IPointerEvent) => void): void {\n        this.chainOut = func;\n    }\n\n\n}\n","import {dist, pointsToAngleRad} from '../../math/math';\nimport {IPointerEvent} from '../event.types';\n\nexport type TPinchZoomerEvent = { type: 'end' } | {\n    type: 'move';\n\n    downRelX: number;\n    downRelY: number;\n    relX: number;\n    relY: number;\n\n    angleRad: number;\n    scale: number;\n};\n\ntype TTouchPointer =  {\n    pointerId: number;\n    relX: number;\n    relY: number;\n    downRelX?: number; // only for first\n    downRelY?: number;\n};\n\ntype TPinchGesture = {\n    touchPointerArr: TTouchPointer[];\n    otherPointerIdArr: number[];\n    isInProgress: boolean;\n};\n\n/**\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\n * Further pointers are ignored, but their events get swallowed during the pinching.\n * pinching ends when ALL pointers are lifted.\n * Events passed through if no pinching.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class PinchZoomer {\n\n    private readonly firstFingerMaxDistancePx = 10;\n    private readonly untilSecondFingerDurationMs = 250;\n\n\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\n    private readonly pointersDownIdArr: number[] = [];\n    private gestureObj: null | TPinchGesture = null;\n    private eventQueueArr: IPointerEvent[] = [];\n    private nowTime: number = performance.now();\n    private readonly timeoutObj: {\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\n    } = {\n        secondFingerTimeout: null,\n    };\n    private pincherArr: {\n        pointerId: number;\n        relX: number;\n        relY: number;\n        downRelX: number;\n        downRelY: number;\n    }[] = [];\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\n\n\n    private end (): void {\n        this.gestureObj = null;\n        this.eventQueueArr = [];\n    }\n\n    private fail (doSwallow?: boolean): void {\n        if (!this.gestureObj) { // no gesture happening -> ignore\n            return;\n        }\n\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n        if (!doSwallow) {\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\n            }\n        }\n        this.end();\n    }\n\n    private setupFailTimeout (timeMS: number): boolean {\n        const diff = timeMS - this.nowTime;\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\n        return true;\n    }\n\n    private processEvent (event: IPointerEvent): void {\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        //pass through scenarios\n        if (\n            !this.gestureObj && (\n                event.pointerType !== 'touch' || // wrong pointer type\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\n                this.pointersDownIdArr.length > 1 || // failed before\n                event.type === 'pointerup' // failed before\n            )\n        ) {\n            return;\n        }\n\n        this.nowTime = performance.now();\n\n\n        //pointer down\n        if (event.type === 'pointerdown') {\n\n            if (this.gestureObj) {\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\n\n                    this.gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                    });\n\n                    if (this.gestureObj.isInProgress) {\n                        this.continuePinch(this.gestureObj, {\n                            type: 'down',\n                            index: this.gestureObj.touchPointerArr.length - 1,\n                        });\n                    } else {\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n                        this.gestureObj.isInProgress = true;\n                        this.beginPinch(this.gestureObj);\n                    }\n                    return;\n\n                } else { // non-touch finger down - as nth pointer\n\n                    if (this.gestureObj.isInProgress) {\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\n                    } else { // second pointer wrong type -> fail\n                        this.fail();\n                    }\n                    return;\n                }\n\n\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                this.gestureObj = {\n                    touchPointerArr: [{\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                        downRelX: event.relX,\n                        downRelY: event.relY,\n                    }],\n                    otherPointerIdArr: [],\n                    isInProgress: false,\n                };\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) { // time ran out -> fail\n                    this.fail();\n                    return;\n                }\n                return;\n            }\n\n        }\n\n        // should not happen. something went wrong\n        if (!this.gestureObj) {\n            // throw? would make it less robust\n            this.fail();\n            return;\n        }\n\n        //pointer move\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\n            //gesture object should always exist here\n\n            let touchPointerObj: TTouchPointer | null = null;\n            let i = 0;\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\n                    break;\n                }\n            }\n\n            //null should not be possible. something went wrong\n            if (!touchPointerObj) {\n                // throw? would make it less robust\n                this.fail();\n                return;\n            }\n\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n\n            if (!this.gestureObj.isInProgress) { // only one finger down & pinching hasn't started\n\n                // should not happen. something went wrong\n                if (\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\n                ) {\n                    this.fail();\n                    return;\n                }\n\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                if (distance > this.firstFingerMaxDistancePx) { // moved too much -> fail\n                    this.fail();\n                    return;\n                }\n\n            } else {\n                if (i < 2) { // only first two touches can affect pinching\n                    this.continuePinch(this.gestureObj, {\n                        type: 'move',\n                        index: i,\n                    });\n                }\n            }\n\n            return;\n        }\n\n\n        //pointer up\n        if (event.type === 'pointerup') {\n            //gesture object should always exist here\n\n            if (event.pointerType === 'touch') {\n                let i = 0;\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                        this.gestureObj.touchPointerArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (this.gestureObj.touchPointerArr.length > 0) {\n                    this.continuePinch(this.gestureObj, {\n                        type: 'up',\n                        index: i,\n                    });\n                }\n\n            } else { // non-touch\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n\n            //all fingers lifted?\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\n                if (this.gestureObj.isInProgress) { // lifted last finger -> end of pinching\n                    this.end();\n                    this.endPinch();\n                } else { // lifted finger again before pinching started -> fail\n                    this.fail();\n                }\n                return;\n            }\n\n        }\n\n\n    }\n\n    private beginPinch (gestureObj: TPinchGesture): void {\n\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\n            const pointerObj = gestureObj.touchPointerArr[i];\n            this.pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY,\n            });\n        }\n\n        const event: TPinchZoomerEvent = {\n            type: 'move',\n\n            // temp\n            downRelX: 0,\n            downRelY: 0,\n            relX: 0,\n            relY: 0,\n\n            angleRad: 0,\n            scale: 1,\n        };\n\n        if (this.pincherArr.length === 1) {\n            event.relX = this.pincherArr[0].downRelX;\n            event.relY = this.pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n\n        this.onPinch(event);\n\n    }\n\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    private continuePinch (\n        gestureObj: TPinchGesture,\n        actionObj: {\n            type: 'down' | 'move' | 'up';\n            index: number;\n        }\n    ): void {\n\n        if (actionObj.index > 1) { // only first two pointers matter\n            return;\n        }\n\n        if (actionObj.type === 'move') {\n\n            let event: TPinchZoomerEvent;\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n\n            if (this.pincherArr.length === 1) {\n\n                event = {\n                    type: 'move',\n                    downRelX: this.pincherArr[0].downRelX,\n                    downRelY: this.pincherArr[0].downRelY,\n                    relX: this.pincherArr[0].relX,\n                    relY: this.pincherArr[0].relY,\n                    angleRad: 0,\n                    scale: 1,\n                };\n\n            } else {\n\n                const startDist = dist(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\n                const distance = dist(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\n\n                const startAngle = pointsToAngleRad({\n                    x: this.pincherArr[0].downRelX,\n                    y: this.pincherArr[0].downRelY,\n                }, {x: this.pincherArr[1].downRelX, y: this.pincherArr[1].downRelY});\n                const angle = pointsToAngleRad({\n                    x: this.pincherArr[0].relX,\n                    y: this.pincherArr[0].relY,\n                }, {x: this.pincherArr[1].relX, y: this.pincherArr[1].relY});\n\n                event = {\n                    type: 'move',\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist,\n                };\n\n            }\n\n            this.onPinch(event);\n\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\n            this.endPinch();\n            this.beginPinch(gestureObj);\n        }\n\n    }\n\n    private endPinch (): void {\n        this.pincherArr = [];\n        this.onPinch({\n            type: 'end',\n        });\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onPinch: (e: TPinchZoomerEvent) => void;\n        }\n    ) {\n        this.onPinch = p.onPinch;\n    }\n\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n        this.processEvent(event);\n        if (this.gestureObj) {\n            if (!this.gestureObj.isInProgress) { // might still fail -> into queue\n                this.eventQueueArr.push(event);\n            }\n        } else {\n            return event;\n        }\n        return null;\n    }\n\n    setChainOut (func: (e: IPointerEvent) => void): void {\n        this.chainOut = func;\n    }\n\n}\n","import {TChainOutFunc} from './event-chain.types';\nimport {dist} from '../../math/math';\nimport {IPointerEvent, TPointerButton, TPointerType} from '../event.types';\n\n\nexport interface IDoubleTapperEvent {\n    pageX: number;\n    pageY: number;\n    relX: number;\n    relY: number;\n}\n\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\n\n/**\n * A ChainElement. Detects double taps.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class DoubleTapper {\n\n    private readonly onDoubleTap: (e: IDoubleTapperEvent) => void;\n    private chainOut: TChainOutFunc | undefined;\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\n    private allowedButtonArr: TPointerButton[] = ['left'];\n    private minSilenceBeforeDurationMs: number = 400;\n    private maxPressedDurationMs: number = 300;\n    private maxPressedDistancePx: number = 10;\n    private maxInbetweenDistancePx: number = 19;\n    private maxUpToUpDurationMs: number = 500;\n    private maxUntilSecondDownDurationMs: number = 300;\n    private minSilenceAfterMs: number = 250;\n    private sequenceArr: (\n        {\n            isDown: boolean;\n            time: number;\n            position: [number, number];\n            pointerId: number;\n        } |\n        {\n            isUp: boolean;\n            time: number;\n            position: [number, number];\n        } |\n        {\n            pageX: number;\n            pageY: number;\n            relX: number;\n            relY: number;\n        }\n        )[] = [];\n    private pointersDownIdArr: number[] = [];\n    private lastUpTime: number = 0;\n    private nowTime: number = 0;\n    private eventQueueArr: IPointerEvent[] = [];\n    private timeoutObj: {\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\n    } = {\n        fail: null,\n        maxUntilSecondDown: null,\n        success: null,\n    };\n    private readonly gestureFailed: () => void;\n\n    // double tap achieved\n    private success (): void {\n        this.timeoutObj.fail = null;\n        this.timeoutObj.success = null;\n        this.eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\n        this.sequenceArr = [];\n        if ('pageX' in lastSequenceItem) {\n            this.onDoubleTap({\n                pageX: lastSequenceItem.pageX,\n                pageY: lastSequenceItem.pageY,\n                relX: lastSequenceItem.relX,\n                relY: lastSequenceItem.relY,\n            });\n        }\n    }\n\n    // returns false if time already up. otherwise sets up timeout\n    private setupTimeout (\n        timeoutStr: TDoubleTapperTimeoutType,\n        targetFunc: () => void,\n        timeMS: number,\n        noComparison?: boolean,\n    ): boolean {\n        const diff = timeMS - this.nowTime;\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0 && !noComparison) { // time already up\n            return false;\n        }\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, Math.max(0, diff));\n        return true;\n    }\n\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */\n    private processEvent (event: IPointerEvent): void {\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\n            //console.log('wrong input type -> fail');\n            this.gestureFailed();\n            return;\n        }\n\n        this.nowTime = performance.now();\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\n        if (event.type === 'pointerup') {\n            this.lastUpTime = event.time;\n        }\n\n        if (event.type === 'pointerdown') {\n            if (this.pointersDownIdArr.length > 1) { // more than one pointer down -> fail\n                //console.log('more than one pointer down -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.timeoutObj.success !== null) { // silence-after not achieved -> fail\n                //console.log('silence-after not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) { // silence before not achieved -> fail\n                //console.log('silence before not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (event.button && !this.allowedButtonArr.includes(event.button)) { // wrong button -> fail\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                this.gestureFailed();\n                return;\n            }\n            if ((lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) || this.sequenceArr.length > 2) { // jumbled -> fail\n                //console.log('jumbled -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                if (distance > this.maxInbetweenDistancePx) { //moved too much -> reset\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    this.gestureFailed();\n\n\n                    if ('time' in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) { //silence before not achieved -> fail\n                        return;\n                    }\n                }\n            }\n            this.sequenceArr.push({\n                isDown: true,\n                time: this.nowTime,\n                position: [event.pageX, event.pageY],\n                pointerId: event.pointerId,\n            });\n            //maxUntilSecondDown\n\n            if (this.sequenceArr.length > 1) {\n                this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            } else if (!this.setupTimeout('maxUntilSecondDown', () => this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n\n\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointermove' && 'pointerId' in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                this.fail();\n                return;\n            }*/\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n            if (distance > this.maxPressedDistancePx) { //moved too much -> fail\n                //console.log('maxPressedDistancePx -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointerup') {\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                this.gestureFailed();\n                return;\n            }\n            if ('time' in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) { //pressed too long -> fail\n                this.gestureFailed();\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n\n            if (this.sequenceArr.length < 3) {\n                if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\n                    this.gestureFailed();\n                    return;\n                }\n\n                this.sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: this.nowTime,\n                        position: [event.pageX, event.pageY],\n                    },\n                ];\n                return;\n            }\n\n            if ('time' in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\n                // double tap almost success\n                // only needs silence\n                this.sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY,\n                    relX: event.relX,\n                    relY: event.relY,\n                });\n                if (\n                    !this.setupTimeout(\n                        'success',\n                        () => this.success(),\n                        event.time + this.minSilenceAfterMs,\n                        true\n                    )\n                ) {\n                    this.gestureFailed();\n                }\n            } else { // time up -> fail\n                this.gestureFailed();\n            }\n\n        }\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onDoubleTap: (e: IDoubleTapperEvent) => void; // fires when double tap occurs\n            isInstant?: boolean;\n        }\n    ) {\n        this.onDoubleTap = p.onDoubleTap;\n        if (p.isInstant) {\n            this.minSilenceBeforeDurationMs = 0;\n            this.minSilenceAfterMs = 0;\n        }\n        this.gestureFailed = () => {\n            if (this.sequenceArr.length === 0) { // no gesture started -> can be ignored\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\n            this.timeoutObj.fail = null;\n            this.timeoutObj.maxUntilSecondDown = null;\n            this.timeoutObj.success = null;\n\n            if (this.chainOut) {\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\n                    this.chainOut(this.eventQueueArr[i]);\n                }\n            }\n\n            this.eventQueueArr = [];\n            this.sequenceArr = [];\n        };\n    }\n\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n\n        this.processEvent(event);\n\n        if (this.sequenceArr.length === 0) { //existing events can not become a double tap\n            this.gestureFailed();\n            return event;\n        }\n        // events might become a double tap -> queue\n        this.eventQueueArr.push(event);\n        return null;\n    }\n\n    setChainOut (func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n\n    setAllowedPointerTypeArr (arr: TPointerType[]): void {\n        this.allowedPointerTypeArr = [...arr];\n    }\n\n    setAllowedButtonArr (arr: TPointerButton[]): void {\n        this.allowedButtonArr = [...arr];\n    }\n\n}\n","import {TChainOutFunc} from './event-chain.types';\nimport {IPointerEvent} from '../event.types';\n\n/**\n * only lets through events from one pointer at a time.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class OnePointerLimiter {\n\n    private chainOut: TChainOutFunc | undefined;\n    private downPointerId: number | null = null;\n    private readonly ignorePointerIdArr: number[] = [];\n\n    // ---- public ----\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === 'pointerup') {\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\n                        this.ignorePointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n            return null;\n        }\n\n        if (this.downPointerId === null) {\n            if (event.type === 'pointerdown') {\n                this.downPointerId = event.pointerId;\n            }\n            return event;\n\n        } else {\n            if (event.pointerId !== this.downPointerId) {\n                if (event.type === 'pointerdown') {\n                    this.ignorePointerIdArr.push(event.pointerId);\n                }\n                return null;\n            }\n            if (event.type === 'pointerup') {\n                this.downPointerId = null;\n            }\n            return event;\n        }\n    }\n\n    setChainOut (func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n}","import {IChainElement, TChainOutFunc} from './event-chain.types';\nimport {IPointerEvent} from '../event.types';\n\n/**\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\n */\nexport class EventChain {\n    private readonly chainArr: IChainElement[];\n    private chainOut: TChainOutFunc | undefined;\n\n    private continueChain (i: number, event: IPointerEvent): null {\n        for (; i < this.chainArr.length; i++) {\n            event = this.chainArr[i].chainIn(event);\n            if (event === null) {\n                return null;\n            }\n        }\n        this.chainOut && this.chainOut(event);\n        return null;\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            chainArr: IChainElement[];\n        }\n    ) {\n        this.chainArr = p.chainArr;\n\n        for (let i = 0; i < this.chainArr.length; i++) {\n            ( (i) => {\n                this.chainArr[i].setChainOut((event: IPointerEvent) => {\n                    this.continueChain(i + 1, event);\n                });\n            })(i);\n        }\n\n    }\n\n    /**\n     * feed an event into the chain\n     */\n    chainIn (event: IPointerEvent): null {\n        return this.continueChain(0, event);\n    }\n\n    /**\n     * func will be called when event has passed through the chain\n     */\n    setChainOut (func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n\n}\n","import {english, languages, loadLanguage, TTranslationCode} from '../../languages/languages';\n\nexport const LS_LANGUAGE_KEY = 'klecks-language';\n\nclass LanguageStrings {\n    private data: any;\n    private listeners: (() => void)[] = [];\n    private code: string;\n\n    // --- public ----\n    constructor () {\n        // need to use setLanguage for a different language\n        this.data = {...english};\n        this.code = 'en';\n    }\n\n    async setLanguage (langCode: string): Promise<void> {\n        if (langCode === 'en') {\n            this.data = {...english};\n        } else {\n            this.data = {...english, ...(await loadLanguage(langCode))};\n        }\n        this.code = langCode;\n        document.documentElement.setAttribute('lang', langCode);\n        this.listeners.forEach(item => {\n            item();\n        });\n    }\n\n    get (code: TTranslationCode): string {\n        if (!(code in this.data)) {\n            throw new Error(\"translation code doesn't exist: \" + code);\n        }\n        return this.data[code];\n    }\n\n    getLanguage (): {code: string; name: string} {\n        return languages.find(item => {\n            return item.code === this.code;\n        })!;\n    }\n\n    getAutoLanguage (): {code: string; name: string} {\n        const autoCode = getLanguage(false);\n        return languages.find(item => {\n            return item.code === autoCode;\n        })!;\n    }\n\n    getCode (): string {\n        return this.code;\n    }\n\n    // get notified on language change\n    subscribe (subscriber: () => void) {\n        if (this.listeners.includes(subscriber)) {\n            return;\n        }\n        this.listeners.push(subscriber);\n    }\n\n    unsubscribe (subscriber: () => void) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (subscriber === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n}\n\nexport function getLanguage (useLocalStorage?: boolean): string {\n\n    let result: string = 'en';\n\n    const langs: string[] = []; // from highest to lowest priority\n    const navLangs = navigator.languages ? navigator.languages : [navigator.language];\n    navLangs.forEach(item => {\n        const split = item.split('-');\n        langs.push(item);\n        if (split.length === 2) {\n            langs.push(split[0]);\n        }\n    });\n\n    if (useLocalStorage) {\n        try {\n            const item = localStorage.getItem(LS_LANGUAGE_KEY);\n            if (item) {\n                langs.unshift(item);\n            }\n        } catch (e) {\n            // likely cookies disabled in Safari\n        }\n    }\n    console.log(langs);\n    console.log(languages);\n    for (let i = 0; i < langs.length; i++) {\n        const lang = langs[i];\n        const found = languages.find(item => {\n            return item.code.toLowerCase() === lang.toLowerCase();\n        });\n        if (found) {\n            result = found.code;\n            break;\n        }\n    }\n    return result;\n}\n\nconst activeLanguageCode = getLanguage(true);\nexport const languageStrings = new LanguageStrings();\n\nexport const LANG = (code: TTranslationCode, replace?: {[key: string]: string}): string => {\n    if (replace) {\n        let result = languageStrings.get(code);\n        const keyArr = Object.keys(replace);\n        keyArr.forEach(key => {\n            result = result.replace(`{${key}}`, replace[key]);\n        });\n        return result;\n    } else {\n        return languageStrings.get(code);\n    }\n};\n\nexport const initLANG = () => languageStrings.setLanguage(activeLanguageCode);","// generated from src/languages. \"npm run lang:build\" to update\n\nimport dataEn from './en.json';\n\nexport const english = dataEn;\nexport const languages: {code: string; name: string}[] = [\n    {\n        code: 'en',\n        name: 'English',\n    },\n    {\n        code: 'de',\n        name: 'Deutsch',\n    },\n    {\n        code: 'en-GB',\n        name: 'English',\n    },\n    {\n        code: 'en-US',\n        name: 'English',\n    },\n    {\n        code: 'en-ZA',\n        name: 'English',\n    },\n    {\n        code: 'en',\n        name: 'English',\n    },\n    {\n        code: 'fr',\n        name: 'Franais',\n    },\n    {\n        code: 'ja',\n        name: '',\n    },\n    {\n        code: 'ko',\n        name: '',\n    },\n    {\n        code: 'ru',\n        name: '',\n    },\n    {\n        code: 'zh-CN',\n        name: '',\n    },\n    {\n        code: 'zh-TW',\n        name: '',\n    },\n];\nexport const loadLanguage = async (code: string): Promise<Record<TTranslationCode, string>> => {\n    if (code === 'en') {\n        return english;\n    } else if (code === 'de') {\n        return await import('./de.json');\n    } else if (code === 'en-GB') {\n        return await import('./en-GB.json');\n    } else if (code === 'en-US') {\n        return await import('./en-US.json');\n    } else if (code === 'en-ZA') {\n        return await import('./en-ZA.json');\n    } else if (code === 'en') {\n        return await import('./en.json');\n    } else if (code === 'fr') {\n        return await import('./fr.json');\n    } else if (code === 'ja') {\n        return await import('./ja.json');\n    } else if (code === 'ko') {\n        return await import('./ko.json');\n    } else if (code === 'ru') {\n        return await import('./ru.json');\n    } else if (code === 'zh-CN') {\n        return await import('./zh-CN.json');\n    } else if (code === 'zh-TW') {\n        return await import('./zh-TW.json');\n    }\n    throw new Error('unknown language code');\n};\n\nexport type TTranslationCode = 'switch-ui-left-right' | // Switch left/right UI\n    'toggle-show-tools' | // Show/Hide Tools\n    'scroll' | // Scroll\n    'donate' | // Donate\n    'home' | // Home\n    'modal-new-tab' | // Open in new tab\n    'tab-edit' | // Edit\n    'tab-file' | // File\n    'tool-brush' | // Brush\n    'tool-paint-bucket' | // Paint Bucket\n    'tool-gradient' | // Gradient\n    'tool-shape' | // Shape\n    'tool-text' | // Text\n    'tool-hand' | // Hand Tool\n    'tool-zoom' | // Zoom\n    'undo' | // Undo\n    'redo' | // Redo\n    'brush-pen' | // Pen\n    'brush-blend' | // Blend\n    'brush-sketchy' | // Sketchy\n    'brush-pixel' | // Pixel\n    'brush-chemy' | // Chemy\n    'brush-smudge' | // Smudge\n    'brush-size' | // Size\n    'brush-blending' | // Blending\n    'brush-toggle-pressure' | // Toggle Pressure Sensitivity\n    'brush-pen-circle' | // Circle\n    'brush-pen-chalk' | // Chalk\n    'brush-pen-calligraphy' | // Calligraphy\n    'brush-pen-square' | // Square\n    'brush-sketchy-scale' | // Scale\n    'brush-pixel-dither' | // Dither\n    'brush-chemy-fill' | // Fill\n    'brush-chemy-stroke' | // Stroke\n    'brush-chemy-mirror-x' | // Horizontal Symmetry\n    'brush-chemy-mirror-y' | // Vertical Symmetry\n    'brush-chemy-gradient' | // Gradient\n    'brush-eraser-transparent-bg' | // Transparent Background\n    'stabilizer' | // Stabilizer\n    'stabilizer-title' | // Stroke Stabilizer\n    'eyedropper' | // Eyedropper\n    'secondary-color' | // Secondary Color\n    'manual-color-input' | // Manual Color Input\n    'mci-hex' | // Hex\n    'mci-copy' | // Copy\n    'modal-ok' | // Ok\n    'modal-cancel' | // Cancel\n    'modal-close' | // Close\n    'layers-active-layer' | // Active Layer\n    'layers-layer' | // Layer\n    'layers-copy' | // copy\n    'layers-blending' | // Blending\n    'layers-new' | // New Layer\n    'layers-remove' | // Remove Layer\n    'layers-duplicate' | // Duplicate Layer\n    'layers-merge' | // Merge with layer below\n    'layers-merge-all' | // Merge all\n    'layers-rename' | // Rename\n    'layers-active-layer-visible' | // Active layer is visible\n    'layers-active-layer-hidden' | // Active layer is hidden\n    'layers-visibility-toggle' | // Layer Visibility\n    'layers-blend-normal' | // normal\n    'layers-blend-darken' | // darken\n    'layers-blend-multiply' | // multiply\n    'layers-blend-color-burn' | // color burn\n    'layers-blend-lighten' | // lighten\n    'layers-blend-screen' | // screen\n    'layers-blend-color-dodge' | // color dodge\n    'layers-blend-overlay' | // overlay\n    'layers-blend-soft-light' | // soft light\n    'layers-blend-hard-light' | // hard light\n    'layers-blend-difference' | // difference\n    'layers-blend-exclusion' | // exclusion\n    'layers-blend-hue' | // hue\n    'layers-blend-saturation' | // saturation\n    'layers-blend-color' | // color\n    'layers-blend-luminosity' | // luminosity\n    'layers-rename-title' | // Rename Layer\n    'layers-rename-name' | // Name\n    'layers-rename-clear' | // Clear Name\n    'layers-rename-sketch' | // Sketch\n    'layers-rename-colors' | // Colors\n    'layers-rename-shading' | // Shading\n    'layers-rename-lines' | // Lines\n    'layers-rename-effects' | // Effects\n    'layers-rename-foreground' | // Foreground\n    'layers-merge-modal-title' | // Merge/Mix Layers\n    'layers-merge-description' | // Merges the selected layer with the one underneath. Select the mix mode:\n    'file-no-autosave' | // No autosave, no cloud storage\n    'file-new' | // New\n    'file-import' | // Import\n    'file-save' | // Save\n    'file-format' | // File Format\n    'file-copy' | // Copy\n    'file-copy-title' | // Copy To Clipboard\n    'file-share' | // Share\n    'file-storage' | // Browser Storage\n    'file-storage-thumb-title' | // Restores when reopening page\n    'file-storage-about' | // About Browser Storage\n    'file-storage-cant-access' | // Can't access\n    'file-storage-empty' | // Empty\n    'file-storage-store' | // Store\n    'file-storage-clear' | // Clear\n    'file-storage-storing' | // Storing\n    'file-storage-overwrite' | // Overwrite\n    'file-storage-min-ago' | // {x}min ago\n    'file-storage-hours-ago' | // {x}h ago\n    'file-storage-days-ago' | // {x}d ago\n    'file-storage-month-ago' | // > 1month ago\n    'file-storage-restored' | // Restored from Browser Storage\n    'file-storage-stored' | // Stored to Browser Storage\n    'file-storage-failed' | // Failed to store to Browser Storage\n    'file-storage-failed-1' | // Failed to store. Possible causes:\n    'file-storage-failed-2' | // Out of disk space\n    'file-storage-failed-3' | // Storage disabled in incognito tab\n    'file-storage-failed-4' | // Browser doesn't support storage\n    'file-storage-failed-clear' | // Failed to clear.\n    'file-upload' | // Upload\n    'cleared-layer' | // Cleared layer\n    'filled' | // Filled\n    'new-title' | // New Image\n    'new-current' | // Current\n    'new-fit' | // Fit\n    'new-oversize' | // Oversize\n    'new-square' | // Square\n    'new-landscape' | // Landscape\n    'new-portrait' | // Portrait\n    'new-screen' | // Screen\n    'new-video' | // Video\n    'new-din-paper' | // DIN Paper\n    'new-px' | // px\n    'new-ratio' | // Ratio\n    'upload-title' | // Upload to Imgur\n    'upload-link-notice' | // Anyone with the link to your uploaded image will be able to view it.\n    'upload-name' | // Title\n    'upload-title-untitled' | // Untitled\n    'upload-caption' | // Caption\n    'upload-submit' | // Upload\n    'upload-uploading' | // Uploading...\n    'upload-success' | // Upload Successful\n    'upload-failed' | // Upload failed.\n    'upload-delete' | // To delete your image from Imgur visit:\n    'cropcopy-title-copy' | // Copy To Clipboard\n    'cropcopy-title-crop' | // Crop\n    'cropcopy-click-hold' | // Right-click or press hold to copy.\n    'cropcopy-btn-copy' | // To Clipboard\n    'cropcopy-copied' | // Copied.\n    'cropcopy-btn-crop' | // Apply Crop\n    'crop-drag-to-crop' | // Drag to crop\n    'filter-crop-extend' | // Crop/Extend\n    'filter-flip' | // Flip\n    'filter-perspective' | // Perspective\n    'filter-resize' | // Resize\n    'filter-rotate' | // Rotate\n    'filter-transform' | // Transform\n    'filter-bright-contrast' | // Bright/Contrast\n    'filter-curves' | // Curves\n    'filter-hue-sat' | // Hue/Saturation\n    'filter-invert' | // Invert\n    'filter-tilt-shift' | // Tilt Shift\n    'filter-to-alpha' | // To Alpha\n    'filter-triangle-blur' | // Triangle Blur\n    'filter-unsharp-mask' | // Unsharp Mask\n    'filter-crop-title' | // Crop / Extend\n    'filter-crop-description' | // Crop or extend the image.\n    'filter-crop-left' | // Left\n    'filter-crop-right' | // Right\n    'filter-crop-top' | // Top\n    'filter-crop-bottom' | // Bottom\n    'filter-crop-rule-thirds' | // Rule of Thirds\n    'filter-crop-fill' | // Fill\n    'filter-flip-title' | // Flip\n    'filter-flip-description' | // Flips layer or whole image.\n    'filter-flip-horizontal' | // Horizontal\n    'filter-flip-vertical' | // Vertical\n    'filter-flip-image' | // Flip Image\n    'filter-flip-layer' | // Flip Layer\n    'filter-perspective-title' | // Perspective\n    'filter-perspective-description' | // Transforms the selected layer.\n    'filter-resize-title' | // Resize\n    'filter-resize-description' | // Resizes the image.\n    'filter-rotate-title' | // Rotate\n    'filter-rotate-description' | // Rotates the image.\n    'filter-transform-empty' | // Layer is empty.\n    'filter-transform-title' | // Transform\n    'filter-transform-description' | // Transforms selected layer. Hold Shift for additional behavior.\n    'filter-transform-rotation' | // Rotation\n    'filter-transform-flip' | // Flip\n    'filter-transform-center' | // Center\n    'filter-transform-constrain' | // Constrain\n    'filter-transform-snap' | // Snap\n    'filter-transform-snap-title' | // Snap Rotation And Position\n    'filter-bright-contrast-title' | // Brightness / Contrast\n    'filter-bright-contrast-description' | // Change brightness and contrast for the selected layer.\n    'filter-bright-contrast-brightness' | // Brightness\n    'filter-bright-contrast-contrast' | // Contrast\n    'filter-curves-title' | // Curves\n    'filter-curves-description' | // Apply curves on the selected layer.\n    'filter-curves-all' | // All\n    'filter-hue-sat-title' | // Hue / Saturation\n    'filter-hue-sat-description' | // Change hue and saturation for the selected layer.\n    'filter-hue-sat-hue' | // Hue\n    'filter-hue-sat-saturation' | // Saturation\n    'filter-applied' | // applied\n    'filter-tilt-shift-title' | // Tilt Shift\n    'filter-tilt-shift-description' | // Applies tilt shift on the selected layer.\n    'filter-tilt-shift-blur' | // Blur Radius\n    'filter-tilt-shift-gradient' | // Gradient Radius\n    'filter-to-alpha-title' | // To Alpha\n    'filter-to-alpha-description' | // Generates alpha channel for selected layer from:\n    'filter-to-alpha-inverted-lum' | // Inverted Luminance\n    'filter-to-alpha-lum' | // Luminance\n    'filter-to-alpha-replace' | // Replace RGB\n    'filter-triangle-blur-title' | // Triangle Blur\n    'filter-triangle-blur-description' | // Applies triangle blur on the selected layer.\n    'filter-unsharp-mask-title' | // Unsharp Mask\n    'filter-unsharp-mask-description' | // Sharpens the selected layer by scaling pixels away from the average of their neighbors.\n    'filter-unsharp-mask-strength' | // Strength\n    'filter-grid' | // Grid\n    'filter-grid-description' | // Draws grid on selected layer.\n    'filter-noise' | // Noise\n    'filter-noise-description' | // Adds noise to selected layer.\n    'filter-noise-scale' | // Scale\n    'filter-noise-alpha' | // Alpha\n    'filter-pattern' | // Pattern\n    'filter-pattern-description' | // Generates pattern on selected layer. Drag the preview for further controls.\n    'filter-distort' | // Distort\n    'filter-distort-description' | // Distorts the selected layer.\n    'filter-distort-phase' | // Phase\n    'filter-distort-stepsize' | // Step Size\n    'filter-distort-sync-xy' | // Sync XY\n    'filter-vanish-point' | // Vanish Point\n    'filter-vanish-point-title' | // Vanishing Point\n    'filter-vanish-point-description' | // Adds vanishing point to selected layer. Drag preview to move.\n    'filter-vanish-point-lines' | // Lines\n    'import-opening' | // Opening file...\n    'import-title' | // Import Image\n    'import-too-large' | // Image too large, will be downscaled.\n    'import-btn-as-layer' | // As Layer\n    'import-btn-as-image' | // As Image\n    'import-as-layer-title' | // Import Image as New Layer\n    'import-as-layer-description' | // Adjust the position of the imported image.\n    'import-as-layer-limit-reached' | // Layer limit reached. Image will be placed on existing layer.\n    'import-as-layer-fit' | // Fit\n    'import-flatten' | // Flatten image\n    'import-unsupported-file' | // Unsupported file type. See Help for supported types.\n    'import-broken-file' | // Couldn't load image. File might be corrupted.\n    'import-psd-unsupported' | // Unsupported features. PSD had to be flattened.\n    'import-psd-limited-support' | // PSD support is limited. Flattened will more likely look correct.\n    'import-psd-too-large' | // Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\n    'import-psd-size' | // Image size\n    'hand-reset' | // Reset\n    'hand-fit' | // Fit\n    'bucket-tolerance' | // Tolerance\n    'bucket-sample' | // Sample\n    'bucket-sample-title' | // Which layers to sample color from\n    'bucket-sample-all' | // All\n    'bucket-sample-active' | // Active\n    'bucket-sample-above' | // Above\n    'bucket-grow' | // Grow\n    'bucket-grow-title' | // Grow filled area (in pixels)\n    'bucket-contiguous' | // Contiguous\n    'bucket-contiguous-title' | // Only fill connected areas\n    'gradient-linear' | // Linear\n    'gradient-linear-mirror' | // Linear-Mirror\n    'gradient-radial' | // Radial\n    'shape-stroke' | // Stroke\n    'shape-fill' | // Fill\n    'shape-rect' | // Rectangle\n    'shape-ellipse' | // Ellipse\n    'shape-line' | // Line\n    'shape-line-width' | // Line Width\n    'shape-outwards' | // Outwards\n    'shape-fixed' | // Fixed 1:1\n    'text-instruction' | // Click canvas to place text\n    'text-title' | // Add Text\n    'text-text' | // Text\n    'text-font' | // Font\n    'text-placeholder' | // Your text\n    'text-color' | // Color\n    'text-size' | // Size\n    'text-line-height' | // Line Height\n    'text-letter-spacing' | // Letter Spacing\n    'text-left' | // Left\n    'text-center' | // Center\n    'text-right' | // Right\n    'text-italic' | // Italic\n    'text-bold' | // Bold\n    'save-reminder-title' | // Unsaved Work\n    'save-reminder-text' | // Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\n    'save-reminder-save-psd' | // Save As PSD\n    'save-reminder-psd-layers' | // PSD will remember all layers.\n    'backup-drawing' | // You can backup your drawing.\n    'submit' | // Submit\n    'submit-title' | // Submit Drawing\n    'submit-prompt' | // Submit drawing?\n    'submit-submitting' | // Submitting\n    'embed-init-loading' | // Loading app\n    'embed-init-waiting' | // Waiting for image\n    'unsaved' | // Unsaved\n    'help' | // Help\n    'tab-settings' | // Settings\n    'settings-language' | // Language\n    'settings-language-reload' | // Will update after reloading.\n    'settings-theme' | // Theme\n    'settings-save-reminder-label' | // Save Reminder\n    'settings-save-reminder-disabled' | // disabled\n    'settings-save-reminder-confirm-title' | // Turn off Save Reminder?\n    'settings-save-reminder-confirm-a' | // There is no autosave and browser tabs don't last forever. If you don't periodically save you will likely lose work.\n    'settings-save-reminder-confirm-b' | // Disable at your own risk?\n    'settings-save-reminder-confirm-disable' | // Disable\n    'theme-dark' | // Dark\n    'theme-light' | // Light\n    'terms-of-service' | // Terms of Service\n    'licenses' | // Licenses\n    'source-code' | // Source Code\n    'auto' | // auto\n    'zoom-in' | // Zoom In\n    'zoom-out' | // Zoom Out\n    'radius' | // Radius\n    'constrain-proportions' | // Constrain Proportions\n    'width' | // Width\n    'height' | // Height\n    'opacity' | // Opacity\n    'red' | // Red\n    'green' | // Green\n    'blue' | // Blue\n    'eraser' | // Eraser\n    'center' | // Center\n    'layers' | // Layers\n    'background' | // Background\n    'scaling-algorithm' | // Scaling Algorithm\n    'algorithm-smooth' | // Smooth\n    'algorithm-pixelated' | // Pixelated\n    'preview' | // Preview\n    'angle-snap' | // Snap\n    'angle-snap-title' | // 45 Angle Snapping\n    'lock-alpha' | // Lock Alpha\n    'lock-alpha-title' | // Locks layer's alpha channel\n    'reverse' | // Reverse\n    'compare-before' | // Before\n    'compare-after' | // After\n    'loading' | // Loading\n    'more' | // More\n    'x-minutes'; // {x}min\n","{\"switch-ui-left-right\":\"Switch left/right UI\",\"toggle-show-tools\":\"Show/Hide Tools\",\"scroll\":\"Scroll\",\"donate\":\"Donate\",\"home\":\"Home\",\"modal-new-tab\":\"Open in new tab\",\"tab-edit\":\"Edit\",\"tab-file\":\"File\",\"tool-brush\":\"Brush\",\"tool-paint-bucket\":\"Paint Bucket\",\"tool-gradient\":\"Gradient\",\"tool-shape\":\"Shape\",\"tool-text\":\"Text\",\"tool-hand\":\"Hand Tool\",\"tool-zoom\":\"Zoom\",\"undo\":\"Undo\",\"redo\":\"Redo\",\"brush-pen\":\"Pen\",\"brush-blend\":\"Blend\",\"brush-sketchy\":\"Sketchy\",\"brush-pixel\":\"Pixel\",\"brush-chemy\":\"Chemy\",\"brush-smudge\":\"Smudge\",\"brush-size\":\"Size\",\"brush-blending\":\"Blending\",\"brush-toggle-pressure\":\"Toggle Pressure Sensitivity\",\"brush-pen-circle\":\"Circle\",\"brush-pen-chalk\":\"Chalk\",\"brush-pen-calligraphy\":\"Calligraphy\",\"brush-pen-square\":\"Square\",\"brush-sketchy-scale\":\"Scale\",\"brush-pixel-dither\":\"Dither\",\"brush-chemy-fill\":\"Fill\",\"brush-chemy-stroke\":\"Stroke\",\"brush-chemy-mirror-x\":\"Horizontal Symmetry\",\"brush-chemy-mirror-y\":\"Vertical Symmetry\",\"brush-chemy-gradient\":\"Gradient\",\"brush-eraser-transparent-bg\":\"Transparent Background\",\"stabilizer\":\"Stabilizer\",\"stabilizer-title\":\"Stroke Stabilizer\",\"eyedropper\":\"Eyedropper\",\"secondary-color\":\"Secondary Color\",\"manual-color-input\":\"Manual Color Input\",\"mci-hex\":\"Hex\",\"mci-copy\":\"Copy\",\"modal-ok\":\"Ok\",\"modal-cancel\":\"Cancel\",\"modal-close\":\"Close\",\"layers-active-layer\":\"Active Layer\",\"layers-layer\":\"Layer\",\"layers-copy\":\"copy\",\"layers-blending\":\"Blending\",\"layers-new\":\"New Layer\",\"layers-remove\":\"Remove Layer\",\"layers-duplicate\":\"Duplicate Layer\",\"layers-merge\":\"Merge with layer below\",\"layers-merge-all\":\"Merge all\",\"layers-rename\":\"Rename\",\"layers-active-layer-visible\":\"Active layer is visible\",\"layers-active-layer-hidden\":\"Active layer is hidden\",\"layers-visibility-toggle\":\"Layer Visibility\",\"layers-blend-normal\":\"normal\",\"layers-blend-darken\":\"darken\",\"layers-blend-multiply\":\"multiply\",\"layers-blend-color-burn\":\"color burn\",\"layers-blend-lighten\":\"lighten\",\"layers-blend-screen\":\"screen\",\"layers-blend-color-dodge\":\"color dodge\",\"layers-blend-overlay\":\"overlay\",\"layers-blend-soft-light\":\"soft light\",\"layers-blend-hard-light\":\"hard light\",\"layers-blend-difference\":\"difference\",\"layers-blend-exclusion\":\"exclusion\",\"layers-blend-hue\":\"hue\",\"layers-blend-saturation\":\"saturation\",\"layers-blend-color\":\"color\",\"layers-blend-luminosity\":\"luminosity\",\"layers-rename-title\":\"Rename Layer\",\"layers-rename-name\":\"Name\",\"layers-rename-clear\":\"Clear Name\",\"layers-rename-sketch\":\"Sketch\",\"layers-rename-colors\":\"Colors\",\"layers-rename-shading\":\"Shading\",\"layers-rename-lines\":\"Lines\",\"layers-rename-effects\":\"Effects\",\"layers-rename-foreground\":\"Foreground\",\"layers-merge-modal-title\":\"Merge/Mix Layers\",\"layers-merge-description\":\"Merges the selected layer with the one underneath. Select the mix mode:\",\"file-no-autosave\":\"No autosave, no cloud storage\",\"file-new\":\"New\",\"file-import\":\"Import\",\"file-save\":\"Save\",\"file-format\":\"File Format\",\"file-copy\":\"Copy\",\"file-copy-title\":\"Copy To Clipboard\",\"file-share\":\"Share\",\"file-storage\":\"Browser Storage\",\"file-storage-thumb-title\":\"Restores when reopening page\",\"file-storage-about\":\"About Browser Storage\",\"file-storage-cant-access\":\"Can't access\",\"file-storage-empty\":\"Empty\",\"file-storage-store\":\"Store\",\"file-storage-clear\":\"Clear\",\"file-storage-storing\":\"Storing\",\"file-storage-overwrite\":\"Overwrite\",\"file-storage-min-ago\":\"{x}min ago\",\"file-storage-hours-ago\":\"{x}h ago\",\"file-storage-days-ago\":\"{x}d ago\",\"file-storage-month-ago\":\"> 1month ago\",\"file-storage-restored\":\"Restored from Browser Storage\",\"file-storage-stored\":\"Stored to Browser Storage\",\"file-storage-failed\":\"Failed to store to Browser Storage\",\"file-storage-failed-1\":\"Failed to store. Possible causes:\",\"file-storage-failed-2\":\"Out of disk space\",\"file-storage-failed-3\":\"Storage disabled in incognito tab\",\"file-storage-failed-4\":\"Browser doesn't support storage\",\"file-storage-failed-clear\":\"Failed to clear.\",\"file-upload\":\"Upload\",\"cleared-layer\":\"Cleared layer\",\"filled\":\"Filled\",\"new-title\":\"New Image\",\"new-current\":\"Current\",\"new-fit\":\"Fit\",\"new-oversize\":\"Oversize\",\"new-square\":\"Square\",\"new-landscape\":\"Landscape\",\"new-portrait\":\"Portrait\",\"new-screen\":\"Screen\",\"new-video\":\"Video\",\"new-din-paper\":\"DIN Paper\",\"new-px\":\"px\",\"new-ratio\":\"Ratio\",\"upload-title\":\"Upload to Imgur\",\"upload-link-notice\":\"Anyone with the link to your uploaded image will be able to view it.\",\"upload-name\":\"Title\",\"upload-title-untitled\":\"Untitled\",\"upload-caption\":\"Caption\",\"upload-submit\":\"Upload\",\"upload-uploading\":\"Uploading...\",\"upload-success\":\"Upload Successful\",\"upload-failed\":\"Upload failed.\",\"upload-delete\":\"To delete your image from Imgur visit:\",\"cropcopy-title-copy\":\"Copy To Clipboard\",\"cropcopy-title-crop\":\"Crop\",\"cropcopy-click-hold\":\"Right-click or press hold to copy.\",\"cropcopy-btn-copy\":\"To Clipboard\",\"cropcopy-copied\":\"Copied.\",\"cropcopy-btn-crop\":\"Apply Crop\",\"crop-drag-to-crop\":\"Drag to crop\",\"filter-crop-extend\":\"Crop/Extend\",\"filter-flip\":\"Flip\",\"filter-perspective\":\"Perspective\",\"filter-resize\":\"Resize\",\"filter-rotate\":\"Rotate\",\"filter-transform\":\"Transform\",\"filter-bright-contrast\":\"Bright/Contrast\",\"filter-curves\":\"Curves\",\"filter-hue-sat\":\"Hue/Saturation\",\"filter-invert\":\"Invert\",\"filter-tilt-shift\":\"Tilt Shift\",\"filter-to-alpha\":\"To Alpha\",\"filter-triangle-blur\":\"Triangle Blur\",\"filter-unsharp-mask\":\"Unsharp Mask\",\"filter-crop-title\":\"Crop / Extend\",\"filter-crop-description\":\"Crop or extend the image.\",\"filter-crop-left\":\"Left\",\"filter-crop-right\":\"Right\",\"filter-crop-top\":\"Top\",\"filter-crop-bottom\":\"Bottom\",\"filter-crop-rule-thirds\":\"Rule of Thirds\",\"filter-crop-fill\":\"Fill\",\"filter-flip-title\":\"Flip\",\"filter-flip-description\":\"Flips layer or whole image.\",\"filter-flip-horizontal\":\"Horizontal\",\"filter-flip-vertical\":\"Vertical\",\"filter-flip-image\":\"Flip Image\",\"filter-flip-layer\":\"Flip Layer\",\"filter-perspective-title\":\"Perspective\",\"filter-perspective-description\":\"Transforms the selected layer.\",\"filter-resize-title\":\"Resize\",\"filter-resize-description\":\"Resizes the image.\",\"filter-rotate-title\":\"Rotate\",\"filter-rotate-description\":\"Rotates the image.\",\"filter-transform-empty\":\"Layer is empty.\",\"filter-transform-title\":\"Transform\",\"filter-transform-description\":\"Transforms selected layer. Hold Shift for additional behavior.\",\"filter-transform-rotation\":\"Rotation\",\"filter-transform-flip\":\"Flip\",\"filter-transform-center\":\"Center\",\"filter-transform-constrain\":\"Constrain\",\"filter-transform-snap\":\"Snap\",\"filter-transform-snap-title\":\"Snap Rotation And Position\",\"filter-bright-contrast-title\":\"Brightness / Contrast\",\"filter-bright-contrast-description\":\"Change brightness and contrast for the selected layer.\",\"filter-bright-contrast-brightness\":\"Brightness\",\"filter-bright-contrast-contrast\":\"Contrast\",\"filter-curves-title\":\"Curves\",\"filter-curves-description\":\"Apply curves on the selected layer.\",\"filter-curves-all\":\"All\",\"filter-hue-sat-title\":\"Hue / Saturation\",\"filter-hue-sat-description\":\"Change hue and saturation for the selected layer.\",\"filter-hue-sat-hue\":\"Hue\",\"filter-hue-sat-saturation\":\"Saturation\",\"filter-applied\":\"applied\",\"filter-tilt-shift-title\":\"Tilt Shift\",\"filter-tilt-shift-description\":\"Applies tilt shift on the selected layer.\",\"filter-tilt-shift-blur\":\"Blur Radius\",\"filter-tilt-shift-gradient\":\"Gradient Radius\",\"filter-to-alpha-title\":\"To Alpha\",\"filter-to-alpha-description\":\"Generates alpha channel for selected layer from:\",\"filter-to-alpha-inverted-lum\":\"Inverted Luminance\",\"filter-to-alpha-lum\":\"Luminance\",\"filter-to-alpha-replace\":\"Replace RGB\",\"filter-triangle-blur-title\":\"Triangle Blur\",\"filter-triangle-blur-description\":\"Applies triangle blur on the selected layer.\",\"filter-unsharp-mask-title\":\"Unsharp Mask\",\"filter-unsharp-mask-description\":\"Sharpens the selected layer by scaling pixels away from the average of their neighbors.\",\"filter-unsharp-mask-strength\":\"Strength\",\"filter-grid\":\"Grid\",\"filter-grid-description\":\"Draws grid on selected layer.\",\"filter-noise\":\"Noise\",\"filter-noise-description\":\"Adds noise to selected layer.\",\"filter-noise-scale\":\"Scale\",\"filter-noise-alpha\":\"Alpha\",\"filter-pattern\":\"Pattern\",\"filter-pattern-description\":\"Generates pattern on selected layer. Drag the preview for further controls.\",\"filter-distort\":\"Distort\",\"filter-distort-description\":\"Distorts the selected layer.\",\"filter-distort-phase\":\"Phase\",\"filter-distort-stepsize\":\"Step Size\",\"filter-distort-sync-xy\":\"Sync XY\",\"filter-vanish-point\":\"Vanish Point\",\"filter-vanish-point-title\":\"Vanishing Point\",\"filter-vanish-point-description\":\"Adds vanishing point to selected layer. Drag preview to move.\",\"filter-vanish-point-lines\":\"Lines\",\"import-opening\":\"Opening file...\",\"import-title\":\"Import Image\",\"import-too-large\":\"Image too large, will be downscaled.\",\"import-btn-as-layer\":\"As Layer\",\"import-btn-as-image\":\"As Image\",\"import-as-layer-title\":\"Import Image as New Layer\",\"import-as-layer-description\":\"Adjust the position of the imported image.\",\"import-as-layer-limit-reached\":\"Layer limit reached. Image will be placed on existing layer.\",\"import-as-layer-fit\":\"Fit\",\"import-flatten\":\"Flatten image\",\"import-unsupported-file\":\"Unsupported file type. See Help for supported types.\",\"import-broken-file\":\"Couldn't load image. File might be corrupted.\",\"import-psd-unsupported\":\"Unsupported features. PSD had to be flattened.\",\"import-psd-limited-support\":\"PSD support is limited. Flattened will more likely look correct.\",\"import-psd-too-large\":\"Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\",\"import-psd-size\":\"Image size\",\"hand-reset\":\"Reset\",\"hand-fit\":\"Fit\",\"bucket-tolerance\":\"Tolerance\",\"bucket-sample\":\"Sample\",\"bucket-sample-title\":\"Which layers to sample color from\",\"bucket-sample-all\":\"All\",\"bucket-sample-active\":\"Active\",\"bucket-sample-above\":\"Above\",\"bucket-grow\":\"Grow\",\"bucket-grow-title\":\"Grow filled area (in pixels)\",\"bucket-contiguous\":\"Contiguous\",\"bucket-contiguous-title\":\"Only fill connected areas\",\"gradient-linear\":\"Linear\",\"gradient-linear-mirror\":\"Linear-Mirror\",\"gradient-radial\":\"Radial\",\"shape-stroke\":\"Stroke\",\"shape-fill\":\"Fill\",\"shape-rect\":\"Rectangle\",\"shape-ellipse\":\"Ellipse\",\"shape-line\":\"Line\",\"shape-line-width\":\"Line Width\",\"shape-outwards\":\"Outwards\",\"shape-fixed\":\"Fixed 1:1\",\"text-instruction\":\"Click canvas to place text\",\"text-title\":\"Add Text\",\"text-text\":\"Text\",\"text-font\":\"Font\",\"text-placeholder\":\"Your text\",\"text-color\":\"Color\",\"text-size\":\"Size\",\"text-line-height\":\"Line Height\",\"text-letter-spacing\":\"Letter Spacing\",\"text-left\":\"Left\",\"text-center\":\"Center\",\"text-right\":\"Right\",\"text-italic\":\"Italic\",\"text-bold\":\"Bold\",\"save-reminder-title\":\"Unsaved Work\",\"save-reminder-text\":\"Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\",\"save-reminder-save-psd\":\"Save As PSD\",\"save-reminder-psd-layers\":\"PSD will remember all layers.\",\"backup-drawing\":\"You can backup your drawing.\",\"submit\":\"Submit\",\"submit-title\":\"Submit Drawing\",\"submit-prompt\":\"Submit drawing?\",\"submit-submitting\":\"Submitting\",\"embed-init-loading\":\"Loading app\",\"embed-init-waiting\":\"Waiting for image\",\"unsaved\":\"Unsaved\",\"help\":\"Help\",\"tab-settings\":\"Settings\",\"settings-language\":\"Language\",\"settings-language-reload\":\"Will update after reloading.\",\"settings-theme\":\"Theme\",\"settings-save-reminder-label\":\"Save Reminder\",\"settings-save-reminder-disabled\":\"disabled\",\"settings-save-reminder-confirm-title\":\"Turn off Save Reminder?\",\"settings-save-reminder-confirm-a\":\"There is no autosave and browser tabs don't last forever. If you don't periodically save you will likely lose work.\",\"settings-save-reminder-confirm-b\":\"Disable at your own risk?\",\"settings-save-reminder-confirm-disable\":\"Disable\",\"theme-dark\":\"Dark\",\"theme-light\":\"Light\",\"terms-of-service\":\"Terms of Service\",\"licenses\":\"Licenses\",\"source-code\":\"Source Code\",\"auto\":\"auto\",\"zoom-in\":\"Zoom In\",\"zoom-out\":\"Zoom Out\",\"radius\":\"Radius\",\"constrain-proportions\":\"Constrain Proportions\",\"width\":\"Width\",\"height\":\"Height\",\"opacity\":\"Opacity\",\"red\":\"Red\",\"green\":\"Green\",\"blue\":\"Blue\",\"eraser\":\"Eraser\",\"center\":\"Center\",\"layers\":\"Layers\",\"background\":\"Background\",\"scaling-algorithm\":\"Scaling Algorithm\",\"algorithm-smooth\":\"Smooth\",\"algorithm-pixelated\":\"Pixelated\",\"preview\":\"Preview\",\"angle-snap\":\"Snap\",\"angle-snap-title\":\"45 Angle Snapping\",\"lock-alpha\":\"Lock Alpha\",\"lock-alpha-title\":\"Locks layer's alpha channel\",\"reverse\":\"Reverse\",\"compare-before\":\"Before\",\"compare-after\":\"After\",\"loading\":\"Loading\",\"more\":\"More\",\"x-minutes\":\"{x}min\"}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"de.bc2c59f6.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('gPCVN'));","\"use strict\";\n\nvar cacheLoader = require('../cacheLoader');\nmodule.exports = cacheLoader(function (bundle) {\n  return new Promise(function (resolve, reject) {\n    // Don't insert the same script twice (e.g. if it was already in the HTML)\n    var existingScripts = document.getElementsByTagName('script');\n    if ([].concat(existingScripts).some(function isCurrentBundle(script) {\n      return script.src === bundle;\n    })) {\n      resolve();\n      return;\n    }\n    var preloadLink = document.createElement('link');\n    preloadLink.href = bundle;\n    preloadLink.rel = 'preload';\n    preloadLink.as = 'script';\n    document.head.appendChild(preloadLink);\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.src = bundle;\n    script.onerror = function (e) {\n      var error = new TypeError(\"Failed to fetch dynamically imported module: \".concat(bundle, \". Error: \").concat(e.message));\n      script.onerror = script.onload = null;\n      script.remove();\n      reject(error);\n    };\n    script.onload = function () {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n});","\"use strict\";\n\nvar cachedBundles = {};\nvar cachedPreloads = {};\nvar cachedPrefetches = {};\nfunction getCache(type) {\n  switch (type) {\n    case 'preload':\n      return cachedPreloads;\n    case 'prefetch':\n      return cachedPrefetches;\n    default:\n      return cachedBundles;\n  }\n}\nmodule.exports = function (loader, type) {\n  return function (bundle) {\n    var cache = getCache(type);\n    if (cache[bundle]) {\n      return cache[bundle];\n    }\n    return cache[bundle] = loader.apply(null, arguments).catch(function (e) {\n      delete cache[bundle];\n      throw e;\n    });\n  };\n};","\"use strict\";\n\nvar bundleURL = {};\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n  return value;\n}\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n  return '/';\n}\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\n// TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^/]+/);\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n  return matches[0];\n}\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"en-GB.85d49c98.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('emVYF'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"en-US.07bd633b.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('jTga9'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"en-ZA.dd3d37bd.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('h3213'));","module.exports = Promise.resolve(module.bundle.root(\"81RpX\"))","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"fr.a0f80bea.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('c23OD'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"ja.e641fff7.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('hU4y7'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"ko.f5088a9d.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('6hVnH'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"ru.8c8bd043.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('itgWX'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"zh-CN.21b77a10.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('iRXNP'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"zh-TW.dfa4013e.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('1YTLX'));","window.onscroll = (e) => {\n    e.preventDefault();\n};","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"cancel.db668be7.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"check.f11a324e.svg\" + \"?\" + Date.now();","import {KeyListener} from '../../../../bb/input/key-listener';\nimport {dialogCounter} from '../modal-count';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport './scroll-fix';\nimport cancelImg from '/src/app/img/ui/cancel.svg';\n\n/**\n * popup that fill whole height, with some padding.\n * currently only used for iframe popups.\n */\nexport class DynamicModal {\n\n    private readonly parent: HTMLElement;\n    private readonly rootEl: HTMLElement;\n    private readonly updatePos: () => void;\n    private readonly keyListener: KeyListener;\n    private readonly xButton: HTMLElement;\n    private readonly bgEl: HTMLElement;\n    private readonly onClose: ((result?: string) => void) | undefined;\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            title?: HTMLElement;\n            content?: HTMLElement;\n            buttonArr?: string[];\n            autoFocus?: string | false; // todo - not implemented\n            clickOnEnter?: string; // button name - todo not implemented\n            onClose?: (result?: string) => void;\n\n            //size and position\n            width: number;\n            isMaxHeight: boolean; // todo - not implemented\n        }\n    ) {\n        dialogCounter.increase();\n        this.onClose = p.onClose;\n        this.parent = document.body;\n        this.rootEl = BB.el({\n            parent: this.parent,\n            className: 'g-root kl-d-modal-root',\n            css: {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n                overflow: 'auto',\n                animationName: 'consoleIn',\n                animationDuration: '0.3s',\n                animationTimingFunction: 'ease-out',\n            },\n            onClick: BB.handleClick,\n        });\n\n        //background element registering clicks\n        this.bgEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n            },\n            onClick: () => this.close(),\n        });\n\n        //the actual popup box\n        const popupEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-d-modal',\n            css: {\n                position: 'absolute',\n                width: (BB.isCssMinMaxSupported() ?\n                    'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\n                    (p.width ? p.width : 400) + 'px'),\n                height: 'calc(100% - 40px)',\n                borderRadius: '10px',\n                overflow: 'hidden',\n            },\n        });\n\n        //x and y position via script. flex not powerful enough imo\n        this.updatePos = () => {\n            const elW = popupEl.offsetWidth;\n            const elH = popupEl.offsetHeight;\n\n            BB.css(popupEl, {\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\n                top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px',\n            });\n        };\n\n        this.updatePos();\n        window.addEventListener('resize', this.updatePos);\n\n        //title row in popup\n        const titleHeight = 40;\n        const titleEl = BB.el({\n            parent: popupEl,\n            css: {\n                height: titleHeight + 'px',\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                paddingLeft: (titleHeight / 2) + 'px',\n            },\n        });\n        if (p.title) {\n            titleEl.append(p.title);\n        }\n        this.xButton = BB.el({\n            parent: titleEl,\n            tagName: 'button',\n            className: 'popup-x',\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n            title: LANG('modal-close'),\n            onClick: () => this.close(),\n            css: {\n                width: titleHeight + 'px',\n                height: titleHeight + 'px',\n                lineHeight: titleHeight + 'px',\n                background: 'none',\n                boxShadow: 'none',\n            },\n            custom: {\n                tabindex: '0',\n            },\n        });\n\n        const contentEl = BB.el({\n            parent: popupEl,\n            css: {\n                height: 'calc(100% - ' + titleHeight + 'px)',\n            },\n        });\n        if (p.content) {\n            contentEl.append(p.content);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, e) => {\n                if (keyStr === 'esc') {\n                    e.stopPropagation();\n                    this.close();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n    close (): void {\n        dialogCounter.decrease();\n        BB.destroyEl(this.rootEl);\n        this.rootEl.remove();\n        window.removeEventListener('resize', this.updatePos);\n        this.keyListener.destroy();\n        BB.destroyEl(this.xButton);\n        BB.destroyEl(this.bgEl);\n        this.onClose && this.onClose();\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyStringOptional} from '../../../bb/bb-types';\n\n/**\n * Checkbox - with label\n */\nexport class Checkbox {\n\n    private readonly element: HTMLElement;\n    private check: HTMLInputElement;\n    private readonly doHighlight: boolean;\n\n    // --- public ---\n\n    constructor (params: {\n        init?: boolean; // default false\n        label: string;\n        callback?: (b: boolean) => void;\n        allowTab?: boolean; // default false\n        title?: string;\n        doHighlight?: boolean; // default false\n        css?: IKeyStringOptional;\n    }) {\n        this.doHighlight = !!params.doHighlight;\n\n        this.element = BB.el({\n            className: 'kl-checkbox',\n        });\n\n        const innerEl = BB.el({\n            parent: this.element,\n            tagName: 'label',\n            className: 'kl-checkbox__inner',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        this.check = BB.el({\n            parent: innerEl,\n            tagName: 'input',\n            css: {\n                margin: '0 5px 0 0',\n            },\n            custom: {\n                type: 'checkbox',\n            },\n        });\n\n        this.check.checked = !!params.init;\n        if (this.doHighlight && this.check.checked) {\n            this.element.classList.add('kl-checkbox--highlight');\n        }\n        if (!params.allowTab) {\n            this.check.tabIndex = -1;\n        }\n\n        if (params.title) {\n            innerEl.title = params.title;\n        }\n\n        const label = BB.el({\n            parent: innerEl,\n            content: params.label,\n            css: {},\n        });\n        (label as any).allowClick = true;\n\n        this.check.onchange = () => {\n            if (this.doHighlight) {\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\n            }\n            params.callback && params.callback(this.check.checked);\n            setTimeout(() => {\n                this.check.blur();\n            }, 0);\n        };\n        if (params.css) {\n            BB.css(this.element, params.css);\n        }\n    }\n\n    getValue (): boolean {\n        return this.check.checked;\n    }\n\n    setValue (b: boolean): void {\n        this.check.checked = !!b;\n        if (this.doHighlight) {\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.element;\n    }\n\n    destroy (): void {\n        this.check.onchange = null;\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb-types';\nimport {KeyListener} from '../../../bb/input/key-listener';\n\ntype TInputType = 'button' | 'checkbox' | 'number' | 'text' | 'color';\n\nexport type TInputParams = {\n    type?: TInputType; // default: text\n    init: string | number;\n    title?: string;\n    label?: string | HTMLElement;\n\n    // for type: number\n    min?: number;\n    max?: number;\n    step?: number;\n\n    onChange?: (v: string) => void;\n\n    doScrollWithoutFocus?: boolean; // default: false\n    doResetIfInvalid?: boolean; // default: false\n\n    css?: IKeyString;\n};\n\nexport class Input {\n    private readonly rootEl: HTMLLabelElement;\n    private readonly input: HTMLInputElement;\n    private readonly type: TInputType;\n    private readonly pointerListener;\n    private readonly keyListener: KeyListener = {destroy: () => {}} as KeyListener;\n\n    // ---- public ----\n    constructor (p: TInputParams) {\n        this.rootEl = BB.el({\n            tagName: 'label',\n            content: p.label,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: '5px',\n            },\n        });\n\n\n        this.input = BB.el({\n            tagName: 'input',\n            parent: this.rootEl,\n            title: p.title,\n        });\n\n        this.input.type;\n\n        this.type = p.type ?? 'text';\n        try {\n            this.input.type = this.type;\n        } catch(e) {\n            // ie can't deal with number\n        }\n\n        const stepSize = p.step ?? 1;\n\n        if (this.type === 'number') {\n            if (p.min !== undefined) {\n                this.input.min = '' + p.min;\n            }\n            if (p.max !== undefined) {\n                this.input.max = '' + p.max;\n            }\n            if (p.step !== undefined) {\n                this.input.step = '' + stepSize;\n            }\n        }\n\n        this.input.value = '' + p.init;\n\n        let lastValidValue = this.input.value;\n\n        /**\n         * return true if not changed\n         */\n        const handleChange = (): boolean => {\n            const oldVal = lastValidValue;\n            let newValue = this.input.value;\n            if (p.doResetIfInvalid) {\n                let didChange = false;\n                if (newValue === '') {\n                    newValue = lastValidValue;\n                    didChange = true;\n                }\n                if (p.min !== undefined && parseFloat(newValue) < p.min) {\n                    newValue = '' + p.min;\n                    didChange = true;\n                }\n                if (p.max !== undefined && parseFloat(newValue) > p.max) {\n                    newValue = '' + p.max;\n                    didChange = true;\n                }\n                if (didChange) {\n                    this.input.value = '' + newValue;\n                }\n            }\n\n            lastValidValue = newValue;\n\n            return oldVal !== newValue;\n        };\n\n        if (p.onChange) {\n            const onChange = p.onChange;\n            this.input.onchange = () => {\n                handleChange() && onChange(this.input.value);\n            };\n        }\n        if (p.css) {\n            BB.css(this.input, p.css);\n        }\n\n        if (p.doScrollWithoutFocus && p.type === 'number' && p.onChange) {\n            const onChange = p.onChange;\n            this.keyListener = new BB.KeyListener({});\n            this.pointerListener = new BB.PointerListener({\n                target: this.input,\n                onWheel: (e) => {\n                    /*if (document.hasFocus()) { // what was the point of this?\n                        return;\n                    }*/\n                    const fac = this.keyListener.isPressed('shift') ? 4 : 1;\n                    this.input.value = '' + (parseFloat(this.input.value) - e.deltaY * stepSize * fac);\n                    handleChange() && onChange(this.input.value);\n                },\n            });\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): string {\n        return this.input.value;\n    }\n\n    setValue (v: string | number): void {\n        this.input.value = '' + v;\n    }\n\n    destroy (): void {\n        this.pointerListener && this.pointerListener.destroy();\n        this.keyListener.destroy();\n    }\n}\n\n// todo replace instances with class\nexport const input = function (params: {\n    type?: TInputType; // default text\n    min?: number;\n    max?: number;\n    callback: (val: string) => void;\n    init: string | number;\n    css?: IKeyString;\n}) {\n    const result = document.createElement('input');\n    if (params.type) {\n        try {\n            result.type = params.type;\n        } catch(e) {\n            /* empty */\n            // ie can't deal with number\n        }\n    } else {\n        result.type = 'text';\n    }\n    if (params.min !== undefined) {\n        result.min = '' + params.min;\n    }\n    if (params.max !== undefined) {\n        result.max = '' + params.max;\n    }\n    result.value = '' + params.init;\n    if (params.callback) {\n        result.onchange = function () {\n            params.callback(result.value);\n        };\n    }\n    if (params.css) {\n        BB.css(result, params.css);\n    }\n\n    return result;\n};","import {BB} from '../../../bb/bb';\nimport {IKeyString, IKeyStringOptional} from '../../../bb/bb-types';\n\n\ntype TSelectItem<ValueType> = [ValueType, string] | [ValueType, string, { css: IKeyStringOptional }]; // [value, label, properties]\n\n/**\n * A select dropdown\n */\nexport class Select<ValueType extends string> {\n\n    private readonly selectEl: HTMLSelectElement;\n    private optionArr: {\n        item: (TSelectItem<ValueType> | undefined);\n        el?: HTMLOptionElement;\n    }[] = [];\n    private readonly changeListener: () => void;\n    private readonly onChange: ((val: ValueType) => void) | undefined;\n\n    \n    // --- public ---\n    constructor (p: {\n        isFocusable?: boolean; // default false\n        optionArr: (TSelectItem<ValueType> | undefined)[];\n        initValue?: ValueType; // default ''\n        onChange?: (val: ValueType) => void;\n        css?: IKeyString;\n        title?: string;\n    }) {\n        this.selectEl = BB.el({\n            tagName: 'select',\n            title: p.title,\n            className: 'kl-select',\n            css: {\n                cursor: 'pointer',\n                fontSize: '15px',\n                padding: '3px',\n            },\n        });\n        if (p.css) {\n            BB.css(this.selectEl, p.css);\n        }\n\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) {\n            this.selectEl.tabIndex = -1;\n        }\n        this.setOptionArr(p.optionArr);\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.changeListener = () => {\n            if (!isFocusable) {\n                this.selectEl.blur();\n            }\n            this.onChange && this.onChange(this.getValue());\n        };\n        this.selectEl.addEventListener('change', this.changeListener);\n        this.selectEl.value = p.initValue !== undefined ? p.initValue : '';\n    }\n\n    setValue (val: ValueType | undefined): void {\n        this.selectEl.value = val === undefined ? '' : val;\n    }\n\n    getValue (): ValueType {\n        return this.selectEl.value as ValueType;\n    }\n\n    setDeltaValue (delta: number): void {\n        let index = 0;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            const option = this.optionArr[i];\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\n        const option = this.optionArr[index];\n        this.selectEl.value = option.item ? option.item[0] : '';\n        this.onChange && this.onChange(this.getValue());\n    }\n\n    getElement (): HTMLElement {\n        return this.selectEl;\n    }\n\n    updateLabel (id: ValueType, label: string): void {\n        this.optionArr.forEach(option => {\n            if (option.item && option.item[0] === id && option.el) {\n                option.item[1] = label;\n                option.el.textContent = option.item[1];\n            }\n        });\n    }\n\n    setOptionArr (optionArr: (TSelectItem<ValueType> | undefined)[]): void {\n        this.optionArr = [];\n        this.selectEl.innerHTML = '';\n        for (let i = 0; i < optionArr.length; i++) {\n            const item = optionArr[i];\n            if (!item) {\n                this.optionArr.push({\n                    item,\n                });\n                continue;\n            }\n            const el = document.createElement('option');\n            el.value = item[0];\n            el.textContent = item[1];\n            if (item[2]) {\n                BB.css(el, item[2].css);\n            }\n            this.optionArr.push({\n                item,\n                el,\n            });\n            this.selectEl.append(el);\n        }\n    }\n\n    destroy (): void {\n        this.selectEl.removeEventListener('change', this.changeListener);\n    }\n    \n}\n","import {BB} from '../../../bb/bb';\n\n/**\n * Toggle button with an image\n */\nexport class ImageToggle {\n\n    private readonly rootEl: HTMLElement;\n    private isActive: boolean;\n\n    private update (): void {\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            initValue: boolean;\n            title: string;\n            isRadio?: boolean; // if true, can't click when active\n            onChange: (b: boolean) => void;\n            image: string;\n            darkInvert?: boolean;\n        }\n    ) {\n        this.isActive = !!p.initValue;\n        this.rootEl = BB.el({\n            className: 'image-toggle',\n            title: p.title,\n            content: BB.el({\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                },\n            }),\n            onClick: (e) => {\n                e.preventDefault();\n                if (p.isRadio && this.isActive) {\n                    return;\n                }\n                this.isActive = !this.isActive;\n                this.update();\n                p.onChange(this.isActive);\n            },\n        });\n\n\n        this.update();\n    }\n\n    // --- interface ---\n    setValue (b: boolean): void {\n        this.isActive = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): boolean {\n        return this.isActive;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.rootEl);\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {ImageToggle} from './image-toggle';\n\ntype TOptionItem<IdType> = {\n    id: IdType;\n    title: string;\n    image: string;\n    darkInvert?: boolean;\n};\n\n/**\n * Radio input group. each one has an image\n */\nexport class ImageRadioList<IdType> {\n\n    private readonly rootEl: HTMLElement;\n    private activeIndex: number;\n    private readonly optionArr: {\n        id: IdType;\n        radioEl: ImageToggle;\n    }[];\n\n    // --- public ---\n    constructor (\n        p: {\n            optionArr: TOptionItem<IdType>[];\n            initId: string;\n            onChange: (id: IdType) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'image-radio-wrapper',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        this.optionArr = [];\n\n        const select = (index: number, id: IdType): void => {\n            this.activeIndex = index;\n            for (let i = 0; i < this.optionArr.length; i++) {\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\n            }\n            p.onChange(id);\n        };\n\n        let initialIndex;\n        const createOption = (index: number, o: TOptionItem<IdType>): {\n            id: IdType;\n            radioEl: ImageToggle;\n        } => {\n            if (o.id === p.initId) {\n                initialIndex = index;\n            }\n            const radioEl = new ImageToggle({\n                image: o.image,\n                title: o.title,\n                initValue: o.id === p.initId,\n                isRadio: true,\n                onChange: () => {\n                    select(index, o.id);\n                },\n                darkInvert: o.darkInvert,\n            });\n            this.rootEl.append(radioEl.getElement());\n\n            return {\n                id: o.id,\n                radioEl,\n            };\n        };\n\n        for (let i = 0; i < p.optionArr.length; i++) {\n            this.optionArr.push(createOption(i, p.optionArr[i]));\n        }\n\n        if (initialIndex === undefined) {\n            throw new Error('initId not in optionArr');\n        }\n        this.activeIndex = initialIndex;\n    }\n\n    // --- interface ---\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): IdType {\n        return this.optionArr[this.activeIndex].id;\n    }\n\n    destroy (): void {\n        this.optionArr.forEach(item => {\n            item.radioEl.destroy();\n        });\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\nimport iconImg from '/src/app/img/ui/brush-pressure.svg';\nimport {BoxToggle} from './box-toggle';\n\n/**\n * small toggle button with a pen icon - representing toggling pressure sensitivity\n * @param isChecked initial value\n * @param changeCallback called on change\n */\nexport const createPenPressureToggle = function (\n    isChecked: boolean,\n    changeCallback: (b: boolean) => void,\n): HTMLElement {\n\n    const toggleEl = new BoxToggle({\n        label: BB.el({\n            className: 'dark-invert',\n            css: {\n                width: '17px',\n                height: '17px',\n                backgroundImage: 'url(\"' + iconImg + '\")',\n                backgroundSize: 'contain',\n                backgroundRepeat: 'no-repeat',\n                margin: '1px',\n                borderRadius: '3px',\n            },\n        }),\n        title: LANG('brush-toggle-pressure'),\n        init: isChecked,\n        onChange: (b) => {\n            changeCallback(b);\n        },\n    });\n\n\n    return toggleEl.getElement();\n};","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-pressure.ff13f4ad.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\n\nexport class BoxToggle {\n    el: HTMLElement;\n    value: boolean;\n\n    update (): void {\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n            init?: boolean;\n            onChange: (b: boolean) => void;\n        }\n    ) {\n        this.value = !!p.init;\n        this.el = BB.el({\n            content: p.label,\n            title: p.title,\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\n            onClick: () => {\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: 'pointer',\n            },\n        });\n        if (typeof p.label !== 'string') {\n            BB.css(p.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n        this.update();\n    }\n\n    getValue (): boolean {\n        return this.value;\n    }\n\n    setValue (b: boolean): void {\n        this.value = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.el;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.el);\n    }\n}","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IKlSliderConfig} from '../../kl-types';\nimport {languageStrings} from '../../../language/language';\nimport {KlSliderManualInput} from './kl-slider-manual-input';\nimport {SplineInterpolator} from '../../../bb/math/line';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {IPointerEvent} from '../../../bb/input/event.types';\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\n\n/**\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\n * e.g. used for brush size\n *\n * left mouse button - set absolute value\n * right mouse button - change relative value\n * drag mouse vertically away - precision mode\n * double-click/tap slider - manual input mode\n *\n * Values can be spline interpolated\n * On change callback can be debounced\n *\n */\nexport class KlSlider {\n\n    /*\n    Three types of values\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\n    - displayValue - the number that the user sees on the slider and in the manual input field\n        - might be further formatted with formatFunc\n        - also might be the same as value, if no toDisplayValue function provided\n    - sliderValue - the draggable position of the slider, 0 - 1\n     */\n\n    private value: number;\n\n    private readonly elementWidth: number;\n    private readonly elementHeight: number;\n    private isEnabled: boolean;\n\n    private min: number; // min value\n    private max: number; // max value\n    private useSpline: boolean;\n    private splineInterpolator: undefined | SplineInterpolator;\n    private readonly resolution: number;\n\n    private readonly isChangeOnFinal: boolean;\n    private readonly formatFunc: undefined | ((val: number) => number | string);\n    private readonly unit: string | undefined;\n\n    private readonly onChange: (val: number) => void;\n    private readonly valueToDisplayValue: (value: number) => number;\n    private readonly displayValueToValue: (displayValue: number) => number;\n\n\n    private readonly rootEl: HTMLElement;\n    private readonly sliderWrapperEl: HTMLElement;\n    private readonly textEl: HTMLElement; // displays label, displayValue\n    private readonly label: string;\n    private readonly control: HTMLElement;\n    private manualInput: undefined | KlSliderManualInput;\n    private readonly manualInputRoundDigits: number | undefined;\n\n    private pointerListener: PointerListener | undefined;\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\n\n    private readonly eventResMs: undefined | number;\n    private emitValue: undefined | number; // next value for interval\n    private emitInterval: (ReturnType<typeof setTimeout> | undefined); // interval of eventResMs which calls onChange()\n\n    private valueToSliderValue (value: number): number {\n        if (this.useSpline && this.splineInterpolator) {\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\n        }\n        return (value - this.min) / (this.max - this.min);\n    }\n\n    private sliderValueToValue (sliderValue: number): number {\n        let result = this.min + sliderValue * (this.max - this.min);\n        if (this.useSpline && this.splineInterpolator) {\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\n        }\n        return result;\n    }\n\n    private updateLabel (): void {\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\n        const unit = this.unit !== undefined ? this.unit : '';\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + unit + '</span>';\n\n        const sliderValue = this.valueToSliderValue(this.value);\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\n    }\n\n    private emit (isFinal: boolean): void {\n        if (!isFinal && this.isChangeOnFinal) {\n            return;\n        }\n\n        if (isFinal || !this.eventResMs) {\n            this.onChange(this.value);\n            if (this.emitInterval) {\n                clearInterval(this.emitInterval);\n                this.emitInterval = undefined;\n            }\n            return;\n        }\n\n        if (this.emitInterval) {\n            this.emitValue = this.value;\n\n        } else {\n            this.onChange(this.value);\n\n            this.emitInterval = setInterval(() => {\n                if (this.emitValue === undefined) {\n                    clearInterval(this.emitInterval);\n                    this.emitInterval = undefined;\n                } else {\n                    this.onChange(this.emitValue);\n                    this.emitValue = undefined;\n                }\n            }, this.eventResMs);\n        }\n    }\n\n    private updateEnable (): void {\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\n        BB.css(this.sliderWrapperEl, {\n            opacity: this.isEnabled ? '' : '0.5',\n            pointerEvents: this.isEnabled ? '' : 'none',\n        });\n        if (this.manualInput) {\n            this.manualInput.setIsEnabled(this.isEnabled);\n        }\n    }\n\n    private showManualInput (): void {\n\n        this.manualInput = new KlSliderManualInput(\n            this.valueToDisplayValue(this.value),\n            this.valueToDisplayValue(this.min),\n            this.valueToDisplayValue(this.max),\n            this.sliderWrapperEl.getBoundingClientRect(),\n            (val) => {\n                val = this.displayValueToValue(val);\n                this.setValue(BB.clamp(val, this.min, this.max));\n                this.onChange(this.value);\n            },\n            () => {\n                BB.css(this.sliderWrapperEl, {\n                    display: '',\n                });\n                if (this.manualInput) {\n                    this.manualInput.getElement().remove();\n                    this.manualInput.destroy();\n                }\n                this.manualInput = undefined;\n            },\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\n        );\n        this.manualInput.setIsEnabled(this.isEnabled);\n        this.rootEl.append(this.manualInput.getElement());\n        setTimeout(() => {\n            this.manualInput && this.manualInput.focus();\n        });\n        BB.css(this.sliderWrapperEl, {\n            display: 'none',\n        });\n    }\n\n\n    // --- public ---\n\n    constructor (\n        p: {\n            label: string;\n            width: number; // px\n            height: number; // px\n            min: number; // min value\n            max: number;\n            value: number;\n            resolution?: number; // int, if you want spline.findX() to use a custom resolution\n            curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\n            formatFunc?: (val: number) => number | string; // function to display a different number than value\n            onChange?: (val: number) => void;\n            isChangeOnFinal?: boolean; // only fire onChange on pointerUp\n            eventResMs?: number; // frequency of change events\n            isEnabled?: boolean; // default = true\n            manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\n            toDisplayValue?: (value: number) => number;\n            toValue?: (displayValue: number) => number;\n            unit?: string; // attached to end of value in output\n        }\n    ) {\n        this.isEnabled = p.isEnabled !== false;\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\n        this.useSpline = !!p.curve;\n\n        if (!p.label) {\n            throw new Error('KlSlider missing params');\n        }\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\n            if (!p.min || !p.max || !p.value) {\n                throw new Error('KlSlider broken params');\n            }\n        }\n        if (p.min >= p.max) {\n            throw new Error('KlSlider broken params');\n        }\n\n        this.min = p.min;\n        this.max = p.max;\n        this.value = BB.clamp(p.value, this.min, this.max);\n        this.elementWidth = p.width;\n        this.elementHeight = p.height;\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\n\n        this.onChange = p.onChange ? p.onChange : () => {};\n        if (!p.toValue !== !p.toDisplayValue) {\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\n        }\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\n        this.formatFunc = p.formatFunc;\n        this.eventResMs = p.eventResMs;\n        this.unit = p.unit;\n\n        if (this.useSpline) {\n            if (!p.curve) {\n                throw new Error('curve needs to be set if useSpline true');\n            }\n            const curveArr: [number, number][] = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        }\n\n        this.rootEl = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n        this.sliderWrapperEl = BB.el({\n            parent: this.rootEl,\n            className: 'slider-wrapper',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.elementWidth + 'px',\n                height: this.elementHeight + 'px',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = function () {\n            return false;\n        };\n        this.label = p.label;\n        const labelFontSize = this.elementHeight - 14;\n        this.textEl = BB.el({\n            content: this.label,\n            css: {\n                position: 'absolute',\n                display: 'flex',\n                alignItems: 'center',\n                marginLeft: '7px',\n                height: '100%',\n                fontSize: labelFontSize + 'px',\n                pointerEvents: 'none',\n            },\n        });\n        this.control = BB.el({\n            className: 'slider-inner',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\n                height: this.elementHeight + 'px',\n            },\n        });\n        const controlInner = document.createElement('div');\n\n        this.sliderWrapperEl.append(this.control, this.textEl);\n        this.control.append(controlInner);\n\n        this.updateEnable();\n\n\n        const doubleTapper = new BB.DoubleTapper({\n            onDoubleTap: () => {\n                this.showManualInput();\n            },\n        });\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\n        const eventChain = new BB.EventChain({\n            chainArr: [\n                doubleTapper as IChainElement,\n            ],\n        });\n\n        let virtualVal: number;\n        const onPointer = (event: IPointerEvent) => {\n            event.eventPreventDefault();\n\n            if (!this.isEnabled) {\n                return;\n            }\n\n            if (event.type === 'pointerdown') {\n\n                // unfocus manual slider input\n                BB.unfocusAnyInput();\n\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\n\n                if (event.button === 'left') {\n                    let sliderValue = event.relX / this.elementWidth;\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.emit(false);\n                }\n                virtualVal = this.valueToSliderValue(this.value);\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n\n                let deltaX = event.dX;\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n                deltaX *= factor;\n                deltaX /= this.elementWidth;\n\n                virtualVal += deltaX;\n\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\n                this.value = this.sliderValueToValue(sliderValue);\n                this.updateLabel();\n                this.emit(false);\n            }\n\n            if (event.type === 'pointerup') {\n                this.sliderWrapperEl.className = 'slider-wrapper';\n                this.emit(true);\n            }\n\n        };\n\n        this.pointerListenerTimeout = setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderWrapperEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    onPointer(e);\n                    eventChain.chainIn(e);\n                },\n                onWheel: (event) => {\n                    let sliderValue = this.valueToSliderValue(this.value);\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.onChange(this.value);\n                },\n            });\n            this.updateLabel();\n        }, 1);\n    }\n\n    changeSliderValue (f: number): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        let sliderValue = this.valueToSliderValue(this.value);\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\n        this.value = this.sliderValueToValue(sliderValue);\n        this.updateLabel();\n        this.onChange(this.value);\n    }\n\n    setValue (v: number): void {\n        this.value = BB.clamp(v, this.min, this.max);\n        this.updateLabel();\n    }\n\n    getValue (): number {\n        return this.value;\n    }\n\n    update (config: IKlSliderConfig): void {\n        this.min = config.min;\n        this.max = config.max;\n        this.useSpline = !!config.curve;\n        if (this.useSpline) {\n            if (!config.curve) {\n                throw new Error('curve needs to be set if useSpline true');\n            }\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        } else {\n            this.splineInterpolator = undefined;\n        }\n        this.setIsEnabled(!config.isDisabled);\n    }\n\n    setIsEnabled (e: boolean): void {\n        this.isEnabled = !!e;\n        this.updateEnable();\n    }\n\n    destroy (): void {\n        clearTimeout(this.pointerListenerTimeout);\n        this.pointerListener && this.pointerListener.destroy();\n        if (this.manualInput) {\n            this.manualInput.destroy();\n        }\n        if (this.emitInterval) {\n            clearInterval(this.emitInterval);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}\n","/**\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\n * Returns the factor [0,1]\n *  0 -> infinite movement required for change of 1\n *  1 -> 1px movement for change of 1\n *\n * @param deltaY vertical distance from pointerdown\n * @param isRightButton\n */\nexport function calcSliderFalloffFactor (deltaY: number, isRightButton: boolean): number {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) {\n        result *= 2;\n    }\n    return 1 / result;\n}\n","import {BB} from '../../../bb/bb';\nimport {input} from './input';\n\n/**\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\n * Input goes away when losing focus, or when pressing Enter/Escape.\n */\nexport class KlSliderManualInput {\n\n    private readonly input: HTMLInputElement;\n    private isEnabled: boolean = true;\n    private scrollBefore: { x: number; y: number } | undefined; // window scroll position on creation\n    private lastValue: number; // last emitted value\n    private isClosed: boolean = false;\n\n    private emit (): void {\n        if (this.lastValue !== Number(this.input.value)) {\n            this.onChange(Number(this.input.value));\n            this.lastValue = Number(this.input.value);\n        }\n    }\n\n    private privateOnClose (): void {\n        if (this.isClosed) {\n            return;\n        }\n        this.isClosed = true;\n\n        this.emit();\n        this.onClose();\n        setTimeout(() => {\n            // because iPad keyboard changes the scroll position\n            this.scrollBefore && window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\n            this.scrollBefore = undefined;\n        });\n    }\n\n    // --- public ---\n\n    constructor (\n        value: number, // initial value (displayValue)\n        min: number,\n        max: number,\n        rect: DOMRect, // size of input field\n        private onChange: (displayValue: number) => void,\n        private onClose: () => void,\n        roundDigits?: number,\n    ) {\n\n        this.input = input({\n            type: 'number',\n            init: value,\n            min,\n            max,\n            callback: (val) => {\n                this.emit();\n            },\n        });\n        if (roundDigits !== 0) {\n            this.input.setAttribute('step', 'any');\n        }\n        this.input.onblur = () => {\n            this.privateOnClose();\n        };\n        this.input.addEventListener('keyup', (e) => {\n            if (['Enter', 'Escape'].includes(e.key)) {\n                this.privateOnClose();\n            } else {\n                this.emit();\n            }\n        });\n        this.input.addEventListener('wheel', () => this.emit());\n\n        this.scrollBefore = {\n            x: window.scrollX,\n            y: window.scrollY,\n        };\n\n        let currentValue;\n        if (roundDigits || roundDigits === 0) {\n            currentValue = BB.round(value, roundDigits);\n        } else {\n            currentValue = value;\n        }\n        this.lastValue = currentValue;\n        this.input.value = '' + currentValue;\n\n        BB.css(this.input, {\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n        });\n    }\n\n    getElement () {\n        return this.input;\n    }\n\n    setIsEnabled (b: boolean): void {\n        this.isEnabled = !!b;\n    }\n\n    focus (): void {\n        this.input.focus();\n        this.input.select();\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.input);\n    }\n}","import {BB} from '../../../bb/bb';\nimport {input} from '../components/input';\nimport {showModal} from './base/showModal';\nimport {LANG} from '../../../language/language';\nimport copyImg from '/src/app/img/ui/copy.svg';\nimport {IRGB} from '../../kl-types';\nimport {RGB} from '../../../bb/color/color';\nimport {c} from '../../../bb/base/c';\nimport {css} from '@emotion/css';\n\n\ntype TInputRow = {\n    update: () => void;\n    destroy: () => void;\n    element: HTMLElement;\n};\n\n/**\n * dialog for manually inputting the color\n */\nexport class HexColorDialog {\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            color: IRGB;\n            onClose: (rgb: IRGB | undefined) => void;\n        }\n    ) {\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\n\n        const previewEl = BB.el({\n            css: {\n                width: '20px',\n                height: '20px',\n                marginBottom: '10px',\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            },\n        });\n\n        // --- Hex ---\n\n        const hexLabel = BB.el({\n            content: LANG('mci-hex'),\n        });\n        const hexInput = input({\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            css: {\n                width: '80px',\n            },\n            callback: function () {\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\n                if (!rgbObj) {\n                    rgbObj = lastValidRgb;\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                } else {\n                    lastValidRgb = rgbObj;\n                }\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\n\n                for (let i = 0; i < rgbArr.length; i++) {\n                    rgbArr[i].update();\n                }\n            },\n        });\n        const copyButton = BB.el({\n            tagName: 'button',\n            content: '<img src=\"' + copyImg + '\" height=\"20\" alt=\"\"/>',\n            title: LANG('mci-copy'),\n            onClick: function () {\n                hexInput.select();\n                navigator.clipboard.writeText(hexInput.value).then().catch();\n            },\n        });\n\n        const hexRowEl = c({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginBottom: '15px',\n                flexWrap: 'wrap',\n                gap: '5px 10px',\n                maxWidth: '250px',\n            },\n        }, [\n            hexLabel,\n            c(',flex,items-center,gap-10', [\n                hexInput,\n                copyButton,\n            ]),\n        ]);\n        setTimeout(function () {\n            hexInput.focus();\n            hexInput.select();\n        }, 0);\n\n\n        // --- R G B ---\n        function createRgbInputRow (labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\n\n            const inputEl = input({\n                init: lastValidRgb[attributeStr],\n                min: 0,\n                max: 255,\n                type: 'number',\n                css: {\n                    width: '80px',\n                },\n                callback: function () {\n                    if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\n                        result.update();\n                        return;\n                    }\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                },\n            });\n\n            const rowEl = c('tr', [\n                c('td,pr-10', labelStr),\n                c('td', [inputEl]),\n            ]);\n\n            const result = {\n                update: (): void => {\n                    inputEl.value = '' + lastValidRgb[attributeStr];\n                },\n                destroy: (): void => {\n                    BB.unsetEventHandler(inputEl, 'onchange');\n                },\n                element: rowEl,\n            };\n            return result;\n        }\n        const rgbArr: TInputRow[] = [\n            createRgbInputRow(LANG('red'), 'r'),\n            createRgbInputRow(LANG('green'), 'g'),\n            createRgbInputRow(LANG('blue'), 'b'),\n        ];\n\n        const tableCss = css({\n            borderCollapse: 'collapse',\n            'td': {\n                paddingBottom: '5px',\n            },\n        });\n        const rootEl = c('', [\n            previewEl,\n            hexRowEl,\n            c('table.' + tableCss, [c('tbody', rgbArr.map(item => item.element))]),\n        ]);\n\n        showModal({\n            target: document.body,\n            message: `<b>${LANG('manual-color-input')}</b>`,\n            div: rootEl,\n            autoFocus: false,\n            clickOnEnter: 'Ok',\n            buttons: ['Ok', 'Cancel'],\n            callback: function (resultStr) {\n                BB.destroyEl(copyButton);\n                rgbArr.forEach(item => item.destroy());\n                rgbArr.splice(0, rgbArr.length);\n\n                p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : undefined);\n            },\n        });\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"copy.afbd5028.svg\" + \"?\" + Date.now();","import {IKeyStringOptional} from '../bb-types';\nimport {BB} from '../bb';\nimport {el} from './ui';\n\nfunction decomposeElString (el: string) {\n    if (el === '') {\n        return {};\n    }\n\n    let split: string[];\n    let tagName: string;\n    const classes: string[] = [];\n\n    split = el.split('.');\n\n    if (split.length === 1) {\n        split = split[0].split(',');\n        tagName = split.shift()!;\n\n    } else {\n        tagName = split.shift()!;\n        split.forEach((item, index) => {\n            const isLast = index === split.length - 1;\n            if (isLast) {\n                split = item.split(',');\n                const last = split.shift();\n                if (last !== undefined) {\n                    classes.push(last);\n                }\n            } else {\n                classes.push(item);\n            }\n        });\n    }\n\n    const result = {} as {\n        tagName?: string;\n        classes?: string[];\n        styles?: string[];\n    };\n    if (tagName !== '') {\n        result.tagName = tagName;\n    }\n    if (classes.length > 0) {\n        result.classes = classes;\n    }\n    if (split.length > 0) {\n        result.styles = split;\n    }\n    return result;\n}\n\nfunction applyStyleNames (el: HTMLElement, styleNames: string[]) {\n    const style: IKeyStringOptional = {};\n\n    const operations: {\n        [key: string]: (params: string[]) => void;\n    } = {\n        c: (params) => {\n            style.color = params[0];\n        },\n        bg: (params) => {\n            style.background = params[0];\n        },\n        p: (params) => {\n            style.padding = params[0] + 'px';\n        },\n        py: (params) => {\n            style.paddingTop = params[0] + 'px';\n            style.paddingBottom = params[0] + 'px';\n        },\n        pt: (params) => {\n            style.paddingTop = params[0] + 'px';\n        },\n        pr: (params) => {\n            style.paddingRight = params[0] + 'px';\n        },\n        pb: (params) => {\n            style.paddingBottom = params[0] + 'px';\n        },\n        pl: (params) => {\n            style.paddingLeft = params[0] + 'px';\n        },\n        mt: (params) => {\n            style.marginTop = params[0] + 'px';\n        },\n        mr: (params) => {\n            style.marginRight = params[0] + 'px';\n        },\n        mb: (params) => {\n            style.marginBottom = params[0] + 'px';\n        },\n        ml: (params) => {\n            style.marginLeft = params[0] + 'px';\n        },\n\n        // flex\n        flex: () => {\n            style.display = 'flex';\n        },\n        'flexCol': () => {\n            style.flexDirection = 'column';\n        },\n        'flexWrap': () => {\n            style.flexWrap = 'wrap';\n        },\n        gap: (params) => {\n            style.gap = params.map(item => item + 'px').join(' ');\n        },\n        grow: () => {\n            style.flexGrow = '1';\n        },\n        justify: (params) => {\n            style.justifyContent = params[0];\n        },\n        items: (params) => {\n            style.alignItems = params[0];\n        },\n\n        hidden: () => {\n            style.display = 'none';\n        },\n        nowrap: () => {\n            style.whiteSpace = 'nowrap';\n        },\n        abs: (params) => {\n            style.position = 'absolute';\n            style.left = params[0] + 'px';\n            style.top = params[1] + 'px';\n        },\n        w: (params) => {\n            style.width = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        h: (params) => {\n            style.height = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        minh: (params) => {\n            style.minHeight = params[0] + 'px';\n        },\n        z: (params) => {\n            style.zIndex = params[0];\n        },\n        overflow: (params) => {\n            style.overflow = params[0];\n        },\n        pos: (params) => {\n            style.position = params[0];\n        },\n        left: (params) => {\n            style.left = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        top: (params) => {\n            style.top = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        right: (params) => {\n            style.right = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        bottom: (params) => {\n            style.bottom = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        size: (params) => {\n            style.fontSize = params[0] + 'px';\n        },\n        pointer: (params) => {\n            style.pointerEvents = params[0];\n        },\n    };\n\n    styleNames.forEach(item => {\n        const params = item.split('-');\n        const operation = params.shift()!;\n        operations[operation](params);\n    });\n    BB.css(el, style);\n}\n\n/**\n * composes HTML\n */\nexport function c (\n    element?: HTMLElement | string | Parameters<typeof el>[0],\n    inner?: string | (SVGElement | HTMLElement | string)[]\n): HTMLElement {\n    if (element === undefined) {\n        return document.createElement('div');\n    }\n    if (typeof element !== 'string') {\n        if (!(element instanceof HTMLElement)) {\n            element = el(element);\n        }\n        if (inner) {\n            if (typeof inner === 'string') {\n                element.innerHTML = inner;\n            } else {\n                element.append(...inner);\n            }\n        }\n\n        return element;\n    }\n\n    const decomp = decomposeElString(element);\n    const result = document.createElement(decomp.tagName ?? 'div');\n    decomp.classes && result.classList.add(...decomp.classes);\n    decomp.styles && applyStyleNames(result, decomp.styles);\n\n    if (inner) {\n        if (typeof inner === 'string') {\n            result.innerHTML = inner;\n        } else {\n            result.append(...inner);\n        }\n    }\n    return result;\n}\n","import createEmotion from '../create-instance/dist/emotion-css-create-instance.esm.js';\nimport '@emotion/cache';\nimport '@emotion/serialize';\nimport '@emotion/utils';\n\nvar _createEmotion = createEmotion({\n  key: 'css'\n}),\n    flush = _createEmotion.flush,\n    hydrate = _createEmotion.hydrate,\n    cx = _createEmotion.cx,\n    merge = _createEmotion.merge,\n    getRegisteredStyles = _createEmotion.getRegisteredStyles,\n    injectGlobal = _createEmotion.injectGlobal,\n    keyframes = _createEmotion.keyframes,\n    css = _createEmotion.css,\n    sheet = _createEmotion.sheet,\n    cache = _createEmotion.cache;\n\nexport { cache, css, cx, flush, getRegisteredStyles, hydrate, injectGlobal, keyframes, merge, sheet };\n","import createCache from '@emotion/cache';\nimport { serializeStyles } from '@emotion/serialize';\nimport { getRegisteredStyles, insertStyles } from '@emotion/utils';\n\nfunction insertWithoutScoping(cache, serialized) {\n  if (cache.inserted[serialized.name] === undefined) {\n    return cache.insert('', serialized, cache.sheet, true);\n  }\n}\n\nfunction merge(registered, css, className) {\n  var registeredStyles = [];\n  var rawClassName = getRegisteredStyles(registered, registeredStyles, className);\n\n  if (registeredStyles.length < 2) {\n    return className;\n  }\n\n  return rawClassName + css(registeredStyles);\n}\n\nvar createEmotion = function createEmotion(options) {\n  var cache = createCache(options); // $FlowFixMe\n\n  cache.sheet.speedy = function (value) {\n    if (process.env.NODE_ENV !== 'production' && this.ctr !== 0) {\n      throw new Error('speedy must be changed before any rules are inserted');\n    }\n\n    this.isSpeedy = value;\n  };\n\n  cache.compat = true;\n\n  var css = function css() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var serialized = serializeStyles(args, cache.registered, undefined);\n    insertStyles(cache, serialized, false);\n    return cache.key + \"-\" + serialized.name;\n  };\n\n  var keyframes = function keyframes() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    var serialized = serializeStyles(args, cache.registered);\n    var animation = \"animation-\" + serialized.name;\n    insertWithoutScoping(cache, {\n      name: serialized.name,\n      styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n    });\n    return animation;\n  };\n\n  var injectGlobal = function injectGlobal() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    var serialized = serializeStyles(args, cache.registered);\n    insertWithoutScoping(cache, serialized);\n  };\n\n  var cx = function cx() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    return merge(cache.registered, css, classnames(args));\n  };\n\n  return {\n    css: css,\n    cx: cx,\n    injectGlobal: injectGlobal,\n    keyframes: keyframes,\n    hydrate: function hydrate(ids) {\n      ids.forEach(function (key) {\n        cache.inserted[key] = true;\n      });\n    },\n    flush: function flush() {\n      cache.registered = {};\n      cache.inserted = {};\n      cache.sheet.flush();\n    },\n    // $FlowFixMe\n    sheet: cache.sheet,\n    cache: cache,\n    getRegisteredStyles: getRegisteredStyles.bind(null, cache.registered),\n    merge: merge.bind(null, cache.registered, css)\n  };\n};\n\nvar classnames = function classnames(args) {\n  var cls = '';\n\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n    if (arg == null) continue;\n    var toAdd = void 0;\n\n    switch (typeof arg) {\n      case 'boolean':\n        break;\n\n      case 'object':\n        {\n          if (Array.isArray(arg)) {\n            toAdd = classnames(arg);\n          } else {\n            toAdd = '';\n\n            for (var k in arg) {\n              if (arg[k] && k) {\n                toAdd && (toAdd += ' ');\n                toAdd += k;\n              }\n            }\n          }\n\n          break;\n        }\n\n      default:\n        {\n          toAdd = arg;\n        }\n    }\n\n    if (toAdd) {\n      cls && (cls += ' ');\n      cls += toAdd;\n    }\n  }\n\n  return cls;\n};\n\nexport { createEmotion as default };\n","import { StyleSheet } from '@emotion/sheet';\nimport { dealloc, alloc, next, token, from, peek, delimit, slice, position, RULESET, combine, match, serialize, copy, replace, WEBKIT, MOZ, MS, KEYFRAMES, DECLARATION, hash, charat, strlen, indexof, stringify, COMMENT, rulesheet, middleware, compile } from 'stylis';\nimport '@emotion/weak-memoize';\nimport '@emotion/memoize';\n\nvar identifierWithPointTracking = function identifierWithPointTracking(begin, points, index) {\n  var previous = 0;\n  var character = 0;\n\n  while (true) {\n    previous = character;\n    character = peek(); // &\\f\n\n    if (previous === 38 && character === 12) {\n      points[index] = 1;\n    }\n\n    if (token(character)) {\n      break;\n    }\n\n    next();\n  }\n\n  return slice(begin, position);\n};\n\nvar toRules = function toRules(parsed, points) {\n  // pretend we've started with a comma\n  var index = -1;\n  var character = 44;\n\n  do {\n    switch (token(character)) {\n      case 0:\n        // &\\f\n        if (character === 38 && peek() === 12) {\n          // this is not 100% correct, we don't account for literal sequences here - like for example quoted strings\n          // stylis inserts \\f after & to know when & where it should replace this sequence with the context selector\n          // and when it should just concatenate the outer and inner selectors\n          // it's very unlikely for this sequence to actually appear in a different context, so we just leverage this fact here\n          points[index] = 1;\n        }\n\n        parsed[index] += identifierWithPointTracking(position - 1, points, index);\n        break;\n\n      case 2:\n        parsed[index] += delimit(character);\n        break;\n\n      case 4:\n        // comma\n        if (character === 44) {\n          // colon\n          parsed[++index] = peek() === 58 ? '&\\f' : '';\n          points[index] = parsed[index].length;\n          break;\n        }\n\n      // fallthrough\n\n      default:\n        parsed[index] += from(character);\n    }\n  } while (character = next());\n\n  return parsed;\n};\n\nvar getRules = function getRules(value, points) {\n  return dealloc(toRules(alloc(value), points));\n}; // WeakSet would be more appropriate, but only WeakMap is supported in IE11\n\n\nvar fixedElements = /* #__PURE__ */new WeakMap();\nvar compat = function compat(element) {\n  if (element.type !== 'rule' || !element.parent || // positive .length indicates that this rule contains pseudo\n  // negative .length indicates that this rule has been already prefixed\n  element.length < 1) {\n    return;\n  }\n\n  var value = element.value,\n      parent = element.parent;\n  var isImplicitRule = element.column === parent.column && element.line === parent.line;\n\n  while (parent.type !== 'rule') {\n    parent = parent.parent;\n    if (!parent) return;\n  } // short-circuit for the simplest case\n\n\n  if (element.props.length === 1 && value.charCodeAt(0) !== 58\n  /* colon */\n  && !fixedElements.get(parent)) {\n    return;\n  } // if this is an implicitly inserted rule (the one eagerly inserted at the each new nested level)\n  // then the props has already been manipulated beforehand as they that array is shared between it and its \"rule parent\"\n\n\n  if (isImplicitRule) {\n    return;\n  }\n\n  fixedElements.set(element, true);\n  var points = [];\n  var rules = getRules(value, points);\n  var parentRules = parent.props;\n\n  for (var i = 0, k = 0; i < rules.length; i++) {\n    for (var j = 0; j < parentRules.length; j++, k++) {\n      element.props[k] = points[i] ? rules[i].replace(/&\\f/g, parentRules[j]) : parentRules[j] + \" \" + rules[i];\n    }\n  }\n};\nvar removeLabel = function removeLabel(element) {\n  if (element.type === 'decl') {\n    var value = element.value;\n\n    if ( // charcode for l\n    value.charCodeAt(0) === 108 && // charcode for b\n    value.charCodeAt(2) === 98) {\n      // this ignores label\n      element[\"return\"] = '';\n      element.value = '';\n    }\n  }\n};\nvar ignoreFlag = 'emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason';\n\nvar isIgnoringComment = function isIgnoringComment(element) {\n  return element.type === 'comm' && element.children.indexOf(ignoreFlag) > -1;\n};\n\nvar createUnsafeSelectorsAlarm = function createUnsafeSelectorsAlarm(cache) {\n  return function (element, index, children) {\n    if (element.type !== 'rule' || cache.compat) return;\n    var unsafePseudoClasses = element.value.match(/(:first|:nth|:nth-last)-child/g);\n\n    if (unsafePseudoClasses) {\n      var isNested = !!element.parent; // in nested rules comments become children of the \"auto-inserted\" rule and that's always the `element.parent`\n      //\n      // considering this input:\n      // .a {\n      //   .b /* comm */ {}\n      //   color: hotpink;\n      // }\n      // we get output corresponding to this:\n      // .a {\n      //   & {\n      //     /* comm */\n      //     color: hotpink;\n      //   }\n      //   .b {}\n      // }\n\n      var commentContainer = isNested ? element.parent.children : // global rule at the root level\n      children;\n\n      for (var i = commentContainer.length - 1; i >= 0; i--) {\n        var node = commentContainer[i];\n\n        if (node.line < element.line) {\n          break;\n        } // it is quite weird but comments are *usually* put at `column: element.column - 1`\n        // so we seek *from the end* for the node that is earlier than the rule's `element` and check that\n        // this will also match inputs like this:\n        // .a {\n        //   /* comm */\n        //   .b {}\n        // }\n        //\n        // but that is fine\n        //\n        // it would be the easiest to change the placement of the comment to be the first child of the rule:\n        // .a {\n        //   .b { /* comm */ }\n        // }\n        // with such inputs we wouldn't have to search for the comment at all\n        // TODO: consider changing this comment placement in the next major version\n\n\n        if (node.column < element.column) {\n          if (isIgnoringComment(node)) {\n            return;\n          }\n\n          break;\n        }\n      }\n\n      unsafePseudoClasses.forEach(function (unsafePseudoClass) {\n        console.error(\"The pseudo class \\\"\" + unsafePseudoClass + \"\\\" is potentially unsafe when doing server-side rendering. Try changing it to \\\"\" + unsafePseudoClass.split('-child')[0] + \"-of-type\\\".\");\n      });\n    }\n  };\n};\n\nvar isImportRule = function isImportRule(element) {\n  return element.type.charCodeAt(1) === 105 && element.type.charCodeAt(0) === 64;\n};\n\nvar isPrependedWithRegularRules = function isPrependedWithRegularRules(index, children) {\n  for (var i = index - 1; i >= 0; i--) {\n    if (!isImportRule(children[i])) {\n      return true;\n    }\n  }\n\n  return false;\n}; // use this to remove incorrect elements from further processing\n// so they don't get handed to the `sheet` (or anything else)\n// as that could potentially lead to additional logs which in turn could be overhelming to the user\n\n\nvar nullifyElement = function nullifyElement(element) {\n  element.type = '';\n  element.value = '';\n  element[\"return\"] = '';\n  element.children = '';\n  element.props = '';\n};\n\nvar incorrectImportAlarm = function incorrectImportAlarm(element, index, children) {\n  if (!isImportRule(element)) {\n    return;\n  }\n\n  if (element.parent) {\n    console.error(\"`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles.\");\n    nullifyElement(element);\n  } else if (isPrependedWithRegularRules(index, children)) {\n    console.error(\"`@import` rules can't be after other rules. Please put your `@import` rules before your other rules.\");\n    nullifyElement(element);\n  }\n};\n\n/* eslint-disable no-fallthrough */\n\nfunction prefix(value, length) {\n  switch (hash(value, length)) {\n    // color-adjust\n    case 5103:\n      return WEBKIT + 'print-' + value + value;\n    // animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n\n    case 5737:\n    case 4201:\n    case 3177:\n    case 3433:\n    case 1641:\n    case 4457:\n    case 2921: // text-decoration, filter, clip-path, backface-visibility, column, box-decoration-break\n\n    case 5572:\n    case 6356:\n    case 5844:\n    case 3191:\n    case 6645:\n    case 3005: // mask, mask-image, mask-(mode|clip|size), mask-(repeat|origin), mask-position, mask-composite,\n\n    case 6391:\n    case 5879:\n    case 5623:\n    case 6135:\n    case 4599:\n    case 4855: // background-clip, columns, column-(count|fill|gap|rule|rule-color|rule-style|rule-width|span|width)\n\n    case 4215:\n    case 6389:\n    case 5109:\n    case 5365:\n    case 5621:\n    case 3829:\n      return WEBKIT + value + value;\n    // appearance, user-select, transform, hyphens, text-size-adjust\n\n    case 5349:\n    case 4246:\n    case 4810:\n    case 6968:\n    case 2756:\n      return WEBKIT + value + MOZ + value + MS + value + value;\n    // flex, flex-direction\n\n    case 6828:\n    case 4268:\n      return WEBKIT + value + MS + value + value;\n    // order\n\n    case 6165:\n      return WEBKIT + value + MS + 'flex-' + value + value;\n    // align-items\n\n    case 5187:\n      return WEBKIT + value + replace(value, /(\\w+).+(:[^]+)/, WEBKIT + 'box-$1$2' + MS + 'flex-$1$2') + value;\n    // align-self\n\n    case 5443:\n      return WEBKIT + value + MS + 'flex-item-' + replace(value, /flex-|-self/, '') + value;\n    // align-content\n\n    case 4675:\n      return WEBKIT + value + MS + 'flex-line-pack' + replace(value, /align-content|flex-|-self/, '') + value;\n    // flex-shrink\n\n    case 5548:\n      return WEBKIT + value + MS + replace(value, 'shrink', 'negative') + value;\n    // flex-basis\n\n    case 5292:\n      return WEBKIT + value + MS + replace(value, 'basis', 'preferred-size') + value;\n    // flex-grow\n\n    case 6060:\n      return WEBKIT + 'box-' + replace(value, '-grow', '') + WEBKIT + value + MS + replace(value, 'grow', 'positive') + value;\n    // transition\n\n    case 4554:\n      return WEBKIT + replace(value, /([^-])(transform)/g, '$1' + WEBKIT + '$2') + value;\n    // cursor\n\n    case 6187:\n      return replace(replace(replace(value, /(zoom-|grab)/, WEBKIT + '$1'), /(image-set)/, WEBKIT + '$1'), value, '') + value;\n    // background, background-image\n\n    case 5495:\n    case 3959:\n      return replace(value, /(image-set\\([^]*)/, WEBKIT + '$1' + '$`$1');\n    // justify-content\n\n    case 4968:\n      return replace(replace(value, /(.+:)(flex-)?(.*)/, WEBKIT + 'box-pack:$3' + MS + 'flex-pack:$3'), /s.+-b[^;]+/, 'justify') + WEBKIT + value + value;\n    // (margin|padding)-inline-(start|end)\n\n    case 4095:\n    case 3583:\n    case 4068:\n    case 2532:\n      return replace(value, /(.+)-inline(.+)/, WEBKIT + '$1$2') + value;\n    // (min|max)?(width|height|inline-size|block-size)\n\n    case 8116:\n    case 7059:\n    case 5753:\n    case 5535:\n    case 5445:\n    case 5701:\n    case 4933:\n    case 4677:\n    case 5533:\n    case 5789:\n    case 5021:\n    case 4765:\n      // stretch, max-content, min-content, fill-available\n      if (strlen(value) - 1 - length > 6) switch (charat(value, length + 1)) {\n        // (m)ax-content, (m)in-content\n        case 109:\n          // -\n          if (charat(value, length + 4) !== 45) break;\n        // (f)ill-available, (f)it-content\n\n        case 102:\n          return replace(value, /(.+:)(.+)-([^]+)/, '$1' + WEBKIT + '$2-$3' + '$1' + MOZ + (charat(value, length + 3) == 108 ? '$3' : '$2-$3')) + value;\n        // (s)tretch\n\n        case 115:\n          return ~indexof(value, 'stretch') ? prefix(replace(value, 'stretch', 'fill-available'), length) + value : value;\n      }\n      break;\n    // position: sticky\n\n    case 4949:\n      // (s)ticky?\n      if (charat(value, length + 1) !== 115) break;\n    // display: (flex|inline-flex)\n\n    case 6444:\n      switch (charat(value, strlen(value) - 3 - (~indexof(value, '!important') && 10))) {\n        // stic(k)y\n        case 107:\n          return replace(value, ':', ':' + WEBKIT) + value;\n        // (inline-)?fl(e)x\n\n        case 101:\n          return replace(value, /(.+:)([^;!]+)(;|!.+)?/, '$1' + WEBKIT + (charat(value, 14) === 45 ? 'inline-' : '') + 'box$3' + '$1' + WEBKIT + '$2$3' + '$1' + MS + '$2box$3') + value;\n      }\n\n      break;\n    // writing-mode\n\n    case 5936:\n      switch (charat(value, length + 11)) {\n        // vertical-l(r)\n        case 114:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb') + value;\n        // vertical-r(l)\n\n        case 108:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb-rl') + value;\n        // horizontal(-)tb\n\n        case 45:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'lr') + value;\n      }\n\n      return WEBKIT + value + MS + value + value;\n  }\n\n  return value;\n}\n\nvar prefixer = function prefixer(element, index, children, callback) {\n  if (element.length > -1) if (!element[\"return\"]) switch (element.type) {\n    case DECLARATION:\n      element[\"return\"] = prefix(element.value, element.length);\n      break;\n\n    case KEYFRAMES:\n      return serialize([copy(element, {\n        value: replace(element.value, '@', '@' + WEBKIT)\n      })], callback);\n\n    case RULESET:\n      if (element.length) return combine(element.props, function (value) {\n        switch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n          // :read-(only|write)\n          case ':read-only':\n          case ':read-write':\n            return serialize([copy(element, {\n              props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]\n            })], callback);\n          // :placeholder\n\n          case '::placeholder':\n            return serialize([copy(element, {\n              props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]\n            }), copy(element, {\n              props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]\n            }), copy(element, {\n              props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]\n            })], callback);\n        }\n\n        return '';\n      });\n  }\n};\n\nvar defaultStylisPlugins = [prefixer];\n\nvar createCache = function createCache(options) {\n  var key = options.key;\n\n  if (process.env.NODE_ENV !== 'production' && !key) {\n    throw new Error(\"You have to configure `key` for your cache. Please make sure it's unique (and not equal to 'css') as it's used for linking styles to your cache.\\n\" + \"If multiple caches share the same key they might \\\"fight\\\" for each other's style elements.\");\n  }\n\n  if (key === 'css') {\n    var ssrStyles = document.querySelectorAll(\"style[data-emotion]:not([data-s])\"); // get SSRed styles out of the way of React's hydration\n    // document.head is a safe place to move them to(though note document.head is not necessarily the last place they will be)\n    // note this very very intentionally targets all style elements regardless of the key to ensure\n    // that creating a cache works inside of render of a React component\n\n    Array.prototype.forEach.call(ssrStyles, function (node) {\n      // we want to only move elements which have a space in the data-emotion attribute value\n      // because that indicates that it is an Emotion 11 server-side rendered style elements\n      // while we will already ignore Emotion 11 client-side inserted styles because of the :not([data-s]) part in the selector\n      // Emotion 10 client-side inserted styles did not have data-s (but importantly did not have a space in their data-emotion attributes)\n      // so checking for the space ensures that loading Emotion 11 after Emotion 10 has inserted some styles\n      // will not result in the Emotion 10 styles being destroyed\n      var dataEmotionAttribute = node.getAttribute('data-emotion');\n\n      if (dataEmotionAttribute.indexOf(' ') === -1) {\n        return;\n      }\n      document.head.appendChild(node);\n      node.setAttribute('data-s', '');\n    });\n  }\n\n  var stylisPlugins = options.stylisPlugins || defaultStylisPlugins;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // $FlowFixMe\n    if (/[^a-z-]/.test(key)) {\n      throw new Error(\"Emotion key must only contain lower case alphabetical characters and - but \\\"\" + key + \"\\\" was passed\");\n    }\n  }\n\n  var inserted = {};\n  var container;\n  var nodesToHydrate = [];\n\n  {\n    container = options.container || document.head;\n    Array.prototype.forEach.call( // this means we will ignore elements which don't have a space in them which\n    // means that the style elements we're looking at are only Emotion 11 server-rendered style elements\n    document.querySelectorAll(\"style[data-emotion^=\\\"\" + key + \" \\\"]\"), function (node) {\n      var attrib = node.getAttribute(\"data-emotion\").split(' '); // $FlowFixMe\n\n      for (var i = 1; i < attrib.length; i++) {\n        inserted[attrib[i]] = true;\n      }\n\n      nodesToHydrate.push(node);\n    });\n  }\n\n  var _insert;\n\n  var omnipresentPlugins = [compat, removeLabel];\n\n  if (process.env.NODE_ENV !== 'production') {\n    omnipresentPlugins.push(createUnsafeSelectorsAlarm({\n      get compat() {\n        return cache.compat;\n      }\n\n    }), incorrectImportAlarm);\n  }\n\n  {\n    var currentSheet;\n    var finalizingPlugins = [stringify, process.env.NODE_ENV !== 'production' ? function (element) {\n      if (!element.root) {\n        if (element[\"return\"]) {\n          currentSheet.insert(element[\"return\"]);\n        } else if (element.value && element.type !== COMMENT) {\n          // insert empty rule in non-production environments\n          // so @emotion/jest can grab `key` from the (JS)DOM for caches without any rules inserted yet\n          currentSheet.insert(element.value + \"{}\");\n        }\n      }\n    } : rulesheet(function (rule) {\n      currentSheet.insert(rule);\n    })];\n    var serializer = middleware(omnipresentPlugins.concat(stylisPlugins, finalizingPlugins));\n\n    var stylis = function stylis(styles) {\n      return serialize(compile(styles), serializer);\n    };\n\n    _insert = function insert(selector, serialized, sheet, shouldCache) {\n      currentSheet = sheet;\n\n      if (process.env.NODE_ENV !== 'production' && serialized.map !== undefined) {\n        currentSheet = {\n          insert: function insert(rule) {\n            sheet.insert(rule + serialized.map);\n          }\n        };\n      }\n\n      stylis(selector ? selector + \"{\" + serialized.styles + \"}\" : serialized.styles);\n\n      if (shouldCache) {\n        cache.inserted[serialized.name] = true;\n      }\n    };\n  }\n\n  var cache = {\n    key: key,\n    sheet: new StyleSheet({\n      key: key,\n      container: container,\n      nonce: options.nonce,\n      speedy: options.speedy,\n      prepend: options.prepend,\n      insertionPoint: options.insertionPoint\n    }),\n    nonce: options.nonce,\n    inserted: inserted,\n    registered: {},\n    insert: _insert\n  };\n  cache.sheet.hydrate(nodesToHydrate);\n  return cache;\n};\n\nexport { createCache as default };\n","/*\n\nBased off glamor's StyleSheet, thanks Sunil \n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n\n// usage\n\nimport { StyleSheet } from '@emotion/sheet'\n\nlet styleSheet = new StyleSheet({ key: '', container: document.head })\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/\n// $FlowFixMe\nfunction sheetForTag(tag) {\n  if (tag.sheet) {\n    // $FlowFixMe\n    return tag.sheet;\n  } // this weirdness brought to you by firefox\n\n  /* istanbul ignore next */\n\n\n  for (var i = 0; i < document.styleSheets.length; i++) {\n    if (document.styleSheets[i].ownerNode === tag) {\n      // $FlowFixMe\n      return document.styleSheets[i];\n    }\n  }\n}\n\nfunction createStyleElement(options) {\n  var tag = document.createElement('style');\n  tag.setAttribute('data-emotion', options.key);\n\n  if (options.nonce !== undefined) {\n    tag.setAttribute('nonce', options.nonce);\n  }\n\n  tag.appendChild(document.createTextNode(''));\n  tag.setAttribute('data-s', '');\n  return tag;\n}\n\nvar StyleSheet = /*#__PURE__*/function () {\n  // Using Node instead of HTMLElement since container may be a ShadowRoot\n  function StyleSheet(options) {\n    var _this = this;\n\n    this._insertTag = function (tag) {\n      var before;\n\n      if (_this.tags.length === 0) {\n        if (_this.insertionPoint) {\n          before = _this.insertionPoint.nextSibling;\n        } else if (_this.prepend) {\n          before = _this.container.firstChild;\n        } else {\n          before = _this.before;\n        }\n      } else {\n        before = _this.tags[_this.tags.length - 1].nextSibling;\n      }\n\n      _this.container.insertBefore(tag, before);\n\n      _this.tags.push(tag);\n    };\n\n    this.isSpeedy = options.speedy === undefined ? process.env.NODE_ENV === 'production' : options.speedy;\n    this.tags = [];\n    this.ctr = 0;\n    this.nonce = options.nonce; // key is the value of the data-emotion attribute, it's used to identify different sheets\n\n    this.key = options.key;\n    this.container = options.container;\n    this.prepend = options.prepend;\n    this.insertionPoint = options.insertionPoint;\n    this.before = null;\n  }\n\n  var _proto = StyleSheet.prototype;\n\n  _proto.hydrate = function hydrate(nodes) {\n    nodes.forEach(this._insertTag);\n  };\n\n  _proto.insert = function insert(rule) {\n    // the max length is how many rules we have per style tag, it's 65000 in speedy mode\n    // it's 1 in dev because we insert source maps that map a single rule to a location\n    // and you can only have one source map per style tag\n    if (this.ctr % (this.isSpeedy ? 65000 : 1) === 0) {\n      this._insertTag(createStyleElement(this));\n    }\n\n    var tag = this.tags[this.tags.length - 1];\n\n    if (process.env.NODE_ENV !== 'production') {\n      var isImportRule = rule.charCodeAt(0) === 64 && rule.charCodeAt(1) === 105;\n\n      if (isImportRule && this._alreadyInsertedOrderInsensitiveRule) {\n        // this would only cause problem in speedy mode\n        // but we don't want enabling speedy to affect the observable behavior\n        // so we report this error at all times\n        console.error(\"You're attempting to insert the following rule:\\n\" + rule + '\\n\\n`@import` rules must be before all other types of rules in a stylesheet but other rules have already been inserted. Please ensure that `@import` rules are before all other rules.');\n      }\n      this._alreadyInsertedOrderInsensitiveRule = this._alreadyInsertedOrderInsensitiveRule || !isImportRule;\n    }\n\n    if (this.isSpeedy) {\n      var sheet = sheetForTag(tag);\n\n      try {\n        // this is the ultrafast version, works across browsers\n        // the big drawback is that the css won't be editable in devtools\n        sheet.insertRule(rule, sheet.cssRules.length);\n      } catch (e) {\n        if (process.env.NODE_ENV !== 'production' && !/:(-moz-placeholder|-moz-focus-inner|-moz-focusring|-ms-input-placeholder|-moz-read-write|-moz-read-only|-ms-clear|-ms-expand|-ms-reveal){/.test(rule)) {\n          console.error(\"There was a problem inserting the following rule: \\\"\" + rule + \"\\\"\", e);\n        }\n      }\n    } else {\n      tag.appendChild(document.createTextNode(rule));\n    }\n\n    this.ctr++;\n  };\n\n  _proto.flush = function flush() {\n    // $FlowFixMe\n    this.tags.forEach(function (tag) {\n      return tag.parentNode && tag.parentNode.removeChild(tag);\n    });\n    this.tags = [];\n    this.ctr = 0;\n\n    if (process.env.NODE_ENV !== 'production') {\n      this._alreadyInsertedOrderInsensitiveRule = false;\n    }\n  };\n\n  return StyleSheet;\n}();\n\nexport { StyleSheet };\n",null,"export var MS = '-ms-'\nexport var MOZ = '-moz-'\nexport var WEBKIT = '-webkit-'\n\nexport var COMMENT = 'comm'\nexport var RULESET = 'rule'\nexport var DECLARATION = 'decl'\n\nexport var PAGE = '@page'\nexport var MEDIA = '@media'\nexport var IMPORT = '@import'\nexport var CHARSET = '@charset'\nexport var VIEWPORT = '@viewport'\nexport var SUPPORTS = '@supports'\nexport var DOCUMENT = '@document'\nexport var NAMESPACE = '@namespace'\nexport var KEYFRAMES = '@keyframes'\nexport var FONT_FACE = '@font-face'\nexport var COUNTER_STYLE = '@counter-style'\nexport var FONT_FEATURE_VALUES = '@font-feature-values'\nexport var LAYER = '@layer'\n","/**\n * @param {number}\n * @return {number}\n */\nexport var abs = Math.abs\n\n/**\n * @param {number}\n * @return {string}\n */\nexport var from = String.fromCharCode\n\n/**\n * @param {object}\n * @return {object}\n */\nexport var assign = Object.assign\n\n/**\n * @param {string} value\n * @param {number} length\n * @return {number}\n */\nexport function hash (value, length) {\n\treturn charat(value, 0) ^ 45 ? (((((((length << 2) ^ charat(value, 0)) << 2) ^ charat(value, 1)) << 2) ^ charat(value, 2)) << 2) ^ charat(value, 3) : 0\n}\n\n/**\n * @param {string} value\n * @return {string}\n */\nexport function trim (value) {\n\treturn value.trim()\n}\n\n/**\n * @param {string} value\n * @param {RegExp} pattern\n * @return {string?}\n */\nexport function match (value, pattern) {\n\treturn (value = pattern.exec(value)) ? value[0] : value\n}\n\n/**\n * @param {string} value\n * @param {(string|RegExp)} pattern\n * @param {string} replacement\n * @return {string}\n */\nexport function replace (value, pattern, replacement) {\n\treturn value.replace(pattern, replacement)\n}\n\n/**\n * @param {string} value\n * @param {string} search\n * @return {number}\n */\nexport function indexof (value, search) {\n\treturn value.indexOf(search)\n}\n\n/**\n * @param {string} value\n * @param {number} index\n * @return {number}\n */\nexport function charat (value, index) {\n\treturn value.charCodeAt(index) | 0\n}\n\n/**\n * @param {string} value\n * @param {number} begin\n * @param {number} end\n * @return {string}\n */\nexport function substr (value, begin, end) {\n\treturn value.slice(begin, end)\n}\n\n/**\n * @param {string} value\n * @return {number}\n */\nexport function strlen (value) {\n\treturn value.length\n}\n\n/**\n * @param {any[]} value\n * @return {number}\n */\nexport function sizeof (value) {\n\treturn value.length\n}\n\n/**\n * @param {any} value\n * @param {any[]} array\n * @return {any}\n */\nexport function append (value, array) {\n\treturn array.push(value), value\n}\n\n/**\n * @param {string[]} array\n * @param {function} callback\n * @return {string}\n */\nexport function combine (array, callback) {\n\treturn array.map(callback).join('')\n}\n","import {from, trim, charat, strlen, substr, append, assign} from './Utility.js'\n\nexport var line = 1\nexport var column = 1\nexport var length = 0\nexport var position = 0\nexport var character = 0\nexport var characters = ''\n\n/**\n * @param {string} value\n * @param {object | null} root\n * @param {object | null} parent\n * @param {string} type\n * @param {string[] | string} props\n * @param {object[] | string} children\n * @param {number} length\n */\nexport function node (value, root, parent, type, props, children, length) {\n\treturn {value: value, root: root, parent: parent, type: type, props: props, children: children, line: line, column: column, length: length, return: ''}\n}\n\n/**\n * @param {object} root\n * @param {object} props\n * @return {object}\n */\nexport function copy (root, props) {\n\treturn assign(node('', null, null, '', null, null, 0), root, {length: -root.length}, props)\n}\n\n/**\n * @return {number}\n */\nexport function char () {\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function prev () {\n\tcharacter = position > 0 ? charat(characters, --position) : 0\n\n\tif (column--, character === 10)\n\t\tcolumn = 1, line--\n\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function next () {\n\tcharacter = position < length ? charat(characters, position++) : 0\n\n\tif (column++, character === 10)\n\t\tcolumn = 1, line++\n\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function peek () {\n\treturn charat(characters, position)\n}\n\n/**\n * @return {number}\n */\nexport function caret () {\n\treturn position\n}\n\n/**\n * @param {number} begin\n * @param {number} end\n * @return {string}\n */\nexport function slice (begin, end) {\n\treturn substr(characters, begin, end)\n}\n\n/**\n * @param {number} type\n * @return {number}\n */\nexport function token (type) {\n\tswitch (type) {\n\t\t// \\0 \\t \\n \\r \\s whitespace token\n\t\tcase 0: case 9: case 10: case 13: case 32:\n\t\t\treturn 5\n\t\t// ! + , / > @ ~ isolate token\n\t\tcase 33: case 43: case 44: case 47: case 62: case 64: case 126:\n\t\t// ; { } breakpoint token\n\t\tcase 59: case 123: case 125:\n\t\t\treturn 4\n\t\t// : accompanied token\n\t\tcase 58:\n\t\t\treturn 3\n\t\t// \" ' ( [ opening delimit token\n\t\tcase 34: case 39: case 40: case 91:\n\t\t\treturn 2\n\t\t// ) ] closing delimit token\n\t\tcase 41: case 93:\n\t\t\treturn 1\n\t}\n\n\treturn 0\n}\n\n/**\n * @param {string} value\n * @return {any[]}\n */\nexport function alloc (value) {\n\treturn line = column = 1, length = strlen(characters = value), position = 0, []\n}\n\n/**\n * @param {any} value\n * @return {any}\n */\nexport function dealloc (value) {\n\treturn characters = '', value\n}\n\n/**\n * @param {number} type\n * @return {string}\n */\nexport function delimit (type) {\n\treturn trim(slice(position - 1, delimiter(type === 91 ? type + 2 : type === 40 ? type + 1 : type)))\n}\n\n/**\n * @param {string} value\n * @return {string[]}\n */\nexport function tokenize (value) {\n\treturn dealloc(tokenizer(alloc(value)))\n}\n\n/**\n * @param {number} type\n * @return {string}\n */\nexport function whitespace (type) {\n\twhile (character = peek())\n\t\tif (character < 33)\n\t\t\tnext()\n\t\telse\n\t\t\tbreak\n\n\treturn token(type) > 2 || token(character) > 3 ? '' : ' '\n}\n\n/**\n * @param {string[]} children\n * @return {string[]}\n */\nexport function tokenizer (children) {\n\twhile (next())\n\t\tswitch (token(character)) {\n\t\t\tcase 0: append(identifier(position - 1), children)\n\t\t\t\tbreak\n\t\t\tcase 2: append(delimit(character), children)\n\t\t\t\tbreak\n\t\t\tdefault: append(from(character), children)\n\t\t}\n\n\treturn children\n}\n\n/**\n * @param {number} index\n * @param {number} count\n * @return {string}\n */\nexport function escaping (index, count) {\n\twhile (--count && next())\n\t\t// not 0-9 A-F a-f\n\t\tif (character < 48 || character > 102 || (character > 57 && character < 65) || (character > 70 && character < 97))\n\t\t\tbreak\n\n\treturn slice(index, caret() + (count < 6 && peek() == 32 && next() == 32))\n}\n\n/**\n * @param {number} type\n * @return {number}\n */\nexport function delimiter (type) {\n\twhile (next())\n\t\tswitch (character) {\n\t\t\t// ] ) \" '\n\t\t\tcase type:\n\t\t\t\treturn position\n\t\t\t// \" '\n\t\t\tcase 34: case 39:\n\t\t\t\tif (type !== 34 && type !== 39)\n\t\t\t\t\tdelimiter(character)\n\t\t\t\tbreak\n\t\t\t// (\n\t\t\tcase 40:\n\t\t\t\tif (type === 41)\n\t\t\t\t\tdelimiter(type)\n\t\t\t\tbreak\n\t\t\t// \\\n\t\t\tcase 92:\n\t\t\t\tnext()\n\t\t\t\tbreak\n\t\t}\n\n\treturn position\n}\n\n/**\n * @param {number} type\n * @param {number} index\n * @return {number}\n */\nexport function commenter (type, index) {\n\twhile (next())\n\t\t// //\n\t\tif (type + character === 47 + 10)\n\t\t\tbreak\n\t\t// /*\n\t\telse if (type + character === 42 + 42 && peek() === 47)\n\t\t\tbreak\n\n\treturn '/*' + slice(index, position - 1) + '*' + from(type === 47 ? type : next())\n}\n\n/**\n * @param {number} index\n * @return {string}\n */\nexport function identifier (index) {\n\twhile (!token(peek()))\n\t\tnext()\n\n\treturn slice(index, position)\n}\n","import {COMMENT, RULESET, DECLARATION} from './Enum.js'\nimport {abs, charat, trim, from, sizeof, strlen, substr, append, replace, indexof} from './Utility.js'\nimport {node, char, prev, next, peek, caret, alloc, dealloc, delimit, whitespace, escaping, identifier, commenter} from './Tokenizer.js'\n\n/**\n * @param {string} value\n * @return {object[]}\n */\nexport function compile (value) {\n\treturn dealloc(parse('', null, null, null, [''], value = alloc(value), 0, [0], value))\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {string[]} rule\n * @param {string[]} rules\n * @param {string[]} rulesets\n * @param {number[]} pseudo\n * @param {number[]} points\n * @param {string[]} declarations\n * @return {object}\n */\nexport function parse (value, root, parent, rule, rules, rulesets, pseudo, points, declarations) {\n\tvar index = 0\n\tvar offset = 0\n\tvar length = pseudo\n\tvar atrule = 0\n\tvar property = 0\n\tvar previous = 0\n\tvar variable = 1\n\tvar scanning = 1\n\tvar ampersand = 1\n\tvar character = 0\n\tvar type = ''\n\tvar props = rules\n\tvar children = rulesets\n\tvar reference = rule\n\tvar characters = type\n\n\twhile (scanning)\n\t\tswitch (previous = character, character = next()) {\n\t\t\t// (\n\t\t\tcase 40:\n\t\t\t\tif (previous != 108 && charat(characters, length - 1) == 58) {\n\t\t\t\t\tif (indexof(characters += replace(delimit(character), '&', '&\\f'), '&\\f') != -1)\n\t\t\t\t\t\tampersand = -1\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t// \" ' [\n\t\t\tcase 34: case 39: case 91:\n\t\t\t\tcharacters += delimit(character)\n\t\t\t\tbreak\n\t\t\t// \\t \\n \\r \\s\n\t\t\tcase 9: case 10: case 13: case 32:\n\t\t\t\tcharacters += whitespace(previous)\n\t\t\t\tbreak\n\t\t\t// \\\n\t\t\tcase 92:\n\t\t\t\tcharacters += escaping(caret() - 1, 7)\n\t\t\t\tcontinue\n\t\t\t// /\n\t\t\tcase 47:\n\t\t\t\tswitch (peek()) {\n\t\t\t\t\tcase 42: case 47:\n\t\t\t\t\t\tappend(comment(commenter(next(), caret()), root, parent), declarations)\n\t\t\t\t\t\tbreak\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcharacters += '/'\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t// {\n\t\t\tcase 123 * variable:\n\t\t\t\tpoints[index++] = strlen(characters) * ampersand\n\t\t\t// } ; \\0\n\t\t\tcase 125 * variable: case 59: case 0:\n\t\t\t\tswitch (character) {\n\t\t\t\t\t// \\0 }\n\t\t\t\t\tcase 0: case 125: scanning = 0\n\t\t\t\t\t// ;\n\t\t\t\t\tcase 59 + offset: if (ampersand == -1) characters = replace(characters, /\\f/g, '')\n\t\t\t\t\t\tif (property > 0 && (strlen(characters) - length))\n\t\t\t\t\t\t\tappend(property > 32 ? declaration(characters + ';', rule, parent, length - 1) : declaration(replace(characters, ' ', '') + ';', rule, parent, length - 2), declarations)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// @ ;\n\t\t\t\t\tcase 59: characters += ';'\n\t\t\t\t\t// { rule/at-rule\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tappend(reference = ruleset(characters, root, parent, index, offset, rules, points, type, props = [], children = [], length), rulesets)\n\n\t\t\t\t\t\tif (character === 123)\n\t\t\t\t\t\t\tif (offset === 0)\n\t\t\t\t\t\t\t\tparse(characters, root, reference, reference, props, rulesets, length, points, children)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tswitch (atrule === 99 && charat(characters, 3) === 110 ? 100 : atrule) {\n\t\t\t\t\t\t\t\t\t// d l m s\n\t\t\t\t\t\t\t\t\tcase 100: case 108: case 109: case 115:\n\t\t\t\t\t\t\t\t\t\tparse(value, reference, reference, rule && append(ruleset(value, reference, reference, 0, 0, rules, points, type, rules, props = [], length), children), rules, children, length, points, rule ? props : children)\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tparse(characters, reference, reference, reference, [''], children, 0, points, children)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tindex = offset = property = 0, variable = ampersand = 1, type = characters = '', length = pseudo\n\t\t\t\tbreak\n\t\t\t// :\n\t\t\tcase 58:\n\t\t\t\tlength = 1 + strlen(characters), property = previous\n\t\t\tdefault:\n\t\t\t\tif (variable < 1)\n\t\t\t\t\tif (character == 123)\n\t\t\t\t\t\t--variable\n\t\t\t\t\telse if (character == 125 && variable++ == 0 && prev() == 125)\n\t\t\t\t\t\tcontinue\n\n\t\t\t\tswitch (characters += from(character), character * variable) {\n\t\t\t\t\t// &\n\t\t\t\t\tcase 38:\n\t\t\t\t\t\tampersand = offset > 0 ? 1 : (characters += '\\f', -1)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// ,\n\t\t\t\t\tcase 44:\n\t\t\t\t\t\tpoints[index++] = (strlen(characters) - 1) * ampersand, ampersand = 1\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// @\n\t\t\t\t\tcase 64:\n\t\t\t\t\t\t// -\n\t\t\t\t\t\tif (peek() === 45)\n\t\t\t\t\t\t\tcharacters += delimit(next())\n\n\t\t\t\t\t\tatrule = peek(), offset = length = strlen(type = characters += identifier(caret())), character++\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// -\n\t\t\t\t\tcase 45:\n\t\t\t\t\t\tif (previous === 45 && strlen(characters) == 2)\n\t\t\t\t\t\t\tvariable = 0\n\t\t\t\t}\n\t\t}\n\n\treturn rulesets\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {number} index\n * @param {number} offset\n * @param {string[]} rules\n * @param {number[]} points\n * @param {string} type\n * @param {string[]} props\n * @param {string[]} children\n * @param {number} length\n * @return {object}\n */\nexport function ruleset (value, root, parent, index, offset, rules, points, type, props, children, length) {\n\tvar post = offset - 1\n\tvar rule = offset === 0 ? rules : ['']\n\tvar size = sizeof(rule)\n\n\tfor (var i = 0, j = 0, k = 0; i < index; ++i)\n\t\tfor (var x = 0, y = substr(value, post + 1, post = abs(j = points[i])), z = value; x < size; ++x)\n\t\t\tif (z = trim(j > 0 ? rule[x] + ' ' + y : replace(y, /&\\f/g, rule[x])))\n\t\t\t\tprops[k++] = z\n\n\treturn node(value, root, parent, offset === 0 ? RULESET : type, props, children, length)\n}\n\n/**\n * @param {number} value\n * @param {object} root\n * @param {object?} parent\n * @return {object}\n */\nexport function comment (value, root, parent) {\n\treturn node(value, root, parent, COMMENT, from(char()), substr(value, 2, -2), 0)\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {number} length\n * @return {object}\n */\nexport function declaration (value, root, parent, length) {\n\treturn node(value, root, parent, DECLARATION, substr(value, 0, length), substr(value, length + 1, -1), length)\n}\n","import {MS, MOZ, WEBKIT} from './Enum.js'\nimport {hash, charat, strlen, indexof, replace, substr, match} from './Utility.js'\n\n/**\n * @param {string} value\n * @param {number} length\n * @param {object[]} children\n * @return {string}\n */\nexport function prefix (value, length, children) {\n\tswitch (hash(value, length)) {\n\t\t// color-adjust\n\t\tcase 5103:\n\t\t\treturn WEBKIT + 'print-' + value + value\n\t\t// animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n\t\tcase 5737: case 4201: case 3177: case 3433: case 1641: case 4457: case 2921:\n\t\t// text-decoration, filter, clip-path, backface-visibility, column, box-decoration-break\n\t\tcase 5572: case 6356: case 5844: case 3191: case 6645: case 3005:\n\t\t// mask, mask-image, mask-(mode|clip|size), mask-(repeat|origin), mask-position, mask-composite,\n\t\tcase 6391: case 5879: case 5623: case 6135: case 4599: case 4855:\n\t\t// background-clip, columns, column-(count|fill|gap|rule|rule-color|rule-style|rule-width|span|width)\n\t\tcase 4215: case 6389: case 5109: case 5365: case 5621: case 3829:\n\t\t\treturn WEBKIT + value + value\n\t\t// tab-size\n\t\tcase 4789:\n\t\t\treturn MOZ + value + value\n\t\t// appearance, user-select, transform, hyphens, text-size-adjust\n\t\tcase 5349: case 4246: case 4810: case 6968: case 2756:\n\t\t\treturn WEBKIT + value + MOZ + value + MS + value + value\n\t\t// writing-mode\n\t\tcase 5936:\n\t\t\tswitch (charat(value, length + 11)) {\n\t\t\t\t// vertical-l(r)\n\t\t\t\tcase 114:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb') + value\n\t\t\t\t// vertical-r(l)\n\t\t\t\tcase 108:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb-rl') + value\n\t\t\t\t// horizontal(-)tb\n\t\t\t\tcase 45:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'lr') + value\n\t\t\t\t// default: fallthrough to below\n\t\t\t}\n\t\t// flex, flex-direction, scroll-snap-type, writing-mode\n\t\tcase 6828: case 4268: case 2903:\n\t\t\treturn WEBKIT + value + MS + value + value\n\t\t// order\n\t\tcase 6165:\n\t\t\treturn WEBKIT + value + MS + 'flex-' + value + value\n\t\t// align-items\n\t\tcase 5187:\n\t\t\treturn WEBKIT + value + replace(value, /(\\w+).+(:[^]+)/, WEBKIT + 'box-$1$2' + MS + 'flex-$1$2') + value\n\t\t// align-self\n\t\tcase 5443:\n\t\t\treturn WEBKIT + value + MS + 'flex-item-' + replace(value, /flex-|-self/g, '') + (!match(value, /flex-|baseline/) ? MS + 'grid-row-' + replace(value, /flex-|-self/g, '') : '') + value\n\t\t// align-content\n\t\tcase 4675:\n\t\t\treturn WEBKIT + value + MS + 'flex-line-pack' + replace(value, /align-content|flex-|-self/g, '') + value\n\t\t// flex-shrink\n\t\tcase 5548:\n\t\t\treturn WEBKIT + value + MS + replace(value, 'shrink', 'negative') + value\n\t\t// flex-basis\n\t\tcase 5292:\n\t\t\treturn WEBKIT + value + MS + replace(value, 'basis', 'preferred-size') + value\n\t\t// flex-grow\n\t\tcase 6060:\n\t\t\treturn WEBKIT + 'box-' + replace(value, '-grow', '') + WEBKIT + value + MS + replace(value, 'grow', 'positive') + value\n\t\t// transition\n\t\tcase 4554:\n\t\t\treturn WEBKIT + replace(value, /([^-])(transform)/g, '$1' + WEBKIT + '$2') + value\n\t\t// cursor\n\t\tcase 6187:\n\t\t\treturn replace(replace(replace(value, /(zoom-|grab)/, WEBKIT + '$1'), /(image-set)/, WEBKIT + '$1'), value, '') + value\n\t\t// background, background-image\n\t\tcase 5495: case 3959:\n\t\t\treturn replace(value, /(image-set\\([^]*)/, WEBKIT + '$1' + '$`$1')\n\t\t// justify-content\n\t\tcase 4968:\n\t\t\treturn replace(replace(value, /(.+:)(flex-)?(.*)/, WEBKIT + 'box-pack:$3' + MS + 'flex-pack:$3'), /s.+-b[^;]+/, 'justify') + WEBKIT + value + value\n\t\t// justify-self\n\t\tcase 4200:\n\t\t\tif (!match(value, /flex-|baseline/)) return MS + 'grid-column-align' + substr(value, length) + value\n\t\t\tbreak\n\t\t// grid-template-(columns|rows)\n\t\tcase 2592: case 3360:\n\t\t\treturn MS + replace(value, 'template-', '') + value\n\t\t// grid-(row|column)-start\n\t\tcase 4384: case 3616:\n\t\t\tif (children && children.some(function (element, index) { return length = index, match(element.props, /grid-\\w+-end/) })) {\n\t\t\t\treturn ~indexof(value + (children = children[length].value), 'span') ? value : (MS + replace(value, '-start', '') + value + MS + 'grid-row-span:' + (~indexof(children, 'span') ? match(children, /\\d+/) : +match(children, /\\d+/) - +match(value, /\\d+/)) + ';')\n\t\t\t}\n\t\t\treturn MS + replace(value, '-start', '') + value\n\t\t// grid-(row|column)-end\n\t\tcase 4896: case 4128:\n\t\t\treturn (children && children.some(function (element) { return match(element.props, /grid-\\w+-start/) })) ? value : MS + replace(replace(value, '-end', '-span'), 'span ', '') + value\n\t\t// (margin|padding)-inline-(start|end)\n\t\tcase 4095: case 3583: case 4068: case 2532:\n\t\t\treturn replace(value, /(.+)-inline(.+)/, WEBKIT + '$1$2') + value\n\t\t// (min|max)?(width|height|inline-size|block-size)\n\t\tcase 8116: case 7059: case 5753: case 5535:\n\t\tcase 5445: case 5701: case 4933: case 4677:\n\t\tcase 5533: case 5789: case 5021: case 4765:\n\t\t\t// stretch, max-content, min-content, fill-available\n\t\t\tif (strlen(value) - 1 - length > 6)\n\t\t\t\tswitch (charat(value, length + 1)) {\n\t\t\t\t\t// (m)ax-content, (m)in-content\n\t\t\t\t\tcase 109:\n\t\t\t\t\t\t// -\n\t\t\t\t\t\tif (charat(value, length + 4) !== 45)\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t// (f)ill-available, (f)it-content\n\t\t\t\t\tcase 102:\n\t\t\t\t\t\treturn replace(value, /(.+:)(.+)-([^]+)/, '$1' + WEBKIT + '$2-$3' + '$1' + MOZ + (charat(value, length + 3) == 108 ? '$3' : '$2-$3')) + value\n\t\t\t\t\t// (s)tretch\n\t\t\t\t\tcase 115:\n\t\t\t\t\t\treturn ~indexof(value, 'stretch') ? prefix(replace(value, 'stretch', 'fill-available'), length, children) + value : value\n\t\t\t\t}\n\t\t\tbreak\n\t\t// grid-(column|row)\n\t\tcase 5152: case 5920:\n\t\t\treturn replace(value, /(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/, function (_, a, b, c, d, e, f) { return (MS + a + ':' + b + f) + (c ? (MS + a + '-span:' + (d ? e : +e - +b)) + f : '') + value })\n\t\t// position: sticky\n\t\tcase 4949:\n\t\t\t// stick(y)?\n\t\t\tif (charat(value, length + 6) === 121)\n\t\t\t\treturn replace(value, ':', ':' + WEBKIT) + value\n\t\t\tbreak\n\t\t// display: (flex|inline-flex|grid|inline-grid)\n\t\tcase 6444:\n\t\t\tswitch (charat(value, charat(value, 14) === 45 ? 18 : 11)) {\n\t\t\t\t// (inline-)?fle(x)\n\t\t\t\tcase 120:\n\t\t\t\t\treturn replace(value, /(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/, '$1' + WEBKIT + (charat(value, 14) === 45 ? 'inline-' : '') + 'box$3' + '$1' + WEBKIT + '$2$3' + '$1' + MS + '$2box$3') + value\n\t\t\t\t// (inline-)?gri(d)\n\t\t\t\tcase 100:\n\t\t\t\t\treturn replace(value, ':', ':' + MS) + value\n\t\t\t}\n\t\t\tbreak\n\t\t// scroll-margin, scroll-margin-(top|right|bottom|left)\n\t\tcase 5719: case 2647: case 2135: case 3927: case 2391:\n\t\t\treturn replace(value, 'scroll-', 'scroll-snap-') + value\n\t}\n\n\treturn value\n}\n","import {IMPORT, LAYER, COMMENT, RULESET, DECLARATION, KEYFRAMES} from './Enum.js'\nimport {strlen, sizeof} from './Utility.js'\n\n/**\n * @param {object[]} children\n * @param {function} callback\n * @return {string}\n */\nexport function serialize (children, callback) {\n\tvar output = ''\n\tvar length = sizeof(children)\n\n\tfor (var i = 0; i < length; i++)\n\t\toutput += callback(children[i], i, children, callback) || ''\n\n\treturn output\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n * @return {string}\n */\nexport function stringify (element, index, children, callback) {\n\tswitch (element.type) {\n\t\tcase LAYER: if (element.children.length) break\n\t\tcase IMPORT: case DECLARATION: return element.return = element.return || element.value\n\t\tcase COMMENT: return ''\n\t\tcase KEYFRAMES: return element.return = element.value + '{' + serialize(element.children, callback) + '}'\n\t\tcase RULESET: element.value = element.props.join(',')\n\t}\n\n\treturn strlen(children = serialize(element.children, callback)) ? element.return = element.value + '{' + children + '}' : ''\n}\n","import {MS, MOZ, WEBKIT, RULESET, KEYFRAMES, DECLARATION} from './Enum.js'\nimport {match, charat, substr, strlen, sizeof, replace, combine} from './Utility.js'\nimport {copy, tokenize} from './Tokenizer.js'\nimport {serialize} from './Serializer.js'\nimport {prefix} from './Prefixer.js'\n\n/**\n * @param {function[]} collection\n * @return {function}\n */\nexport function middleware (collection) {\n\tvar length = sizeof(collection)\n\n\treturn function (element, index, children, callback) {\n\t\tvar output = ''\n\n\t\tfor (var i = 0; i < length; i++)\n\t\t\toutput += collection[i](element, index, children, callback) || ''\n\n\t\treturn output\n\t}\n}\n\n/**\n * @param {function} callback\n * @return {function}\n */\nexport function rulesheet (callback) {\n\treturn function (element) {\n\t\tif (!element.root)\n\t\t\tif (element = element.return)\n\t\t\t\tcallback(element)\n\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n */\nexport function prefixer (element, index, children, callback) {\n\tif (element.length > -1)\n\t\tif (!element.return)\n\t\t\tswitch (element.type) {\n\t\t\t\tcase DECLARATION: element.return = prefix(element.value, element.length, children)\n\t\t\t\t\treturn\n\t\t\t\tcase KEYFRAMES:\n\t\t\t\t\treturn serialize([copy(element, {value: replace(element.value, '@', '@' + WEBKIT)})], callback)\n\t\t\t\tcase RULESET:\n\t\t\t\t\tif (element.length)\n\t\t\t\t\t\treturn combine(element.props, function (value) {\n\t\t\t\t\t\t\tswitch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n\t\t\t\t\t\t\t\t// :read-(only|write)\n\t\t\t\t\t\t\t\tcase ':read-only': case ':read-write':\n\t\t\t\t\t\t\t\t\treturn serialize([copy(element, {props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]})], callback)\n\t\t\t\t\t\t\t\t// :placeholder\n\t\t\t\t\t\t\t\tcase '::placeholder':\n\t\t\t\t\t\t\t\t\treturn serialize([\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]})\n\t\t\t\t\t\t\t\t\t], callback)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn ''\n\t\t\t\t\t\t})\n\t\t\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n */\nexport function namespace (element) {\n\tswitch (element.type) {\n\t\tcase RULESET:\n\t\t\telement.props = element.props.map(function (value) {\n\t\t\t\treturn combine(tokenize(value), function (value, index, children) {\n\t\t\t\t\tswitch (charat(value, 0)) {\n\t\t\t\t\t\t// \\f\n\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\treturn substr(value, 1, strlen(value))\n\t\t\t\t\t\t// \\0 ( + > ~\n\t\t\t\t\t\tcase 0: case 40: case 43: case 62: case 126:\n\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t// :\n\t\t\t\t\t\tcase 58:\n\t\t\t\t\t\t\tif (children[++index] === 'global')\n\t\t\t\t\t\t\t\tchildren[index] = '', children[++index] = '\\f' + substr(children[index], index = 1, -1)\n\t\t\t\t\t\t// \\s\n\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\treturn index === 1 ? '' : value\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tswitch (index) {\n\t\t\t\t\t\t\t\tcase 0: element = value\n\t\t\t\t\t\t\t\t\treturn sizeof(children) > 1 ? '' : value\n\t\t\t\t\t\t\t\tcase index = sizeof(children) - 1: case 2:\n\t\t\t\t\t\t\t\t\treturn index === 2 ? value + element + element : value + element\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t}\n}\n","var weakMemoize = function weakMemoize(func) {\n  // $FlowFixMe flow doesn't include all non-primitive types as allowed for weakmaps\n  var cache = new WeakMap();\n  return function (arg) {\n    if (cache.has(arg)) {\n      // $FlowFixMe\n      return cache.get(arg);\n    }\n\n    var ret = func(arg);\n    cache.set(arg, ret);\n    return ret;\n  };\n};\n\nexport { weakMemoize as default };\n","function memoize(fn) {\n  var cache = Object.create(null);\n  return function (arg) {\n    if (cache[arg] === undefined) cache[arg] = fn(arg);\n    return cache[arg];\n  };\n}\n\nexport { memoize as default };\n","import hashString from '@emotion/hash';\nimport unitless from '@emotion/unitless';\nimport memoize from '@emotion/memoize';\n\nvar ILLEGAL_ESCAPE_SEQUENCE_ERROR = \"You have illegal escape sequence in your template literal, most likely inside content's property value.\\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \\\"content: '\\\\00d7';\\\" should become \\\"content: '\\\\\\\\00d7';\\\".\\nYou can read more about this here:\\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences\";\nvar UNDEFINED_AS_OBJECT_KEY_ERROR = \"You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key).\";\nvar hyphenateRegex = /[A-Z]|^ms/g;\nvar animationRegex = /_EMO_([^_]+?)_([^]*?)_EMO_/g;\n\nvar isCustomProperty = function isCustomProperty(property) {\n  return property.charCodeAt(1) === 45;\n};\n\nvar isProcessableValue = function isProcessableValue(value) {\n  return value != null && typeof value !== 'boolean';\n};\n\nvar processStyleName = /* #__PURE__ */memoize(function (styleName) {\n  return isCustomProperty(styleName) ? styleName : styleName.replace(hyphenateRegex, '-$&').toLowerCase();\n});\n\nvar processStyleValue = function processStyleValue(key, value) {\n  switch (key) {\n    case 'animation':\n    case 'animationName':\n      {\n        if (typeof value === 'string') {\n          return value.replace(animationRegex, function (match, p1, p2) {\n            cursor = {\n              name: p1,\n              styles: p2,\n              next: cursor\n            };\n            return p1;\n          });\n        }\n      }\n  }\n\n  if (unitless[key] !== 1 && !isCustomProperty(key) && typeof value === 'number' && value !== 0) {\n    return value + 'px';\n  }\n\n  return value;\n};\n\nif (process.env.NODE_ENV !== 'production') {\n  var contentValuePattern = /(var|attr|counters?|url|element|(((repeating-)?(linear|radial))|conic)-gradient)\\(|(no-)?(open|close)-quote/;\n  var contentValues = ['normal', 'none', 'initial', 'inherit', 'unset'];\n  var oldProcessStyleValue = processStyleValue;\n  var msPattern = /^-ms-/;\n  var hyphenPattern = /-(.)/g;\n  var hyphenatedCache = {};\n\n  processStyleValue = function processStyleValue(key, value) {\n    if (key === 'content') {\n      if (typeof value !== 'string' || contentValues.indexOf(value) === -1 && !contentValuePattern.test(value) && (value.charAt(0) !== value.charAt(value.length - 1) || value.charAt(0) !== '\"' && value.charAt(0) !== \"'\")) {\n        throw new Error(\"You seem to be using a value for 'content' without quotes, try replacing it with `content: '\\\"\" + value + \"\\\"'`\");\n      }\n    }\n\n    var processed = oldProcessStyleValue(key, value);\n\n    if (processed !== '' && !isCustomProperty(key) && key.indexOf('-') !== -1 && hyphenatedCache[key] === undefined) {\n      hyphenatedCache[key] = true;\n      console.error(\"Using kebab-case for css properties in objects is not supported. Did you mean \" + key.replace(msPattern, 'ms-').replace(hyphenPattern, function (str, _char) {\n        return _char.toUpperCase();\n      }) + \"?\");\n    }\n\n    return processed;\n  };\n}\n\nvar noComponentSelectorMessage = 'Component selectors can only be used in conjunction with ' + '@emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware ' + 'compiler transform.';\n\nfunction handleInterpolation(mergedProps, registered, interpolation) {\n  if (interpolation == null) {\n    return '';\n  }\n\n  if (interpolation.__emotion_styles !== undefined) {\n    if (process.env.NODE_ENV !== 'production' && interpolation.toString() === 'NO_COMPONENT_SELECTOR') {\n      throw new Error(noComponentSelectorMessage);\n    }\n\n    return interpolation;\n  }\n\n  switch (typeof interpolation) {\n    case 'boolean':\n      {\n        return '';\n      }\n\n    case 'object':\n      {\n        if (interpolation.anim === 1) {\n          cursor = {\n            name: interpolation.name,\n            styles: interpolation.styles,\n            next: cursor\n          };\n          return interpolation.name;\n        }\n\n        if (interpolation.styles !== undefined) {\n          var next = interpolation.next;\n\n          if (next !== undefined) {\n            // not the most efficient thing ever but this is a pretty rare case\n            // and there will be very few iterations of this generally\n            while (next !== undefined) {\n              cursor = {\n                name: next.name,\n                styles: next.styles,\n                next: cursor\n              };\n              next = next.next;\n            }\n          }\n\n          var styles = interpolation.styles + \";\";\n\n          if (process.env.NODE_ENV !== 'production' && interpolation.map !== undefined) {\n            styles += interpolation.map;\n          }\n\n          return styles;\n        }\n\n        return createStringFromObject(mergedProps, registered, interpolation);\n      }\n\n    case 'function':\n      {\n        if (mergedProps !== undefined) {\n          var previousCursor = cursor;\n          var result = interpolation(mergedProps);\n          cursor = previousCursor;\n          return handleInterpolation(mergedProps, registered, result);\n        } else if (process.env.NODE_ENV !== 'production') {\n          console.error('Functions that are interpolated in css calls will be stringified.\\n' + 'If you want to have a css call based on props, create a function that returns a css call like this\\n' + 'let dynamicStyle = (props) => css`color: ${props.color}`\\n' + 'It can be called directly with props or interpolated in a styled call like this\\n' + \"let SomeComponent = styled('div')`${dynamicStyle}`\");\n        }\n\n        break;\n      }\n\n    case 'string':\n      if (process.env.NODE_ENV !== 'production') {\n        var matched = [];\n        var replaced = interpolation.replace(animationRegex, function (match, p1, p2) {\n          var fakeVarName = \"animation\" + matched.length;\n          matched.push(\"const \" + fakeVarName + \" = keyframes`\" + p2.replace(/^@keyframes animation-\\w+/, '') + \"`\");\n          return \"${\" + fakeVarName + \"}\";\n        });\n\n        if (matched.length) {\n          console.error('`keyframes` output got interpolated into plain string, please wrap it with `css`.\\n\\n' + 'Instead of doing this:\\n\\n' + [].concat(matched, [\"`\" + replaced + \"`\"]).join('\\n') + '\\n\\nYou should wrap it with `css` like this:\\n\\n' + (\"css`\" + replaced + \"`\"));\n        }\n      }\n\n      break;\n  } // finalize string values (regular strings and functions interpolated into css calls)\n\n\n  if (registered == null) {\n    return interpolation;\n  }\n\n  var cached = registered[interpolation];\n  return cached !== undefined ? cached : interpolation;\n}\n\nfunction createStringFromObject(mergedProps, registered, obj) {\n  var string = '';\n\n  if (Array.isArray(obj)) {\n    for (var i = 0; i < obj.length; i++) {\n      string += handleInterpolation(mergedProps, registered, obj[i]) + \";\";\n    }\n  } else {\n    for (var _key in obj) {\n      var value = obj[_key];\n\n      if (typeof value !== 'object') {\n        if (registered != null && registered[value] !== undefined) {\n          string += _key + \"{\" + registered[value] + \"}\";\n        } else if (isProcessableValue(value)) {\n          string += processStyleName(_key) + \":\" + processStyleValue(_key, value) + \";\";\n        }\n      } else {\n        if (_key === 'NO_COMPONENT_SELECTOR' && process.env.NODE_ENV !== 'production') {\n          throw new Error(noComponentSelectorMessage);\n        }\n\n        if (Array.isArray(value) && typeof value[0] === 'string' && (registered == null || registered[value[0]] === undefined)) {\n          for (var _i = 0; _i < value.length; _i++) {\n            if (isProcessableValue(value[_i])) {\n              string += processStyleName(_key) + \":\" + processStyleValue(_key, value[_i]) + \";\";\n            }\n          }\n        } else {\n          var interpolated = handleInterpolation(mergedProps, registered, value);\n\n          switch (_key) {\n            case 'animation':\n            case 'animationName':\n              {\n                string += processStyleName(_key) + \":\" + interpolated + \";\";\n                break;\n              }\n\n            default:\n              {\n                if (process.env.NODE_ENV !== 'production' && _key === 'undefined') {\n                  console.error(UNDEFINED_AS_OBJECT_KEY_ERROR);\n                }\n\n                string += _key + \"{\" + interpolated + \"}\";\n              }\n          }\n        }\n      }\n    }\n  }\n\n  return string;\n}\n\nvar labelPattern = /label:\\s*([^\\s;\\n{]+)\\s*(;|$)/g;\nvar sourceMapPattern;\n\nif (process.env.NODE_ENV !== 'production') {\n  sourceMapPattern = /\\/\\*#\\ssourceMappingURL=data:application\\/json;\\S+\\s+\\*\\//g;\n} // this is the cursor for keyframes\n// keyframes are stored on the SerializedStyles object as a linked list\n\n\nvar cursor;\nvar serializeStyles = function serializeStyles(args, registered, mergedProps) {\n  if (args.length === 1 && typeof args[0] === 'object' && args[0] !== null && args[0].styles !== undefined) {\n    return args[0];\n  }\n\n  var stringMode = true;\n  var styles = '';\n  cursor = undefined;\n  var strings = args[0];\n\n  if (strings == null || strings.raw === undefined) {\n    stringMode = false;\n    styles += handleInterpolation(mergedProps, registered, strings);\n  } else {\n    if (process.env.NODE_ENV !== 'production' && strings[0] === undefined) {\n      console.error(ILLEGAL_ESCAPE_SEQUENCE_ERROR);\n    }\n\n    styles += strings[0];\n  } // we start at 1 since we've already handled the first arg\n\n\n  for (var i = 1; i < args.length; i++) {\n    styles += handleInterpolation(mergedProps, registered, args[i]);\n\n    if (stringMode) {\n      if (process.env.NODE_ENV !== 'production' && strings[i] === undefined) {\n        console.error(ILLEGAL_ESCAPE_SEQUENCE_ERROR);\n      }\n\n      styles += strings[i];\n    }\n  }\n\n  var sourceMap;\n\n  if (process.env.NODE_ENV !== 'production') {\n    styles = styles.replace(sourceMapPattern, function (match) {\n      sourceMap = match;\n      return '';\n    });\n  } // using a global regex with .exec is stateful so lastIndex has to be reset each time\n\n\n  labelPattern.lastIndex = 0;\n  var identifierName = '';\n  var match; // https://esbench.com/bench/5b809c2cf2949800a0f61fb5\n\n  while ((match = labelPattern.exec(styles)) !== null) {\n    identifierName += '-' + // $FlowFixMe we know it's not null\n    match[1];\n  }\n\n  var name = hashString(styles) + identifierName;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // $FlowFixMe SerializedStyles type doesn't have toString property (and we don't want to add it)\n    return {\n      name: name,\n      styles: styles,\n      map: sourceMap,\n      next: cursor,\n      toString: function toString() {\n        return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";\n      }\n    };\n  }\n\n  return {\n    name: name,\n    styles: styles,\n    next: cursor\n  };\n};\n\nexport { serializeStyles };\n","/* eslint-disable */\n// Inspired by https://github.com/garycourt/murmurhash-js\n// Ported from https://github.com/aappleby/smhasher/blob/61a0530f28277f2e850bfc39600ce61d02b518de/src/MurmurHash2.cpp#L37-L86\nfunction murmur2(str) {\n  // 'm' and 'r' are mixing constants generated offline.\n  // They're not really 'magic', they just happen to work well.\n  // const m = 0x5bd1e995;\n  // const r = 24;\n  // Initialize the hash\n  var h = 0; // Mix 4 bytes at a time into the hash\n\n  var k,\n      i = 0,\n      len = str.length;\n\n  for (; len >= 4; ++i, len -= 4) {\n    k = str.charCodeAt(i) & 0xff | (str.charCodeAt(++i) & 0xff) << 8 | (str.charCodeAt(++i) & 0xff) << 16 | (str.charCodeAt(++i) & 0xff) << 24;\n    k =\n    /* Math.imul(k, m): */\n    (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16);\n    k ^=\n    /* k >>> r: */\n    k >>> 24;\n    h =\n    /* Math.imul(k, m): */\n    (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16) ^\n    /* Math.imul(h, m): */\n    (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  } // Handle the last few bytes of the input array\n\n\n  switch (len) {\n    case 3:\n      h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n\n    case 2:\n      h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n\n    case 1:\n      h ^= str.charCodeAt(i) & 0xff;\n      h =\n      /* Math.imul(h, m): */\n      (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  } // Do a few final mixes of the hash to ensure the last few\n  // bytes are well-incorporated.\n\n\n  h ^= h >>> 13;\n  h =\n  /* Math.imul(h, m): */\n  (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  return ((h ^ h >>> 15) >>> 0).toString(36);\n}\n\nexport { murmur2 as default };\n","var unitlessKeys = {\n  animationIterationCount: 1,\n  aspectRatio: 1,\n  borderImageOutset: 1,\n  borderImageSlice: 1,\n  borderImageWidth: 1,\n  boxFlex: 1,\n  boxFlexGroup: 1,\n  boxOrdinalGroup: 1,\n  columnCount: 1,\n  columns: 1,\n  flex: 1,\n  flexGrow: 1,\n  flexPositive: 1,\n  flexShrink: 1,\n  flexNegative: 1,\n  flexOrder: 1,\n  gridRow: 1,\n  gridRowEnd: 1,\n  gridRowSpan: 1,\n  gridRowStart: 1,\n  gridColumn: 1,\n  gridColumnEnd: 1,\n  gridColumnSpan: 1,\n  gridColumnStart: 1,\n  msGridRow: 1,\n  msGridRowSpan: 1,\n  msGridColumn: 1,\n  msGridColumnSpan: 1,\n  fontWeight: 1,\n  lineHeight: 1,\n  opacity: 1,\n  order: 1,\n  orphans: 1,\n  tabSize: 1,\n  widows: 1,\n  zIndex: 1,\n  zoom: 1,\n  WebkitLineClamp: 1,\n  // SVG-related properties\n  fillOpacity: 1,\n  floodOpacity: 1,\n  stopOpacity: 1,\n  strokeDasharray: 1,\n  strokeDashoffset: 1,\n  strokeMiterlimit: 1,\n  strokeOpacity: 1,\n  strokeWidth: 1\n};\n\nexport { unitlessKeys as default };\n","var isBrowser = \"object\" !== 'undefined';\nfunction getRegisteredStyles(registered, registeredStyles, classNames) {\n  var rawClassName = '';\n  classNames.split(' ').forEach(function (className) {\n    if (registered[className] !== undefined) {\n      registeredStyles.push(registered[className] + \";\");\n    } else {\n      rawClassName += className + \" \";\n    }\n  });\n  return rawClassName;\n}\nvar registerStyles = function registerStyles(cache, serialized, isStringTag) {\n  var className = cache.key + \"-\" + serialized.name;\n\n  if ( // we only need to add the styles to the registered cache if the\n  // class name could be used further down\n  // the tree but if it's a string tag, we know it won't\n  // so we don't have to add it to registered cache.\n  // this improves memory usage since we can avoid storing the whole style string\n  (isStringTag === false || // we need to always store it if we're in compat mode and\n  // in node since emotion-server relies on whether a style is in\n  // the registered cache to know whether a style is global or not\n  // also, note that this check will be dead code eliminated in the browser\n  isBrowser === false ) && cache.registered[className] === undefined) {\n    cache.registered[className] = serialized.styles;\n  }\n};\nvar insertStyles = function insertStyles(cache, serialized, isStringTag) {\n  registerStyles(cache, serialized, isStringTag);\n  var className = cache.key + \"-\" + serialized.name;\n\n  if (cache.inserted[serialized.name] === undefined) {\n    var current = serialized;\n\n    do {\n      cache.insert(serialized === current ? \".\" + className : '', current, cache.sheet, true);\n\n      current = current.next;\n    } while (current !== undefined);\n  }\n};\n\nexport { getRegisteredStyles, insertStyles, registerStyles };\n","import {BB} from '../../../bb/bb';\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport eyedropperImg from '/src/app/img/ui/tool-picker.svg';\nimport {LANG} from '../../../language/language';\nimport {IRGB} from '../../kl-types';\nimport {HSV, RGB} from '../../../bb/color/color';\nimport {ERASE_COLOR} from '../../brushes/erase-color';\n\n/**\n * big main HS+V color slider\n * 2 elements: slider, and colorpreview(output) + eyedropper\n */\nexport class KlColorSlider {\n\n    private readonly rootEl: HTMLElement;\n    private readonly outputDiv: HTMLElement;\n    private readonly divPreview: HTMLElement;\n    private readonly hexButton: HTMLElement;\n    private readonly secondaryColorBtn: HTMLElement;\n    private primaryColorRGB: RGB;\n    private primaryColorHSV: HSV;\n    private secondaryColorRGB: RGB;\n    private secondaryColorHSV: HSV;\n    private readonly controlH: HTMLElement;\n    private pickCallback: undefined | ((b: boolean) => void);\n    private isPicking: boolean;\n    private readonly pickerButton: HTMLElement;\n    private readonly width: number;\n    private readonly height: number; // hue slider and output height\n    private readonly hueStop: Element;\n\n    private readonly SVContainer: HTMLElement;\n    private readonly pointerSV: HTMLElement;\n    private svHeight: number;\n    private readonly svSvg: HTMLElement;\n\n    private readonly emitColor: (rgb: RGB) => void;\n\n\n\n    private updatePrimaryHSV (hsv: HSV): void {\n        if (hsv.s === 0) {\n            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\n        } else {\n            this.primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\n        }\n    }\n\n    private updateSVCanvas (): void {\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHSV.h, 100, 100));\n        BB.setAttributes(this.hueStop, {\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb),\n        });\n    }\n\n    private updateSVPointer (): void {\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\n        BB.css(this.pointerSV, {\n            left: left + 'px',\n            top: top + 'px',\n        });\n    }\n\n    private setColPreview (): void {\n        this.divPreview.style.backgroundColor = 'rgb(' + this.primaryColorRGB.r + ',' + this.primaryColorRGB.g + ',' + this.primaryColorRGB.b + ')';\n\n        if (BB.testIsWhiteBestContrast(this.primaryColorRGB)) {\n            BB.css(this.pickerButton, {\n                filter: 'invert(1)',\n            });\n            BB.css(this.hexButton, {\n                filter: 'invert(1)',\n            });\n        } else{\n            BB.css(this.pickerButton, {\n                filter: '',\n            });\n            BB.css(this.hexButton, {\n                filter: '',\n            });\n        }\n\n    }\n\n    private updateSecondaryColor (): void {\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(this.secondaryColorRGB);\n    }\n\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number; // hue slider and output height\n            svHeight: number;\n            startValue: IRGB; // 0-255\n            onPick: (rgb: IRGB) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'kl-color-picker',\n            css: {\n                position: 'relative',\n            },\n        });\n        this.outputDiv = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        this.width = p.width;\n        this.svHeight = p.svHeight;\n        this.height = p.height;\n        this.emitColor = p.onPick;\n\n        this.primaryColorRGB = {\n            r: parseInt('' + p.startValue.r),\n            g: parseInt('' + p.startValue.g),\n            b: parseInt('' + p.startValue.b),\n        };\n        this.primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\n        this.secondaryColorRGB = {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR};\n        this.secondaryColorHSV = BB.ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\n\n        const svWrapper = BB.el();\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', 'image/svg+xml').documentElement;\n        {\n            const hueStop = this.svSvg.querySelector('#hue-stop');\n            if (!hueStop) {\n                throw Error('#hue-stop not found in svSvg');\n            }\n            this.hueStop = hueStop;\n        }\n        BB.setAttributes(this.hueStop, {\n            'stop-color': '#f0f',\n        });\n        BB.css(this.svSvg, {\n            width: this.width + 'px',\n            height: this.svHeight + 'px',\n        });\n        svWrapper.append(this.svSvg);\n\n        const divH = BB.el({\n            className: 'kl-color-picker__h',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.width + 'px',\n                height: this.height + 'px',\n                cursor: 'ew-resize',\n                marginTop: '1px',\n                marginBottom: '1px',\n            },\n        });\n        this.divPreview = BB.el({\n            className: 'kl-color-picker__preview',\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                width: (this.height * 2.5) + 'px',\n                height: this.height + 'px',\n            },\n        });\n        this.controlH = BB.el();\n\n\n\n        const createHueBg = (targetEl: HTMLElement) => {\n            const im = new Image();\n            BB.css(im, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                display: 'none',\n                pointerEvents: 'none',\n            });\n            const cv = BB.canvas(this.width, this.height);\n            const ctx = BB.ctx(cv);\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\n            for (let i = 0; i < 1; i += 0.01) {\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n                let ha = (parseInt('' + col.r)).toString(16);\n                let hb = (parseInt('' + col.g)).toString(16);\n                let hc = (parseInt('' + col.b)).toString(16);\n                if (ha.length === 1) {\n                    ha = '0' + ha;\n                }\n                if (hb.length === 1) {\n                    hb = '0' + hb;\n                }\n                if (hc.length === 1) {\n                    hc = '0' + hc;\n                }\n                gradH.addColorStop(i, '#' + ha + hb + hc);\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, this.width, this.height);\n\n            targetEl.append(im);\n            im.alt = 'hue';\n            im.src = cv.toDataURL('image/png');\n            im.style.display = 'block';\n        };\n\n\n\n\n\n\n\n\n        this.updateSVCanvas();\n        this.rootEl.style.width = this.width + 'px';\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n\n        this.SVContainer = BB.el({\n            className: 'kl-color-picker__sv',\n            css: {\n                width: this.width + 'px',\n                height: this.svHeight + 'px',\n                overflow: 'hidden',\n                display: 'block',\n                position: 'relative',\n                cursor: 'crosshair',\n            },\n        });\n\n        this.pointerSV = BB.el({\n           css: {\n               width: '12px',\n               height: '12px',\n               borderRadius: '6px',\n               position: 'absolute',\n               pointerEvents: 'none',\n               boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\n           },\n        });\n\n        this.SVContainer.append(svWrapper, this.pointerSV);\n        this.updateSVPointer();\n        this.rootEl.append(this.SVContainer, divH);\n        this.outputDiv.append(this.divPreview);\n\n        //divH.className = \"svSlider\";\n        BB.css(this.controlH, {\n            width: '1px',\n            height: this.height + 'px',\n            background: '#000',\n            borderLeft: '1px solid #fff',\n            position: 'absolute',\n            top: '0',\n            left: parseInt('' + (this.primaryColorHSV.h / 360 * this.width - 1)) + 'px',\n        });\n\n\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0,\n        };\n\n\n        this.pickerButton = BB.el({\n            title: LANG('eyedropper') + ' [Alt]',\n            className: 'color-picker-preview-button',\n            css: {\n                width: '30px',\n                height: '30px',\n                backgroundImage: 'url(' + eyedropperImg + ')',\n                backgroundRepeat:  'no-repeat',\n                backgroundSize: '70%',\n                backgroundPosition: 'center',\n            },\n            onClick: () => {\n                if (this.isPicking) {\n                    this.pickCallback && this.pickCallback(false);\n                    this.pickingDone();\n                } else {\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\n                    this.isPicking = true;\n                    this.pickCallback && this.pickCallback(true);\n                }\n            },\n        });\n        this.isPicking = false;\n\n        const pickerButtonPointerListener = new BB.PointerListener({\n            target: this.pickerButton,\n            onEnterLeave: (isOver) => {\n                if (this.isPicking) {\n                    return;\n                }\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\n            },\n        });\n        this.divPreview.append(this.pickerButton);\n\n\n        this.hexButton = BB.el({\n            content: '#',\n            className: 'color-picker-preview-button',\n            title: LANG('manual-color-input'),\n            css: {\n                height: '100%',\n                width: this.height + 'px',\n                lineHeight: this.height + 'px',\n                fontSize: (this.height * 0.65) + 'px',\n            },\n            onClick: () => {\n                new HexColorDialog({\n                    color: new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\n                    onClose: (rgbObj) => {\n                        if (!rgbObj) {\n                            return;\n                        }\n                        this.setColor(rgbObj);\n                        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n                    },\n                });\n            },\n        });\n        const hexButtonPointerListener = new BB.PointerListener({\n            target: this.hexButton,\n            onEnterLeave: (isOver) => {\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\n            },\n        });\n        this.divPreview.append(this.hexButton);\n\n        this.setColPreview();\n\n\n        setTimeout(() => {\n            createHueBg(divH);\n            divH.append(this.controlH);\n            const svPointerListener = new BB.PointerListener({\n                target: svWrapper,\n                fixScribble: true,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n\n                        // prevent manual slider input keeping focus on iPad\n                        BB.unfocusAnyInput();\n\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\n\n                        if (event.button === 'left') {\n\n                            virtualHSV.s = event.relX / this.width * 100;\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\n\n                            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n\n                            this.updateSVPointer();\n                            this.setColPreview();\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n                        } else {\n                            virtualHSV.s = this.primaryColorHSV.s;\n                            virtualHSV.v = this.primaryColorHSV.v;\n                        }\n                    }\n\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n\n                        let factor = 1;\n                        if (event.button === 'right') {\n                            factor = 0.5;\n                        }\n\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\n\n                        this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n                        this.updateSVPointer();\n                        this.setColPreview();\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n\n                    }\n\n                    if (event.type === 'pointerup') {\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\n                    }\n\n                },\n            });\n            const hPointerListener = new BB.PointerListener({\n                target: divH,\n                fixScribble: true,\n                onPointer: (event) => {\n\n                    if (event.type === 'pointerdown') {\n\n                        // prevent manual slider input keeping focus on iPad\n                        BB.unfocusAnyInput();\n\n                        divH.classList.toggle('kl-color-picker--active', true);\n\n                        if (event.button === 'left') {\n\n                            virtualHSV.h = event.relX / this.width * 359.99;\n\n                            this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n                            this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\n                            this.updateSVCanvas();\n                            this.setColPreview();\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n                        } else {\n                            virtualHSV.h = this.primaryColorHSV.h;\n                        }\n                    }\n\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n\n                        const deltaY = Math.abs(event.pageY - event.downPageY!);\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\n\n                        if (event.button === 'right') {\n                            virtualHSV.h = virtualHSV.h % 359.99;\n                            if (virtualHSV.h < 0) {\n                                virtualHSV.h += 359.99;\n                            }\n                        }\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                        this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n                        this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\n                        this.updateSVCanvas();\n                        this.setColPreview();\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n\n                    }\n\n                    if (event.type === 'pointerup') {\n                        divH.classList.toggle('kl-color-picker--active', false);\n                    }\n                },\n            });\n        }, 1);\n\n\n        // --- secondary color ---\n\n        this.secondaryColorBtn = BB.el({\n            parent: this.outputDiv,\n            title: LANG('secondary-color') + ' [X]',\n            className: 'kl-color-picker__secondary',\n            css: {\n                cursor: 'pointer',\n                marginLeft: '5px',\n                width: '22px',\n                height: '22px',\n            },\n            onClick: (e) => {\n                e.preventDefault();\n                this.swapColors();\n            },\n        });\n        this.updateSecondaryColor();\n    }\n\n    setColor (c: IRGB): void {\n        this.primaryColorRGB = {r: parseInt('' + c.r), g: parseInt('' + c.g), b: parseInt('' + c.b)};\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n    }\n\n    getColor (): RGB {\n        return new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\n    }\n\n    getSecondaryRGB (): RGB {\n        return new BB.RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\n    }\n\n    setPickCallback (func: (b: boolean) => void): void {\n        this.pickCallback = func;\n    }\n\n    pickingDone (): void {\n        if (!this.isPicking) {\n            return;\n        }\n        this.isPicking = false;\n        this.pickerButton.classList.remove('color-picker-preview-button-active');\n    }\n\n    enable (e: boolean): void {\n        if (e) {\n            this.rootEl.style.pointerEvents = '';\n            this.rootEl.style.opacity = '1';\n            this.outputDiv.style.pointerEvents = '';\n            this.outputDiv.style.opacity = '1';\n        } else {\n            this.rootEl.style.pointerEvents = 'none';\n            this.rootEl.style.opacity = '0.5';\n            this.outputDiv.style.pointerEvents = 'none';\n            this.outputDiv.style.opacity = '0.5';\n        }\n    }\n\n    setHeight (h: number): void {\n        h = parseInt('' +(h - this.height * 2 - 3), 10);\n        if (h === this.svHeight) {\n            return;\n        }\n        this.svHeight = h;\n        BB.css(this.svSvg, {\n            width: this.width + 'px',\n            height: this.svHeight + 'px',\n        });\n        this.SVContainer.style.height = this.svHeight + 'px';\n        this.updateSVPointer();\n    }\n\n    swapColors (): void {\n        // swap hsv\n        let tmp: RGB | HSV = this.secondaryColorHSV;\n        this.secondaryColorHSV = this.primaryColorHSV;\n        this.updatePrimaryHSV(tmp);\n        // swap rgb\n        tmp = this.secondaryColorRGB;\n        this.secondaryColorRGB = this.primaryColorRGB;\n        this.primaryColorRGB = tmp;\n\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n        this.updateSecondaryColor();\n\n        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getOutputElement (): HTMLElement {\n        return this.outputDiv;\n    }\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-picker.78a99ccf.svg\" + \"?\" + Date.now();","import {theme} from '../../theme/theme';\n\nexport const ERASE_COLOR = theme.isDark() ? 255 : 255;","import {addIsDarkListener, isDark} from '../bb/base/base';\n\nconst LS_THEME_KEY = 'klecks-theme';\n\nexport type TTheme = 'dark' | 'light';\ntype TThemeListener = () => void;\n\nclass Theme {\n\n    private storedTheme: TTheme | undefined;\n    // initialization will be overwritten.\n    private mediaQueryTheme: TTheme = 'light'; // prefers-color-scheme\n    private theme: TTheme = 'light';\n    private readonly listeners: TThemeListener[] = [];\n\n    private updateTheme (): void {\n        const oldTheme = this.theme;\n        this.theme = this.storedTheme || this.mediaQueryTheme;\n\n        if (this.theme === oldTheme) {\n            return;\n        }\n        document.body.classList.toggle('kl-theme-dark', this.theme === 'dark');\n        this.listeners.forEach(item => item());\n    }\n\n    private readLocalStorage (): TTheme | undefined {\n        let result = localStorage.getItem(LS_THEME_KEY) as unknown;\n        if (!result || (typeof result === 'string' && !['dark', 'light'].includes(result))) {\n            result = undefined;\n            localStorage.removeItem(LS_THEME_KEY); // reset because invalid\n        }\n        return result as (TTheme | undefined);\n    }\n\n    // ---- public ----\n    constructor () {\n\n        // init media query\n        this.mediaQueryTheme = isDark() ? 'dark' : 'light';\n        addIsDarkListener(() => {\n            this.mediaQueryTheme = isDark() ? 'dark' : 'light';\n            this.updateTheme();\n        });\n\n        // init local storage\n        this.storedTheme = this.readLocalStorage();\n        addEventListener('storage', (e) => {\n            if (e.key === LS_THEME_KEY) {\n                this.storedTheme = this.readLocalStorage();\n                this.updateTheme();\n            }\n        });\n\n        this.updateTheme();\n    }\n\n    isDark (): boolean {\n        return this.theme === 'dark';\n    }\n\n    addIsDarkListener (func: TThemeListener): void {\n        if (this.listeners.includes(func)) {\n            return;\n        }\n        this.listeners.push(func);\n    }\n\n    removeIsDarkListener (func: TThemeListener): void {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (this.listeners[i] === func) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    getMediaQueryTheme (): TTheme {\n        return this.mediaQueryTheme;\n    }\n\n    getStoredTheme (): TTheme | undefined {\n        return this.storedTheme;\n    }\n\n    setStoredTheme (theme: TTheme | undefined): void {\n        if (theme) {\n            localStorage.setItem(LS_THEME_KEY, theme);\n        } else {\n            localStorage.removeItem(LS_THEME_KEY);\n        }\n        this.storedTheme = theme;\n        this.updateTheme();\n    }\n\n}\n\nexport const theme = new Theme();","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IRGB} from '../../kl-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {HSV} from '../../../bb/color/color';\n\n/**\n * a small color slider\n */\nexport class KlColorSliderSmall {\n\n    private readonly rootEl: HTMLElement;\n    private color: HSV;\n    private readonly svPointerListener: PointerListener;\n    private readonly hPointerListener: PointerListener;\n    private svPointerId: number | null;\n    private hPointerId: number | null;\n    private readonly width: number;\n    private readonly heightSV: number;\n    private readonly pointerSV: HTMLElement;\n    private readonly pointerH: HTMLElement;\n    private readonly canvasSV: HTMLCanvasElement;\n\n\n    private updateSV (): void {\n        const ctx = BB.ctx(this.canvasSV);\n        if(!ctx) {\n            throw new Error('couldnt create canvas');\n        }\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\n\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height * 100.0)));\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height * 100.0)));\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\n        }\n    }\n\n    private updateSVPointer (): void {\n        const left = this.color.s / 100 * this.width - 4;\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\n        BB.css(this.pointerSV, {\n            left: left + 'px',\n            top: top + 'px',\n        });\n    }\n\n    private updateHPointer (): void {\n        this.pointerH.style.left = (this.color.h / 359.999 * this.width - 1) + 'px';\n    }\n\n\n\n\n    // ----- public ----\n    constructor (\n        p: {\n            width: number;\n            heightSV: number; // height of saturation/value\n            heightH: number; // height of hue\n            color: IRGB;\n            callback: (c: IRGB) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                width: p.width + 'px',\n                position: 'relative',\n                overflow: 'hidden',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = (e) => {\n            e.preventDefault();\n        };\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\n        this.width = p.width;\n        this.heightSV = p.heightSV;\n\n        this.canvasSV = BB.canvas(10, 10);\n        BB.css(this.canvasSV, {\n            width: this.width + 'px',\n            height: this.heightSV + 'px',\n            cursor: 'crosshair',\n        });\n\n\n        this.updateSV();\n\n        const canvasH = BB.canvas(p.width, p.heightH);\n        canvasH.style.cursor = 'ew-resize';\n        (() => {\n            const ctx = BB.ctx(canvasH);\n\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\n            for (let i = 0; i < 1; i += 0.01) {\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n                gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, p.width, p.heightH);\n\n        })();\n        BB.css(this.canvasSV, {\n            width: p.width + 'px',\n            height: p.heightSV + 'px',\n            overflow: 'hidden',\n            position: 'relative',\n        });\n        this.canvasSV.style.cssFloat = 'left';\n        canvasH.style.cssFloat = 'left';\n\n        this.rootEl.append(this.canvasSV, canvasH);\n\n        this.pointerSV = BB.el({\n            parent: this.rootEl,\n            css: {\n                width: '8px',\n                height: '8px',\n                borderRadius: '8px',\n                position: 'absolute',\n                pointerEvents: 'none',\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\n            },\n        });\n\n        this.pointerH = BB.el({\n            parent: this.rootEl,\n            css: {\n                width: '0',\n                height: p.heightH + 'px',\n                borderLeft: '1px solid #fff',\n                borderRight: '1px solid #000',\n                position: 'absolute',\n                top: p.heightSV + 'px',\n                pointerEvents: 'none',\n            },\n        });\n\n        this.updateSVPointer();\n        this.updateHPointer();\n\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0,\n        };\n\n        this.svPointerId = null;\n        this.svPointerListener = new BB.PointerListener({\n            target: this.canvasSV,\n            fixScribble: true,\n            onPointer: (event) => {\n\n                if (event.type === 'pointerdown') {\n\n                    // prevent manual slider input keeping focus on iPad\n                    BB.unfocusAnyInput();\n\n                    this.svPointerId = event.pointerId;\n                    if (event.button === 'left') {\n\n                        virtualHSV.s = event.relX / p.width * 100;\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\n\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n\n                        this.updateSVPointer();\n                        p.callback(BB.ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.s = this.color.s;\n                        virtualHSV.v = this.color.v;\n                    }\n                }\n\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.svPointerId === event.pointerId) {\n\n                    let factor = 1;\n                    if (event.button === 'right') {\n                        factor = 0.5;\n                    }\n\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\n\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n                    this.updateSVPointer();\n                    p.callback(BB.ColorConverter.toRGB(this.color));\n\n                }\n                if (event.type === 'pointerup') {\n                    this.svPointerId = null;\n                }\n\n            },\n        });\n\n        this.hPointerId = null;\n        this.hPointerListener = new BB.PointerListener({\n            target: canvasH,\n            fixScribble: true,\n            onPointer: (event) => {\n\n                if (event.type === 'pointerdown') {\n                    this.hPointerId = event.pointerId;\n                    if (event.button === 'left') {\n\n                        virtualHSV.h = event.relX / p.width * 359.99;\n\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\n                        this.updateSV();\n                        this.updateHPointer();\n                        p.callback(BB.ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.h = this.color.h;\n                    }\n                }\n\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.hPointerId === event.pointerId) {\n\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\n\n                    if (event.button === 'right') {\n                        virtualHSV.h = virtualHSV.h % 359.99;\n                        if (virtualHSV.h < 0) {\n                            virtualHSV.h += 359.99;\n                        }\n                    }\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\n                    this.updateSV();\n                    this.updateHPointer();\n                    p.callback(BB.ColorConverter.toRGB(this.color));\n\n                }\n                if (event.type === 'pointerup') {\n                    this.hPointerId = null;\n                }\n            },\n        });\n\n\n        const cleardiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                clear: 'both',\n            },\n        });\n    }\n\n    // ---- interface ----\n    setColor (c: IRGB): void {\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\n        this.updateSV();\n        this.updateSVPointer();\n        this.updateHPointer();\n    }\n\n    getColor (): IRGB {\n        return BB.ColorConverter.toRGB(this.color);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.svPointerListener.destroy();\n        this.hPointerListener.destroy();\n    }\n\n    end (): void {\n        this.svPointerId = null;\n        this.hPointerId = null;\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n/**\n * A slider that looks like this\n * ------O----\n */\nexport class PointSlider {\n\n    private readonly rootEl: HTMLElement;\n    private readonly sliderPoint: HTMLElement;\n    private readonly pointerListener: PointerListener;\n\n    // ---- public ----\n    constructor (\n        p: {\n            init: number;\n            width: number;\n            pointSize: number;\n            callback: (value: number, isFirst: boolean, isLast: boolean) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n            },\n        });\n        const sliderLine = BB.el({\n            parent: this.rootEl,\n            className: 'kl-point-slider__line',\n            css: {\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\n                width: p.width + 'px',\n            },\n        });\n        this.sliderPoint = BB.el({\n            parent: this.rootEl,\n            className: 'kl-point-slider__point',\n        });\n        let sliderPos: number;\n        let isDragging = false;\n\n        //sliderPoint\n        const touchAreaEl = BB.el({ // expand clickable area\n            parent: this.sliderPoint,\n            css: {\n                // background: 'rgba(255,0,0,0.4)',\n                margin: '-7px 0 0 -7px',\n                width: 'calc(100% + 14px)',\n                height: 'calc(100% + 7px)',\n            },\n        });\n\n        const redrawPoint = () => {\n            BB.css(this.sliderPoint, {\n                left: sliderPos + 'px',\n            });\n        };\n        const getValue = () => {\n            return sliderPos /  (p.width - p.pointSize);\n        };\n\n        {\n            let isFirst: boolean;\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\n            BB.css(this.sliderPoint, {\n                width: p.pointSize + 'px',\n                height: p.pointSize + 'px',\n                borderRadius: p.pointSize + 'px',\n            });\n            redrawPoint();\n            let imaginaryPos: number;\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderPoint,\n                fixScribble: true,\n                onPointer: (event): void => {\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        isFirst = true;\n                        isDragging = true;\n                        imaginaryPos = sliderPos;\n                        redrawPoint();\n                        event.eventStopPropagation();\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\n                        event.eventStopPropagation();\n                        imaginaryPos = imaginaryPos + event.dX;\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\n                        redrawPoint();\n                        p.callback(getValue(), isFirst, false);\n                        isFirst = false;\n                    }\n                    if (event.type === 'pointerup') {\n                        event.eventStopPropagation();\n                        isDragging = false;\n                        redrawPoint();\n                        p.callback(getValue(), false, true);\n                    }\n                },\n            });\n        }\n    }\n\n    // ---- interface ----\n\n    getEl (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setActive (isActive: boolean): void {\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\n    }\n\n    destroy (): void {\n        this.pointerListener.destroy();\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {IRGBA} from '../../kl-types';\nimport {theme} from '../../../theme/theme';\nimport {ColorConverter} from '../../../bb/color/color';\nimport {c} from '../../../bb/base/c';\n\n/**\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\n * Can't deal with 0.5 alpha.\n * Rectangular buttons.\n */\nexport class ColorOptions {\n\n    private readonly rootEl: HTMLElement;\n    private readonly buttonArr: {\n        el: HTMLElement;\n        setIsSelected: (b: boolean) => void;\n    }[];\n    private readonly colorArr: (IRGBA | null)[] = [];\n    private selectedIndex: number = 0;\n    private colorInput: HTMLInputElement;\n\n    private readonly updateCheckerboard: () => void;\n    private readonly onColorInputChange: () => void;\n\n    // ---- public ----\n    constructor (\n        p: {\n            colorArr: (IRGBA | null)[]; // duplicates will be removed\n            onChange: (rgbaObj: IRGBA | null) => void;\n            label?: string;\n            initialIndex?: number; // index before duplicates were removed\n            title?: string;\n        }\n    ) {\n        this.rootEl = BB.el({\n            content: p.label ? p.label : '',\n            title: p.title ?? undefined,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: '7px',\n            },\n        });\n\n        this.buttonArr = [];\n        const buttonSize = 22;\n        const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\n\n        this.onColorInputChange = () => {\n            const i = this.selectedIndex;\n            const color = this.colorArr[i];\n            if (!color || color.a < 1) {\n                // ignore\n                return;\n            }\n\n            const newRawColor = this.colorInput.value;\n            this.buttonArr[this.selectedIndex].el.style.backgroundColor = newRawColor;\n            this.colorArr[i] = {\n                ...ColorConverter.hexToRGB(newRawColor)!,\n                a: 1,\n            };\n            p.onChange(this.colorArr[i]);\n        };\n        this.colorInput = BB.el({\n            tagName: 'input',\n            custom: {\n                type: 'color',\n                tabIndex: '-1',\n            },\n        });\n        this.colorInput.onchange = this.onColorInputChange;\n        this.colorInput.oninput = this.onColorInputChange;\n\n        // build colorArr while removing duplicates\n        for (let i = 0; i < p.colorArr.length; i++) {\n            const item = p.colorArr[i];\n            let found = false;\n            for (let e = 0; e < this.colorArr.length; e++) {\n                const sItem = this.colorArr[e];\n                if (sItem === item) {\n                    found = true;\n                    break;\n                }\n                if (sItem === null || item === null) {\n                    continue;\n                }\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) {\n                continue;\n            }\n            this.colorArr.push(item);\n            if ('initialIndex' in p && p.initialIndex === i) {\n                this.selectedIndex = this.colorArr.length - 1;\n            }\n        }\n\n        for (let i = 0; i < this.colorArr.length; i++) {\n            ((i) => {\n                const color = this.colorArr[i];\n\n                const colorButton = BB.el({\n                    parent: this.rootEl,\n                    content: color ? '' : 'X',\n                    className: 'kl-color-option',\n                    css: {\n                        width: buttonSize + 'px',\n                        height: buttonSize + 'px',\n                        backgroundColor: color ? BB.ColorConverter.toRgbaStr(color) : 'transparent',\n                        lineHeight: (buttonSize + 1) + 'px',\n                    },\n                    onClick: (e) => {\n                        if (this.selectedIndex === i) {\n                            if (color && color.a === 1) {\n                                this.colorInput.showPicker ? this.colorInput.showPicker() : this.colorInput.click();\n                            }\n                            return;\n                        }\n\n                        e.preventDefault();\n                        this.selectedIndex = i;\n                        update();\n                        p.onChange(this.colorArr[i]); // color may change\n                    },\n                });\n                if (color && color.a === 0) {\n                    colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\n                }\n\n                const setIsSelected = (b: boolean): void => {\n                    colorButton.classList.toggle('kl-color-option--active', b);\n                };\n\n                this.buttonArr.push({\n                    el: colorButton,\n                    setIsSelected,\n                });\n            })(i);\n        }\n\n        this.rootEl.append(c(',w-0,h-0,overflow-hidden', [this.colorInput]));\n\n\n        const update = () => {\n            for (let i = 0; i < this.buttonArr.length; i++) {\n                this.buttonArr[i].setIsSelected(i === this.selectedIndex);\n            }\n        };\n        update();\n\n        this.updateCheckerboard = (): void => {\n            const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\n            this.buttonArr.forEach((button, i) => {\n                const color = this.colorArr[i];\n                if (color && color.a === 0) {\n                    button.el.style.backgroundImage = 'url(' + checkerUrl + ')';\n                }\n            });\n        };\n        theme.addIsDarkListener(this.updateCheckerboard);\n    }\n\n    // ---- interface ----\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): IRGBA | null {\n        return this.colorArr[this.selectedIndex];\n    }\n\n    destroy (): void {\n        this.rootEl.remove();\n        this.buttonArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        this.buttonArr.splice(0, this.buttonArr.length);\n        theme.removeIsDarkListener(this.updateCheckerboard);\n        this.colorInput.onchange = null;\n        this.colorInput.oninput = null;\n    }\n\n}\n\n","import {BB} from '../../../bb/bb';\n\n/**\n * selectable options\n */\nexport class Options<IdType> {\n\n    private readonly rootEl: HTMLElement;\n    private selectedId: IdType;\n    private readonly optionArr: {\n        id: IdType;\n        el: HTMLElement;\n    }[];\n    private readonly onChange: ((id: IdType) => void) | undefined;\n\n    private getIndex (): number {\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if (this.optionArr[i].id === this.selectedId) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    private update (): void {\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.optionArr[i].el.classList.toggle(\n                'kl-option-selected',\n                this.optionArr[i].id === this.selectedId\n            );\n        }\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            optionArr: {\n                id: IdType;\n                label: string | HTMLElement | SVGElement;\n                title?: string;\n            }[];\n            initId?: IdType;\n            onChange?: (id: IdType) => void;\n            changeOnInit?: boolean; // trigger change on creation\n            isSmall? :boolean;\n        }\n    ) {\n        this.rootEl = BB.el();\n\n        const wrapperEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-option-wrapper',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.optionArr = [];\n        this.selectedId = ('initialId' in p && p.initId !== undefined) ? p.initId : p.optionArr[0].id;\n\n        const createOption = (o: {\n            id: IdType;\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n        }) => {\n\n            const classArr = ['kl-option'];\n            if (p.isSmall) {\n                classArr.push('kl-option--small');\n            }\n            if (typeof o.label !== 'string') {\n                classArr.push('kl-option--custom-el');\n                BB.css(o.label, {\n                    display: 'block',\n                    pointerEvents: 'none',\n                });\n            }\n\n            const optionObj = {\n                id: o.id,\n                el: BB.el({\n                    parent: wrapperEl,\n                    content: o.label,\n                    className: classArr.join(' '),\n                    onClick: () => {\n                        if (this.selectedId !== optionObj.id) {\n                            this.selectedId = optionObj.id;\n                            this.update();\n                            this.onChange && this.onChange(this.selectedId);\n                        }\n                    },\n                }),\n            };\n\n            if (o.title) {\n                optionObj.el.title = o.title;\n            }\n\n            this.optionArr.push(optionObj);\n        };\n\n        for (let i = 0; i < p.optionArr.length; i++) {\n            createOption(p.optionArr[i]);\n        }\n\n        this.update();\n\n        if (p.changeOnInit) {\n            setTimeout(() => {\n                this.onChange && this.onChange(this.selectedId);\n            }, 0);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): IdType {\n        return this.selectedId;\n    }\n\n    next (): void {\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n\n    previous (): void {\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n\n    destroy (): void {\n        this.rootEl.remove();\n        this.optionArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        this.optionArr.splice(0, this.optionArr.length);\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport angleSvg from '/src/app/img/ui/angle.svg';\n\n\ntype TUiState = 'left' | 'right';\n\n/**\n * display little messages at the top of KlWorkspace\n */\nexport class StatusOverlay {\n\n    private readonly el: HTMLDivElement;\n    private readonly innerEl: HTMLDivElement;\n    private readonly angleIm: HTMLImageElement;\n    private readonly innerInnerEl: HTMLDivElement;\n    private isWide: boolean = false; // tool space hidden\n    private uiState: TUiState = 'right';\n\n    private timeout: ReturnType<typeof setTimeout> | undefined;\n    private timeout2: ReturnType<typeof setTimeout> | undefined;\n    private timeout3: ReturnType<typeof setTimeout> | undefined;\n\n    private updateUiState () {\n        if (this.uiState === 'left') {\n            this.el.style.left = '271px';\n        } else {\n            this.el.style.removeProperty('left');\n        }\n    }\n\n\n    // --- public ---\n\n    constructor () {\n        this.el = BB.el({\n            className: 'top-overlay g-root',\n            onClick: BB.handleClick,\n        });\n\n        this.updateUiState();\n\n        this.innerEl = BB.el({\n            className: 'top-overlay--inner',\n        });\n\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleSvg;\n        BB.css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginLeft: '5px',\n            borderRadius: '10px',\n        });\n\n        this.innerInnerEl = document.createElement('div');\n        this.innerInnerEl.style.display = 'inline-block';\n\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\n        this.el.append(this.innerEl);\n        document.body.append(this.el);\n        this.el.style.display = 'none';\n    }\n\n    setWide (b: boolean) {\n        this.isWide = b;\n\n        if (!this.el) {\n            return;\n        }\n\n        if (this.isWide) {\n            this.el.style.width = '100%';\n            this.el.style.left = '';\n        } else {\n            this.el.style.removeProperty('width');\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\n        }\n    }\n\n    setUiState (state: TUiState) {\n        this.uiState = state;\n        this.updateUiState();\n    }\n\n    out (msg: string | {type: 'transform'; angleDeg: number; scale: number}, doPulse?: boolean) {\n\n        if (typeof msg === 'string') {\n            this.angleIm.style.display = 'none';\n            this.innerInnerEl.innerHTML = msg;\n        } else {\n            if (msg.type === 'transform') {\n                this.angleIm.style.display = 'inline-block';\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\n\n                if (msg.angleDeg % 90 === 0) {\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\n                } else {\n                    this.angleIm.style.boxShadow = '';\n                }\n\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\n\n\n            } else {\n                this.angleIm.style.display = 'none';\n            }\n        }\n\n        if (doPulse) {\n            this.innerEl.style.animation = '';\n            setTimeout(\n                () => this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out',\n                20\n            );\n            clearTimeout(this.timeout3);\n            this.timeout3 = setTimeout(\n                () => this.innerEl.style.animation = '',\n                520\n            );\n        }\n\n\n\n        clearTimeout(this.timeout);\n        clearTimeout(this.timeout2);\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\n        this.el.style.opacity = '1';\n        this.timeout = setTimeout(() => {\n            this.el.style.opacity = '0';\n            this.el.style.animationName = 'consoleOut';\n            this.timeout2 = setTimeout(() => {\n                this.el.style.display = 'none';\n            }, 450);\n        }, 1200);\n        this.el.style.display = 'flex';\n    }\n\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"angle.8be0f182.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {IRect, IVector2D} from '../../../bb/bb-types';\nimport {Preview, TPreviewMode} from '../project-viewport/preview';\nimport {applyToPoint, inverse} from 'transformation-matrix';\nimport {createTransformMatrix} from '../project-viewport/utils/create-transform-matrix';\nimport {clamp} from '../../../bb/math/math';\nimport {LANG} from '../../../language/language';\nimport editCropImg from '/src/app/img/ui/edit-crop.svg';\nimport {EventChain} from '../../../bb/input/event-chain/event-chain';\nimport {OnePointerLimiter} from '../../../bb/input/event-chain/one-pointer-limiter';\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\n\n\n/**\n * element that lets you crop an image and copy it via right click\n */\nexport class CropCopy {\n\n    private readonly rootEl: HTMLElement;\n    private readonly eventTarget: HTMLElement;\n    private crop: IRect = {x: 0, y: 0, width: 0, height: 0}; // canvas coordinates\n    private readonly croppedCanvas: HTMLCanvasElement;\n    private readonly croppedImage: undefined | HTMLImageElement; // isn't canvas enough?\n    private readonly keyListener: KeyListener;\n    private readonly pointerListener: PointerListener;\n    private readonly canvas: HTMLImageElement | HTMLCanvasElement;\n    private readonly onChange: undefined | ((width: number, height: number) => void);\n    private readonly selectionRectEl: HTMLElement;\n    private readonly preview: Preview;\n    private mode: TPreviewMode = 'edit';\n\n\n    private resetCrop (): void {\n        this.crop = {\n            x: 0,\n            y: 0,\n            width: this.canvas.width,\n            height: this.canvas.height,\n        };\n    }\n\n    private getViewportSelectionRect (): IRect {\n        const transform = this.preview.getTransform();\n        const mat = createTransformMatrix(transform);\n        const p = applyToPoint(mat, this.crop);\n        return {\n            x: p.x,\n            y: p.y,\n            width: this.crop.width * transform.scale,\n            height: this.crop.height * transform.scale,\n        };\n    }\n\n    private updateCroppedCanvas (): void {\n        this.croppedCanvas.width = Math.round(this.crop.width);\n        this.croppedCanvas.height = Math.round(this.crop.height);\n        const ctx = BB.ctx(this.croppedCanvas);\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\n        if (this.croppedImage) {\n            this.croppedImage.src = this.croppedCanvas.toDataURL('image/png');\n        }\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\n    }\n    private updateSelectionRect (): void {\n        const rect = this.getViewportSelectionRect();\n\n        BB.css(this.selectionRectEl, {\n            left: rect.x + 'px',\n            top: rect.y + 'px',\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n            display: this.isReset() ? 'none' : '',\n        });\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\n    }\n\n    // ---- public ----\n\n    constructor (\n        param: {\n            width: number;\n            height: number;\n            canvas: HTMLImageElement | HTMLCanvasElement;\n            isNotCopy: boolean;\n            onChange?: (width: number, height: number) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'kl-edit-crop-preview',\n            css: {\n                position: 'relative',\n                height: param.height + 'px',\n                width: param.width + 'px',\n                overflow: 'hidden',\n            },\n        });\n        if (param.onChange) {\n            this.onChange = param.onChange;\n        }\n        this.canvas = param.canvas;\n\n        this.resetCrop();\n\n\n\n\n        const isInsideSelectionRect = (p: IVector2D): boolean => {\n            return BB.isInsideRect(p, this.getViewportSelectionRect());\n        };\n\n        this.croppedCanvas = BB.canvas();\n        this.eventTarget = this.croppedCanvas;\n        if (!param.isNotCopy) {\n            this.croppedImage = new Image();\n            this.eventTarget = this.croppedImage;\n        }\n        BB.css(this.eventTarget, {\n            height: param.height + 'px',\n            width: param.width + 'px',\n        });\n        this.rootEl.append(this.eventTarget);\n        this.updateCroppedCanvas();\n\n        this.preview = new Preview({\n            width: param.width,\n            height: param.height - 2, // subtract border\n            project: {\n                width: param.canvas.width,\n                height: param.canvas.height,\n                layers: [{\n                    image: param.canvas,\n                    opacity: 1,\n                    isVisible: true,\n                    mixModeStr: 'source-over',\n                    hasClipping: false,\n                }],\n            },\n            hasEditMode: true,\n            onModeChange: (mode) => {\n                this.mode = mode;\n                this.preview.getElement().style.pointerEvents = mode === 'edit' ? 'none' : '';\n                this.rootEl.title = mode === 'edit' ? LANG('crop-drag-to-crop') : '';\n            },\n            onTransformChange: () => this.updateSelectionRect(),\n            padding: 20,\n            hasBorder: false,\n            editIcon: editCropImg,\n        });\n        BB.css(this.preview.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            overflow: 'hidden',\n            pointerEvents: 'none',\n        });\n        this.preview.render();\n        this.rootEl.append(this.preview.getElement());\n\n        this.selectionRectEl = BB.el({\n            parent: this.preview.getElement(),\n            className: 'kl-edit-crop-preview__sel',\n        });\n        this.updateSelectionRect();\n\n        //gen crop from viewport points\n        const genCrop = (p1: IVector2D, p2: IVector2D): IRect => {\n            const mat = createTransformMatrix(this.preview.getTransform());\n            const inverseMat = inverse(mat);\n            const topLeftP = {\n                x: Math.min(p1.x, p2.x),\n                y: Math.min(p1.y, p2.y),\n            };\n            const bottomRightP = {\n                x: Math.max(p1.x, p2.x),\n                y: Math.max(p1.y, p2.y),\n            };\n            const origTopLeftP = applyToPoint(inverseMat, topLeftP);\n            const origBottomRightP = applyToPoint(inverseMat, bottomRightP);\n            origTopLeftP.x = clamp(Math.floor(origTopLeftP.x), 0, this.canvas.width);\n            origTopLeftP.y = clamp(Math.floor(origTopLeftP.y), 0, this.canvas.height);\n            origBottomRightP.x = clamp(Math.ceil(origBottomRightP.x), 0, this.canvas.width);\n            origBottomRightP.y = clamp(Math.ceil(origBottomRightP.y), 0, this.canvas.height);\n            return {\n                x: origTopLeftP.x,\n                y: origTopLeftP.y,\n                width: origBottomRightP.x - origTopLeftP.x,\n                height: origBottomRightP.y - origTopLeftP.y,\n            };\n        };\n\n\n\n        let startP: IVector2D | null;\n        let startCrop: IRect | null = null;\n        let isDragging = false;\n        let didMove = false;\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\n        const pointerChain = new EventChain({\n            chainArr: [\n                new OnePointerLimiter() as IChainElement,\n            ],\n        });\n        pointerChain.setChainOut((event) => {\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY,\n                };\n                if (!this.isReset() && isInsideSelectionRect(startP)) {\n                    startCrop = {\n                        x: this.crop.x,\n                        y: this.crop.y,\n                        width: this.crop.width,\n                        height: this.crop.height,\n                    };\n                } else {\n                    this.crop = genCrop(startP, startP);\n                }\n            } else if (event.type === 'pointermove' && event.button === 'left') {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    const transform = this.preview.getTransform();\n                    this.crop.x = startCrop.x + Math.round((event.relX - startP!.x) / transform.scale);\n                    this.crop.y = startCrop.y + Math.round((event.relY - startP!.y) / transform.scale);\n                    this.crop.x = BB.clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\n                    this.crop.y = BB.clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\n                } else {\n                    this.crop = genCrop(startP!, {x: event.relX, y: event.relY});\n                }\n                this.updateSelectionRect();\n            } else if (event.type === 'pointerup' && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\n                    this.resetCrop();\n                    this.updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\n            }\n        });\n        this.pointerListener = new BB.PointerListener({\n            target: this.eventTarget,\n            fixScribble: true,\n            onWheel: (event) => {\n                this.preview.onWheel(event);\n            },\n            onPointer: (event) => {\n                if (this.mode === 'hand') {\n                    event.eventPreventDefault();\n                    this.preview.onPointer(event);\n                    return;\n                }\n                pointerChain.chainIn(event);\n            },\n            maxPointers: 2,\n        });\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, e) => {\n                if (isDragging) {\n                    return;\n                }\n                let doUpdate = false;\n                const transform = this.preview.getTransform();\n\n                const stepSize = Math.max(1, 1 / transform.scale);\n                const shiftIsPressed = this.keyListener.isPressed('shift');\n\n                if (keyStr === 'left') {\n                    if (shiftIsPressed) {\n                        this.crop.width = BB.clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\n                    } else {\n                        this.crop.x = BB.clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'right') {\n                    if (shiftIsPressed) {\n                        this.crop.width = BB.clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\n                    } else {\n                        this.crop.x = BB.clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'up') {\n                    if (shiftIsPressed) {\n                        this.crop.height = BB.clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\n                    } else {\n                        this.crop.y = BB.clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'down') {\n                    if (shiftIsPressed) {\n                        this.crop.height = BB.clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\n                    } else {\n                        this.crop.y = BB.clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\n                    }\n                    doUpdate = true;\n                }\n\n                if (doUpdate) {\n                    e.preventDefault();\n                    this.updateSelectionRect();\n                    clearTimeout(updateCropTimeout);\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n\n    getEl (): HTMLElement {\n        return this.rootEl;\n    }\n    reset (): void {\n        this.resetCrop();\n        this.updateCroppedCanvas();\n        this.updateSelectionRect();\n    }\n    destroy (): void {\n        this.rootEl.remove();\n        this.eventTarget.style.removeProperty('width');\n        this.eventTarget.style.removeProperty('height');\n        this.keyListener.destroy();\n        this.pointerListener.destroy();\n        this.preview.destroy();\n    }\n    isReset (): boolean {\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\n    }\n    getRect (): IRect {\n        return BB.copyObj(this.crop);\n    }\n    getCroppedCanvas (): HTMLCanvasElement {\n        return this.croppedCanvas;\n    }\n}\n\n","import {c} from '../../../bb/base/c';\nimport {ProjectViewport, TProjectViewportProject, TViewportTransform} from './project-viewport';\nimport {BB} from '../../../bb/bb';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\nimport viewportResetImg from '/src/app/img/ui/viewport-reset.svg';\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\nimport editPencilImg from '/src/app/img/ui/edit-pencil.svg';\nimport {EventChain} from '../../../bb/input/event-chain/event-chain';\nimport {DoubleTapper} from '../../../bb/input/event-chain/double-tapper';\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\nimport {css} from '@emotion/css';\nimport {createTransformMatrix} from './utils/create-transform-matrix';\nimport {zoomByStep} from './utils/zoom-by-step';\nimport {PinchZoomer} from '../../../bb/input/event-chain/pinch-zoomer';\nimport {LANG} from '../../../language/language';\nimport {inverse, applyToPoint} from 'transformation-matrix';\nimport {createTransform} from './utils/create-transform';\nimport {toMetaTransform} from './utils/to-meta-transform';\nimport {Options} from '../components/options';\nimport {IPointerEvent, IWheelEvent} from '../../../bb/input/event.types';\n\n\nexport type TPreviewMode = 'edit' | 'hand';\n\nexport type TPreviewParams = {\n    width: number;\n    height: number;\n    project: TProjectViewportProject;\n    onTransformChange?: (transform: TViewportTransform) => void;\n    hasEditMode?: boolean; // default false\n    onModeChange?: (mode: TPreviewMode) => void;\n    padding?: number; //default -> DEFAULT_PADDING\n    hasBorder?: boolean; // default true\n    editIcon?: string;\n};\n\nconst DEFAULT_PADDING = 10;\n\nexport class Preview {\n    private readonly rootEl: HTMLElement;\n    private readonly project: TProjectViewportProject;\n    private viewport: ProjectViewport;\n    private readonly width: number;\n    private readonly height: number;\n    private isReset: boolean = true;\n    private readonly viewportPointerListener: PointerListener;\n    private doRender = false;\n    private readonly padding: number;\n    private animationFrameId: ReturnType<typeof requestAnimationFrame> | undefined;\n    private onTransformChange: TPreviewParams['onTransformChange'] | undefined;\n    private lastEmittedTransform: TViewportTransform = {x: 0, y: 0, scale: 0, angleDeg: 0};\n    private modeToggle: Options<TPreviewMode> | undefined;\n    private readonly pointerChain: EventChain;\n\n\n\n    private renderLoop = (): void => {\n        this.animationFrameId = requestAnimationFrame(this.renderLoop);\n\n        if (this.doRender) {\n            this.doRender = false;\n            this.viewport.render();\n            const viewportTransform = this.viewport.getTransform();\n            if (\n                this.onTransformChange &&\n                JSON.stringify(this.lastEmittedTransform) !== JSON.stringify(viewportTransform)\n            ) {\n                this.onTransformChange(viewportTransform);\n                this.lastEmittedTransform = viewportTransform;\n            }\n        }\n    };\n\n    private requestRerender (): void {\n        this.doRender = true;\n    }\n\n    private resetOrZoom (x: number, y: number): void {\n        if (this.isReset) {\n            this.isReset = false;\n\n            const canvasP = applyToPoint(inverse(createTransformMatrix(this.viewport.getTransform())), {x, y});\n\n            this.viewport.setTransform(createTransform(\n                {x: this.width / 2, y: this.height / 2},\n                canvasP,\n                1,\n                0,\n            ));\n            this.requestRerender();\n        } else {\n            this.reset();\n        }\n    }\n\n    private reset (): void {\n        const fit = BB.fitInto(\n            this.project.width, this.project.height,\n            this.width - this.padding * 2,\n            this.height - this.padding * 2,\n        );\n        const scale = fit.width / this.project.width;\n        this.viewport.setTransform(createTransform(\n            {x: this.width / 2, y: this.height / 2},\n            {x: this.project.width / 2, y: this.project.height / 2},\n            scale,\n            0\n        ));\n        this.isReset = true;\n        this.requestRerender();\n    }\n\n    private transformCanvas (\n        t: {\n            type: 'translate';\n            x: number;\n            y: number;\n        } | {\n            type: 'rotate';\n            cX: number;\n            cY: number;\n            angleDeg: number;\n        } | {\n            type: 'zoom';\n            vX?: number;\n            vY?: number;\n            fac: number;\n        }\n    ): void {\n        if (t.type === 'translate') {\n            const old = this.viewport.getTransform();\n            if (t.x === 0 && t.y === 0) {\n                return;\n            }\n            this.viewport.setTransform({\n                ...old,\n                x: old.x + t.x,\n                y: old.y + t.y,\n            });\n        } else if (t.type === 'zoom') {\n            const old = this.viewport.getTransform();\n            const viewportRect = this.viewport.getElement().getBoundingClientRect();\n            t.vX = t.vX ?? viewportRect.width / 2;\n            t.vY = t.vY ?? viewportRect.height / 2;\n\n            const metaTransform = toMetaTransform(\n                old,\n                    {x: t.vX, y: t.vY},\n            );\n            metaTransform.scale *= t.fac;\n\n            this.viewport.setTransform(createTransform(\n                metaTransform.viewportP,\n                metaTransform.canvasP,\n                metaTransform.scale,\n                metaTransform.angleDeg,\n            ));\n        }\n        this.isReset = false;\n\n        this.requestRerender();\n    }\n\n    // ---- public ----\n    constructor (p: TPreviewParams) {\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.onTransformChange = p.onTransformChange;\n        this.padding = p.padding ?? DEFAULT_PADDING;\n\n        const fit = BB.fitInto(\n            this.project.width, this.project.height,\n            this.width - this.padding * 2,\n            this.height - this.padding * 2,\n        );\n        const scale = fit.width / this.project.width;\n\n        this.viewport = new ProjectViewport({\n            width: this.width,\n            height: this.height,\n            transform: createTransform(\n                {x: this.width / 2, y: this.height / 2},\n                {x: this.project.width / 2, y: this.project.height / 2},\n                scale,\n                0\n            ),\n            project: this.project,\n            useNativeResolution: false,\n            drawBackground: true,\n        });\n\n        const doubleTapper = new DoubleTapper({\n            onDoubleTap: (e) => {\n                const m = createTransformMatrix(this.viewport.getTransform());\n                const tl = applyToPoint(m, {x: 0, y: 0});\n                const br = applyToPoint(m, {x: this.project.width, y: this.project.height});\n                const isInside = BB.isInsideRect(\n                    {x: e.relX, y: e.relY},\n                    {\n                        x: tl.x,\n                        y: tl.y,\n                        width: br.x - tl.x,\n                        height: br.y - tl.y,\n                    },\n                );\n\n                if (!this.isReset || isInside) {\n                    this.resetOrZoom(e.relX, e.relY);\n                }\n            },\n            isInstant: true,\n        });\n        let oldTransform: TViewportTransform | undefined = undefined;\n        const pinchZoomer = new PinchZoomer({\n            onPinch: (e) => {\n                if (e.type === 'move') {\n                    if (!oldTransform) {\n                        oldTransform = this.viewport.getTransform();\n                    }\n                    const metaTransform = toMetaTransform(oldTransform, {x: e.downRelX, y: e.downRelY});\n                    metaTransform.scale *= e.scale;\n                    metaTransform.viewportP.x += e.relX - e.downRelX;\n                    metaTransform.viewportP.y += e.relY - e.downRelY;\n                    this.viewport.setTransform(createTransform(\n                        metaTransform.viewportP,\n                        metaTransform.canvasP,\n                        metaTransform.scale,\n                        metaTransform.angleDeg,\n                    ));\n                    this.requestRerender();\n                    this.isReset = false;\n\n                }  else if (e.type === 'end') {\n                    oldTransform = undefined;\n                }\n            },\n        });\n\n\n        this.pointerChain = new EventChain({\n           chainArr: [\n               pinchZoomer as IChainElement,\n               doubleTapper as IChainElement,\n           ],\n        });\n        this.pointerChain.setChainOut((e) => {\n            if (e.button && ['left', 'middle'].includes(e.button)) {\n                // debugOut(JSON.stringify(e));\n                this.transformCanvas({\n                    type: 'translate',\n                    x: e.dX,\n                    y: e.dY,\n                });\n            }\n        });\n\n        this.viewport.getElement().classList.add(css({\n            cursor: 'grab',\n            ':active': {\n                cursor: 'grabbing',\n            },\n        }));\n        BB.css(this.viewport.getElement(), {\n            userSelect: 'none',\n            touchAction: 'none',\n        });\n        this.viewport.getElement().addEventListener( 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener('dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.viewportPointerListener = new PointerListener({\n            target: this.viewport.getElement(),\n            onPointer: (e) => {\n                this.pointerChain.chainIn(e);\n            },\n            onWheel: this.onWheel,\n            maxPointers: 2,\n        });\n        this.viewport.getElement().addEventListener('wheel', (e) => {\n            e.preventDefault();\n        });\n\n        if (p.hasEditMode) {\n            this.modeToggle = new Options<TPreviewMode>({\n                optionArr: (['edit', 'hand'] as const).map(id => {\n                    const el = BB.el({\n                        className: 'dark-invert',\n                        css: {\n                            width: '28px',\n                            height: '28px',\n                            backgroundSize: 'contain',\n                            margin: '5px',\n                            backgroundImage: `url(${id === 'edit' ? p.editIcon ?? editPencilImg : toolHandImg})`,\n                            backgroundPosition: 'center',\n                            backgroundRepeat: 'no-repeat',\n                        },\n                    });\n\n                    return {\n                        id,\n                        label: el,\n                        title: id === 'edit' ? LANG('tab-edit') : LANG('tool-hand'),\n                    };\n                }),\n                initId: 'edit',\n                onChange: (val) => {\n                    p.onModeChange && p.onModeChange(val);\n                },\n            });\n        }\n\n        const elCss = css(p.hasBorder === false ? {} : {\n            borderTop: '1px solid #7f7f7f',\n            borderBottom: '1px solid #7f7f7f',\n            '.kl-theme-dark &': {\n                borderTop: '1px solid #636363',\n                borderBottom: '1px solid #636363',\n            },\n        });\n        // pointer-events: auto - So the canvas can be ignored, while the buttons still work.\n        this.rootEl = c(\n            {\n                className: elCss,\n                css: {\n                    position: 'relative',\n                },\n            },\n            [\n                this.viewport.getElement(),\n                ...(this.modeToggle ? [\n                    c(',pos-absolute,left-5,top-5,z-1,pointer-auto', [\n                        this.modeToggle.getElement(),\n                    ]),\n                ] : []),\n                c(',pos-absolute,right-5,bottom-5,flex,flexCol,gap-5,z-1,pointer-auto', [\n                    c({\n                        tagName: 'button',\n                        title: LANG('hand-reset'),\n                        onClick: () => {\n                            this.reset();\n                        },\n                        content: `<img alt=\"reset\" height=\"20\" src=\"${viewportResetImg}\">`,\n                        noRef: true,\n                    }),\n                    c({\n                        tagName: 'button',\n                        title: LANG('zoom-in'),\n                        onClick: () => {\n                            const oldScale = this.viewport.getTransform().scale;\n                            const newScale = zoomByStep(oldScale, 1);\n                            this.transformCanvas({\n                                type: 'zoom',\n                                fac: newScale / oldScale,\n                            });\n                        },\n                        content: `<img alt=\"zoom-in\" height=\"20\" src=\"${toolZoomInImg}\">`,\n                        noRef: true,\n                    }),\n                    c({\n                        tagName: 'button',\n                        title: LANG('zoom-out'),\n                        onClick: () => {\n                            const oldScale = this.viewport.getTransform().scale;\n                            const newScale = zoomByStep(oldScale, -1);\n                            this.transformCanvas({\n                                type: 'zoom',\n                                fac: newScale / oldScale,\n                            });\n                        },\n                        content: `<img alt=\"zoom-out\" height=\"20\" src=\"${toolZoomOutImg}\">`,\n                        noRef: true,\n                    }),\n                ]),\n            ],\n        );\n        this.renderLoop();\n    }\n\n    render (): void {\n        this.requestRerender();\n    }\n\n    setTransform (transform: TViewportTransform): void {\n        this.viewport.setTransform(transform);\n        this.requestRerender();\n        this.isReset = false;\n    }\n\n    getTransform (): TViewportTransform {\n        return this.viewport.getTransform();\n    }\n\n    onPointer (event: IPointerEvent): void {\n        this.pointerChain.chainIn(event);\n    }\n\n    onWheel = (e: IWheelEvent): void => {\n        const viewportRect = this.viewport.getElement().getBoundingClientRect();\n        const vX = e.pageX - viewportRect.x;\n        const vY = e.pageY - viewportRect.y;\n\n        const oldScale = this.viewport.getTransform().scale;\n        const newScale = zoomByStep(oldScale, -e.deltaY / 2);\n\n        this.transformCanvas({\n            type: 'zoom',\n            vX,\n            vY,\n            fac: newScale / oldScale,\n        });\n    };\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.animationFrameId !== undefined && cancelAnimationFrame(this.animationFrameId);\n        this.viewport.destroy();\n        this.viewportPointerListener.destroy();\n        this.rootEl.remove();\n        this.modeToggle && this.modeToggle.destroy();\n    }\n}","import {TMixMode} from '../../kl-types';\nimport {BB} from '../../../bb/bb';\nimport {throwIfNull} from '../../../bb/base/base';\nimport {theme} from '../../../theme/theme';\nimport {Matrix, inverse, compose} from 'transformation-matrix';\nimport {createTransformMatrix} from './utils/create-transform-matrix';\n\nfunction fixScale (scale: number, pixels: number): number {\n    return Math.round(pixels * scale) / pixels;\n}\n\n// width, height - viewport size\nexport type TProjectViewportLayerFunc = (\n    viewportTransform: TViewportTransformXY,\n    viewportWidth: number,\n    viewportHeight: number\n) => (\n        CanvasImageSource |\n        {image: CanvasImageSource; transform: Matrix} // image drawn with ctx.setTransform(transform)\n    );\n\nexport type TProjectViewportProject = {\n    width: number;\n    height: number;\n    layers: {\n        image: CanvasImageSource | TProjectViewportLayerFunc;\n        isVisible: boolean;\n        opacity: number;\n        mixModeStr: TMixMode;\n        hasClipping: boolean;\n    }[];\n};\n\nexport type TViewportTransform = {\n    scale: number;\n    angleDeg: number;\n    x: number;\n    y: number;\n};\n\nexport type TViewportTransformXY = {\n    scaleX: number;\n    scaleY: number;\n    angleDeg: number;\n    x: number;\n    y: number;\n};\n\nexport type TProjectViewportParams = {\n    width: number;\n    height: number;\n    project: TProjectViewportProject;\n    transform: TViewportTransform;\n    drawBackground?: boolean;\n    useNativeResolution?: boolean;\n    renderAfter?: (ctx: CanvasRenderingContext2D) => void;\n    fillParent?: boolean;\n};\n\n/**\n *\n * Scale - size of one project-canvas pixel compared to CSS pixel\n *      -> 1 means 1 pixel in the drawing is the size of a CSS pixel\n *      -> independent of device pixel ratio, or what resolution the viewport\n *          canvas may actually have.\n * Translate - translates in CSS pixels\n * Viewport origin is top left (same as canvas)\n *\n * Order of transformations (matrix multiplication is reversed): translate, rotate, scale\n */\nexport class ProjectViewport {\n    private width: number;\n    private height: number;\n    private readonly canvas: HTMLCanvasElement;\n    private readonly ctx: CanvasRenderingContext2D;\n    private transform: TViewportTransform;\n\n    private project: TProjectViewportProject;\n    private useNativeResolution: boolean;\n\n    private pattern: CanvasPattern;\n    private resFactor: number;\n    private readonly drawBackground: boolean;\n    private doResize: boolean = true;\n    private readonly doFillParent: boolean;\n\n    private onIsDark = (): void => {\n        this.pattern = throwIfNull(this.ctx.createPattern(BB.createCheckerCanvas(10, theme.isDark()), 'repeat'));\n        this.render();\n    };\n\n    private oldDPR = devicePixelRatio;\n    private resizeListener = () => {\n        if (devicePixelRatio !== this.oldDPR) {\n            this.canvas.style.imageRendering = Math.round(devicePixelRatio) !== devicePixelRatio ? '' : 'pixelated';\n            this.oldDPR = devicePixelRatio;\n        }\n    };\n\n    // ---- public ----\n    constructor (p: TProjectViewportParams) {\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.useNativeResolution = !!p.useNativeResolution;\n        this.drawBackground = !!p.drawBackground;\n        this.doFillParent = !!p.fillParent;\n\n        this.transform = {\n            ...p.transform,\n        };\n\n\n        this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n        this.canvas = BB.canvas(\n            this.width * this.resFactor,\n            this.height * this.resFactor,\n        );\n        this.ctx = BB.ctx(this.canvas);\n        BB.css(this.canvas, {\n            width: this.doFillParent ? '100%' : (this.width + 'px'),\n            height: this.doFillParent ? '100%' : (this.height + 'px'),\n            imageRendering: Math.round(devicePixelRatio) !== devicePixelRatio ? undefined : 'pixelated',\n            display: 'block',\n        });\n        window.addEventListener('resize', this.resizeListener);\n\n        this.pattern = throwIfNull(this.ctx.createPattern(BB.createCheckerCanvas(10, theme.isDark()), 'repeat'));\n        theme.addIsDarkListener(this.onIsDark);\n\n        // this.render();\n    }\n\n    render (): void {\n        const isDark = theme.isDark();\n        const transform = {\n            ...this.transform,\n            x: this.transform.x,\n            y: this.transform.y,\n            scale: this.transform.scale,\n        };\n\n        if (this.doResize) {\n            this.doResize = false;\n            this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n            this.canvas.width = Math.round(this.width * this.resFactor);\n            this.canvas.height = Math.round(this.height * this.resFactor);\n        }\n\n        const renderedTransform: TViewportTransformXY = {\n            x: Math.round(transform.x),\n            y: Math.round(transform.y),\n            scaleX: fixScale(transform.scale, this.project.width),\n            scaleY: fixScale(transform.scale, this.project.height),\n            angleDeg: transform.angleDeg,\n        };\n        const renderedMat = createTransformMatrix(renderedTransform);\n\n\n\n        this.ctx.save();\n        this.ctx.imageSmoothingEnabled = false;\n\n        if (this.drawBackground) {\n            this.ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)';\n            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        } else {\n            this.ctx.fillStyle = this.pattern;\n            this.ctx.fillRect(0, 0, this.width, this.height);\n        }\n\n        // this.ctx.scale(this.resFactor, this.resFactor);\n        this.ctx.translate(renderedTransform.x, renderedTransform.y);\n        this.ctx.scale(renderedTransform.scaleX, renderedTransform.scaleY);\n        this.ctx.rotate(renderedTransform.angleDeg / 180 * Math.PI);\n\n\n        if (this.drawBackground) {\n            this.ctx.save();\n\n            this.ctx.fillStyle = theme.isDark() ? 'rgba(255,255,255,0.25)' : 'rgba(0,0,0,0.2)';\n            const scaledPixelX = 1 / renderedTransform.scaleX;\n            const scaledPixelY = 1 / renderedTransform.scaleY;\n            this.ctx.fillRect(-scaledPixelX, -scaledPixelY, this.project.width + scaledPixelX * 2, this.project.height + scaledPixelY * 2);\n\n            this.ctx.fillStyle = this.pattern;\n            this.pattern.setTransform(inverse(renderedMat));\n            this.ctx.fillRect(0, 0, this.project.width, this.project.height);\n\n            this.ctx.restore();\n        }\n\n        this.project.layers.forEach(layer => {\n            if (!layer.isVisible || !layer.opacity) {\n                return;\n            }\n            this.ctx.save();\n            this.ctx.globalCompositeOperation = layer.mixModeStr;\n            this.ctx.globalAlpha = layer.opacity;\n\n            let image: CanvasImageSource = {} as CanvasImageSource;\n            if (typeof layer.image === 'function') {\n                const res = layer.image(renderedTransform, this.canvas.width, this.canvas.height);\n                if ('image' in res && 'transform' in res) {\n                    image = res.image;\n                    this.ctx.setTransform(compose(renderedMat, res.transform));\n                } else {\n                    image = res;\n                }\n            } else {\n                image = layer.image;\n            }\n            this.ctx.drawImage(image, 0, 0); // , this.project.width, this.project.height);\n            this.ctx.restore();\n        });\n\n        this.ctx.restore();\n    }\n\n    setSize (width: number, height: number): void {\n        this.doResize = true;\n        this.width = width;\n        this.height = height;\n\n        BB.css(this.canvas, {\n            width: this.doFillParent ? '100%' : (this.width + 'px'),\n            height: this.doFillParent ? '100%' : (this.height + 'px'),\n        });\n    }\n\n    setTransform (transform: TViewportTransform): void {\n        this.transform = { ...transform };\n    }\n\n    getTransform (): TViewportTransform {\n        return { ...this.transform };\n    }\n\n    setUseNativeResolution (b: boolean): void {\n        this.useNativeResolution = b;\n        this.doResize = true;\n    }\n\n    getUseNativeResolution (): boolean {\n        return this.useNativeResolution;\n    }\n\n    getElement (): HTMLElement {\n        return this.canvas;\n    }\n\n    destroy (): void {\n        BB.freeCanvas(this.canvas);\n        theme.removeIsDarkListener(this.onIsDark);\n        window.removeEventListener('resize', this.resizeListener);\n    }\n}","export * from './applyToPoint'\nexport * from './fromObject'\nexport * from './fromString'\nexport * from './identity'\nexport * from './inverse'\nexport * from './isAffineMatrix'\nexport * from './rotate'\nexport * from './scale'\nexport * from './shear'\nexport * from './skew'\nexport * from './toString'\nexport * from './transform'\nexport * from './translate'\nexport * from './fromTriangles'\nexport * from './smoothMatrix'\nexport * from './fromDefinition'\nexport * from './fromTransformAttribute'\nexport * from './decompose'\nexport * from './flip'\nexport * from './fromMovingPoints'\n","/**\n * Calculate a point transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param  point {Point} Point\n * @returns {Point} Point\n */\nexport function applyToPoint (matrix, point) {\n  return Array.isArray(point)\n    ? [\n        matrix.a * point[0] + matrix.c * point[1] + matrix.e,\n        matrix.b * point[0] + matrix.d * point[1] + matrix.f\n      ]\n    : {\n        x: matrix.a * point.x + matrix.c * point.y + matrix.e,\n        y: matrix.b * point.x + matrix.d * point.y + matrix.f\n      }\n}\n\n/**\n * Calculate an array of points transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param points {Point[]} Array of point\n * @returns {Point[]} Array of point\n */\nexport function applyToPoints (matrix, points) {\n  return points.map(point => applyToPoint(matrix, point))\n}\n","/**\n * Extract an affine matrix from an object that contains a,b,c,d,e,f keys\n * Any value could be a float or a string that contains a float\n * @param object {Object} Object that contains a,b,c,d,e,f keys\n * @return {Matrix} Affine Matrix\n */\nexport function fromObject (object) {\n  return {\n    a: parseFloat(object.a),\n    b: parseFloat(object.b),\n    c: parseFloat(object.c),\n    d: parseFloat(object.d),\n    e: parseFloat(object.e),\n    f: parseFloat(object.f)\n  }\n}\n","/**\n * @ignore\n * @type {RegExp}\n */\nconst matrixRegex = /^matrix\\(\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*\\)$/i\n\n/**\n * Parse a string formatted as matrix(a,b,c,d,e,f)\n * @param string {string} String with an affine matrix\n * @returns {Matrix} Affine Matrix\n *\n * @example\n * > fromString('matrix(1,2,3,4,5,6)')\n * {a: 1, b: 2, c: 3, d: 4, c: 5, e: 6}\n */\nexport function fromString (string) {\n  const parsed = string.match(matrixRegex)\n  if (parsed === null || parsed.length < 7) throw new Error(`'${string}' is not a matrix`)\n  return {\n    a: parseFloat(parsed[1]),\n    b: parseFloat(parsed[2]),\n    c: parseFloat(parsed[3]),\n    d: parseFloat(parsed[4]),\n    e: parseFloat(parsed[5]),\n    f: parseFloat(parsed[6])\n  }\n}\n","/**\n * Identity matrix\n * @returns {Matrix} Affine Matrix\n */\nexport function identity () {\n  return {\n    a: 1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: 1,\n    f: 0\n  }\n}\n","/**\n * Calculate a matrix that is the inverse of the provided matrix\n * @param matrix {Matrix} Affine Matrix\n * @returns {Matrix} Inverted Affine Matrix\n */\nexport function inverse (matrix) {\n  // http://www.wolframalpha.com/input/?i=Inverse+%5B%7B%7Ba,c,e%7D,%7Bb,d,f%7D,%7B0,0,1%7D%7D%5D\n\n  const { a, b, c, d, e, f } = matrix\n\n  const denom = a * d - b * c\n\n  return {\n    a: d / denom,\n    b: b / -denom,\n    c: c / -denom,\n    d: a / denom,\n    e: (d * e - c * f) / -denom,\n    f: (b * e - a * f) / denom\n  }\n}\n","import { isNumeric, isObject } from './utils'\n\n/**\n * Check if the object contain an affine matrix\n * @param object {Object} Generic Plain Object\n * @return {boolean} True if is an object and contains an affine matrix\n */\n\nexport function isAffineMatrix (object) {\n  return isObject(object) &&\n    'a' in object &&\n    isNumeric(object.a) &&\n    'b' in object &&\n    isNumeric(object.b) &&\n    'c' in object &&\n    isNumeric(object.c) &&\n    'd' in object &&\n    isNumeric(object.d) &&\n    'e' in object &&\n    isNumeric(object.e) &&\n    'f' in object &&\n    isNumeric(object.f)\n}\n","export function isUndefined (val) {\n  return typeof val === 'undefined'\n}\n\nexport function isNumeric (n) {\n  return typeof n === 'number' &&\n    !Number.isNaN(n) &&\n    Number.isFinite(n)\n}\n\nexport function isObject (obj) {\n  return typeof obj === 'object' &&\n    obj !== null &&\n    !Array.isArray(obj)\n}\n\nexport function matchesShape (obj, keys) {\n  return keys.every(key => key in obj)\n}\n","import { isUndefined } from './utils'\nimport { translate } from './translate'\nimport { transform } from './transform'\n\nconst { cos, sin, PI } = Math\n/**\n * Calculate a rotation matrix\n * @param angle {number} Angle in radians\n * @param [cx] {number} If (cx,cy) are supplied the rotate is about this point\n * @param [cy] {number} If (cx,cy) are supplied the rotate is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function rotate (angle, cx, cy) {\n  const cosAngle = cos(angle)\n  const sinAngle = sin(angle)\n  const rotationMatrix = {\n    a: cosAngle,\n    c: -sinAngle,\n    e: 0,\n    b: sinAngle,\n    d: cosAngle,\n    f: 0\n  }\n  if (isUndefined(cx) || isUndefined(cy)) {\n    return rotationMatrix\n  }\n\n  return transform([\n    translate(cx, cy),\n    rotationMatrix,\n    translate(-cx, -cy)\n  ])\n}\n\n/**\n * Calculate a rotation matrix with a DEG angle\n * @param angle {number} Angle in degree\n * @param [cx] {number} If (cx,cy) are supplied the rotate is about this point\n * @param [cy] {number} If (cx,cy) are supplied the rotate is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function rotateDEG (angle, cx = undefined, cy = undefined) {\n  return rotate(angle * PI / 180, cx, cy)\n}\n","/**\n * Calculate a translate matrix\n * @param tx {number} Translation on axis x\n * @param [ty = 0] {number} Translation on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function translate (tx, ty = 0) {\n  return {\n    a: 1,\n    c: 0,\n    e: tx,\n    b: 0,\n    d: 1,\n    f: ty\n  }\n}\n","/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */\nexport function transform (...matrices) {\n  matrices = Array.isArray(matrices[0]) ? matrices[0] : matrices\n\n  const multiply = (m1, m2) => {\n    return {\n      a: m1.a * m2.a + m1.c * m2.b,\n      c: m1.a * m2.c + m1.c * m2.d,\n      e: m1.a * m2.e + m1.c * m2.f + m1.e,\n      b: m1.b * m2.a + m1.d * m2.b,\n      d: m1.b * m2.c + m1.d * m2.d,\n      f: m1.b * m2.e + m1.d * m2.f + m1.f\n    }\n  }\n\n  switch (matrices.length) {\n    case 0:\n      throw new Error('no matrices provided')\n\n    case 1:\n      return matrices[0]\n\n    case 2:\n      return multiply(matrices[0], matrices[1])\n\n    default: {\n      const [m1, m2, ...rest] = matrices\n      const m = multiply(m1, m2)\n      return transform(m, ...rest)\n    }\n  }\n}\n\n/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */\nexport function compose (...matrices) {\n  return transform(...matrices)\n}\n","import { isUndefined } from './utils'\nimport { translate } from './translate'\nimport { transform } from './transform'\n\n/**\n * Calculate a scaling matrix\n * @param sx {number} Scaling on axis x\n * @param [sy = sx] {number} Scaling on axis y (default sx)\n * @param [cx] {number} If (cx,cy) are supplied the scaling is about this point\n * @param [cy] {number} If (cx,cy) are supplied the scaling is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function scale (sx, sy = undefined, cx = undefined, cy = undefined) {\n  if (isUndefined(sy)) sy = sx\n\n  const scaleMatrix = {\n    a: sx,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: sy,\n    f: 0\n  }\n\n  if (isUndefined(cx) || isUndefined(cy)) {\n    return scaleMatrix\n  }\n\n  return transform([\n    translate(cx, cy),\n    scaleMatrix,\n    translate(-cx, -cy)\n  ])\n}\n","/**\n * Calculate a shear matrix\n * @param shx {number} Shear on axis x\n * @param shy {number} Shear on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function shear (shx, shy) {\n  return {\n    a: 1,\n    c: shx,\n    e: 0,\n    b: shy,\n    d: 1,\n    f: 0\n  }\n}\n","// https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/skew\nconst { tan } = Math\n\n/**\n * Calculate a skew matrix\n * @param ax {number} Skew on axis x\n * @param ay {number} Skew on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function skew (ax, ay) {\n  return {\n    a: 1,\n    c: tan(ax),\n    e: 0,\n    b: tan(ay),\n    d: 1,\n    f: 0\n  }\n}\n\n/**\n * Calculate a skew matrix using DEG angles\n * @param ax {number} Skew on axis x\n * @param ay {number} Skew on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function skewDEG (ax, ay) {\n  return skew(ax * Math.PI / 180, ay * Math.PI / 180)\n}\n","/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toCSS (matrix) {\n  return toString(matrix)\n}\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toSVG (matrix) {\n  return toString(matrix)\n}\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toString (matrix) {\n  return `matrix(${matrix.a},${matrix.b},${matrix.c},${matrix.d},${matrix.e},${matrix.f})`\n}\n","import { inverse } from './inverse'\nimport { transform } from './transform'\nimport { smoothMatrix } from './smoothMatrix'\n\n/**\n * Returns a matrix that transforms a triangle t1 into another triangle t2, or throws an exception if it is impossible.\n * @param t1 {Point[]} Array of points containing the three points for the first triangle\n * @param t2 {Point[]} Array of points containing the three points for the second triangle\n * @returns {Matrix} Matrix which transforms t1 to t2\n * @throws Exception if the matrix becomes not invertible\n */\nexport function fromTriangles (t1, t2) {\n  // point p = first point of the triangle\n  const px1 = t1[0].x != null ? t1[0].x : t1[0][0]\n  const py1 = t1[0].y != null ? t1[0].y : t1[0][1]\n  const px2 = t2[0].x != null ? t2[0].x : t2[0][0]\n  const py2 = t2[0].y != null ? t2[0].y : t2[0][1]\n\n  // point q = second point of the triangle\n  const qx1 = t1[1].x != null ? t1[1].x : t1[1][0]\n  const qy1 = t1[1].y != null ? t1[1].y : t1[1][1]\n  const qx2 = t2[1].x != null ? t2[1].x : t2[1][0]\n  const qy2 = t2[1].y != null ? t2[1].y : t2[1][1]\n\n  // point r = third point of the triangle\n  const rx1 = t1[2].x != null ? t1[2].x : t1[2][0]\n  const ry1 = t1[2].y != null ? t1[2].y : t1[2][1]\n  const rx2 = t2[2].x != null ? t2[2].x : t2[2][0]\n  const ry2 = t2[2].y != null ? t2[2].y : t2[2][1]\n\n  const r1 = {\n    a: px1 - rx1,\n    b: py1 - ry1,\n    c: qx1 - rx1,\n    d: qy1 - ry1,\n    e: rx1,\n    f: ry1\n  }\n  const r2 = {\n    a: px2 - rx2,\n    b: py2 - ry2,\n    c: qx2 - rx2,\n    d: qy2 - ry2,\n    e: rx2,\n    f: ry2\n  }\n\n  const inverseR1 = inverse(r1)\n  const affineMatrix = transform([r2, inverseR1])\n\n  // round the matrix elements to smooth the finite inversion\n  return smoothMatrix(affineMatrix)\n}\n","/**\n * Rounds all elements of the given matrix using the given precision\n * @param matrix {Matrix} An affine matrix to round\n * @param [precision] {number} A precision to use for Math.round. Defaults to 10000000000 (meaning which rounds to the 10th digit after the comma).\n * @returns {Matrix} The rounded Affine Matrix\n */\nexport function smoothMatrix (matrix, precision = 10000000000) {\n  return {\n    a: Math.round(matrix.a * precision) / precision,\n    b: Math.round(matrix.b * precision) / precision,\n    c: Math.round(matrix.c * precision) / precision,\n    d: Math.round(matrix.d * precision) / precision,\n    e: Math.round(matrix.e * precision) / precision,\n    f: Math.round(matrix.f * precision) / precision\n  }\n}\n","import { fromObject } from './fromObject'\nimport { translate } from './translate'\nimport { scale } from './scale'\nimport { rotateDEG } from './rotate'\nimport { skewDEG } from './skew'\nimport { shear } from './shear'\n\n/**\n * Converts array of matrix descriptor to array of matrix\n * @param definitionOrArrayOfDefinition {Object[]} Array of object describing the matrix\n * @returns {Matrix[]} Array of matrix\n *\n * @example\n * > fromDefinition([\n *  { type: 'matrix', a:1, b:2, c:3, d:4, e:5, f:6 },\n *  { type: 'translate', tx: 10, ty: 20 },\n *  { type: 'scale', sx: 2, sy: 4 },\n *  { type: 'rotate', angle: 90, cx: 50, cy: 25 },\n *  { type: 'skewX', angle: 45 },\n *  { type: 'skewY',  angle: 45 },\n *  { type: 'shear', shx: 10, shy: 20}\n * ])\n *\n * [\n *  { a: 1, b: 2, c: 3, d: 4, e: 5, f: 6 },\n *  { a: 1, c: 0, e: 10, b: 0, d: 1, f: 20 },\n *  { a: 2, c: 0, e: 0, b: 0, d: 4, f: 0 },\n *  { a: 6.123, c: -1, e: 0, b: 1, d: 6.123, f: 0 },\n *  { a: 1, c: 0.99.., e: 0, b: 0, d: 1, f: 0 },\n *  { a: 1, c: 0, e: 0, b: 0.99, d: 1, f: 0 },\n *  { a: 1, c: 10, e: 0, b: 20, d: 1, f: 0 }\n * ]\n **/\nexport function fromDefinition (definitionOrArrayOfDefinition) {\n  return Array.isArray(definitionOrArrayOfDefinition)\n    ? definitionOrArrayOfDefinition.map(mapper)\n    : mapper(definitionOrArrayOfDefinition)\n\n  function mapper (descriptor) {\n    switch (descriptor.type) {\n      case 'matrix':\n        if ('a' in descriptor &&\n          'b' in descriptor &&\n          'c' in descriptor &&\n          'd' in descriptor &&\n          'e' in descriptor &&\n          'f' in descriptor\n        ) {\n          return fromObject(descriptor)\n        } else {\n          throw new Error('MISSING_MANDATORY_PARAM')\n        }\n\n      case 'translate':\n        if (!('tx' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('ty' in descriptor) return translate(descriptor.tx, descriptor.ty)\n\n        return translate(descriptor.tx)\n\n      case 'scale':\n        if (!('sx' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('sy' in descriptor) return scale(descriptor.sx, descriptor.sy)\n\n        return scale(descriptor.sx)\n\n      case 'rotate':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('cx' in descriptor && 'cy' in descriptor) {\n          return rotateDEG(descriptor.angle, descriptor.cx, descriptor.cy)\n        }\n        return rotateDEG(descriptor.angle)\n\n      case 'skewX':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return skewDEG(descriptor.angle, 0)\n\n      case 'skewY':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return skewDEG(0, descriptor.angle)\n\n      case 'shear':\n        if (!('shx' in descriptor && 'shy' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return shear(descriptor.shx, descriptor.shy)\n\n      default:\n        throw new Error('UNSUPPORTED_DESCRIPTOR')\n    }\n  }\n}\n","import { parse } from './fromTransformAttribute.autogenerated'\n\n/**\n * Parser for SVG Trasform Attribute http://www.w3.org/TR/SVG/coords.html#TransformAttribute <br/>\n * Warning: This should be considered BETA until it is released a stable version of pegjs.\n * @param transformString {string} Transform string as defined by w3 Consortium\n * @returns {MatrixDescriptor[]} Array of MatrixDescriptor\n *\n * @example\n * > fromTransformAttribute('translate(-10,-10) scale(2,2) translate(10,10)')\n * [\n *  { type: 'translate', tx: -10, ty: -10},\n *  { type: 'scale', sx: 2, sy: 2 },\n *  { type: 'translate', tx: 10, ty: 10}\n * ]\n *\n * > compose(fromDefinition(fromTransformAttribute('translate(-10, -10) scale(10, 10)')))\n * { a: 10, c: 0, e: -10, b: 0, d: 10, f: -10 }\n */\nexport function fromTransformAttribute (transformString) {\n  return parse(transformString)\n}\n","// Generated by Peggy 3.0.0.\n//\n// https://peggyjs.org/\n\nfunction peg$subclass(child, parent) {\n  function C() { this.constructor = child; }\n  C.prototype = parent.prototype;\n  child.prototype = new C();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  var self = Error.call(this, message);\n  // istanbul ignore next Check is a necessary evil to support older environments\n  if (Object.setPrototypeOf) {\n    Object.setPrototypeOf(self, peg$SyntaxError.prototype);\n  }\n  self.expected = expected;\n  self.found = found;\n  self.location = location;\n  self.name = \"SyntaxError\";\n  return self;\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\nfunction peg$padEnd(str, targetLength, padString) {\n  padString = padString || \" \";\n  if (str.length > targetLength) { return str; }\n  targetLength -= str.length;\n  padString += padString.repeat(targetLength);\n  return str + padString.slice(0, targetLength);\n}\n\npeg$SyntaxError.prototype.format = function(sources) {\n  var str = \"Error: \" + this.message;\n  if (this.location) {\n    var src = null;\n    var k;\n    for (k = 0; k < sources.length; k++) {\n      if (sources[k].source === this.location.source) {\n        src = sources[k].text.split(/\\r\\n|\\n|\\r/g);\n        break;\n      }\n    }\n    var s = this.location.start;\n    var offset_s = (this.location.source && (typeof this.location.source.offset === \"function\"))\n      ? this.location.source.offset(s)\n      : s;\n    var loc = this.location.source + \":\" + offset_s.line + \":\" + offset_s.column;\n    if (src) {\n      var e = this.location.end;\n      var filler = peg$padEnd(\"\", offset_s.line.toString().length, ' ');\n      var line = src[s.line - 1];\n      var last = s.line === e.line ? e.column : line.length + 1;\n      var hatLen = (last - s.column) || 1;\n      str += \"\\n --> \" + loc + \"\\n\"\n          + filler + \" |\\n\"\n          + offset_s.line + \" | \" + line + \"\\n\"\n          + filler + \" | \" + peg$padEnd(\"\", s.column - 1, ' ')\n          + peg$padEnd(\"\", hatLen, \"^\");\n    } else {\n      str += \"\\n at \" + loc;\n    }\n  }\n  return str;\n};\n\npeg$SyntaxError.buildMessage = function(expected, found) {\n  var DESCRIBE_EXPECTATION_FNS = {\n    literal: function(expectation) {\n      return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n    },\n\n    class: function(expectation) {\n      var escapedParts = expectation.parts.map(function(part) {\n        return Array.isArray(part)\n          ? classEscape(part[0]) + \"-\" + classEscape(part[1])\n          : classEscape(part);\n      });\n\n      return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts.join(\"\") + \"]\";\n    },\n\n    any: function() {\n      return \"any character\";\n    },\n\n    end: function() {\n      return \"end of input\";\n    },\n\n    other: function(expectation) {\n      return expectation.description;\n    }\n  };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\"/g,  \"\\\\\\\"\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\\]/g, \"\\\\]\")\n      .replace(/\\^/g, \"\\\\^\")\n      .replace(/-/g,  \"\\\\-\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = expected.map(describeExpectation);\n    var i, j;\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== undefined ? options : {};\n\n  var peg$FAILED = {};\n  var peg$source = options.grammarSource;\n\n  var peg$startRuleFunctions = { transformList: peg$parsetransformList };\n  var peg$startRuleFunction = peg$parsetransformList;\n\n  var peg$c0 = \"matrix\";\n  var peg$c1 = \"(\";\n  var peg$c2 = \")\";\n  var peg$c3 = \"translate\";\n  var peg$c4 = \"scale\";\n  var peg$c5 = \"rotate\";\n  var peg$c6 = \"skewX\";\n  var peg$c7 = \"skewY\";\n  var peg$c8 = \",\";\n  var peg$c9 = \".\";\n\n  var peg$r0 = /^[eE]/;\n  var peg$r1 = /^[+\\-]/;\n  var peg$r2 = /^[0-9]/;\n  var peg$r3 = /^[ \\t\\r\\n]/;\n\n  var peg$e0 = peg$literalExpectation(\"matrix\", false);\n  var peg$e1 = peg$literalExpectation(\"(\", false);\n  var peg$e2 = peg$literalExpectation(\")\", false);\n  var peg$e3 = peg$literalExpectation(\"translate\", false);\n  var peg$e4 = peg$literalExpectation(\"scale\", false);\n  var peg$e5 = peg$literalExpectation(\"rotate\", false);\n  var peg$e6 = peg$literalExpectation(\"skewX\", false);\n  var peg$e7 = peg$literalExpectation(\"skewY\", false);\n  var peg$e8 = peg$literalExpectation(\",\", false);\n  var peg$e9 = peg$otherExpectation(\"fractionalConstant\");\n  var peg$e10 = peg$literalExpectation(\".\", false);\n  var peg$e11 = peg$classExpectation([\"e\", \"E\"], false, false);\n  var peg$e12 = peg$classExpectation([\"+\", \"-\"], false, false);\n  var peg$e13 = peg$classExpectation([[\"0\", \"9\"]], false, false);\n  var peg$e14 = peg$classExpectation([\" \", \"\\t\", \"\\r\", \"\\n\"], false, false);\n\n  var peg$f0 = function(ts) { return ts; };\n  var peg$f1 = function(t, ts) { return t.concat(ts) };\n  var peg$f2 = function(a, b, c, d, e, f) {\n      return [{type: 'matrix', a: a, b: b, c: c, d: d, e: e, f: f}];\n    };\n  var peg$f3 = function(tx, ty) {\n      var t = {type: 'translate', tx: tx};\n      if (ty) t.ty = ty;\n      return [t];\n    };\n  var peg$f4 = function(sx, sy) {\n      var s = {type:'scale', sx: sx};\n      if (sy) s.sy = sy;\n      return [s];\n    };\n  var peg$f5 = function(angle, c) {\n      var r = {type:'rotate', angle: angle};\n      if (c) {\n        r.cx = c[0];\n        r.cy = c[1];\n      }\n      return [r];\n    };\n  var peg$f6 = function(angle) {\n      return [{type: 'skewX', angle: angle}];\n    };\n  var peg$f7 = function(angle) {\n      return [{type: 'skewY', angle: angle}];\n    };\n  var peg$f8 = function(f) { return parseFloat(f.join(\"\")); };\n  var peg$f9 = function(i) { return parseInt(i.join(\"\")); };\n  var peg$f10 = function(n) { return n; };\n  var peg$f11 = function(n1, n2) { return [n1, n2]; };\n  var peg$f12 = function(ds) { return ds.join(\"\"); };\n  var peg$f13 = function(f, e) { return [f, e || null].join(\"\")};\n  var peg$f14 = function(d, e) { return [d, e].join(\"\")};\n  var peg$f15 = function(d1, d2) { return [d1 ? d1.join(\"\") : null, \".\", d2.join(\"\")].join(\"\"); };\n  var peg$f16 = function(d) { return d.join(\"\"); };\n  var peg$f17 = function(s, d) { return ['e', s, d.join(\"\")].join(\"\") };\n  var peg$currPos = 0;\n  var peg$savedPos = 0;\n  var peg$posDetailsCache = [{ line: 1, column: 1 }];\n  var peg$maxFailPos = 0;\n  var peg$maxFailExpected = [];\n  var peg$silentFails = 0;\n\n  var peg$result;\n\n  if (\"startRule\" in options) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function offset() {\n    return peg$savedPos;\n  }\n\n  function range() {\n    return {\n      source: peg$source,\n      start: peg$savedPos,\n      end: peg$currPos\n    };\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos];\n    var p;\n\n    if (details) {\n      return details;\n    } else {\n      p = pos - 1;\n      while (!peg$posDetailsCache[p]) {\n        p--;\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line: details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos, offset) {\n    var startPosDetails = peg$computePosDetails(startPos);\n    var endPosDetails = peg$computePosDetails(endPos);\n\n    var res = {\n      source: peg$source,\n      start: {\n        offset: startPos,\n        line: startPosDetails.line,\n        column: startPosDetails.column\n      },\n      end: {\n        offset: endPos,\n        line: endPosDetails.line,\n        column: endPosDetails.column\n      }\n    };\n    if (offset && peg$source && (typeof peg$source.offset === \"function\")) {\n      res.start = peg$source.offset(res.start);\n      res.end = peg$source.offset(res.end);\n    }\n    return res;\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parsetransformList() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsewsp();\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = peg$parsewsp();\n    }\n    s2 = peg$parsetransforms();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = [];\n    s4 = peg$parsewsp();\n    while (s4 !== peg$FAILED) {\n      s3.push(s4);\n      s4 = peg$parsewsp();\n    }\n    peg$savedPos = s0;\n    s0 = peg$f0(s2);\n\n    return s0;\n  }\n\n  function peg$parsetransforms() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsetransform();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsecommaWsp();\n      if (s3 !== peg$FAILED) {\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsecommaWsp();\n        }\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsetransforms();\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f1(s1, s3);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsetransform();\n    }\n\n    return s0;\n  }\n\n  function peg$parsetransform() {\n    var s0;\n\n    s0 = peg$parsematrix();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsetranslate();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parsescale();\n        if (s0 === peg$FAILED) {\n          s0 = peg$parserotate();\n          if (s0 === peg$FAILED) {\n            s0 = peg$parseskewX();\n            if (s0 === peg$FAILED) {\n              s0 = peg$parseskewY();\n            }\n          }\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsematrix() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 6) === peg$c0) {\n      s1 = peg$c0;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e0); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWsp();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parsenumber();\n            if (s7 !== peg$FAILED) {\n              s8 = peg$parsecommaWsp();\n              if (s8 !== peg$FAILED) {\n                s9 = peg$parsenumber();\n                if (s9 !== peg$FAILED) {\n                  s10 = peg$parsecommaWsp();\n                  if (s10 !== peg$FAILED) {\n                    s11 = peg$parsenumber();\n                    if (s11 !== peg$FAILED) {\n                      s12 = peg$parsecommaWsp();\n                      if (s12 !== peg$FAILED) {\n                        s13 = peg$parsenumber();\n                        if (s13 !== peg$FAILED) {\n                          s14 = peg$parsecommaWsp();\n                          if (s14 !== peg$FAILED) {\n                            s15 = peg$parsenumber();\n                            if (s15 !== peg$FAILED) {\n                              s16 = [];\n                              s17 = peg$parsewsp();\n                              while (s17 !== peg$FAILED) {\n                                s16.push(s17);\n                                s17 = peg$parsewsp();\n                              }\n                              if (input.charCodeAt(peg$currPos) === 41) {\n                                s17 = peg$c2;\n                                peg$currPos++;\n                              } else {\n                                s17 = peg$FAILED;\n                                if (peg$silentFails === 0) { peg$fail(peg$e2); }\n                              }\n                              if (s17 !== peg$FAILED) {\n                                peg$savedPos = s0;\n                                s0 = peg$f2(s5, s7, s9, s11, s13, s15);\n                              } else {\n                                peg$currPos = s0;\n                                s0 = peg$FAILED;\n                              }\n                            } else {\n                              peg$currPos = s0;\n                              s0 = peg$FAILED;\n                            }\n                          } else {\n                            peg$currPos = s0;\n                            s0 = peg$FAILED;\n                          }\n                        } else {\n                          peg$currPos = s0;\n                          s0 = peg$FAILED;\n                        }\n                      } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                      }\n                    } else {\n                      peg$currPos = s0;\n                      s0 = peg$FAILED;\n                    }\n                  } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                  }\n                } else {\n                  peg$currPos = s0;\n                  s0 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsetranslate() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 9) === peg$c3) {\n      s1 = peg$c3;\n      peg$currPos += 9;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e3); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspNumber();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f3(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsescale() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c4) {\n      s1 = peg$c4;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e4); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspNumber();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f4(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parserotate() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 6) === peg$c5) {\n      s1 = peg$c5;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e5); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspTwoNumbers();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f5(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseskewX() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c6) {\n      s1 = peg$c6;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e6); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$parsewsp();\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s7 = peg$c2;\n            peg$currPos++;\n          } else {\n            s7 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f6(s5);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseskewY() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c7) {\n      s1 = peg$c7;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e7); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$parsewsp();\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s7 = peg$c2;\n            peg$currPos++;\n          } else {\n            s7 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f7(s5);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsenumber() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = peg$parsesign();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = peg$parsefloatingPointConstant();\n    if (s3 !== peg$FAILED) {\n      s2 = [s2, s3];\n      s1 = s2;\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f8(s1);\n    }\n    s0 = s1;\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$currPos;\n      s2 = peg$parsesign();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$parseintegerConstant();\n      if (s3 !== peg$FAILED) {\n        s2 = [s2, s3];\n        s1 = s2;\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f9(s1);\n      }\n      s0 = s1;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWspNumber() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecommaWsp();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsenumber();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f10(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWspTwoNumbers() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecommaWsp();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsenumber();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsecommaWsp();\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parsenumber();\n          if (s4 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f11(s2, s4);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWsp() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsewsp();\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        s2 = peg$parsewsp();\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsecomma();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = [];\n      s4 = peg$parsewsp();\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = peg$parsewsp();\n      }\n      s1 = [s1, s2, s3];\n      s0 = s1;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsecomma();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewsp();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewsp();\n        }\n        s1 = [s1, s2];\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomma() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 44) {\n      s0 = peg$c8;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e8); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseintegerConstant() {\n    var s0, s1;\n\n    s0 = peg$currPos;\n    s1 = peg$parsedigitSequence();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f12(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsefloatingPointConstant() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsefractionalConstant();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseexponent();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f13(s1, s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsedigitSequence();\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseexponent();\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f14(s1, s2);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsefractionalConstant() {\n    var s0, s1, s2, s3;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parsedigitSequence();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s2 = peg$c9;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e10); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsedigitSequence();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f15(s1, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsedigitSequence();\n      if (s1 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 46) {\n          s2 = peg$c9;\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e10); }\n        }\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f16(s1);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e9); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseexponent() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    if (peg$r0.test(input.charAt(peg$currPos))) {\n      s1 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e11); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsesign();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$parsedigitSequence();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f17(s2, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsesign() {\n    var s0;\n\n    if (peg$r1.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e12); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsedigitSequence() {\n    var s0, s1;\n\n    s0 = [];\n    s1 = peg$parsedigit();\n    if (s1 !== peg$FAILED) {\n      while (s1 !== peg$FAILED) {\n        s0.push(s1);\n        s1 = peg$parsedigit();\n      }\n    } else {\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsedigit() {\n    var s0;\n\n    if (peg$r2.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e13); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsewsp() {\n    var s0;\n\n    if (peg$r3.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e14); }\n    }\n\n    return s0;\n  }\n\n  peg$result = peg$startRuleFunction();\n\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n}\n\nexport {\n  peg$SyntaxError as SyntaxError,\n\n  peg$parse as parse\n};\n","import { scale } from './scale'\nimport { compose } from './transform'\n/**\n * Decompose a matrix into translation, scaling and rotation components, optionally\n * take horizontal and vertical flip in to consideration.\n * Note this function decomposes a matrix in rotation -> scaling -> translation order. I.e. for\n * certain translation T {tx, ty}, rotation R and scaling S { sx, sy }, it's only true for:\n *  decomposeTSR(compose(T, S, R)) === { translate: T, rotation: R, scale: S }\n * composing in a different order may yield a different decomposition result.\n * @param matrix {Matrix} Affine Matrix\n * @param  flipX {boolean} Whether the matrix contains vertical flip, i.e. mirrors on x-axis\n * @param  flipY {boolean} Whether the matrix contains horizontal flip, i.e. mirrors on y-axis\n * @returns {Transform} A transform object consisted by its translation, scaling\n * and rotation components.\n */\nexport function decomposeTSR (matrix, flipX = false, flipY = false) {\n  // Remove flip from the matrix first - flip could be incorrectly interpreted as\n  // rotations (e.g. flipX + flipY = rotate by 180 degrees).\n  // Note flipX is a vertical flip, and flipY is a horizontal flip.\n  if (flipX) {\n    if (flipY) {\n      matrix = compose(matrix, scale(-1, -1))\n    } else {\n      matrix = compose(matrix, scale(1, -1))\n    }\n  } else if (flipY) {\n    matrix = compose(matrix, scale(-1, 1))\n  }\n\n  const a = matrix.a; const b = matrix.b\n  const c = matrix.c; const d = matrix.d\n  let scaleX, scaleY, rotation\n\n  if (a !== 0 || c !== 0) {\n    const hypotAc = Math.hypot(a, c)\n    scaleX = hypotAc\n    scaleY = (a * d - b * c) / hypotAc\n    const acos = Math.acos(a / hypotAc)\n    rotation = c > 0 ? -acos : acos\n  } else if (b !== 0 || d !== 0) {\n    const hypotBd = Math.hypot(b, d)\n    scaleX = (a * d - b * c) / hypotBd\n    scaleY = hypotBd\n    const acos = Math.acos(b / hypotBd)\n    rotation = Math.PI / 2 + (d > 0 ? -acos : acos)\n  } else {\n    scaleX = 0\n    scaleY = 0\n    rotation = 0\n  }\n\n  // put the flip factors back\n  if (flipY) {\n    scaleX = -scaleX\n  }\n\n  if (flipX) {\n    scaleY = -scaleY\n  }\n\n  return {\n    translate: { tx: matrix.e, ty: matrix.f },\n    scale: { sx: scaleX, sy: scaleY },\n    rotation: { angle: rotation }\n  }\n}\n","\n/**\n * Tranformation matrix that mirrors on x-axis\n * @returns {Matrix} Affine Matrix\n */\nexport function flipX () {\n  return {\n    a: 1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: -1,\n    f: 0\n  }\n}\n\n/**\n * Tranformation matrix that mirrors on y-axis\n * @returns {Matrix} Affine Matrix\n */\nexport function flipY () {\n  return {\n    a: -1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: 1,\n    f: 0\n  }\n}\n\n/**\n * Tranformation matrix that mirrors on origin\n * @returns {Matrix} Affine Matrix\n */\nexport function flipOrigin () {\n  return {\n    a: -1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: -1,\n    f: 0\n  }\n}\n","import { translate } from './translate'\nimport { applyToPoint } from './applyToPoint'\nimport { rotate } from './rotate'\nimport { scale } from './scale'\nimport { compose } from './transform'\n\n// https://manivannan-ai.medium.com/find-the-angle-between-three-points-from-2d-using-python-348c513e2cd\n\n/**\n * Calculate a transformation matrix from a point that starts from A to A'\n * This approach can be associated to a pointer that moves on a device\n * @param {Point} startingPoint - Starting point (A)\n * @param {Point} endingPoint - Ending point (A')\n */\nexport function fromOneMovingPoint (startingPoint, endingPoint) {\n  const tx = endingPoint.x - startingPoint.x\n  const ty = endingPoint.y - startingPoint.y\n\n  return translate(tx, ty)\n}\n\n/**\n * Calculate a transformation matrix about two points that move from positions A and B to A' and B'\n * This approach can be associated to a two finger gesture on a touch device\n * @param {Point} startingPoint1 - Starting Point (A)\n * @param {Point} startingPoint2 - Starting Point (B)\n * @param {Point} endingPoint1 - Ending point (A')\n * @param {Point} endingPoint2 - Ending Point (B')\n */\nexport function fromTwoMovingPoints (startingPoint1, startingPoint2, endingPoint1, endingPoint2) {\n  // finds translation\n  const translationMatrix = fromOneMovingPoint(startingPoint1, endingPoint1)\n\n  const pointA = applyToPoint(translationMatrix, startingPoint2) // I have to translate this point\n  const center = endingPoint1\n  const pointB = endingPoint2\n\n  // finds rotation matrix\n  const angle = Math.atan2(pointB.y - center.y, pointB.x - center.x) - Math.atan2(pointA.y - center.y, pointA.x - center.x)\n  const rotationMatrix = rotate(angle, center.x, center.y)\n\n  // finds scale matrix\n  const d1 = Math.sqrt(Math.pow(pointA.x - center.x, 2) + Math.pow(pointA.y - center.y, 2))\n  const d2 = Math.sqrt(Math.pow(pointB.x - center.x, 2) + Math.pow(pointB.y - center.y, 2))\n  const scalingLevel = d2 / d1\n  const scalingMatrix = scale(scalingLevel, scalingLevel, center.x, center.y)\n\n  return compose([\n    translationMatrix,\n    scalingMatrix,\n    rotationMatrix\n  ])\n}\n","import {TViewportTransform, TViewportTransformXY} from '../project-viewport';\nimport {compose, Matrix, rotate, scale, translate} from 'transformation-matrix';\n\nexport function createTransformMatrix (transform: TViewportTransform | TViewportTransformXY): Matrix {\n    const scaleX = 'scale' in transform ? transform.scale : transform.scaleX;\n    const scaleY = 'scale' in transform ? transform.scale : transform.scaleY;\n    return compose(\n        translate(transform.x, transform.y),\n        rotate(transform.angleDeg / 180 * Math.PI),\n        scale(scaleX, scaleY),\n    );\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-zoom-in.65ed57a3.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-zoom-out.5ae00130.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"viewport-reset.86073886.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-hand.a8986b94.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-pencil.d49518db.svg\" + \"?\" + Date.now();","\nexport function zoomByStep (oldScale: number, stepNum: number): number {\n    const step = Math.log2(oldScale);\n\n    let newStep = step / Math.abs(stepNum);\n    newStep += stepNum > 0 ? 1 : -1;\n    newStep = Math.round(newStep);\n    newStep *= Math.abs(stepNum);\n\n    return Math.pow(2, newStep);\n}","import {TViewportTransform} from '../project-viewport';\nimport {IVector2D} from '../../../../bb/bb-types';\nimport {compose, rotate, scale as scaleFunc, applyToPoint} from 'transformation-matrix';\n\nexport function createTransform (\n    viewportPoint: IVector2D,\n    canvasPoint: IVector2D,\n    scale: number,\n    angleDeg: number,\n): TViewportTransform {\n    const mat = compose(\n        scaleFunc(-scale, -scale),\n        rotate(angleDeg / 180 * Math.PI),\n    );\n    const topLeftP = applyToPoint(mat, canvasPoint);\n    topLeftP.x += viewportPoint.x;\n    topLeftP.y += viewportPoint.y;\n    return {\n        x: topLeftP.x,\n        y: topLeftP.y,\n        scale,\n        angleDeg,\n    };\n}","import {createTransformMatrix} from './create-transform-matrix';\nimport {TViewportTransform} from '../project-viewport';\nimport {IVector2D} from '../../../../bb/bb-types';\nimport {inverse, applyToPoint} from 'transformation-matrix';\n\nexport type TMetaTransform = {\n    viewportP: IVector2D;\n    canvasP: IVector2D;\n    scale: number;\n    angleDeg: number;\n}\n\nexport function toMetaTransform (\n    transform: TViewportTransform,\n    viewportP: IVector2D,\n): TMetaTransform {\n    const m = createTransformMatrix(transform);\n    const canvasP = applyToPoint(inverse(m), viewportP);\n    return {\n        viewportP,\n        canvasP,\n        scale: transform.scale,\n        angleDeg: transform.angleDeg,\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-crop.045a6cdf.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {showModal} from './base/showModal';\nimport {CropCopy} from '../components/crop-copy';\nimport {LANG} from '../../../language/language';\nimport {StatusOverlay} from '../components/status-overlay';\nimport {ICropRect} from '../../../bb/bb-types';\n\nexport function clipboardDialog (\n    parent: HTMLElement,\n    fullCanvas: HTMLCanvasElement,\n    cropCallback: (crop: ICropRect) => void,\n    output: StatusOverlay,\n    showCropButton: boolean,\n): void {\n\n    let clipboardItemIsSupported: boolean = false;\n    try {\n        clipboardItemIsSupported = !!ClipboardItem;\n    } catch (e) { /* empty */ }\n\n    const div = document.createElement('div');\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n\n    const topWrapper = BB.el({\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\n        css: {\n            textAlign: 'center',\n        },\n    });\n    div.append(topWrapper);\n\n\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 350,\n        canvas: fullCanvas,\n        isNotCopy: false,\n        onChange: () => setTimeout(() => updateBlob()),\n    });\n    BB.css(cropCopy.getEl(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.append(cropCopy.getEl());\n\n    let blob: Blob | undefined = undefined;\n\n    // Safari doesn't allow any async operations between user interaction (click) and navigator.clipboard.write.\n    // It throws \"NotAllowedError: the request is not allowed by the user agent or the platform in the current context,\n    // possibly because the user denied permission.\"\n    // So, we try to prepare blob beforehand.\n    let cropTimeout: ReturnType<typeof setTimeout> | undefined;\n    function updateBlob () {\n        if (!clipboardItemIsSupported) {\n            return;\n        }\n        clearTimeout(cropTimeout);\n        cropTimeout = setTimeout(() => {\n            cropCopy.getCroppedCanvas().toBlob((result) => {\n                blob = result ?? undefined;\n            }, 'image/png');\n        }, 50);\n    }\n\n    async function toClipboard () {\n        if (!blob) {\n            return;\n        }\n        try {\n            await (navigator.clipboard as any).write([\n                new ClipboardItem({\n                    [blob.type]: blob,\n                }),\n            ]);\n            setTimeout(function () {\n                output.out(LANG('cropcopy-copied'), true);\n            }, 200);\n        } catch (err) {\n            console.error((err as Error).name, (err as Error).message);\n            return;\n        }\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr, KeyEvent, comboStr) {\n            if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                toClipboard();\n                closeFunc && closeFunc();\n            }\n        },\n    });\n\n    let closeFunc: () => void;\n    function blur () {\n        closeFunc && closeFunc();\n    }\n    window.addEventListener('blur', blur);\n\n    const buttonArr = [];\n    if (clipboardItemIsSupported) {\n        buttonArr.push(LANG('cropcopy-btn-copy'));\n    }\n    if (showCropButton) {\n        buttonArr.push(LANG('cropcopy-btn-crop'));\n    }\n    buttonArr.push('Cancel');\n\n    showModal({\n        target: parent,\n        message: '<b>' + (showCropButton ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\n        div: div,\n        style: isSmall ? {} : {\n            width: '540px',\n        },\n        buttons: buttonArr,\n        primaries: [LANG('cropcopy-btn-copy')],\n        callback: function (result) {\n            if (result === LANG('cropcopy-btn-copy')) {\n                toClipboard();\n            } else if (result === LANG('cropcopy-btn-crop')) {\n                const rectObj = cropCopy.getRect();\n                cropCallback({\n                    left: Math.round(-rectObj.x),\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\n                    top: Math.round(-rectObj.y),\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\n                });\n            }\n            window.removeEventListener('blur', blur);\n            BB.freeCanvas(cropCopy.getCroppedCanvas());\n            cropCopy.destroy();\n            keyListener.destroy();\n        },\n        clickOnEnter: LANG('cropcopy-btn-copy'),\n        closeFunc: function (func) {\n            closeFunc = func;\n        },\n    });\n}","import {BB} from '../../../../bb/bb';\nimport {klHistory} from '../../../history/kl-history';\nimport {Select} from '../../components/select';\nimport {PointSlider} from '../../components/point-slider';\nimport {KlCanvas, MAX_LAYERS} from '../../../canvas/kl-canvas';\nimport {TMixMode, TUiLayout} from '../../../kl-types';\nimport {LANG} from '../../../../language/language';\nimport {translateBlending} from '../../../canvas/translate-blending';\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\nimport {IPointerEvent} from '../../../../bb/input/event.types';\nimport {renameLayerDialog} from './rename-layer-dialog';\nimport {mergeLayerDialog} from './merge-layer-dialog';\nimport {theme} from '../../../../theme/theme';\nimport {throwIfNull} from '../../../../bb/base/base';\nimport {hasPointerEvents} from '../../../../bb/base/browser';\nimport {c} from '../../../../bb/base/c';\nimport {DropdownMenu} from '../../components/dropdown-menu';\nimport addLayerImg from '/src/app/img/ui/add-layer.svg';\nimport duplicateLayerImg from '/src/app/img/ui/duplicate-layer.svg';\nimport mergeLayerImg from '/src/app/img/ui/merge-layers.svg';\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\nimport renameLayerImg from '/src/app/img/ui/rename-layer.svg';\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\n\ntype TLayerEl = HTMLElement & {\n    label: HTMLElement;\n    opacityLabel: HTMLElement;\n    thumb: HTMLCanvasElement;\n\n    spot: number;\n    posY: number;\n    layerName: string;\n    opacity: number;\n    pointerListener: PointerListener;\n    opacitySlider: PointSlider;\n    isSelected: boolean;\n};\n\nconst paddingLeft = 25;\n\nexport class LayerManager {\n\n    private readonly parentEl: HTMLElement;\n    private readonly rootEl: HTMLElement;\n    private readonly klCanvas: KlCanvas;\n    private klCanvasLayerArr: {\n        context: CanvasRenderingContext2D;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[];\n    private readonly layerListEl: HTMLElement;\n    private layerElArr: TLayerEl[];\n    private selectedSpotIndex: number;\n    private readonly removeBtn: HTMLButtonElement;\n    private readonly addBtn: HTMLButtonElement;\n    private readonly duplicateBtn: HTMLButtonElement;\n    private readonly mergeBtn: HTMLButtonElement;\n    private readonly moreDropdown: DropdownMenu;\n    private readonly modeSelect: Select<TMixMode>;\n    private uiState: TUiLayout;\n    private readonly largeThumbDiv: HTMLElement;\n    private oldHistoryState: number | undefined;\n\n    private readonly largeThumbCanvas: HTMLCanvasElement;\n    private largeThumbInDocument: boolean;\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\n    private lastpos: number = 0;\n\n    private readonly onSelect: (layerIndex: number) => void;\n    private readonly layerHeight: number = 35;\n    private readonly layerSpacing: number = 0;\n\n    private move (oldSpotIndex: number, newSpotIndex: number): void {\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\n            throw 'layermanager - invalid move';\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            ((i) => {\n                let posy = this.layerElArr[i].spot; // <- here\n                if (this.layerElArr[i].spot === oldSpotIndex) {\n                    posy = newSpotIndex;\n                } else {\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\n                        posy--;\n                    }\n                    if (posy >= newSpotIndex) {\n                        posy++;\n                    }\n                }\n                this.layerElArr[i].spot = posy;\n                this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\n            })(i);\n        }\n        if (oldSpotIndex === newSpotIndex) {\n            return;\n        }\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = newSpotIndex;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n\n    private posToSpot (p: number): number {\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\n        result = this.klCanvasLayerArr.length - result - 1;\n        return result;\n    }\n\n    /**\n     * update css position of all layers that are not being dragged, while dragging\n     */\n    private updateLayersVerticalPosition (id: number, newspot: number): void {\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\n        if (newspot === this.lastpos) {\n            return;\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            if (this.layerElArr[i].spot === id) { // <- here\n                continue;\n            }\n            let posy = this.layerElArr[i].spot;\n            if (this.layerElArr[i].spot > id) {\n                posy--;\n            }\n            if (posy >= newspot) {\n                posy++;\n            }\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\n        }\n        this.lastpos = newspot;\n    }\n\n    private renameLayer (layerSpot: number): void {\n\n        renameLayerDialog(\n            this.parentEl,\n            this.klCanvas.getLayer(layerSpot)!.name,\n            (newName) => {\n                if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot)!.name) {\n                    return;\n                }\n                this.klCanvas.renameLayer(layerSpot, newName);\n                this.createLayerList();\n                klHistory.pause(true);\n                this.onSelect(layerSpot);\n                klHistory.pause(false);\n            }\n        );\n    }\n\n    private updateHeight (): void {\n        this.layerListEl.style.height = (this.layerElArr.length * 35) + 'px';\n    }\n\n    private createLayerList (): void {\n        this.oldHistoryState = klHistory.getState();\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        const checkerImUrl = BB.createCheckerDataUrl(4, undefined, theme.isDark());\n\n        const createLayerEntry = (index: number): void => {\n            const klLayer = throwIfNull(this.klCanvas.getLayer(index));\n            const layerName = klLayer.name;\n            const opacity = this.klCanvasLayerArr[index].opacity;\n            const isVisible = klLayer.isVisible;\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\n\n            const layer: TLayerEl = BB.el({\n                className: 'kl-layer',\n            }) as HTMLElement as TLayerEl;\n            this.layerElArr[index] = layer;\n            layer.posY = ((this.klCanvasLayerArr.length - 1) * 35 - index * 35);\n            BB.css(layer, {\n                top: layer.posY + 'px',\n            });\n            const innerLayer = BB.el();\n            BB.css(innerLayer, {\n                position: 'relative',\n            });\n\n            const container1 = BB.el();\n            BB.css(container1, {\n                width: '270px',\n                height: '34px',\n            });\n            const container2 = BB.el();\n            layer.append(innerLayer);\n            innerLayer.append(container1, container2);\n\n            layer.spot = index;\n\n            //checkbox - visibility\n            {\n                const checkWrapper = BB.el({\n                    tagName: 'label',\n                    parent: container1,\n                    title: LANG('layers-visibility-toggle'),\n                    css: {\n                        display: 'flex',\n                        width: '25px',\n                        height: '100%',\n                        justifyContent: 'right',\n                        alignItems: 'center',\n                        cursor: 'pointer',\n                    },\n                });\n                const check = BB.el({\n                    tagName: 'input',\n                    parent: checkWrapper,\n                    custom: {\n                        type: 'checkbox',\n                        tabindex: '-1',\n                    },\n                    css: {\n                        display: 'block',\n                        cursor: 'pointer',\n                        margin: '0',\n                        marginRight: '5px',\n                    },\n                });\n                check.checked = isVisible;\n                check.onchange = () => {\n                    this.klCanvas.setLayerIsVisible(layer.spot, check.checked);\n                    this.createLayerList();\n                    if (layer.spot === this.selectedSpotIndex) {\n                        klHistory.pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        klHistory.pause(false);\n                    }\n                };\n                // prevent layer getting dragged\n                const preventFunc = (e: PointerEvent | MouseEvent) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                };\n                if (hasPointerEvents) {\n                    checkWrapper.onpointerdown = preventFunc;\n                } else {\n                    checkWrapper.onmousedown = preventFunc;\n                }\n            }\n\n\n            //thumb\n            {\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\n                layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n\n                const thc = BB.ctx(layer.thumb);\n                thc.save();\n                if (layer.thumb.width > layercanvas.width) {\n                    thc.imageSmoothingEnabled = false;\n                }\n                thc.drawImage(layercanvas, 0, 0, layer.thumb.width, layer.thumb.height);\n                thc.restore();\n                BB.css(layer.thumb, {\n                    position: 'absolute',\n                    left: ((32 - layer.thumb.width) / 2 + paddingLeft) + 'px',\n                    top: ((32 - layer.thumb.height) / 2 + 1) + 'px',\n                });\n                layer.thumb.style.backgroundImage = 'url(' + checkerImUrl + ')';\n            }\n\n            //layerlabel\n            {\n                layer.label = BB.el({\n                    className: 'kl-layer__label',\n                });\n                layer.layerName = layerName;\n                layer.label.append(layer.layerName);\n\n                BB.css(layer.label, {\n                    position: 'absolute',\n                    left: (1 + 32 + 5 + paddingLeft) + 'px',\n                    top: 1 + 'px',\n                    fontSize: '13px',\n                    width: '170px',\n                    height: '20px',\n                    overflow: 'hidden',\n                    whiteSpace: 'nowrap',\n                });\n\n                layer.label.ondblclick = () => {\n                    this.renameLayer(layer.spot);\n                };\n            }\n            //layer label opacity\n            {\n                layer.opacityLabel = BB.el({\n                    className: 'kl-layer__opacity-label',\n                });\n                layer.opacity = opacity;\n                layer.opacityLabel.append(parseInt('' + (layer.opacity * 100)) + '%');\n\n                BB.css(layer.opacityLabel, {\n                    position: 'absolute',\n                    left: (250 - 1 - 5 - 50 - 5 + paddingLeft) + 'px',\n                    top: 1 + 'px',\n                    fontSize: '13px',\n                    textAlign: 'right',\n                    width: '50px',\n                    transition: 'color 0.2s ease-in-out',\n                    textDecoration: isVisible ? undefined : 'line-through',\n                });\n            }\n\n            let oldOpacity: number;\n            const opacitySlider = new PointSlider({\n                init: layer.opacity,\n                width: 200,\n                pointSize: 14,\n                callback: (sliderValue, isFirst, isLast) => {\n                    if (isFirst) {\n                        oldOpacity = this.klCanvas.getLayer(layer.spot)!.opacity;\n                        klHistory.pause(true);\n                        return;\n                    }\n                    if (isLast) {\n                        klHistory.pause(false);\n                        if (oldOpacity !== sliderValue) {\n                            this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                        }\n                        return;\n                    }\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                },\n            });\n            BB.css(opacitySlider.getEl(), {\n                position: 'absolute',\n                left: (39 + paddingLeft) + 'px',\n                top: '17px',\n            });\n            layer.opacitySlider = opacitySlider;\n\n            //larger layer preview - hover\n            layer.thumb.onpointerover = (e) => {\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\n                    return;\n                }\n\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\n\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\n                    this.largeThumbCanvas.width = thumbDimensions.width;\n                    this.largeThumbCanvas.height = thumbDimensions.height;\n                }\n                const ctx = BB.ctx(this.largeThumbCanvas);\n                ctx.save();\n                if (this.largeThumbCanvas.width > layercanvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.imageSmoothingQuality = 'high';\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.restore();\n                BB.css(this.largeThumbDiv, {\n                    top: (e.clientY - this.largeThumbCanvas.height / 2) + 'px',\n                    opacity: '0',\n                });\n                if (!this.largeThumbInDocument) {\n                    document.body.append(this.largeThumbDiv);\n                    this.largeThumbInDocument = true;\n                }\n                clearTimeout(this.largeThumbInTimeout);\n                this.largeThumbInTimeout = setTimeout(() => {\n                    BB.css(this.largeThumbDiv, {\n                        opacity: '1',\n                    });\n                }, 20);\n                clearTimeout(this.largeThumbTimeout);\n            };\n            layer.thumb.onpointerout = () => {\n                clearTimeout(this.largeThumbInTimeout);\n                BB.css(this.largeThumbDiv, {\n                    opacity: '0',\n                });\n                clearTimeout(this.largeThumbTimeout);\n                this.largeThumbTimeout = setTimeout(() => {\n                    if (!this.largeThumbInDocument) {\n                        return;\n                    }\n                    this.largeThumbDiv.remove();\n                    this.largeThumbInDocument = false;\n                }, 300);\n            };\n\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\n            let dragstart = false;\n            let freshSelection = false;\n\n            //events for moving layers up and down\n            const dragEventHandler = (event: IPointerEvent) => {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    BB.css(layer, {\n                        transition: 'box-shadow 0.3s ease-in-out',\n                    });\n                    layer.style.zIndex = '1';\n                    this.lastpos = layer.spot;\n                    freshSelection = false;\n                    if (!layer.isSelected) {\n                        freshSelection = true;\n                        this.activateLayer(layer.spot);\n                    }\n                    dragstart = true;\n\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n\n                    if (dragstart) {\n                        dragstart = false;\n                        BB.css(layer, {\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\n                        });\n                    }\n                    layer.posY += event.dY;\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\n                    layer.style.top = corrected + 'px';\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\n\n                }\n                if (event.type === 'pointerup') {\n                    BB.css(layer, {\n                        transition: 'all 0.1s linear',\n                    });\n                    setTimeout(() => {\n                        BB.css(layer, {\n                            boxShadow: '',\n                        });\n                    }, 20);\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\n                    layer.style.zIndex = '';\n                    const newSpot = this.posToSpot(layer.posY);\n                    const oldSpot = layer.spot;\n                    this.move(layer.spot, newSpot);\n                    if (oldSpot != newSpot) {\n                        klHistory.pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        klHistory.pause(false);\n                    }\n                    if (oldSpot === newSpot && freshSelection) {\n                        this.onSelect(this.selectedSpotIndex);\n                    }\n                    freshSelection = false;\n                }\n            };\n\n            layer.pointerListener = new BB.PointerListener({\n                target: container1,\n                onPointer: dragEventHandler,\n            });\n\n            this.layerListEl.append(layer);\n        };\n        this.layerElArr = [];\n        while (this.layerListEl.firstChild) {\n            const child = this.layerListEl.firstChild as TLayerEl;\n            child.pointerListener.destroy();\n            child.opacitySlider.destroy();\n            child.remove();\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            createLayerEntry(i);\n        }\n        this.activateLayer(this.selectedSpotIndex);\n        this.updateHeight();\n    }\n\n    private updateButtons (): void {\n        const maxReached = this.klCanvasLayerArr.length === MAX_LAYERS;\n        const oneLayer = this.klCanvasLayerArr.length === 1;\n\n        this.addBtn.disabled = maxReached;\n        this.removeBtn.disabled = oneLayer;\n        this.duplicateBtn.disabled = maxReached;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n        this.moreDropdown.setEnabled('merge-all', !oneLayer);\n    }\n\n\n    // ---- public ----\n    constructor (\n        klCanvas: KlCanvas,\n        onSelect: (layerIndex: number) => void,\n        parentEl: HTMLElement,\n        uiState: TUiLayout,\n    ) {\n        this.parentEl = parentEl;\n        this.klCanvas = klCanvas;\n        this.layerElArr = [];\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        const width = 270;\n        this.onSelect = onSelect;\n        this.uiState = uiState;\n\n        this.largeThumbDiv = BB.el({\n            onClick: BB.handleClick,\n            css: {\n                position: 'absolute',\n                top: '500px',\n                background: '#aaa',\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n                pointerEvents: 'none',\n                padding: '0',\n                border: '1px solid #aaa',\n                transition: 'opacity 0.3s ease-out',\n                userSelect: 'none',\n            },\n        });\n        this.setUiState(uiState);\n        BB.createCheckerDataUrl(4, (url) => {\n            this.largeThumbDiv.style.backgroundImage = 'url(' + url + ')';\n        }, theme.isDark());\n        this.largeThumbCanvas = BB.canvas(200, 200);\n        this.largeThumbCanvas.style.display = 'block';\n        this.largeThumbDiv.append(this.largeThumbCanvas);\n        this.largeThumbInDocument = false;\n\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\n        this.rootEl = BB.el({\n            css: {\n                marginRight: '10px',\n                marginBottom: '10px',\n                marginLeft: '10px',\n                marginTop: '10px',\n                cursor: 'default',\n            },\n        });\n\n        const listDiv = BB.el({\n            css: {\n                width: width + 'px',\n                position: 'relative',\n                margin: '0 -10px',\n                zIndex: '0',\n            },\n        });\n\n        this.layerListEl = BB.el({\n            parent: listDiv,\n        });\n\n        this.addBtn = BB.el({tagName: 'button'});\n        this.duplicateBtn = BB.el({tagName: 'button'});\n        this.mergeBtn = BB.el({tagName: 'button'});\n        this.removeBtn = BB.el({tagName: 'button'});\n        const renameBtn = BB.el({tagName: 'button'});\n        this.moreDropdown = new DropdownMenu({\n            button: BB.el({\n                content: `<img src=\"${caretDownImg}\" width=\"13\"/>`,\n                css: {\n                    display: 'flex',\n                    justifyContent: 'center',\n                    opacity: '0.9',\n                },\n            }),\n            buttonTitle: LANG('more'),\n            items: [\n                ['merge-all', LANG('layers-merge-all')],\n            ],\n            onItemClick: (id) => {\n                if (id === 'merge-all') {\n                    const newIndex = this.klCanvas.mergeAll();\n                    if (newIndex === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.selectedSpotIndex = newIndex;\n\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                }\n            },\n        });\n\n        this.updateButtons();\n\n        const createButtons = () => {\n            const div = BB.el();\n            const async = () => {\n                BB.makeUnfocusable(this.addBtn);\n                BB.makeUnfocusable(this.duplicateBtn);\n                BB.makeUnfocusable(this.mergeBtn);\n                BB.makeUnfocusable(this.removeBtn);\n                BB.makeUnfocusable(renameBtn);\n\n                this.addBtn.style.cssFloat = 'left';\n                this.duplicateBtn.style.cssFloat = 'left';\n                this.mergeBtn.style.cssFloat = 'left';\n                this.removeBtn.style.cssFloat = 'left';\n                renameBtn.style.cssFloat = 'left';\n\n                this.addBtn.title = LANG('layers-new');\n                this.duplicateBtn.title = LANG('layers-duplicate');\n                this.removeBtn.title = LANG('layers-remove');\n                this.mergeBtn.title = LANG('layers-merge');\n                renameBtn.title = LANG('layers-rename-title');\n\n                this.addBtn.style.paddingLeft = '5px';\n                this.addBtn.style.paddingRight = '3px';\n\n                this.removeBtn.style.paddingLeft = '5px';\n                this.removeBtn.style.paddingRight = '3px';\n\n                this.duplicateBtn.style.paddingLeft = '5px';\n                this.duplicateBtn.style.paddingRight = '3px';\n\n                this.mergeBtn.style.paddingLeft = '5px';\n                this.mergeBtn.style.paddingRight = '3px';\n\n                renameBtn.style.height = '30px';\n                renameBtn.style.lineHeight = '20px';\n\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\n                div.append(\n                    c(',flex,gap-5,mb-10', [\n                        this.addBtn,\n                        this.removeBtn,\n                        this.duplicateBtn,\n                        this.mergeBtn,\n                        renameBtn,\n                        c(',grow-1'),\n                        this.moreDropdown.getElement(),\n                    ]),\n                );\n\n                this.addBtn.onclick = () => {\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.duplicateBtn.onclick = () => {\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n                    this.selectedSpotIndex++;\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.removeBtn.onclick = () => {\n                    if (this.layerElArr.length <= 1) {\n                        return;\n                    }\n\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\n                    if (this.selectedSpotIndex > 0) {\n                        this.selectedSpotIndex--;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.mergeBtn.onclick = () => {\n                    if (this.selectedSpotIndex <= 0) {\n                        return;\n                    }\n                    mergeLayerDialog(this.parentEl, {\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex)!.opacity,\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\n                        callback: (mode) => {\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode as TMixMode | 'as-alpha');\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\n                            this.selectedSpotIndex--;\n\n                            this.createLayerList();\n                            klHistory.pause(true);\n                            this.onSelect(this.selectedSpotIndex);\n                            klHistory.pause(false);\n\n                            this.updateButtons();\n                        },\n                    });\n                };\n\n                renameBtn.onclick = () => {\n                    this.renameLayer(this.selectedSpotIndex);\n                };\n            };\n            setTimeout(async, 1);\n            return div;\n        };\n        this.rootEl.append(createButtons());\n\n        let modeWrapper;\n        {\n            modeWrapper = BB.el({\n                content: LANG('layers-blending') + '&nbsp;',\n                css: {\n                    fontSize: '15px',\n                },\n            });\n\n            this.modeSelect = new Select<TMixMode>({\n                optionArr: [\n                    'source-over',\n                    undefined,\n                    'darken',\n                    'multiply',\n                    'color-burn',\n                    undefined,\n                    'lighten',\n                    'screen',\n                    'color-dodge',\n                    undefined,\n                    'overlay',\n                    'soft-light',\n                    'hard-light',\n                    undefined,\n                    'difference',\n                    'exclusion',\n                    undefined,\n                    'hue',\n                    'saturation',\n                    'color',\n                    'luminosity',\n                ].map((item: any) => {\n                    return item ? [item, translateBlending(item)] : undefined;\n                }),\n                onChange: (val) => {\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\n                    this.update(this.selectedSpotIndex);\n                },\n                css: {\n                    marginBottom: '10px',\n                },\n            });\n\n            modeWrapper.append(this.modeSelect.getElement());\n            this.rootEl.append(modeWrapper);\n\n        }\n\n\n        this.rootEl.append(listDiv);\n\n        //updating the thumbs in interval\n        //don't update when: manager not visible || layer didn't change || is drawing\n        setInterval(() => {\n            if (this.rootEl.style.display !== 'block') {\n                return;\n            }\n\n            const historyState = klHistory.getState();\n            if (historyState === this.oldHistoryState) {\n                return;\n            }\n            this.oldHistoryState = historyState;\n\n            for (let i = 0; i < this.layerElArr.length; i++) {\n                if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) { // second check, because might be out of date\n                    const ctx = BB.ctx(this.layerElArr[i].thumb);\n                    ctx.save();\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                    if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) {\n                        ctx.imageSmoothingEnabled = false;\n                    }\n                    ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\n                    ctx.restore();\n                }\n            }\n\n        }, 1);\n\n        theme.addIsDarkListener(() => {\n            this.createLayerList();\n        });\n\n        this.createLayerList();\n    }\n\n    // ---- interface ----\n    update (activeLayerSpotIndex?: number): void {\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\n            this.selectedSpotIndex = activeLayerSpotIndex;\n        }\n        this.updateButtons();\n        setTimeout(() => this.createLayerList(), 1);\n    }\n\n    getSelected (): number {\n        return this.selectedSpotIndex;\n    }\n\n    activateLayer (spotIndex: number): void {\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length;\n        }\n        this.selectedSpotIndex = spotIndex;\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\n        for (let i = 0; i < this.layerElArr.length; i++) {\n            const layer = this.layerElArr[i];\n            const isSelected = this.selectedSpotIndex === layer.spot;\n\n            BB.css(layer, {\n                boxShadow: '',\n            });\n            layer.classList.toggle('kl-layer--selected', isSelected);\n            layer.opacitySlider.setActive(isSelected);\n            layer.isSelected = isSelected;\n        }\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n\n    setUiState (stateStr: TUiLayout): void {\n        this.uiState = stateStr;\n\n        if (this.uiState === 'left') {\n            BB.css(this.largeThumbDiv, {\n                left: '280px',\n                right: '',\n            });\n        } else {\n            BB.css(this.largeThumbDiv, {\n                left: '',\n                right: '280px',\n            });\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {floodFillBits} from '../image-operations/flood-fill';\nimport {drawShape} from '../image-operations/shape-tool';\nimport {TRenderTextParam, renderText} from '../image-operations/render-text';\nimport {IGradient, IKlProject, IRGB, IShapeToolObject, TFillSampling, TKlCanvasLayer, TMixMode} from '../kl-types';\nimport {DecoyKlHistory, KlHistoryInterface, THistoryActions} from '../history/kl-history';\nimport {drawProject} from './draw-project';\nimport {LANG} from '../../language/language';\nimport {drawGradient} from '../image-operations/gradient-tool';\nimport {nullToUndefined} from '../../bb/base/base';\n\n\n// TODO remove in 2026\n// workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n// reported 2021-13 (v96), fixed 2022-02 (v99)\n// affects: source-in, source-out, destination-in, destination-atop\nfunction workaroundForChromium1281185 (ctx: CanvasRenderingContext2D): void {\n    ctx.save();\n    ctx.fillStyle = 'rgba(0,0,0,0.01)';\n    ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n    ctx.restore();\n}\n\nexport type TKlCanvasHistoryEntry = THistoryActions<'canvas', KlCanvas>;\n\nconst allowedMixModes = [\n    'source-over',\n    'darken',\n    'multiply',\n    'color-burn',\n    'lighten',\n    'screen',\n    'color-dodge',\n    'overlay',\n    'soft-light',\n    'hard-light',\n    'difference',\n    'exclusion',\n    'hue',\n    'saturation',\n    'color',\n    'luminosity',\n] as const;\n\nexport const MAX_LAYERS = 16;\n\nexport interface KlCanvasLayer extends HTMLCanvasElement {\n    name: string;\n    mixModeStr: TMixMode;\n    isVisible: boolean;\n    opacity: number;\n    compositeObj?: {\n        draw: (ctx: CanvasRenderingContext2D) => void;\n    };\n    index: number; // certain brushes need to know\n}\n\nexport type KlCanvasContext = CanvasRenderingContext2D & {\n    canvas: KlCanvasLayer;\n};\n\n/**\n * The image/canvas that the user paints on\n * Has layers. layers have names and opacity.\n *\n * Interacts with the history you specify (for undo/redo)\n */\nexport class KlCanvas {\n\n    // todo changeListener consistent concept\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\n\n    private isDestroyed = false;\n    private width: number;\n    private height: number;\n    private layerCanvasArr: KlCanvasLayer[];\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\n    private history: KlHistoryInterface;\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\n\n\n    private init (w: number, h: number): void {\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\n        }\n        this.width = w;\n        this.height = h;\n    }\n\n    private emitChange (): void {\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\n        this.changeListenerArr.forEach(item => item());\n    }\n\n    private updateIndices (): void {\n        this.layerCanvasArr.forEach((item, index) => {\n            item.index = index;\n        });\n    }\n\n    // ---- public ----\n\n    constructor (\n        params: {\n            projectObj: IKlProject;\n        } | {\n            // creates blank KlCanvas, 0 layers\n            width: number;\n            height: number;\n        } | {\n            copy: KlCanvas;\n        },\n        private layerNrOffset: number = 0,\n    ) {\n        this.layerCanvasArr = [];\n        this.pickCanvas = BB.canvas(1, 1);\n        this.history = new DecoyKlHistory();\n        if ('copy' in params) {\n            this.width = 1;\n            this.height = 1;\n        } else {\n            if ('width' in params && 'height' in params) {\n                this.width = params.width;\n                this.height = params.height;\n            } else {\n                this.width = 1;\n                this.height = 1;\n            }\n        }\n        this.init(this.width, this.height);\n\n        this.changeListenerArr = [];\n\n        if ('copy' in params) {\n            try {\n                this.copy(params.copy);\n            } catch (e) {\n                this.destroy();\n                throw e;\n            }\n        } else if ('projectObj' in params) {\n            const inLayers = [...params.projectObj.layers];\n            this.init(params.projectObj.width, params.projectObj.height);\n\n            if (!inLayers.length) {\n                throw new Error('project.layers needs at least 1 layer');\n            }\n\n            for (let i = 0; i < inLayers.length; i++) {\n                const mixModeStr = inLayers[i].mixModeStr;\n                if (mixModeStr && !allowedMixModes.includes(mixModeStr)) {\n                    throw new Error('unknown mixModeStr ' + inLayers[i].mixModeStr);\n                }\n\n                this.addLayer();\n                this.layerOpacity(i, inLayers[i].opacity);\n                this.layerCanvasArr[i].name = inLayers[i].name;\n                this.layerCanvasArr[i].isVisible = inLayers[i].isVisible;\n                this.layerCanvasArr[i].mixModeStr = mixModeStr || 'source-over';\n                BB.ctx(this.layerCanvasArr[i]).drawImage(inLayers[i].image, 0, 0);\n            }\n        }\n        this.updateIndices();\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    /**\n     * Resets canvas -> 1 layer, 100% opacity,\n     * unless layers provided.\n     * @param p\n     */\n    reset (\n        p: {\n            width: number;\n            height: number;\n            color?: IRGB; // optional - fill color\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\n            layerName?: string; // if via image\n            layers?: {\n                name: string;\n                isVisible: boolean;\n                opacity: number;\n                mixModeStr: TMixMode;\n                image: HTMLCanvasElement;\n            }[];\n        }\n    ): number {\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\n            throw new Error('invalid canvas size');\n        }\n\n        this.history.pause(true);\n\n        this.width = p.width;\n        this.height = p.height;\n\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\n\n        if (p.layers) {\n            for (let i = 0; i < p.layers.length; i++) {\n                const item = p.layers[i];\n                if (!this.layerCanvasArr[i]) {\n                    this.addLayer();\n                }\n                this.layerCanvasArr[i].name = item.name;\n                this.layerCanvasArr[i].isVisible = item.isVisible;\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\n                BB.ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\n                this.layerOpacity(i, item.opacity);\n            }\n        } else {\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\n            this.layerCanvasArr[0].isVisible = true;\n            this.layerCanvasArr[0].width = this.width;\n            this.layerCanvasArr[0].height = this.height;\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\n            this.layerOpacity(0, 1);\n            if (p.color) {\n                this.layerFill(0, p.color);\n            } else if (p.image) {\n                BB.ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\n            }\n        }\n        this.updateIndices();\n\n        this.history.pause(false);\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'reset',\n            params: [p], // don't modify with p\n        } as TKlCanvasHistoryEntry);\n\n        return this.layerCanvasArr.length - 1;\n    }\n\n    isLayerLimitReached (): boolean {\n        return this.layerCanvasArr.length >= MAX_LAYERS;\n    }\n\n    getWidth (): number {\n        return this.width;\n    }\n\n    getHeight (): number {\n        return this.height;\n    }\n\n    copy (toCopyCanvas: KlCanvas): void {\n        if (\n            toCopyCanvas.getWidth() < 1 ||\n            toCopyCanvas.getHeight() < 1 ||\n            isNaN(toCopyCanvas.getWidth()) ||\n            isNaN(toCopyCanvas.getHeight())\n        ) {\n            throw new Error('invalid canvas size');\n        }\n\n        // keep existing canvases\n\n        const origLayers = toCopyCanvas.getLayers();\n\n        while (this.layerCanvasArr.length > origLayers.length) {\n            this.removeLayer(this.layerCanvasArr.length - 1);\n        }\n\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\n        }\n        for (let i = 0; i < origLayers.length; i++) {\n            if (i >= this.layerCanvasArr.length) {\n                this.addLayer();\n            } else {\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n            }\n            this.layerOpacity(i, origLayers[i].opacity);\n            this.layerCanvasArr[i].name = origLayers[i].name;\n            this.layerCanvasArr[i].isVisible = origLayers[i].isVisible;\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\n            BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\n        }\n        this.updateIndices();\n    }\n\n    getLayerCount (): number {\n        return this.layerCanvasArr.length;\n    }\n\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\n            return false;\n        }\n        w = Math.max(w, 1);\n        h = Math.max(h, 1);\n\n        let tmp1, tmp2;\n\n        if (algorithm === 'pixelated') {\n            tmp1 = BB.canvas(w, h);\n            const tmp1Ctx = BB.ctx(tmp1);\n            tmp1Ctx.imageSmoothingEnabled = false;\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\n                if (i > 0) {\n                    tmp1Ctx.clearRect(0, 0, w, h);\n                }\n                const layerCanvas = this.layerCanvasArr[i];\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\n                layerCanvas.width = w;\n                layerCanvas.height = h;\n                const layerContext = BB.ctx(layerCanvas);\n                layerContext.drawImage(tmp1, 0, 0);\n            }\n\n        } else if (algorithm === 'smooth') {\n            tmp1 = BB.canvas();\n            tmp2 = BB.canvas();\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\n            }\n        } else {\n            throw new Error('unknown resize algorithm');\n        }\n\n        this.width = w;\n        this.height = h;\n        return true;\n    }\n\n    /**\n     * crop / extend\n     * @param p\n     */\n    resizeCanvas (p: {\n        left: number;\n        top: number;\n        right: number;\n        bottom: number;\n        fillColor?: IRGB;\n    }): void {\n\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\n        const offX = Math.round(p.left);\n        const offY = Math.round(p.top);\n\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\n        }\n\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            const ctemp = BB.canvas(this.width, this.height);\n            const layerCanvas = this.layerCanvasArr[i];\n            const layerCtx = BB.ctx(this.layerCanvasArr[i]);\n            BB.ctx(ctemp).drawImage(layerCanvas, 0, 0);\n\n            this.layerCanvasArr[i].width = newW;\n            this.layerCanvasArr[i].height = newH;\n\n            layerCtx.save();\n            if (i === 0 && p.fillColor) {\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\n                layerCtx.fillRect(0, 0, newW, newH);\n                layerCtx.clearRect(offX, offY, this.width, this.height);\n            }\n            layerCtx.drawImage(ctemp, offX, offY);\n            layerCtx.restore();\n        }\n        this.width = newW;\n        this.height = newH;\n    }\n\n    /**\n     * will be inserted on top of selected\n     * @param selected\n     */\n    addLayer (selected?: number): false | number {\n        if (this.isLayerLimitReached()) {\n            return false;\n        }\n        const canvas = BB.canvas(this.width, this.height) as KlCanvasLayer;\n        if (!canvas.getContext('2d')) {\n            throw new Error('kl-create-canvas-error');\n        }\n\n        canvas.isVisible = true;\n        canvas.mixModeStr = 'source-over';\n\n        if (selected === undefined) {\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas;\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\n        } else {\n            this.layerCanvasArr.splice(selected + 1, 0, canvas);\n            selected++;\n        }\n\n        canvas.name = LANG('layers-layer') + ' ' + (this.layerCanvasArr.length + this.layerNrOffset);\n        this.history.pause(true);\n        this.layerOpacity(selected, 1);\n        this.history.pause(false);\n        this.updateIndices();\n        this.history.push({\n            tool: ['canvas'],\n            action: 'addLayer',\n            params: [selected - 1],\n        } as TKlCanvasHistoryEntry);\n        return selected;\n    }\n\n    duplicateLayer (i: number): false | number {\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\n            return false;\n        }\n        const canvas = BB.canvas(this.width, this.height) as KlCanvasLayer;\n        this.layerCanvasArr.splice(i + 1, 0, canvas);\n\n        canvas.name = this.layerCanvasArr[i].name + ' ' + LANG('layers-copy');\n        canvas.isVisible = this.layerCanvasArr[i].isVisible;\n        canvas.mixModeStr = this.layerCanvasArr[i].mixModeStr;\n        // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\n        // todo replace with simple drawImage eventually when fixed\n        BB.ctx(canvas).putImageData(BB.ctx(this.layerCanvasArr[i]).getImageData(0, 0, this.width, this.height), 0, 0);\n        this.history.pause(true);\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\n        this.history.pause(false);\n\n        this.updateIndices();\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'duplicateLayer',\n            params: [i],\n        } as TKlCanvasHistoryEntry);\n        return i + 1;\n    }\n\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\n        if (this.layerCanvasArr[i]) {\n            return BB.ctx(this.layerCanvasArr[i]);\n        }\n        if (doReturnNull) {\n            return null;\n        }\n        throw new Error('layer of index ' + i + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\n    }\n\n    removeLayer (i: number): false | number {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr.splice(i, 1);\n            this.updateIndices();\n        } else {\n            return false;\n        }\n        this.history.push({\n            tool: ['canvas'],\n            action: 'removeLayer',\n            params: [i],\n        } as TKlCanvasHistoryEntry);\n\n        return Math.max(0, i - 1);\n    }\n\n    renameLayer (i: number, name: string): boolean {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr[i].name = name;\n        } else {\n            return false;\n        }\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'renameLayer',\n            params: [i, name],\n        } as TKlCanvasHistoryEntry);\n\n        return true;\n    }\n\n    layerOpacity (layerIndex: number, opacity: number): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            return;\n        }\n        opacity = Math.max(0, Math.min(1, opacity));\n        this.layerCanvasArr[layerIndex].opacity = opacity;\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'layerOpacity',\n            params: [layerIndex, opacity],\n        } as TKlCanvasHistoryEntry);\n\n        this.emitChange();\n    }\n\n    setLayerIsVisible (layerIndex: number, isVisible: boolean): void {\n        if (this.layerCanvasArr[layerIndex]) {\n            this.layerCanvasArr[layerIndex].isVisible = isVisible;\n        } else {\n            throw new Error(`layer ${layerIndex} undefined`);\n        }\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'setLayerIsVisible',\n            params: [layerIndex, isVisible],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    moveLayer (i: number, d: number): void | number {\n        if (d === 0) {\n            return;\n        }\n        if (this.layerCanvasArr[i]) {\n            const temp = this.layerCanvasArr[i];\n            this.layerCanvasArr.splice(i, 1);\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\n            this.updateIndices();\n            this.history.push({\n                tool: ['canvas'],\n                action: 'moveLayer',\n                params: [i, d],\n            } as TKlCanvasHistoryEntry);\n            return targetIndex;\n        }\n    }\n\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: TMixMode | 'as-alpha'): void | number {\n        if (\n            !this.layerCanvasArr[layerBottomIndex] ||\n            !this.layerCanvasArr[layerTopIndex] ||\n            layerBottomIndex === layerTopIndex\n        ) {\n            return;\n        }\n        //order messed up\n        if (layerBottomIndex > layerTopIndex) {\n            const temp = layerBottomIndex;\n            layerBottomIndex = layerTopIndex;\n            layerTopIndex = temp;\n        }\n\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\n        if (topOpacity !== 0 && topOpacity) {\n            const ctx = BB.ctx(this.layerCanvasArr[layerBottomIndex]);\n            ctx.save();\n\n            if (mixModeStr === 'as-alpha') { // todo remove this?\n\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\n                ctx.globalCompositeOperation = 'destination-in';\n                ctx.globalAlpha = topOpacity;\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n\n            } else {\n\n                if (mixModeStr) {\n                    ctx.globalCompositeOperation = mixModeStr;\n                }\n                ctx.globalAlpha = topOpacity;\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n\n            }\n\n            ctx.restore();\n\n            mixModeStr && workaroundForChromium1281185(ctx);\n        }\n        this.updateIndices();\n        this.history.pause(true);\n        this.removeLayer(layerTopIndex);\n        this.history.pause(false);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'mergeLayers',\n            params: [layerBottomIndex, layerTopIndex, mixModeStr],\n        } as TKlCanvasHistoryEntry);\n\n        return layerBottomIndex;\n    }\n\n    mergeAll (): number | false {\n        if (this.layerCanvasArr.length === 1) {\n            return false;\n        }\n\n        // draw all on bottom layer\n        const ctx = BB.ctx(this.layerCanvasArr[0]);\n        for (let i = 1; i < this.layerCanvasArr.length; i++) {\n            const current = this.layerCanvasArr[i];\n            if (!current.isVisible || current.opacity === 0) {\n                continue;\n            }\n\n            ctx.save();\n            ctx.globalCompositeOperation = current.mixModeStr;\n            ctx.globalAlpha = current.opacity;\n            ctx.drawImage(current, 0, 0);\n            ctx.restore();\n        }\n\n        this.history.pause(true);\n\n        // remove upper layers\n        for (let i = this.layerCanvasArr.length - 1; i > 0; i--) {\n            this.removeLayer(i);\n        }\n\n        // rename first layer to \"layer 1\"\n        this.renameLayer(0, LANG('layers-layer') + ' 1');\n\n        this.history.pause(false);\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'mergeAll',\n            params: [],\n        } as TKlCanvasHistoryEntry);\n\n        return 0;\n    }\n\n    rotate (deg: number): void {\n        while (deg < 0) {\n            deg += 360;\n        }\n        deg %= 360;\n        if (deg % 90 != 0 || deg === 0) {\n            return;\n        }\n        const temp = BB.canvas();\n        if (deg === 0 || deg === 180) {\n            temp.width = this.width;\n            temp.height = this.height;\n        } else if (deg === 90 || deg === 270) {\n            temp.width = (this.height);\n            temp.height = (this.width);\n        }\n        const ctx = BB.ctx(temp);\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            ctx.clearRect(0, 0, temp.width, temp.height);\n            ctx.save();\n            ctx.translate(temp.width / 2, temp.height / 2);\n            ctx.rotate(deg * Math.PI / 180);\n            if (deg === 180) {\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            } else if (deg === 90 || deg === 270) {\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\n            }\n            this.layerCanvasArr[i].width = temp.width;\n            this.layerCanvasArr[i].height = temp.height;\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n            ctx.restore();\n        }\n        this.width = temp.width;\n        this.height = temp.height;\n    }\n\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\n        if (!isHorizontal && !isVertical) {\n            return;\n        }\n\n        const temp = BB.canvas(this.width, this.height);\n        temp.width = this.width;\n        temp.height = this.height;\n        const tempCtx = BB.ctx(temp);\n\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\n                continue;\n            }\n\n            tempCtx.save();\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\n            tempCtx.translate(temp.width / 2, temp.height / 2);\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            tempCtx.restore();\n\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n        }\n    }\n\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\n        ctx.save();\n        if (compositeOperation) {\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\n        }\n        ctx.fillStyle = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n        // TODO remove if chrome updated\n        ctx.save();\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n        ctx.restore();\n\n        /*if (!document.getElementById('testocanvas')) {\n            layerCanvasArr[layerIndex].id = 'testocanvas';\n            document.body.append(layerCanvasArr[layerIndex]);\n            BB.css(layerCanvasArr[layerIndex], {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }\n        if (!document.getElementById('testocanvas')) {\n            let c = document.createElement('canvas');\n            c.width = 1000;\n            c.height = 1000;\n            let ctx2 = c.getContext('2d');\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\n            c.id = 'testocanvas';\n            document.body.append(c);\n            BB.css(c, {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }*/\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'layerFill',\n            params: [layerIndex, colorObj, compositeOperation],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    floodFill (\n        layerIndex: number, // index of layer to be filled\n        x: number, // starting point\n        y: number,\n        rgb: IRGB | null, // fill color, if null -> erase\n        opacity: number,\n        tolerance: number,\n        sampleStr: TFillSampling,\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\n        isContiguous: boolean,\n    ): void {\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\n            return;\n        }\n        tolerance = Math.round(tolerance);\n\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\n            throw new Error('invalid sampleStr');\n        }\n\n        let result;\n        let targetCtx;\n        let targetImageData;\n\n        if (sampleStr === 'all') {\n\n            const srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\n            const srcCtx = BB.ctx(srcCanvas);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n\n            targetCtx = BB.ctx(this.layerCanvasArr[layerIndex]);\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\n\n        } else {\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\n\n            if (srcIndex >= this.layerCanvasArr.length) {\n                return;\n            }\n\n            const srcCtx = BB.ctx(this.layerCanvasArr[srcIndex]);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n\n            targetCtx = layerIndex === srcIndex ? srcCtx : BB.ctx(this.layerCanvasArr[layerIndex]);\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\n\n        }\n\n        const targetData = targetImageData.data;\n        if (rgb) {\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = rgb.r;\n                        targetData[i * 4 + 1] = rgb.g;\n                        targetData[i * 4 + 2] = rgb.b;\n                        targetData[i * 4 + 3] = 255;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\n                    }\n                }\n            }\n        } else { // erase\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = 0;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\n                    }\n                }\n            }\n        }\n        targetCtx.putImageData(targetImageData, 0, 0);\n\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'replaceLayer',\n            params: [layerIndex, targetImageData],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    /**\n     * draw shape via BB.drawShape\n     * @param layerIndex\n     * @param shapeObj\n     */\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\n            return;\n        }\n        drawShape(BB.ctx(this.layerCanvasArr[layerIndex]), shapeObj);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'drawShape',\n            params: [layerIndex, BB.copyObj(shapeObj)],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    drawGradient (layerIndex: number, gradientObj: IGradient): void {\n        drawGradient(BB.ctx(this.layerCanvasArr[layerIndex]), gradientObj);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'drawGradient',\n            params: [layerIndex, BB.copyObj(gradientObj)],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    text (layerIndex: number, p: TRenderTextParam): void {\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\n        this.history.push({\n            tool: ['canvas'],\n            action: 'text',\n            params: [layerIndex, BB.copyObj(p)],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\n        ctx.putImageData(imageData, 0, 0);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'replaceLayer',\n            params: [layerIndex, imageData],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    clearLayer (layerIndex: number): void {\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\n        ctx.save();\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'clearLayer',\n            params: [layerIndex],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    getLayers (): {\n        context: CanvasRenderingContext2D;\n        isVisible: boolean;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[] {\n        return this.layerCanvasArr.map(item => {\n            return {\n                context: BB.ctx(item),\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n            };\n        });\n    }\n\n    getLayersFast (): {\n        canvas: KlCanvasLayer;\n        isVisible: boolean;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[] {\n        return this.layerCanvasArr.map(item => {\n            return {\n                canvas: item,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n            };\n        });\n    }\n\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            if (this.layerCanvasArr[i] === canvasObj) {\n                return i;\n            }\n        }\n        if (!doReturnNull) {\n            throw new Error('layer not found (in ' + this.layerCanvasArr.length + ' layers)');\n        }\n        return null;\n    }\n\n    getLayer (index: number, doReturnNull?: boolean): null | TKlCanvasLayer {\n        if (this.layerCanvasArr[index]) {\n            return {\n                context: BB.ctx(this.layerCanvasArr[index]),\n                isVisible: this.layerCanvasArr[index].isVisible,\n                opacity: this.layerCanvasArr[index].opacity,\n                name: this.layerCanvasArr[index].name,\n                id: index,\n            };\n        }\n        if (!doReturnNull) {\n            throw new Error('layer of index ' + index + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\n        }\n        return null;\n    }\n\n    getColorAt (x: number, y: number): IRGB {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        const ctx = BB.ctx(this.pickCanvas);\n        ctx.save();\n        ctx.imageSmoothingEnabled = false;\n        ctx.clearRect(0, 0, 1, 1);\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            const layer = this.layerCanvasArr[i];\n            if (!layer.isVisible || layer.opacity === 0) {\n                continue;\n            }\n            ctx.globalAlpha = layer.opacity;\n            ctx.globalCompositeOperation = layer.mixModeStr;\n            ctx.drawImage(layer, -x, -y);\n        }\n        ctx.restore();\n        const imData = ctx.getImageData(0, 0, 1, 1);\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\n    }\n\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\n        return drawProject(this.getProject(), factor);\n    }\n\n    getProject (): IKlProject {\n        return {\n            width: this.width,\n            height: this.height,\n            layers: this.layerCanvasArr.map(layer => {\n                return {\n                    name: layer.name,\n                    isVisible: layer.isVisible,\n                    opacity: layer.opacity,\n                    mixModeStr: layer.mixModeStr,\n                    image: layer,\n                };\n            }),\n        };\n    }\n\n    addChangeListener (func: () => void): void {\n        if (this.changeListenerArr.includes(func)) {\n            return;\n        }\n        this.changeListenerArr.push(func);\n    }\n\n    removeChangeListener (func: () => void): void {\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\n            if (this.changeListenerArr[i] === func) {\n                this.changeListenerArr.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    setMixMode (layerIndex: number, mixModeStr: TMixMode): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'setMixMode',\n            params: [layerIndex, '' + mixModeStr],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    /**\n     * Set composite drawing step for KlCanvasWorkspace.\n     * To apply temporary manipulations to a layer.\n     *\n     * @param layerIndex\n     * @param compositeObj\n     */\n    setComposite (\n        layerIndex: number,\n        compositeObj: null | {\n            draw: (ctx: CanvasRenderingContext2D) => void;\n        }\n    ): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layerCanvasArr[layerIndex].compositeObj = nullToUndefined(compositeObj);\n    }\n\n    destroy (): void {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.layerCanvasArr.forEach(canvas => {\n            BB.freeCanvas(canvas);\n        });\n        this.layerCanvasArr = [];\n        this.isDestroyed = true;\n    }\n\n}\n","\n/**\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\n * So, my own implementation. can handle tolerance, grow, opacity.\n * Needs to be optimized.\n */\n\n/**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */\nfunction fillRect (data: Uint8Array, width: number, x0: number, y0: number, x1: number, y1: number): void {\n    for (let x = x0; x <= x1; x++) {\n        for (let y = y0; y <= y1; y++) {\n            if (data[y * width + x] === 255) {\n                continue;\n            }\n            data[y * width + x] = 254;\n        }\n    }\n}\n\nlet mx, my;\n\n/**\n * Get index i moved by dX, dY. in array with dimensions width height.\n * Returns null if outside bounds.\n *\n * @param width int\n * @param height int\n * @param i int\n * @param dX int\n * @param dY int\n */\nfunction moveIndex (width: number, height: number, i: number, dX: number, dY: number): (undefined | number) {\n    mx = i % width + dX;\n    my = Math.floor(i / width) + dY;\n\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\n        return undefined;\n    }\n\n    return my * width + mx;\n}\n\n/**\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\n * returns false if already filled, or i is null\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param initRgba rgba\n * @param tolerance int 0 - 255\n * @param i int - srcArr index\n * @returns {boolean}\n */\nfunction testAndFill (\n    srcArr: Uint8ClampedArray,\n    targetArr: Uint8Array,\n    width: number,\n    height: number,\n    initRgba: [number, number, number, number],\n    tolerance: number,\n    i: number | undefined,\n): boolean {\n    if (i === undefined || targetArr[i] === 255) {\n        return false;\n    }\n\n    if (\n        srcArr[i * 4] === initRgba[0] &&\n        srcArr[i * 4 + 1] === initRgba[1] &&\n        srcArr[i * 4 + 2] === initRgba[2] &&\n        srcArr[i * 4 + 3] === initRgba[3]\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    if (\n        tolerance > 0 &&\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    return false;\n}\n\n\n/**\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nfunction floodFill (\n    srcArr: Uint8ClampedArray,\n    targetArr: Uint8Array,\n    width: number,\n    height: number,\n    px: number,\n    py: number,\n    tolerance: number,\n    grow: number,\n    isContiguous: boolean,\n): void {\n\n    const initRgba: [number, number, number, number] = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3],\n    ];\n\n    if (isContiguous) {\n        const q: number[] = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n\n        let i: number, e: number | undefined;\n        while (q.length) {\n            i = q.pop() as number; // a test would slow down the code\n\n            // queue up unfilled neighbors\n            e = moveIndex(width, height, i, -1, 0); // left\n            // test will return false if e is undefined -> only numbers will be pushed to q\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n\n            e = moveIndex(width, height, i, 1, 0); // right\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n\n            e = moveIndex(width, height, i, 0, -1); // up\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n\n            e = moveIndex(width, height, i, 0, 1); // bottom\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n        }\n    } else {\n        for (let i = 0; i < width * height; i++) {\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\n        }\n    }\n\n    // grow\n    if (grow === 0) {\n        return;\n    }\n\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it will mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            if (targetArr[y * width + x] !== 255) {\n                continue;\n            }\n\n            // bounds of rectangle\n            x0 = x;\n            x1 = x;\n            y0 = y;\n            y1 = y;\n\n            l = targetArr[(y) * width + x - 1] !== 255;\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\n            t = targetArr[(y - 1) * width + x] !== 255;\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\n            r = targetArr[(y) * width + x + 1] !== 255;\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\n            b = targetArr[(y + 1) * width + x] !== 255;\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\n\n            if (l) { // left\n                x0 = x - grow;\n            }\n            if (l && tl && t) { // top left\n                x0 = x - grow;\n                y0 = y - grow;\n            }\n            if (t) { // top\n                y0 = Math.min(y0, y - grow);\n            }\n            if (t && tr && r) { // top right\n                y0 = Math.min(y0, y - grow);\n                x1 = x + grow;\n            }\n            if (r) { // right\n                x1 = Math.max(x1, x + grow);\n            }\n            if (r && br && b) { // bottom right\n                x1 = Math.max(x1, x + grow);\n                y1 = Math.max(y1, y + grow);\n            }\n            if (b) { // bottom\n                y1 = Math.max(y1, y + grow);\n            }\n            if (b && bl && l) { // bottom left\n                x0 = Math.min(x0, x - grow);\n                y1 = Math.max(y1, y + grow);\n            }\n\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\n                continue;\n            }\n\n            fillRect(\n                targetArr,\n                width,\n                Math.max(0, x0),\n                Math.max(0, y0),\n                Math.min(width - 1, x1),\n                Math.min(height - 1, y1)\n            );\n        }\n    }\n    for (let i = 0; i < width * height; i++) {\n        if (targetArr[i] === 254) {\n            targetArr[i] = 255;\n        }\n    }\n\n}\n\n\n/**\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\n\n * @param rgbaArr Uint8ClampedArray rgba\n * @param width int\n * @param height int\n * @param x int\n * @param y int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nexport function floodFillBits (\n    rgbaArr: Uint8ClampedArray,\n    width: number,\n    height: number,\n    x: number,\n    y: number,\n    tolerance: number,\n    grow: number,\n    isContiguous: boolean,\n): {\n    data: Uint8Array;\n} {\n    x = Math.round(x);\n    y = Math.round(y);\n\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\n\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n\n    return {\n        data: resultArr,\n    };\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, IShapeToolObject} from '../kl-types';\n\n/**\n * Input processor for shape tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class ShapeTool {\n\n    private readonly onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n    private downX: number = 0;\n    private downY: number = 0;\n    private downAngleRad: number = 0;\n\n    // ---- public ----\n    constructor (\n        p: {\n            onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n        }\n    ) {\n        this.onShape = p.onShape;\n    }\n\n    onDown (x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove (x: number, y: number): void {\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp (x: number, y: number): void {\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\n/**\n * Draw a shape (rectangle, ellipse, line)\n */\nexport function drawShape (\n    ctx: CanvasRenderingContext2D,\n    shapeObj: IShapeToolObject,\n): void {\n    shapeObj = {\n        // defaults\n        angleRad: 0,\n        isOutwards: false,\n        opacity: 1,\n        isEraser: false,\n        doLockAlpha: false,\n\n        ...BB.copyObj(shapeObj),\n    };\n\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\n        if (shapeObj.angleRad === undefined) {\n            throw new Error('angleRad undefined');\n        }\n\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\n\n        // --- prep color ---\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) {\n            throw new Error('fillRgb and strokeRgb undefined');\n        }\n        const colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb!);\n\n\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) {\n            ctx.globalAlpha = shapeObj.opacity;\n        }\n        if (shapeObj.isEraser) {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        if (shapeObj.doLockAlpha) {\n            ctx.globalCompositeOperation = 'source-atop';\n        }\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) {\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\n        } else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\n            ctx.lineWidth = lineWidth;\n        }\n\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            const r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            const r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                    x2 = x1;\n                } else { // left or right\n                    y2 = y1;\n                }\n            }\n        }\n\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n\n            const rx = r1.x;\n            const ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n\n            if (Math.abs(rdX) < Math.abs(rdY)) {\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            } else {\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            }\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\n\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n\n        let p1;\n        let p2;\n        if (shapeObj.type === 'line') { // --- line ---\n\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (lineWidth % 2 === 0) {\n\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r,\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r,\n                    };\n\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f,\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f,\n                    };\n\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1,\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2,\n                    };\n                }\n\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f,\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f,\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n\n        } else if (shapeObj.type === 'rect') { // --- rect ---\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) {\n                        x1 += 1;\n                    }\n                    if (y1 % 1 === 0) {\n                        y1 += 1;\n                    }\n                    if (x2 % 1 === 0) {\n                        x2 += 1;\n                    }\n                    if (y2 % 1 === 0) {\n                        y2 += 1;\n                    }\n\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f,\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n\n                } else {\n                    if (lineWidth % 2 === 0) {\n                        p1 = {\n                            x: x1f,\n                            y: y1f,\n                        };\n                        p2 = {\n                            x: x2f,\n                            y: y2f,\n                        };\n                    } else {\n                        p1 = {\n                            x: x1f + 0.5,\n                            y: y1f + 0.5,\n                        };\n                        p2 = {\n                            x: x2f + 0.5,\n                            y: y2f + 0.5,\n                        };\n                    }\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1,\n                };\n                p2 = {\n                    x: x2,\n                    y: y2,\n                };\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n\n            if (shapeObj.fillRgb) {\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            } else {\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n            }\n\n        } else {  // --- circle ---\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) {\n                ctx.fill();\n            } else {\n                ctx.stroke();\n            }\n        }\n\n\n        ctx.restore();\n\n    } else {\n        throw new Error('unknown shape');\n    }\n}","import {BB} from '../../bb/bb';\nimport {IBounds, IRect} from '../../bb/bb-types';\nimport {IRGBA} from '../kl-types';\n\nexport type TTextFormat = 'left' | 'center' | 'right';\nexport type TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy' | string;\n\nexport type TRenderTextParam = {\n    text: string; // text to be drawn. can contain newlines\n\n    x: number;\n    y: number;\n    angleRad: number;\n    size: number; // px\n    align: TTextFormat;\n    isBold: boolean;\n    isItalic: boolean;\n    font: TTextFont;\n    letterSpacing?: number;\n    lineHeight?: number; // em\n    fill?: {\n        color: IRGBA;\n    };\n    stroke?: {\n        color: IRGBA;\n        lineWidth: number;\n    };\n}\n\nfunction textMetricToRect (metrics: TextMetrics, align: TTextFormat): IRect {\n    // fallback for older browsers\n    const ascent = metrics.fontBoundingBoxAscent ?? metrics.actualBoundingBoxAscent;\n    const descent = metrics.fontBoundingBoxDescent ?? metrics.actualBoundingBoxDescent;\n\n    if (align === 'left') {\n        return {\n            x: 0,\n            y: -ascent,\n            width: metrics.width,\n            height: ascent + descent,\n        };\n    }\n    if (align === 'right') {\n        return {\n            x: -metrics.width,\n            y: -ascent,\n            width: metrics.width,\n            height: ascent + descent,\n        };\n    }\n    // center\n    return {\n        x: -metrics.width / 2,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent,\n    };\n}\n\n/**\n * Draws text on a canvas.\n * Return bounds, relative to p.x, p.y.\n *\n * @param canvas\n * @param p\n */\nexport function renderText (canvas: HTMLCanvasElement, p: TRenderTextParam): IRect {\n\n    p = BB.copyObj(p);\n\n    // setup context\n    const ctx = BB.ctx(canvas) as CanvasRenderingContext2D & {letterSpacing: string};\n    ctx.save();\n    ctx.textAlign = p.align;\n    ctx.letterSpacing = p.letterSpacing ? p.letterSpacing + 'px' : '0';\n\n    // font\n    const fontArr = [p.size + 'px ' + (p.font ? p.font : 'sans-serif')];\n    if (p.isBold) {\n        fontArr.unshift('bold');\n    }\n    if (p.isItalic) {\n        fontArr.unshift('italic');\n    }\n    ctx.font = fontArr.join(' ');\n\n    // fill\n    ctx.fillStyle = p.fill ? BB.ColorConverter.toRgbaStr(p.fill.color) : 'transparent';\n\n    // stroke\n    ctx.strokeStyle = p.stroke ? BB.ColorConverter.toRgbaStr(p.stroke.color) : 'transparent';\n    if (p.stroke) {\n        ctx.lineWidth = p.stroke.lineWidth;\n        ctx.lineJoin = 'round';\n    }\n\n    ctx.translate(p.x, p.y);\n    ctx.rotate(-p.angleRad);\n\n\n    const lines = p.text.split('\\n').map(line => line.replaceAll('\\t', '    '));\n\n    // bounds\n    const bounds: IBounds = {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n    };\n    {\n        let isFirst = true;\n        lines.forEach((line, lineIndex) => {\n            const metrics = ctx.measureText(line);\n            const x = 0;\n            const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\n            const mRect = textMetricToRect(metrics, p.align);\n            if (isFirst) {\n                isFirst = false;\n                bounds.x1 = x + mRect.x;\n                bounds.y1 = y + mRect.y;\n                bounds.x2 = x + mRect.x + mRect.width;\n                bounds.y2 = y + mRect.y + mRect.height;\n            } else {\n                bounds.x1 = Math.min(bounds.x1, x + mRect.x);\n                bounds.y1 = Math.min(bounds.y1, y + mRect.y);\n                bounds.x2 = Math.max(bounds.x2, x + mRect.x + mRect.width);\n                bounds.y2 = Math.max(bounds.y2, y + mRect.y + mRect.height);\n            }\n        });\n    }\n\n    // draw stroke\n    lines.forEach((line, lineIndex) => {\n        const x = 0;\n        const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\n        ctx.strokeText(line, x, y);\n    });\n\n    // draw fill\n    lines.forEach((line, lineIndex) => {\n        const x = 0;\n        const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\n        ctx.fillText(line, x, y);\n    });\n\n    ctx.restore();\n    return {\n        x: bounds.x1,\n        y: bounds.y1,\n        width: bounds.x2 - bounds.x1,\n        height: bounds.y2 - bounds.y1,\n    };\n}\n","import {BB} from '../../bb/bb';\nimport {IKlProject} from '../kl-types';\n\nexport function drawProject (project: IKlProject, factor: number): HTMLCanvasElement {\n    const resultCanvas = BB.canvas(\n        Math.max(1, Math.round(project.width * factor)),\n        Math.max(1, Math.round(project.height * factor))\n    );\n    const ctx = BB.ctx(resultCanvas);\n    ctx.save();\n    if (factor > 1) {\n        ctx.imageSmoothingEnabled = false;\n    }\n    for (let i = 0; i < project.layers.length; i++) {\n        const layer = project.layers[i];\n        if (!layer.isVisible || layer.opacity === 0) {\n            continue;\n        }\n        ctx.globalAlpha = layer.opacity;\n        const mixModeStr = layer.mixModeStr;\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\n        ctx.drawImage(layer.image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}","import {IGradient, IRGBA} from '../kl-types';\nimport {BB} from '../../bb/bb';\n\n\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n\n/**\n * Input processor for gradient tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class GradientTool {\n    private downX: number = 0;\n    private downY: number = 0;\n    private downAngleRad: number = 0;\n    private readonly onGradient: TOnGradient;\n\n    // ---- public ----\n    constructor (\n        p: {\n            onGradient: TOnGradient;\n        }\n    ) {\n        this.onGradient = p.onGradient;\n    }\n\n    onDown (x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove (x: number, y: number): void {\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp (x: number, y: number): void {\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\nexport function drawGradient (\n    ctx: CanvasRenderingContext2D,\n    gradientObj: IGradient,\n): void {\n    ctx.save();\n\n    const x1 = gradientObj.x1;\n    const y1 = gradientObj.y1;\n    let x2 = gradientObj.x2;\n    let y2 = gradientObj.y2;\n\n    if (gradientObj.doSnap) {\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\n\n        const r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\n        const r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\n\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n        const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n        x2 = rotated.x;\n        y2 = rotated.y;\n\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                x2 = x1;\n            } else { // left or right\n                y2 = y1;\n            }\n        }\n    }\n\n    let baseColor = gradientObj.color1;\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\n        baseColor = {r: 255, g: 255, b: 255};\n    }\n    let color1: IRGBA = {\n        ...baseColor,\n        a: gradientObj.opacity,\n    };\n    let color2: IRGBA = {\n        ...baseColor,\n        a: 0,\n    };\n    if (gradientObj.isReversed) {\n        const temp = color1;\n        color1 = color2;\n        color2 = temp;\n    }\n\n    let gradient: CanvasGradient;\n    if (gradientObj.type === 'linear') {\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n\n    } else if (gradientObj.type === 'linear-mirror') {\n        const d = {\n            x: x2 - x1,\n            y: y2 - y1,\n        };\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n\n    } else if (gradientObj.type === 'radial') {\n        const r = BB.Vec2.dist(\n            {x: x1, y: y1},\n            {x: x2, y: y2},\n        );\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n    }\n\n    ctx.fillStyle = gradient!;\n    if (gradientObj.isEraser) {\n        ctx.globalCompositeOperation = 'destination-out';\n    }\n    if (gradientObj.doLockAlpha) {\n        ctx.globalCompositeOperation = 'source-atop';\n    }\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n\n    ctx.restore();\n}","import {TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TTranslationCode} from '../../../languages/languages';\n\nexport function translateBlending (blendMode?: TMixMode): string {\n    if (!blendMode) {\n        return LANG('layers-blend-normal');\n    }\n\n    const codes: {\n        [key: string]: TTranslationCode;\n    } = {\n        'source-over': 'layers-blend-normal',\n        'darken': 'layers-blend-darken',\n        'multiply': 'layers-blend-multiply',\n        'color-burn': 'layers-blend-color-burn',\n        'lighten': 'layers-blend-lighten',\n        'screen': 'layers-blend-screen',\n        'color-dodge': 'layers-blend-color-dodge',\n        'overlay': 'layers-blend-overlay',\n        'soft-light': 'layers-blend-soft-light',\n        'hard-light': 'layers-blend-hard-light',\n        'difference': 'layers-blend-difference',\n        'exclusion': 'layers-blend-exclusion',\n        'hue': 'layers-blend-hue',\n        'saturation': 'layers-blend-saturation',\n        'color': 'layers-blend-color',\n        'luminosity': 'layers-blend-luminosity',\n    };\n\n    if (!(blendMode in codes)) {\n        throw new Error('unknown blend mode');\n    }\n    return LANG(codes[blendMode]);\n}","import {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport {showModal} from '../../modals/base/showModal';\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\n\n\nexport function renameLayerDialog (\n    parentEl: HTMLElement,\n    currentName: string,\n    callback: (newName: string | undefined) => void\n): void {\n    const div = BB.el();\n\n    const label = BB.el({\n        content: LANG('layers-rename-name') + ':',\n        css: {\n            marginRight: '5px',\n        },\n    });\n\n    const row = BB.el({\n        css: {\n            display: 'flex',\n        },\n    });\n    const input = BB.el({tagName: 'input'});\n    input.value = currentName;\n    input.setAttribute('data-ignore-focus', 'true');\n    const clearBtn = BB.el({\n        tagName: 'button',\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\n        title: LANG('layers-rename-clear'),\n        css: {\n            marginLeft: '10px',\n        },\n        onClick: () => {\n            input.value = '';\n            input.focus();\n        },\n    });\n    const suggestions = [\n        LANG('layers-rename-sketch'),\n        LANG('layers-rename-colors'),\n        LANG('layers-rename-shading'),\n        LANG('layers-rename-lines'),\n        LANG('layers-rename-effects'),\n        LANG('background'),\n        LANG('layers-rename-foreground'),\n    ];\n    const suggestionBtns: HTMLButtonElement[] = [];\n    const row2 = BB.el({\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            marginTop: '5px',\n            marginLeft: '-5px',\n        },\n    });\n    suggestions.forEach(item => {\n        const btn = BB.el({\n            parent: row2,\n            tagName: 'button',\n            content: item,\n            onClick: () => {\n                input.value = '' + btn.textContent;\n            },\n            css: {\n                margin: '5px 0 0 5px',\n            },\n        });\n        suggestionBtns.push(btn);\n    });\n\n    div.append(label);\n    label.append(row, row2);\n    row.append(input, clearBtn);\n\n    setTimeout(() => {\n        input.focus();\n        input.select();\n    }, 10);\n\n    showModal({\n        target: parentEl,\n        message: `<b>${LANG('layers-rename-title')}</b>`,\n        div: div,\n        buttons: [LANG('layers-rename'), 'Cancel'],\n        primaries: [LANG('layers-rename')],\n        callback: (val) => {\n            BB.destroyEl(clearBtn);\n            suggestionBtns.forEach(item => {\n                BB.destroyEl(item);\n            });\n            suggestionBtns.splice(0, suggestionBtns.length);\n            if (val === LANG('layers-rename')) {\n                callback(input.value);\n            } else {\n                callback(undefined);\n            }\n        },\n        clickOnEnter: LANG('layers-rename'),\n    });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"remove-layer.4913f03e.svg\" + \"?\" + Date.now();","import {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport {Options} from '../../components/options';\nimport {translateBlending} from '../../../canvas/translate-blending';\nimport {showModal} from '../../modals/base/showModal';\nimport {TMixMode} from '../../../kl-types';\nimport {theme} from '../../../../theme/theme';\n\nexport function mergeLayerDialog (\n    parentEl: HTMLElement,\n    p: {\n        topCanvas: HTMLCanvasElement;\n        bottomCanvas: HTMLCanvasElement;\n        topOpacity: number;\n        mixModeStr: TMixMode;\n        callback: (mode: string) => void;\n    }\n): void {\n    const div = BB.el();\n    div.innerHTML = LANG('layers-merge-description');\n\n    const options = new Options({\n        optionArr: [\n            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\n            {id: 'source-in', label: 'source-in'},\n            {id: 'source-out', label: 'source-out'},\n            {id: 'source-atop', label: 'source-atop'},\n            {id: 'destination-in', label: 'destination-in'},\n            {id: 'destination-out', label: 'destination-out'},\n            {id: 'destination-atop', label: 'destination-atop'},\n            {id: 'xor', label: 'xor'},\n        ],\n        initId: p.mixModeStr,\n        onChange: () => {\n            update();\n        },\n        isSmall: true,\n    });\n    options.getElement().style.marginTop = '5px';\n    div.append(options.getElement());\n\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n    preview.title = LANG('preview');\n    preview.className = 'kl-merge-preview';\n    const spacer = BB.el({\n        content: '<br/>',\n        css: {\n            clear: 'both',\n        },\n    });\n    div.append(spacer, preview);\n\n    function updateCheckerboard (): void {\n        BB.createCheckerDataUrl(4, (url) => {\n            preview.style.backgroundImage = 'url(' + url + ')';\n        }, theme.isDark());\n    }\n    updateCheckerboard();\n    theme.addIsDarkListener(updateCheckerboard);\n\n    const alphaCanvas = BB.copyCanvas(preview);\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\n\n    const update = () => {\n        const ctx = BB.ctx(preview);\n        ctx.save();\n        ctx.clearRect(0, 0, preview.width, preview.height);\n        if (preview.width > p.topCanvas.width) {\n            ctx.imageSmoothingEnabled = false;\n        }\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\n\n        if (options.getValue() === 'as-alpha') {\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\n        } else {\n            ctx.globalCompositeOperation = options.getValue() as GlobalCompositeOperation;\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\n        }\n        ctx.restore();\n    };\n\n    update();\n\n\n    const keyListener = new BB.KeyListener({\n        onDown: (keyStr: string) => {\n            if (keyStr === 'right') {\n                options.next();\n            }\n            if (keyStr === 'left') {\n                options.previous();\n            }\n        },\n    });\n\n    showModal({\n        target: parentEl,\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\n        div: div,\n        buttons: ['Ok', 'Cancel'],\n        clickOnEnter: 'Ok',\n        callback: (val) => {\n            keyListener.destroy();\n            options.destroy();\n            theme.removeIsDarkListener(updateCheckerboard);\n            if (val === 'Ok') {\n                p.callback(options.getValue());\n            }\n        },\n    });\n}","import {c} from '../../../bb/base/c';\nimport {makeUnfocusable} from '../../../bb/base/ui';\n\nexport type TDropdownMenuParams = {\n    button: string | HTMLElement;\n    buttonTitle?: string;\n    items: [string, string][]; // id, label\n    onItemClick: (id: string) => void;\n};\n\nexport class DropdownMenu {\n    private readonly rootElement: HTMLElement;\n    private isExpanded: boolean = false;\n    private readonly onSetEnabled: (id: string, enabled: boolean) => void = () => 0;\n\n    // ---- public ----\n    constructor (p: TDropdownMenuParams) {\n        const button = c('button,w-full,h-full', [p.button]) as HTMLButtonElement;\n        button.onclick = () => {\n            toggle(!this.isExpanded);\n        };\n        if (p.buttonTitle) {\n            button.title = p.buttonTitle;\n        }\n        makeUnfocusable(button);\n\n        const items: HTMLButtonElement[] = [];\n        const itemMap: Record<string, HTMLButtonElement> = {};\n        p.items.forEach(item => {\n            const itemButton = c('button', item[1]) as HTMLButtonElement;\n            makeUnfocusable(itemButton);\n            itemButton.onclick = () => {\n                toggle(false);\n                p.onItemClick(item[0]);\n            };\n            items.push(itemButton);\n            itemMap[item[0]] = itemButton;\n        });\n\n        this.onSetEnabled = (id, enabled) => {\n            itemMap[id].disabled = !enabled;\n        };\n\n        const menu = c(\n            '.kl-dropdown-menu,right-0,top-full,nowrap,hidden',\n            items\n        );\n\n        this.rootElement = c(',pos-relative', [\n            button,\n            menu,\n        ]);\n\n        const toggle = (force: boolean) => {\n            this.isExpanded = force;\n            menu.style.display = this.isExpanded ? 'block' : 'none';\n            if (this.isExpanded) {\n                document.addEventListener('pointerdown', onPointerDown);\n                window.addEventListener('blur', onBlur);\n            } else {\n                document.removeEventListener('pointerdown', onPointerDown);\n                window.removeEventListener('blur', onBlur);\n            }\n        };\n\n        const onPointerDown = (e: PointerEvent) => {\n            const target = e.target as HTMLElement | null;\n            if (button.contains(target) || menu.contains(target)) {\n                return;\n            }\n            toggle(false);\n        };\n\n        const onBlur = () => toggle(false);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootElement;\n    }\n\n    setEnabled (id: string, enabled: boolean): void {\n        this.onSetEnabled(id, enabled);\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"add-layer.21472908.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"duplicate-layer.ee0c87e4.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"merge-layers.1a96fa59.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"rename-layer.a7ea9cd5.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"caret-down.0f7da0ad.svg\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl-types';\n\n/**\n * Overlay for KlCanvasWorkspace.\n * - brush circle\n * - eyedropper circle\n * - compass needle (rotation hud)\n */\nexport class WorkspaceSvgOverlay {\n    private readonly rootElement: SVGElement;\n    private readonly brushCircleOuter: SVGElement;\n    private readonly brushCircleInner: SVGElement;\n    private readonly pickerPreviewBorder: SVGElement;\n    private readonly pickerPreviewCol: SVGElement;\n    private readonly compassSize: number;\n    private readonly compass: SVGElement;\n    private readonly compassInner: SVGElement;\n    private readonly compassBaseCircle: SVGElement;\n    private readonly compassLineCircle: SVGElement;\n    private readonly compassUpperTriangle: SVGElement;\n    private readonly compassLowerTriangle: SVGElement;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number;\n        }\n    ) {\n        this.rootElement = BB.createSvg({\n            elementType: 'svg',\n            width: '' + p.width,\n            height: '' + p.height,\n        });\n        BB.css(this.rootElement, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none',\n            userSelect: 'none',\n        });\n\n        //brush circles\n        this.brushCircleOuter = BB.createSvg({\n            elementType: 'circle',\n            r: '10',\n            stroke: 'rgba(0,0,0,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.brushCircleInner = BB.createSvg({\n            elementType: 'circle',\n            r: '9',\n            stroke: 'rgba(255,255,255,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n\n        //color picker preview circle\n        this.pickerPreviewBorder = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '22',\n            fill: 'none',\n        });\n        this.pickerPreviewBorder.style.opacity = '0';\n        this.pickerPreviewCol = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '20',\n            fill: 'none',\n        });\n        this.pickerPreviewCol.style.opacity = '0';\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n\n\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = BB.createSvg({\n            elementType: 'g',\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\n        });\n        BB.css(this.compass, {\n            transition: 'opacity 0.25s ease-in-out',\n            opacity: '0',\n        });\n        this.compassInner = BB.createSvg({\n            elementType: 'g',\n            transform: 'rotate(45)',\n        });\n        this.compassBaseCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'rgba(0,0,0,0.9)',\n            stroke: 'none',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize,\n        });\n        this.compassLineCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'none',\n            stroke: 'rgba(255,255,255,0.75)',\n            'stroke-width': '1',\n            cx: '0',\n            cy: '0',\n            r: '' + (this.compassSize * 0.9),\n        });\n        this.compassUpperTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#f00',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\n        });\n        this.compassLowerTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#fff',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\n        });\n\n        this.compassInner.append(\n            this.compassBaseCircle,\n            this.compassLineCircle,\n            this.compassUpperTriangle,\n            this.compassLowerTriangle\n        );\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n\n    getElement (): SVGElement {\n        return this.rootElement;\n    }\n\n    setSize (width: number, height: number): void {\n        this.rootElement.setAttribute('width', '' + width);\n        this.rootElement.setAttribute('height', '' + height);\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\n    }\n\n    updateCursor (p: {\n        x?: number;\n        y?: number;\n        radius?: number;\n        isVisible?: boolean;\n    }): void {\n        if (p.x !== undefined) {\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\n        }\n        if (p.y !== undefined) {\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\n        }\n        if (p.radius !== undefined) {\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\n        }\n        if (p.isVisible !== undefined) {\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateColorPreview (p: {\n        x?: number;\n        y?: number;\n        color?: IRGB;\n        isVisible?: boolean;\n    }): void {\n        if (p.x !== undefined) {\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\n        }\n        if (p.y !== undefined) {\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\n        }\n        if (p.color) {\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\n            const borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\n        }\n        if (p.isVisible !== undefined) {\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateCompass (p: {\n        angleDeg?: number;\n        isVisible?: boolean;\n    }): void {\n        if (p.angleDeg !== undefined) {\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\n        }\n        if (p.isVisible !== undefined) {\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, ITransform, TDrawEvent} from '../kl-types';\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\nimport {klHistory} from '../history/kl-history';\nimport pickerImg from '/src/app/img/ui/cursor-picker.png';\nimport zoomEwImg from '/src/app/img/ui/cursor-zoom-ew.png';\nimport fillImg from '/src/app/img/ui/cursor-fill.png';\nimport textImg from '/src/app/img/ui/cursor-text.png';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {KeyListener, TOnKeyDown, TOnKeyUp} from '../../bb/input/key-listener';\nimport {KL} from '../kl';\nimport {LinetoolProcessor} from '../events/linetool-processor';\nimport {PinchZoomer} from '../../bb/input/event-chain/pinch-zoomer';\nimport {DoubleTapper, IDoubleTapperEvent} from '../../bb/input/event-chain/double-tapper';\nimport {NFingerTapper} from '../../bb/input/event-chain/n-finger-tapper';\nimport {EventChain} from '../../bb/input/event-chain/event-chain';\nimport {PointerListener} from '../../bb/input/pointer-listener';\nimport {theme} from '../../theme/theme';\nimport {TVec4} from '../../bb/math/matrix';\nimport {IChainElement} from '../../bb/input/event-chain/event-chain.types';\nimport {ICoalescedPointerEvent} from '../../bb/input/event-chain/coalesced-exploder';\nimport {klConfig} from '../kl-config';\n\nexport interface IViewChangeEvent {\n    changed: ('scale' | 'angle')[];\n    angle: number;\n    scale: number;\n}\n\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\n\ntype TInputProcessorKeys = |\n    'draw' |\n    'fill' |\n    'gradient' |\n    'text' |\n    'shape' |\n    'hand' |\n    'spaceHand' |\n    'zoom' |\n    'picker' |\n    'altPicker' |\n    'rotate';\n\ntype TInputProcessorItem = {\n    onPointer: (val: ICoalescedPointerEvent) => void;\n    onKeyDown: TOnKeyDown;\n    onKeyUp: TOnKeyUp;\n}\n\nconst MIN_SCALE = 1 / 16;\nconst MAX_SCALE = Math.pow(2, 7);\nenum TMode {\n    Draw,\n    Hand,\n    HandGrabbing,\n    Pick,\n    Zoom,\n    Rotate,\n    Rotating,\n    Fill,\n    Gradient,\n    Text,\n    Shape,\n}\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\n\n/**\n * Work area that displays the KlCanvas.\n * - pan, zoom, rotate (also via multi-touch)\n * - input modes: drawing, hand, pick, fill, text // transform, select\n * - drawing input events\n * - view change events\n * - eyedropper input events (pick)\n * - draws cursor, eyedropper overlay\n *\n * subscribes to klCanvas changes\n * listens to kl history for changes\n * and you can manually trigger redraw\n */\nexport class KlCanvasWorkspace {\n\n    private readonly rootEl: HTMLElement;\n    private klCanvas: KlCanvas;\n    private readonly renderTargetCanvas: HTMLCanvasElement;\n    private readonly renderTargetCtx: CanvasRenderingContext2D;\n    private renderWidth: number;\n    private renderHeight: number;\n    private readonly compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\n    private readonly compositeCtx: CanvasRenderingContext2D;\n    private doResizeCanvas: boolean;\n    private oldTransformObj: ITransform | null;\n    private targetTransformObj: ITransform; // animation target\n    private highResTransformObj: ITransform; // animated, internal high-res\n    private readonly renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\n    private cursorPos: IVector2D;\n    private readonly usesCssCursor: boolean;\n    private bgVisible: boolean;\n    private transformIsDirty: boolean;\n    private doAnimateTranslate: boolean;\n    private svgOverlay: WorkspaceSvgOverlay;\n    private readonly emptyCanvas: HTMLCanvasElement;\n    private readonly emptyLightCanvas: HTMLCanvasElement;\n    private keyListener: KeyListener;\n    private currentMode: TMode;\n    private globalMode: TMode;\n    private renderTime: number; // for debugging - average ms per render()\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\n    private linetoolProcessor: LinetoolProcessor;\n    private pointer: IVector2D | null; // position of cursor\n    private isDrawing: boolean;\n    private inputProcessorObj: {\n        [key in TInputProcessorKeys]: TInputProcessorItem;\n    };\n    private currentInputProcessor: TInputProcessorItem | null;\n    private angleIsExtraSticky: boolean;\n    private readonly pinchZoomer: PinchZoomer;\n    private readonly mainDoubleTapper: DoubleTapper;\n    private readonly middleDoubleTapper: DoubleTapper;\n    private readonly twoFingerTap: NFingerTapper;\n    private readonly threeFingerTap: NFingerTapper;\n    private pointerEventChain: EventChain;\n    private pointerListener: PointerListener | undefined;\n    private brushRadius: number;\n    private animationFrameRequested: boolean;\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\n    private lastRenderTime: number; // ms from performance.now()\n    private hideBrushCursorTimeout: (ReturnType<typeof setTimeout>) | undefined;\n    private readonly onViewChange: (e:  IViewChangeEvent) => void;\n\n    private getRenderedTransform (): ITransform {\n        // rounded x & y so canvas is less blurry.\n        const result = this.renderedTransformObj;\n        result.x = this.highResTransformObj.x;\n        result.y = this.highResTransformObj.y;\n        result.scale = this.highResTransformObj.scale;\n        result.angle = this.highResTransformObj.angle;\n\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n            result.x = Math.round(result.x);\n            result.y = Math.round(result.y);\n        }\n\n        return result;\n    }\n\n    private updateChangeListener (): void {\n        this.klCanvas.addChangeListener(() => {\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n    }\n\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\n        if (modeInt === this.currentMode && !doForce) {\n            return;\n        }\n        const oldMode = this.currentMode;\n        this.currentMode = modeInt;\n        this.lastRenderedState = -1;\n        if (this.currentMode === TMode.Draw) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Hand) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.HandGrabbing) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Pick) {\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\n        } else if (this.currentMode === TMode.Zoom) {\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\n        } else if (this.currentMode === TMode.Rotate) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.Rotating) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Fill) {\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Gradient) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Text) {\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Shape) {\n            this.rootEl.style.cursor = 'crosshair';\n        }\n\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\n            if (!oldIsHand && currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n            }\n            if (oldIsHand && !currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n            }\n        }\n\n        if (this.currentMode !== TMode.Pick) {\n            this.svgOverlay.updateColorPreview({isVisible: false});\n        }\n    }\n\n    /**\n     * returns false if no change of zoom\n     * @param stepNum\n     * @param centerX\n     * @param centerY\n     * @private\n     */\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\n        const step = Math.log2(this.targetTransformObj.scale);\n\n        let newStep = step / Math.abs(stepNum);\n        newStep += stepNum > 0 ? 1 : -1;\n        newStep = Math.round(newStep);\n        newStep *= Math.abs(stepNum);\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\n\n        //has zoomed?\n        if (newScale === this.targetTransformObj.scale) {\n            return false;\n        }\n\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\n        this.targetTransformObj.scale = newScale;\n\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\n\n        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.transformIsDirty = true;\n\n        return true;\n    }\n\n    /**\n     * mixes two transform objects. modifies A\n     * @param transformA\n     * @param transformB\n     * @param blendFactor 0 -> A, 1 -> B\n     * @private\n     */\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\n        if (transformA.angle === transformB.angle) {\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n            return;\n        }\n\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        // --- determine centerPosA, centerPosB ---\n        const centerPosA = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2,\n        }, transformA);\n        const centerPosB = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2,\n        }, transformB);\n\n        // --- centerPosMixed ---\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\n\n        // --- scale and angle ---\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n\n        // --- x and y ---\n        const mixedPos = this.canvasToWorkspaceCoord({\n            x: -w / 2,\n            y: -h / 2,\n        }, transformA);\n        transformA.x = mixedPos.x;\n        transformA.y = mixedPos.y;\n    }\n\n    private render (): void {\n        if (this.doResizeCanvas) {\n            this.doResizeCanvas = false;\n            this.renderTargetCanvas.width = this.renderWidth;\n            this.renderTargetCanvas.height = this.renderHeight;\n        }\n        this.renderContext(this.renderTargetCtx);\n    }\n\n    /**\n     * is the gray background that surrounds canvas visible?\n     * @private\n     */\n    private testBgVisible (): boolean {\n        //bring workspace points (corners of workspace) into canvas coordinate system\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\n\n        const workspacePointArr = [\n            [0, 0], // top left\n            [this.renderWidth, 0], // top right\n            [this.renderWidth, this.renderHeight], // bottom right\n            [0, this.renderHeight], // bottom left\n        ];\n\n        const art = this.getRenderedTransform();\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        //transform points, then test if outside of canvas\n        for (let i = 0; i < workspacePointArr.length; i++) {\n            let coords: TVec4 = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n            if (\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\n            ){\n                //if not inside -> bg visible\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private renderContext (ctx: CanvasRenderingContext2D): void {\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        const art = this.getRenderedTransform();\n        const isDark = theme.isDark();\n\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\n            ctx.imageSmoothingEnabled = false;\n        } else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        //ctx.imageSmoothingEnabled = false;\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\n\n\n\n        ctx.save();\n        {\n            if (this.bgVisible) {\n                ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)'; // 'rgb(185,185,185)';\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n            } else {\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n            }\n\n\n\n            if (this.bgVisible) {\n                ctx.save();\n\n                ctx.translate(art.x, art.y);\n                ctx.scale(art.scale, art.scale);\n                ctx.rotate(art.angle);\n\n                ctx.imageSmoothingEnabled = false;\n\n                //outline\n                const borderSize = 1;\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\n                ctx.drawImage(\n                    isDark ? this.emptyLightCanvas : this.emptyCanvas,\n                    -borderSize / art.scale,\n                    -borderSize / art.scale,\n                    w + borderSize * 2 / art.scale,\n                    h + borderSize * 2 / art.scale\n                );\n                ctx.globalAlpha = 1;\n\n                //erase\n                ctx.globalCompositeOperation = 'destination-out';\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n\n                ctx.restore();\n            }\n\n            /*const region = new Path2D();\n            region.rect(80, 10, 20, 130);\n            ctx.clip(region);*/\n\n            ctx.translate(art.x, art.y);\n            ctx.scale(art.scale, art.scale);\n            ctx.rotate(art.angle);\n\n            const layerArr = this.klCanvas.getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                if (!layerArr[i].isVisible || layerArr[i].opacity === 0) {\n                    continue;\n                }\n\n                ctx.globalAlpha = layerArr[i].opacity;\n                ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n\n                const compositeObj = layerArr[i].canvas.compositeObj;\n                if (compositeObj) {\n                    if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                        this.compositeCanvas.width = layerArr[i].canvas.width;\n                        this.compositeCanvas.height = layerArr[i].canvas.height;\n                    } else {\n                        this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                    }\n                    this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                    compositeObj.draw(this.compositeCtx);\n                    ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                } else {\n                    ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n                }\n            }\n            ctx.globalAlpha = 1;\n\n\n\n        }\n        ctx.restore();\n\n        // rotation hud\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\n            this.svgOverlay.updateCompass({\n                isVisible: true,\n                angleDeg: art.angle / Math.PI * 180,\n            });\n        } else {\n            this.svgOverlay.updateCompass({\n                isVisible: false,\n            });\n        }\n    }\n\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\n        const art = this.getRenderedTransform();\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        let coords: TVec4 = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\n\n        let coords: TVec4 = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\n        let angleDeg = angleRad * 180 / Math.PI;\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n\n        if (dist <= maxDistDeg) {\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n        }\n\n        return angleDeg / 180 * Math.PI;\n    }\n\n    /**\n     * angle always in range [-PI, PI]\n     * @param angleRad\n     * @private\n     */\n    private minimizeAngleRad (angleRad: number): number {\n        angleRad = angleRad % (2 * Math.PI);\n        if (angleRad > Math.PI) {\n            angleRad -= 2 * Math.PI;\n        } else if (angleRad < -Math.PI) {\n            angleRad += 2 * Math.PI;\n        }\n        return angleRad;\n    }\n\n    private resetInputProcessor (): void {\n        this.currentInputProcessor = null;\n        this.updateCursor(this.globalMode);\n        this.reqFrame(true);\n    }\n\n    private reqFrame (doRedrawCanvas?: boolean): void {\n        this.animationFrameRequested = true;\n        if (doRedrawCanvas) {\n            this.lastRenderedState = -1;\n        }\n    }\n\n    private updateLoop (): void {\n        window.requestAnimationFrame(() => this.updateLoop());\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState;\n\n        //handle variable framerate\n        const nowTime = performance.now();\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n        this.lastRenderTime = nowTime;\n\n        if (this.animationFrameRequested || doRender) {\n            this.animationFrameRequested = false;\n            this.checkChange(elapsedFrames);\n        }\n    }\n\n    private checkChange (elapsedFrames: number): void {\n\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState ||\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\n            this.highResTransformObj.y !== this.targetTransformObj.y;\n\n        //update transform\n        if (\n            !this.doAnimateTranslate &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else if (\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            this. doAnimateTranslate = false;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else {\n            this.reqFrame(); //probably needs another frame\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n            this.bgVisible = true; // spare yourself the calculation\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        }\n\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\n            this.svgOverlay.updateCursor({\n                x: this.pointer.x,\n                y: this.pointer.y,\n                isVisible: true,\n            });\n        } else {\n            this.svgOverlay.updateCursor({isVisible: false});\n        }\n\n\n        if (doRender) {\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n            this.lastRenderedState = newState;\n            const start = performance.now();\n            this.render();\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\n        }\n        //setTimeout(this.checkChange, 100);\n\n\n\n        if (doRender) {\n\n            //console.log('rendertime ms: ', this.renderTime);\n        }\n\n    }\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            klCanvas: KlCanvas;\n            width: number;\n            height: number;\n            onDraw: (val: TDrawEvent) => void;\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\n            onFill: (canvasX: number, canvasY: number) => void;\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onViewChange: (e:  IViewChangeEvent) => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                cursor: 'crosshair',\n                userSelect: 'none',\n            },\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\n        this.renderTargetCtx = BB.ctx(this.renderTargetCanvas);\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = BB.ctx(this.compositeCanvas);\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0,\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0,\n        };\n        this.renderedTransformObj = {} as ITransform;\n        this.cursorPos = {\n            x: 0,\n            y: 0,\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n\n        this.svgOverlay = new WorkspaceSvgOverlay({\n            width: p.width,\n            height: p.height,\n        });\n\n        BB.css(this.renderTargetCanvas, {\n            userSelect: 'none',\n            pointerEvents: 'none',\n        });\n        BB.createCheckerDataUrl(8, (url) => {\n            this.renderTargetCanvas.style.background = 'url(' + url + ')';\n        }, theme.isDark());\n\n        theme.addIsDarkListener(() => {\n            this.renderTargetCanvas.style.background = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\n        this.rootEl.addEventListener( 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener('dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.emptyCanvas = BB.canvas(1, 1);\n        this.emptyLightCanvas = BB.canvas(1, 1);\n        {\n            let ctx = BB.ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n            ctx = BB.ctx(this.emptyLightCanvas);\n            ctx.fillStyle = '#fff';\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\n                    return;\n                }\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n                if (isRepeat) {\n                    return;\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n\n                } else {\n\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if (['r', 'shift+r'].includes(comboStr)) {\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ('z' === comboStr) {\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                // prevent menu bar in Firefox\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n                }\n            },\n        });\n\n        this.updateChangeListener();\n\n        this.currentMode = TMode.Draw;\n        this.globalMode = TMode.Draw;\n\n        this.renderTime = 0;\n\n        this.lastDrawEvent = null;\n\n        this.linetoolProcessor = new LinetoolProcessor({\n            onDraw: (event) => {\n                const getMatrix = () => {\n                    const art = this.getRenderedTransform();\n                    let matrix = BB.Matrix.getIdentity();\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n\n                if (event.type === 'line' && !this.lastDrawEvent) {\n                    const matrix = getMatrix();\n                    let coords: TVec4 = [event.x1, event.y1, 0, 1];\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1,\n                    };\n                    return;\n                }\n\n                if ('x' in event || 'x0' in event) {\n\n                    const matrix = getMatrix();\n\n                    if ('x' in event) { //down or move\n                        let coords: TVec4 = [event.x, event.y, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x = coords[0];\n                        event.y = coords[1];\n                    }\n                    if ('x0' in event) { //line\n                        event.x0 = this.lastDrawEvent!.x;\n                        event.y0 = this.lastDrawEvent!.y;\n                        event.pressure0 = this.lastDrawEvent!.pressure;\n                        let coords: TVec4 = [event.x1, event.y1, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x1 = coords[0];\n                        event.y1 = coords[1];\n\n                        this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1,\n                        };\n                    }\n                }\n\n\n                if (event.type === 'down' || event.type === 'move') {\n                    this.lastDrawEvent = {\n                        x: event.x,\n                        y: event.y,\n                        pressure: event.pressure,\n                    };\n                }\n                p.onDraw(event);\n            },\n        });\n\n        this.pointer = null;\n        this.isDrawing = false;\n\n\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: (val) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Draw);\n\n                    const comboStr = this.keyListener.getComboStr();\n\n                    const event: any = {\n                        scale: this.highResTransformObj.scale,\n                    };\n                    event.shiftIsPressed = comboStr === 'shift';\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n\n                    if (val.type === 'pointerdown') {\n\n                        this.isDrawing = true;\n                        event.type = 'down';\n\n                    } else if (val.button) {\n                        event.type = 'move';\n\n                    } else if (val.type === 'pointerup') {\n\n                        this.isDrawing = false;\n                        event.type = 'up';\n\n                        this.linetoolProcessor.process(event);\n                        this.resetInputProcessor();\n                        return;\n                    } else {\n                        return;\n                    }\n\n                    event.x = val.relX;\n                    event.y = val.relY;\n\n                    this.linetoolProcessor.process(event);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            fill: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Fill);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            gradient: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Gradient);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            text: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Text);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            shape: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Shape);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            hand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button || '')) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            spaceHand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button || '')) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'space') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                },\n            },\n            zoom: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Zoom);\n\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n\n                        this.internalZoomByStep(event.dX / 175, event.downPageX! - offsetX, event.downPageY! - offsetY);\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale,\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'z') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Zoom);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                },\n            },\n            picker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button || '') && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup',\n                        });\n\n                        if (event.type === 'pointerup') {\n                            this.resetInputProcessor();\n                        }\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            altPicker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button || '') && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup',\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'alt') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                },\n            },\n            rotate: {\n                onPointer: (event) => {\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\n\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        const centerObj = {\n                            x: this.renderWidth / 2,\n                            y: this.renderHeight / 2,\n                        };\n\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX! - offsetX, y: event.downPageY! - offsetY});\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\n                        let dAngleRad = angleRad - startAngleRad;\n\n                        //apply angle\n                        this.targetTransformObj = BB.copyObj(this.oldTransformObj);\n                        this.targetTransformObj.angle += dAngleRad;\n\n                        if (this.keyListener.isPressed('shift')) {\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                        }\n\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\n\n                        //rotate transform.xy\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n\n                        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                        this.transformIsDirty = true;\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['angle'],\n                            scale: this.targetTransformObj.scale,\n                            angle: this.targetTransformObj.angle,\n                        });\n\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    const comboStr = this.keyListener.getComboStr();\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n            },\n        };\n        this.currentInputProcessor = null;\n\n\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new BB.PinchZoomer({\n            onPinch: (event) => {\n\n                if (event.type === 'move') {\n\n                    if (!this.oldTransformObj) {\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n\n                    this.targetTransformObj = BB.copyObj(this.oldTransformObj);\n\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\n\n                    this.targetTransformObj.scale *= event.scale;\n                    this.targetTransformObj.angle += event.angleRad;\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\n                        this.snapAngleRad(\n                            this.targetTransformObj.angle,\n                            90,\n                            this.angleIsExtraSticky ? 12 : 4\n                        )\n                    );\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\n                        this.angleIsExtraSticky = false;\n                    }\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n\n                    //calc translation\n                    {\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n\n\n                        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                    }\n\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                    //if (event.scale !== 1) {\n                    this.onViewChange({\n                        changed: ['scale', 'angle'],\n                        scale: this.targetTransformObj.scale,\n                        angle: this.targetTransformObj.angle,\n                    });\n                    //}\n                    this.reqFrame();\n                    this.transformIsDirty = true;\n                    this.lastRenderedState = -1;\n\n\n                } else if (event.type === 'end') {\n                    this.oldTransformObj = null;\n                }\n\n\n            },\n        });\n\n        const onDoubleTap = (event: IDoubleTapperEvent) => {\n            if (this.fitView(true)) {\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                // zoom 2 steps further\n\n                const didZoom = this.internalZoomByStep(\n                    2,\n                    event.relX,\n                    event.relY,\n                );\n                if (didZoom) {\n                    this.onViewChange({\n                        changed: ['scale'],\n                        angle: this.targetTransformObj.angle,\n                        scale: this.targetTransformObj.scale,\n                    });\n                }\n\n                //updateCursor(TMode.Draw, true);\n                this.lastRenderedState = -1;\n            }\n        };\n\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\n\n\n        this.twoFingerTap = new BB.NFingerTapper({\n            fingers: 2,\n            onTap: () => {\n                p.onUndo();\n            },\n        });\n        this.threeFingerTap = new BB.NFingerTapper({\n            fingers: 3,\n            onTap: () => {\n                p.onRedo();\n            },\n        });\n\n\n        this.pointerEventChain = new BB.EventChain({\n            chainArr: [\n                this.twoFingerTap as IChainElement,\n                this.threeFingerTap as IChainElement,\n                this.mainDoubleTapper as IChainElement,\n                this.middleDoubleTapper as IChainElement,\n                this.pinchZoomer as IChainElement,\n                new BB.OnePointerLimiter() as IChainElement,\n                new BB.CoalescedExploder() as IChainElement,\n            ],\n        });\n        this.pointerEventChain.setChainOut((event: ICoalescedPointerEvent) => {\n\n            this.cursorPos.x = event.relX;\n            this.cursorPos.y = event.relY;\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\n                this.pointer = null;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                if (!this.pointer) {\n                    this.pointer = { x: 0, y: 0 };\n                }\n                this.pointer.x = event.relX;\n                this.pointer.y = event.relY;\n            }\n\n            if (this.currentInputProcessor) {\n                this.currentInputProcessor.onPointer(event);\n\n            } else {\n\n                const comboStr = this.keyListener.getComboStr();\n\n                if (this.globalMode === TMode.Draw) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Draw);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Hand) {\n\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button || '')) {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n\n                } else if (this.globalMode === TMode.Pick) {\n\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button || '')) {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n\n                } else if (this.globalMode === TMode.Fill) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Fill);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Gradient) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Gradient);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Text) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.text;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Text);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Shape) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Shape);\n                        this.reqFrame();\n                    }\n\n                }\n\n\n            }\n\n        });\n\n        //prevent ctrl scroll -> zooming page\n        this.rootEl.addEventListener('wheel', (event) => {\n            event.preventDefault();\n        });\n\n\n        setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\n                        try {\n                            e.eventPreventDefault();\n                        } catch (e) {\n                            /* empty */\n                        }\n                    }\n                    // prevent manual slider input keeping focus on iPad\n                    if (e.type === 'pointerdown') {\n                        BB.unfocusAnyInput();\n                    }\n                    /*if (e.type === 'pointermove') {\n                        BB.throwOut(JSON.stringify(e));\n                    }*/\n\n                    this.pointerEventChain.chainIn(e);\n                },\n                onWheel: (wheelEvent) => {\n\n                    if (this.isDrawing) {\n                        return;\n                    }\n\n                    this.reqFrame();\n                    const didZoom = this.internalZoomByStep(\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\n                        wheelEvent.relX,\n                        wheelEvent.relY\n                    );\n                    if (didZoom) {\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale,\n                        });\n                    }\n\n                    //updateCursor(TMode.Draw, true);\n                    this.lastRenderedState = -1;\n\n\n                },\n                onEnterLeave: (isOver) => {\n                    if (!isOver) {\n                        if (!this.isDrawing) {\n                            this.pointer = null;\n                            this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4,\n            });\n        }, 1);\n\n        this.brushRadius = 1;\n\n        this.animationFrameRequested = false;\n\n\n\n\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n\n        window.requestAnimationFrame(() => this.updateLoop());\n\n        this.resetOrFitView();\n    }\n\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setCanvas (klC: KlCanvas): void {\n        this.klCanvas = klC;\n        this.lastDrawEvent = null;\n        this.resetView();\n\n        this.updateChangeListener();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    /**\n     * set size of workspace area in pixels\n     * @param width\n     * @param height\n     */\n    setSize (width: number, height: number): void {\n        const oldWidth = this.renderWidth;\n        const oldHeight = this.renderHeight;\n\n        if (width === oldWidth && height === oldHeight) {\n            return;\n        }\n\n        this.doResizeCanvas = true;\n        this.renderWidth = width;\n        this.renderHeight = height;\n\n        this.svgOverlay.setSize(width, height);\n\n        this.targetTransformObj.x += (width - oldWidth) / 2;\n        this.targetTransformObj.y += (height - oldHeight) / 2;\n\n        this.highResTransformObj.x = this.targetTransformObj.x;\n        this.highResTransformObj.y = this.targetTransformObj.y;\n\n        this.bgVisible = this.testBgVisible();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setMode (modeStr: TModeStr): void {\n        //only sets the base mode\n        if (modeStr === 'draw') {\n            this.globalMode = TMode.Draw;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'fill') {\n            this.globalMode = TMode.Fill;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'gradient') {\n            this.globalMode = TMode.Gradient;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'text') {\n            this.globalMode = TMode.Text;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'shape') {\n            this.globalMode = TMode.Shape;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'hand') {\n            this.globalMode = TMode.Hand;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n        }\n        if (modeStr === 'pick') {\n            this.globalMode = TMode.Pick;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n    }\n\n    getMode (): TModeStr {\n        if (this.globalMode === TMode.Draw) {\n            return 'draw';\n        }\n        if (this.globalMode === TMode.Fill) {\n            return 'fill';\n        }\n        if (this.globalMode === TMode.Gradient) {\n            return 'gradient';\n        }\n        if (this.globalMode === TMode.Text) {\n            return 'text';\n        }\n        if (this.globalMode === TMode.Shape) {\n            return 'shape';\n        }\n        if (this.globalMode === TMode.Hand) {\n            return 'hand';\n        }\n        if (this.globalMode === TMode.Pick) {\n            return 'pick';\n        }\n        throw new Error('unknown globalMode');\n    }\n\n    setCursorSize (diameter: number): void {\n        this.brushRadius = diameter / 2;\n\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n\n        if (this.pointer === null) {\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\n\n            this.svgOverlay.updateCursor({\n                x: this.renderWidth / 2,\n                y: this.renderHeight / 2,\n                isVisible: true,\n            });\n\n            this.hideBrushCursorTimeout = setTimeout(() => {\n                if (this.pointer !== null) {\n                    return;\n                }\n                this.svgOverlay.updateCursor({isVisible: false});\n            }, 500);\n        }\n    }\n\n    zoomByStep (stepNum: number): void {\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\n            return;\n        }\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale'],\n            angle: this.targetTransformObj.angle,\n            scale: this.targetTransformObj.scale,\n        });\n    }\n\n    resetView (doAnimate?: boolean): void {\n        this.targetTransformObj.scale = 1;\n        this.targetTransformObj.angle = 0;\n\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n\n        if (doAnimate) {\n            this.doAnimateTranslate = true;\n            this.transformIsDirty = true;\n        } else {\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n        }\n\n        this.bgVisible = this.testBgVisible();\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle,\n            });\n        }\n    }\n\n    /**\n     * fit into view. center. snap angle. padding\n     * returns true if transform changes\n     */\n    fitView (doAnimate?: boolean): boolean {\n        // determine new transform\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\n\n        //calc width and height of bounds\n        const canvasPointsArr = [\n            [0, 0], // top left\n            [this.klCanvas.getWidth(), 0], // top right\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\n            [0, this.klCanvas.getHeight()], // bottom left\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\n        ];\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\n\n        //rotate points\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            let coords: TVec4 = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n\n        const boundsObj: Partial<IBounds> = {};\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            if (boundsObj.x1 === undefined || canvasPointsArr[i][0] < boundsObj.x1) {\n                boundsObj.x1 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y1 === undefined || canvasPointsArr[i][1] < boundsObj.y1) {\n                boundsObj.y1 = canvasPointsArr[i][1];\n            }\n            if (boundsObj.x2 === undefined || canvasPointsArr[i][0] > boundsObj.x2) {\n                boundsObj.x2 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y2 === undefined || canvasPointsArr[i][1] > boundsObj.y2) {\n                boundsObj.y2 = canvasPointsArr[i][1];\n            }\n        }\n        const boundsWidth = boundsObj.x2! - boundsObj.x1!;\n        const boundsHeight = boundsObj.y2! - boundsObj.y1!;\n\n        //fit bounds\n        const padding = 0;\n        const { width: fitWidth } = BB.fitInto(\n            boundsWidth,\n            boundsHeight, \n            this.renderWidth - padding, \n            this.renderHeight - padding, \n            1\n        );\n\n        //determine scale\n        const factor = Math.min(MAX_SCALE, fitWidth / boundsWidth);\n\n        const newTargetTransformObj = {\n            angle: newAngle,\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\n            scale: factor,\n        };\n\n        if (\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\n            newTargetTransformObj.scale === this.targetTransformObj.scale\n        ) {\n            return false;\n        }\n        this.targetTransformObj = newTargetTransformObj;\n\n        if (doAnimate) {\n            this.doAnimateTranslate = true;\n        } else {\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n        }\n        this.transformIsDirty = true;\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle,\n            });\n        }\n        return true;\n    }\n\n    /**\n     * let the workspace decide what is best. E.g. if it's pixel art, Fit might be better.\n     */\n    resetOrFitView (): void {\n        const threshold = 4; // >= 400% zoom. pixelated, not blurry\n        if (\n            !klConfig.disableAutoFit &&\n            this.klCanvas.getWidth() <= this.renderWidth / threshold &&\n            this.klCanvas.getHeight() <= this.renderHeight / threshold\n        ) {\n            this.fitView();\n        } else {\n            this.resetView();\n        }\n    }\n\n    setAngle (angleDeg: number, isRelative?: boolean): void {\n        //rotation done around center\n        const centerObj = {\n            x: this.renderWidth / 2,\n            y: this.renderHeight / 2,\n        };\n\n        const oldAngleRad = this.targetTransformObj.angle;\n        const angleRad = angleDeg / 180 * Math.PI;\n\n        if (isRelative) {\n            this.targetTransformObj.angle += angleRad;\n        } else {\n            this.targetTransformObj.angle = angleRad;\n        }\n\n        this.targetTransformObj.angle = this.minimizeAngleRad(\n            this.snapAngleRad(\n                this.targetTransformObj.angle,\n                90,\n                4\n            )\n        );\n\n        //rotate transform.xy\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n\n        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n        this.transformIsDirty = true;\n        this.reqFrame(true);\n    }\n\n    /**\n     * translate canvas by viewport pixels\n     * @param tx\n     * @param ty\n     */\n    translateView (tx: number, ty: number): void {\n        const scale = 40;\n\n        this.targetTransformObj.x += tx * scale;\n        this.targetTransformObj.y += ty * scale;\n\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.reqFrame(true);\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    getScale (): number {\n        return this.targetTransformObj.scale;\n    }\n\n    getAngleDeg (): number {\n        return this.targetTransformObj.angle * 180 / Math.PI;\n    }\n\n    getMaxScale (): number {\n        return MAX_SCALE;\n    }\n\n    getMinScale (): number {\n        return MIN_SCALE;\n    }\n\n    requestFrame (): void {\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setLastDrawEvent (x?: number, y?: number, pressure?: number): void {\n        if (x === undefined) {\n            this.lastDrawEvent = null;\n            return;\n        }\n\n        if (!this.lastDrawEvent) {\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\n        }\n        this.lastDrawEvent.x = x;\n        this.lastDrawEvent.y = y!;\n        this.lastDrawEvent.pressure = pressure!;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"cursor-picker.2dc5b283.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"cursor-zoom-ew.3e31c6b3.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"cursor-fill.d01bd02c.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"cursor-text.543fd55c.png\" + \"?\" + Date.now();","import {IDrawDownEvent, IDrawMoveEvent, IDrawUpEvent, TDrawEvent} from '../kl-types';\nimport {BB} from '../../bb/bb';\n\nconst DIR_X = 0;\nconst DIR_Y = 1;\n\n/**\n * Not really and event chain element. but pretty similar.\n *\n * Processes draw input events. When shift held -> linetool\n * line events - what KlCanvasWorkspace passes onDraw(e)\n *\n * pass input in with process(drawEvent)\n *\n * modifies draw event to include such events:\n * {\n *     type: 'line',\n *     x0: null, // you have to fill that in\n *     y0: null, // you have to fill that in\n *     pressure0: null, // you have to fill that in\n *     x1: number,\n *     y1: number,\n *     pressure1: number\n * }\n */\nexport class LinetoolProcessor {\n\n    private readonly onDraw: (drawEvent: TDrawEvent) => void;\n    private downEvent: IDrawDownEvent | null = null;\n    private eventQueue: (IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent)[] = [];\n    private direction: 0 | 1 | null = null;\n\n    // --- public ---\n    constructor (\n        p : {\n            onDraw: (drawEvent: TDrawEvent) => void;\n        }\n    ) {\n        this.onDraw = p.onDraw;\n    }\n\n    process (event: IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent): void {\n        if (event.type === 'down') {\n            this.downEvent = event;\n            this.direction = null;\n\n            if (event.shiftIsPressed) {\n\n                this.onDraw({\n                    type: 'line',\n                    x0: null,\n                    y0: null,\n                    pressure0: null,\n                    x1: event.x,\n                    y1: event.y,\n                    pressure1: event.pressure,\n                });\n\n                this.eventQueue.push(event);\n                return;\n            }\n\n        }\n\n        if (event.type === 'move' && this.downEvent) {\n\n            if (event.shiftIsPressed) {\n\n                if (this.direction === null) {\n                    const dX = Math.abs(event.x - this.downEvent.x);\n                    const dY = Math.abs(event.y - this.downEvent.y);\n\n                    if (dX > 5 || dY > 5) {\n                        this.direction = dX > dY ? DIR_X : DIR_Y;\n\n                        for (let i = 0; i < this.eventQueue.length; i++) {\n                            const e = this.eventQueue[i];\n                            if (e.type !== 'up') {\n                                if (this.direction === DIR_X) {\n                                    e.y = this.downEvent.y;\n                                } else {\n                                    e.x = this.downEvent.x;\n                                }\n                            }\n                            this.onDraw(BB.copyObj(e));\n                        }\n                        this.eventQueue = [];\n                    }\n                }\n\n                if (this.direction === null) {\n                    this.eventQueue.push(event);\n                    return;\n                }\n\n                if (this.direction === DIR_X) {\n                    event.y = this.downEvent.y;\n                } else {\n                    event.x = this.downEvent.x;\n                }\n\n            } else {\n                if (this.eventQueue.length > 0) {\n                    for (let i = 0; i < this.eventQueue.length; i++) {\n                        this.onDraw(BB.copyObj(this.eventQueue[i]));\n                    }\n                    this.eventQueue = [];\n                }\n            }\n\n        }\n\n        if (event.type === 'up') {\n            this.eventQueue = [];\n            this.downEvent = null;\n        }\n\n        this.onDraw(BB.copyObj(event));\n    }\n}\n","\ntype TKlConfig = {\n    filenameBase: string; // part of filename when downloading drawing\n    disableAutoFit?: boolean;\n};\n\nexport const klConfig: TKlConfig = {\n    filenameBase: 'Klecks',\n};\n","import {BB} from '../../bb/bb';\nimport {IKlBasicLayer} from '../kl-types';\nimport {theme} from '../../theme/theme';\n\n/**\n * preview of image with layers. can do mix modes and opacity.\n * creates a canvas.\n */\nexport class KlCanvasPreview {\n\n    private readonly canvas: HTMLCanvasElement;\n    private readonly ctx: CanvasRenderingContext2D | null;\n    private readonly layers: IKlBasicLayer[];\n    private readonly updateCheckerboard: () => void;\n\n    // --- public ---\n    constructor (\n        p: {\n            width: number;\n            height: number;\n            layers: IKlBasicLayer[]; // items can be changed after the fact - but not the object\n        }\n    ) {\n        this.layers = p.layers;\n\n        const scale = p.width / p.layers[0].image.width;\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\n\n        this.canvas = BB.canvas(width, height);\n        this.updateCheckerboard = () => {\n            this.canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\n        };\n        this.updateCheckerboard();\n        this.ctx = BB.ctx(this.canvas);\n\n        BB.css(this.canvas, {\n            width: '100%',\n            height: '100%',\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\n        });\n\n        setTimeout(() => this.render(), 0);\n        theme.addIsDarkListener(this.updateCheckerboard);\n    }\n\n    getElement (): HTMLCanvasElement {\n        return this.canvas;\n    }\n\n    render (): void {\n        if (!this.ctx) {\n            return;\n        }\n\n        this.ctx.save();\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        for (let i = 0; i < this.layers.length; i++) {\n            const layer = this.layers[i];\n            if (!layer.isVisible || layer.opacity === 0) {\n                continue;\n            }\n            this.ctx.globalAlpha = this.layers[i].opacity;\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr as GlobalCompositeOperation;\n            if (this.canvas.width > this.layers[i].image.width) {\n                this.ctx.imageSmoothingEnabled = false;\n            }\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\n        }\n        this.ctx.restore();\n    }\n\n    destroy (): void {\n        theme.removeIsDarkListener(this.updateCheckerboard);\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport rotateImg from '/src/app/img/ui/cursor-rotate.png';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {IVector2D} from '../../../bb/bb-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {\n    copyTransform,\n    IFreeTransform,\n    snapToPixel,\n    TFreeTransformCorner,\n    TFreeTransformEdge,\n    toImageSpace,\n    toTransformSpace,\n} from './free-transform-utils';\n\n/**\n * Free Transform UI\n * rotate, scale, translate\n *\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\n *      - this is what complicates things\n * - if transform region small, corner grips move out of the way\n *\n * iX iY, iP.x, iP.y - i indicates image space\n * tX tY, tP.x, tP.y - t indicates transform space\n *\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\n * Probably can't be extended for distort. Needs a different approach.\n *\n * --- DOM structure ---\n * rootEl {\n * \ttransEl [\n * \t\tboundsEl\n * \t\tedges[]\n * \t\tcorners[] - round grips in the corner of transform region\n * \t\tangleGrip\n * \t]\n * }\n *\n */\nexport class FreeTransform {\n\n    // --- private ---\n    private readonly value: IFreeTransform; // coordinates and dimensions of transformation\n    private isConstrained: boolean;\n    private ratio: number; // aspect ratio of transform\n    private viewportTransform: {scale: number; x: number; y: number};\n    private readonly scaled = { // scaled coordinates and dimensions for screen space\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        corners: [{x: 0, y: 0}], // in transform space\n    };\n    private readonly minSnapDist = 7; // minimal snapping distance in px screen space\n    private snappingEnabled: boolean;\n    private readonly snapX: number[];\n    private readonly snapY: number[];\n    private readonly callback: (transform: IFreeTransform) => void;\n\n\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n    private readonly gripSize = 16;\n    private readonly edgeSize = 10;\n\n    private readonly rootEl: HTMLElement; // sits at origin of image\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\n    private readonly corners: TFreeTransformCorner[] = [];\n    private keyListener: KeyListener;\n    private boundsPointerListener: PointerListener; // BB.PointerListener\n    private anglePointerListener: PointerListener; // BB.PointerListener\n    private readonly edges: TFreeTransformEdge[] = [];\n    private readonly angleGrip: {\n        el: HTMLElement;\n        x: number; // transform space\n        y: number;\n        snap: boolean;\n        updateDOM: () => void;\n    };\n\n    private updateScaled (): void {\n        this.scaled.x = this.value.x * this.viewportTransform.scale;\n        this.scaled.y = this.value.y * this.viewportTransform.scale;\n        this.scaled.width = this.value.width * this.viewportTransform.scale;\n        this.scaled.height = this.value.height * this.viewportTransform.scale;\n        this.scaled.corners = this.corners.map((item) => {\n            return {x: item.x * this.viewportTransform.scale, y: item.y * this.viewportTransform.scale};\n        });\n    }\n\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */\n    private snapCorner (iX: number, iY: number): IVector2D {\n        if (!this.snappingEnabled) {\n            return {x: iX, y: iY};\n        }\n        let dist: number;\n        const snap: {\n            x?: number;\n            y?: number;\n            dist: {\n                x?: number;\n                y?: number;\n            };\n        } = {\n            x: undefined,\n            y: undefined,\n            dist: {\n                x: undefined,\n                y: undefined,\n            },\n        };\n        for (let e = 0; e < this.snapX.length; e++) {\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.x === undefined || dist < snap.dist.x!) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for (let e = 0; e < this.snapY.length; e++) {\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.y === undefined || dist < snap.dist.y!) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n\n        if (snap.x === undefined && snap.y === undefined) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        return {\n            x: snap.x ?? iX,\n            y: snap.y ?? iY,\n        };\n    }\n\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\n        if (!this.isConstrained) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        const flip = this.value.width * this.value.height < 0 ? -1 : 1;\n        return BB.projectPointOnLine(\n            {x: this.value.x, y: this.value.y},\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.value),\n            {x: iX, y: iY}\n        );\n    }\n\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */\n    private updateCornerPositions (): void {\n        this.corners[0].x = (-this.value.width / 2); // top left\n        this.corners[0].y = (-this.value.height / 2);\n\n        this.corners[1].x = (this.value.width / 2); // top right\n        this.corners[1].y = (-this.value.height / 2);\n\n        this.corners[2].x = (this.value.width / 2); // bottom right\n        this.corners[2].y = (this.value.height / 2);\n\n        this.corners[3].x = (-this.value.width / 2); // bottom left\n        this.corners[3].y = (this.value.height / 2);\n    }\n\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\n        if (!this.isConstrained) {\n            return;\n        }\n        const angle90 = Math.abs(this.value.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.value.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) {\n                newWidth = (whSwapped ? this.value.y % 1 : this.value.x % 1) === 0 ?\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\n            }\n            if (this.corners[1].x - this.corners[0].x < 0) {\n                newWidth *= -1;\n            }\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) {\n                newHeight = (whSwapped ? this.value.x % 1 : this.value.y % 1) === 0  ?\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\n            }\n            if (this.corners[3].y - this.corners[0].y < 0) {\n                newHeight *= -1;\n            }\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n\n\n    /**\n     * update transform based on corners\n     * @private\n     */\n    private updateTransformViaCorners (): void {\n\n        // calc transform center in image space\n        const rot = BB.rotateAround(\n            {x: 0, y: 0},\n            {\n                x: (this.corners[0].x + this.corners[1].x) / 2,\n                y: (this.corners[0].y + this.corners[3].y) / 2,\n            },\n            this.value.angleDeg\n        );\n        this.value.x = rot.x + this.value.x;\n        this.value.y = rot.y + this.value.y;\n\n        // update size\n        this.value.width = this.corners[1].x - this.corners[0].x;\n        this.value.height = this.corners[3].y - this.corners[0].y;\n\n        // new center means corners changed their position\n        this.updateCornerPositions();\n\n        this.updateDOM();\n    }\n\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */\n    private updateDOM (skipCallback?: boolean): void {\n        this.updateScaled();\n\n        BB.css(this.transEl, {\n            left: (this.viewportTransform.x + this.scaled.x) + 'px',\n            top: (this.viewportTransform.y + this.scaled.y) + 'px',\n            transformOrigin: '0 0',\n            transform: 'rotate(' + this.value.angleDeg + 'deg)',\n        });\n\n        BB.css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + 'px',\n            height: Math.abs(this.scaled.height) + 'px',\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n        });\n\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n\n\n        this.angleGrip.x = 0;\n        this.angleGrip.y = (-Math.abs(this.value.height * this.viewportTransform.scale) / 2) - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) { // why should updateDOM trigger the callback?\n                this.callback(copyTransform(this.value));\n            }\n        }\n    }\n\n\n\n    // --- public ---\n    constructor (\n        params: {\n            x: number; // center of transform region. image space\n            y: number;\n            width: number; // size of transform region. image space\n            height: number;\n            angleDeg: number; // angle of transform region. degrees\n\n            isConstrained: boolean; // proportions constrained\n            snapX: number[]; // where snapping along X axis. image space\n            snapY: number[]; // where snapping along X axis. image space\n            viewportTransform: {scale: number; x: number; y: number};\n            callback: (transform: IFreeTransform) => void;\n        }\n    ) {\n        this.viewportTransform = {...params.viewportTransform};\n        this.value = { // coordinates and dimensions of transformation\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg,\n        };\n\n        this.isConstrained = params.isConstrained;\n\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.snappingEnabled = true;\n        this.ratio = this.value.width / this.value.height;\n\n        this.rootEl = BB.el({\n            className: 'kl-free-transform',\n            css: {\n                userSelect: 'none',\n            },\n        });\n        this.transEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n            },\n        });\n\n        this.boundsEl = BB.el({\n            css: {\n                position: 'absolute',\n                cursor: 'move',\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\n            },\n        });\n\n        const pointerRemainder = {\n            x: 0,\n            y: 0,\n        };\n        function resetRemainder (): void {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new BB.KeyListener({});\n\n        let boundsStartP = {\n            x: 0,\n            y: 0,\n        };\n        this.boundsPointerListener = new BB.PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointerdown') {\n                    boundsStartP = {x: this.value.x, y: this.value.y};\n                }\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    this.value.x = boundsStartP.x + (event.pageX - event.downPageX!) / this.viewportTransform.scale;\n                    this.value.y = boundsStartP.y + (event.pageY - event.downPageY!) / this.viewportTransform.scale;\n\n\n                    let dist: number;\n                    let snap: {\n                        x?: number;\n                        y?: number;\n                        distX: number;\n                        distY: number;\n                    } = {\n                        distX: -1,\n                        distY: -1,\n                    };\n                    if (this.snappingEnabled) {\n                        let i;\n                        for (i = 0; i < this.snapX.length; i++) {\n                            dist = Math.abs(this.value.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.x === undefined || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for (i = 0; i < this.snapY.length; i++) {\n                            dist = Math.abs(this.value.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.y === undefined || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n\n                        let iP;\n                        for (i = 0; i < 4; i++) {\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.value);\n                            let j;\n                            for (j = 0; j < this.snapX.length; j++) {\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.x === undefined || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.value.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for (j = 0; j < this.snapY.length; j++) {\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.y === undefined || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.value.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        let projected = BB.projectPointOnLine(\n                            {x: 0, y: boundsStartP.y},\n                            {x: 10, y: boundsStartP.y},\n                            {x: this.value.x, y: this.value.y});\n                        let dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist,\n                        };\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: 0},\n                            {x: boundsStartP.x, y: 10},\n                            {x: this.value.x, y: this.value.y});\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\n                            {x: this.value.x, y: this.value.y});\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\n                            {x: this.value.x, y: this.value.y});\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n                    }\n                    if (snap.x != undefined) {\n                        this.value.x = snap.x;\n                    }\n                    if (snap.y != undefined) {\n                        this.value.y = snap.y;\n                    }\n\n                    // snap to pixels\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        snapToPixel(this.value);\n                        this.updateCornerPositions();\n                    }\n\n                    this.updateDOM();\n                }\n            },\n        });\n\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = this.corners[i] = {\n                    i: i,\n                    el: BB.el({\n                        css: {\n                            width: this.gripSize + 'px',\n                            height: this.gripSize + 'px',\n                            background: '#fff',\n                            /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/\n                            borderRadius: this.gripSize + 'px',\n                            position: 'absolute',\n                            border: '2px solid #000',\n                        },\n                    }) as HTMLElement,\n                    x: 0,\n                    y: 0,\n                    virtualPos: {\n                        x: 0,\n                        y: 0,\n                    },\n                } as TFreeTransformCorner;\n                g.updateDOM = (): void => {\n\n                    // grip position\n                    // if it gets small: slightly offset grips, so easier to handle\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\n                        item[0] *= this.value.width > 0 ? 1 : -1;\n                        item[1] *= this.value.height > 0 ? 1 : -1;\n                        return item;\n                    });\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\n\n                    BB.css(g.el, {\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px',\n                    });\n\n\n                    // cursor\n                    let angle = BB.pointsToAngleDeg(\n                        {\n                            x: this.value.x,\n                            y: this.value.y,\n                        },\n                        toImageSpace(g.x, g.y, this.value),\n                    ) + 135; // offset so nw is 0\n                    while (angle < 0) {\n                        angle += 360;\n                    }\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\n                    BB.css(g.el, {\n                        cursor: this.cornerCursors[index] + '-resize',\n                    });\n                };\n\n                g.pointerListener = new BB.PointerListener({\n                    target: this.corners[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.value);\n\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\n                            this.corners[i].virtualPos.x += event.dX / this.viewportTransform.scale;\n                            this.corners[i].virtualPos.y += event.dY / this.viewportTransform.scale;\n\n                            let iP = {\n                                x: this.corners[i].virtualPos.x,\n                                y: this.corners[i].virtualPos.y,\n                            };\n                            iP = this.constrainCorner(i, iP.x, iP.y);\n                            if (!this.isConstrained) {\n                                iP = this.snapCorner(iP.x, iP.y);\n                            }\n\n                            if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                                iP.x = Math.round(iP.x);\n                                iP.y = Math.round(iP.y);\n                            }\n\n                            const tP = toTransformSpace(iP.x, iP.y, this.value);\n\n                            const dX = tP.x - this.corners[i].x;\n                            const dY = tP.y - this.corners[i].y;\n                            this.corners[i].x = tP.x;\n                            this.corners[i].y = tP.y;\n\n                            let indexes: number[] = [];\n                            if (i === 0) { // top left\n                                indexes = [3, 1, 2];\n                            } else if (i === 1) { // top right\n                                indexes = [2, 0, 3];\n                            } else if (i === 2) { // bottom right\n                                indexes = [1, 3, 0];\n                            } else if (i === 3) { // bottom left\n                                indexes = [0, 2, 1];\n                            }\n\n                            this.corners[indexes[0]].x = this.corners[i].x;\n                            this.corners[indexes[1]].y = this.corners[i].y;\n                            if (this.keyListener.isPressed('shift')) {\n                                this.corners[indexes[2]].x -= dX;\n                                this.corners[indexes[2]].y -= dY;\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    },\n                });\n\n            })(i);\n        }\n\n        this.updateCornerPositions();\n        this.updateScaled();\n\n        let isInverted: boolean;\n        for (let i = 0; i < 4; i++) {\n            ((i): void => {\n                this.edges[i] = {\n                    el: BB.el({\n                        css: {\n                            width: this.edgeSize + 'px',\n                            height: this.edgeSize + 'px',\n                            /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/\n                            position: 'absolute',\n                        },\n                    }) as HTMLElement,\n                } as TFreeTransformEdge;\n                const g = this.edges[i];\n                g.updateDOM = () => {\n                    if (i === 0) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g.el, {\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g.el, {\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    }\n                    let angleOffset = Math.round(this.value.angleDeg / 45);\n                    while (angleOffset < 0) {\n                        angleOffset += 8;\n                    }\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\n\n                };\n\n                const isVertical = [0, 2].includes(i);\n                g.pointerListener = new BB.PointerListener({\n                    target: this.edges[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            if (isVertical) { // top bottom\n                                isInverted = this.corners[0].y >= this.corners[3].y;\n                            } else { // left right\n                                isInverted = this.corners[0].x >= this.corners[1].x;\n                            }\n                            resetRemainder();\n                        }\n                        if (event.type === 'pointermove' && event.button === 'left') {\n                            const tfD = BB.rotateAround({x: 0, y: 0},\n                                {x: event.dX / this.viewportTransform.scale, y: event.dY / this.viewportTransform.scale},\n                                -this.value.angleDeg);\n                            let ti = {\n                                dX: tfD.x,\n                                dY: tfD.y,\n                            };\n                            if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\n                            }\n\n                            let indexes: number[] = [];\n                            if (i === 0) { // top\n                                indexes = [2, 3, 0, 1];\n                            } else if (i === 1) { // right\n                                indexes = [0, 3, 1, 2];\n                            } else if (i === 2) { // bottom\n                                indexes = [0, 1, 2, 3];\n                            } else if (i === 3) { // left\n                                indexes = [1, 2, 0, 3];\n                            }\n\n                            const dimension = isVertical ? 'y' : 'x';\n                            const d = isVertical ? ti.dY : ti.dX;\n\n                            if (isInverted) {\n                                this.corners[indexes[0]][dimension] += d;\n                                this.corners[indexes[1]][dimension] += d;\n                            } else {\n                                this.corners[indexes[2]][dimension] += d;\n                                this.corners[indexes[3]][dimension] += d;\n                            }\n                            if (this.keyListener.isPressed('shift')) {\n                                if (isInverted) {\n                                    this.corners[indexes[2]][dimension] -= d;\n                                    this.corners[indexes[3]][dimension] -= d;\n                                } else {\n                                    this.corners[indexes[0]][dimension] -= d;\n                                    this.corners[indexes[1]][dimension] -= d;\n                                }\n                            }\n\n                            if (isVertical) { // top bottom\n                                this.restoreRatio(false, true);\n                            } else { // left right\n                                this.restoreRatio(true, false);\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    },\n                });\n\n            })(i);\n        }\n\n        this.angleGrip = {\n            el: BB.el({\n                css: {\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\n                    width: this.gripSize + 'px',\n                    height: this.gripSize + 'px',\n                    background: '#0ff',\n                    borderRadius: this.gripSize + 'px',\n                    position: 'absolute',\n                    boxShadow: 'inset 0 0 0 2px #000',\n                },\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: () => {\n                BB.css(this.angleGrip.el, {\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\n                });\n            },\n        };\n        BB.el({\n            parent: this.angleGrip.el,\n            css: {\n                width: '2px',\n                height: '13px',\n                left: (this.gripSize / 2 - 1) + 'px',\n                top: this.gripSize + 'px',\n                background: '#0ff',\n                position: 'absolute',\n            },\n        });\n\n        this.anglePointerListener = new BB.PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft + this.viewportTransform.x,\n                        y: bounds.top - this.rootEl.scrollTop + this.viewportTransform.y,\n                    };\n                    const iP = {\n                        x: (event.clientX - offset.x) / this.viewportTransform.scale,\n                        y: (event.clientY - offset.y) / this.viewportTransform.scale,\n                    };\n\n                    const a = BB.pointsToAngleDeg({x: this.value.x, y: this.value.y}, iP) + 90;\n                    this.value.angleDeg = a;\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        this.value.angleDeg = snapDeg;\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\n                        this.value.angleDeg = snapDeg;\n                    }\n                    this.updateDOM();\n\n                }\n                if (event.type === 'pointerup') {\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        snapToPixel(this.value);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            },\n        });\n\n        snapToPixel(this.value);\n        this.updateDOM(true);\n        BB.append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el,\n        ]);\n\n\n    }\n\n\n\n    getValue (): IFreeTransform {\n        return copyTransform(this.value);\n    }\n\n    setIsConstrained (b: boolean): void {\n        this.isConstrained = b;\n        if (b && this.value.width !== 0 && this.value.height !== 0) {\n            this.ratio = Math.abs(this.value.width / this.value.height);\n        }\n    }\n\n    setSnapping (b: boolean): void {\n        this.snappingEnabled = b;\n    }\n\n    setPos (p: IVector2D): void {\n        this.value.x = p.x;\n        this.value.y = p.y;\n        this.updateDOM(true);\n    }\n\n    move (dX: number, dY: number): void {\n        this.value.x += dX;\n        this.value.y += dY;\n        this.updateDOM(false);\n    }\n\n    setSize (w: number, h: number): void {\n        this.value.width = w;\n        this.value.height = h;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            snapToPixel(this.value);\n        }\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n\n    setAngleDeg (a: number): void {\n        this.value.angleDeg = a;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            snapToPixel(this.value);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n\n    setViewportTransform (transform: { scale: number; x: number; y: number }): void {\n        this.viewportTransform = transform;\n        this.updateScaled();\n        this.updateDOM();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getRatio (): number {\n        return this.ratio;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners.forEach(item => item.pointerListener.destroy());\n        this.edges.forEach(item => item.pointerListener.destroy());\n        this.anglePointerListener.destroy();\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"cursor-rotate.509e78a5.png\" + \"?\" + Date.now();","import {IVector2D} from '../../../bb/bb-types';\nimport {BB} from '../../../bb/bb';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\nexport interface IFreeTransform {\n    x: number; // center of transform region. image space\n    y: number;\n    width: number; // size of transform region. image space\n    height: number;\n    angleDeg: number; // angle of transform region. degrees\n}\n\n\nexport type TFreeTransformCorner = {\n    i: number; // index in corners array\n    el: HTMLElement; // draggable corner circle in DOM\n    x: number; // unscaled position (transform space)\n    y: number;\n    virtualPos: IVector2D; // unscaled temporary position (image space)\n    updateDOM: () => void; // update styling in DOM\n    pointerListener: PointerListener;\n};\n\nexport type TFreeTransformEdge = { // derive position from corners\n    el: HTMLElement;\n    updateDOM: () => void;\n    pointerListener: PointerListener;\n};\n\n/**\n * snap entire transform to pixel grid. changes transform\n *\n * for x y:\n * If a dimension has an even size, it be an integer.\n * If it's uneven, it's sits exactly half way between two pixels.\n *\n * @param transform\n */\nexport function snapToPixel (transform: IFreeTransform): void {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\n        return;\n    }\n\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0 is original orientation.\n    // At 90 and 270 width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\n\nexport function copyTransform (transform: IFreeTransform): IFreeTransform {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg,\n    };\n}\n\n/**\n * image space to transform space\n * - origin of transform space is at center of transform bounds.\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\n * - up is where transform points up\n * - x goes right\n * - y goes down\n * @param x\n * @param y\n * @param transform\n */\nexport function toTransformSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: px, y: py},\n        -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n\n    return {\n        x: px,\n        y: py,\n    };\n}\n\n/**\n * transform space to image space\n * @param x\n * @param y\n * @param transform\n */\nexport function toImageSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: x, y: y},\n        transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y,\n    };\n}\n","import {BB} from '../../../bb/bb';\nimport {FreeTransform} from './free-transform';\nimport {IKlBasicLayer} from '../../kl-types';\nimport {IRect} from '../../../bb/bb-types';\nimport {Preview} from '../project-viewport/preview';\nimport {TProjectViewportProject} from '../project-viewport/project-viewport';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {IFreeTransform} from './free-transform-utils';\n\n/**\n * a basic canvas where you can transform one layer(move around, rotate, scale)\n */\nexport class FreeTransformCanvas {\n\n    private readonly rootEl: HTMLElement;\n    private readonly freeTransform: FreeTransform;\n    private readonly layers: IKlBasicLayer[];\n    private readonly transformIndex: number;\n    private readonly imageWidth: number;\n    private readonly imageHeight: number;\n    private readonly initTransform: IRect;\n    private readonly previewLayerArr: TProjectViewportProject['layers'];\n    private readonly preview: Preview;\n    private readonly previewCanvas: HTMLCanvasElement;\n\n    private updatePreview (): void {\n        const transform = this.freeTransform.getValue();\n\n        const ctx = BB.ctx((this.previewCanvas));\n        ctx.save();\n        ctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        BB.drawTransformedImageWithBounds(\n            ctx,\n            this.layers[this.transformIndex].image,\n            transform,\n            undefined,\n            BB.testShouldPixelate(\n                transform,\n                transform.width / this.initTransform.width,\n                transform.height / this.initTransform.height\n            ),\n        );\n        ctx.restore();\n        this.preview.render();\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            elementWidth: number;\n            elementHeight: number;\n            imageWidth: number;\n            imageHeight: number;\n            layers: IKlBasicLayer[];\n            transformIndex: number;\n        }\n    ) {\n        this.imageWidth = p.imageWidth;\n        this.imageHeight = p.imageHeight;\n\n        this.rootEl = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: p.elementWidth + 'px',\n                height: p.elementHeight + 'px',\n            },\n        });\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n        this.layers = p.layers;\n        this.transformIndex = p.transformIndex;\n\n        this.previewLayerArr = this.layers.map(item => {\n            return {\n                image: item.image,\n                isVisible: item.isVisible,\n                mixModeStr: item.mixModeStr ?? 'source-over',\n                opacity: item.opacity,\n                hasClipping: false,\n            };\n        });\n        this.previewCanvas = BB.canvas(this.imageWidth, this.imageHeight);\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = this.previewCanvas;\n\n        this.preview = new Preview({\n            width: p.elementWidth,\n            height: p.elementHeight,\n            project: {\n                width: p.imageWidth,\n                height: p.imageHeight,\n                layers: this.previewLayerArr,\n            },\n            hasEditMode: true,\n            onModeChange: (m) => {\n                this.freeTransform.getElement().style.pointerEvents = m === 'edit' ? '' : 'none';\n                this.freeTransform.getElement().style.opacity = m === 'edit' ? '' : '0.5';\n            },\n            onTransformChange: (transform) => {\n                this.freeTransform.setViewportTransform(transform);\n            },\n            padding: 30,\n        });\n        this.preview.getElement().classList.add(css({\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        this.rootEl.append(this.preview.getElement());\n\n        {\n            this.initTransform = {\n                x: this.imageWidth / 2,\n                y: this.imageHeight / 2,\n                width: this.layers[this.transformIndex].image.width,\n                height: this.layers[this.transformIndex].image.height,\n            };\n            this.freeTransform = new FreeTransform({\n                x: this.initTransform.x,\n                y: this.initTransform.y,\n                width: this.initTransform.width,\n                height: this.initTransform.height,\n                angleDeg: 0,\n                isConstrained: true,\n                snapX: [0, this.imageWidth],\n                snapY: [0, this.imageHeight],\n                viewportTransform: this.preview.getTransform(),\n                callback: () => {\n                    this.updatePreview();\n                },\n            });\n            this.preview.getElement().append(this.freeTransform.getElement());\n        }\n        BB.css(this.freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        setTimeout(() => this.updatePreview(), 0);\n    }\n\n\n    // ---- interface ----\n    move (dX: number, dY: number): void {\n        this.freeTransform.move(dX, dY);\n    }\n\n    reset (): void {\n        const w = this.layers[this.transformIndex].image.width;\n        const h = this.layers[this.transformIndex].image.height;\n\n        this.freeTransform.setSize(w, h);\n        this.freeTransform.setPos({x: w / 2, y: h / 2});\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setTransformFit (): void {\n\n        const fit = BB.fitInto(\n            this.layers[this.transformIndex].image.width,\n            this.layers[this.transformIndex].image.height,\n            this.imageWidth,\n            this.imageHeight,\n            1\n        );\n\n        this.freeTransform.setSize(fit.width, fit.height);\n        this.freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setTransformCenter (): void {\n        this.freeTransform.setPos({x: this.imageWidth / 2, y: this.imageHeight / 2});\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    /**\n     * gives you the transformation in the original scale\n     */\n    getTransformation (): IFreeTransform {\n        return this.freeTransform.getValue();\n    }\n\n    getIsPixelated (): boolean {\n        const transform = this.freeTransform.getValue();\n        return BB.testShouldPixelate(\n            transform,\n            transform.width / this.initTransform.width,\n            transform.height / this.initTransform.height\n        );\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.freeTransform.destroy();\n        this.preview.destroy();\n        BB.freeCanvas(this.previewCanvas);\n    }\n}\n","export {\n  cache,\n  css,\n  cx,\n  flush,\n  getRegisteredStyles,\n  hydrate,\n  injectGlobal,\n  keyframes,\n  merge,\n  sheet\n} from \"./emotion-css.cjs.js\";\n","'use strict';\n\nif (process.env.NODE_ENV === \"production\") {\n  module.exports = require(\"./emotion-css.cjs.prod.js\");\n} else {\n  module.exports = require(\"./emotion-css.cjs.dev.js\");\n}\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar createInstance_dist_emotionCssCreateInstance = require('../create-instance/dist/emotion-css-create-instance.cjs.dev.js');\nrequire('@emotion/cache');\nrequire('@emotion/serialize');\nrequire('@emotion/utils');\n\nvar _createEmotion = createInstance_dist_emotionCssCreateInstance[\"default\"]({\n  key: 'css'\n}),\n    flush = _createEmotion.flush,\n    hydrate = _createEmotion.hydrate,\n    cx = _createEmotion.cx,\n    merge = _createEmotion.merge,\n    getRegisteredStyles = _createEmotion.getRegisteredStyles,\n    injectGlobal = _createEmotion.injectGlobal,\n    keyframes = _createEmotion.keyframes,\n    css = _createEmotion.css,\n    sheet = _createEmotion.sheet,\n    cache = _createEmotion.cache;\n\nexports.cache = cache;\nexports.css = css;\nexports.cx = cx;\nexports.flush = flush;\nexports.getRegisteredStyles = getRegisteredStyles;\nexports.hydrate = hydrate;\nexports.injectGlobal = injectGlobal;\nexports.keyframes = keyframes;\nexports.merge = merge;\nexports.sheet = sheet;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar createCache = require('@emotion/cache');\nvar serialize = require('@emotion/serialize');\nvar utils = require('@emotion/utils');\n\nfunction _interopDefault (e) { return e && e.__esModule ? e : { 'default': e }; }\n\nvar createCache__default = /*#__PURE__*/_interopDefault(createCache);\n\nfunction insertWithoutScoping(cache, serialized) {\n  if (cache.inserted[serialized.name] === undefined) {\n    return cache.insert('', serialized, cache.sheet, true);\n  }\n}\n\nfunction merge(registered, css, className) {\n  var registeredStyles = [];\n  var rawClassName = utils.getRegisteredStyles(registered, registeredStyles, className);\n\n  if (registeredStyles.length < 2) {\n    return className;\n  }\n\n  return rawClassName + css(registeredStyles);\n}\n\nvar createEmotion = function createEmotion(options) {\n  var cache = createCache__default[\"default\"](options); // $FlowFixMe\n\n  cache.sheet.speedy = function (value) {\n    if (process.env.NODE_ENV !== 'production' && this.ctr !== 0) {\n      throw new Error('speedy must be changed before any rules are inserted');\n    }\n\n    this.isSpeedy = value;\n  };\n\n  cache.compat = true;\n\n  var css = function css() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var serialized = serialize.serializeStyles(args, cache.registered, undefined);\n    utils.insertStyles(cache, serialized, false);\n    return cache.key + \"-\" + serialized.name;\n  };\n\n  var keyframes = function keyframes() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    var serialized = serialize.serializeStyles(args, cache.registered);\n    var animation = \"animation-\" + serialized.name;\n    insertWithoutScoping(cache, {\n      name: serialized.name,\n      styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n    });\n    return animation;\n  };\n\n  var injectGlobal = function injectGlobal() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    var serialized = serialize.serializeStyles(args, cache.registered);\n    insertWithoutScoping(cache, serialized);\n  };\n\n  var cx = function cx() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    return merge(cache.registered, css, classnames(args));\n  };\n\n  return {\n    css: css,\n    cx: cx,\n    injectGlobal: injectGlobal,\n    keyframes: keyframes,\n    hydrate: function hydrate(ids) {\n      ids.forEach(function (key) {\n        cache.inserted[key] = true;\n      });\n    },\n    flush: function flush() {\n      cache.registered = {};\n      cache.inserted = {};\n      cache.sheet.flush();\n    },\n    // $FlowFixMe\n    sheet: cache.sheet,\n    cache: cache,\n    getRegisteredStyles: utils.getRegisteredStyles.bind(null, cache.registered),\n    merge: merge.bind(null, cache.registered, css)\n  };\n};\n\nvar classnames = function classnames(args) {\n  var cls = '';\n\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n    if (arg == null) continue;\n    var toAdd = void 0;\n\n    switch (typeof arg) {\n      case 'boolean':\n        break;\n\n      case 'object':\n        {\n          if (Array.isArray(arg)) {\n            toAdd = classnames(arg);\n          } else {\n            toAdd = '';\n\n            for (var k in arg) {\n              if (arg[k] && k) {\n                toAdd && (toAdd += ' ');\n                toAdd += k;\n              }\n            }\n          }\n\n          break;\n        }\n\n      default:\n        {\n          toAdd = arg;\n        }\n    }\n\n    if (toAdd) {\n      cls && (cls += ' ');\n      cls += toAdd;\n    }\n  }\n\n  return cls;\n};\n\nexports[\"default\"] = createEmotion;\n","import {BB} from '../../../bb/bb';\nimport {IRect, IVector2D} from '../../../bb/bb-types';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\ntype TUpdateElement = {\n    el: HTMLElement;\n    update: () => void;\n};\n\n/**\n * Interactive preview for crop filter. Corners and edges can be dragged.\n * the div that you append this to must be relative\n */\nexport class Cropper {\n\n    private readonly rootEl: HTMLElement;\n    private x: number;\n    private y: number;\n    private width: number;\n    private height: number;\n    private scale: number;\n    private readonly grips: IVector2D[]; // aka corner coordinates\n    private readonly edges: TUpdateElement[];\n    private readonly cornerElArr: TUpdateElement[];\n    private readonly darken: TUpdateElement[];\n    private readonly outline: TUpdateElement;\n    private readonly thirdsHorizontal: TUpdateElement;\n    private readonly thirdsVertical: TUpdateElement;\n    private readonly keyListener: KeyListener;\n    private readonly pointerRemainder: IVector2D;\n\n    private readonly outlinePointerListener: PointerListener;\n\n    private readonly corner0PointerListener: PointerListener;\n    private readonly corner1PointerListener: PointerListener;\n    private readonly corner2PointerListener: PointerListener;\n    private readonly corner3PointerListener: PointerListener;\n\n    private readonly edge0PointerListener: PointerListener;\n    private readonly edge1PointerListener: PointerListener;\n    private readonly edge2PointerListener: PointerListener;\n    private readonly edge3PointerListener: PointerListener;\n\n    private readonly callback: (val: IRect) => void;\n\n    private update (): void {\n        this.edges[0].update();\n        this.edges[1].update();\n        this.edges[2].update();\n        this.edges[3].update();\n        this.cornerElArr[0].update();\n        this.cornerElArr[1].update();\n        this.cornerElArr[2].update();\n        this.cornerElArr[3].update();\n        this.darken[0].update();\n        this.darken[1].update();\n        this.darken[2].update();\n        this.darken[3].update();\n        this.outline.update();\n        this.thirdsHorizontal.update();\n        this.thirdsVertical.update();\n    }\n\n    private commit (): void {\n        this.pointerRemainder.x = 0;\n        this.pointerRemainder.y = 0;\n        this.callback(this.getTransform());\n    }\n\n\n\n    // ---- public ----\n    constructor (\n        params: {\n            x: number; // int, pos in relation to image\n            y: number; // int\n            width: number; // int\n            height: number; // int\n            maxW: number;\n            maxH: number;\n            scale: number; // float, zoom\n            callback: (val: IRect) => void;\n        }\n    ) {\n\n        this.x = params.x;\n        this.y = params.y;\n        this.width = params.width;\n        this.height = params.height;\n        this.scale = params.scale;\n        this.callback = params.callback;\n\n        const maxW = params.maxW;\n        const maxH = params.maxW;\n        this.rootEl = BB.el();\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n\n        this.keyListener = new BB.KeyListener({});\n\n        BB.css(this.rootEl, {\n            position: 'absolute',\n            left: (this.x * this.scale) + 'px',\n            top: (this.y * this.scale) + 'px',\n        });\n\n        this.outline = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    border: '1px dashed #fff',\n                    cursor: 'move',\n                },\n            }),\n            update: () => {\n                BB.css(this.outline.el, {\n                    left: (this.grips[0].x * this.scale - 1) + 'px',\n                    top: (this.grips[0].y * this.scale - 1) + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\n                });\n            },\n        };\n\n        this.pointerRemainder = { // needs to be reset after dragging complete\n            x: 0,\n            y: 0,\n        };\n        this.outlinePointerListener = new BB.PointerListener({\n            target: this.outline.el,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n\n                    this.grips[0].x += dX;\n                    this.grips[0].y += dY;\n                    this.grips[1].x += dX;\n                    this.grips[1].y += dY;\n                    this.grips[2].x += dX;\n                    this.grips[2].y += dY;\n                    this.grips[3].x += dX;\n                    this.grips[3].y += dY;\n\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n        this.thirdsHorizontal = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    borderTop: '1px solid #0ff',\n                    borderBottom: '1px solid #0ff',\n                },\n            }),\n            update: () => {\n                BB.css(this.thirdsHorizontal.el, {\n                    left: (this.grips[0].x * this.scale) + 'px',\n                    top: ((this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale) + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) / 3 * this.scale) + 'px',\n                });\n            },\n        };\n\n        this.thirdsVertical = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    borderLeft: '1px solid #0ff',\n                    borderRight: '1px solid #0ff',\n                },\n            }),\n            update: () => {\n                BB.css(this.thirdsVertical.el, {\n                    left: ((this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale) + 'px',\n                    top: (this.grips[0].y * this.scale) + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) / 3 * this.scale) + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\n                });\n            },\n        };\n\n        const gripSize = 40;\n        const gripOverlay = 10;\n\n        this.grips = [\n            {x: 0, y: 0}, // top left\n            {x: this.width, y: 0}, // top right\n            {x: this.width, y: this.height}, // bottom right\n            {x: 0, y: this.height}, //bottom left\n        ];\n\n        const transformTop = (dY: number) => {\n            this.grips[0].y += dY;\n            this.grips[0].y = BB.clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\n            this.grips[1].y = this.grips[0].y;\n        };\n        const transformRight = (dX: number) => {\n            this.grips[1].x += dX;\n            this.grips[1].x = BB.clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\n            this.grips[2].x = this.grips[1].x;\n        };\n        const transformBottom = (dY: number) => {\n            this.grips[2].y += dY;\n            this.grips[2].y = BB.clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\n            this.grips[3].y = this.grips[2].y;\n        };\n        const transformLeft = (dX: number) => {\n            this.grips[0].x += dX;\n            this.grips[0].x = BB.clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\n            this.grips[3].x = this.grips[0].x;\n        };\n\n\n\n\n        this.edges = [];\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n\n                const el = BB.el({\n                    css: {\n                        width: gripSize + 'px',\n                        height: gripSize + 'px',\n                        //background: '#0f0',\n                        position: 'absolute',\n                    },\n                });\n\n                const update = () => {\n                    if (i === 0) { //top\n                        BB.css(el, {\n                            left: (this.grips[0].x * this.scale + gripOverlay) + 'px',\n                            top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2) + 'px',\n                            height: (gripSize * 2) + 'px',\n                        });\n                    } else if (i === 1) { //right\n                        BB.css(el, {\n                            left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\n                            top: (this.grips[1].y * this.scale + gripOverlay) + 'px',\n                            width: (gripSize * 2) + 'px',\n                            height: ((this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2) + 'px',\n                        });\n                    } else if (i === 2) { //bottom\n                        BB.css(el, {\n                            left: (this.grips[3].x * this.scale + gripOverlay) + 'px',\n                            top: (this.grips[3].y * this.scale - gripOverlay) + 'px',\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2) + 'px',\n                            height: (gripSize * 2) + 'px',\n                        });\n                    } else if (i === 3) { //left\n                        BB.css(el, {\n                            left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            top: (this.grips[0].y * this.scale + gripOverlay) + 'px',\n                            width: (gripSize * 2) + 'px',\n                            height: ((this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2) + 'px',\n                        });\n                    }\n                    const angleOffset = i * 2 + 1;\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\n\n                };\n\n                this.edges[i] = {\n                    el,\n                    update,\n                };\n            })(i);\n        }\n\n        this.darken = [];\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = BB.el({\n                    css: {\n                        position: 'absolute',\n                        background: '#000',\n                        opacity: '0.5',\n                    },\n                });\n                const update = () => {\n                    if (i === 0) {\n                        BB.css(g, {\n                            left: (this.grips[0].x * this.scale) + 'px',\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale) + 'px',\n                            height: '8000px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g, {\n                            left: (this.grips[1].x * this.scale) + 'px',\n                            top: (this.grips[1].y * this.scale - 8000) + 'px',\n                            width: '8000px',\n                            height: 16000 + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g, {\n                            left: (this.grips[3].x * this.scale) + 'px',\n                            top: (this.grips[3].y * this.scale) + 'px',\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale) + 'px',\n                            height: '8000px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g, {\n                            left: (this.grips[0].x * this.scale - 8000) + 'px',\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\n                            width: '8000px',\n                            height: 16000 + 'px',\n                        });\n                    }\n\n                };\n\n                this.darken[i] = {\n                    el: g,\n                    update,\n                };\n            })(i);\n        }\n\n        this.edge0PointerListener = new BB.PointerListener({\n            target: this.edges[0].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge1PointerListener = new BB.PointerListener({\n            target: this.edges[1].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge2PointerListener = new BB.PointerListener({\n            target: this.edges[2].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge3PointerListener = new BB.PointerListener({\n            target: this.edges[3].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n\n        this.cornerElArr = [];\n        (() => {\n            for (let i = 0; i < 4; i++) {\n                ((i) => {\n                    const g = BB.el({\n                        css: {\n                            //background: '#f00',\n                            width: (gripSize * 2) + 'px',\n                            height: (gripSize * 2) + 'px',\n                            position: 'absolute',\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\n                        },\n                    });\n\n                    const update = () => {\n                        if (i === 0) { //top left\n                            BB.css(g, {\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                                top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            });\n                        } else if (i === 1) { //top right\n                            BB.css(g, {\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\n                                top: (this.grips[1].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            });\n                        } else if (i === 2) { //bottom right\n                            BB.css(g, {\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\n                            });\n                        } else if (i === 3) { //bottom left\n                            BB.css(g, {\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\n                            });\n                        }\n                    };\n\n                    this.cornerElArr[i] = {\n                        el: g,\n                        update,\n                    };\n                })(i);\n            }\n        })();\n        //top left\n        this.corner0PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[0].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //top right\n        this.corner1PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[1].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //bottom right\n        this.corner2PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[2].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //bottom left\n        this.corner3PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[3].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n\n        this.rootEl.append(\n            this.darken[1].el,\n            this.darken[0].el,\n            this.darken[2].el,\n            this.darken[3].el,\n            this.thirdsHorizontal.el,\n            this.thirdsVertical.el,\n            this.outline.el,\n\n            this.edges[1].el,\n            this.edges[0].el,\n            this.edges[2].el,\n            this.edges[3].el,\n\n            this.cornerElArr[0].el,\n            this.cornerElArr[1].el,\n            this.cornerElArr[2].el,\n            this.cornerElArr[3].el,\n        );\n\n        this.update();\n\n    }\n\n    // ---- interface ----\n    getTransform (): IRect {\n        this.grips[1].x -= this.grips[0].x;\n        this.grips[1].y -= this.grips[0].y;\n        this.grips[2].x -= this.grips[0].x;\n        this.grips[2].y -= this.grips[0].y;\n        this.grips[3].x -= this.grips[0].x;\n        this.grips[3].y -= this.grips[0].y;\n        this.x += this.grips[0].x;\n        this.y += this.grips[0].y;\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        return {\n            x: this.x,\n            y: this.y,\n            width: this.grips[1].x,\n            height: this.grips[2].y,\n        };\n    }\n\n    setTransform (p: IRect): void {\n        this.x = p.x;\n        this.y = p.y;\n        this.width = p.width;\n        this.height = p.height;\n\n        BB.css(this.rootEl, {\n            left: (this.x * this.scale) + 'px',\n            top: (this.y * this.scale) + 'px',\n        });\n\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        this.grips[1].x = this.width;\n        this.grips[1].y = 0;\n        this.grips[2].x = this.width;\n        this.grips[2].y = this.height;\n        this.grips[3].x = 0;\n        this.grips[3].y = this.height;\n\n        this.update();\n        this.commit();\n    }\n\n    setScale (s: number): void {\n        this.scale = s;\n        BB.css(this.rootEl, {\n            left: (this.x * this.scale) + 'px',\n            top: (this.y * this.scale) + 'px',\n        });\n        this.update();\n    }\n\n    showThirds (b: boolean): void {\n\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.outlinePointerListener.destroy();\n        this.corner0PointerListener.destroy();\n        this.corner1PointerListener.destroy();\n        this.corner2PointerListener.destroy();\n        this.corner3PointerListener.destroy();\n        this.edge0PointerListener.destroy();\n        this.edge1PointerListener.destroy();\n        this.edge2PointerListener.destroy();\n        this.edge3PointerListener.destroy();\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport {klHistory} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\nimport {TKlCanvasLayer, TUiLayout} from '../../kl-types';\nimport {ISize2D} from '../../../bb/bb-types';\nimport {theme} from '../../../theme/theme';\nimport {KlCanvasLayer} from '../../canvas/kl-canvas';\nimport {throwIfNull} from '../../../bb/base/base';\n\n\n/**\n * Previews currently active layer\n * thumbnail (hover shows bigger preview), layername, opacity\n *\n * internally listens to kl history. updates when there's a change.\n * but you need to update it when the active layer changed. (different canvas object)\n *\n * update visibility for performance\n */\nexport class LayerPreview {\n\n    private readonly rootEl: HTMLElement;\n    private readonly contentWrapperEl: HTMLElement;\n    private readonly height: number;\n    private layerObj: TKlCanvasLayer | undefined;\n    private isVisible: boolean;\n    private uiState: TUiLayout;\n\n    private readonly checkEl: HTMLInputElement;\n\n    private readonly nameLabelEl: HTMLElement;\n    private readonly opacityEl: HTMLElement;\n    private lastDrawnSize: ISize2D;\n    private lastDrawnState: number; // from KlHistory\n\n    private readonly canvasSize: number;\n    private readonly canvas: HTMLCanvasElement;\n    private readonly canvasCtx: CanvasRenderingContext2D;\n\n    private animationCount: number; // >0 means it's animating\n    private readonly animationLength: number;\n\n    private readonly animationCanvas: HTMLCanvasElement;\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\n    private animationCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\n\n    private largeCanvasIsVisible: boolean;\n    private readonly largeCanvasWrapper: HTMLElement;\n    private readonly largeCanvasSize: number;\n    private readonly largeCanvas: HTMLCanvasElement;\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\n    private largeCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\n\n\n    private updateCheckerPatterns (): void {\n        const checker = BB.createCheckerCanvas(4, theme.isDark());\n        this.animationCanvasCheckerPattern = throwIfNull(this.animationCanvasCtx.createPattern(checker, 'repeat'));\n        this.largeCanvasCheckerPattern = throwIfNull(this.canvasCtx.createPattern(checker, 'repeat'));\n    }\n    \n    private animate (): void {\n        if (this.animationCount === 0) {\n            return;\n        }\n\n        this.animationCount--;\n\n        this.canvasCtx.save();\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n        this.canvasCtx.restore();\n\n        if (this.animationCount > 0) {\n            requestAnimationFrame(() => this.animate());\n        }\n    }\n\n    /**\n     * is always instant\n     */\n    private drawLargeCanvas (): void {\n\n        if (!this.largeCanvasIsVisible || !this.layerObj) {\n            return;\n        }\n\n        const layerCanvas = this.layerObj.context.canvas;\n\n        const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\n        this.largeCanvasCtx.save();\n        if (this.largeCanvas.width > layerCanvas.width) {\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\n        } else {\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\n        }\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.restore();\n\n        const bounds = this.rootEl.getBoundingClientRect();\n        BB.css(this.largeCanvasWrapper, {\n            top: Math.max(10, (bounds.top + this.height / 2 - this.largeCanvas.height / 2)) + 'px',\n        });\n\n    }\n\n    private draw (isInstant: boolean): void {\n        if (!this.isVisible || !this.layerObj) {\n            return;\n        }\n\n        const layerIsVisible = this.layerObj.isVisible;\n        this.checkEl.parentElement!.title = layerIsVisible ? LANG('layers-active-layer-visible') : LANG('layers-active-layer-hidden');\n        this.checkEl.checked = layerIsVisible;\n        this.checkEl.style.boxShadow = layerIsVisible ? '' : '0 0 0 1px red';\n\n        this.nameLabelEl.textContent = this.layerObj.name;\n        if (this.layerObj.isVisible) {\n            this.opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(this.layerObj.opacity * 100) + '%';\n        } else {\n            this.opacityEl.innerHTML = LANG('opacity') + '<br><s>' + Math.round(this.layerObj.opacity * 100) + '%</s>';\n        }\n\n        const layerCanvas = this.layerObj.context.canvas;\n\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\n            const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\n            this.canvas.width = Math.round(canvasDimensions.width);\n            this.canvas.height = Math.round(canvasDimensions.height);\n\n            isInstant = true;\n        }\n\n        this.animationCanvas.width = this.canvas.width;\n        this.animationCanvas.height = this.canvas.height;\n\n        this.animationCanvasCtx.save();\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\n        this.animationCanvasCtx.restore();\n\n        if (isInstant) {\n            this.animationCount = 0;\n            this.canvasCtx.save();\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n            this.canvasCtx.restore();\n\n        } else {\n            this.animationCount = this.animationLength;\n            this.animate();\n\n        }\n\n        this.drawLargeCanvas();\n\n        this.lastDrawnState = klHistory.getState();\n        this.lastDrawnSize.width = layerCanvas.width;\n        this.lastDrawnSize.height = layerCanvas.height;\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onClick: () => void; // when clicking on layer name\n            klRootEl: HTMLElement;\n            uiState: TUiLayout;\n        }\n    ) {\n        // internally redraws with in an interval. checks history is something changed\n        // this update will be animated\n        // it will not be animated if the resolution changed\n        // also redraws when you call updateLayer - not animated\n\n        // syncs via updateLayer, and internally updates layer opacity via a hack\n\n        this.rootEl = BB.el({\n            className: 'kl-layer-preview',\n        });\n        this.isVisible = true;\n        this.height = 40;\n        this.canvasSize = this.height - 10;\n        this.largeCanvasSize = 300;\n        this.lastDrawnState = -2;\n        this.lastDrawnSize = {\n            width: 0,\n            height: 0,\n        };\n        this.animationCanvas = BB.canvas(); // to help animate the transition\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\n        this.animationLength = 30;\n        this.animationCount = 0;\n        this.largeCanvasIsVisible = false;\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\n        const largeCanvasAnimationDurationMs = 300;\n        this.uiState = p.uiState;\n\n\n        // --- setup dom ---\n        this.contentWrapperEl = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                height: this.height + 'px',\n            },\n        });\n\n\n        const checkWrapper = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'flex-end',\n                alignItems: 'center',\n                width: '23px',\n                flexShrink: '0',\n            },\n        });\n        this.checkEl = BB.el({\n            parent: checkWrapper,\n            tagName: 'input',\n            css: {\n                pointerEvents: 'none',\n            },\n            custom: {\n                type: 'checkbox',\n                disabled: 'true',\n            },\n        });\n\n        const canvasWrapperEl = BB.el({\n            css: {\n                //background: '#f00',\n                minWidth: this.height + 'px',\n                height: this.height + 'px',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n            },\n        });\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\n        this.canvasCtx = BB.ctx(this.canvas);\n        this.canvas.title = LANG('layers-active-layer');\n        const nameWrapper = BB.el({\n            css: {\n                //background: '#ff0',\n                flexGrow: '1',\n                paddingLeft: '10px',\n                fontSize: '13px',\n                overflow: 'hidden',\n                position: 'relative',\n            },\n        });\n        this.nameLabelEl = BB.el({\n            content: '',\n            css: {\n                cssFloat: 'left',\n                whiteSpace: 'nowrap',\n            },\n        });\n        const clickableEl = BB.el({\n            css: {\n                // background: 'rgba(0,255,0,0.6)',\n                position: 'absolute',\n                left: '10px',\n                top: '0',\n                width: '90px',\n                height: '100%',\n            },\n        });\n        if (p.onClick) {\n            clickableEl.addEventListener('click', () => p.onClick());\n            this.canvas.addEventListener('click', () => p.onClick());\n            checkWrapper.addEventListener('click', () => p.onClick());\n        }\n        this.opacityEl = BB.el({\n            content: LANG('opacity') + '<br>100%',\n            css: {\n                minWidth: '60px',\n                fontSize: '12px',\n                textAlign: 'center',\n            },\n        });\n\n        this.largeCanvasWrapper = BB.el({\n            onClick: BB.handleClick,\n            css: {\n                pointerEvents: 'none',\n                background: '#fff',\n                position: 'absolute',\n                right: '280px',\n                top: '10px',\n                border: '1px solid #aaa',\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n                transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\n                userSelect: 'none',\n                display: 'block',\n                webkitTouchCallout: 'none',\n            },\n        });\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\n        this.largeCanvasWrapper.append(this.largeCanvas);\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\n        BB.css(this.largeCanvas, {\n            display: 'block',\n        });\n\n\n        canvasWrapperEl.append(this.canvas);\n        nameWrapper.append(this.nameLabelEl, clickableEl);\n        this.contentWrapperEl.append(checkWrapper, canvasWrapperEl, nameWrapper, this.opacityEl);\n        this.rootEl.append(this.contentWrapperEl);\n\n\n        this.updateCheckerPatterns();\n        theme.addIsDarkListener(() => {\n            this.updateCheckerPatterns();\n            this.draw(true);\n        });\n\n\n\n        // --- update logic ---\n\n        // cross-fade done via 2 canvases (old and new state)\n        // both have checkerboard background drawn on them, both fully opaque\n        // -> no \"lighter\" is needed for accurate cross-fading\n\n        setInterval(() => {\n\n            if (!this.layerObj) {\n                return;\n            }\n\n            const currentState = klHistory.getState();\n            if (currentState === this.lastDrawnState) {\n                return;\n            }\n\n            //update opacity w hack\n            this.layerObj.opacity = (this.layerObj.context.canvas as KlCanvasLayer).opacity;\n\n            this.draw(false);\n\n        }, 2000);\n        \n\n        const removeLargeCanvas = () => {\n            this.largeCanvasWrapper.remove();\n        };\n\n        const showLargeCanvas = (b: boolean) => {\n            if (this.largeCanvasIsVisible === b) {\n                return;\n            }\n\n            clearTimeout(largeCanvasAnimationTimeout);\n            this.largeCanvasIsVisible = b;\n\n            if (b) {\n                largeCanvasAnimationTimeout = setTimeout(() => {\n                    this.drawLargeCanvas();\n                    this.largeCanvasWrapper.style.opacity = '0';\n                    p.klRootEl.append(this.largeCanvasWrapper);\n                    setTimeout(() => {\n                        this.largeCanvasWrapper.style.opacity = '1';\n                    }, 20);\n                }, 250);\n\n            } else {\n                this.largeCanvasWrapper.style.opacity = '0';\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n            }\n\n        };\n\n        const pointerListener = new BB.PointerListener({\n            target: this.canvas,\n            onEnterLeave: (b) => {\n                showLargeCanvas(b);\n            },\n        });\n    }\n\n    // ---- interface ----\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (b: boolean): void {\n        if (this.isVisible === b) {\n            return;\n        }\n        this.isVisible = b;\n        this.contentWrapperEl.style.display = this.isVisible ? 'flex' : 'none';\n        this.rootEl.style.marginBottom = this.isVisible ? '' : '10px';\n\n        const currentState = klHistory.getState();\n        if (b && this.lastDrawnState !== currentState) {\n            this.draw(true);\n        }\n    }\n\n    //when the layer might have changed\n    setLayer (klCanvasLayerObj: TKlCanvasLayer): void {\n        this.layerObj = klCanvasLayerObj;\n        this.draw(true);\n    }\n\n    setUiState (stateStr: TUiLayout): void {\n        this.uiState = stateStr;\n\n        if (this.uiState === 'left') {\n            BB.css(this.largeCanvasWrapper, {\n                left: '280px',\n                right: '',\n            });\n        } else {\n            BB.css(this.largeCanvasWrapper, {\n                left: '',\n                right: '280px',\n            });\n        }\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\nimport {showModal} from './base/showModal';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {IKlBasicLayer} from '../../kl-types';\nimport {LANG} from '../../../language/language';\nimport {testIsSmall} from '../utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../utils/preview-size';\n\nexport function showImportAsLayerDialog (\n    params: {\n        target: HTMLElement;\n        klCanvas: KlCanvas;\n        importImage: HTMLImageElement | HTMLCanvasElement;\n        callback: (\n            p?: {x: number; y: number; width:number; height: number; angleDeg: number},\n            isPixelated?: boolean\n        ) => void;\n    }\n): void {\n\n    const div = document.createElement('div');\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\n    if (params.klCanvas.isLayerLimitReached()) {\n        const noteEl = BB.el({\n            content: LANG('import-as-layer-limit-reached'),\n            css: {\n                background: '#ff0',\n                padding: '10px',\n                marginTop: '5px',\n                marginBottom: '5px',\n                border: '1px solid #e7d321',\n                borderRadius: '5px',\n            },\n        });\n        div.append(noteEl);\n    }\n    const isSmall = testIsSmall();\n\n    const buttonRowEl = BB.el({\n        css: {\n            display: 'flex',\n        },\n    });\n    const originalSizeBtn = BB.el({\n        tagName: 'button',\n        content: '1:1',\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.reset();\n        },\n    });\n    const fitSizeBtn = BB.el({\n        tagName: 'button',\n        content: LANG('import-as-layer-fit'),\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.setTransformFit();\n        },\n    });\n    const centerBtn = BB.el({\n        tagName: 'button',\n        content: LANG('center'),\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.setTransformCenter();\n        },\n    });\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\n    div.append(buttonRowEl);\n\n\n\n    const layers: IKlBasicLayer[] = [];\n    {\n        const klCanvasLayerArr = params.klCanvas.getLayers();\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            layers.push({\n                image: klCanvasLayerArr[i].context.canvas,\n                isVisible: klCanvasLayerArr[i].isVisible,\n                opacity: klCanvasLayerArr[i].opacity,\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\n            });\n        }\n    }\n    layers.push({\n        image: params.importImage,\n        isVisible: true,\n        opacity: 1,\n        mixModeStr: 'source-over',\n    });\n\n\n    const freeTransformCanvas = new FreeTransformCanvas({\n        elementWidth: getPreviewWidth(isSmall),\n        elementHeight: getPreviewHeight(isSmall) + 50,\n        imageWidth: params.klCanvas.getLayerContext(0)!.canvas.width,\n        imageHeight: params.klCanvas.getLayerContext(0)!.canvas.height,\n        layers: layers,\n        transformIndex: layers.length - 1,\n    });\n    BB.css(freeTransformCanvas.getElement(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.append(freeTransformCanvas.getElement());\n\n    function move (x: number, y: number): void {\n        freeTransformCanvas.move(x, y);\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr) {\n            if (keyStr === 'left') {\n                move(-1, 0);\n            }\n            if (keyStr === 'right') {\n                move(1, 0);\n            }\n            if (keyStr === 'up') {\n                move(0, -1);\n            }\n            if (keyStr === 'down') {\n                move(0, 1);\n            }\n        },\n    });\n\n    showModal({\n        target: params.target,\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\n        div: div,\n        style: isSmall ? undefined : {\n            width: '540px',\n        },\n        buttons: ['Ok', 'Cancel'],\n        clickOnEnter: 'Ok',\n        callback: function (buttonStr) {\n            keyListener.destroy();\n            freeTransformCanvas.destroy();\n            BB.destroyEl(originalSizeBtn);\n            BB.destroyEl(fitSizeBtn);\n            BB.destroyEl(centerBtn);\n            if (buttonStr === 'Ok') {\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\n            } else {\n                params.callback();\n            }\n        },\n    });\n\n}","\nexport function testIsSmall (): boolean {\n    return window.innerWidth < 550;\n}","\nexport const smallPreview = {\n    width: 340,\n    height: 220,\n};\n\nexport const mediumPreview = {\n    width: 540,\n    height: 300,\n};\n\nexport function getPreviewWidth (isSmall: boolean): number {\n    return isSmall ? smallPreview.width : mediumPreview.width;\n}\n\nexport function getPreviewHeight (isSmall: boolean): number {\n    return isSmall ? smallPreview.height : mediumPreview.height;\n}","import {BB} from '../../../bb/bb';\n\ntype TDropOption = 'default' | 'layer' | 'image';\n\n/**\n * Not really generalized. UI when you drag/drop an image into window.\n * The moment you create it, it will listen.\n * */\nexport class KlImageDropper {\n\n    private readonly rootEl: HTMLElement;\n\n    // ---- public ----\n    constructor (\n        p: {\n            onDrop: (files: FileList, optionStr: TDropOption) => void;\n            target: HTMLElement;\n            enabledTest: () => boolean;\n        }\n    ) {\n        //set up DOM\n        this.rootEl = BB.el({\n            content: 'Drop to import',\n            css: {\n                paddingTop: '100px',\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                width: '100%',\n                height: '100%',\n                background: 'rgba(50, 50, 50, 0.7)',\n                color: '#fff',\n                textShadow: '2px 2px #000',\n                textAlign: 'center',\n                fontSize: '25px',\n            },\n        });\n        const wrapperEl = BB.el({\n            css: {\n                'marginTop': '50px',\n                'display': 'flex',\n                'justifyContent': 'center',\n            },\n        });\n        const optionStyle = {\n            width: '200px',\n            padding: '50px',\n            margin: '10px',\n            //opacity: 0.5,\n            borderRadius: '20px',\n            border: '1px dashed #fff',\n            background: '#00aefe',\n            fontWeight: 'bold',\n        };\n        const optionLayerEl = BB.el({\n            content: 'As Layer',\n            css: optionStyle,\n        });\n        const optionImageEl = BB.el({\n            content: 'As New Image',\n            css: optionStyle,\n        });\n\n        this.rootEl.append(wrapperEl);\n        wrapperEl.append(optionLayerEl, optionImageEl);\n\n\n        let rootCounter = 0;\n        let optionLayerCounter = 0;\n        let optionImageCounter = 0;\n\n        const destroy = () => {\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            this.rootEl.remove();\n        };\n\n        /**\n         * check, can drop content be imported\n         */\n        const testAcceptType = (event: DragEvent): boolean => {\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\n        };\n\n        const updateOptions = () => {\n            const boxShadow = '0 0 20px 4px #fff';\n            if (optionLayerCounter > 0) {\n                optionLayerEl.style.boxShadow = boxShadow;\n                optionImageEl.style.boxShadow = '';\n            } else if (optionImageCounter > 0) {\n                optionLayerEl.style.boxShadow = '';\n                optionImageEl.style.boxShadow = boxShadow;\n            } else {\n                optionLayerEl.style.boxShadow = '';\n                optionImageEl.style.boxShadow = '';\n            }\n        };\n\n        optionLayerEl.addEventListener('dragenter', () => {\n            optionLayerCounter++;\n            updateOptions();\n        });\n        optionLayerEl.addEventListener('dragleave', () => {\n            optionLayerCounter--;\n            updateOptions();\n        });\n        optionImageEl.addEventListener('dragenter', () => {\n            optionImageCounter++;\n            updateOptions();\n        });\n        optionImageEl.addEventListener('dragleave', () => {\n            optionImageCounter--;\n            updateOptions();\n        });\n\n\n        const rootDragOver = (event: DragEvent): void => {\n            if (!testAcceptType(event)) {\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n        };\n\n        const rootDragEnter = (event: DragEvent): void => {\n            if (!p.enabledTest() || !testAcceptType(event)) {\n                return;\n            }\n            if (rootCounter === 0) {\n                p.target.append(this.rootEl);\n            }\n            rootCounter++;\n        };\n\n        const rootDragLeave = (event: DragEvent): void => {\n            if (!testAcceptType(event) || rootCounter === 0) {\n                return;\n            }\n            rootCounter = Math.max(0, rootCounter - 1);\n            if (rootCounter === 0) {\n                this.rootEl.remove();\n            }\n        };\n\n        const rootDrop = (event: DragEvent): void => {\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\n                destroy();\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n\n            let optionStr: TDropOption = 'default';\n            if (optionLayerCounter > 0) {\n                optionStr = 'layer';\n            } else if (optionImageCounter > 0) {\n                optionStr = 'image';\n            }\n\n            p.onDrop(event.dataTransfer.files, optionStr);\n\n\n            if (rootCounter > 0) {\n                this.rootEl.remove();\n            }\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            updateOptions();\n        };\n\n        window.addEventListener('dragover', rootDragOver, false);\n        window.addEventListener('dragenter', rootDragEnter, false);\n        window.addEventListener('dragleave', rootDragLeave, false);\n        window.addEventListener('drop', rootDrop, false);\n\n        // if something goes wrong and you're stuck with overlay\n        this.rootEl.addEventListener('pointerdown', () => {\n            destroy();\n        });\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr) => {\n                if (rootCounter > 0 && keyStr === 'esc') {\n                    destroy();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n}\n","import {BB} from '../../../bb/bb';\nimport {KlColorSliderSmall} from './kl-color-slider-small';\nimport {KlSlider} from './kl-slider';\nimport {BrushSettingService, TBrushSettingEmit} from '../../brushes-ui/brush-setting-service';\nimport {LANG} from '../../../language/language';\nimport {IRGB} from '../../kl-types';\nimport {IVector2D} from '../../../bb/bb-types';\n\n/**\n * Compressed HUD toolspace. When you hold ctrl+alt.\n * small color picker, brush settings\n */\nexport class OverlayToolspace {\n\n    private readonly rootEl: HTMLElement;\n\n    // ---- public ----\n    constructor (\n        p: {\n            brushSettingService: BrushSettingService; // to sync with outside\n            enabledTest: () => boolean; // calls to see if it's allowed to show\n        }\n    ) {\n        const sizeObj = {\n            width: 150,\n            svHeight: 90,\n            hHeight: 20,\n            sliderHeight: 25,\n        };\n\n        let isVisible = false;\n        this.rootEl = BB.el({\n            className: 'kl-overlay-toolspace',\n        });\n        const queuedObj: {\n            color: IRGB | null;\n            size: number | null;\n            opacity: number | null;\n        } = {\n            color: null,\n            size: null,\n            opacity: null,\n        };\n\n\n        // --- inputs ---\n\n        //color selection\n        const colorEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-overlay-toolspace__color',\n        });\n        const colorSlider = new KlColorSliderSmall({\n            width: sizeObj.width,\n            heightSV: sizeObj.svHeight,\n            heightH: sizeObj.hHeight,\n            color: p.brushSettingService.getColor(),\n            callback: (rgbObj: IRGB) => {\n                selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n            },\n        });\n        const selectedColorEl = BB.el({\n            css: {\n                width: sizeObj.width + 'px',\n                height: sizeObj.hHeight + 'px',\n                pointerEvents: 'none',\n            },\n        });\n        {\n            const initialColor = p.brushSettingService.getColor();\n            selectedColorEl.style.backgroundColor = 'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\n        }\n\n        colorEl.append(selectedColorEl, colorSlider.getElement());\n\n\n        const updateColor = (rgbObj: IRGB) => {\n            colorSlider.setColor(rgbObj);\n            selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\n        };\n\n\n\n        //brushsize slider\n\n        const sizeSlider = new KlSlider({\n            label: LANG('brush-size'),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 500,\n            value: 50,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val) => val * 2,\n            toValue: (displayValue) => displayValue / 2,\n            onChange: (v) => {\n                p.brushSettingService.setSize(v);\n            },\n            formatFunc: (displayValue) => {\n                if (displayValue < 10) {\n                    return BB.round(displayValue, 1);\n                } else {\n                    return Math.round(displayValue);\n                }\n            },\n        });\n        BB.css(sizeSlider.getElement(), {\n            marginTop: '2px',\n        });\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 1,\n            value: 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val) => val * 100,\n            toValue: (displayValue) => displayValue / 100,\n            onChange: (v) => {\n                p.brushSettingService.setOpacity(v);\n            },\n        });\n        BB.css(opacitySlider.getElement(), {\n            margin: '2px 0',\n        });\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\n\n\n\n        // --- general setup ---\n\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\n            if (event.type === 'color') {\n                if (!isVisible) {\n                    queuedObj.color = event.value;\n                } else {\n                    updateColor(event.value);\n                }\n            }\n            if (event.type === 'size') {\n                if (!isVisible) {\n                    queuedObj.size = event.value;\n                } else {\n                    sizeSlider.setValue(event.value);\n                }\n            }\n            if (event.type === 'opacity') {\n                if (!isVisible) {\n                    queuedObj.opacity = event.value;\n                } else {\n                    opacitySlider.setValue(event.value);\n                }\n            }\n            if (event.type === 'sliderConfig') {\n                sizeSlider.update(event.value.sizeSlider);\n                opacitySlider.update(event.value.opacitySlider);\n            }\n        };\n        p.brushSettingService.subscribe(subscriptionFunc);\n        {\n            const sliderConfig = p.brushSettingService.getSliderConfig();\n            sizeSlider.update(sliderConfig.sizeSlider);\n            opacitySlider.update(sliderConfig.opacitySlider);\n            sizeSlider.setValue(p.brushSettingService.getSize());\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\n        }\n\n        const updateUI = () => {\n\n            // unfocus manual slider input\n            BB.unfocusAnyInput();\n\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\n            if (isVisible && mousePos) {\n                BB.css(this.rootEl, {\n                    left: (mousePos.x - Math.round(sizeObj.width / 2)) + 'px',\n                    top: (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px',\n                });\n            }\n        };\n\n        let mousePos: IVector2D | null = null;\n        document.addEventListener('pointermove', (event) => {\n            mousePos = {\n                x: event.pageX,\n                y: event.pageY,\n            };\n        });\n\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n                if (isRepeat) {\n                    return;\n                }\n                if (isVisible) {\n                    isVisible = false;\n                    updateUI();\n                    return;\n                }\n\n                if (!p.enabledTest() || !mousePos) {\n                    return;\n                }\n\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\n                    event.preventDefault();\n                    isVisible = true;\n\n                    if (queuedObj.color !== null) {\n                        updateColor(queuedObj.color);\n                        queuedObj.color = null;\n                    }\n                    if (queuedObj.size !== null) {\n                        sizeSlider.setValue(queuedObj.size);\n                        queuedObj.size = null;\n                    }\n                    if (queuedObj.opacity !== null) {\n                        opacitySlider.setValue(queuedObj.opacity);\n                        queuedObj.opacity = null;\n                    }\n\n                    updateUI();\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n            onBlur: () => {\n                if (isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}","import {BB} from '../../../bb/bb';\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\nimport newImageImg from '/src/app/img/ui/new-image.svg';\nimport importImg from '/src/app/img/ui/import.svg';\nimport exportImg from '/src/app/img/ui/export.svg';\nimport shareImg from '/src/app/img/ui/share.svg';\nimport helpImg from '/src/app/img/ui/help.svg';\nimport {LANG} from '../../../language/language';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\n/**\n * Topmost row of buttons in toolspace (with the app logo)\n */\nexport class ToolspaceTopRow {\n    \n    private readonly rootEl: HTMLElement;\n    \n    // ---- public ----\n    constructor (\n        p: {\n            logoImg: string;\n            onLogo: () => void;\n            onNew: () => void;\n            onImport: () => void;\n            onSave: () => void;\n            onShare: () => void;\n            onHelp: () => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '36px',\n                display: 'flex',\n            },\n        });\n\n        function createButton (\n            p: {\n                onClick: () => void;\n                title: string;\n                image: string;\n                contain: boolean;\n                extraPadding?: number;\n                darkInvert?: boolean;\n            }\n        ): {\n            el: HTMLElement;\n            pointerListener: PointerListener;\n        } {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? padding + 'px 0' : '',\n                },\n            });\n            const im = BB.el({\n                className: p.darkInvert ? 'dark-invert' : undefined,\n                css: {\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: p.contain ? 'contain' : '',\n                    //filter: 'grayscale(1)',\n                    height: '100%',\n                },\n            });\n            im.style.pointerEvents = 'none';\n            el.append(im);\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: function (isOver) {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n            return {\n                el,\n                pointerListener,\n            };\n        }\n\n        const logoButton = createButton({\n            onClick: p.onLogo,\n            title: LANG('home'),\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\n            contain: true,\n            darkInvert: true,\n        });\n        logoButton.el.classList.add('kl-tool-row-border-right');\n        BB.css(logoButton.el, {\n            width: '46px',\n        });\n        const newButton = createButton({\n            onClick: p.onNew,\n            title: LANG('file-new'),\n            image: newImageImg,\n            extraPadding: 1,\n            contain: true,\n        });\n        const importButton = createButton({\n            onClick: p.onImport,\n            title: LANG('file-import'),\n            image: importImg,\n            extraPadding: 1,\n            contain: true,\n        });\n        const saveButton = createButton({\n            onClick: p.onSave,\n            title: LANG('file-save'),\n            image: exportImg,\n            extraPadding: 1,\n            contain: true,\n        });\n\n        let shareButton = null;\n        if (BB.canShareFiles()) {\n            shareButton = createButton({\n                onClick: p.onShare,\n                title: LANG('file-share'),\n                image: shareImg,\n                contain: true,\n                darkInvert: true,\n            });\n        }\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true,\n            darkInvert: true,\n        });\n\n        BB.append(this.rootEl, [\n            logoButton.el,\n            newButton.el,\n            importButton.el,\n            saveButton.el,\n            shareButton ? shareButton.el : undefined,\n            helpButton.el,\n        ]);\n    }\n    \n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"klecks-logo.a5145675.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"new-image.38d5fae1.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"import.f22da78a.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"export.abffd7d2.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"share.fb29aac6.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"help.d5fd5dcd.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {dialogCounter} from '../modals/modal-count';\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\nimport {LANG} from '../../../language/language';\nimport {TToolType} from '../../kl-types';\n\n\ntype TDropdownButton = {\n    wrapper: HTMLElement;\n    show: (b: boolean) => void;\n    setIsSmall: (b: boolean) => void;\n};\n\n/**\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\n */\nexport class ToolDropdown {\n\n    private readonly rootEl: HTMLElement;\n    private readonly activeButton: HTMLElement;\n    private readonly smallMargin: string = '6px 0';\n    private readonly optionArr: TToolType[] = ['draw', 'fill', 'gradient', 'text', 'shape'];\n    private readonly dropdownBtnArr: TDropdownButton[];\n    private readonly arrowButton: HTMLElement;\n    private isActive: boolean;\n    private currentActiveIndex: number;\n    private readonly titleArr: string[];\n    private activeButtonIm: HTMLElement;\n    private readonly imArr;\n\n    private updateButton () {\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\n        this.activeButtonIm.style.backgroundImage = 'url(\\'' + this.imArr[this.currentActiveIndex] + '\\')';\n    }\n\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onChange: (activeStr: TToolType) => void;\n        }\n    ) {\n        this.imArr = [\n            toolPaintImg,\n            toolFillImg,\n            toolGradientImg,\n            toolTextImg,\n            toolShapeImg,\n        ];\n        this.titleArr = [\n            `${LANG('tool-brush')} [B]`,\n            `${LANG('tool-paint-bucket')} [G]`,\n            `${LANG('tool-gradient')} [G]`,\n            `${LANG('tool-text')} [T]`,\n            `${LANG('tool-shape')} [U]`,\n        ];\n        this.currentActiveIndex = 0;\n        this.isActive = true;\n        let isOpen = false;\n\n        //preload images\n        setTimeout(() => {\n            for (let i = 1; i < this.imArr.length; i++) {\n                const im = new Image();\n                im.src = this.imArr[i];\n            }\n        }, 100);\n\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n                flexGrow: '1',\n            },\n        });\n\n        let openTimeout: ReturnType<typeof setTimeout>;\n        let isDragging = false;\n        let startX: number;\n        let startY: number;\n        let pointerListener;\n        if (BB.hasPointerEvents) {\n            pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n                        if (isOpen) {\n                            return;\n                        }\n\n                        openTimeout = setTimeout(() => {\n                            showDropdown();\n                        }, 400);\n                        isDragging = true;\n                        startX = event.pageX;\n                        startY = event.pageY;\n\n                    } else if (event.type === 'pointermove') {\n                        if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\n                            clearTimeout(openTimeout);\n                            showDropdown();\n                        }\n\n                    } else if (event.type === 'pointerup') {\n                        clearTimeout(openTimeout);\n                        if (isOpen && isDragging) {\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\n                                if (target === this.dropdownBtnArr[i].wrapper) {\n                                    closeDropdown();\n                                    this.isActive = true;\n                                    this.currentActiveIndex = i;\n                                    this.updateButton();\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\n                                    break;\n                                }\n                            }\n                        }\n                        isDragging = false;\n                    }\n                },\n            });\n        }\n\n        this.activeButton = BB.el({\n            parent: this.rootEl,\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\n            title: this.titleArr[this.currentActiveIndex],\n            onClick: (e) => {\n                if (this.isActive && !isOpen) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    showDropdown();\n                    return;\n                }\n\n                this.isActive = true;\n                p.onChange(this.optionArr[this.currentActiveIndex]);\n                if (isOpen) {\n                    closeDropdown();\n                }\n            },\n            css: {\n                padding: '10px 0',\n                pointerEvents: 'auto',\n                height: '100%',\n                boxSizing: 'border-box',\n            },\n        });\n\n        this.activeButtonIm = BB.el({\n            parent: this.activeButton,\n            className: 'dark-invert',\n            css: {\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: 'contain',\n                width: 'calc(100% - 7px)',\n                height: '100%',\n                pointerEvents: 'none',\n                opacity: '0.75',\n            },\n        });\n\n        this.arrowButton = BB.el({\n            parent: this.activeButton,\n            className: 'dark-invert',\n            css: {\n                position: 'absolute',\n                right: '1px',\n                bottom: '1px',\n                width: '18px',\n                height: '18px',\n                //background: '#aaa',\n                //borderRadius: '2px',\n                cursor: 'pointer',\n\n                backgroundImage: 'url(\\'' + caretDownImg + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: '60%',\n            },\n            title: 'More Tools',\n            onClick: (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                showDropdown();\n            },\n        });\n\n\n        const overlay = BB.el({\n            css: {\n                position: 'absolute',\n                //background: 'rgba(255,0,0,0.5)',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n            },\n        });\n        const overlayPointerListener = new BB.PointerListener({\n            target: overlay,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    e.eventPreventDefault();\n                    closeDropdown();\n                }\n            },\n        });\n\n        const dropdownWrapper = BB.el({\n            className: 'tool-dropdown-wrapper',\n            css: {\n                position: 'absolute',\n                width: '100%',\n                height: (100 * (this.optionArr.length - 1)) + '%',\n                top: '100%',\n                left: '0',\n                zIndex: '1',\n                boxSizing: 'border-box',\n                cursor: 'pointer',\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\n                borderBottomLeftRadius: '5px',\n                borderBottomRightRadius: '5px',\n                overflow: 'hidden',\n            },\n        });\n\n        this.dropdownBtnArr = [];\n\n        const createDropdownButton = (\n            p: {\n                index: number;\n                id: TToolType;\n                image: string;\n                title: string;\n                onClick: (index: number) => void;\n            }\n        ): TDropdownButton => {\n            const wrapper = BB.el({\n                parent: dropdownWrapper,\n                className: 'tool-dropdown-button',\n                title: p.title,\n                css: {\n                    padding: '10px 0',\n                    height: (100 / (this.optionArr.length - 1)) + '%',\n                    boxSizing: 'border-box',\n                },\n                onClick: (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    p.onClick(p.index);\n                },\n            });\n\n            BB.el({\n                parent: wrapper,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: 'contain',\n                    height: '100%',\n                    pointerEvents: 'none',\n                    opacity: '0.75',\n                },\n            });\n\n            // --- interface ---\n            const show = (b: boolean) => {\n                wrapper.style.display = b ? 'block' : 'none';\n            };\n\n            const setIsSmall = (b: boolean) => {\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\n            };\n\n            return {\n                wrapper,\n                show,\n                setIsSmall,\n            };\n        };\n\n        const onClickDropdownBtn = (index: number) => {\n            closeDropdown();\n\n            this.isActive = true;\n            this.currentActiveIndex = index;\n\n            this.updateButton();\n\n            p.onChange(this.optionArr[this.currentActiveIndex]);\n        };\n\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.dropdownBtnArr.push(createDropdownButton({\n                index: i,\n                id: this.optionArr[i],\n                image: this.imArr[i],\n                title: this.titleArr[i],\n                onClick: onClickDropdownBtn,\n            }));\n        }\n\n        const showDropdown = () => {\n            dialogCounter.increase(0.5);\n            isOpen = true;\n\n            for (let i = 0; i < this.optionArr.length; i++) {\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\n            }\n\n            this.arrowButton.style.display = 'none';\n            this.rootEl.style.zIndex = '1';\n            document.body.append(overlay);\n            this.rootEl.append(dropdownWrapper);\n        };\n\n        const closeDropdown = () => {\n            dialogCounter.decrease(0.5);\n            isOpen = false;\n            this.arrowButton.style.removeProperty('display');\n            this.rootEl.style.removeProperty('z-index');\n            overlay.remove();\n            dropdownWrapper.remove();\n        };\n\n        this.updateButton();\n    }\n\n    // ---- interface ----\n\n    setIsSmall (b: boolean): void {\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.dropdownBtnArr[i].setIsSmall(b);\n        }\n        if (b) {\n            this.arrowButton.style.width = '14px';\n            this.arrowButton.style.height = '14px';\n        } else {\n            this.arrowButton.style.width = '18px';\n            this.arrowButton.style.height = '18px';\n        }\n    }\n\n    setActive (activeStr: TToolType): void {\n        if (this.optionArr.includes(activeStr)) {\n            this.isActive = true;\n            for (let i = 0; i < this.optionArr.length; i++) {\n                if (this.optionArr[i] === activeStr) {\n                    this.currentActiveIndex = i;\n                    break;\n                }\n            }\n            this.activeButton.classList.add('toolspace-row-button-activated');\n            this.updateButton();\n        } else {\n            this.isActive = false;\n            this.activeButton.classList.remove('toolspace-row-button-activated');\n        }\n    }\n\n    getActive (): TToolType {\n        return this.optionArr[this.currentActiveIndex];\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-paint.3b54bb57.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-fill.33373232.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-gradient.d894f221.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-text.33314b25.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-shape.0f3cd4be.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {ToolDropdown} from './tool-dropdown';\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\nimport toolUndoImg from '/src/app/img/ui/tool-undo.svg';\nimport {LANG} from '../../../language/language';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {TToolType} from '../../kl-types';\n\n\ntype TBaseToolRowButton = {\n    el: HTMLElement;\n};\n\ntype TToolRowButton = TBaseToolRowButton & {\n    pointerListener: PointerListener;\n    setIsSmall: (b: boolean) => void;\n};\n\ntype TToolRowTriangleButton = TBaseToolRowButton & {\n    setIsEnabledLeft: (b: boolean) => void;\n    setIsEnabledRight: (b: boolean) => void;\n    leftPointerListener: PointerListener;\n    rightPointerListener: PointerListener;\n};\n\n/**\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\n * heights: 54px tall, 36px small -> via setIsSmall\n */\nexport class ToolspaceToolRow {\n\n    private readonly rootEl: HTMLElement;\n    private readonly toolDropdown: ToolDropdown;\n    private readonly handButton: TToolRowButton;\n    private readonly zoomInButton: TToolRowButton;\n    private readonly zoomOutButton: TToolRowButton;\n    private readonly undoButton: TToolRowButton;\n    private readonly redoButton: TToolRowButton;\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\n    private readonly undoNRedoButton: TToolRowTriangleButton;\n    private currentActiveStr: TToolType;\n    private readonly onActivate: (activeStr: TToolType) => void;\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\n            onZoomIn: () => void;\n            onZoomOut: () => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        this.rootEl = BB.el( {\n            className: 'kl-toolspace-row',\n            css: {\n                height: '54px',\n                display: 'flex',\n            },\n        });\n\n        this.onActivate = p.onActivate;\n        this.currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\n\n\n        const createButton = (p: {\n            onClick: () => void;\n            image: string;\n            contain: boolean;\n            doLighten?: boolean;\n            doMirror?: boolean;\n        }): TToolRowButton => {\n\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\n\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                //title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? '10px 0' : '',\n                },\n            });\n            const im = BB.el({\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: p.contain ? 'contain' : '',\n                    //filter: 'grayscale(1)',\n                    height: '100%',\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: 'none',\n                    opacity: p.doLighten ? '0.75' : '1',\n                },\n            });\n            el.append(im);\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: (isOver) => {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n            const setIsSmall = (b: boolean) => {\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\n            };\n            return {\n                el,\n                pointerListener,\n                setIsSmall,\n            };\n        };\n\n\n        const createTriangleButton = (p: {\n            onLeft: () => void;\n            onRight: () => void;\n            leftImage: string;\n            rightImage: string | null;\n        }): TToolRowTriangleButton => { // because IE and Edge don't support clip path\n\n            const result = BB.el({\n                css: {\n                    flexGrow: '1',\n                    position: 'relative',\n                },\n            });\n\n            const svg = BB.createSvg({\n                elementType: 'svg',\n                width: '67px', // can't think of a way doing with percentage\n                height: '54px',\n                viewBox: '0 0 100 100',\n                preserveAspectRatio: 'none',\n            });\n            BB.css(svg, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n            });\n\n            const blurRadius = 10;\n            const blurOffsetX = 2;\n            const blurOffsetY = 2;\n\n            const defs = BB.createSvg( { // inset shadow via svg\n                elementType: 'defs',\n                childrenArr: [\n                    {\n                        elementType: 'filter',\n                        id: 'innershadow',\n                        x0: '-50%',\n                        y0: '-50%',\n                        width: '200%',\n                        height: '200%',\n                        childrenArr: [\n                            {\n                                elementType: 'feGaussianBlur',\n                                in: 'SourceAlpha',\n                                stdDeviation: '' + blurRadius,\n                                result: 'blur',\n                            }, {\n                                elementType: 'feOffset',\n                                dx: '' + blurOffsetX,\n                                dy: '' + blurOffsetY,\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'SourceAlpha',\n                                operator: 'arithmetic',\n                                k2: '-1',\n                                k3: '1',\n                                result: 'shadowDiff',\n                            },\n\n                            {\n                                elementType: 'feFlood',\n                                'flood-color': '#000',\n                                'flood-opacity': '0.2',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'shadowDiff',\n                                operator: 'in',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'SourceGraphic',\n                                operator: 'over',\n                                result: 'firstfilter',\n                            },\n\n                            {\n                                elementType: 'feGaussianBlur',\n                                in: 'firstfilter',\n                                stdDeviation: '' + blurRadius,\n                                result: 'blur2',\n                            }, {\n                                elementType: 'feOffset',\n                                dx: '' + blurOffsetX,\n                                dy: '' + blurOffsetY,\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'firstfilter',\n                                operator: 'arithmetic',\n                                k2: '-1',\n                                k3: '1',\n                                result: 'shadowDiff',\n                            },\n\n                            {\n                                elementType: 'feFlood',\n                                'flood-color': '#000',\n                                'flood-opacity': '0.2',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'shadowDiff',\n                                operator: 'in',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'firstfilter',\n                                operator: 'over',\n                            },\n                        ],\n                    },\n                ],\n            });\n\n\n            const svgTriangleLeft = BB.createSvg({\n                elementType: 'path',\n                'vector-effect': 'non-scaling-stroke',\n                d: 'M0,0 L 100,0 0,100 z',\n                fill: 'rgba(0,0,0,0)',\n                class: 'toolspace-svg-triangle-button',\n            });\n            svgTriangleLeft.onclick = () => {\n                p.onLeft();\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\n            };\n\n            const svgTriangleRight = BB.createSvg({\n                elementType: 'path',\n                'vector-effect': 'non-scaling-stroke',\n                d: 'M100,100 L 100,0 0,100 z',\n                fill: 'rgba(0,0,0,0)',\n                class: 'toolspace-svg-triangle-button',\n            });\n            svgTriangleRight.onclick = () => {\n                p.onRight();\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\n            };\n\n            // because :hover causes problems w touch\n            const leftPointerListener = new BB.PointerListener({\n                target: svgTriangleLeft,\n                onEnterLeave: (isOver) => {\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n                },\n            });\n            const rightPointerListener = new BB.PointerListener({\n                target: svgTriangleRight,\n                onEnterLeave: (isOver) => {\n                    svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n                },\n            });\n\n\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\n            result.append(svg);\n\n\n            const leftIm = BB.el({\n                parent: result,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + p.leftImage + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundSize: 'contain',\n                    width: '20px',\n                    height: '20px',\n                    position: 'absolute',\n                    left: '10px',\n                    top: '8px',\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: 'none',\n                },\n            });\n            result.append(leftIm);\n\n\n            const rightIm = BB.el({\n                parent: result,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundSize: 'contain',\n                    width: '20px',\n                    height: '20px',\n                    position: 'absolute',\n                    right: '10px',\n                    bottom: '8px',\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\n                    pointerEvents: 'none',\n                },\n            });\n\n\n\n\n\n            const setIsEnabledLeft = (b: boolean) => {\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\n            };\n\n            const setIsEnabledRight = (b: boolean) => {\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\n            };\n\n            return {\n                el: result,\n                setIsEnabledLeft,\n                setIsEnabledRight,\n                leftPointerListener,\n                rightPointerListener,\n            };\n        };\n\n        this.toolDropdown = new ToolDropdown({\n            onChange: (activeStr) => {\n                this.setActive(activeStr, true);\n            },\n        });\n        this.rootEl.append(this.toolDropdown.getElement());\n\n        this.handButton = createButton({\n            onClick: () => {\n                this.setActive('hand', true);\n            },\n            image: toolHandImg,\n            contain: true,\n            doLighten: true,\n        });\n        this.handButton.el.classList.add('kl-tool-row-border-right');\n        this.handButton.el.title = LANG('tool-hand');\n        this.rootEl.append(this.handButton.el);\n\n        this.zoomInNOutButton = createTriangleButton({\n            onLeft: p.onZoomIn,\n            onRight: p.onZoomOut,\n            leftImage: toolZoomInImg,\n            rightImage: toolZoomOutImg,\n        });\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\n        this.rootEl.append(this.zoomInNOutButton.el);\n\n        this.zoomInButton = createButton({\n            onClick: p.onZoomIn,\n            image: toolZoomInImg,\n            contain: true,\n        });\n        this.zoomInButton.el.title = LANG('zoom-in');\n        this.rootEl.append(this.zoomInButton.el);\n\n        this.zoomOutButton = createButton({\n            onClick: p.onZoomOut,\n            image: toolZoomOutImg,\n            contain: true,\n        });\n        this.zoomOutButton.el.title = LANG('zoom-out');\n        this.rootEl.append(this.zoomOutButton.el);\n\n        this.undoNRedoButton = createTriangleButton({\n            onLeft: p.onUndo,\n            onRight: p.onRedo,\n            leftImage: toolUndoImg,\n            rightImage: null,\n        });\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\n        this.undoNRedoButton.setIsEnabledLeft(false);\n        this.undoNRedoButton.setIsEnabledRight(false);\n        this.rootEl.append(this.undoNRedoButton.el);\n\n        this.undoButton = createButton({\n            onClick: p.onUndo,\n            image: toolUndoImg,\n            contain: true,\n        });\n        this.undoButton.el.title = LANG('undo');\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\n        this.rootEl.append(this.undoButton.el);\n\n        this.redoButton = createButton({\n            onClick: p.onRedo,\n            image: toolUndoImg,\n            contain: true,\n            doMirror: true,\n        });\n        this.redoButton.el.title = LANG('redo');\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\n        this.rootEl.append(this.redoButton.el);\n\n        this.zoomInButton.el.style.display = 'none';\n        this.zoomOutButton.el.style.display = 'none';\n        this.undoButton.el.style.display = 'none';\n        this.redoButton.el.style.display = 'none';\n    }\n\n    // ---- interface ----\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsSmall (b: boolean): void {\n        BB.css(this.rootEl, {\n            height: b ? '36px' : '54px',\n        });\n\n        this.toolDropdown.setIsSmall(b);\n        this.handButton.setIsSmall(b);\n        this.zoomInButton.setIsSmall(b);\n        this.zoomOutButton.setIsSmall(b);\n        this.undoButton.setIsSmall(b);\n        this.redoButton.setIsSmall(b);\n\n        if (b) {\n            this.zoomInNOutButton.el.style.display = 'none';\n            this.undoNRedoButton.el.style.display = 'none';\n            this.zoomInButton.el.style.display = 'block';\n            this.zoomOutButton.el.style.display = 'block';\n            this.undoButton.el.style.display = 'block';\n            this.redoButton.el.style.display = 'block';\n        } else {\n            this.zoomInNOutButton.el.style.display = 'block';\n            this.undoNRedoButton.el.style.display = 'block';\n            this.zoomInButton.el.style.display = 'none';\n            this.zoomOutButton.el.style.display = 'none';\n            this.undoButton.el.style.display = 'none';\n            this.redoButton.el.style.display = 'none';\n        }\n\n    }\n\n    setEnableZoomIn (b: boolean): void {\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.zoomInNOutButton.setIsEnabledLeft(b);\n    }\n\n    setEnableZoomOut (b: boolean): void {\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.zoomInNOutButton.setIsEnabledRight(b);\n    }\n\n    setEnableUndo (b: boolean): void {\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.undoNRedoButton.setIsEnabledLeft(b);\n    }\n\n    setEnableRedo (b: boolean): void {\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.undoNRedoButton.setIsEnabledRight(b);\n    }\n\n    setActive (activeStr: TToolType, doEmit?: boolean): void {\n        if (this.currentActiveStr === activeStr) {\n            return;\n        }\n\n        this.currentActiveStr = activeStr;\n\n        this.toolDropdown.setActive(this.currentActiveStr);\n        this.handButton.el.classList.toggle('toolspace-row-button-activated', this.currentActiveStr === 'hand');\n\n        if (doEmit) {\n            this.onActivate(this.currentActiveStr);\n        }\n    }\n\n    getActive (): TToolType {\n        return this.currentActiveStr;\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tool-undo.4ac4ddba.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {Select} from './select';\nimport {LANG} from '../../../language/language';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n/**\n * Ui to select stabilizer level. 4 options. returned as 0-3\n */\nexport class ToolspaceStabilizerRow {\n\n    private readonly rootEl: HTMLElement;\n    private readonly pointerListener: PointerListener;\n\n    // ---- public ----\n    constructor (\n        p: {\n            smoothing: number; // initial level [0,3]\n            onSelect: (level: number) => void; // [0-3], when level changes\n        }\n    ) {\n        this.rootEl = BB.el({\n            tagName: 'label',\n            className: 'kl-stabilizer',\n            content: LANG('stabilizer') + '&nbsp;',\n            title: LANG('stabilizer-title'),\n        });\n\n        const strengthSelect = new Select({\n            optionArr: [\n                ['0', '0'],\n                ['1', '1'],\n                ['2', '2'],\n                ['3', '3'],\n                ['4', '4'],\n                ['5', '5'],\n            ],\n            initValue: '' + p.smoothing,\n            onChange: function (val) {\n                p.onSelect(parseInt(val));\n            },\n        });\n        this.rootEl.append(strengthSelect.getElement());\n\n        this.pointerListener = new BB.PointerListener({\n            target: this.rootEl,\n            onWheel: function (e) {\n                strengthSelect.setDeltaValue(e.deltaY);\n            },\n        });\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport invertedBorderImg from '/src/app/img/ui/inverted-border.svg';\nimport {IKeyStringOptional} from '../../../bb/bb-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\n// type all functions\n\n\ntype TTabInit = {\n    id: string; // e.g. 'draw',\n    label?: string;\n    image?: string; // background image\n    title?: string;\n    isVisible?: boolean; // default is true\n    onOpen: () => void;\n    onClose: () => void;\n    css?: IKeyStringOptional;\n};\n\ntype TTab = {\n    id: string;\n    isVisible: boolean;\n    onOpen: () => void;\n    onClose: () => void;\n    update: (activeTab: TTab) => void;\n    el: HTMLElement;\n    pointerListener: PointerListener;\n};\n\n\n/**\n * row of tabs. uses css class .tabrow__tab\n */\nexport class TabRow {\n\n    private readonly rootEl: HTMLElement;\n    private readonly tabArr: TTab[];\n    private activeTab: TTab;\n    private readonly roundRight: HTMLElement;\n    private readonly roundLeft: HTMLElement;\n    \n    \n    // update\n    update (): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            this.tabArr[i].update(this.activeTab);\n        }\n    }\n    \n    // ---- public ----\n    constructor (\n        p: {\n            initialId: string; // e.g. 'draw'\n            useAccent?: boolean;\n            tabArr: TTabInit[];\n            height?: number;\n        }\n    ) {\n        const height = p.height ?? 35;\n        this.rootEl = BB.el({\n            className: 'tabrow',\n            css: {\n                height: (height + 1) + 'px',\n            },\n        });\n\n        this.tabArr = []; //creates its own internal arr\n\n        const roundSize = 10;\n        this.roundRight = BB.el({\n            css: {\n                width: roundSize + 'px',\n                height: roundSize + 'px',\n                backgroundImage: `url('${invertedBorderImg}')`,\n                backgroundSize: 'cover',\n                position: 'absolute',\n                right: -roundSize + 'px',\n                bottom: '0',\n                pointerEvents: 'none',\n            },\n        });\n        this.roundLeft = BB.el({\n            css: {\n                width: roundSize + 'px',\n                height: roundSize + 'px',\n                backgroundImage: `url('${invertedBorderImg}')`,\n                backgroundSize: 'cover',\n                position: 'absolute',\n                left: -roundSize + 'px',\n                bottom: '0',\n                transform: 'scale(-1,1)',\n                pointerEvents: 'none',\n            },\n        });\n\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\n            const isVisible = ('isVisible' in pTabObj && pTabObj.isVisible !== undefined) ? pTabObj.isVisible : true;\n            const result: TTab = {\n                id: pTabObj.id,\n                isVisible: isVisible,\n                onOpen: pTabObj.onOpen,\n                onClose: pTabObj.onClose,\n                update: (openedTabObj: TTab) => {\n                    result.el.className = openedTabObj === result ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab';\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\n                },\n                el: BB.el({\n                    parent: this.rootEl,\n                    content: 'label' in pTabObj ? pTabObj.label : '',\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\n                    className: initialId === pTabObj.id ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab',\n                    css: {\n                        lineHeight: height + 'px',\n                        display: isVisible ? 'block' : 'none',\n                        zIndex: '0',\n                    },\n                    onClick: () => {\n                        if (this.activeTab === result) {\n                            return;\n                        }\n                        this.open(result.id);\n                    },\n                }),\n                pointerListener: {} as PointerListener,\n            };\n            if ('image' in pTabObj) {\n\n                BB.el({\n                    tagName: 'span',\n                    parent: result.el,\n                    className: 'dark-invert',\n                    css: {\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\n                        backgroundSize: 'contain',\n                        backgroundPosition: 'center',\n                        backgroundRepeat: 'no-repeat',\n                        display: 'flex',\n                        height: (height - 7) + 'px',\n                        justifyContent: 'center',\n                        margin: '4px auto',\n                    },\n                });\n            }\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\n                BB.css(result.el, pTabObj.css);\n            }\n\n            result.pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: result.el,\n                onEnterLeave: (isOver) => {\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\n                },\n            });\n\n            if (initialId === result.id) {\n                result.onOpen();\n                result.el.append(this.roundRight, this.roundLeft);\n            } else {\n                result.onClose();\n            }\n\n            return result;\n        };\n\n        let initTabObj = null;\n        for (let i = 0; i < p.tabArr.length; i++) {\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\n            if (tab.id === p.initialId) {\n                initTabObj = tab;\n            }\n            this.tabArr.push(tab);\n        }\n        if (!initTabObj) {\n            throw 'invalid initialId';\n        }\n        this.activeTab = initTabObj;\n    }\n\n    // ---- interface ----\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    open (tabId: string): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            if (this.tabArr[i].id === tabId) {\n                if (this.activeTab === this.tabArr[i]) { // already open\n                    return;\n                }\n                this.activeTab.onClose();\n                this.activeTab = this.tabArr[i];\n                this.activeTab.onOpen();\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\n                this.update();\n                return;\n            }\n        }\n        throw 'TabRow.open - invalid tabId';\n    }\n\n    getOpenedTabId (): string {\n        return '' + this.activeTab.id;\n    }\n\n    setIsVisible (tabId: string, isVisible: boolean): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            if (this.tabArr[i].id === tabId) {\n                this.tabArr[i].isVisible = isVisible;\n                this.update();\n                return;\n            }\n        }\n        throw 'TabRow.setIsVisible - invalid tabId';\n    }\n\n    destroy (): void {\n        this.tabArr.forEach(item => {\n            BB.destroyEl(item.el);\n            item.pointerListener.destroy();\n        });\n    }\n}\n\n\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"inverted-border.07365ee7.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport angleImg from '/src/app/img/ui/angle.svg';\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui, when hand tool tab is open.\n */\nexport class HandUi {\n\n    private readonly rootEl: HTMLElement;\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\n    private isVisible: boolean = true;\n    private scale: number;\n    private angleDeg: number;\n    private readonly scaleEl: HTMLElement;\n    private readonly angleEl: HTMLElement;\n    private readonly angleIm: HTMLImageElement;\n\n\n    private updateUi (): void {\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\n        this.angleEl.innerHTML =  Math.round(this.angleDeg) + '';\n\n        this.angleIm.style.transform = 'rotate(' + this.angleDeg + 'deg)';\n        if (this.angleDeg % 90 === 0) {\n            this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\n        } else {\n            this.angleIm.style.boxShadow = '';\n        }\n    }\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            scale: number; // initial value\n            angleDeg: number; // initial value\n            onReset: () => void;\n            onFit: () => void;\n            onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.scale = p.scale;\n        this.angleDeg = p.angleDeg;\n        this.onAngleChange = p.onAngleChange;\n\n        const row1 = BB.el({\n            css: {\n                marginBottom: '10px',\n                display: 'flex',\n            },\n        });\n        const row2 = BB.el({\n            css: {\n                display: 'flex',\n                marginBottom: '10px',\n            },\n        });\n        const row3 = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n        this.rootEl.append(row1, row2, row3);\n\n\n        this.scaleEl = BB.el({\n            css: {\n                width: '55px',\n                userSelect: 'none',\n            },\n        });\n        row1.append(this.scaleEl);\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleImg;\n        BB.css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginRight: '5px',\n            borderRadius: '10px',\n            background: 'rgba(0,0,0,0.2)',\n            userSelect: 'none',\n        });\n        row1.append(this.angleIm);\n\n        this.angleEl = BB.el({\n            parent: row1,\n            css: {\n                userSelect: 'none',\n            },\n        });\n\n        this.updateUi();\n\n\n        const resetButton = BB.el({\n            tagName: 'button',\n            content: LANG('hand-reset'),\n            onClick: p.onReset,\n        });\n        BB.makeUnfocusable(resetButton);\n\n        const fitButton = BB.el({\n            tagName: 'button',\n            content: LANG('hand-fit'),\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: p.onFit,\n        });\n        BB.makeUnfocusable(fitButton);\n        row2.append(resetButton, fitButton);\n\n        const leftRotateButton = BB.el({\n            tagName: 'button',\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n            onClick: function () {\n                p.onAngleChange(-15, true);\n            },\n        });\n        BB.makeUnfocusable(leftRotateButton);\n\n        const resetAngleButton = BB.el({\n            tagName: 'button',\n            content: '0',\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: function () {\n                p.onAngleChange(0);\n            },\n        });\n        BB.makeUnfocusable(resetAngleButton);\n\n        const rightRotateButton = BB.el({\n            tagName: 'button',\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: function () {\n                p.onAngleChange(15, true);\n            },\n        });\n        BB.makeUnfocusable(rightRotateButton);\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.updateUi();\n        }\n    }\n\n    update (pScale: number, pAngleDeg: number): void {\n        this.scale = pScale;\n        this.angleDeg = pAngleDeg;\n        if (this.isVisible) {\n            this.updateUi();\n        }\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-rotate.22f2f03d.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../components/kl-slider';\nimport {Select} from '../components/select';\nimport {Checkbox} from '../components/checkbox';\nimport {LANG} from '../../../language/language';\nimport {TFillSampling} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n/**\n * Paint Bucket tab contents (color slider, opacity slider, etc)\n */\nexport class FillUi {\n\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean;\n    private readonly colorDiv: HTMLElement;\n    private readonly colorSlider: KlColorSlider;\n    private readonly toleranceSlider: KlSlider;\n    private readonly opacitySlider: KlSlider;\n    private readonly modeSelect: Select<string>;\n    private readonly growSelect: Select<string>;\n    private isContiguous: boolean;\n    private readonly eraserToggle: Checkbox;\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.colorSlider = p.colorSlider;\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: 1,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n\n        this.toleranceSlider = new KlSlider({\n            label: LANG('bucket-tolerance'),\n            width: 250,\n            height: 30,\n            min: 0,\n            max: 255,\n            value: 20 * (255 / 100),\n            toValue: (displayValue) => displayValue * (255 / 100),\n            toDisplayValue: (value) => value / (255 / 100),\n        });\n        BB.css(this.toleranceSlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.toleranceSlider.getElement());\n\n        const selectRow = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                marginTop: '10px',\n            },\n        });\n\n        const modeWrapper = BB.el({\n            content: LANG('bucket-sample') + '&nbsp;',\n            title: LANG('bucket-sample-title'),\n            css: {\n                fontSize: '15px',\n            },\n        });\n        this.modeSelect = new Select({\n            optionArr: [\n                ['all', LANG('bucket-sample-all')],\n                ['current', LANG('bucket-sample-active')],\n                ['above', LANG('bucket-sample-above')],\n            ],\n            initValue: 'all',\n        });\n        const modePointerListener = new BB.PointerListener({\n            target: this.modeSelect.getElement(),\n            onWheel: (e) => {\n                this.modeSelect.setDeltaValue(e.deltaY);\n            },\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        selectRow.append(modeWrapper);\n\n        const growWrapper = BB.el({\n            content: LANG('bucket-grow') + '&nbsp;',\n            title: LANG('bucket-grow-title'),\n            css: {\n                fontSize: '15px',\n                marginLeft: '10px',\n            },\n        });\n        this.growSelect = new Select({\n            optionArr: [\n                ['0', '0'],\n                ['1', '1'],\n                ['2', '2'],\n                ['3', '3'],\n                ['4', '4'],\n                ['5', '5'],\n                ['6', '6'],\n                ['7', '7'],\n            ],\n            initValue: '0',\n        });\n        const growPointerListener = new BB.PointerListener({\n            target: this.growSelect.getElement(),\n            onWheel: (e) => {\n                this.growSelect.setDeltaValue(e.deltaY);\n            },\n        });\n        growWrapper.append(this.growSelect.getElement());\n        selectRow.append(growWrapper);\n\n\n        this.isContiguous = true;\n        const contiguousToggle = new Checkbox({\n            init: true,\n            label: LANG('bucket-contiguous'),\n            title: LANG('bucket-contiguous-title'),\n            callback: (b) => {\n                this.isContiguous = b;\n            },\n            css: {\n                paddingRight: '5px',\n                display: 'inline-block',\n                width: '50%',\n            },\n        });\n\n        this.eraserToggle = new Checkbox({\n            init: false,\n            label: LANG('eraser'),\n            css: {\n\n                paddingRight: '5px',\n                display: 'inline-block',\n                width: '50%',\n            },\n        });\n\n        this.rootEl.append(BB.el({\n            content: [\n                contiguousToggle.getElement(),\n                this.eraserToggle.getElement(),\n            ],\n            css: {\n                display: 'flex',\n                marginTop: '10px',\n            },\n        }));\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n        }\n    }\n\n    /**\n     * [0, 1]\n     */\n    getTolerance (): number {\n        return this.toleranceSlider.getValue();\n    }\n\n    getOpacity (): number {\n        return this.opacitySlider.getValue();\n    }\n\n    getSample (): TFillSampling {\n        return this.modeSelect.getValue() as TFillSampling;\n    }\n\n    getGrow (): number {\n        return parseInt(this.growSelect.getValue(), 10);\n    }\n\n    getContiguous (): boolean {\n        return this.isContiguous;\n    }\n\n    getIsEraser (): boolean {\n        return this.eraserToggle.getValue();\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n/**\n * Text Tool tab contents (color slider)\n */\nexport class TextUi {\n\n    private readonly rootEl: HTMLElement;\n    private readonly colorDiv: HTMLElement;\n    private isVisible: boolean = true;\n    private readonly colorSlider: KlColorSlider;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.colorSlider = p.colorSlider;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        const hint = BB.el({\n            parent: this.rootEl,\n            content: LANG('text-instruction'),\n        });\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n        }\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {Options} from '../components/options';\nimport {Checkbox} from '../components/checkbox';\nimport {KlSlider} from '../components/kl-slider';\nimport {LANG} from '../../../language/language';\nimport {TShapeToolMode, TShapeToolType} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n/**\n * Shape Tool tab contents\n */\nexport class ShapeUi {\n\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean;\n    private readonly colorDiv: HTMLElement;\n    private readonly colorSlider: KlColorSlider;\n    private shape: TShapeToolType = 'rect';\n    private mode: TShapeToolMode = 'stroke';\n    private readonly eraserToggle: Checkbox;\n    private readonly opacitySlider: KlSlider;\n    private readonly lineWidthSlider: KlSlider;\n    private readonly outwardsToggle: Checkbox;\n    private readonly fixedToggle: Checkbox;\n    private readonly snapToggle:Checkbox;\n    private readonly lockAlphaToggle: Checkbox;\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.colorSlider = p.colorSlider;\n\n        const previewSize = 35;\n        const previewPadding = 8;\n\n\n        const rectStrokeSvgRect = BB.createSvg({\n            elementType: 'rect',\n            x: '' + previewPadding,\n            width: '' + (previewSize - previewPadding * 2),\n        });\n        const rectStrokeSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        rectStrokeSvg.classList.add('dark-invert');\n        rectStrokeSvg.append(rectStrokeSvgRect);\n        BB.css(rectStrokeSvg, {\n            display: 'block',\n        });\n\n        const rectFilledSvgRect = BB.createSvg({\n            elementType: 'rect',\n            x: '' + previewPadding,\n            width: '' + (previewSize - previewPadding * 2),\n        });\n        const rectFilledSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        rectFilledSvg.classList.add('dark-invert');\n        rectFilledSvg.append(rectFilledSvgRect);\n        BB.css(rectFilledSvg, {\n            display: 'block',\n        });\n\n\n        const ellipseStrokeSvgEllipse = BB.createSvg({\n            elementType: 'ellipse',\n            cx: '' + (previewSize / 2),\n            cy: '' + (previewSize / 2),\n            rx: '' + (previewSize / 2 - previewPadding),\n        });\n        const ellipseStrokeSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        ellipseStrokeSvg.classList.add('dark-invert');\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\n        BB.css(ellipseStrokeSvg, {\n            display: 'block',\n        });\n\n        const ellipseFilledSvgEllipse = BB.createSvg({\n            elementType: 'ellipse',\n            cx: '' + (previewSize / 2),\n            cy: '' + (previewSize / 2),\n            rx: '' + (previewSize / 2 - previewPadding),\n        });\n        const ellipseFilledSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        ellipseFilledSvg.classList.add('dark-invert');\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\n        BB.css(ellipseFilledSvg, {\n            display: 'block',\n        });\n\n\n        const lineSvgLine = BB.createSvg({\n            elementType: 'line',\n            x1: '' + previewPadding,\n            x2: '' + (previewSize - previewPadding),\n        });\n        const lineSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        lineSvg.classList.add('dark-invert');\n        lineSvg.append(lineSvgLine);\n        BB.css(lineSvg, {\n            display: 'block',\n        });\n\n        const updatePreviews = () => {\n            const strokeWidth = BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\n\n            const squish = 1.35;\n\n            BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n            BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\n\n            BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n            BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\n\n            BB.css(\n                lineSvgLine,\n                { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\n            );\n\n            if (this.fixedToggle.getValue()) {\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n            } else {\n                rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n                rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n            }\n\n            if (this.snapToggle.getValue()) {\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\n            } else {\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\n                lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\n            }\n        };\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'start',\n            },\n        });\n\n        const shapeOptions = new Options({\n            optionArr: [\n                {\n                    id: 'rect-stroke',\n                    label: rectStrokeSvg,\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\n                },\n                {\n                    id: 'ellipse-stroke',\n                    label: ellipseStrokeSvg,\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\n                },\n                {\n                    id: 'line',\n                    label: lineSvg,\n                    title: LANG('shape-line'),\n                },\n                {\n                    id: 'rect-fill',\n                    label: rectFilledSvg,\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\n                },\n                {\n                    id: 'ellipse-fill',\n                    label: ellipseFilledSvg,\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\n                },\n            ],\n            initId: this.shape + ' ' + this.mode,\n            onChange: (id) => {\n                const split = id.split('-');\n                this.shape = split[0] as TShapeToolType;\n                this.mode = split[1] as TShapeToolMode;\n\n                BB.css(this.fixedToggle.getElement(), {\n                    display: this.shape === 'line' ? 'none' : '',\n                });\n                BB.css(this.snapToggle.getElement(), {\n                    display: this.shape === 'line' ? '' : 'none',\n                });\n                BB.css(this.lineWidthSlider.getElement(), {\n                    display: (this.shape !== 'line' && this.mode === 'fill') ? 'none' : '',\n                });\n            },\n            changeOnInit: true,\n        });\n        shapeOptions.getElement().style.width = '120px';\n        row1.append(shapeOptions.getElement());\n\n        this.eraserToggle = new Checkbox({\n            init: false,\n            label: LANG('eraser'),\n            callback: () => {\n                updatePreviews();\n            },\n        });\n\n        this.lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            doHighlight: true,\n        });\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\n\n        row1.append(BB.el({\n            content: [\n                this.eraserToggle.getElement(),\n                this.lockAlphaToggle.getElement(),\n            ],\n        }));\n\n        this.lineWidthSlider = new KlSlider({\n            label: LANG('shape-line-width'),\n            width: 250,\n            height: 30,\n            min: 1,\n            max: 200,\n            value: 4,\n            curve: 'quadratic',\n            onChange: () => {\n                updatePreviews();\n            },\n        });\n        BB.css(this.lineWidthSlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.lineWidthSlider.getElement());\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: 1,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n        });\n        BB.css(this.opacitySlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        this.outwardsToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-outwards'),\n            css: {\n                width: '50%',\n                marginRight: '10px',\n            },\n        });\n        row2.append(this.outwardsToggle.getElement());\n\n        this.fixedToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-fixed'),\n            callback: () => {\n                updatePreviews();\n            },\n            css: {\n                flexGrow: '1',\n            },\n        });\n        row2.append(this.fixedToggle.getElement());\n\n        this.snapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: () => {\n                updatePreviews();\n            },\n            css: {\n                flexGrow: '1',\n            },\n        });\n        row2.append(this.snapToggle.getElement());\n\n\n        updatePreviews();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement());\n            this.colorDiv.append(this.colorSlider.getOutputElement());\n            //update();\n        }\n    }\n\n    getShape (): TShapeToolType {\n        return this.shape;\n    }\n\n    getMode (): TShapeToolMode {\n        return this.mode;\n    }\n\n    getIsEraser (): boolean {\n        return this.eraserToggle.getValue();\n    }\n\n    getOpacity (): number {\n        return this.opacitySlider.getValue();\n    }\n\n    getLineWidth (): number {\n        return this.lineWidthSlider.getValue();\n    }\n\n    getIsOutwards (): boolean {\n        return this.outwardsToggle.getValue();\n    }\n\n    getIsFixed (): boolean {\n        return this.fixedToggle.getValue();\n    }\n\n    getIsSnap (): boolean {\n        return this.snapToggle.getValue();\n    }\n\n    getDoLockAlpha (): boolean {\n        return this.lockAlphaToggle.getValue();\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {Select} from '../components/select';\nimport {ColorOptions} from '../components/color-options';\nimport {showModal} from './base/showModal';\nimport {LANG} from '../../../language/language';\nimport {IRGB, IRGBA} from '../../kl-types';\nimport {ISize2D} from '../../../bb/bb-types';\nimport {table} from '../components/table';\nimport {ERASE_COLOR} from '../../brushes/erase-color';\nimport {theme} from '../../../theme/theme';\n\nexport function newImageDialog (\n    p: {\n        currentColor: IRGB; // current color\n        secondaryColor: IRGB;\n        maxCanvasSize: number;\n        canvasWidth: number; // current canvas size\n        canvasHeight: number; // current canvas size\n        workspaceWidth: number;\n        workspaceHeight: number;\n        onConfirm: (width: number, height: number, color: IRGBA) => void;\n        onCancel: () => void;\n    }\n): void {\n\n    const currentColor = p.currentColor;\n    const secondaryColor = p.secondaryColor;\n    const maxCanvasSize = p.maxCanvasSize;\n    const canvasWidth = p.canvasWidth;\n    const canvasHeight = p.canvasHeight;\n    const workspaceWidth = p.workspaceWidth;\n    const workspaceHeight = p.workspaceHeight;\n    const onConfirm = p.onConfirm;\n    const onCancel = p.onCancel;\n\n    function createRatioSize (ratioX: number, ratioY: number, width: number, height: number, padding: number): ISize2D {\n        return BB.fitInto(\n            ratioX,\n            ratioY,\n            Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding),\n            1\n        );\n    }\n\n    const newImDiv = BB.el();\n    const widthInput = BB.el({tagName: 'input'});\n    const unitStyle = {\n        color: '#888',\n        fontSize: '12px',\n        marginLeft: '5px',\n    };\n    const widthUnit = BB.el({\n        textContent: LANG('new-px'),\n        css: unitStyle,\n    });\n    const heightInput = BB.el({tagName: 'input'});\n    const heightUnit = BB.el({\n        textContent: LANG('new-px'),\n        css: unitStyle,\n    });\n\n    widthInput.setAttribute('data-ignore-focus', 'true');\n    heightInput.setAttribute('data-ignore-focus', 'true');\n\n    widthInput.type = 'number';\n    widthInput.min = '1';\n    widthInput.max = '' + maxCanvasSize;\n    BB.css(widthInput, {\n        width: '70px',\n    });\n\n    heightInput.type = 'number';\n    heightInput.min = '1';\n    heightInput.max = '' + maxCanvasSize;\n    heightInput.style.width = '70px';\n    widthInput.value = '' + canvasWidth;\n    heightInput.value = '' + canvasHeight;\n    widthInput.onclick = (): void => {\n        widthInput.focus();\n        updateRatio();\n    };\n    heightInput.onclick = (): void => {\n        heightInput.focus();\n        updateRatio();\n    };\n\n\n    const sizeTable = table([\n        [\n            LANG('width') + ':&nbsp;',\n            widthInput,\n            widthUnit,\n        ],\n        [\n            BB.el({css: {height: '5px'}}),\n            '',\n            '',\n        ],\n        [\n            LANG('height') + ':&nbsp;',\n            heightInput,\n            heightUnit,\n        ],\n    ]);\n    BB.css(sizeTable, {\n        marginBottom: '10px',\n    });\n\n\n    const ratioWrapper = BB.el({\n        css: {\n            marginTop: '5px',\n            color: '#888',\n        },\n    });\n\n    const templateWrapper = BB.el();\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\n    const presetFitBtn = BB.el({tagName: 'button'});\n    templateWrapper.style.marginBottom = '10px';\n    const presetCurrentBtn = BB.el({tagName: 'button'});\n    const presetSquareBtn = BB.el({tagName: 'button'});\n    const presetLandscapeBtn = BB.el({tagName: 'button'});\n    const presetPortraitBtn = BB.el({tagName: 'button'});\n    const presetOversizeBtn = BB.el({tagName: 'button'});\n\n    presetCurrentBtn.textContent = LANG('new-current');\n    presetFitBtn.textContent = LANG('new-fit');\n    presetOversizeBtn.textContent = LANG('new-oversize');\n    presetLandscapeBtn.textContent = LANG('new-landscape');\n    presetPortraitBtn.textContent = LANG('new-portrait');\n    presetSquareBtn.textContent = LANG('new-square');\n\n    presetCurrentBtn.style.marginRight = '5px';\n    presetFitBtn.style.marginRight = '5px';\n    presetOversizeBtn.style.marginRight = '5px';\n    presetLandscapeBtn.style.marginTop = '5px';\n    presetLandscapeBtn.style.marginRight = '5px';\n    presetPortraitBtn.style.marginTop = '5px';\n    presetPortraitBtn.style.marginRight = '5px';\n\n    templateWrapper.append(\n        presetCurrentBtn,\n        presetFitBtn,\n        presetOversizeBtn,\n        presetSquareBtn,\n        presetLandscapeBtn,\n        presetPortraitBtn\n    );\n\n    const templatePadding = 0;\n\n    presetCurrentBtn.onclick = function (): void {\n        widthInput.value = '' + canvasWidth;\n        heightInput.value = '' + canvasHeight;\n        updateRatio();\n    };\n    presetFitBtn.onclick = function (): void {\n        widthInput.value = '' + workspaceWidth;\n        heightInput.value = '' + workspaceHeight;\n        updateRatio();\n    };\n    presetOversizeBtn.onclick = function (): void {\n        widthInput.value = '' + (workspaceWidth + 500);\n        heightInput.value = '' + (workspaceHeight + 500);\n        updateRatio();\n    };\n    presetSquareBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetLandscapeBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetPortraitBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n\n    const select = new Select({\n        isFocusable: true,\n        optionArr: [\n            ['screen', LANG('new-screen')],\n            ['16 9', LANG('new-video') + ' 16:9'],\n            ['3 2', '3:2'],\n            ['5 3', '5:3'],\n            ['2 1', '2:1'],\n            ['paper', LANG('new-din-paper') + ' 2:1'],\n            ['9 16', '9:16'],\n            ['2 3', '2:3'],\n            ['3 5', '3:5'],\n            ['1 2', '1:2'],\n            ['1 1.4142135623730951', '1:2'],\n        ],\n        onChange: function (val): void {\n            if (val === 'screen') {\n                widthInput.value = '' + window.screen.width;\n                heightInput.value = '' + window.screen.height;\n            } else if (val === 'paper') {\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            } else {\n                const split = val.split(' ');\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            }\n            updateRatio();\n            select.setValue(undefined);\n        },\n    });\n    setTimeout(() => {\n        // safari: not empty without also setting it to null via timeout\n        select.setValue(undefined);\n    }, 0);\n    BB.css(select.getElement(), {\n        width: '80px',\n    });\n    templateWrapper.append(select.getElement());\n\n\n\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\n\n    const colorOptionsArr = [\n        {r: 255, g: 255, b: 255, a: 1},\n        {r: 0, g: 0, b: 0, a: 1},\n        {r: 0, g: 0, b: 0, a: 0},\n        {\n            r: currentColor.r,\n            g: currentColor.g,\n            b: currentColor.b,\n            a: 1,\n        },\n        {\n            r: secondaryColor.r,\n            g: secondaryColor.g,\n            b: secondaryColor.b,\n            a: 1,\n        },\n    ];\n    let initColorIndex = 0;\n    if (theme.isDark()) {\n        colorOptionsArr.forEach((item, index) => {\n            if (item.r === ERASE_COLOR && item.g === ERASE_COLOR && item.b === ERASE_COLOR) {\n                initColorIndex = index;\n                backgroundRGBA = item;\n            }\n        });\n    }\n\n    const colorOptions = new ColorOptions({\n        colorArr: colorOptionsArr,\n        initialIndex: initColorIndex,\n        onChange: function (rgbaObj): void {\n            backgroundRGBA = rgbaObj!;\n            preview.style.backgroundColor = 'rgba(' + rgbaObj!.r + ',' + rgbaObj!.g + ',' + rgbaObj!.b + ', ' + rgbaObj!.a + ')';\n        },\n    });\n\n    const previewWrapper = BB.el({\n        className: 'kl-transparent-preview',\n        css: {\n            boxSizing: 'border-box',\n            width: '340px',\n            height: '140px',\n            display: 'table',\n            padding: '10px',\n            marginTop: '10px',\n            marginLeft: '-20px',\n        },\n    });\n    const preview = BB.el({\n        className: 'kl-transparent-preview__canvas',\n        css: {\n            width: 200 + 'px',\n            height: 100 + 'px',\n            backgroundColor: 'rgba(' + backgroundRGBA.r + ',' + backgroundRGBA.g + ',' + backgroundRGBA.b + ', ' + backgroundRGBA.a + ')',\n            marginLeft: 'auto',\n            marginRight: 'auto',\n            color: '#aaa',\n            fontSize: '16px',\n            fontWeight: 'bold',\n            textAlign: 'center',\n            verticalAlign: 'center',\n            display: 'table',\n            overflow: 'hidden',\n        },\n    });\n    BB.el({\n        parent: previewWrapper,\n        content: preview,\n        css: {\n            display: 'table-cell',\n            verticalAlign: 'middle',\n        },\n    });\n    BB.el({\n        parent: preview,\n        css: {\n            display: 'table-cell',\n            verticalAlign: 'middle',\n        },\n    });\n\n    function updateRatio (): void {\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\n\n        function hcf (u: number, v: number): number {\n            let U = u, V = v;\n            // eslint-disable-next-line no-constant-condition\n            while (true) {\n                if (!(U %= V)) {\n                    return V;\n                }\n                if (!(V %= U)) {\n                    return U;\n                }\n            }\n        }\n\n        let w = parseInt(widthInput.value);\n        let h = parseInt(heightInput.value);\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\n            if (w > maxCanvasSize) {\n                w = maxCanvasSize;\n            } else if (h > maxCanvasSize) {\n                h = maxCanvasSize;\n            }\n\n            widthInput.value = '' + w;\n            heightInput.value = '' + h;\n        }\n\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\n        const commonRatios = [\n            [1, 2], [2, 1],\n            [2, 3], [3, 2],\n            [3, 4], [4, 3],\n            [4, 5], [5, 4],\n            [16, 9], [9, 16],\n            [3, 2], [2, 3],\n            [5, 3], [3, 5],\n            [2, 1], [1, 2],\n            [1.414, 1], [1, 1.414],\n        ];\n        const reducedArr = BB.reduce(w, h);\n        let closestRatio = commonRatios[0];\n        let closestDistance = Math.abs(commonRatios[0][0] / commonRatios[0][1] - reducedArr[0] / reducedArr[1]);\n        for (let i = 0; i < commonRatios.length; i++) {\n            if (Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\n                closestRatio = commonRatios[i];\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\n            }\n        }\n        //display ratio\n        if (closestDistance > 0 && closestDistance < 0.005) {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\n        } else {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\n        }\n\n        const realw = w;\n        const T = hcf(w, h);\n        w /= T;\n        h /= T;\n        w *= 260;\n        h *= 260;\n        if (w > 260) {\n            h = 260 / w * h;\n            w = 260;\n        }\n        if (h > 100) {\n            w = 100 / h * w;\n            h = 100;\n\n        }\n\n        preview.style.width = w + 'px';\n        preview.style.height = h + 'px';\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\n            previewWrapper.style.background = 'url(' + url + ')';\n        }, theme.isDark());\n    }\n    theme.addIsDarkListener(updateRatio);\n\n    widthInput.onchange = (): void => {\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\n            widthInput.value = '1';\n        }\n        updateRatio();\n    };\n    widthInput.onkeyup = (): void => {\n        updateRatio();\n    };\n    heightInput.onchange = (): void => {\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\n            heightInput.value = '1';\n        }\n        updateRatio();\n    };\n    heightInput.onkeyup = (): void => {\n        updateRatio();\n    };\n    updateRatio();\n\n    newImDiv.append(templateWrapper);\n    const secondRow = BB.el({\n        parent: newImDiv,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'flex-end',\n        },\n    });\n    const secondRowLeft = BB.el({\n        parent: secondRow,\n    });\n    secondRowLeft.append(sizeTable, ratioWrapper);\n    secondRow.append(colorOptions.getElement());\n\n    newImDiv.append(previewWrapper);\n\n    showModal({\n        target: document.body,\n        message: `<b>${LANG('new-title')}</b>`,\n        div: newImDiv,\n        buttons: ['Ok', 'Cancel'],\n        callback: function (result) {\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\n\n            BB.unsetEventHandler(presetCurrentBtn, 'onclick');\n            BB.unsetEventHandler(presetFitBtn, 'onclick');\n            BB.unsetEventHandler(presetOversizeBtn, 'onclick');\n            BB.unsetEventHandler(presetSquareBtn, 'onclick');\n            BB.unsetEventHandler(presetLandscapeBtn, 'onclick');\n            BB.unsetEventHandler(presetPortraitBtn, 'onclick');\n\n            select.destroy();\n            colorOptions.destroy();\n            theme.removeIsDarkListener(updateRatio);\n\n            if (\n                result === 'Cancel'\n                || parseInt(widthInput.value) <= 0\n                || parseInt(heightInput.value) <= 0\n                || isNaN(parseInt(widthInput.value))\n                || isNaN(parseInt(heightInput.value))\n            ) {\n                onCancel();\n                return;\n            }\n            onConfirm(\n                parseInt(widthInput.value),\n                parseInt(heightInput.value),\n                backgroundRGBA\n            );\n        },\n        clickOnEnter: 'Ok',\n    });\n\n}","import {BB} from '../../../bb/bb';\n\nexport function table (\n    data: (HTMLElement | string)[][],\n    cellProps?: Record<string, {rowspan: number}>, // {'0.2': {...}} -> row 1, col 3\n): HTMLElement {\n    const result = BB.el({\n        tagName: 'table',\n        className: 'kl-table',\n    });\n    data.forEach((row, rowIndex) => {\n        const rowEl = BB.el({\n            tagName: 'tr',\n        });\n        rowEl.append(...row.map((el, colIndex) => {\n            const cellEl = BB.el({\n                tagName: 'td',\n                content: el,\n            });\n\n            const key = rowIndex + '.' + colIndex;\n            if (cellProps !== undefined && key in cellProps) {\n                cellEl.rowSpan = cellProps[key].rowspan;\n            }\n\n            return cellEl;\n        }));\n        result.append(rowEl);\n    });\n    return result;\n}","import {BB} from '../../../bb/bb';\nimport collapseImg from '/src/app/img/ui/ui-collapse.svg';\nimport {LANG} from '../../../language/language';\nimport {TUiLayout} from '../../kl-types';\n\n/**\n * button that allows to collapse toolspace (for mobile)\n */\nexport class ToolspaceCollapser {\n\n    private readonly rootEl: HTMLElement;\n    private directionStr: TUiLayout;\n    private readonly icon: HTMLElement;\n    private stateIsOpen: boolean;\n\n\n    private update (): void {\n        if (this.directionStr === 'left') {\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\n        } else {\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\n        }\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            onChange: () => void;\n        }\n    ) {\n        this.stateIsOpen = true;\n        this.directionStr = 'right';\n\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-toggle',\n            css: {\n                width: '36px',\n                height: '36px',\n                background: 'rgba(100, 100, 100, 0.9)',\n                color: '#fff',\n                position: 'absolute',\n                top: '0',\n                textAlign: 'center',\n                lineHeight: '36px',\n                cursor: 'pointer',\n                userSelect: 'none',\n                padding: '6px',\n                boxSizing: 'border-box',\n            },\n            title: LANG('toggle-show-tools'),\n            onClick: (e) => {\n                e.preventDefault();\n                this.stateIsOpen = !this.stateIsOpen;\n                this.update();\n                p.onChange();\n            },\n        });\n\n        this.icon = BB.el({\n            parent: this.rootEl,\n            css: {\n                backgroundImage: `url(${collapseImg})`,\n                width: '100%',\n                height: '100%',\n                backgroundSize: 'contain',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n    }\n\n    // ---- interface ----\n\n    isOpen (): boolean {\n        return this.stateIsOpen;\n    }\n\n    setDirection (dirStr: TUiLayout): void {\n        this.directionStr = dirStr;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"ui-collapse.a786a8db.svg\" + \"?\" + Date.now();","import {BB} from '../../../../bb/bb';\nimport { TRenderTextParam} from '../../../image-operations/render-text';\nimport {showModal} from '../base/showModal';\nimport {IRGB} from '../../../kl-types';\nimport {KlCanvas} from '../../../canvas/kl-canvas';\nimport {LANG} from '../../../../language/language';\nimport {TextToolFillUI} from './text-tool-fill-ui';\nimport {TextToolFontUI} from './text-tool-font-ui';\nimport {TextToolStrokeUI} from './text-tool-stroke-ui';\nimport {TextToolTextUI} from './text-tool-text-ui';\nimport {TextToolViewportUI} from './text-tool-viewport-ui';\nimport * as classes from './text-tool-dialog.module.scss';\nimport {c} from '../../../../bb/base/c';\nimport {css} from '@emotion/css';\nimport {TabRow} from '../../components/tab-row';\n\nexport function textToolDialog (\n    p: {\n        klCanvas: KlCanvas;\n        layerIndex: number;\n        primaryColor: IRGB;\n        secondaryColor: IRGB;\n\n        text: TRenderTextParam;\n        onConfirm: (confirmP: TRenderTextParam) => void;\n\n    }\n): void {\n    const rootEl = BB.el({});\n    let text = BB.copyObj(p.text);\n\n    const viewportWrapper = BB.el({\n        className: classes.viewportWrapper,\n    });\n\n    const viewportUI = new TextToolViewportUI({\n        text: text,\n        klCanvas: p.klCanvas,\n        layerIndex: p.layerIndex,\n        onDragEnd: () => tabs.getOpenedTabId() === 'text' ? textUI.focus() : 0,\n    });\n    viewportUI.render();\n\n    function onUpdate (p: Partial<TRenderTextParam>) {\n        text = {\n            ...text,\n            ...p,\n        };\n        viewportUI.setText(text);\n    }\n\n    const fontUI = new TextToolFontUI({\n        ...text,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n\n    const colorWrapper = BB.el({\n        css: {\n            display: 'flex',\n            gap: '10px',\n            flexDirection: 'column',\n        },\n    });\n    const fillUI = new TextToolFillUI({\n        fill: text.fill,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n    const strokeUI = new TextToolStrokeUI({\n        stroke: text.stroke,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n    const textUI = new TextToolTextUI({\n        text: text.text,\n        onUpdate: (p) => {\n            p.text !== undefined && modal.setIgnoreBackground(p.text.length > 0);\n            onUpdate(p);\n        },\n    });\n\n    const tabs = new TabRow({\n        initialId: 'text',\n        height: 40,\n        tabArr: [\n            {\n                id: 'text',\n                label: LANG('text-text'),\n                onOpen: () => {\n                    textUI.getElement().style.display = '';\n                    textUI.focus();\n                },\n                onClose: () => {\n                    textUI.getElement().style.display = 'none';\n                },\n            },\n            {\n                id: 'font',\n                label: LANG('text-font'),\n                onOpen: () => {\n                    fontUI.getElement().style.display = 'flex';\n                },\n                onClose: () => {\n                    fontUI.getElement().style.display = 'none';\n                },\n            },\n            {\n                id: 'color',\n                label: LANG('text-color'),\n                onOpen: () => {\n                    colorWrapper.style.display = 'flex';\n                },\n                onClose: () => {\n                    colorWrapper.style.display = 'none';\n                },\n            },\n        ],\n    });\n    tabs.getElement().classList.add(css({\n        minWidth: '200px',\n        maxWidth: '500px',\n        flexGrow: '1',\n        borderBottom: 'none !important',\n    }));\n\n    const viewportInputsCss = css({\n        position: 'relative',\n        '>*': {\n            position: 'absolute',\n            right: 0,\n            top: 10,\n        },\n    });\n\n    const tabWrapperCss = css({\n        display: 'flex',\n        justifyContent: 'space-between',\n        flexDirection: 'row-reverse',\n        flexWrap: 'wrap',\n        marginTop: '10px',\n        marginLeft: '-20px',\n        marginRight: '-20px',\n        padding: '0 20px',\n        '@media (min-width: 700px) and (min-height: 700px)': {\n            display: 'none !important',\n        },\n    });\n\n\n\n    const inputsCss = css({\n        minHeight: 72,\n        marginTop: '10px',\n        '@media (min-width: 700px) and (min-height: 700px)': {\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '10px',\n            '>*': {\n                display: 'flex !important',\n            },\n        },\n    });\n\n    rootEl.append(c('', [\n        c(viewportWrapper, [viewportUI.getElement()]),\n        c('.' + viewportInputsCss, [viewportUI.getInputsElement()]),\n        c('.tabrow.' + tabWrapperCss, [\n            c(',w-240,h-40'),\n            tabs.getElement(),\n        ]),\n\n        c('.' + inputsCss, [\n            c(colorWrapper, [\n                fillUI.getElement(),\n                strokeUI.getElement(),\n            ]),\n            fontUI.getElement(),\n            textUI.getElement(),\n        ]),\n    ]));\n\n\n\n    const onResize = () => {\n        const b = viewportWrapper.getBoundingClientRect();\n        const w = Math.ceil(b.width);\n        const h = Math.ceil(b.height);\n        viewportUI.setSize(w, h);\n    };\n    window.addEventListener('resize', onResize);\n    setTimeout(() => {\n        onResize();\n    });\n    setTimeout(() => {\n        textUI.focus();\n    }, 100);\n\n\n    // prevent mobile keyboards scrolling page\n    function onScroll (): void {\n        window.scrollTo(0, 0);\n    }\n    window.addEventListener('scroll', onScroll);\n\n    const onModalExit = (val: string) => {\n        window.removeEventListener('resize', onResize);\n        window.removeEventListener('scroll', onScroll);\n        viewportUI.destroy();\n        fontUI.destroy();\n        fillUI.destroy();\n        strokeUI.destroy();\n        textUI.destroy();\n        tabs.destroy();\n\n        if (val === 'Ok') {\n            p.onConfirm({\n                ...viewportUI.getValues(),\n                ...fontUI.getValues(),\n                ...fillUI.getValues(),\n                ...strokeUI.getValues(),\n                ...textUI.getValues(),\n            });\n        }\n    };\n\n\n    const modal = showModal({\n        target: document.body,\n        message: `<b>${LANG('text-title')}</b>`,\n        div: rootEl,\n        buttons: ['Ok', 'Cancel'],\n        ignoreBackground: p.text.text.length > 0,\n        callback: onModalExit,\n        style: {\n            width: 'calc(100% - 50px)',\n            maxWidth: '1000px',\n            minWidth: '300px',\n            boxSizing: 'border-box',\n        },\n        clickOnEnter: 'Ok',\n    });\n}\n","import {TRenderTextParam} from '../../../image-operations/render-text';\nimport {IRGB, IRGBA} from '../../../kl-types';\nimport {ColorOptions} from '../../components/color-options';\nimport {KlSlider} from '../../components/kl-slider';\nimport {LANG} from '../../../../language/language';\nimport {c} from '../../../../bb/base/c';\nimport {createSvg} from '../../../../bb/base/base';\n\ntype TFillParams = Pick<\n    TRenderTextParam,\n    'fill'\n>;\n\nexport type TFillUIParams = TFillParams & {\n    primaryColor: IRGB;\n    secondaryColor: IRGB;\n    onUpdate: (v: Partial<TFillParams>) => void;\n};\n\nexport class TextToolFillUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly colorOptions: ColorOptions;\n    private readonly opacitySlider: KlSlider;\n\n\n    // ---- public ----\n    constructor (p: TFillUIParams) {\n\n        const emit = (): void => {\n            p.onUpdate(this.getValues());\n        };\n\n        const colorOptionsArr: (IRGBA | null)[] = [\n            null,\n            p.fill ? {\n                ...p.fill.color,\n                a: 1,\n            } : null,\n            {\n                ...p.primaryColor,\n                a: 1,\n            },\n            {\n                ...p.secondaryColor,\n                a: 1,\n            },\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n\n        this.colorOptions = new ColorOptions({\n            colorArr: colorOptionsArr,\n            initialIndex: p.fill ? 1 : 0,\n            title: LANG('shape-fill'),\n            onChange: (c) => {\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\n                emit();\n            },\n        });\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 150,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: p.fill ? p.fill.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: () => emit(),\n        });\n        this.opacitySlider.getElement().style.display = p.fill ? '' : 'none';\n\n        const svg = createSvg({\n            elementType: 'svg',\n            class: 'dark-invert',\n            width: '25px',\n            height: '25px',\n            viewBox: '0 0 30 30',\n\n            childrenArr: [\n                {\n                    elementType: 'polyline',\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\n                    'transform-origin': '15px 15px',\n                    transform: 'scale(0.8)',\n                    fill: '#000c',\n                },\n            ],\n        });\n\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n        ]);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TFillParams {\n        const c = this.colorOptions.getValue();\n        if (c === null || c?.a === 0) {\n            return {\n                fill: undefined,\n            };\n        }\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue(),\n        };\n        return {\n            fill: {\n                color,\n            },\n        };\n    }\n\n    destroy (): void {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n    }\n}","import {BB} from '../../../../bb/bb';\nimport {TRenderTextParam, TTextFormat} from '../../../image-operations/render-text';\nimport {Input} from '../../components/input';\nimport {LANG} from '../../../../language/language';\nimport {ImageRadioList} from '../../components/image-radio-list';\nimport alignLeftImg from '/src/app/img/ui/align-left.svg';\nimport alignCenterImg from '/src/app/img/ui/align-center.svg';\nimport alignRightImg from '/src/app/img/ui/align-right.svg';\nimport typoItalicImg from '/src/app/img/ui/typo-italic.svg';\nimport typoBoldImg from '/src/app/img/ui/typo-bold.svg';\nimport {ImageToggle} from '../../components/image-toggle';\nimport {Select} from '../../components/select';\nimport {c} from '../../../../bb/base/c';\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\nimport {fonts} from '../../../../../fonts/fonts';\n\ntype TFontParams = Pick<\n    TRenderTextParam,\n    'font' | 'size' | 'letterSpacing' | 'lineHeight' | 'align' | 'isItalic' | 'isBold'\n>;\n\nexport type TFontUIParams = TFontParams & {\n    onUpdate: (v: Partial<TFontParams>) => void;\n};\n\n\nconst importedFonts: {\n    fontFamily: string;\n    fontName: string; // visible to user\n}[] = [\n    {fontFamily: 'sans-serif', fontName: 'Sans-serif'},\n    {fontFamily: 'serif', fontName: 'Serif'},\n    {fontFamily: 'monospace', fontName: 'Monospace'},\n    {fontFamily: 'cursive', fontName: 'Cursive'},\n    {fontFamily: 'fantasy', fontName: 'Fantasy'},\n    ...fonts.map(item => {\n        return {\n            fontFamily: item.name,\n            fontName: item.name,\n        };\n    }),\n];\n\nlet didLoadBundledFonts = false;\nasync function loadBundledFonts (): Promise<void> {\n    if (didLoadBundledFonts) {\n        return;\n    }\n    didLoadBundledFonts = true;\n    const promises: Promise<void>[] = [];\n    for (let i = 0; i < fonts.length; i++) {\n        promises.push((async () => {\n            const item = fonts[i];\n            const response = await fetch(item.url);\n            const buffer = await response.arrayBuffer();\n            const font = new FontFace(item.name, buffer);\n            document.fonts.add(font);\n        })());\n    }\n    await Promise.all(promises);\n}\n\nexport class TextToolFontUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly fontSelect: Select<string>;\n    private readonly fontPointerListener: PointerListener;\n\n    private readonly importButton: HTMLButtonElement;\n\n    private readonly sizeInput: Input;\n    private readonly lineHeightInput: Input;\n    private readonly letterSpacingInput: Input;\n\n    private readonly alignRadioList: ImageRadioList<TTextFormat>;\n    private readonly italicToggle: ImageToggle;\n    private readonly boldToggle: ImageToggle;\n\n    private readonly onUpdate: (v: Partial<TFontParams>) => void;\n    private readonly onFocus: () => void;\n\n    // only load fonts when interacting with the font input\n    private loadBundledFonts (): void {\n        !didLoadBundledFonts && loadBundledFonts().then(() => {\n            this.onUpdate({\n                font: this.fontSelect.getValue(),\n            });\n        });\n    }\n\n    private importFont (): void {\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.multiple = true;\n        input.accept = '.ttf, .otf, .woff, .woff2, .eot';\n        input.focus();\n        input.click();\n        input.onchange = async () => {\n            if (!input.files || input.files.length === 0) {\n                return;\n            }\n            let toSelect: string | undefined = undefined;\n\n            const fontFamilies = importedFonts.map(i => i.fontFamily);\n            for (let i = 0; i < input.files.length; i++) {\n                const file = input.files[i];\n                const fontName = 'kl-' + importedFonts.length;\n                if (fontFamilies.includes(fontName)) {\n                    continue;\n                }\n                if (!toSelect) {\n                    toSelect = fontName;\n                    this.importButton.disabled = true;\n                    this.importButton.innerText = LANG('loading');\n                }\n\n                const split = file.name.split('.');\n                split.pop();\n\n                importedFonts.push({\n                    fontFamily: fontName,\n                    fontName: split.join('.'),\n                });\n                const font = new FontFace(fontName, await file.arrayBuffer());\n                document.fonts.add(font);\n            }\n\n            // update font selection\n            setTimeout(() => {\n                this.fontSelect.setOptionArr(importedFonts.map(i => {\n                    return [\n                        i.fontFamily,\n                        i.fontName,\n                        {\n                            css: {\n                                fontFamily: i.fontFamily,\n                                fontSize: '1.2em',\n                            },\n                        },\n                    ];\n                }));\n                this.fontSelect.setValue(toSelect);\n                this.onUpdate({\n                    font: toSelect,\n                });\n                this.importButton.disabled = false;\n                this.importButton.innerText = LANG('file-import');\n            });\n        };\n    }\n\n\n    // ---- public ----\n    constructor (p: TFontUIParams) {\n        this.onUpdate = p.onUpdate;\n\n        this.fontSelect = new Select<string>({\n            initValue: p.font,\n            optionArr: importedFonts.map(i => {\n                return [\n                    i.fontFamily,\n                    i.fontName,\n                    {\n                        css: {\n                            fontFamily: i.fontFamily,\n                            fontSize: '1.2em',\n                        },\n                    },\n                ];\n            }),\n            isFocusable: true,\n            css: {\n                width: '180px',\n            },\n            onChange: (v) => {\n                this.loadBundledFonts();\n                p.onUpdate({\n                    font: v,\n                });\n            },\n        });\n        this.onFocus = () => this.loadBundledFonts();\n        this.fontSelect.getElement().addEventListener('focus', this.onFocus);\n        this.fontPointerListener = new BB.PointerListener({\n            target: this.fontSelect.getElement(),\n            onWheel: (e) => this.fontSelect.setDeltaValue(e.deltaY),\n        });\n\n        this.importButton = BB.el({\n            tagName: 'button',\n            content: LANG('file-import'),\n            onClick: () => {\n                this.importFont();\n            },\n        });\n\n        const sizeLabel = BB.el({\n            content: '<div><span style=\"font-size: 0.6em; margin-right: -1px\">A</span>A</div>',\n            css: {\n                width: '25px',\n                height: '25px',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                fontSize: '1.2em',\n                userSelect: 'none',\n            },\n        });\n        this.sizeInput = new Input({\n            title: LANG('text-size'),\n            type: 'number',\n            min: 0,\n            max: 1000,\n            init: p.size,\n            onChange: (v) => {\n                p.onUpdate({\n                    size: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '70px',\n            },\n        });\n\n        this.lineHeightInput = new Input({\n            label: LANG('text-line-height'),\n            type: 'number',\n            min: 0,\n            max: 10,\n            step: 0.1,\n            init: p.lineHeight ?? 1,\n            onChange: (v) => {\n                p.onUpdate({\n                    lineHeight: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '60px',\n            },\n        });\n\n        this.letterSpacingInput = new Input({\n            label: LANG('text-letter-spacing'),\n            type: 'number',\n            min: -100,\n            max: 100,\n            init: p.letterSpacing ?? 0,\n            onChange: (v) => {\n                p.onUpdate({\n                    letterSpacing: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '60px',\n            },\n        });\n\n\n\n        this.alignRadioList = new ImageRadioList<TTextFormat>({\n            optionArr: [\n                {\n                    id: 'left',\n                    title: LANG('text-left'),\n                    image: alignLeftImg,\n                    darkInvert: true,\n                },\n                {\n                    id: 'center',\n                    title: LANG('text-center'),\n                    image: alignCenterImg,\n                    darkInvert: true,\n                },\n                {\n                    id: 'right',\n                    title: LANG('text-right'),\n                    image: alignRightImg,\n                    darkInvert: true,\n                },\n            ],\n            initId: p.align,\n            onChange: (v) => p.onUpdate({\n                align: v,\n            }),\n        });\n\n        this.italicToggle = new ImageToggle({\n            image: typoItalicImg,\n            title: LANG('text-italic'),\n            initValue: p.isItalic,\n            onChange: (v) => p.onUpdate({\n                isItalic: v,\n            }),\n            darkInvert: true,\n        });\n\n        this.boldToggle = new ImageToggle({\n            image: typoBoldImg,\n            title: LANG('text-bold'),\n            initValue: p.isBold,\n            onChange: (v) => p.onUpdate({\n                isBold: v,\n            }),\n            darkInvert: true,\n        });\n\n        this.rootEl = c(',flex,flexWrap,gap-10-15,items-center', [\n            c(',flex,gap-5,items-center', [\n                sizeLabel,\n                this.sizeInput.getElement(),\n            ]),\n            c(',flex,gap-5', [\n                this.fontSelect.getElement(),\n                this.importButton,\n            ]),\n            c(',flex,gap-7', [\n                this.alignRadioList.getElement(),\n                this.italicToggle.getElement(),\n                this.boldToggle.getElement(),\n            ]),\n            this.letterSpacingInput.getElement(),\n            this.lineHeightInput.getElement(),\n        ]);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TFontParams {\n        return {\n            font: this.fontSelect.getValue(),\n            size: +this.sizeInput.getValue(),\n            letterSpacing: +this.letterSpacingInput.getValue(),\n            lineHeight: +this.lineHeightInput.getValue(),\n            align: this.alignRadioList.getValue(),\n            isItalic: this.italicToggle.getValue(),\n            isBold: this.boldToggle.getValue(),\n        };\n    }\n\n    destroy (): void {\n        this.fontPointerListener.destroy();\n        this.fontSelect.getElement().removeEventListener('focus', this.onFocus);\n        this.fontSelect.destroy();\n        BB.destroyEl(this.importButton);\n        this.sizeInput.destroy();\n        this.lineHeightInput.destroy();\n        this.letterSpacingInput.destroy();\n        this.alignRadioList.destroy();\n        this.italicToggle.destroy();\n        this.boldToggle.destroy();\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"align-left.1cd0ddfe.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"align-center.91068397.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"align-right.fe8f26ce.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"typo-italic.9b78c576.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"typo-bold.c02eed23.svg\" + \"?\" + Date.now();","import fontCaveat from 'url:./Caveat-Regular.woff2';\nimport fontClimateCrisis from 'url:./ClimateCrisis-Regular-VariableFont_YEAR.woff2';\nimport fontCorrectionBrush from 'url:./CorrectionBrush.woff2';\nimport fontDancingScript from 'url:./DancingScript-Regular.woff2';\nimport fontDiabolik from 'url:./Diabolik-Regular-VF.woff2';\nimport fontFreckleFace from 'url:./FreckleFace-Regular.woff2';\nimport fontGloock from 'url:./Gloock-Regular.woff2';\nimport fontPacha from 'url:./Pacha.woff2';\nimport fontGochiHand from 'url:./GochiHand-Regular.woff2';\nimport fontPassionOne from 'url:./PassionOne-Bold.woff2';\nimport fontPixeloidSans from 'url:./PixeloidSans.woff2';\nimport fontPlaypenSans from 'url:./PlaypenSans-Thin.woff2';\nimport fontQuicksandLight from 'url:./Quicksand-Light.woff2';\nimport fontSilkscreen from 'url:./Silkscreen-Regular.woff2';\nimport fontTehroc from 'url:./Tehroc-Regular.woff2';\nimport fontYunga from 'url:./YUNGA-Display.woff2';\n\nexport const fonts: {\n    name: string;\n    url: string;\n}[] = [\n    { name: 'Caveat', url: fontCaveat },\n    { name: 'ClimateCrisis', url: fontClimateCrisis },\n    { name: 'CorrectionBrush', url: fontCorrectionBrush },\n    { name: 'DancingScript', url: fontDancingScript },\n    { name: 'Diabolik', url: fontDiabolik },\n    { name: 'FreckleFace', url: fontFreckleFace },\n    { name: 'Gloock', url: fontGloock },\n    { name: 'GochiHand', url: fontGochiHand },\n    { name: 'Pacha', url: fontPacha },\n    { name: 'PassionOne', url: fontPassionOne },\n    { name: 'PixeloidSans', url: fontPixeloidSans },\n    { name: 'PlaypenSans', url: fontPlaypenSans },\n    { name: 'Quicksand', url: fontQuicksandLight },\n    { name: 'Silkscreen', url: fontSilkscreen },\n    { name: 'Tehroc', url: fontTehroc },\n    { name: 'YUNGA', url: fontYunga },\n];\n\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Caveat-Regular.82781654.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"ClimateCrisis-Regular-VariableFont_YEAR.4b717a97.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"CorrectionBrush.7e93d053.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"DancingScript-Regular.6a9980f0.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Diabolik-Regular-VF.998fc076.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"FreckleFace-Regular.dcda4608.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Gloock-Regular.d8de80e9.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Pacha.cb11bfd1.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"GochiHand-Regular.18c88720.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"PassionOne-Bold.188f3581.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"PixeloidSans.7fcd9812.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"PlaypenSans-Thin.c554a6eb.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Quicksand-Light.d3279d6f.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Silkscreen-Regular.cf20f5aa.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"Tehroc-Regular.7c6f6c4e.woff2\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"YUNGA-Display.08d6be9f.woff2\" + \"?\" + Date.now();","import {BB} from '../../../../bb/bb';\nimport {TRenderTextParam} from '../../../image-operations/render-text';\nimport {IRGB, IRGBA} from '../../../kl-types';\nimport {ColorOptions} from '../../components/color-options';\nimport {KlSlider} from '../../components/kl-slider';\nimport {LANG} from '../../../../language/language';\nimport {c} from '../../../../bb/base/c';\nimport {createSvg} from '../../../../bb/base/base';\n\ntype TStrokeParams = Pick<\n    TRenderTextParam,\n    'stroke'\n>;\n\nexport type TStrokeUIParams = TStrokeParams & {\n    primaryColor: IRGB;\n    secondaryColor: IRGB;\n    onUpdate: (v: Partial<TStrokeParams>) => void;\n};\n\nexport class TextToolStrokeUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly colorOptions: ColorOptions;\n    private readonly opacitySlider: KlSlider;\n    private readonly lineWidthSlider: KlSlider;\n\n\n\n    // ---- public ----\n    constructor (p: TStrokeUIParams) {\n\n\n\n        this.rootEl = BB.el({\n            css: {\n                boxShadow: '0 0 0 1px #aaa',\n            },\n        });\n\n        const emit = (): void => {\n            p.onUpdate(this.getValues());\n        };\n\n        const colorOptionsArr: (IRGBA | null)[] = [\n            null,\n            p.stroke ? {\n                ...p.stroke.color,\n                a: 1,\n            } : null,\n            {\n                ...p.secondaryColor,\n                a: 1,\n            },\n            {\n                ...p.primaryColor,\n                a: 1,\n            },\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1},\n        ];\n\n        this.colorOptions = new ColorOptions({\n            colorArr: colorOptionsArr,\n            initialIndex: p.stroke ? 1 : 0,\n            title: LANG('shape-stroke'),\n            onChange: (c) => {\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\n                this.lineWidthSlider.getElement().style.display = c !== null ? '' : 'none';\n                emit();\n            },\n        });\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 150,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: p.stroke ? p.stroke.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: () => emit(),\n        });\n\n        this.lineWidthSlider = new KlSlider({\n            label: LANG('shape-line-width'),\n            width: 150,\n            height: 30,\n            min: 0.5,\n            max: 100,\n            value: p.stroke ? p.stroke.lineWidth : 2,\n            eventResMs: 1000 / 30,\n            curve: 'quadratic',\n            onChange: () => emit(),\n        });\n\n        this.opacitySlider.getElement().style.display = p.stroke ? '' : 'none';\n        this.lineWidthSlider.getElement().style.display = p.stroke ? '' : 'none';\n\n        const svg = createSvg({\n            elementType: 'svg',\n            class: 'dark-invert',\n            width: '25px',\n            height: '25px',\n            viewBox: '0 0 30 30',\n\n            childrenArr: [\n                {\n                    elementType: 'polyline',\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\n                    fill: 'none',\n                    stroke: '#000c',\n                    'stroke-width': '3',\n                    'transform-origin': '15px 15px',\n                    transform: 'scale(0.8)',\n                },\n            ],\n        });\n\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n            this.lineWidthSlider.getElement(),\n        ]);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TStrokeParams {\n        const c = this.colorOptions.getValue();\n        if (c === null || c?.a === 0) {\n            return {\n                stroke: undefined,\n            };\n        }\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue(),\n        };\n        return {\n            stroke: {\n                color,\n                lineWidth: this.lineWidthSlider.getValue(),\n            },\n        };\n    }\n\n    destroy (): void {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n        this.lineWidthSlider.destroy();\n    }\n}","import {TRenderTextParam} from '../../../image-operations/render-text';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport {c} from '../../../../bb/base/c';\n\ntype TTextParams = Pick<\n    TRenderTextParam,\n    'text'\n>;\n\nexport type TTextUIParams = TTextParams & {\n    onUpdate: (v: Partial<TTextParams>) => void;\n};\n\nexport class TextToolTextUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly textInput: HTMLTextAreaElement;\n    private lastEmittedText: string;\n    private readonly onUpdate: (v: Partial<TTextParams>) => void;\n\n    private readonly onInput = (): void => {\n        this.emit();\n    };\n\n    private emit (): void {\n        const text = this.textInput.value;\n        if (text === this.lastEmittedText) {\n            return;\n        }\n        this.lastEmittedText = text;\n        this.onUpdate({\n            text,\n        });\n    }\n\n    // ---- public ----\n    constructor (p: TTextUIParams) {\n        this.lastEmittedText = p.text;\n        this.onUpdate = p.onUpdate;\n\n        this.rootEl = c('');\n\n        this.textInput = BB.el({\n            tagName: 'textarea',\n            parent: this.rootEl,\n            content: p.text,\n            custom: {\n                placeholder: LANG('text-placeholder'),\n            },\n            css: {\n                whiteSpace: 'pre',\n                overflow: 'auto',\n                width: '100%',\n                height: '70px',\n                resize: 'vertical',\n            },\n            onChange: () => {\n                this.emit();\n            },\n        });\n\n        this.textInput.addEventListener('input', this.onInput);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TTextParams {\n        return {\n            text: this.textInput.value,\n        };\n    }\n\n    focus (): void {\n        this.textInput.focus();\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.textInput);\n        this.textInput.removeEventListener('input', this.onInput);\n    }\n}","import {BB} from '../../../../bb/bb';\nimport {throwIfNull} from '../../../../bb/base/base';\nimport {theme} from '../../../../theme/theme';\nimport {renderText, TRenderTextParam} from '../../../image-operations/render-text';\nimport {KlCanvas} from '../../../canvas/kl-canvas';\nimport {KlSlider} from '../../components/kl-slider';\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\nimport {LANG} from '../../../../language/language';\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\nimport {c} from '../../../../bb/base/c';\nimport {IVector2D} from '../../../../bb/bb-types';\nimport {KeyListener} from '../../../../bb/input/key-listener';\n\ntype TViewportParams = Pick<\n    TRenderTextParam,\n    'x' | 'y' | 'angleRad'\n>;\n\ntype TViewportUIParams = {\n    text: TRenderTextParam;\n    klCanvas: KlCanvas;\n    layerIndex: number;\n    onDragEnd: () => void;\n};\n\nexport class TextToolViewportUI {\n\n    private readonly rootEl: HTMLElement;\n    private readonly inputsRootEl: HTMLElement;\n    private readonly previewWrapper: HTMLElement;\n    private text: TRenderTextParam;\n    private offset: IVector2D = {x: 0, y: 0};\n    private interval: ReturnType<typeof setInterval> | undefined;\n\n    private width: number;\n    private height: number;\n    private zoomFac: number = 0;\n    private scale: number = 1;\n\n    private readonly layerArr: ReturnType<KlCanvas['getLayersFast']> = [];\n    private readonly layerIndex: number;\n\n    private readonly textCanvas: HTMLCanvasElement;\n    private readonly textCtx: CanvasRenderingContext2D;\n\n    private readonly targetCanvas: HTMLCanvasElement;\n    private readonly targetCtx: CanvasRenderingContext2D;\n\n    private readonly layersCanvas: HTMLCanvasElement;\n    private readonly layersCtx: CanvasRenderingContext2D;\n\n    private readonly previewCanvas: HTMLCanvasElement;\n    private readonly previewCtx: CanvasRenderingContext2D;\n\n    private readonly emptyCanvas: HTMLCanvasElement;\n    private readonly emptyCanvasLight: HTMLCanvasElement;\n\n    private checkerPattern: CanvasPattern;\n\n    private readonly rotationSlider: KlSlider;\n    private readonly zoomInBtn: HTMLButtonElement;\n    private readonly zoomOutBtn: HTMLButtonElement;\n\n    private readonly eventCapture: HTMLElement;\n\n    private readonly previewPointerListener: PointerListener;\n    private readonly keyListener: KeyListener;\n\n    private readonly onDarkChange = () => {\n        this.checkerPattern = throwIfNull(this.previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\n        this.render();\n    };\n\n    private canZoom (d: number): boolean {\n        return this.zoomFac !== Math.min(2, Math.max(-2, this.zoomFac + d));\n    }\n\n    private changeZoomFac (d: number): void {\n        this.zoomFac = Math.min(2, Math.max(-2, this.zoomFac + d));\n        this.render();\n        this.zoomInBtn.disabled = !this.canZoom(1);\n        this.zoomOutBtn.disabled = !this.canZoom(-1);\n    }\n\n    /** Move text by x y **/\n    private move (x: number, y: number): void {\n        const rotated = BB.rotate(x, y, -this.rotationSlider.getValue() / Math.PI * 180);\n        this.text.x += rotated.x / this.scale;\n        this.text.y += rotated.y / this.scale;\n        this.render();\n    }\n\n\n    // ---- public ----\n    constructor (p: TViewportUIParams) {\n        this.rootEl = c();\n        this.text = p.text;\n        this.layerIndex = p.layerIndex;\n\n        const isSmallWidth = window.innerWidth < 550;\n        const isSmallHeight = window.innerHeight < 630;\n\n        // --- preview ---\n        // Text drawn on klCanvas-sized canvas: textCanvas\n        // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\n        //      they are transformed. canvas size of final preview\n        // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\n        // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\n\n        this.width = isSmallWidth ? 340 : 540;\n        this.height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\n\n        this.layerArr = p.klCanvas.getLayersFast();\n        this.textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\n        this.textCtx = BB.ctx(this.textCanvas);\n        this.targetCanvas = BB.canvas(this.width, this.height);\n        this.targetCtx = BB.ctx(this.targetCanvas);\n        this.layersCanvas = BB.canvas(this.width, this.height);\n        this.layersCtx = BB.ctx(this.layersCanvas);\n        this.previewCanvas = BB.canvas(this.width, this.height); // the one that is visible\n        this.previewCtx = BB.ctx(this.previewCanvas);\n        BB.css(this.previewCanvas, {\n            display: 'block',\n        });\n        this.previewWrapper = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'relative',\n                width: this.width + 'px',\n                cursor: 'move',\n                touchAction: 'none',\n            },\n        });\n        BB.el({ // inset shadow on preview\n            parent: this.previewWrapper,\n            className: 'kl-text-preview-wrapper',\n        });\n        this.previewWrapper.append(this.previewCanvas);\n        this.checkerPattern = throwIfNull(this.previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\n        this.emptyCanvas = BB.canvas(1, 1);\n        this.emptyCanvasLight = BB.canvas(1, 1);\n        {\n            let ctx = BB.ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n\n            ctx = BB.ctx(this.emptyCanvasLight);\n            ctx.fillStyle = '#fff';\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        theme.addIsDarkListener(this.onDarkChange);\n\n        this.previewCanvas.oncontextmenu = (e) => e.preventDefault();\n        let dragged = false;\n        let isDown = false;\n        let offsetDragged = false;\n        this.previewPointerListener = new BB.PointerListener({\n            target: this.previewCanvas,\n            onPointer: (e) => {\n\n                // drag detect\n                if (e.type === 'pointerdown') {\n                    dragged = false;\n                    isDown = true;\n                }\n                if (e.type === 'pointermove' && isDown) {\n                    dragged = true;\n                }\n                if (e.type === 'pointerup') {\n                    if (isDown && dragged && e.pointerType === 'mouse') {\n                        // With touch/pen it would be annoying to focus again,\n                        // because it probably pops out the keyboard.\n                        p.onDragEnd();\n                    }\n                    dragged = false;\n                    isDown = false;\n                }\n\n\n\n                if (e.type === 'pointermove' && e.button === 'left') {\n                    e.eventPreventDefault();\n                    this.offset = {x: 0, y: 0};\n                    this.move(-e.dX, -e.dY);\n                }\n                if (e.type === 'pointerdown' && e.button === 'right') {\n                    document.body.append(this.eventCapture);\n                }\n                if (e.type === 'pointerup') {\n                    setTimeout(() => this.eventCapture.remove(), 20);\n                }\n                if (e.type === 'pointermove' && e.button === 'right') {\n                    offsetDragged = true;\n                    e.eventPreventDefault();\n                    this.offset.x -= e.dX;\n                    this.offset.y -= e.dY;\n                    this.render();\n                }\n                if (e.type === 'pointerup' && offsetDragged) {\n                    let count = 0;\n                    this.interval = setInterval(() => {\n                        if (count > 8) {\n                            clearInterval(this.interval);\n                            this.offset = {x: 0, y: 0};\n                            this.render();\n                        }\n                        this.offset = {x: this.offset.x * 0.6, y: this.offset.y * 0.6};\n                        this.render();\n                        count++;\n                    }, 10);\n\n                    this.offset = {x: this.offset.x * 0.6, y: this.offset.y * 0.6};\n                    this.render();\n                }\n            },\n            onWheel: (e) => {\n                this.changeZoomFac(-e.deltaY);\n            },\n        });\n\n        const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\n        this.previewCanvas.addEventListener('wheel', wheelPrevent);\n\n\n        this.rotationSlider = new KlSlider({\n            label: LANG('filter-transform-rotation'),\n            width: 150,\n            height: 30,\n            min: -Math.PI,\n            max: Math.PI,\n            value: p.text.angleRad,\n            resolution: 225,\n            // eventResMs: 1000 / 30,\n            toValue: (deg) => deg * Math.PI / 180,\n            toDisplayValue: (rad) => rad / Math.PI * 180,\n            onChange: () => {\n                this.offset = {x: 0, y: 0};\n                this.render();\n            },\n            unit: '',\n        });\n\n        this.zoomInBtn = BB.el({\n            tagName: 'button',\n            content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\n            title: LANG('zoom-in'),\n            onClick: () => this.changeZoomFac(1),\n            css: {\n                fontWeight: 'bold',\n            },\n        });\n        this.zoomOutBtn = BB.el({\n            tagName: 'button',\n            content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\n            title: LANG('zoom-out'),\n            onClick: () => this.changeZoomFac(-1),\n            css: {\n                fontWeight: 'bold',\n            },\n        });\n\n        this.eventCapture = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n                zIndex: '999',\n                cursor: 'move',\n            },\n        });\n        this.eventCapture.oncontextmenu = (e) => e.preventDefault();\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr) => {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n                const factor = this.keyListener.isPressed('shift') ? 4 : 1;\n                if (keyStr === 'left') {\n                    this.move(-factor, 0);\n                }\n                if (keyStr === 'right') {\n                    this.move(factor, 0);\n                }\n                if (keyStr === 'up') {\n                    this.move(0, -factor);\n                }\n                if (keyStr === 'down') {\n                    this.move(0, factor);\n                }\n            },\n        });\n\n        this.inputsRootEl = c(',flex,gap-5', [\n            this.rotationSlider.getElement(),\n            c(),\n            this.zoomInBtn,\n            this.zoomOutBtn,\n        ]);\n    }\n\n    render (): void {\n        // try to draw very much like klCanvasWorkspace\n\n        const angleRad = this.rotationSlider.getValue();\n\n        // --- draw text ---\n        this.textCtx.clearRect(0, 0, this.textCanvas.width, this.textCanvas.height);\n        const bounds = renderText(this.textCanvas, {\n            ...this.text,\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue(),\n        });\n\n        // transform offset\n        const transformedOffset = BB.Vec2.mul(\n            BB.rotate(this.offset.x, this.offset.y, -angleRad / Math.PI * 180),\n            1 / this.scale,\n        );\n\n        // --- determine transformation of viewport ---\n        // text should always be visible\n        bounds.width = Math.max(bounds.width, 1);\n        bounds.height = Math.max(bounds.height, 1);\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, -angleRad / Math.PI * 180);\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, -angleRad / Math.PI * 180);\n        const centerX = this.text.x + rotatedXY.x + rotatedWH.x / 2 + transformedOffset.x;\n        const centerY = this.text.y + rotatedXY.y + rotatedWH.y / 2 + transformedOffset.y;\n\n        const padding = 100;\n        const fitBounds = BB.fitInto(\n            bounds.width, bounds.height,\n            this.width - padding,\n            this.height - padding\n        );\n        this.scale = Math.min(1, fitBounds.width / bounds.width);\n        this.scale = Math.min(4, this.scale * Math.pow(2, this.zoomFac));\n\n\n        // --- compose text and target layer ---\n        this.targetCtx.save();\n\n        if (this.scale >= 4) {\n            this.targetCtx.imageSmoothingEnabled = false;\n        } else {\n            this.targetCtx.imageSmoothingEnabled = true;\n            this.targetCtx.imageSmoothingQuality  = this.scale >= 1 ? 'low' : 'medium';\n        }\n\n        this.targetCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.targetCtx.translate(this.width / 2, this.height / 2);\n        this.targetCtx.scale(this.scale, this.scale);\n        this.targetCtx.rotate(angleRad);\n        this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas, -centerX, -centerY);\n        this.targetCtx.drawImage(this.textCanvas, -centerX, -centerY);\n        this.targetCtx.restore();\n\n        const isDark = theme.isDark();\n\n        // --- layers ---\n        this.layersCtx.save();\n\n        this.layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\n        this.layersCtx.fillRect(0, 0, this.width, this.height);\n\n        { // bg\n            this.layersCtx.save();\n\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n\n            this.layersCtx.imageSmoothingEnabled = false;\n\n            //outline\n            const borderSize = 1 / this.scale;\n            this.layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\n            this.layersCtx.drawImage(\n                isDark ? this.emptyCanvasLight : this.emptyCanvas,\n                -centerX - borderSize,\n                -centerY - borderSize,\n                this.textCanvas.width + borderSize * 2,\n                this.textCanvas.height + borderSize * 2,\n            );\n            this.layersCtx.globalAlpha = 1;\n\n            //erase\n            this.layersCtx.globalCompositeOperation = 'destination-out';\n            this.layersCtx.drawImage(this.emptyCanvas, -centerX, -centerY, this.textCanvas.width, this.textCanvas.height);\n\n            this.layersCtx.restore();\n        }\n\n        { // individual layers\n\n            if (this.scale >= 4) {\n                this.layersCtx.imageSmoothingEnabled = false;\n            } else {\n                this.layersCtx.imageSmoothingEnabled = true;\n                this.layersCtx.imageSmoothingQuality  = this.scale >= 1 ? 'low' : 'medium';\n            }\n\n            // layers below\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            for (let i = 0; i < this.layerIndex; i++) {\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            this.layersCtx.restore();\n\n            // target layer\n            this.layersCtx.globalAlpha = (\n                this.layerArr[this.layerIndex].opacity *\n                (this.layerArr[this.layerIndex].isVisible ? 1 : 0)\n            );\n            this.layersCtx.globalCompositeOperation = this.layerArr[this.layerIndex].mixModeStr;\n            this.layersCtx.drawImage(this.targetCanvas, 0, 0);\n\n            // layers above\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            for (let i = this.layerIndex + 1; i < this.layerArr.length; i++) {\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            this.layersCtx.restore();\n\n        }\n\n        this.layersCtx.restore();\n\n\n\n        // --- final composite ---\n        this.previewCtx.save();\n        this.previewCtx.fillStyle = this.checkerPattern;\n        this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.previewCtx.drawImage(this.layersCanvas, 0, 0);\n        this.previewCtx.restore();\n\n        // bounds\n        this.previewCtx.save();\n        this.previewCtx.globalCompositeOperation = 'difference';\n        this.previewCtx.strokeStyle = '#fff';\n        this.previewCtx.lineWidth = 0.5;\n        this.previewCtx.translate(-this.offset.x, -this.offset.y);\n        this.previewCtx.strokeRect(\n            Math.round(this.width / 2 - (bounds.width / 2) * this.scale) + 0.5,\n            Math.round(this.height / 2 - (bounds.height / 2) * this.scale) + 0.5,\n            Math.round(bounds.width * this.scale),\n            Math.round(bounds.height * this.scale)\n        );\n        this.previewCtx.restore();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getInputsElement (): HTMLElement {\n        return this.inputsRootEl;\n    }\n\n    getValues (): TViewportParams {\n        return {\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue(),\n        };\n    }\n\n    setText (text: Omit<TRenderTextParam, 'x' | 'y' | 'angleRad'>): void {\n        const x = this. text.x;\n        const y = this. text.y;\n        const angleRad = this. text.angleRad;\n        this.text = {\n            ...text,\n            x,\n            y,\n            angleRad,\n        };\n        this.render();\n    }\n\n    setSize (width: number, height: number): void {\n        if (width === this.width && height === this.height) {\n            return;\n        }\n\n        this.width = width;\n        this.height = height;\n\n        this.targetCanvas.width = this.width;\n        this.targetCanvas.height = this.height;\n\n        this.layersCanvas.width = this.width;\n        this.layersCanvas.height = this.height;\n\n        this.previewCanvas.width = this.width;\n        this.previewCanvas.height = this.height;\n\n        this.previewWrapper.style.width = this.width + 'px';\n\n        this.render();\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.rootEl);\n        BB.destroyEl(this.inputsRootEl);\n        BB.destroyEl(this.previewWrapper);\n        clearInterval(this.interval);\n\n        this.rotationSlider.destroy();\n        BB.destroyEl(this.zoomInBtn);\n        BB.destroyEl(this.zoomOutBtn);\n        this.eventCapture.remove();\n        this.previewPointerListener.destroy();\n        this.keyListener.destroy();\n        theme.removeIsDarkListener(this.onDarkChange);\n    }\n}",null,"import {BB} from '../../../bb/bb';\nimport {CropCopy} from '../components/crop-copy';\nimport {Checkbox} from '../components/checkbox';\nimport {showModal} from './base/showModal';\nimport {LANG} from '../../../language/language';\nimport {IKeyString, IRect} from '../../../bb/bb-types';\nimport {IKlPsd, TKlPsdError} from '../../kl-types';\n\n/**\n * Shows first dialog when importing an image.\n * Where you can crop, and select import as layer or as image.\n */\nexport function showImportImageDialog (\n    p: {\n        image: IKlPsd | {\n            type: 'image';\n            width: number;\n            height: number;\n            canvas: HTMLImageElement | HTMLCanvasElement;\n        };\n        maxSize: number;\n        target: HTMLElement;\n        callback: (\n            val: {\n                type: 'as-image' | 'as-layer';\n                image: HTMLImageElement | HTMLCanvasElement;\n            } | {\n                type: 'as-image-psd';\n                image: IKlPsd;\n                cropObj: IRect;\n            } | {\n                type: 'cancel';\n            }\n        ) => void;\n    }\n): void {\n    const rootEl = BB.el();\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    const style: IKeyString = isSmall ? {} : { width: '540px' };\n\n    const resolutionEl = BB.el({\n        css: {\n            marginTop: '10px',\n            textAlign: 'center',\n            color: '#888',\n            lineHeight: '20px',\n        },\n    });\n\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 400,\n        canvas: p.image.canvas,\n        isNotCopy: true,\n        onChange: (width, height): void => {\n            if (!resolutionEl) {\n                return;\n            }\n            updateResolution(width, height);\n        },\n    });\n    BB.css(cropCopy.getEl(), {\n        marginLeft: '-20px',\n    });\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\n\n    rootEl.append(cropCopy.getEl(), resolutionEl);\n\n    function updateResolution (w: number, h: number): void {\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\n\n        if (fit.width < w) {\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\n            resolutionEl.title = LANG('import-too-large');\n        } else {\n            resolutionEl.innerHTML = `${w} X ${h}`;\n            resolutionEl.title = '';\n        }\n    }\n    updateResolution(p.image.width, p.image.height);\n\n\n    let doFlatten = false;\n    function showWarnings (psdWarningArr: TKlPsdError[]): void {\n        const contentArr = [];\n        const warningMap = {\n            'mask': 'Masks not supported. Mask was applied.',\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\n            'group': 'Groups not supported. Layers were ungrouped.',\n            'adjustment': 'Adjustment layers not supported.',\n            'layer-effect': 'Layer effects not supported.',\n            'smart-object': 'Smart objects not supported.',\n            'blend-mode': 'Unsupported layer blend mode.',\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\n        };\n        for (let i = 0; i < psdWarningArr.length; i++) {\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\n        }\n        alert(contentArr.join('\\n'));\n    }\n\n    let flattenCheckbox: Checkbox;\n    let warningsEl: HTMLElement | undefined;\n    if (p.image.type === 'psd') {\n        if (p.image.layers) {\n            flattenCheckbox = new Checkbox({\n                init: doFlatten,\n                label: LANG('import-flatten'),\n                callback: (b): void => {\n                    doFlatten = b;\n                },\n            });\n            rootEl.append(flattenCheckbox.getElement());\n\n            if (p.image.warningArr) {\n                const noteEl = BB.el({\n                    className: 'kl-import-note',\n                    content: LANG('import-psd-limited-support'),\n                });\n                const warnings = p.image.warningArr;\n                warningsEl = BB.el({\n                    parent: noteEl,\n                    tagName: 'a',\n                    content: 'Details',\n                    css: { marginLeft: '5px'},\n                    onClick: () => showWarnings(warnings),\n                });\n                rootEl.append(noteEl);\n            }\n        } else {\n            const noteEl = BB.el({\n                className: 'kl-import-note',\n                content: LANG('import-psd-unsupported'),\n            });\n            rootEl.append(noteEl);\n        }\n    }\n\n    function callback (result: string): void {\n        const croppedImage = cropCopy.getCroppedCanvas();\n        const cropRect = cropCopy.getRect();\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\n        cropCopy.destroy();\n        BB.destroyEl(warningsEl);\n        if (flattenCheckbox) {\n            flattenCheckbox.destroy();\n        }\n\n        if (result === LANG('import-btn-as-layer')) {\n            p.callback({\n                type: 'as-layer',\n                image: isCropped ? croppedImage : p.image.canvas,\n            });\n            if (!isCropped) {\n                BB.freeCanvas(croppedImage);\n            }\n        } else if (result === LANG('import-btn-as-image')) {\n            if (p.image.type === 'psd') {\n                if (doFlatten) {\n                    delete p.image.layers;\n                }\n                p.callback({\n                    type: 'as-image-psd',\n                    image: p.image,\n                    cropObj: cropRect,\n                });\n                BB.freeCanvas(croppedImage);\n            } else if (p.image.type === 'image') {\n                p.callback({\n                    type: 'as-image',\n                    image: croppedImage,\n                });\n            }\n        } else {\n            p.callback({\n                type: 'cancel',\n            });\n            BB.freeCanvas(croppedImage);\n        }\n    }\n    showModal({\n        target: p.target,\n        message: `<b>${LANG('import-title')}</b>`,\n        div: rootEl,\n        style,\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\n        callback,\n        autoFocus: 'As Image',\n    });\n}","import {createCanvas} from '../../bb/base/create-canvas';\nimport {BlendMode, Layer, Psd} from 'ag-psd/dist/psd';\nimport {IKlProject, IKlPsd, TKlPsdError, TKlPsdLayer, TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\nimport {BB} from '../../bb/bb';\nimport {throwIfUndefined} from '../../bb/base/base';\n\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\nlet psd2KlMap: Record<BlendMode, TMixMode>;\n\nfunction init (): void {\n    if (kl2PsdMap) {\n        return;\n    }\n    kl2PsdMap = {\n        'source-over': 'normal',\n\n        'darken': 'darken',\n        'multiply': 'multiply',\n        'color-burn': 'color burn',\n\n        'lighten': 'lighten',\n        'screen': 'screen',\n        'color-dodge': 'color dodge',\n\n        'overlay': 'overlay',\n        'soft-light': 'soft light',\n        'hard-light': 'hard light',\n\n        'difference': 'difference',\n        'exclusion': 'exclusion',\n\n        'hue': 'hue',\n        'saturation': 'saturation',\n        'color': 'color',\n        'luminosity': 'luminosity',\n    };\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map(a => a.reverse()));\n}\n\nexport function blendPsdToKl (str: BlendMode): TMixMode {\n    init();\n    return psd2KlMap[str];\n}\n\nexport function blendKlToPsd (str: TMixMode): BlendMode {\n    init();\n    return kl2PsdMap[str];\n}\n\n\n/**\n * Converts ag-psd object into something that KlCanvas can represent\n * @param psdObj\n */\nexport function readPsd (psdObj: Psd): IKlPsd {\n    if (!psdObj.canvas) {\n        throw new Error('psdObj.canvas undefined');\n    }\n    const result: IKlPsd = {\n        type: 'psd',\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height,\n    };\n\n    function addWarning (warningStr: TKlPsdError): void {\n        if (!result.warningArr) {\n            result.warningArr = [];\n        }\n        if (result.warningArr.includes(warningStr)) {\n            return;\n        }\n        result.warningArr.push(warningStr);\n    }\n\n    function getMixModeStr (blendMode: BlendMode): TMixMode {\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\n        if (!mixModeStr) {\n            addWarning('blend-mode');\n            mixModeStr = 'source-over';\n        }\n        return mixModeStr;\n    }\n\n    if (psdObj.bitsPerChannel !== 8) {\n        addWarning('bits-per-channel');\n    }\n\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n\n    // count resulting layers\n    const maxLayers = MAX_LAYERS;\n    let layerCount = 0;\n    function countWithinGroup (groupObj: Layer): number {\n        let result = 0;\n        if (groupObj.blendMode) {\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== 'source-over') {\n                return 1;\n            }\n        }\n        if (groupObj.children) {\n            for (let i = 0; i < groupObj.children.length; i++) {\n                const item = groupObj.children[i];\n                if (item.clipping || item.adjustment) {\n                    continue;\n                }\n\n                if (item.children) {\n                    addWarning('group');\n                    result += countWithinGroup(item);\n                } else {\n                    result++;\n                }\n            }\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n\n    result.layers = [];\n\n    function prepareMask (maskCanvas: HTMLCanvasElement, defaultColor: number): void {\n        const groupMaskCtx = BB.ctx(maskCanvas);\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = imData.data[i];\n            }\n        } else {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = 255 - imData.data[i];\n            }\n        }\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n\n    function convertGroup (psdGroupObj: Layer): TKlPsdLayer[] {\n\n        let resultArr: TKlPsdLayer[] = [];\n        const groupIsVisible = !psdGroupObj.hidden;\n        const groupOpacity = throwIfUndefined(psdGroupObj.opacity, 'groupOpacity is undefined');\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== 'source-over') {\n            groupCanvas = createCanvas(result.width, result.height);\n            groupCtx = BB.ctx(groupCanvas);\n        }\n\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning('mask');\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\n        }\n\n        if (psdGroupObj.children) {\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\n                const item = psdGroupObj.children[i];\n                if (item.clipping) {\n                    continue;\n                }\n                if (item.adjustment) {\n                    addWarning('adjustment');\n                    continue;\n                }\n\n                const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n                if (hasClipping) {\n                    addWarning('clipping');\n                }\n\n                if (item.children) {\n                    const convertedChildGroupItems = convertGroup(item);\n\n                    for (let e = 0; e < convertedChildGroupItems.length; e++) {\n                        const innerItem = convertedChildGroupItems[e];\n                        const innerCtx = BB.ctx(innerItem.image);\n\n                        // clipping\n                        if (hasClipping) {\n                            const clippingCanvas = createCanvas(result.width, result.height);\n                            const clippingCtx = BB.ctx(clippingCanvas);\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\n\n                            for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\n                                const clippingItem = psdGroupObj.children[f];\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                                    continue;\n                                }\n                                if (clippingItem.blendMode === undefined) {\n                                    throw new Error('clippingItem.blendMode undefined');\n                                }\n                                if (clippingItem.opacity === undefined) {\n                                    throw new Error('clippingItem.opacity undefined');\n                                }\n                                if (clippingItem.canvas === undefined) {\n                                    throw new Error('clippingItem.canvas undefined');\n                                }\n                                if (clippingItem.left === undefined) {\n                                    throw new Error('clippingItem.left undefined');\n                                }\n                                if (clippingItem.top === undefined) {\n                                    throw new Error('clippingItem.top undefined');\n                                }\n                                clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                                clippingCtx.globalAlpha = clippingItem.opacity;\n                                clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                            }\n\n                            innerCtx.globalCompositeOperation = 'source-atop';\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\n                        }\n\n\n\n                        // group mask\n                        if (psdGroupObj.mask) {\n                            innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                            if (psdGroupObj.mask.canvas === undefined) {\n                                throw new Error('psdGroupObj.mask.canvas undefined');\n                            }\n                            if (psdGroupObj.mask.left === undefined) {\n                                throw new Error('psdGroupObj.mask.left undefined');\n                            }\n                            if (psdGroupObj.mask.top === undefined) {\n                                throw new Error('psdGroupObj.mask.top undefined');\n                            }\n                            innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                        }\n\n                        if (groupCanvas) {\n                            if (groupCtx === undefined) {\n                                throw new Error('groupCtx undefined');\n                            }\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                            groupCtx.globalAlpha = innerItem.opacity;\n                            groupCtx.drawImage(innerItem.image, 0, 0);\n\n                        } else {\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\n                            resultArr.push(innerItem);\n                        }\n                    }\n\n                    continue;\n                }\n\n                const canvas = createCanvas(result.width, result.height);\n                const ctx = BB.ctx(canvas);\n                if (item.canvas) { // if a layer is empty it has no canvas\n                    if (item.top === undefined) {\n                        throw new Error('item.top undefined');\n                    }\n                    if (item.left === undefined) {\n                        throw new Error('item.left undefined');\n                    }\n                    ctx.drawImage(item.canvas, item.left, item.top);\n                }\n\n                // effects\n                if (item.effects) {\n                    addWarning('layer-effect');\n                }\n\n                // mask\n                if (item.mask) {\n                    addWarning('mask');\n                    if (item.mask.canvas === undefined) {\n                        throw new Error('item.mask.canvas undefined');\n                    }\n                    if (item.mask.defaultColor === undefined) {\n                        throw new Error('item.mask.defaultColor undefined');\n                    }\n                    if (item.mask.left === undefined) {\n                        throw new Error('item.mask.left undefined');\n                    }\n                    if (item.mask.top === undefined) {\n                        throw new Error('item.mask.top undefined');\n                    }\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\n\n                    ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n                }\n\n                // clipping\n                if (hasClipping) {\n                    if (item.right === undefined) {\n                        throw new Error('item.right undefined');\n                    }\n                    if (item.left === undefined) {\n                        throw new Error('item.left undefined');\n                    }\n                    if (item.bottom === undefined) {\n                        throw new Error('item.bottom undefined');\n                    }\n                    if (item.top === undefined) {\n                        throw new Error('item.top undefined');\n                    }\n                    if (item.canvas === undefined) {\n                        throw new Error('item.canvas undefined');\n                    }\n                    const clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\n                    const clippingCtx = BB.ctx(clippingCanvas);\n                    clippingCtx.drawImage(item.canvas, 0, 0);\n\n                    for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\n                        const clippingItem = psdGroupObj.children[e];\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                            continue;\n                        }\n                        if (clippingItem.blendMode === undefined) {\n                            throw new Error('clippingItem.blendMode undefined');\n                        }\n                        if (clippingItem.opacity === undefined) {\n                            throw new Error('clippingItem.opacity undefined');\n                        }\n                        if (clippingItem.canvas === undefined) {\n                            throw new Error('clippingItem.canvas undefined');\n                        }\n                        if (clippingItem.left === undefined) {\n                            throw new Error('clippingItem.left undefined');\n                        }\n                        if (clippingItem.top === undefined) {\n                            throw new Error('clippingItem.top undefined');\n                        }\n                        clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                        clippingCtx.globalAlpha = clippingItem.opacity;\n                        clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\n                    }\n\n                    ctx.globalCompositeOperation = 'source-atop';\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\n                }\n\n                // group mask\n                if (psdGroupObj.mask) {\n                    ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                    if (psdGroupObj.mask.canvas === undefined) {\n                        throw new Error('psdGroupObj.mask.canvas undefined');\n                    }\n                    if (psdGroupObj.mask.left === undefined) {\n                        throw new Error('psdGroupObj.mask.left undefined');\n                    }\n                    if (psdGroupObj.mask.top === undefined) {\n                        throw new Error('psdGroupObj.mask.top undefined');\n                    }\n                    ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                }\n\n                if (item.blendMode === undefined) {\n                    throw new Error('item.blendMode undefined');\n                }\n                if (item.hidden  === undefined) {\n                    throw new Error('item.hidden  undefined');\n                }\n                if (item.opacity === undefined) {\n                    throw new Error('item.opacity undefined');\n                }\n\n                if (groupCanvas && groupCtx) {\n                    if (groupOpacity > 0) {\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                        groupCtx.drawImage(canvas, 0, 0);\n                    }\n\n                } else {\n                    if (item.name === undefined) {\n                        throw new Error('item.name undefined');\n                    }\n                    resultArr.push({\n                        name: item.name,\n                        isVisible: !item.hidden && groupIsVisible,\n                        opacity: item.opacity * groupOpacity,\n                        mixModeStr: getMixModeStr(item.blendMode),\n                        image: canvas,\n                    });\n                }\n            }\n        }\n\n        if (groupCanvas) {\n            if (psdGroupObj.name === undefined) {\n                throw new Error('psdGroupObj.name undefined');\n            }\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    isVisible: groupIsVisible,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas,\n                },\n            ];\n        }\n\n        return resultArr;\n    }\n\n    result.layers = convertGroup({\n        name: 'root',\n        opacity: 1,\n        blendMode: 'normal',\n        children: psdObj.children,\n    });\n\n    return result;\n}\n\nexport function klPsdToKlProject (klPsd: IKlPsd): IKlProject {\n    // only share references to Canvas elements\n    const result: IKlProject = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: [],\n    };\n    if (klPsd.layers) {\n        result.layers = klPsd.layers.map(item => {\n            return {\n                name: item.name,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                image: item.image,\n            };\n        });\n    } else {\n        // flattened\n        result.layers = [{\n            name: LANG('background'),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: 'source-over',\n            image: klPsd.canvas,\n        }];\n    }\n    return result;\n}","import {IKlStorageProject} from '../kl-types';\n\nconst indexedDbIsSupported = !!window.indexedDB;\nlet dbNameStr = 'Klecks';\nconst storageNameStr = 'ProjectStore';\n\nexport function setDbName (name: string): void {\n    dbNameStr = '' + name;\n}\n\n/**\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\n * with index 'id'\n *\n * @param actionFunction what to execute during transaction\n * @param successCallback on successful transaction\n * @param errorCallback on error\n */\nfunction execIndexedDBTransaction (\n    actionFunction: (storeObj: IDBObjectStore) => void,\n    successCallback: () => void,\n    errorCallback: (errorStr: string) => void,\n): void {\n\n    let hasFinished = false;\n\n    function onSuccess (): void {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        successCallback();\n    }\n\n    function onError (errorStr: string): void {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        errorCallback(errorStr);\n    }\n\n    if (!indexedDbIsSupported) {\n        setTimeout(function () {\n            onError('no indexed db available');\n        }, 0);\n        return;\n    }\n    let requestObj: IDBOpenDBRequest;\n\n    try {\n        requestObj = window.indexedDB.open(dbNameStr, 1);\n    } catch (e) {\n        onError((e as {message: string}).message);\n        return;\n    }\n\n    requestObj.onupgradeneeded = function (): void {\n        try {\n            const db: IDBDatabase = requestObj.result;\n            const store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\n            store.createIndex('id', 'id', {unique: true});\n        } catch (e) {\n            onError((e as {message: string}).message);\n        }\n    };\n    requestObj.onerror = function (): void {\n        onError('indexedDB.open failed, ' + requestObj.error);\n    };\n    requestObj.onsuccess = function (): void {\n        let databaseObj: IDBDatabase;\n        let transactionObj: IDBTransaction;\n        let storeObj: IDBObjectStore;\n\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase(dbNameStr);\n                onError('object store ' + storageNameStr + ' missing. destroying db');\n                return;\n            }\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\n            storeObj = transactionObj.objectStore(storageNameStr);\n            storeObj.index('id');\n        } catch (e) {\n            onError((e as {message: string}).message);\n            return;\n        }\n\n        databaseObj.onerror = function (): void {\n            onError('database error, ' + (databaseObj as IDBDatabase & {error: string}).error);\n        };\n\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError((e as {message: string}).message);\n            return;\n        }\n\n        transactionObj.oncomplete = function (): void {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function (): void {\n            onError('transaction error, ' + transactionObj.error);\n        };\n    };\n}\n\nexport function getKlProjectObj (\n    successCallback: (result: undefined | IKlStorageProject) => void,\n    errorCallback: (error: string) => void,\n): void {\n    if (indexedDbIsSupported) {\n        let query: IDBRequest<undefined | IKlStorageProject>;\n        execIndexedDBTransaction(function (storeObj) {\n            query = storeObj.get(1);\n        }, function () {\n            successCallback(query.result);\n        }, function (errorStr) {\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\n        });\n    } else {\n        successCallback(undefined);\n    }\n}\n\n/**\n * stores a project into id = 1 in database:dbNameStr > storage: storageNameStr\n */\nexport function storeKlProjectObj (\n    storageProject: IKlStorageProject,\n    successCallback: () => void,\n    errorCallback: (error: string) => void,\n): void {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.put(storageProject);\n    }, function () {\n        successCallback();\n    }, function (errorStr) {\n        errorCallback(errorStr);\n    });\n\n}\n\n/**\n * deletes stored project, by removing id = 1 from database:dbNameStr > storage: storageNameStr\n */\nexport function clear (\n    successCallback: () => void,\n    errorCallback: (error: string) => void,\n): void {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.delete(1);\n    }, function () {\n        successCallback();\n    }, function (error) {\n        errorCallback(error);\n    });\n\n}\n","import {IFilter} from '../kl-types';\nimport glBrightnessContrastImg from '/src/app/img/ui/edit-brightness-contrast.svg';\nimport cropExtendImg from '/src/app/img/ui/edit-crop.svg';\nimport glCurvesImg from '/src/app/img/ui/edit-curves.svg';\nimport flipImg from '/src/app/img/ui/edit-flip.svg';\nimport glHueSaturationImg from '/src/app/img/ui/edit-hue-saturation.svg';\nimport invertImg from '/src/app/img/ui/edit-invert.png';\nimport glPerspectiveImg from '/src/app/img/ui/edit-perspective.svg';\nimport resizeImg from '/src/app/img/ui/edit-resize.svg';\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\nimport glTiltShiftImg from '/src/app/img/ui/edit-tilt-shift.png';\nimport toAlphaImg from '/src/app/img/ui/edit-to-alpha.svg';\nimport transformImg from '/src/app/img/ui/edit-transform.svg';\nimport glBlurImg from '/src/app/img/ui/edit-triangle-blur.png';\nimport glUnsharpMaskImg from '/src/app/img/ui/edit-unsharp-mask.png';\nimport gridImg from '/src/app/img/ui/edit-grid.svg';\nimport noiseImg from '/src/app/img/ui/edit-noise.svg';\nimport patternImg from '/src/app/img/ui/edit-pattern.svg';\nimport vanishPointImg from '/src/app/img/ui/edit-vanish-point.svg';\nimport distortImg from '/src/app/img/ui/edit-distort.svg';\nimport {THistoryEntryG} from '../history/kl-history';\n\nexport type TFilterHistoryEntry<Filter extends string, Input> = THistoryEntryG<['filter', Filter], 'apply', [{ input: Input }]>;\n\nexport const filterLibStatus = {\n    isLoaded: false,\n};\nexport const filterLib: {\n    [key:string]: IFilter;\n} = {\n    brightnessContrast: {\n        lang: {\n            name: 'filter-bright-contrast-title',\n            button: 'filter-bright-contrast',\n            description: 'filter-bright-contrast-description',\n        },\n        icon: glBrightnessContrastImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    cropExtend: {\n        lang: {\n            name: 'filter-crop-title',\n            button: 'filter-crop-extend',\n            description: 'filter-crop-description',\n        },\n        icon: cropExtendImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    curves: {\n        lang: {\n            name: 'filter-curves-title',\n            button: 'filter-curves',\n            description: 'filter-curves-description',\n        },\n        icon: glCurvesImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    distort: {\n        lang: {\n            name: 'filter-distort',\n            button: 'filter-distort',\n            description: 'filter-distort-description',\n        },\n        icon: distortImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    flip: {\n        lang: {\n            name: 'filter-flip-title',\n            button: 'filter-flip',\n            description: 'filter-flip-description',\n        },\n        icon: flipImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    hueSaturation: {\n        lang: {\n            name: 'filter-hue-sat-title',\n            button: 'filter-hue-sat',\n            description: 'filter-hue-sat-description',\n        },\n        icon: glHueSaturationImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    invert: {\n        lang: {\n            name: 'filter-invert',\n            button: 'filter-invert',\n        },\n        icon: invertImg,\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    perspective: {\n        lang: {\n            name: 'filter-perspective-title',\n            button: 'filter-perspective',\n            description: 'filter-perspective-description',\n        },\n        icon: glPerspectiveImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    resize: {\n        lang: {\n            name: 'filter-resize-title',\n            button: 'filter-resize',\n            description: 'filter-resize-description',\n        },\n        icon: resizeImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    rotate: {\n        lang: {\n            name: 'filter-rotate-title',\n            button: 'filter-rotate',\n            description: 'filter-rotate-description',\n        },\n        icon: rotateImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    tiltShift: {\n        lang: {\n            name: 'filter-tilt-shift-title',\n            button: 'filter-tilt-shift',\n            description: 'filter-tilt-shift-description',\n        },\n        icon: glTiltShiftImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    toAlpha: {\n        lang: {\n            name: 'filter-to-alpha-title',\n            button: 'filter-to-alpha',\n            description: 'filter-to-alpha-description',\n        },\n        icon: toAlphaImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    transform: {\n        lang: {\n            name: 'filter-transform-title',\n            button: 'filter-transform',\n            description: 'filter-transform-description',\n        },\n        icon: transformImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    blur: {\n        lang: {\n            name: 'filter-triangle-blur-title',\n            button: 'filter-triangle-blur',\n            description: 'filter-triangle-blur-description',\n        },\n        icon: glBlurImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    unsharpMask: {\n        lang: {\n            name: 'filter-unsharp-mask-title',\n            button: 'filter-unsharp-mask',\n            description: 'filter-unsharp-mask-description',\n        },\n        icon: glUnsharpMaskImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    grid: {\n        lang: {\n            name: 'filter-grid',\n            button: 'filter-grid',\n            description: 'filter-grid-description',\n        },\n        icon: gridImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    noise: {\n        lang: {\n            name: 'filter-noise',\n            button: 'filter-noise',\n            description: 'filter-noise-description',\n        },\n        icon: noiseImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    pattern: {\n        lang: {\n            name: 'filter-pattern',\n            button: 'filter-pattern',\n            description: 'filter-pattern-description',\n        },\n        icon: patternImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    vanishPoint: {\n        lang: {\n            name: 'filter-vanish-point-title',\n            button: 'filter-vanish-point',\n            description: 'filter-vanish-point-description',\n        },\n        icon: vanishPointImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n};\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-brightness-contrast.2c9c4981.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-curves.b414a834.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-flip.6941cde5.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-hue-saturation.05bd5fe8.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-invert.84a3e72f.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-perspective.afea99bb.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-resize.c4f10e41.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-tilt-shift.70880153.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-to-alpha.acfae5e2.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-transform.7622dbf1.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-triangle-blur.d12ea9e6.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-unsharp-mask.b9482369.png\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-grid.3787b0f4.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-noise.e7fb4997.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-pattern.3cc4b269.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-vanish-point.c07d5afc.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"edit-distort.a3941278.svg\" + \"?\" + Date.now();","import {PenBrush} from './pen-brush';\nimport {BlendBrush} from './blend-brush';\nimport {SketchyBrush} from './sketchy-brush';\nimport {PixelBrush} from './pixel-brush';\nimport {EraserBrush} from './eraser-brush';\nimport {SmudgeBrush} from './smudge-brush';\nimport {ChemyBrush} from './chemy-brush';\n\nexport type TBrush = |\n    PenBrush |\n    BlendBrush |\n    SketchyBrush |\n    PixelBrush |\n    ChemyBrush |\n    SmudgeBrush |\n    EraserBrush;\n\nexport const brushes = {\n    PenBrush,\n    BlendBrush,\n    SketchyBrush,\n    PixelBrush,\n    ChemyBrush,\n    SmudgeBrush,\n    EraserBrush,\n};\n","import {BB} from '../../bb/bb';\nimport {alphaImArr} from './brushes-common';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB, TPressureInput} from '../kl-types';\nimport {BezierLine} from '../../bb/math/line';\n\nexport interface IPenBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'PenBrush'];\n    actions: THistoryInnerActions<PenBrush>[];\n}\n\nconst ALPHA_CIRCLE = 0;\nconst ALPHA_CHALK = 1;\nconst ALPHA_CAL = 2; // calligraphy\nconst ALPHA_SQUARE = 3;\n\nconst TWO_PI = 2 * Math.PI;\n\nexport class PenBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IPenBrushHistoryEntry | undefined;\n\n    private settingHasOpacityPressure: boolean = false;\n    private settingHasSizePressure: boolean = true;\n    private settingSize: number = 2;\n    private settingSpacing: number = 0.8489;\n    private settingOpacity: number = 1;\n    private settingColor: IRGB = {} as IRGB;\n    private settingColorStr: string = '';\n    private settingAlphaId: number = ALPHA_CIRCLE;\n    private settingLockLayerAlpha: boolean = false;\n\n    private hasDrawnDot: boolean = false;\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private inputArr: TPressureInput[] = [];\n    private inputIsDrawing: boolean = false;\n    private bezierLine: BezierLine | null = null;\n\n    // mipmapping\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\n\n\n    private updateAlphaCanvas () {\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\n            return;\n        }\n\n        const instructionArr: [HTMLCanvasElement, number][] = [\n            [this.alphaCanvas128, 128],\n            [this.alphaCanvas64, 64],\n            [this.alphaCanvas32, 32],\n        ];\n\n        let ctx;\n\n        for (let i = 0; i < instructionArr.length; i++) {\n            ctx = BB.ctx((instructionArr[i][0] as any));\n\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.fillStyle = 'rgba(' + this.settingColor.r\n                + ', ' + this.settingColor.g\n                + ', ' + this.settingColor.b\n                + ', ' + this.alphaOpacityArr[this.settingAlphaId] + ')';\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.imageSmoothingQuality = 'high';\n            ctx.drawImage(alphaImArr[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.restore();\n        }\n    }\n\n    private calcOpacity (pressure: number): number {\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n\n    /**\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */\n    private drawDot (\n        x: number,\n        y:number,\n        size: number,\n        opacity: number,\n        angle?: number,\n        before?: [number, number, number, number, (number | undefined)]\n    ): void {\n        if (size <= 0) {\n            return;\n        }\n\n        if (this.settingLockLayerAlpha) {\n            this.context.globalCompositeOperation = 'source-atop';\n        }\n\n        if (!before || before[3] !== opacity) {\n            this.context.globalAlpha = opacity;\n        }\n\n        if (!before && (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)) {\n            this.context.fillStyle = this.settingColorStr;\n        }\n\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\n            this.context.beginPath();\n            this.context.arc(x, y, size, 0, TWO_PI);\n            this.context.closePath();\n            this.context.fill();\n            this.hasDrawnDot = true;\n\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                this.context.save();\n                this.context.translate(x, y);\n                this.context.rotate(angle / 180 * Math.PI);\n                this.context.fillRect(-size, -size, size * 2, size * 2);\n                this.context.restore();\n                this.hasDrawnDot = true;\n            }\n\n        } else { // other brush alphas\n            this.context.save();\n            this.context.translate(x, y);\n            let targetMipmap = this.alphaCanvas128;\n            if (size <= 32 && size > 16) {\n                targetMipmap = this.alphaCanvas64;\n            } else if (size <= 16) {\n                targetMipmap = this.alphaCanvas32;\n            }\n            this.context.scale(size, size);\n            if (this.settingAlphaId === ALPHA_CHALK) {\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\n            }\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\n\n            this.context.restore();\n            this.hasDrawnDot = true;\n        }\n    }\n\n    // continueLine\n    private continueLine (\n        x: number | null,\n        y: number | null,\n        size: number,\n        pressure: number,\n    ): void {\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\n        }\n\n        const drawArr: [number, number, number, number, (number | undefined)][] = []; //draw instructions. will be all drawn at once\n\n        const dotCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.calcOpacity(localPressure);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing;\n        if (x === null || y === null) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        this.context.save();\n        let before: typeof drawArr[number] | undefined = undefined;\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\n            before = item;\n        }\n        this.context.restore();\n    }\n\n\n    // ---- public ----\n    constructor () {}\n\n    // ---- interface ----\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'PenBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setAlpha',\n                    params: [this.settingAlphaId],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n            ],\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.calcOpacity(p);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.hasDrawnDot = false;\n\n        this.inputIsDrawing = true;\n        this.context.save();\n        this.drawDot(x, y, localSize, localOpacity);\n        this.context.restore();\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.inputArr = [{\n            x,\n            y,\n            pressure: p,\n        }];\n\n        this.historyEntry.actions!.push({\n            action: 'startLine',\n            params: [x, y, p],\n        });\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.inputIsDrawing) {\n            return;\n        }\n        this.historyEntry!.actions!.push({\n            action: 'goLine',\n            params: [x, y, p],\n        });\n\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.context.save();\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\n\n        this.context.restore();\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n\n        this.inputArr.push({\n            x,\n            y,\n            pressure: p,\n        });\n    }\n\n    endLine (x: number, y: number): void {\n\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.inputIsDrawing = false;\n\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = this.inputArr[0];\n            this.inputArr.forEach(item => {\n                if (item.pressure > maxInput.pressure) {\n                    maxInput = item;\n                }\n            });\n\n            this.context.save();\n            const p = BB.clamp(maxInput.pressure, 0, 1);\n            const localOpacity = this.calcOpacity(p);\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n            this.context.restore();\n        }\n\n        this.bezierLine = null;\n\n        if (this.historyEntry) {\n            this.historyEntry.actions!.push({\n                action: 'endLine',\n                params: [x, y],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n\n        this.hasDrawnDot = false;\n        this.inputArr = [];\n    }\n\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n        const angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = this.settingSize * this.settingSpacing;\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\n        this.context.save();\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\n        }\n        this.context.restore();\n\n\n        const historyEntry: IPenBrushHistoryEntry = {\n            tool: ['brush', 'PenBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setAlpha',\n                    params: [this.settingAlphaId],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n    //IS\n    isDrawing (): boolean {\n        return this.inputIsDrawing;\n    }\n\n    //SET\n    setAlpha (a: number): void {\n        if (this.settingAlphaId === a) {\n            return;\n        }\n        this.settingAlphaId = a;\n        this.updateAlphaCanvas();\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor === c) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\n        this.updateAlphaCanvas();\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    //GET\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n\n","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\n\nexport const alphaImArr: HTMLCanvasElement[] = []; //used by default brush\nalphaImArr[1] = genBrushAlpha01(128);\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\nimport {noise} from '../../../bb/math/perlin';\nimport {IVector2D} from '../../../bb/bb-types';\n\n// chalk\nexport function genBrushAlpha01 (w: number): HTMLCanvasElement {\n\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = BB.ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            // base noise\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n\n            // fade out in circular shape\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\n            const falloff = BB.clamp(\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\n                0,\n                1);\n            noisePattern = noisePattern * falloff;\n\n            // make the middle darker\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\n            noisePattern = noisePattern * falloff2;\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n// https://www.shadertoy.com/view/3tdSDj\nfunction udSegment ( p: IVector2D, a: IVector2D, b: IVector2D ): number {\n    const ba = BB.Vec2.sub(b, a);\n    const pa = BB.Vec2.sub(p, a);\n    const h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\n}\n\n// calligraphy\nexport function genBrushAlpha02 (w: number): HTMLCanvasElement {\n\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\n    const p2 = {x: w - (w * pDist), y: pDist * w};\n\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = BB.ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            let col = udSegment({x: x, y: y}, p1, p2);\n\n            col = BB.clamp(\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\n                0,\n                255\n            );\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = col;\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}","/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nconst myModule = {} as any;\n\nclass Grad {\n    constructor (public x: number, public y: number, public z:number) {}\n\n    dot2 (x: number, y: number): number {\n        return this.x*x + this.y*y;\n    }\n}\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/\n\nconst grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\n\nconst p = [151,160,137,91,90,15,\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\n// To remove the need for index wrapping, double the permutation table length\nconst perm = new Array(512);\nconst gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nmyModule.seed = function (seed: number): void {\n    if (seed > 0 && seed < 1) {\n        // Scale the seed out\n        seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n        seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n        let v;\n        if (i & 1) {\n            v = p[i] ^ (seed & 255);\n        } else {\n            v = p[i] ^ ((seed>>8) & 255);\n        }\n\n        perm[i] = perm[i + 256] = v;\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\n    }\n};\n\nmyModule.seed(0);\n\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nconst F2 = 0.5*(Math.sqrt(3)-1);\nconst G2 = (3-Math.sqrt(3))/6;\n\n/*let F3 = 1/3;\nlet G3 = 1/6;*/\n\n// 2D simplex noise\nmyModule.simplex2 = function (xin: number, yin: number): number {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    const s = (xin+yin)*F2; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    const t = (i+j)*G2;\n    const x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    const y0 = yin-j+t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        i1=1; j1=0;\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        i1=0; j1=1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    const y1 = y0 - j1 + G2;\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    const y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    const gi0 = gradP[i+perm[j]];\n    const gi1 = gradP[i+i1+perm[j+j1]];\n    const gi2 = gradP[i+1+perm[j+1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0*x0-y0*y0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1*x1-y1*y1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2*x2-y2*y2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\n/*\n// 3D simplex noise\nmyModule.simplex3 = function(xin, yin, zin) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let k = Math.floor(zin+s);\n\n    let t = (i+j+k)*G3;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    let z0 = zin-k+t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\n    } else {\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    let x1 = x0 - i1 + G3; // Offsets for second corner\n    let y1 = y0 - j1 + G3;\n    let z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n    if (t3<0) {\n        n3 = 0;\n    } else {\n        t3 *= t3;\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n\n};\n*/\n// ##### Perlin noise stuff\n/*\nfunction fade(t) {\n    return t*t*t*(t*(t*6-15)+10);\n}\n\nfunction lerp(a, b, t) {\n    return (1-t)*a + t*b;\n}\n\n// 2D Perlin Noise\nmyModule.perlin2 = function(x, y) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X; y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255;\n\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\n\n    // Compute the fade curve value for x\n    let u = fade(x);\n\n    // Interpolate the four results\n    return lerp(\n        lerp(n00, n10, u),\n        lerp(n01, n11, u),\n        fade(y));\n};*/\n/*\n// 3D Perlin Noise\nmyModule.perlin3 = function(x, y, z) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X; y = y - Y; z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255; Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\n\n    // Compute the fade curve value for x, y, z\n    let u = fade(x);\n    let v = fade(y);\n    let w = fade(z);\n\n    // Interpolate\n    return lerp(\n        lerp(\n            lerp(n000, n100, u),\n            lerp(n001, n101, u), w),\n        lerp(\n            lerp(n010, n110, u),\n            lerp(n011, n111, u), w),\n        v);\n};*/\n\nexport const noise = myModule;","import {BB} from '../../bb/bb';\nimport {IRGB, IRGBA} from '../kl-types';\nimport {IBounds, IPressureInput} from '../../bb/bb-types';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {clamp} from '../../bb/math/math';\nimport {BezierLine, TBezierLineCallback} from '../../bb/math/line';\n\nexport interface IBlendBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'BlendBrush'];\n    actions: THistoryInnerActions<BlendBrush>[];\n}\n\nconst cellSize = 256;\n\ninterface IDrawBufferItem {\n    x: number;\n    y: number;\n    size: number;\n    opacity: number;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    r: number;\n    g: number;\n    b: number;\n}\n\nexport class BlendBrush {\n\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private color: IRGB = {} as IRGB;\n    private size: number = 29; // radius - 0.5 - 99999\n    private opacity: number = 0.6; // 0-1\n    private blending: number = 0.65; // 0-1\n\n    private settingLockLayerAlpha: boolean = false;\n    private settingSizePressure: boolean = true;\n    private settingOpacityPressure: boolean = false;\n\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\n    private blendMix: number = 0.45; // todo docs\n    private mixCol: IRGB = {r: 0, g: 0, b: 0}; // todo docs\n    private localColOld: IRGBA = {} as IRGBA; // todo docs\n\n    private isDrawing: boolean = false;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private bezierLine: undefined | BezierLine;\n\n    private history: KlHistoryInterface | undefined;\n    private historyEntry: IBlendBrushHistoryEntry | undefined;\n    private redrawBounds: IBounds | undefined;\n    private cells: (ImageData | undefined)[] = [];\n    private drawBuffer: IDrawBufferItem[] = [];\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private getCellsWidth (): number {\n        return Math.ceil(this.context.canvas.width / cellSize);\n    }\n\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */\n    private drawChangedCells (): void {\n        if (!this.redrawBounds) {\n            return;\n        }\n\n        const cells: typeof this.cells = this.cells.map(() => undefined);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index) => {\n            if (isTouched) {\n                cells[index] = this.cells[index];\n            }\n        });\n        this.drawCells(cells);\n        this.redrawBounds = undefined;\n    }\n\n    private getTouchedCells (bounds: IBounds): boolean[] {\n        const touchedCells = this.cells.map(() => false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / cellSize),\n            y1: Math.floor(bounds.y1 / cellSize),\n            x2: Math.floor(bounds.x2 / cellSize),\n            y2: Math.floor(bounds.y2 / cellSize),\n        };\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\n                touchedCells[e * cellsW + i] = true;\n            }\n        }\n        return touchedCells;\n    }\n\n    /**\n     * Slice up bounds according to cells\n     * @param bounds\n     * @private\n     */\n    private sliceBounds (bounds: IBounds): {index: number; bounds: IBounds}[] {\n        const cellsW = this.getCellsWidth();\n        const result: {index: number; bounds: IBounds}[] = [];\n        const touchedCells = this.getTouchedCells(bounds);\n\n        touchedCells.forEach((cell, i) => {\n            if (!cell) {\n                return;\n            }\n\n            const cellOffsetX = (i % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\n            const cellWidth = this.cells[i]!.width;\n            const cellHeight = this.cells[i]!.height;\n\n            const inCellBounds = {\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\n            };\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\n                return;\n            }\n            result.push({\n                index: i,\n                bounds: inCellBounds,\n            });\n        });\n\n        return result;\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    private copyFromCanvas (bounds: IBounds | undefined): void {\n        if (!bounds) {\n            return;\n        }\n\n        const touchedCells = this.getTouchedCells(bounds);\n        const cellsW = this.getCellsWidth();\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.cells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = BB.ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\n\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n        });\n    }\n\n    private getAverage (x: number, y: number, size: number): IRGBA {\n\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0,\n            };\n        }\n\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\n        slicedBounds.forEach(slice => {\n            const width = this.cells[slice.index]!.width;\n            const data = this.cells[slice.index]!.data;\n            const bounds = slice.bounds;\n\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\n                    alpha = data[e2 + 3];\n                    ar += data[e2] * alpha;\n                    ag += data[e2 + 1] * alpha;\n                    ab += data[e2 + 2] * alpha;\n                    aa += alpha;\n                }\n            }\n        });\n\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return {\n            r: ar,\n            g: ag,\n            b: ab,\n            a: aa,\n        };\n    }\n\n    private prepDot (x: number, y: number, size: number): IBounds | undefined {\n        size = Math.max(0.5, size);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return undefined;\n        }\n        return { x1, y1, x2, y2 };\n    }\n\n    private drawDot (params: IDrawBufferItem): void {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr: number[] = [];\n        for (let i = 0; i < randLen; i++) {\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        }\n\n        // thin lines take more than just 1 sample\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared: number = samples ? samples * samples : 0;\n        const sampleOffsets: number[] = [];\n        if (samples) {\n            let i = 0;\n            for (let n = 0; n < samples; n++) {\n                for (let m = 0; m < samples; m++, i += 2) {\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n                }\n            }\n        }\n\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n\n\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2,\n        });\n\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach(slice => {\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\n            const cellWidth = this.cells[slice.index]!.width;\n            const data = this.cells[slice.index]!.data;\n\n            // i - y index within cell\n            // e - x index within cell\n\n            // e2 - index in image data\n\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\n                for (\n                    let e = slice.bounds.x1,\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\n                        re = e + cellOffsetX - params.x;\n                    e <= slice.bounds.x2;\n                    e++,\n                        e2 += 4,\n                        re++\n                ) {\n                    // O = over -> brush-dot\n                    // U = under -> image\n\n                    let alphaO = 0;\n                    if (samplesSquared) {\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                            if (dist >= sizeSquared) {\n                                continue;\n                            }\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                        }\n                        if (!alphaO) {\n                            continue;\n                        }\n                        alphaO /= samplesSquared;\n                    } else {\n                        // technically needs + 0.5 offset, but not noticeable with large brush\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                        if (dist >= sizeSquared) {\n                            continue;\n                        }\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n\n                    const invAlphaO = 1 - alphaO;\n                    const alphaU =data[e2 + 3] / 255;\n\n                    if (this.settingLockLayerAlpha) {\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\n                        if (alphaU) {\n                            data[e2] = Math.floor(underR + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                        }\n                    } else {\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\n\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                        if (newAlpha) {\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\n                        }\n                    }\n                    randI = (randI + 1) % randLen;\n\n                }\n            }\n\n        });\n    }\n\n    private calcSpacing (size: number): number {\n        return BB.mix(\n            (size * 2) / 2, // until size 5.3\n            (size * 2) / 9, // at size 24\n            clamp((size - 2.7) / (12 - 2.7), 0, 1)\n        );\n    }\n\n    private continueLine (x: number | undefined, y: number | undefined, p: number, isCoalesced: boolean): void {\n\n        this.drawBuffer = [];\n\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\n\n        const bDist = this.calcSpacing(localSize);\n\n        const avgX = (x === undefined) ? this.lastInput.x : x;\n        const avgY = (y === undefined) ? this.lastInput.y : y;\n\n        let localColNew: IRGBA;\n\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) {\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\n            } else {\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                if (bounds) {\n                    this.copyFromCanvas(bounds);\n                }\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\n\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n\n        }\n\n\n        const bezierCallback: TBezierLineCallback  = (val) => {\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\n                return;\n            }\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixCol.r = BB.mix(this.localColOld.r, localColNew.r, factor);\n                this.mixCol.g = BB.mix(this.localColOld.g, localColNew.g, factor);\n                this.mixCol.b = BB.mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixCol.r = localColNew.r;\n                this.mixCol.g = localColNew.g;\n                this.mixCol.b = localColNew.b;\n            }\n            const bounds = this.prepDot(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        };\n\n        if (x === undefined || y === undefined) {\n            this.bezierLine!.addFinal(bDist, bezierCallback);\n        } else {\n            this.bezierLine!.add(x, y, bDist, bezierCallback);\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.localColOld = localColNew!;\n    }\n\n\n\n\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.size;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    getBlending (): number {\n        return this.blending;\n    }\n\n    setBlending (b: number): void {\n        this.blending = b;\n    }\n\n    setColor (c: IRGB): void {\n        this.color = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setSizePressure (b: boolean): void {\n        this.settingSizePressure = b;\n    }\n\n    setOpacityPressure (b: boolean): void {\n        this.settingOpacityPressure = b;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setIsTesting (b: boolean): void {\n        this.isTesting = b;\n    }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'BlendBrush'],\n            actions: [],\n        };\n\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(() => undefined);\n\n        this.isDrawing = true;\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\n\n            const average = this.getAverage(\n                x,\n                y,\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\n            );\n            if (average.a === 0) {\n                this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending,\n                };\n            } else {\n                this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a,\n                };\n            }\n\n            this.mixCol.r = this.blendCol.r;\n            this.mixCol.g = this.blendCol.g;\n            this.mixCol.b = this.blendCol.b;\n        }\n\n        this.localColOld = {r: this.mixCol.r, g: this.mixCol.g, b: this.mixCol.b, a: this.blendCol.a};\n\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.prepDot(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, function () {\n        });\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        if (!this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n        if (!this.isDrawing) {\n            return;\n        }\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n\n        if (!this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    endLine (): void {\n        if (this.bezierLine) {\n            this.continueLine(undefined, undefined, this.lastInput.pressure, false);\n        }\n\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n\n\n        this.drawChangedCells();\n\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\n            this.historyEntry.actions.push({\n                action: 'drawCells',\n                params: [this.cells],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.cells = [];\n    }\n\n    /**\n     * draw cells onto context\n     * @param cells\n     */\n    drawCells (cells: (ImageData | undefined)[]): void {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index) => {\n            if (!imageData) {\n                return;\n            }\n            const cellOffsetX = (index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.isDrawing || x1 === undefined) {\n            return;\n        }\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(() => undefined);\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n\n        if (average.a === 0) {\n            this.blendCol = {\n                r: this.color.r,\n                g: this.color.g,\n                b: this.color.b,\n                a: 1 - this.blending,\n            };\n        } else {\n            this.blendCol = {\n                r: average.r,\n                g: average.g,\n                b: average.b,\n                a: average.a,\n            };\n        }\n\n        this.mixCol.r = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n        this.mixCol.g = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n        this.mixCol.b = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n\n\n        const p = 1;\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        const bDist = this.calcSpacing(localSize);\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bDist) {\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n            if (bounds) {\n                this.copyFromCanvas(bounds);\n                this.drawBuffer.push({\n                    x: x1 + eX * loopDist,\n                    y: y1 + eY * loopDist,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        }\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        if (this.history && this.cells.find(item => !!item)) {\n            this.drawCells(this.cells);\n            this.historyEntry = {\n                tool: ['brush', 'BlendBrush'],\n                actions: [{\n                    action: 'drawCells',\n                    params: [this.cells],\n                }],\n            };\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.cells = [];\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB, TPressureInput} from '../kl-types';\n\nexport interface ISketchyBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'SketchyBrush'];\n    actions: THistoryInnerActions<SketchyBrush>[];\n}\n\nconst sampleCanvas = BB.canvas(32, 32);\nconst sampleCtx = BB.ctx(sampleCanvas);\n\nexport class SketchyBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingColor: IRGB = {} as IRGB;\n    private settingSize: number = 1;\n    private settingOpacity: number = 0.2;\n    private settingBlending: number = 0.5;\n    private settingScale: number = 1;\n    private lastX: number = 0;\n    private lastY: number = 0;\n    private inputIsDrawing: boolean = false;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: ISketchyBrushHistoryEntry | undefined;\n    private sketchySeed: number = 0;\n    private points: [number, number][] = []; // x y\n    private count: number = 0;\n    private readonly mixMode = [\n        (c1: IRGB): IRGB => {\n            return c1;\n        },\n        (c1: IRGB, c2: IRGB): IRGB => { // why\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        },\n    ];\n\n\n    private rand (): number {\n        this.sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n\n    // ---- public ----\n    constructor () {}\n\n    // ---- interface ----\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSeed (s: number): void {\n        this.sketchySeed = parseInt('' + s);\n    }\n\n    getSeed (): number {\n        return parseInt('' + this.sketchySeed);\n    }\n\n    getSize (): number {\n        return this.settingSize / 2;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = c;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    getBlending (): number {\n        return this.settingBlending;\n    }\n\n    setBlending (b: number): void {\n        this.settingBlending = b;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s * 2;\n    }\n\n    getScale (): number {\n        return this.settingScale;\n    }\n\n    setScale (s: number): void {\n        this.settingScale = s;\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    startLine (x: number, y: number, pressure: number, shift?: boolean): void {\n        if (shift && this.lastInput.x) {\n            this.inputIsDrawing = true;\n            this.endLine();\n        } else {\n            this.inputIsDrawing = true;\n            this.lastX = x;\n            this.lastY = y;\n            this.lastInput.x = x;\n            this.lastInput.y = y;\n            this.historyEntry = {\n                tool: ['brush', 'SketchyBrush'],\n                actions: [\n                    {\n                        action: 'setScale',\n                        params: [this.settingScale],\n                    },\n                    {\n                        action: 'setSize',\n                        params: [this.settingSize / 2],\n                    },\n                    {\n                        action: 'setOpacity',\n                        params: [this.settingOpacity],\n                    },\n                    {\n                        action: 'setColor',\n                        params: [this.settingColor],\n                    },\n                    {\n                        action: 'setBlending',\n                        params: [this.settingBlending],\n                    },\n                    {\n                        action: 'startLine',\n                        params: [x, y, pressure],\n                    },\n                ],\n            };\n        }\n\n    }\n\n    goLine (p_x: number, p_y: number, pressure: number, preMixedColor: IRGB | undefined): void {\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\n            return;\n        }\n\n        let e, b, a, g;\n        const x = parseInt('' + p_x);\n        const y = parseInt('' + p_y);\n        this.points.push([x, y]);\n\n        let mixr = this.settingColor.r;\n        let mixg = this.settingColor.g;\n        let mixb = this.settingColor.b;\n\n        if (preMixedColor) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (this.settingBlending !== 0) {\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\n                    const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\n                    mixW -= mixX;\n                    mixH -= mixY;\n\n                    if (mixW > 0 && mixH > 0) {\n                        const imDat = this.context.getImageData(mixX, mixY, mixW, mixH);\n                        let countMix = 0;\n                        for (let i = 0; i < imDat.data.length; i += 4) {\n                            mixr += imDat.data[i + 0];\n                            mixg += imDat.data[i + 1];\n                            mixb += imDat.data[i + 2];\n                            countMix++;\n                        }\n                        mixr /= countMix;\n                        mixg /= countMix;\n                        mixb /= countMix;\n                    }\n\n                    const mixed = this.mixMode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\n                    mixr = parseInt('' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending));\n                    mixg = parseInt('' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending));\n                    mixb = parseInt('' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending));\n                }\n            }\n        }\n\n        this.context.save();\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\n        this.context.lineWidth = this.settingSize;\n\n        this.context.beginPath();\n        this.context.moveTo(this.lastX, this.lastY);\n        this.context.lineTo(x, y);\n\n        for (e = 0; e < this.points.length; e++) {\n            b = this.points[e][0] - this.points[this.count][0];\n            a = this.points[e][1] - this.points[this.count][1];\n            g = b * b + a * a;\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\n                this.context.moveTo(this.points[this.count][0] + (b * 0.3), this.points[this.count][1] + (a * 0.3));\n                this.context.lineTo(this.points[e][0] - (b * 0.3), this.points[e][1] - (a * 0.3));\n            }\n        }\n\n        this.context.stroke();\n        this.context.restore();\n\n\n        this.count++;\n        this.lastX = x;\n        this.lastY = y;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.historyEntry!.actions!.push({\n            action: 'goLine',\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}],\n        });\n    }\n\n    endLine (): void {\n        this.inputIsDrawing = false;\n        this.count = 0;\n        this.points = [];\n        if (this.historyEntry) {\n            this.historyEntry.actions!.push({\n                action: 'endLine',\n                params: [],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n    //cheap 'n' ugly\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n\n        this.context.save();\n        this.context.lineWidth = this.settingSize;\n\n        const mixCol = {\n            r: this.settingColor.r,\n            g: this.settingColor.g,\n            b: this.settingColor.b,\n        };\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\n            mixCol.r = 0;\n            mixCol.g = 0;\n            mixCol.b = 0;\n            const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\n            const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixW -= mixX;\n            mixH -= mixY;\n            if (mixW > 0 && mixH > 0) {\n                const w = Math.min(sampleCanvas.width, mixW);\n                const h = Math.min(sampleCanvas.height, mixH);\n                sampleCtx.save();\n                sampleCtx.globalCompositeOperation = 'copy';\n                sampleCtx.drawImage(this.context.canvas, mixX, mixY, mixW, mixH, 0, 0, w, h);\n                sampleCtx.restore();\n\n                const imDat = sampleCtx.getImageData(mixX, mixY, mixW, mixH);\n                let countMix = 0;\n                for (let i = 0; i < imDat.data.length; i += 4) {\n                    mixCol.r += imDat.data[i + 0];\n                    mixCol.g += imDat.data[i + 1];\n                    mixCol.b += imDat.data[i + 2];\n                    countMix++;\n                }\n                mixCol.r /= countMix;\n                mixCol.g /= countMix;\n                mixCol.b /= countMix;\n            }\n        }\n        const mixed = this.mixMode[0](new BB.RGB(mixCol.r, mixCol.g, mixCol.b), this.settingColor);\n        mixCol.r = parseInt('' + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\n        mixCol.g = parseInt('' + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\n        mixCol.b = parseInt('' + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\n        this.context.strokeStyle = 'rgba(' + mixCol.r + ', ' + mixCol.g + ', ' + mixCol.b + ', ' + this.settingOpacity + ')';\n        this.context.beginPath();\n        this.context.moveTo(x1, y1);\n        this.context.lineTo(x2, y2);\n        this.context.stroke();\n        this.context.strokeStyle = 'rgba(' + mixCol.r + ', ' + mixCol.g + ', ' + mixCol.b + ', ' + this.settingOpacity + ')';\n        this.context.restore();\n\n        const historyEntry: ISketchyBrushHistoryEntry = {\n            tool: ['brush', 'SketchyBrush'],\n            actions: [\n                {\n                    action: 'setScale',\n                    params: [this.settingScale],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize / 2],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setBlending',\n                    params: [this.settingBlending],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n\n    isDrawing (): boolean {\n        return this.inputIsDrawing;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB, TPressureInput} from '../kl-types';\nimport {IVector2D} from '../../bb/bb-types';\nimport {BezierLine} from '../../bb/math/line';\nimport {ERASE_COLOR} from './erase-color';\nimport {throwIfNull} from '../../bb/base/base';\n\nexport interface IPixelBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'PixelBrush'];\n    actions: THistoryInnerActions<PixelBrush>[];\n}\n\n\nexport class PixelBrush {\n\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IPixelBrushHistoryEntry | undefined;\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingHasSizePressure: boolean = true;\n    private settingHasOpacityPressure: boolean = false;\n    private settingSize: number = 0.5;\n    private settingSpacing: number = 0.9;\n    private settingOpacity: number = 1;\n    private settingColor: IRGB = {} as IRGB;\n    private settingColorStr: string = '';\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingUseDither: boolean = true;\n    private inputIsDrawing: boolean = false;\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private bezierLine: BezierLine | null = null;\n    private readonly ditherArr: [number, number][] = [\n        [3, 2],\n        [1, 0],\n        [3, 0],\n        [1, 2],\n        [2, 1],\n        [0, 3],\n        [0, 1],\n        [2, 3],\n\n        [2, 0],\n        [0, 2],\n        [0, 0],\n        [2, 2],\n        [1, 1],\n        [3, 3],\n        [3, 1],\n        [1, 3],\n    ];\n    private readonly ditherCanvas: HTMLCanvasElement;\n    private readonly ditherCtx: CanvasRenderingContext2D;\n    private ditherPattern: CanvasPattern = {} as CanvasPattern;\n\n\n    private updateDither (): void {\n        this.ditherCtx.clearRect(0, 0, 4, 4);\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})` : this.settingColorStr;\n        for (let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++) {\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\n        }\n        this.ditherPattern = throwIfNull(this.context.createPattern(this.ditherCanvas, 'repeat'));\n    }\n\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     */\n    private cubicCurveOverThreshold (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, maxAngleRad: number): boolean {\n        const d = BB.Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y,\n        });\n        const d2 = BB.Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y,\n        });\n        const d3 = BB.Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y,\n        });\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\n    }\n\n    private plotCubicBezierLine (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D): void {\n\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n\n        const n = Math.max(2, Math.round(dist / 4));\n        const pointArr = [];\n        for (let i = 0; i <= n; i++) {\n            const t = i / n;\n            const a = Math.pow(1 - t, 3);\n            const b = 3 * t * Math.pow(1 - t, 2);\n            const c = 3 * Math.pow(t, 2) * (1 - t);\n            const d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\n            });\n        }\n\n        for (let i = 0; i < n; i++) {\n            this.plotLine(\n                Math.round(pointArr[i].x),\n                Math.round(pointArr[i].y),\n                Math.round(pointArr[i + 1].x),\n                Math.round(pointArr[i + 1].y),\n                true\n            );\n        }\n    }\n\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\n        this.context.save();\n        if (this.settingIsEraser) {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\n        this.context.fillRect(\n            Math.round(x + -size),\n            Math.round(y + -size),\n            Math.round(size * 2),\n            Math.round(size * 2)\n        );\n        this.context.restore();\n    }\n\n    private continueLine (\n        x: number | null,\n        y: number | null,\n        size: number,\n        pressure: number\n    ): void {\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\n        }\n\n        this.context.save();\n\n        const dotCallback = (\n            val: {\n                x: number;\n                y: number;\n                t: number;\n                angle?: number;\n                dAngle: number;\n            }\n        ): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n\n        const controlCallback = (\n            controlObj: {\n                p1: IVector2D;\n                p2: IVector2D;\n                p3: IVector2D;\n                p4: IVector2D;\n            }\n        ): void => {\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        };\n\n        if (Math.round(this.settingSize * 2) === 1) {\n            if (x === null || y === null) {\n                this.bezierLine.addFinal(4, undefined, controlCallback);\n            } else {\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\n            }\n\n        } else {\n            const localSpacing = size * this.settingSpacing;\n\n            if (x === null || y === null) {\n                this.bezierLine.addFinal(localSpacing, dotCallback);\n            } else {\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\n            }\n        }\n\n        this.context.restore();\n    }\n\n\n    /**\n     * bresenheim line drawing\n     */\n    private plotLine (x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\n        this.context.save();\n\n        if (this.settingIsEraser) {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\n\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n\n        const dX = Math.abs(x1 - x0);\n        const sX = x0 < x1 ? 1 : -1;\n        const dY = -Math.abs(y1 - y0);\n        const sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            if (skipFirst) {\n                skipFirst = false;\n            } else {\n                this.context.fillRect(x0, y0, 1, 1);\n            }\n            if (x0 === x1 && y0 === y1) {\n                break;\n            }\n            const e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n\n        this.context.restore();\n    }\n\n\n\n    // ---- public ----\n    constructor () {\n        this.ditherCanvas = BB.canvas(4, 4);\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\n    }\n\n    // ---- interface ----\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'PixelBrush'],\n            actions: [\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n                {\n                    action: 'setIsEraser',\n                    params: [this.settingIsEraser],\n                },\n                {\n                    action: 'setUseDither',\n                    params: [this.settingUseDither],\n                },\n            ],\n        };\n\n        if (this.settingUseDither) {\n            this.updateDither();\n        }\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\n\n        this.inputIsDrawing = true;\n        this.drawDot(x, y, localSize, localOpacity);\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        this.historyEntry.actions!.push({\n            action: 'startLine',\n            params: [x, y, p],\n        });\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.inputIsDrawing) {\n            return;\n        }\n        this.historyEntry!.actions!.push({\n            action: 'goLine',\n            params: [x, y, p],\n        });\n\n        //debug\n        //drawDot(x, y, 1, 0.5);\n\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (x: number, y: number): void {\n\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n\n        this.inputIsDrawing = false;\n\n        this.bezierLine = null;\n\n        if (this.historyEntry) {\n            this.historyEntry.actions!.push({\n                action: 'endLine',\n                params: [x, y],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n\n    //cheap n' ugly\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n        if (this.settingUseDither) {\n            this.updateDither();\n        }\n\n        if (Math.round(this.settingSize * 2) === 1) {\n            this.plotLine(x1, y1, x2, y2, true);\n        } else {\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n            const eX = (x2 - x1) / mouseDist;\n            const eY = (y2 - y1) / mouseDist;\n            let loopDist;\n            const bdist = this.settingSize * this.settingSpacing;\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\n            for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n                this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\n            }\n        }\n\n        const historyEntry: IPixelBrushHistoryEntry = {\n            tool: ['brush', 'PixelBrush'],\n            actions: [\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n                {\n                    action: 'setIsEraser',\n                    params: [this.settingIsEraser],\n                },\n                {\n                    action: 'setUseDither',\n                    params: [this.settingUseDither],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n    //IS\n    isDrawing (): boolean {\n        return this.inputIsDrawing;\n    }\n\n    //SET\n    setColor (c: IRGB): void {\n        if (this.settingColor === c) {\n            return;\n        }\n        this.settingColor = c;\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = Math.round(s * 2) / 2;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = b;\n    }\n\n    setUseDither (b: boolean): void {\n        this.settingUseDither = b;\n    }\n\n    //GET\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    getUseDither (): boolean {\n        return this.settingUseDither;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {TPressureInput} from '../kl-types';\nimport {BezierLine} from '../../bb/math/line';\nimport {ERASE_COLOR} from './erase-color';\nimport {KlCanvasContext} from '../canvas/kl-canvas';\n\nexport interface IEraserBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'EraserBrush'];\n    actions: THistoryInnerActions<EraserBrush>[];\n}\n\nexport class EraserBrush {\n\n    private size: number = 30;\n    private spacing: number = 0.4;\n    private opacity: number = 1;\n    private useSizePressure: boolean = true;\n    private useOpacityPressure: boolean = false;\n    private isTransparentBG: boolean = false;\n\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IEraserBrushHistoryEntry | undefined;\n    private isBaseLayer: boolean = false;\n    private context: KlCanvasContext = {} as KlCanvasContext;\n\n    private started: boolean = false;\n    private lastDot: number | undefined;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private bezierLine: BezierLine | undefined;\n\n\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\n        this.context.save();\n        if (this.isBaseLayer) {\n            if (this.isTransparentBG) {\n                this.context.globalCompositeOperation = 'destination-out';\n            } else {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        } else {\n            this.context.globalCompositeOperation = 'destination-out';\n        }\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        const oFac = Math.max(0, Math.min(1, opacity));\n        const localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(sharpness, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')');\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\n        this.context.fillStyle = radgrad;\n        this.context.translate(x - size, y - size);\n        this.context.fillRect(0, 0, size * 2, size * 2);\n        this.context.restore();\n    }\n\n    private continueLine (x: number | undefined, y: number | undefined, p: number): void {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\n\n        const bezierCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.useOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.useSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n\n        if (x === undefined || y === undefined) {\n            this.bezierLine!.addFinal(bdist, bezierCallback);\n        } else {\n            this.bezierLine!.add(x, y, bdist, bezierCallback);\n        }\n    }\n\n    // ---- public -----\n    constructor () {}\n\n    // ---- interface ----\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'EraserBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.useOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.useSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.size],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.opacity],\n                },\n                {\n                    action: 'setTransparentBG',\n                    params: [this.isTransparentBG],\n                },\n                {\n                    action: 'startLine',\n                    params: [x, y, p],\n                },\n            ],\n        };\n\n        this.isBaseLayer = 0 === this.context.canvas.index;\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = (this.useOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n        this.started = true;\n        if (localSize > 1) {\n            this.drawDot(x, y, localSize, localOpacity);\n        }\n        this.lastDot = localSize * this.spacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, () => undefined);\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.started || !this.historyEntry) {\n            return;\n        }\n        this.historyEntry.actions?.push({\n            action: 'goLine',\n            params: [x, y, p],\n        });\n\n        this.continueLine(x, y, this.lastInput.pressure);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n    }\n\n    endLine (): void {\n\n        if (this.bezierLine) {\n            this.continueLine(undefined, undefined, this.lastInput.pressure);\n        }\n\n        this.started = false;\n        this.bezierLine = undefined;\n\n        if (this.historyEntry) {\n            this.historyEntry.actions?.push({\n                action: 'endLine',\n                params: [],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n\n        this.isBaseLayer = 0 === this.context.canvas.index;\n\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.started || x1 === undefined) {\n            return;\n        }\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\n        this.lastDot = 0;\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\n        }\n\n\n        const historyEntry: IEraserBrushHistoryEntry = {\n            tool: ['brush', 'EraserBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.useOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.useSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.size],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.opacity],\n                },\n                {\n                    action: 'setTransparentBG',\n                    params: [this.isTransparentBG],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n    //IS\n    isDrawing (): boolean {\n        return this.started;\n    }\n\n    //SET\n    setContext (c: KlCanvasContext): void {\n        this.context = c;\n    }\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    sizePressure (b: boolean): void {\n        this.useSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.useOpacityPressure = b;\n    }\n\n    setTransparentBG (b: boolean): void {\n        this.isTransparentBG = b;\n    }\n\n    //GET\n    getSize (): number {\n        return this.size;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB} from '../kl-types';\nimport {clamp} from '../../bb/math/math';\nimport {BezierLine, TBezierLineCallback} from '../../bb/math/line';\n\nexport interface ISmudgeBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'SmudgeBrush'];\n    actions: THistoryInnerActions<SmudgeBrush>[];\n}\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\n\nconst CELL_SIZE = 256;\n\ninterface ISmudgeParams {\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {\n        w: number;\n        h: number;\n    };\n    brush: {\n        center: IVector2D;\n        size: number;\n        opacity: number;\n        alphaLock: boolean;\n    };\n}\n\n\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */\nfunction prepSmudge (\n    imWidth: number,\n    imHeight: number,\n    aP: IVector2D, // top left of source, integers\n    bP: IVector2D, // top left of dest, integers\n    size: {w: number; h: number}, // size of both rectangles, integers\n): ({\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {w: number; h: number};\n} | null) {\n\n    if (aP.x === bP.x && aP.y === bP.y) {\n        return null;\n    }\n\n    aP = BB.copyObj(aP);\n    bP = BB.copyObj(bP);\n    size = BB.copyObj(size);\n\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n\n        if (aP.x < 0) {\n            left = -aP.x;\n        }\n        if (aP.y < 0) {\n            top = -aP.y;\n        }\n        if (bP.x < 0) {\n            left = Math.max(left, -bP.x);\n        }\n        if (bP.y < 0) {\n            top = Math.max(top, -bP.y);\n        }\n        if (aP.x + size.w > imWidth) {\n            right = aP.x + size.w - imWidth;\n        }\n        if (aP.y + size.h > imHeight) {\n            bottom = aP.y + size.h - imHeight;\n        }\n        if (bP.x + size.w > imWidth) {\n            right = Math.max(right, bP.x + size.w - imWidth);\n        }\n        if (bP.y + size.h > imHeight) {\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        }\n\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) {\n            return null;\n        }\n    }\n\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y,\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y,\n        },\n        size: {\n            w: size.w,\n            h: size.h,\n        },\n    };\n}\n\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */\nfunction smudge (imageData: ImageData, p : ISmudgeParams): void {\n\n    p = BB.copyObj(p);\n\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/\n\n\n    // determine offset\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr: number[] = [];\n    for (let i = 0; i < randLen; i++) {\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    }\n\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\n\n        const dist = BB.dist(cX, cY, ix, iy);\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n\n        if (fac === 1) {\n            return;\n        }\n\n        if (!imageData.data[ai + 3]) {\n            /* empty */\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\n            imageData.data[bi] = imageData.data[ai];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            } else {\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            }\n\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) {\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n        }\n\n    };\n\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) {\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else if (p.aP.y > p.bP.y) {\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else {\n        if (p.aP.x < p.bP.x) {\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        } else {\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        }\n    }\n\n    //statCount++;\n    //statAcc += performance.now() - start;\n}\n\nexport class SmudgeBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: ISmudgeBrushHistoryEntry | undefined;\n\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\n    private settingSize: number = 35;\n    private settingSpacing: number = 0.20446882736951905;\n    private settingOpacity: number = 0.8;\n    private settingHasSizePressure: boolean = false;\n    private settingHasOpacityPressure: boolean = false;\n    private settingLockLayerAlpha: boolean = false;\n\n    private lineToolLastDot: number = 0;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastDot: IVector2D | undefined;\n\n    private isDrawing: boolean = false;\n\n    private bezierLine: BezierLine | undefined;\n\n    private redrawBounds: IBounds | undefined;\n    private completeRedrawBounds: IBounds | undefined;\n\n    private copyImageData: ImageData = {} as ImageData;\n\n    private drawBuffer: ISmudgeParams[] = [];\n\n    private copiedCells: boolean[] = [];\n\n    // workaround for https://github.com/microsoft/TypeScript/issues/41654\n    private resetRedrawBounds (): void {\n        this.redrawBounds = undefined;\n    }\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private updateCompleteRedrawBounds (x1: number, y1: number, x2: number, y2: number): void {\n        this.completeRedrawBounds = BB.updateBounds(\n            this.completeRedrawBounds,\n            { x1, y1, x2, y2 }\n        );\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    copyFromCanvas (): void {\n\n        const touchedCells = this.copiedCells.map(() => false);\n\n        const bounds: IBounds[] = [];\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\n\n        if (!this.redrawBounds) {\n            return;\n        }\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\n        });\n        bounds.forEach(item => {\n            for (let i = item.x1; i <= item.x2; i++) {\n                for (let e = item.y1; e <= item.y2; e++) {\n                    touchedCells[e * cellsW + i] = true;\n                }\n            }\n        });\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.copiedCells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = BB.ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\n\n            const data = tmpCtx.getImageData(0, 0, w, h);\n\n            for (let i = 0; i < h; i++) {\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\n                    this.copyImageData.data[e3] = data.data[e2];\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                }\n            }\n        });\n    }\n\n\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */\n    prepDot (x: number, y: number, size: number, opacity: number): void {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y,\n            };\n            return;\n        }\n\n        size = Math.round(size);\n\n\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n\n        const bounds = prepSmudge(\n            this.copyImageData.width,\n            this.copyImageData.height,\n            {\n                x: Math.round(this.lastDot.x - size),\n                y: Math.round(this.lastDot.y - size),\n            },\n            {\n                x: Math.round(x - size),\n                y: Math.round(y - size),\n            },\n            {\n                w,\n                h,\n            },\n        );\n\n        if (bounds) {\n            const params: ISmudgeParams = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: { x, y },\n                    size,\n                    opacity,\n                    alphaLock: this.settingLockLayerAlpha,\n                },\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2,\n            });\n            this.drawBuffer.push(params);\n        }\n\n        this.lastDot = {\n            x: x,\n            y: y,\n        };\n    }\n\n    continueLine (x: number | undefined, y: number | undefined, size: number, pressure: number): void {\n        this.drawBuffer = [];\n\n        if (!this.bezierLine) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function (){});\n        }\n\n        const drawArr: Parameters<typeof this.prepDot>[] = []; //draw instructions. will be all drawn at once\n\n        const dotCallback: TBezierLineCallback = (val): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity]);//, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing / 3;\n        if (x === undefined || y === undefined) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n        }\n\n        this.copyFromCanvas();\n\n        for (let i = 0; i < this.drawBuffer.length; i++) {\n            smudge(this.copyImageData, this.drawBuffer[i]);\n        }\n    }\n\n\n\n    // ---- public ----\n\n    constructor () { }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'SmudgeBrush'],\n            actions: [],\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.lastDot = undefined;\n        this.isDrawing = true;\n\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\n        this.copiedCells = '0'.repeat(totalCells).split('').map(() => false);\n\n        this.prepDot(x, y, localSize, localOpacity);\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.completeRedrawBounds = undefined;\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        this.resetRedrawBounds();\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (): void {\n        this.resetRedrawBounds();\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(undefined, undefined, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        if (this.historyEntry && this.completeRedrawBounds) {\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\n            if (!(\n                this.completeRedrawBounds.x1 === 0 &&\n                this.completeRedrawBounds.y1 === 0 &&\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\n            )) {\n\n                // temp canvas to prevent main canvas from getting slowed down in chrome\n                const tmpCanvas = BB.canvas(\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n                );\n                const tmpCtx = BB.ctx(tmpCanvas);\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n            }\n            this.historyEntry.actions.push({\n                action: 'drawImage',\n                params: [\n                    historyIm,\n                    this.completeRedrawBounds.x1,\n                    this.completeRedrawBounds.y1,\n                ],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.copyImageData = {} as ImageData;\n    }\n\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\n        if (im instanceof ImageData) {\n            this.context.putImageData(im, x, y);\n        } else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        return;\n        /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl-types';\nimport {IBounds} from '../../bb/bb-types';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {ERASE_COLOR} from './erase-color';\nimport {KL} from '../kl';\n\nexport interface IChemyBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'ChemyBrush'];\n    actions: THistoryInnerActions<ChemyBrush>[];\n}\n\ntype TChemyMode = 'fill' | 'stroke';\n\nexport class ChemyBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingColor: IRGB = {} as IRGB;\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\n    private settingOpacity: number = 1; // 0-1\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingMode: TChemyMode = 'fill';\n    private settingDistort: number = 0; // 0 - 1\n    private settingXSymmetry: boolean = false;\n    private settingYSymmetry: boolean = false;\n    private settingGradient: boolean = false;\n\n    private isDrawing: boolean = false;\n\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n\n    private copyCanvas: HTMLCanvasElement = {} as HTMLCanvasElement;\n    private path: {x: number; y: number}[] = [];\n    private minY: number = 0;\n    private maxY: number = 0;\n    private completeRedrawBounds: IBounds | undefined;\n\n    private updateCompleteRedrawBounds (x: number, y: number): void {\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\n        if (this.settingXSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: -x + this.copyCanvas.width,\n                    y1: y,\n                    x2: -x + this.copyCanvas.width,\n                    y2: y,\n                }\n            );\n        }\n        if (this.settingYSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: x,\n                    y1: -y + this.copyCanvas.height,\n                    x2: x,\n                    y2: -y + this.copyCanvas.height,\n                }\n            );\n        }\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\n    }\n\n    private drawShape (): void {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n\n        const color = {...this.settingColor};\n        if (this.settingIsEraser) {\n            color.r = ERASE_COLOR;\n            color.g = ERASE_COLOR;\n            color.b = ERASE_COLOR;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n\n        if (this.path.length > 1) {\n\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index) => {\n                if (index === 0) {\n                    path.moveTo(item.x, item.y);\n                } else {\n                    path.lineTo(item.x, item.y);\n                }\n            });\n\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity,\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(\n                    0, startAtTop ? this.minY : this.maxY,\n                    0, startAtTop ? this.maxY : this.minY,\n                );\n                gradient.addColorStop(\n                    0,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity,\n                    })\n                );\n                gradient.addColorStop(\n                    1,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: 0,\n                    })\n                );\n                style = gradient;\n            }\n\n            // setup params\n            if (this.settingMode === 'fill') {\n                this.context.fillStyle = style;\n\n            } else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = 'bevel';\n                this.context.strokeStyle = style;\n            }\n\n            // draw\n            const draw = () => {\n                if (this.settingMode === 'fill') {\n                    this.context.fill(path);\n                } else {\n                    this.context.stroke(path);\n                }\n            };\n\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                    this.context.scale(-1, -1);\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n\n        this.context.restore();\n    }\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setMode (mode: TChemyMode): void {\n        this.settingMode = mode;\n    }\n\n    getMode (): TChemyMode {\n        return this.settingMode;\n    }\n\n    setDistort (distort: number): void {\n        this.settingDistort = BB.clamp(distort, 0, 1);\n    }\n\n    getDistort (): number {\n        return this.settingDistort;\n    }\n\n    setXSymmetry (b: boolean): void {\n        this.settingXSymmetry = b;\n    }\n\n    getXSymmetry (): boolean {\n        return this.settingXSymmetry;\n    }\n\n    setYSymmetry (b: boolean): void {\n        this.settingYSymmetry = b;\n    }\n\n    getYSymmetry (): boolean {\n        return this.settingYSymmetry;\n    }\n\n    setGradient (b: boolean): void {\n        this.settingGradient = b;\n    }\n\n    getGradient (): boolean {\n        return this.settingGradient;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    startLine (x: number, y: number): void {\n        this.isDrawing = true;\n        this.path = [{x, y}];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = undefined;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n\n    goLine (x: number, y: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        const pos = { x, y };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n\n    endLine (): void {\n        this.isDrawing = false;\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const historyCanvas = BB.canvas(\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n            );\n            const historyCtx = BB.ctx(historyCanvas);\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n            this.history.push({\n                tool: ['brush', 'ChemyBrush'],\n                actions: [\n                    {\n                        action: 'drawImage',\n                        params: [\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1,\n                        ],\n                    },\n                ],\n            } as IChemyBrushHistoryEntry);\n        }\n        this.path = [];\n        this.copyCanvas = {} as HTMLCanvasElement;\n    }\n\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\n        this.context.save();\n        this.context.clearRect(x, y, im.width, im.height);\n        this.context.drawImage(im, x, y);\n        this.context.restore();\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        // might make sense for stroke\n    }\n}\n","import {penBrushUi} from './pen-brush-ui';\nimport {blendBrushUi} from './blend-brush-ui';\nimport {sketchyBrushUi} from './sketchy-brush-ui';\nimport {pixelBrushUi} from './pixel-brush-ui';\nimport {eraserBrushUi} from './eraser-brush-ui';\nimport {smudgeBrushUi} from './smudge-brush-ui';\nimport {chemyBrushUi} from './chemy-brush-ui';\nimport {IBrushUi} from '../kl-types';\n\n/**\n * UI for brushes.\n * Each brush ui carries the brush with it.\n * So if you want to draw, you do it through the UI. should be changed sometime.\n */\n\nexport const brushesUI: {\n    [key: string]: IBrushUi<any>;\n} = {\n    penBrush: penBrushUi,\n    blendBrush: blendBrushUi,\n    sketchyBrush: sketchyBrushUi,\n    pixelBrush: pixelBrushUi,\n    chemyBrush: chemyBrushUi,\n    smudgeBrush: smudgeBrushUi,\n    eraserBrush: eraserBrushUi,\n};\n","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from '/src/app/img/ui/brush-pen.svg';\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {Options} from '../ui/components/options';\nimport {PenBrush} from '../brushes/pen-brush';\n\n\nexport const penBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pen'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1/100,\n            max: 1,\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]],\n        },\n    } as IBrushUi<PenBrush>;\n\n    let alphaNames = [\n        LANG('brush-pen-circle'),\n        LANG('brush-pen-chalk'),\n        LANG('brush-pen-calligraphy'),\n        LANG('brush-pen-square'),\n    ];\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pen');\n        alphaNames = [\n            LANG('brush-pen-circle'),\n            LANG('brush-pen-chalk'),\n            LANG('brush-pen-calligraphy'),\n            LANG('brush-pen-square'),\n        ];\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.PenBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const alphaOptions = new Options({\n            optionArr: [0, 1, 2, 3].map(id => {\n\n                const alpha = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        width: '31px',\n                        height: '31px',\n                        backgroundSize: 'contain',\n                        margin: '2px',\n                    },\n                });\n                const canvas = BB.canvas(70, 70);\n                const ctx = BB.ctx(canvas);\n                if (id === 0 || id === 3) {\n                    if (id === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else {\n                        ctx.fillRect(5, 5, 60, 60);\n                    }\n                } else if (id === 1) {\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\n                } else if (id === 2) {\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\n                }\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\n\n                return {\n                    id: id,\n                    label: alpha,\n                    title: alphaNames[id],\n                };\n            }),\n            initId: 0,\n            onChange: (id) => {\n                brush.setAlpha(id);\n            },\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                display: 'inline-block',\n            },\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize (size: number) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n                BB.el({\n                    content: alphaOptions.getElement(),\n                    css: {\n                        marginTop: '10px',\n                    },\n                }),\n                BB.el({\n                    content: lockAlphaToggle.getElement(),\n                    css: {\n                        marginTop: '10px',\n                    },\n                }),\n            );\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<PenBrush>['Ui'];\n    return brushInterface;\n})();","\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-pen.bb14ef6e.svg\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport brushIconImg from '/src/app/img/ui/brush-blend.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {BlendBrush} from '../brushes/blend-brush';\n\nexport const blendBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-blend'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<BlendBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-blend');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.BlendBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize (size: number): void {\n            brush.setSize(size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 58,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            const blendingSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            blendingSlider.getElement().style.marginTop = '10px';\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.setSizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.setOpacityPressure(b);\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                    display: 'inline-block',\n                },\n            });\n\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n                blendingSlider.getElement(),\n                lockAlphaToggle.getElement()\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<BlendBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-blend.bc748f1f.svg\" + \"?\" + Date.now();","import {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport brushIconImg from '/src/app/img/ui/brush-sketchy.png';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {BB} from '../../bb/bb';\nimport {SketchyBrush} from '../brushes/sketchy-brush';\n\nexport const sketchyBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-sketchy'),\n        sizeSlider: {\n            min: 0.5,\n            max: 10,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<SketchyBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-sketchy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.SketchyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize (size: number) {\n            brush.setSize(size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize() * 2,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: function (val) {\n                    brush.setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            const blendSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            const scaleSlider = new KlSlider({\n                label: LANG('brush-sketchy-scale'),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                value: brush.getScale(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setScale(val);\n                },\n            });\n            opacitySlider.getElement().style.marginTop = '10px';\n            blendSlider.getElement().style.marginTop = '10px';\n            scaleSlider.getElement().style.marginTop = '10px';\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                blendSlider.getElement(),\n                scaleSlider.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function (x, y, pressure) {\n            brush.goLine(x, y, pressure, undefined);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getSeed = function () {\n            return parseInt('' + brush.getSeed());\n        };\n        this.setSeed = function (s) {\n            brush.setSeed(parseInt('' + s));\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<SketchyBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-sketchy.609fadbe.png\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from '/src/app/img/ui/brush-pixel.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {PixelBrush} from '../brushes/pixel-brush';\n\nexport const pixelBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pixel'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\n        },\n    } as IBrushUi<PixelBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pixel');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.PixelBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                marginRight: '10px',\n            },\n        });\n\n        const eraserToggle = new Checkbox({\n            init: brush.getIsEraser(),\n            label: LANG('eraser'),\n            callback: function (b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: '10px',\n            },\n        });\n\n        const ditherToggle = new Checkbox({\n            init: brush.getUseDither(),\n            label: LANG('brush-pixel-dither'),\n            callback: function (b) {\n                brush.setUseDither(b);\n            },\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\n\n        function setSize (size: number) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                opacitySlider.getElement()\n            );\n\n            const toggleRow = BB.el({\n                parent: div,\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                },\n            });\n\n            toggleRow.append(\n                lockAlphaToggle.getElement(),\n                eraserToggle.getElement(),\n                ditherToggle.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size * 2);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity * 100);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.toggleEraser = () => {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<PixelBrush>['Ui'];\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-pixel.cebba447.svg\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport {Checkbox} from '../ui/components/checkbox';\nimport brushIconImg from '/src/app/img/ui/brush-eraser.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {EraserBrush} from '../brushes/eraser-brush';\n\nexport const eraserBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('eraser') + ' [E]',\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<EraserBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.EraserBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n        let isTransparentBg = false;\n\n        function setSize (size: number) {\n            brush.setSize(size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 30,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                })\n            );\n\n            const transparencyToggle = new Checkbox({\n                init: false,\n                label: LANG('brush-eraser-transparent-bg'),\n                callback: function (b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            div.append(transparencyToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function () {\n        };\n        this.setContext = function (c) {\n            brush.setContext(c as Parameters<EraserBrush['setContext']>[0]);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.getIsTransparentBg = function () {\n            return isTransparentBg;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<EraserBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-eraser.a779dd09.svg\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from '/src/app/img/ui/brush-smudge.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {SmudgeBrush} from '../brushes/smudge-brush';\n\nexport const smudgeBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-smudge'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\n        },\n    } as IBrushUi<SmudgeBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-smudge');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.SmudgeBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize (size: number) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                })\n            );\n\n            const bottomRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<SmudgeBrush>['Ui'];\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-smudge.0d4a0e17.svg\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport brushIconImg from '/src/app/img/ui/brush-chemy.svg';\nimport {IBrushUi} from '../kl-types';\nimport {Options} from '../ui/components/options';\nimport {BoxToggle} from '../ui/components/box-toggle';\nimport {LANG, languageStrings} from '../../language/language';\nimport {ChemyBrush} from '../brushes/chemy-brush';\n\nexport const chemyBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-chemy'),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<ChemyBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-chemy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.ChemyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize (size: number) {\n            brush.setSize(size);\n        }\n\n        let eraserToggle: Checkbox;\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                isEnabled: brush.getMode() === 'stroke',\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 5) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            BB.css(opacitySlider.getElement(), {\n                marginTop: '10px',\n            });\n\n            eraserToggle = new Checkbox({\n                init: brush.getIsEraser(),\n                label: LANG('eraser'),\n                callback: function (b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: '10px',\n                    marginLeft: '10px',\n                },\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                },\n            });\n\n            const toggleRow = BB.el({\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                },\n            });\n\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n\n            const modeOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'fill',\n                        label: BB.createSvg({\n                            class: 'dark-invert',\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: '#000',\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-fill'),\n                    },\n                    {\n                        id: 'stroke',\n                        label: BB.createSvg({\n                            class: 'dark-invert',\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: 'none',\n                                    stroke: '#000',\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-stroke'),\n                    },\n                ],\n                initId: brush.getMode(),\n                onChange: (id: string): void => {\n                    brush.setMode(id as 'stroke' | 'fill');\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n\n                    const brushSize = brush.getSize();\n                    sizeSlider.setValue(brushSize);\n                    p.onSizeChange(brushSize);\n                    p.onConfigChange();\n                },\n            });\n\n            const mirrorXToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-mirror-x'),\n                init: brush.getXSymmetry(),\n                onChange: (b) => {\n                    brush.setXSymmetry(b);\n                },\n            });\n\n            const mirrorYToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-mirror-y'),\n                init: brush.getYSymmetry(),\n                onChange: (b) => {\n                    brush.setYSymmetry(b);\n                },\n            });\n\n            const gradientToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'defs',\n                            childrenArr: [\n                                {\n                                    elementType: 'linearGradient',\n                                    id: 'gradient',\n                                    x1: '0',\n                                    y1: '0',\n                                    x2: '0',\n                                    y2: '1',\n                                    childrenArr: [\n                                        {\n                                            elementType: 'stop',\n                                            offset: '0%',\n                                            'stop-color': 'rgba(0,0,0,0)',\n                                        },\n                                        {\n                                            elementType: 'stop',\n                                            offset: '100%',\n                                            'stop-color': 'rgba(0,0,0,1)',\n                                        },\n                                    ],\n                                },\n                            ],\n                        },\n                        {\n                            elementType: 'rect',\n                            fill: \"url('#gradient')\",\n                            x: '' + padding,\n                            y: '' + padding,\n                            width: '' + actualIconSize,\n                            height: '' + actualIconSize,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-gradient'),\n                init: brush.getGradient(),\n                onChange: (b) => {\n                    brush.setGradient(b);\n                },\n            });\n\n            BB.css(mirrorXToggle.getElement(), {\n                marginLeft: '10px',\n            });\n            {\n                const margin = {\n                    marginLeft: '4px',\n                };\n                BB.css(mirrorYToggle.getElement(), margin);\n                BB.css(gradientToggle.getElement(), margin);\n            }\n\n            toggleRow.append(\n                modeOptions.getElement(),\n                mirrorXToggle.getElement(),\n                mirrorYToggle.getElement(),\n                gradientToggle.getElement(),\n            );\n\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                toggleRow,\n                BB.el({\n                    content: [\n                        lockAlphaToggle.getElement(),\n                        eraserToggle.getElement(),\n                    ],\n                    css: {\n                        display: 'flex',\n                    },\n                })\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.toggleEraser = () => {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<ChemyBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"brush-chemy.2ccbdc42.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {DynamicModal} from './base/dynamic-modal';\nimport {LANG} from '../../../language/language';\n\nexport function showIframeModal (\n    url: string,\n    isEmbed: boolean,\n) {\n\n    // window very small, modal might look bad\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\n        window.open(url);\n        return;\n    }\n\n    const iframe = BB.el({\n        tagName: 'iframe',\n        custom: {\n            src: url,\n        },\n        css: {\n            width: '100%',\n            height: '100%',\n            opacity: '0',\n        },\n    });\n    setTimeout(() => {\n        iframe.style.opacity = ''; // fallback\n    }, 500);\n\n    const titleEl = BB.el();\n\n    let linkEl: HTMLElement | undefined;\n    if (!isEmbed) {\n        linkEl = BB.el({\n            tagName: 'a',\n            parent: titleEl,\n            content: LANG('modal-new-tab'),\n            custom: {\n                href: 'help',\n                target: '_blank',\n            },\n            onClick: function () {\n                popup.close();\n            },\n        });\n        iframe.onload = () => {\n            if (linkEl && iframe.contentWindow) {\n                BB.setAttributes(linkEl, {\n                    href: '' + iframe.contentWindow.location,\n                });\n            }\n            iframe.style.opacity = '';\n        };\n    }\n\n\n    const popup = new DynamicModal({\n        title: titleEl,\n        content: iframe,\n        width: 880,\n        isMaxHeight: true,\n        onClose: () => {\n            if (linkEl) {\n                iframe.src = 'about:blank';\n                BB.destroyEl(linkEl);\n                linkEl = undefined;\n            }\n        },\n    });\n\n}","import {BB} from '../../../bb/bb';\n\nexport class RadioList {\n\n    el: HTMLDivElement;\n    inputs: HTMLInputElement[] = [];\n\n    constructor ({name, init, items, ignoreFocus}: {\n        name: string;\n        init?: string;\n        items: {\n            label: string;\n            value: string;\n        }[];\n        ignoreFocus?: boolean; // default false\n    }) {\n        this.el = BB.el({\n            className: 'kl-radio',\n        });\n\n        items.forEach(item => {\n            const label = BB.el({\n                tagName: 'label',\n            });\n            const input = BB.el({\n                tagName: 'input',\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: 'radio',\n                },\n            });\n            if (ignoreFocus) {\n                input.setAttribute('data-ignore-focus', 'true');\n            }\n            if (init === item.value) {\n                input.checked = true;\n            }\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n\n\n    getValue (): string | null {\n        for (let i = 0; i < this.inputs.length; i++) {\n            if (this.inputs[i].checked) {\n                return this.inputs[i].value;\n            }\n        }\n        return null;\n    }\n\n    getElement () {\n        return this.el;\n    }\n\n}","import {BB} from '../../../bb/bb';\n\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\nimport {IKlProject} from '../../kl-types';\nimport {showIframeModal} from '../modals/show-iframe-modal';\nimport {SaveReminder} from './save-reminder';\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\nimport {KL} from '../../kl';\nimport {LANG} from '../../../language/language';\nimport {theme} from '../../../theme/theme';\n\nexport class BrowserStorageUi {\n\n    private previewEl: HTMLDivElement = {} as HTMLDivElement;\n    private readonly infoEl: HTMLElement = {} as HTMLElement;\n    private readonly ageEl: HTMLElement = {} as HTMLElement;\n    private readonly storeButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\n    private readonly clearButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\n    private readonly storeListener: IProjectStoreListener = {} as IProjectStoreListener;\n    private readonly updateCheckerboard: () => void = () => {};\n\n    private timestamp: number | undefined;\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\n\n    private updateAge () {\n        if (!this.timestamp) {\n            return;\n        }\n        let age = new Date().getTime() - this.timestamp;\n        let ageStr;\n        age = Math.floor(age / 1000 / 60);\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\n        if (age > 60) {\n            age = Math.floor(age / 60);\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\n            if (age > 24) {\n                age = Math.floor(age / 24);\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\n                if (age > 31) {\n                    ageStr = LANG('file-storage-month-ago');\n                }\n            }\n        }\n        this.ageEl.textContent = ageStr;\n    }\n\n    private resetButtons () {\n        if (this.timestamp) {\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = false;\n        } else {\n            this.storeButtonEl.textContent = LANG('file-storage-store');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = true;\n        }\n    }\n\n    private updateThumb (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\n        this.timestamp = timestamp;\n        this.thumbnail = thumbnail;\n        if (this.timestamp && thumbnail) {\n            thumbnail.classList.add('kl-storage-preview__im');\n            this.previewEl.innerHTML = '';\n            this.updateAge();\n            this.previewEl.append(thumbnail, this.ageEl);\n        } else {\n            this.previewEl.innerHTML = LANG('file-storage-empty');\n        }\n        this.resetButtons();\n    }\n\n    private async store () {\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        await new Promise((resolve) => {\n            setTimeout(() => resolve(null), 20);\n        });\n        try {\n            await this.projectStore.store(this.getProject());\n            this.saveReminder.reset();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: [\n                    `${LANG('file-storage-failed-1')}<ul>`,\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\n                    '</ul>',\n                ].join(''),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    private async clear () {\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        try {\n            await this.projectStore.clear();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('file-storage-failed-clear'),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    element: HTMLDivElement;\n\n    constructor (\n        private projectStore: ProjectStore,\n        private getProject: () => IKlProject,\n        private saveReminder: SaveReminder,\n        private klRootEl: HTMLElement,\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\n    ) {\n        this.element = BB.el({\n            css: {\n                display: 'grid',\n                gridTemplateColumns: '1fr 0fr',\n                gridTemplateRows: '0fr 0fr 0fr',\n                gap: '0 0',\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\n            },\n        });\n\n\n        const title = BB.el({\n            parent: this.element,\n            content: LANG('file-storage'),\n            css: {\n                gridArea: 'title',\n                display: 'flex',\n                margin: '-5px 0',\n                gap: '5px',\n                //background: '#f00',\n            },\n        });\n\n        this.infoEl = BB.el({\n            parent: title,\n            content: '?',\n            className: 'kl-info-btn',\n            title: LANG('file-storage-about'),\n            onClick: () => {\n                showIframeModal('./help/#help-browser-storage', false);\n            },\n        });\n\n        if (this.projectStore.isBroken()) {\n            BB.el({\n                parent: this.element,\n                content: ' ' + LANG('file-storage-cant-access'),\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            return;\n        }\n\n        this.previewEl = BB.el({\n            parent: this.element,\n            title: LANG('file-storage-thumb-title'),\n            className: 'kl-storage-preview',\n        });\n        this.ageEl = BB.el({\n            css: {\n                position: 'absolute',\n                right: '1px',\n                bottom: '1px',\n                width: 'calc(100% - 2px)',\n                textAlign: 'center',\n                background: 'rgba(0,0,0,0.7)',\n                color: '#fff',\n                textSize: '13px',\n            },\n        });\n        const btnCustom: { [key: string]: string } = options?.isFocusable ?  {} : {\n            tabIndex: '-1',\n        };\n        this.storeButtonEl = BB.el({\n            parent: this.element,\n            tagName: 'button',\n            className: 'grid-button',\n            content: LANG('file-storage-store'),\n            css: {\n                gridArea: 'store',\n                //background: '#00f',\n            },\n            custom: btnCustom,\n            onClick: () => this.store(),\n        });\n        this.clearButtonEl = BB.el({\n            parent: this.element,\n            tagName: 'button',\n            className: 'grid-button',\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\n            css: {\n                gridArea: 'clear',\n                //background: '#ff0',\n            },\n            custom: btnCustom,\n            onClick: () => this.clear(),\n        });\n\n        if (this.options?.hideClearButton) {\n            this.clearButtonEl.style.visibility = 'hidden';\n        }\n\n        this.storeListener = {\n            onUpdate: (timestamp, thumbnail) => {\n                this.updateThumb(timestamp, thumbnail);\n            },\n        };\n        this.projectStore.subscribe(this.storeListener);\n\n        this.updateCheckerboard = (): void => {\n            if (!this.thumbnail) {\n                return;\n            }\n            BB.css(this.thumbnail, {\n                background: \"url('\" + BB.createCheckerCanvas(4, theme.isDark()).toDataURL('image/png') + \"')\",\n            });\n        };\n        theme.addIsDarkListener(this.updateCheckerboard);\n\n        setInterval(() => this.updateAge(), 1000 * 60);\n\n        (async () => {\n            try {\n                const readResult = await this.projectStore.read();\n                if (readResult) {\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\n                } else {\n                    this.updateThumb();\n                }\n            } catch (e) {\n                setTimeout(() => {\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\n                }, 0);\n            }\n        })();\n    }\n\n\n    getElement () {\n        return this.element;\n    }\n\n    show () {\n        // todo\n    }\n\n    hide () {\n        // todo\n    }\n\n    destroy () {\n        BB.destroyEl(this.infoEl);\n        BB.destroyEl(this.storeButtonEl);\n        BB.destroyEl(this.clearButtonEl);\n        theme.removeIsDarkListener(this.updateCheckerboard);\n        this.projectStore.unsubscribe(this.storeListener);\n    }\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\nimport {ProjectConverter, TReadStorageProjectResult} from './project-converter';\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\nimport {LocalStorage} from '../../bb/base/local-storage';\n\n\nexport interface IProjectStoreListener {\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void;\n}\n\nfunction makeAsync<T> (\n    nonAsyncFunc: (\n        resolveCallback: (value: T) => void,\n        rejectCallback: (reason?: unknown) => void\n    ) => void,\n): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        nonAsyncFunc(resolve, reject);\n    });\n}\n\n/**\n * simplified interface for storing projects into browser storage\n */\nexport class ProjectStore {\n\n    private listeners: IProjectStoreListener[] = [];\n    private accessHasFailed: boolean = false;\n\n    async lowLevelStore (project: IKlStorageProject): Promise<void> {\n        await new Promise<void>((resolve, reject) => {\n            storeKlProjectObj(project, resolve, reject);\n        });\n    }\n\n    async lowLevelRead (): Promise<IKlStorageProject> {\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\n    }\n\n    async lowLevelClear (): Promise<void> {\n        await makeAsync<void>(clear);\n    }\n\n\n\n    private emit (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement): void {\n        this.listeners.forEach(item => {\n            item.onUpdate(timestamp, thumbnail);\n        });\n    }\n\n    private updateTimestamp (): void {\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\n    }\n\n    // --- public ---\n\n    constructor () {\n        window.addEventListener('storage', (e) => {\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\n                return;\n            }\n            try {\n                ( async (): Promise<void> => {\n                    const readResult = await this.read();\n                    if (readResult) {\n                        this.emit(readResult.timestamp, readResult.thumbnail);\n                    } else {\n                        this.emit();\n                    }\n                })();\n            } catch (e) {\n                if (e instanceof Error && e.message.indexOf('db-error') === 0) {\n                    this.accessHasFailed = true;\n                }\n            }\n\n        });\n    }\n\n    async read (): Promise<{\n        project: IKlProject;\n        timestamp: number;\n        thumbnail: HTMLImageElement | HTMLCanvasElement;\n    } | undefined> {\n        let storageProject;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        if (!storageProject) {\n            return undefined;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async store (project: IKlProject): Promise<void> {\n        try {\n            const storageProject = ProjectConverter.createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        {\n            // immediately test if it can be read\n            const storageProject = await this.lowLevelRead();\n            let readResult: TReadStorageProjectResult;\n            try {\n                readResult = await ProjectConverter.readStorageProject(storageProject);\n            } catch (e) {\n                await this.lowLevelClear();\n                this.updateTimestamp();\n                setTimeout(() => this.emit(), 0);\n                throw new Error('format-error: ' + e);\n            }\n            this.updateTimestamp();\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\n        }\n    }\n\n    async clear (): Promise<void> {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(() => this.emit(), 0);\n    }\n\n    subscribe (listener: IProjectStoreListener): void {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    unsubscribe (listener: IProjectStoreListener): void {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (listener === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    isBroken (): boolean {\n        return this.accessHasFailed;\n    }\n\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\nimport {BB} from '../../bb/bb';\nimport {drawProject} from '../canvas/draw-project';\nimport {base64ToBlob} from './base-64-to-blob';\n\nexport type TReadStorageProjectResult = {\n    project: IKlProject;\n    timestamp: number;\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\n};\n\nconst thumbSize = 240;\n\nfunction loadImage (blob: Blob): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const im = new Image();\n        try {\n            im.src = BB.imageBlobToUrl(blob);\n        } catch (e) {\n            reject('imageBlobToUrl, ' + (e instanceof Error ? e.message : ''));\n            return;\n        }\n        im.onload = (): void => {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        };\n        im.onabort = (): void => {\n            reject('layer image failed loading');\n        };\n        im.onerror = (): void => {\n            reject('layer image failed loading');\n        };\n    });\n}\n\n/**\n * for:\n * - preparing project to be stored in ProjectStore\n * - reading a project that came out of the ProjectStore\n */\nexport class ProjectConverter {\n\n    private static createThumbnail (project: IKlProject): HTMLCanvasElement {\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\n        const factor = size.width / project.width;\n        return drawProject(project, factor);\n    }\n\n    static createStorageProject (project: IKlProject): IKlStorageProject {\n        return {\n            id: 1,\n            timestamp: new Date().getTime(),\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\n            width: project.width,\n            height: project.height,\n            layers: project.layers.map(item => {\n                let blob;\n                if (item.image instanceof HTMLCanvasElement) {\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\n                } else {\n                    // todo image\n                    throw new Error('Not implemented');\n                }\n                return {\n                    name: item.name,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                    blob,\n                };\n            }),\n        };\n    }\n\n    static async readStorageProject (storageProject: IKlStorageProject): Promise<TReadStorageProjectResult> {\n        if (\n            !storageProject.width || !storageProject.height ||\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\n            storageProject.width < 1 || storageProject.height < 1\n        ) {\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\n        }\n        const project: IKlProject = {\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\n                .map((image, i) => {\n                    const storageLayer = storageProject.layers[i];\n                    return {\n                        name: storageLayer.name,\n                        isVisible: 'isVisible' in storageLayer ? storageLayer.isVisible : true, // isVisible added 2023-07\n                        opacity: storageLayer.opacity,\n                        mixModeStr: storageLayer.mixModeStr,\n                        image,\n                    };\n                }),\n        };\n\n        let thumbnail;\n        if (storageProject.thumbnail) {\n            thumbnail = await loadImage(storageProject.thumbnail);\n        } else {\n            thumbnail = ProjectConverter.createThumbnail(project);\n        }\n\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: thumbnail,\n        };\n    }\n\n}","\nexport function base64ToBlob (base64Str: string): Blob {\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/) as [string, string ,string, string];\n    const binStr = atob(parts[3]);\n    const buf = new ArrayBuffer(binStr.length);\n    const view = new Uint8Array(buf);\n    for (let i = 0; i < view.length; i++) {\n        view[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([view], {'type': parts[1]});\n}","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\nimport {IKlProject, TDropOption, TExportType} from '../../kl-types';\nimport {SaveReminder} from '../components/save-reminder';\nimport {ProjectStore} from '../../storage/project-store';\nimport {LANG} from '../../../language/language';\nimport newImageImg from '/src/app/img/ui/new-image.svg';\nimport exportImg from '/src/app/img/ui/export.svg';\nimport shareImg from '/src/app/img/ui/share.svg';\nimport uploadImg from '/src/app/img/ui/upload.svg';\nimport importImg from '/src/app/img/ui/import.svg';\nimport copyImg from '/src/app/img/ui/copy.svg';\n\nexport class FileTab {\n\n    private readonly rootEl: HTMLDivElement;\n    private importButton: undefined | HTMLInputElement;\n    private fileBrowserStorage: undefined | BrowserStorageUi;\n\n    constructor (\n        klRootEl: HTMLElement,\n        projectStore: ProjectStore,\n        getProject: () => IKlProject,\n        private exportType: TExportType,\n        onExportTypeChange: (type: TExportType) => void,\n        onFileSelect: (fileList: FileList, optionStr: TDropOption) => void,\n        onSaveImageToComputer: () => void,\n        onNewImage: () => void,\n        onShareImage: (callback: () => void) => void,\n        onUpload: () => void,\n        onCopyToClipboard: () => void,\n        saveReminder: SaveReminder,\n    ) {\n        this.rootEl = document.createElement('div');\n\n        const asyncCreation = (): void => {\n            const fileMenu = document.createElement('div');\n            const newButton = document.createElement('button');\n            const saveButton = document.createElement('button');\n            const shareButton = document.createElement('button');\n            const uploadImgurButton = document.createElement('button');\n            const clipboardButton = document.createElement('button');\n\n            newButton.style.cssFloat = 'left';\n            BB.css(saveButton, {\n                cssFloat: 'left',\n                clear: 'both',\n                flexGrow: '1',\n            });\n            BB.css(clipboardButton, {\n                cssFloat: 'left',\n                clear: 'both',\n            });\n\n            newButton.tabIndex = -1;\n            saveButton.tabIndex = -1;\n            shareButton.tabIndex = -1;\n            uploadImgurButton.tabIndex = -1;\n            clipboardButton.tabIndex = -1;\n\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\n            clipboardButton.title = LANG('file-copy-title');\n            newButton.className = 'grid-button';\n            saveButton.className = 'grid-button';\n            shareButton.className = 'grid-button';\n            uploadImgurButton.className = 'grid-button';\n            clipboardButton.className = 'grid-button';\n\n            const importWrapper = BB.el({\n                className: 'grid-button',\n                css: {\n                    position: 'relative',\n                    cursor: 'pointer',\n                    cssFloat: 'left',\n                },\n            });\n            const innerMask = BB.el({\n                parent: importWrapper,\n                css: {\n                    width: '120px',\n                    height: '28px',\n                    overflow: 'hidden',\n                    cursor: 'pointer',\n                    position: 'relative',\n                },\n            });\n            this.importButton = BB.el({\n                tagName: 'input',\n                parent: innerMask,\n                css: {\n                    display: 'none',\n                },\n            });\n            this.importButton.tabIndex = -1;\n            this.importButton.type = 'file';\n            this.importButton.multiple = true;\n            this.importButton.accept = 'image';\n            this.importButton.size = 71;\n            this.importButton.onchange = () => {\n                if (!this.importButton) {\n                    return;\n                }\n                this.importButton.files && onFileSelect(this.importButton.files, 'default');\n                this.importButton.value = '';\n            };\n\n            const importFakeButton = BB.el({\n                tagName: 'button',\n                parent: importWrapper,\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import'),\n                css: {\n                    width: '120px',\n                    display: 'box',\n                    position: 'absolute',\n                    left: '0',\n                    top: '0',\n                    cursor: 'pointer',\n                },\n            });\n            importFakeButton.tabIndex = -1;\n            importFakeButton.onclick = () => this.importButton && this.importButton.click();\n\n            // --- export filetype dropdown ---\n            const exportTypeSelect = new KL.Select({\n                optionArr: [\n                    ['png', 'PNG'],\n                    ['psd', 'PSD'],\n                    ['layers', LANG('layers') + ' (PNG)'],\n                ],\n                initValue: this.exportType,\n                onChange: (val) => {\n                    this.exportType = val as TExportType;\n                    onExportTypeChange(this.exportType);\n                    onSaveImageToComputer();\n                },\n                title: LANG('file-format'),\n            });\n            BB.css(exportTypeSelect.getElement(), {\n                width: '50%',\n                height: '30px',\n                marginTop: '10px',\n                marginLeft: '10px',\n            });\n\n\n\n            newButton.onclick = onNewImage;\n            saveButton.onclick = () => {\n                onSaveImageToComputer();\n            };\n            shareButton.onclick = () => {\n                shareButton.disabled = true;\n                onShareImage(() => {\n                    shareButton.disabled = false;\n                });\n            };\n            uploadImgurButton.onclick = () => onUpload();\n\n            clipboardButton.onclick = () => {\n                clipboardButton.blur();\n                onCopyToClipboard();\n            };\n\n            const saveNote = BB.el({\n                className: 'kl-toolspace-note',\n                textContent: LANG('file-no-autosave'),\n                css: {\n                    margin: '10px 10px 0 10px',\n                },\n            });\n\n            const createSpacer = () => {\n                const el = document.createElement('div');\n                const clearer = document.createElement('div');\n                const line = BB.el({\n                    className: 'grid-hr',\n                });\n                el.append(clearer, line);\n                BB.css(clearer, {\n                    clear: 'both',\n                });\n                return el;\n            };\n\n            this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\n            BB.css(this.fileBrowserStorage.getElement(), {\n                //background: 'red',\n                margin: '10px',\n            });\n\n            const saveRow = BB.el({\n                content: [saveButton, exportTypeSelect.getElement()],\n                className: 'kl-file-save-row',\n            });\n\n            //actual structure\n            BB.append(fileMenu, [\n                saveNote,\n                newButton,\n                importWrapper,\n                BB.el({css: {clear: 'both'}}),\n\n                saveRow,\n\n                clipboardButton,\n                BB.canShareFiles() ? shareButton : undefined,\n                BB.el({css: {clear: 'both'}}),\n\n                createSpacer(),\n                this.fileBrowserStorage.getElement(),\n                createSpacer(),\n                uploadImgurButton,\n            ]);\n\n            this.rootEl.append(fileMenu);\n        };\n\n        setTimeout(asyncCreation, 1);\n    }\n\n    refresh (): void {\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (isVisible: boolean): void {\n        if (isVisible) {\n            this.refresh();\n        }\n    }\n\n    triggerImport (): void {\n        this.importButton && this.importButton.click();\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"upload.dde0fc68.svg\" + \"?\" + Date.now();","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {klHistory} from '../../history/kl-history';\nimport {IKeyString} from '../../../bb/bb-types';\nimport {StatusOverlay} from '../components/status-overlay';\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\nimport {LayerManager} from './layer-manager/layer-manager';\nimport {HandUi} from './hand-ui';\nimport {RGB} from '../../../bb/color/color';\nimport {getSharedFx} from '../../../fx-canvas/shared-fx';\nimport {c} from '../../../bb/base/c';\n\n\nexport class FilterTab {\n\n    private readonly rootEl: HTMLDivElement;\n    private isInit = false;\n\n    private testHasWebGL (): boolean {\n        return !!getSharedFx();\n    }\n\n    constructor (\n        private klRootEl: HTMLElement,\n        private klColorSlider: KlColorSlider,\n        private layerManager: LayerManager,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private handUi: HandUi,\n        private getCurrentColor: () => RGB,\n        private getKlMaxCanvasSize: () => number,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\n        private isEmbed: boolean,\n        private statusOverlay: StatusOverlay,\n    ) {\n        this.rootEl = document.createElement('div');\n    }\n\n    private init (): void {\n        const filters = KL.filterLib;\n        const buttons = [];\n\n        if (!KL.filterLibStatus.isLoaded) {\n            throw new Error('filters not loaded');\n        }\n\n        const hasWebGL: boolean = this.testHasWebGL();\n\n        if (!hasWebGL) {\n            const note = BB.el({\n                parent: this.rootEl,\n                className: 'kl-toolspace-note',\n                content: 'Features disabled because WebGL is failing.',\n                css: {\n                    margin: '10px',\n                    marginBottom: '0',\n                },\n            });\n            const noteButton = BB.el({\n                parent: note,\n                tagName: 'button',\n                textContent: 'Learn More',\n                css: {\n                    marginLeft: '5px',\n                },\n            });\n            noteButton.onclick = () => {\n                KL.popup({\n                    target: this.klRootEl,\n                    message: '<b>WebGL is not working</b>',\n                    div: BB.el({\n                        content: `\nSee if your browser supports WebGL and has it enabled: <a href=\"https://get.webgl.org\" target=\"_blank\" rel=\"noopener noreferrer\">get.webgl.org</a><br>\n<br>\nRecently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.\nThis has been reported to Google.\n`,\n                    }),\n                    buttons: ['Ok'],\n                    clickOnEnter: 'Ok',\n                });\n            };\n        }\n\n        const createButton = (filterKey: string): HTMLElement => {\n            const filter = filters[filterKey];\n\n            const button = document.createElement('button');\n            const buttonLabel = LANG(filter.lang.button);\n            const imClass = filter.darkNoInvert ? 'class=\"dark-no-invert\"' : '';\n            const im = '<img ' + imClass + ' height=\"20\" width=\"18\" src=\"' + filter.icon + '\" style=\"margin-right: 3px\" alt=\"icon\" />';\n            button.innerHTML = im + buttonLabel;\n            button.className = 'grid-button grid-button--filter';\n            BB.css(button, {\n                lineHeight: '20px',\n                fontSize: '12px',\n            });\n            button.tabIndex = -1;\n\n            const filterName = LANG(filter.lang.name);\n\n            let isEnabled = true;\n            if (filter.webGL && !hasWebGL) {\n                isEnabled = false;\n            }\n\n            if (isEnabled) {\n                button.onclick = () => {\n\n                    type TOptions = 'Ok' | 'Cancel';\n                    const dialogButtons: TOptions[] = ['Ok', 'Cancel'];\n\n                    const finishedDialog = (result: TOptions, filterDialog: TFilterGetDialogResult<any>): void => {\n                        if ('error' in filterDialog) {\n                            return;\n                        }\n                        if (result == 'Cancel') {\n                            if (filterDialog.destroy) {\n                                filterDialog.destroy();\n                            }\n                            return;\n                        }\n                        let input;\n                        try {\n                            input = filterDialog.getInput!(); // also destroys\n                        } catch (e) {\n                            if ((e as Error).message.indexOf('.getInput is not a function') !== -1) {\n                                throw 'filterDialog.getInput is not a function, filter: ' + filterName;\n                            } else {\n                                throw e;\n                            }\n                        }\n                        applyFilter(input);\n                    };\n\n                    if (!('apply' in filters[filterKey])) {\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: 'Application not fully loaded',\n                            type: 'error',\n                        });\n                        return;\n                    }\n\n                    const applyFilter = (input: any) => {\n                        const filterResult = filters[filterKey].apply!({\n                            context: this.getCurrentLayerCtx(),\n                            klCanvas: this.getKlCanvas(),\n                            history: klHistory,\n                            input: input,\n                        } as IFilterApply);\n                        if (filterResult === false) {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: \"Couldn't apply the edit action\",\n                                type: 'error',\n                            });\n                        }\n                        if (filters[filterKey].updatePos === true) {\n                            this.klCanvasWorkspace.resetOrFitView();\n                            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                        }\n                        this.layerManager.update();\n                    };\n\n                    if (filters[filterKey].isInstant){\n                        button.blur();\n                        applyFilter(null);\n                        this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\n                    } else {\n                        const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\n                        let filterDialog: TFilterGetDialogResult<any> | undefined = undefined;\n\n                        try {\n                            filterDialog = filters[filterKey].getDialog!({\n                                context: this.getCurrentLayerCtx(),\n                                klCanvas: this.getKlCanvas(),\n                                maxWidth: this.getKlMaxCanvasSize(),\n                                maxHeight: this.getKlMaxCanvasSize(),\n                                currentColorRgb: {r: this.getCurrentColor().r, g: this.getCurrentColor().g, b: this.getCurrentColor().b},\n                                secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b},\n                            } as IFilterGetDialogParam) as TFilterGetDialogResult;\n                        } catch (e) {\n                            setTimeout(() => {\n                                throw e;\n                            });\n                        }\n\n                        if (!filterDialog || 'error' in filterDialog) {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: filterDialog ? filterDialog.error : 'Error: Could not perform action.',\n                                type: 'error',\n                            });\n                            return;\n                        }\n\n                        let closeFunc: () => void;\n                        // Todo should move into getDialogParams\n                        filterDialog.errorCallback = (e) => {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: 'Error: Could not perform action.',\n                                type: 'error',\n                            });\n                            setTimeout(() => {\n                                throw e;\n                            }, 0);\n                            closeFunc();\n                        };\n\n\n                        const style: IKeyString = {};\n                        if ('width' in filterDialog) {\n                            style.width = filterDialog.width + 'px';\n                        }\n\n                        let title: HTMLElement;\n                        {\n                            const els: HTMLElement[] = [\n                                c('b', filterName),\n                            ];\n                            if (filter.lang.description !== undefined) {\n                                els.push(c({\n                                    className: 'kl-info-btn',\n                                    onClick: () => {\n                                        KL.popup({\n                                            target: this.klRootEl,\n                                            message: LANG(filter.lang.description!),\n                                        });\n                                    },\n                                    title: LANG(filter.lang.description!),\n                                    noRef: true,\n                                }, '?'));\n                            }\n                            title = c(',flex,gap-5', els);\n                        }\n\n\n\n\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: title,\n                            div: filterDialog.element,\n                            style: style,\n                            buttons: dialogButtons,\n                            clickOnEnter: 'Ok',\n                            callback: (result) => {\n                                finishedDialog(result as TOptions, filterDialog!);\n                            },\n                            closeFunc: (func) => {\n                                closeFunc = func;\n                            },\n                        });\n                    }\n                };\n            } else {\n                button.disabled = true;\n            }\n\n            buttons.push(button);\n            return button;\n        };\n\n        const addGroup = (groupArr: string[]): void => {\n            Object.entries(filters).forEach(([filterKey, filter]) => {\n                if (!groupArr.includes(filterKey)) {\n                    return;\n                }\n                if (this.isEmbed && !filter.inEmbed) {\n                    return;\n                }\n                this.rootEl.append(createButton(filterKey));\n            });\n        };\n\n        const groupA = [\n            'cropExtend',\n            'flip',\n            'perspective',\n            'resize',\n            'rotate',\n            'transform',\n        ];\n        const groupB = [\n            'brightnessContrast',\n            'curves',\n            'distort',\n            'hueSaturation',\n            'invert',\n            'tiltShift',\n            'toAlpha',\n            'blur',\n            'unsharpMask',\n        ];\n        const groupC = [\n            'grid',\n            'noise',\n            'pattern',\n            'vanishPoint',\n        ];\n\n        addGroup(groupA);\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\n        addGroup(groupB);\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\n        addGroup(groupC);\n\n        this.isInit = true;\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    show (): void {\n        if (!this.isInit) {\n            this.init();\n        }\n        this.rootEl.style.display = 'block';\n    }\n\n    hide (): void {\n        this.rootEl.style.display = 'none';\n    }\n\n}","import {fxCanvas} from './fx-canvas';\nimport {TFxCanvas} from './fx-canvas-types';\n\nlet failed = false;\nlet fx: TFxCanvas | null = null;\n\nexport function getSharedFx (): TFxCanvas | null {\n    // failed previously, don't need to try again.\n    if (failed) {\n        return fx;\n    }\n\n    if (!fx || fx._.gl.isContextLost()) {\n        try {\n            fx = fxCanvas();\n        } catch (e) {\n            failed = true;\n            fx = null;\n            setTimeout(() => {\n                throw e;\n            });\n        }\n    }\n    return fx;\n}","import {brightnessContrast} from './filters/brightness-contrast';\nimport {FxShader} from './core/fx-shader';\nimport {gl, setGl} from './core/gl';\nimport {FxTexture} from './core/fx-texture';\nimport {curves} from './filters/curves';\nimport {hueSaturation} from './filters/hue-saturation';\nimport {noise} from './filters/noise';\nimport {triangleBlur} from './filters/triangle-blur';\nimport {tiltShift} from './filters/tilt-shift';\nimport {matrixWarp} from './filters/matrix-warp';\nimport {unsharpMask} from './filters/unsharp-mask';\nimport {toAlpha} from './filters/to-alpha';\nimport {invert} from './filters/invert';\nimport {perspective} from './filters/perspective';\nimport {unmultiplyAlpha} from './filters/unmultiply-alpha';\nimport {distort} from './filters/distort';\nimport {multiplyAlpha} from './filters/multiply-alpha';\nimport {TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture} from './fx-canvas-types';\nimport {BB} from '../bb/bb';\n\n/*\n * based on glfx.js\n * https://github.com/evanw/glfx.js/\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\n/**\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\n *\n * This library provides realtime image effects using WebGL. There are three parts to it:\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\n * - filter - an image effect (represents one or more WebGL shaders)\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\n */\nexport const fxCanvas: (() => TFxCanvas) = (function () {\n\n    function wrapTexture (texture: FxTexture): TWrappedTexture {\n        return {\n            _: texture,\n            loadContentsOf: function (element) {\n                // Make sure that we're using the correct global WebGL context\n                setGl(this._.gl);\n                this._.loadContentsOf(element);\n            },\n            destroy: function () {\n                // Make sure that we're using the correct global WebGL context\n                setGl(this._.gl);\n                this._.destroy();\n            },\n        };\n    }\n\n    function texture (element: TFxSupportedElements) {\n        return wrapTexture(FxTexture.fromElement(element));\n    }\n\n    function getTextureType (): GLenum {\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\n\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if (\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\n            gl.getExtension('OES_texture_float') &&\n            gl.getExtension('OES_texture_float_linear')\n        ) {\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\n            try {\n                // Only use gl.FLOAT if we can render to it\n                testTexture.drawTo(function () {\n                    textureType = gl.FLOAT;\n                });\n            } catch (e) {\n                /* empty */\n            }\n            testTexture.destroy();\n        }\n        return textureType;\n    }\n\n    function initialize (this: TFxCanvas, width: number, height: number): void {\n        const textureType = getTextureType();\n        if (this._.texture) {\n            this._.texture.destroy();\n        }\n        if (this._.spareTexture) {\n            this._.spareTexture.destroy();\n        }\n        this.width = width;\n        this.height = height;\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\n        this._.flippedShader = this._.flippedShader || new FxShader(null, `\nuniform sampler2D texture;\nvarying vec2 texCoord;\nvoid main() {\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\n}\n        `, 'flippedShader');\n        this._.isInitialized = true;\n    }\n\n    function draw (this: TFxCanvas, texture: TWrappedTexture, width?: number, height?: number): TFxCanvas {\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n        }\n\n        texture._.use();\n        this._.texture.drawTo(function () {\n            FxShader.getDefaultShader().drawRect();\n        });\n\n        return this;\n    }\n\n    function update (this: TFxCanvas): TFxCanvas {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    }\n\n    function contents (this: TFxCanvas): TWrappedTexture {\n        const texture = new FxTexture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\n        this._.texture.use();\n        texture.drawTo(function () {\n            FxShader.getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    }\n\n    /*\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n       Length of the array will be width * height * 4.\n    */\n    function getPixelArray (this: TFxCanvas): Uint8Array {\n        const w = this._.texture.width;\n        const h = this._.texture.height;\n        const array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function () {\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n        });\n        return array;\n    }\n\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\n        return <F>function (this: TFxCanvas, ...args: any[]) {\n            // Make sure that we're using the correct global WebGL context\n            setGl(this._.gl);\n            // Now that the context has been switched, we can call the wrapped function\n            return fn.apply(this, args);\n        };\n    }\n\n    function getWebGlContext (canvas: HTMLCanvasElement, options?: WebGLContextAttributes): WebGLRenderingContext | null {\n        const contextNames = ['webgl', 'experimental-webgl', 'webgl2'];\n        let context: WebGLRenderingContext | null = null;\n        contextNames.forEach(name => {\n            if (context) {\n                return;\n            }\n            // get.webgl.org does a try-catch\n            try {\n                context = canvas.getContext(name, options) as (typeof context);\n            } catch (e) {\n                /* empty */\n            }\n        });\n        return context;\n    }\n\n    return (): TFxCanvas => {\n        if (!window.WebGLRenderingContext) {\n            throw 'WebGLRenderingContext not set. Browser does not support WebGL.';\n        }\n\n        const canvas: TFxCanvas = BB.canvas(1, 1) as TFxCanvas;\n        const context = getWebGlContext(canvas, {premultipliedAlpha: false});\n        if (!context) {\n            throw 'This browser does not support WebGL';\n        }\n        setGl(context as TFxGl);\n\n        canvas._ = {\n            gl,\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null,\n        } as any;\n\n        // Core methods\n        canvas.texture = wrap(texture);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n\n        // Filter methods\n        canvas.brightnessContrast = wrap(brightnessContrast);\n        canvas.hueSaturation = wrap(hueSaturation);\n        canvas.triangleBlur = wrap(triangleBlur);\n        canvas.unsharpMask = wrap(unsharpMask);\n        canvas.perspective = wrap(perspective);\n        canvas.matrixWarp = wrap(matrixWarp);\n        canvas.tiltShift = wrap(tiltShift);\n        canvas.noise = wrap(noise);\n        canvas.curves = wrap(curves);\n        canvas.invert = wrap(invert);\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\n        canvas.toAlpha = wrap(toAlpha);\n        canvas.distort = wrap(distort);\n\n        return canvas as TFxCanvas;\n    };\n})();","import {BB} from '../../bb/bb';\nimport {simpleShader} from '../core/simple-shader';\nimport {FxShader} from '../core/fx-shader';\nimport {gl} from '../core/gl';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * @type Brightness / Contrast\n * Provides additive brightness and multiplicative contrast control.\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nexport type TFilterBrightnessContrast = (\n    this: TFxCanvas,\n    brightness: number,\n    contrast: number\n) => TFxCanvas;\n\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\n    gl.brightnessContrast = gl.brightnessContrast || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float brightness;\\\n        uniform float contrast;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.rgb += brightness;\\\n            if (contrast > 0.0) {\\\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\n            } else {\\\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\n            }\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'brightnessContrast');\n\n    simpleShader.call(this, gl.brightnessContrast, {\n        brightness: BB.clamp(brightness, -1, 1),\n        contrast: BB.clamp(contrast, -1, 1),\n    });\n\n    return this;\n};","import {TFxCanvas, TUniforms} from '../fx-canvas-types';\nimport {FxTexture} from './fx-texture';\nimport {FxShader} from './fx-shader';\n\nexport function simpleShader (\n    this: TFxCanvas,\n    shader: FxShader,\n    uniforms: TUniforms<number | number[]>,\n    textureIn?: FxTexture,\n    textureOut?: FxTexture\n): void {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function () {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}","import {gl} from './gl';\nimport {TUniforms} from '../fx-canvas-types';\nimport {BB} from '../../bb/bb';\n\n// VERTEX_SHADER | FRAGMENT_SHADER\ntype TShaderType = GLenum;\n\nconst defaultVertexSource = '\\\n    attribute vec2 vertex;\\\n    attribute vec2 _texCoord;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        texCoord = _texCoord;\\\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\n    }';\n\nconst defaultFragmentSource = '\\\n    uniform sampler2D texture;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        gl_FragColor = texture2D(texture, texCoord);\\\n    }';\n\nfunction isArray (obj: unknown): obj is unknown[] {\n    return Object.prototype.toString.call(obj) == '[object Array]';\n}\n\nfunction isNumber (obj: unknown): obj is number {\n    return Object.prototype.toString.call(obj) == '[object Number]';\n}\n\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\n\nexport class FxShader {\n\n    // ---- static ----\n    static getDefaultShader (): FxShader {\n        gl.defaultShader = gl.defaultShader || new FxShader();\n        return gl.defaultShader;\n    }\n\n\n    // ---- private ----\n\n    private compileSource (type: TShaderType, source: string, nameStr: string): WebGLShader {\n        const shader = BB.throwIfNull(gl.createShader(type));\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\n        }\n        return shader;\n    }\n\n    /**\n     * HIGH_FLOAT | MEDIUM_FLOAT\n     */\n    private testPrecisionSupport (precisionType: GLenum): boolean {\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\n        return format !== null && format.precision !== 0;\n    }\n\n    // ---- public ----\n    constructor (\n        vertexSource?: string | null,\n        fragmentSource?: string | null,\n        nameStr?: string,\n    ) {\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = BB.throwIfNull(gl.createProgram());\n        vertexSource = vertexSource || defaultVertexSource;\n        fragmentSource = fragmentSource || defaultFragmentSource;\n        if (!floatPrecision) {\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (this.testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\n        }\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\n        gl.attachShader(this.program, this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\n        gl.attachShader(this.program, this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\n        }\n    }\n\n    // ---- interface ----\n    \n    vertexAttribute: null | number;\n    texCoordAttribute: null | number;\n    program: WebGLProgram | null; // null = destroyed\n\n    destroy (): void {\n        gl.deleteProgram(this.program);\n        this.program = null;\n    }\n\n    uniforms (uniforms: TUniforms<number | number[]>): FxShader {\n        gl.useProgram(this.program);\n        Object.entries(uniforms).forEach(([name, value]) => {\n\n            const location = gl.getUniformLocation(this.program!, name);\n            if (location === null) {\n                // will be null if the uniform isn't used in the shader\n                return;\n            }\n\n            if (isArray(value)) {\n                switch (value.length) {\n                    case 1:\n                        gl.uniform1fv(location, new Float32Array(value));\n                        break;\n                    case 2:\n                        gl.uniform2fv(location, new Float32Array(value));\n                        break;\n                    case 3:\n                        gl.uniform3fv(location, new Float32Array(value));\n                        break;\n                    case 4:\n                        gl.uniform4fv(location, new Float32Array(value));\n                        break;\n                    case 9:\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\n                        break;\n                    case 16:\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\n                        break;\n                    default:\n                        throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\n                }\n            } else if (isNumber(value)) {\n                gl.uniform1f(location, value);\n            } else {\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + ((value as any) || 'undefined').toString();\n            }\n        });\n        // allow chaining\n        return this;\n    }\n\n    //\n    /**\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n     * even though floating point numbers represent the integers 0 through 7 exactly\n     */\n    textures (textures: Record<string, GLint>): FxShader {\n        gl.useProgram(this.program);\n\n        Object.entries(textures).forEach(([name, value]) => {\n            gl.uniform1i(gl.getUniformLocation(this.program!, name), value);\n        });\n\n        // allow chaining\n        return this;\n    }\n\n   drawRect (left?: number, top?: number, right?: number, bottom?: number): void {\n        let undefined;\n        const viewport = gl.getParameter(gl.VIEWPORT);\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\n        if (gl.texCoordBuffer == null) {\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n        }\n        if (this.vertexAttribute == null) {\n            this.vertexAttribute = gl.getAttribLocation(this.program!, 'vertex');\n            gl.enableVertexAttribArray(this.vertexAttribute);\n        }\n        if (this.texCoordAttribute == null) {\n            this.texCoordAttribute = gl.getAttribLocation(this.program!, '_texCoord');\n            gl.enableVertexAttribArray(this.texCoordAttribute);\n        }\n        gl.useProgram(this.program);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    }\n\n}","import {TFxGl} from '../fx-canvas-types';\n\nexport let gl: TFxGl;\n\nexport function setGl (newGl: TFxGl | null): void {\n    // more problems setting type to null\n    gl = newGl as TFxGl;\n}","import {gl} from './gl';\nimport {BB} from '../../bb/bb';\nimport {TFxGl, TFxSupportedElements} from '../fx-canvas-types';\n\n/**\n * Format           Type                    Channels    Bytes per pixel\n * RGBA             UNSIGNED_BYTE           4           4\n * RGB              UNSIGNED_BYTE           3           3\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\n * LUMINANCE        UNSIGNED_BYTE           1           1\n * ALPHA            UNSIGNED_BYTE           1           1\n *\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\n */\nexport type TTextureFormat = GLenum;\nexport type TTextureType = GLenum;\n\n\nexport class FxTexture {\n    \n    // ---- static ----\n    static fromElement (element: TFxSupportedElements): FxTexture {\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n        texture.loadContentsOf(element);\n        return texture;\n    }\n    \n    \n    // ---- private ----\n    private canvas: HTMLCanvasElement | null;\n    private type: TTextureType;\n\n    /*\n    // never seen this being used\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\n        if (this.canvas == null) {\n            this.canvas = BB.canvas(texture.width, texture.height);\n        }\n        this.canvas.width = texture.width;\n        this.canvas.height = texture.height;\n        const c = BB.ctx(this.canvas);\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        return c;\n    }*/\n\n    \n    // ---- public ----\n    constructor (\n        width: number,\n        height: number,\n        format: TTextureFormat,\n        type: TTextureType,\n    ) {\n        this.gl = gl;\n        this.id = BB.throwIfNull(gl.createTexture());\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n        this.canvas = null;\n\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        if (width && height) {\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    }\n    \n    // ---- interface ----\n\n    gl: TFxGl;\n    width: number;\n    height: number;\n    id: WebGLTexture | null; // null -> destroyed\n    format: TTextureFormat;\n    \n    loadContentsOf (element: TFxSupportedElements): void {\n        this.width = element.width || (element as HTMLVideoElement).videoWidth;\n        this.height = element.height || (element as HTMLVideoElement).videoHeight!;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n    }\n\n    initFromBytes (width: number, height: number, data: number[]): void {\n        this.width = width;\n        this.height = height;\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\n    }\n\n    destroy (): void {\n        gl.deleteTexture(this.id);\n        this.id = null;\n    }\n\n    use (unit?: number): void {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n    }\n\n    unuse (unit: number): void {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n\n    ensureFormat (width: number, height: number, format: TTextureFormat, type: TTextureType): void {\n        // change the format only if required\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    }\n\n    ensureFormatViaTexture (texture: FxTexture): void {\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\n    }\n\n    drawTo (callback: () => void): void {\n        // start rendering to this texture\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            throw new Error('incomplete framebuffer');\n        }\n        gl.viewport(0, 0, this.width, this.height);\n\n        // do the drawing\n        callback();\n\n        // stop rendering to this texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n\n    /*\n    // never seen this being used\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\n        callback(this.getCanvas(this));\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\n        return this;\n    }\n\n    // never seen this being used\n    toImage (image: HTMLImageElement): void {\n        this.use();\n        Shader.getDefaultShader().drawRect();\n        const size = this.width * this.height * 4;\n        const pixels = new Uint8Array(size);\n        const c = this.getCanvas(this);\n        const data = c.createImageData(this.width, this.height);\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n        for (let i = 0; i < size; i++) {\n            data.data[i] = pixels[i];\n        }\n        c.putImageData(data, 0, 0);\n        image.src = this.canvas.toDataURL();\n    }\n     */\n\n    swapWith (other: FxTexture): void {\n        let temp;\n\n        temp = other.id;\n        other.id = this.id;\n        this.id = temp;\n\n        temp = other.width;\n        other.width = this.width;\n        this.width = temp;\n\n        temp = other.height;\n        other.height = this.height;\n        this.height = temp;\n\n        temp = other.format;\n        other.format = this.format;\n        this.format = temp;\n\n        // type?\n    }\n}\n","import {splineInterpolate} from '../math/spline-interpolate';\nimport {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Curves\n * @description A powerful mapping tool that transforms the colors in the image\n *              by an arbitrary function. The function is interpolated between\n *              a set of 2D points using splines. The curves filter can take\n *              either one or three arguments which will apply the mapping to\n *              either luminance or RGB values, respectively.\n * @param red   A list of points that define the function for the red channel.\n *              Each point is a list of two values: the value before the mapping\n *              and the value after the mapping, both in the range 0 to 1. For\n *              example, [[0,1], [1,0]] would invert the red channel while\n *              [[0,0], [1,1]] would leave the red channel unchanged.\n * @param green A list of points that define the function for the green\n *              channel (just like for red).\n * @param blue  list of points that define the function for the blue\n *              channel (just like for red).\n */\nexport type TFilterCurves = (\n    this: TFxCanvas,\n    red: [number, number][],\n    green: [number, number][],\n    blue: [number, number][],\n) => TFxCanvas;\n\nexport const curves: TFilterCurves = function (red, green, blue) {\n    // Create the ramp texture\n    const redRamp = splineInterpolate(red);\n    const greenRamp = splineInterpolate(green);\n    const blueRamp = splineInterpolate(blue);\n    const array: number[] = [];\n    for (let i = 0; i < 256; i++) {\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\n    }\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n\n    gl.curves = gl.curves || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform sampler2D map;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.r = texture2D(map, vec2(color.r)).r;\\\n            color.g = texture2D(map, vec2(color.g)).g;\\\n            color.b = texture2D(map, vec2(color.b)).b;\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'curves');\n\n    gl.curves.textures({\n        map: 1,\n    });\n    simpleShader.call(this, gl.curves, {});\n\n    return this;\n};","import {BB} from '../../bb/bb';\n\nexport function splineInterpolate (points: [number, number][]): number[] {\n    const interpolator = new BB.SplineInterpolator(points);\n    const array = [];\n    for (let i = 0; i < 256; i++) {\n        array.push(\n            BB.clamp(\n                Math.floor(interpolator.interpolate(i / 255) * 256),\n                0,\n                255\n            )\n        );\n    }\n    return array;\n}","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {BB} from '../../bb/bb';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Hue / Saturation\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\n *                   can be imagined as a cube where the axes are the red, green, and blue color\n *                   values. Hue changing works by rotating the color vector around the grayscale\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\n *                   Saturation is implemented by scaling all color channel values either toward\n *                   or away from the average color channel value.\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\n *                   and 1 is 180 degree rotation in the positive direction)\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nexport type TFilterHueSaturation = (\n    this: TFxCanvas,\n    hue: number,\n    saturation: number,\n) => TFxCanvas;\n\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\n    gl.hueSaturation = gl.hueSaturation || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float hue;\\\n        uniform float saturation;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\n            float angle = hue * 3.14159265;\\\n            float s = sin(angle), c = cos(angle);\\\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\n            float len = length(color.rgb);\\\n            color.rgb = vec3(\\\n                dot(color.rgb, weights.xyz),\\\n                dot(color.rgb, weights.zxy),\\\n                dot(color.rgb, weights.yzx)\\\n            );\\\n            \\\n            /* saturation adjustment */\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            if (saturation > 0.0) {\\\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\n            } else {\\\n                color.rgb += (average - color.rgb) * (-saturation);\\\n            }\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'hueSaturation');\n\n    simpleShader.call(this, gl.hueSaturation, {\n        hue: BB.clamp(hue, -1, 1),\n        saturation: BB.clamp(saturation, -1, 1),\n    });\n\n    return this;\n};\n","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport shaderNoise from '../shaders/shader-noise.glsl';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Noise\n * draws noise, completely replaces original image\n */\nexport type TFilterNoise = (\n    this: TFxCanvas,\n    seed: number | undefined, // float, any value okay - default 0\n    type: number, // 1 value, 2 simplex, 3 cellular\n    scale: [number, number], // float, small scale will show repeating patterns\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\n    octaves: number, // int 0 - 4\n    samples: number, // 1 | 4 | 8 -> super-sampling\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\n    brightness: number, // range [-1, 1]\n    contrast: number, // range [-1, 1]\n    isReversed: boolean, // reverse 0-1 range\n    colA: {r: number; g: number; b: number} | undefined, // which color at 0, if rgb - default black\n    colB: {r: number; g: number; b: number} | undefined, // which color at 1, if rgb - default white\n    channels: 'rgb' | 'alpha', // which channel to target\n) => TFxCanvas;\n\nexport const noise: TFilterNoise = function (\n    seed,\n    type,\n    scale,\n    offset,\n    octaves,\n    samples,\n    peaks,\n    brightness,\n    contrast,\n    isReversed,\n    colA,\n    colB,\n    channels,\n) {\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\n    simpleShader.call(this, gl.noise, {\n        seed: seed || 0,\n        type,\n        scale: [scale[0], scale[1]],\n        offset,\n        octaves,\n        samples,\n        texSize: [this.width, this.height],\n        peaks,\n        brightness,\n        contrast,\n        isReversed: isReversed ? 1.0 : 0.0,\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\n        channels: channels === 'rgb' ? 0 : 1,\n    });\n\n    return this;\n};","uniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float isReversed;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright  Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright  2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\n\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative ---------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (isReversed == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {randomShaderFunc} from '../shaders/random-shader-func';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Triangle Blur\n * @description  This is the most basic blur filter, which convolves the image with a\n *               pyramid filter. The pyramid filter is separable and is applied as two\n *               perpendicular triangle filters.\n *               Note: Requires alpha to be premultiplied.\n * @param radius The radius of the pyramid convolved with the image.\n */\nexport type TFilterTriangleBlur = (\n    this: TFxCanvas,\n    radius: number,\n) => TFxCanvas;\n\n\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\n    gl.triangleBlur = gl.triangleBlur || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'triangleBlur');\n\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [radius / this.width, 0],\n    });\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [0, radius / this.height],\n    });\n\n    return this;\n};","// returns a random number between 0 and 1\nexport const randomShaderFunc = '\\\n    float random(vec3 scale, float seed) {\\\n        /* use the fragment position for a different seed per-pixel */\\\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\n    }\\\n';","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {randomShaderFunc} from '../shaders/random-shader-func';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Tilt Shift\n * @description          Simulates the shallow depth of field normally encountered in close-up\n *                       photography, which makes the scene seem much smaller than it actually\n *                       is. This filter assumes the scene is relatively planar, in which case\n *                       the part of the scene that is completely in focus can be described by\n *                       a line (the intersection of the focal plane and the scene). An example\n *                       of a planar scene might be looking at a road from above at a downward\n *                       angle. The image is then blurred with a blur radius that starts at zero\n *                       on the line and increases further from the line.\n *                       Note: Requires alpha to be premultiplied.\n *\n * @param startX         The x coordinate of the start of the line segment.\n * @param startY         The y coordinate of the start of the line segment.\n * @param endX           The x coordinate of the end of the line segment.\n * @param endY           The y coordinate of the end of the line segment.\n * @param blurRadius     The maximum radius of the pyramid blur.\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\n */\nexport type TFilterTiltShift = (\n    this: TFxCanvas,\n    startX: number,\n    startY: number,\n    endX: number,\n    endY: number,\n    blurRadius: number,\n    gradientRadius: number,\n) => TFxCanvas;\n\nexport const tiltShift: TFilterTiltShift = function (\n    startX,\n    startY,\n    endX,\n    endY,\n    blurRadius,\n    gradientRadius,\n) {\n    gl.tiltShift = gl.tiltShift || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float blurRadius;\\\n        uniform float gradientRadius;\\\n        uniform vec2 start;\\\n        uniform vec2 end;\\\n        uniform vec2 delta;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'tiltShift');\n\n    const dx = endX - startX;\n    const dy = endY - startY;\n    const d = Math.sqrt(dx * dx + dy * dy);\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [dx / d, dy / d],\n        texSize: [this.width, this.height],\n    });\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [-dy / d, dx / d],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {warpShader} from '../shaders/warp-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {getInverse} from '../math/matrix';\nimport {TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3} from '../fx-canvas-types';\n\n/**\n * Matrix Warp\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\n *                        3x3 matrix, where x and y are in units of pixels.\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\n * @param inverse         A boolean value that, when true, applies the inverse transformation\n *                        instead. (optional, defaults to false)\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\n *                        instead of screen-space coordinates. Texture-space coordinates range\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\n *                        to use for simple operations like flipping and rotating.\n */\nexport type TFilterMatrixWarp = (\n    this: TFxCanvas,\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\n    inverse?: boolean,\n    useTextureSpace?: boolean,\n) => TFxCanvas;\n\n\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\n        uniform mat3 matrix;\\\n        uniform bool useTextureSpace;\\\n    ', '\\\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\n        vec3 warp = matrix * vec3(coord, 1.0);\\\n        coord = warp.xy / warp.z;\\\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\n    ');\n\n    // Flatten all members of matrix into one big list\n    matrix = matrix.flat() as (TMat2x2 | TMat3x3);\n\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) {\n        matrix = [\n            matrix[0], matrix[1], 0,\n            matrix[2], matrix[3], 0,\n            0, 0, 1,\n        ];\n    } else if (matrix.length != 9) {\n        throw 'can only warp with 2x2 or 3x3 matrix';\n    }\n\n    simpleShader.call(this, gl.matrixWarp, {\n        matrix: inverse ? getInverse(matrix) : matrix,\n        texSize: [this.width, this.height],\n        useTextureSpace: useTextureSpace ? 1 : 0,\n    });\n\n    return this;\n};","import {FxShader} from '../core/fx-shader';\n\nexport function warpShader (uniformsStr: string, warpStr: string): FxShader {\n    return new FxShader(null, uniformsStr + '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        vec2 coord = texCoord * texSize;\\\n        ' + warpStr + '\\\n        gl_FragColor = texture2D(texture, coord / texSize);\\\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\n        if (coord != clampedCoord) {\\\n            /* fade to transparent if we are outside the image */\\\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\n        }\\\n    }', 'warp');\n}","import {TMat3x3} from '../fx-canvas-types';\n\n// from javax.media.jai.PerspectiveTransform\n\n/**\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\n */\nexport function getSquareToQuad (\n    x0: number,\n    y0: number,\n    x1: number,\n    y1: number,\n    x2: number,\n    y2: number,\n    x3: number,\n    y3: number\n): TMat3x3 {\n    const dx1 = x1 - x2;\n    const dy1 = y1 - y2;\n    const dx2 = x3 - x2;\n    const dy2 = y3 - y2;\n    const dx3 = x0 - x1 + x2 - x3;\n    const dy3 = y0 - y1 + y2 - y3;\n    const det = dx1 * dy2 - dx2 * dy1;\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\n    return [\n        x1 - x0 + a * x1, y1 - y0 + a * y1, a,\n        x3 - x0 + b * x3, y3 - y0 + b * y3, b,\n        x0, y0, 1,\n    ];\n}\n\nexport function getInverse (m: TMat3x3): TMat3x3 {\n    const a = m[0], b = m[1], c = m[2];\n    const d = m[3], e = m[4], f = m[5];\n    const g = m[6], h = m[7], i = m[8];\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n    return [\n        (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\n        (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\n        (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det,\n    ];\n}\n\nexport function multiply (a: TMat3x3, b: TMat3x3): TMat3x3 {\n    return [\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\n    ];\n}","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Unsharp Mask\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\n *                 is implemented by scaling pixels away from the average of their neighbors.\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\n */\nexport type TFilterUnsharpMask = (\n    this: TFxCanvas,\n    radius: number,\n    strength: number,\n) => TFxCanvas;\n\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\n    gl.unsharpMask = gl.unsharpMask || new FxShader(null, '\\\n        uniform sampler2D blurredTexture;\\\n        uniform sampler2D originalTexture;\\\n        uniform float strength;\\\n        uniform float threshold;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\n            vec4 original = texture2D(originalTexture, texCoord);\\\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\n        }\\\n    ', 'unsharpMask');\n\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function () {\n        FxShader.getDefaultShader().drawRect();\n    });\n\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    gl.unsharpMask.textures({\n        originalTexture: 1,\n    });\n    simpleShader.call(this, gl.unsharpMask, {\n        strength: strength,\n    });\n    this._.extraTexture.unuse(1);\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\nimport {IRGBA} from '../../klecks/kl-types';\n\n/**\n * To Alpha\n * @description   Generates alpha channel from luminance (r+g+b)\n * @param isInverted    boolean - invert luminance\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\n */\nexport type TFilterToAlpha = (\n    this: TFxCanvas,\n    isInverted: boolean,\n    replaceRGBA: IRGBA | null,\n) => TFxCanvas;\n\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\n    gl.toAlpha = gl.toAlpha || new FxShader(null, '\\\n    uniform bool isInverted;\\\n    uniform vec4 replace;\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\n        if (isInverted) alpha = 1.0 - alpha;\\\n        alpha = min(color.a, alpha);\\\n        if (replace.a > 0.0) color = replace;\\\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\n    }\\\n', 'toAlpha');\n\n    simpleShader.call(this, gl.toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Invert\n * @description   Inverts color of each pixel\n */\nexport type TFilterInvert = (\n    this: TFxCanvas,\n) => TFxCanvas;\n\nexport const invert: TFilterInvert = function () {\n    gl.invert = gl.invert || new FxShader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb = 1.0 - color.rgb;\\\n        gl_FragColor = color;\\\n    }\\\n', 'invert');\n\n    simpleShader.call(this, gl.invert, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {getInverse, getSquareToQuad, multiply} from '../math/matrix';\nimport {TFxCanvas} from '../fx-canvas-types';\n\nexport type TRectanglePoints = [\n    number, number, // point a\n    number, number, // point b\n    number, number, // point c\n    number, number, // point d\n];\n\n/**\n * Perspective\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\n *               Note: Requires alpha to be premultiplied.\n * @param before The x and y coordinates of four points before the transform in a flat list. This\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\n *               (cx, cy), and (dx, dy).\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\n *               like the other argument.\n */\nexport type TFilterPerspective = (\n    this: TFxCanvas,\n    before: TRectanglePoints,\n    after: TRectanglePoints,\n) => TFxCanvas;\n\nexport const perspective: TFilterPerspective = function (before, after) {\n    const a = getSquareToQuad(...after);\n    const b = getSquareToQuad(...before);\n    const c = multiply(getInverse(a), b);\n    return this.matrixWarp(c);\n};\n","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * unmultiplyAlpha\n * reverses alpha multiply\n */\nexport type TFilterUnmultiplyAlpha = (\n    this: TFxCanvas,\n) => TFxCanvas;\n\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\n    gl.unmultiplyAlpha = gl.unmultiplyAlpha || new FxShader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        if(color.a > 0.0) {\\\n            color.rgb /= color.a;\\\n        }\\\n        gl_FragColor = color;\\\n    }\\\n', 'unmultiplyAlpha');\n\n    simpleShader.call(this, gl.unmultiplyAlpha, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {warpShader} from '../shaders/warp-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n\nexport type TFilterDistortSettings = {\n    stepSize: number; // [1, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n    offset: { x: number; y: number };\n};\n\n/**\n * Distort\n * Distorts image (moves pixels around)\n */\nexport type TFilterDistort = (\n    this: TFxCanvas,\n    settings: TFilterDistortSettings,\n) => TFxCanvas;\n\n/**\n * @filter        Distort\n * @description   Distorts image (moves pixels around)\n *                Note: Requires alpha to be premultiplied.\n */\nexport const distort: TFilterDistort = function (settings) {\n    gl.distort = gl.distort || warpShader(`\n    uniform float stepSize;\n    uniform vec2 scale;\n    uniform vec2 strength;\n    uniform vec2 phase;\n    uniform float type;\n    uniform vec2 offset;\n`, `\n    const float PI = 3.14159265;\n    float x = coord.x + offset.x;\n    float y = coord.y + offset.y;\n    if (stepSize > 1.0) {\n        x = floor(x / stepSize) * stepSize;\n        y = floor(y / stepSize) * stepSize;\n    }\n    float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\n    float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\n    if (type == 0.0) {\n        coord.y += distortX;\n        coord.x += distortY;\n    } else if (type == 1.0) {\n        coord.x += distortX;\n        coord.y += distortY;\n    } else if (type == 2.0) {\n        x -= offset.x;\n        y -= offset.y;\n        gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\n        coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\n        coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\n    }\n    coord.x = mod(coord.x, texSize.x);\n    coord.y = mod(coord.y, texSize.y);\n`);\n\n    simpleShader.call(this, gl.distort, {\n        stepSize: settings.stepSize,\n        type: settings.distortType,\n        scale: [settings.scale.x, settings.scale.y],\n        strength: [settings.strength.x, settings.strength.y],\n        phase: [settings.phase.x, settings.phase.y],\n        offset: [settings.offset.x, settings.offset.y],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n\n","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * multiplyAlpha\n * applies alpha multiply\n */\nexport type TFilterMultiplyAlpha = (\n    this: TFxCanvas,\n) => TFxCanvas;\n\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\n    gl.multiplyAlpha = gl.multiplyAlpha || new FxShader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb *= color.a;\\\n        gl_FragColor = color;\\\n    }\\\n', 'multiplyAlpha');\n\n    simpleShader.call(this, gl.multiplyAlpha, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {SaveReminder} from '../components/save-reminder';\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\nimport loadingImg from '/src/app/img/ui/loading.gif';\n\ntype TImgurUploadResponse = {\n    // just a subset\n    id: string;\n    datetime: number;\n    type: string;\n    width: number;\n    height: number;\n    deletehash: string;\n    name: string;\n    link: string;\n};\n\n/**\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\n */\nasync function upload (\n    canvas: HTMLCanvasElement,\n    title: string,\n    description: string,\n    type: 'png' | 'jpeg',\n    imgurKey: string,\n): Promise<TImgurUploadResponse> {\n    const img = base64ToBlob(canvas.toDataURL('image/' + type));\n\n    const w = window.open();\n\n    if (!w) {\n        throw new Error('could not create new tab');\n    }\n\n    const label = w.document.createElement('div');\n    const gif = w.document.createElement('img');\n    gif.src = loadingImg;\n    label.append(gif);\n    BB.css(gif, {\n        filter: 'invert(1)',\n    });\n    BB.css(w.document.body, {\n        backgroundColor: '#121211',\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\n        backgroundRepeat: 'no-repeat',\n    });\n    \n    const labelText = w.document.createElement('div');\n    labelText.style.marginTop = '10px';\n    label.append(labelText);\n    labelText.textContent = LANG('upload-uploading');\n\n    w.document.body.append(label);\n    BB.css(label, {\n        marginLeft: 'auto',\n        marginRight: 'auto',\n        marginTop: '100px',\n        fontFamily: 'system-ui, sans-serif',\n        fontSize: '20px',\n        textAlign: 'center',\n        transition: 'opacity 0.3s ease-in-out',\n        opacity: '0',\n        color: '#ccc',\n    });\n    setTimeout(function () {\n        label.style.opacity = '1';\n    }, 20);\n\n    let response;\n    try {\n        const formData = new FormData();\n        formData.append('title', title);\n        formData.append('description', description);\n        formData.append('image', img);\n        response = await fetch('https://api.imgur.com/3/image',  {\n            method: 'POST',\n            headers: {\n                Authorization: 'Client-ID ' + imgurKey,\n            },\n            body: formData,\n        });\n\n    } catch (e) {\n        w.close();\n        throw e;\n    }\n    if (!response.ok) {\n        w.close();\n        throw new Error();\n    }\n    const data: TImgurUploadResponse = (await response.json()).data;\n\n    w.location.href = data.link.replace(/\\.(jpg|png)/, '');\n\n    return data;\n}\n\n\nexport function imgurUpload (\n    klCanvas: KlCanvas,\n    klRootEl: HTMLElement,\n    saveReminder: SaveReminder,\n    imgurKey: string, // API key\n): void {\n    if (!imgurKey) {\n        throw new Error('imgur key missing');\n    }\n\n    const inputTitle = BB.el({tagName: 'input'});\n    inputTitle.type = 'text';\n    inputTitle.value = LANG('upload-title-untitled');\n    const inputDescription = BB.el({\n        tagName: 'textarea',\n        custom: {\n            rows: '2',\n        },\n        css: {\n            width: '100%',\n            maxWidth: '100%',\n        },\n    });\n\n    const labelTitle =  BB.el({\n        textContent: LANG('upload-name') + ':',\n    });\n    const labelDescription = BB.el({\n        textContent: LANG('upload-caption') + ':',\n        css: {\n            marginTop: '10px',\n        },\n    });\n\n    const tos = BB.el({\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\n    });\n\n    const typeRadio = new KL.RadioList({\n        name: 'filetype',\n        init: 'jpeg',\n        items: [\n            { label: 'JPG', value: 'jpeg' },\n            { label: 'PNG', value: 'png' },\n        ],\n        ignoreFocus: true,\n    });\n    BB.css(typeRadio.getElement(), {\n        marginBottom: '10px',\n    });\n\n\n    const outDiv = BB.el();\n    const infoHint = BB.el({\n        className: 'info-hint',\n        textContent: LANG('upload-link-notice'),\n    });\n    outDiv.append(\n        infoHint,\n        typeRadio.getElement(),\n        labelTitle,\n        inputTitle,\n        labelDescription,\n        inputDescription,\n        tos\n    );\n    KL.popup({\n        target: klRootEl,\n        message: `<b>${LANG('upload-title')}</b>`,\n        type: 'upload',\n        div: outDiv,\n        buttons: [LANG('upload-submit'), 'Cancel'],\n        clickOnEnter: LANG('upload-submit'),\n        primaries: [LANG('upload-submit')],\n        autoFocus: LANG('upload-submit'),\n        callback: async function (val) {\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\n                try {\n                    const result = await upload(\n                        klCanvas.getCompleteCanvas(1),\n                        inputTitle.value,\n                        inputDescription.value,\n                        typeRadio.getValue() as 'png' | 'jpeg',\n                        imgurKey,\n                    );\n\n                    KL.popup({\n                        target: klRootEl,\n                        type: 'ok',\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\n                        buttons: ['Ok'],\n                    });\n                    saveReminder.reset();\n\n                } catch(e) {\n                    KL.popup({\n                        target: klRootEl,\n                        type: 'error',\n                        message: LANG('upload-failed'),\n                        buttons: ['Ok'],\n                    });\n                }\n            }\n        },\n    });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"loading.8250a1b1.gif\" + \"?\" + Date.now();","\nexport type TAgPsd = Awaited<typeof import('ag-psd')>;\nlet agPsdLazy: TAgPsd;\n\nexport async function loadAgPsd (): Promise<TAgPsd> {\n    if (!agPsdLazy) {\n        agPsdLazy = await import('ag-psd');\n    }\n    return agPsdLazy;\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"dist.d00432e1.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('7dPZz'));","import {KL} from '../../kl';\nimport {BB} from '../../../bb/bb';\nimport {KlHistoryInterface} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\nimport {BrowserStorageUi} from './browser-storage-ui';\nimport {ProjectStore} from '../../storage/project-store';\nimport {IKlProject} from '../../kl-types';\n\nexport type TSaveReminderSetting = '20min' | '40min' | 'disabled';\n\nconst unsavedActionsLimit = 100; // number of actions user did since last save\nconst LS_REMINDER_KEY = 'kl-save-reminder';\n\n/**\n * remind user of saving, keep user aware of save state\n */\nexport class SaveReminder {\n    private setting: TSaveReminderSetting;\n\n    private lastSavedActionNumber: number | undefined;\n    private lastSavedAt: number = 0;\n\n    private lastReminderShownAt: number = 0;\n    private unsavedInterval: ReturnType<typeof setInterval> | undefined;\n    private closeFunc: (() => void) | undefined;\n\n    showPopup (): void {\n        if (!this.projectStore || !this.getProject) {\n            throw new Error('projectStore and getProject need to be set');\n        }\n\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\n\n        const contentEl = BB.el();\n\n        contentEl.append(\n            BB.el({\n                content: LANG(\n                    'save-reminder-text',\n                    {\n                        a: '<strong>' + min,\n                        b: '</strong>',\n                    }\n                ),\n                css: {\n                    marginBottom: '20px',\n                },\n            }),\n        );\n\n        const psdWrapper = BB.el({\n            css: {\n                borderTop: '1px solid #aaa',\n                margin: '0 -20px',\n                padding: '20px',\n            },\n        });\n        const storageWrapper = BB.el({\n            css: {\n                borderTop: '1px solid #aaa',\n                margin: '0 -20px',\n                padding: '20px',\n                paddingBottom: '0',\n            },\n        });\n        contentEl.append(psdWrapper, storageWrapper);\n\n\n        const psdBtn = BB.el({\n            tagName: 'button',\n            className: 'kl-button',\n            content: LANG('save-reminder-save-psd'),\n            onClick: () => this.onSaveAsPsd(),\n        });\n        psdWrapper.append(\n            psdBtn,\n            BB.el({\n                content: LANG('save-reminder-psd-layers'),\n                css: {\n                    marginTop: '10px',\n                },\n            }),\n        );\n\n\n        const storageUi = new BrowserStorageUi(\n            this.projectStore,\n            this.getProject,\n            this,\n            document.body,\n            {\n                hideClearButton: true,\n                isFocusable: true,\n            }\n        );\n        storageWrapper.append(storageUi.getElement());\n\n\n        KL.popup({\n            target: document.body,\n            message: `<b>${LANG('save-reminder-title')}</b>`,\n            div: contentEl,\n            ignoreBackground: true,\n            callback: () => {\n                storageUi.destroy();\n                BB.destroyEl(psdBtn);\n                this.closeFunc = undefined;\n                this.lastReminderShownAt = performance.now();\n            },\n            closeFunc: (f) => {\n                this.closeFunc = f;\n            },\n        });\n        setTimeout(() => {\n            psdBtn.focus();\n        }, 40);\n    }\n\n    constructor (\n        private history: KlHistoryInterface,\n        private showReminder: boolean,\n        private changeTitle: boolean,\n        private onSaveAsPsd: () => void,\n        private isDrawing: () => boolean,\n        private projectStore: ProjectStore | null, // needed if showReminder\n        private getProject: (() => IKlProject) | null, // needed if showReminder\n        private title: string = 'Klecks',\n    ) {\n        this.setting = (localStorage.getItem(LS_REMINDER_KEY) as TSaveReminderSetting | null) ?? '20min';\n    }\n\n    init (): void {\n        if (this.lastSavedActionNumber !== undefined) { // already initialized\n            return;\n        }\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n\n        if (this.showReminder) {\n            setInterval(() => {\n                if (document.visibilityState !== 'visible') {\n                    return;\n                }\n\n                const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber!);\n\n                const timeLimitMs = 1000 * 60 * {\n                    '20min': 20,\n                    '40min': 40,\n                    'disabled': 0,\n                }[this.setting];\n\n                if (\n                    timeLimitMs > 0 &&\n                    KL.dialogCounter.get() === 0 &&\n                    !this.isDrawing() &&\n                    this.lastReminderShownAt + timeLimitMs < performance.now() &&\n                    unsavedActions >= unsavedActionsLimit\n                ) {\n                    this.showPopup();\n                }\n            }, 1000 * 5);\n        }\n\n        // confirmation dialog when closing tab\n        function onBeforeUnload (e: BeforeUnloadEvent) {\n            e.preventDefault();\n            e.returnValue = '';\n        }\n\n        this.history.addListener(() => {\n            const actionNumber = this.history.getActionNumber();\n            if (this.lastSavedActionNumber !== actionNumber) {\n                window.onbeforeunload =  onBeforeUnload;\n            } else {\n                window.onbeforeunload = null;\n            }\n        });\n\n        if (this.changeTitle) {\n            document.addEventListener('visibilitychange', () => {\n                if (document.visibilityState === 'visible') {\n                    document.title = this.title;\n                    clearInterval(this.unsavedInterval);\n                } else {\n                    const actionNumber = this.history.getActionNumber();\n                    if (this.lastSavedActionNumber !== actionNumber) {\n                        document.title = LANG('unsaved') + ' - ' + this.title;\n                        let state = 0;\n                        this.unsavedInterval = setInterval(() => {\n                            state = (state + 1) % 2;\n                            if (state === 1) {\n                                document.title = LANG('unsaved') + '  ' + this.title;\n                            } else {\n                                document.title = LANG('unsaved') + ' - ' + this.title;\n                            }\n                        }, 1000 * 60 * 3);\n                    }\n                }\n            });\n        }\n    }\n\n    reset (): void {\n        if (this.lastSavedActionNumber === undefined) { // not initialized\n            return;\n        }\n\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n        window.onbeforeunload = null;\n\n        if (this.closeFunc) {\n            this.closeFunc();\n        }\n    }\n\n    getSetting (): TSaveReminderSetting {\n        return this.setting;\n    }\n\n    setSetting (setting: TSaveReminderSetting): void {\n        this.setting = setting;\n        localStorage.setItem(LS_REMINDER_KEY, this.setting);\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {TExportType} from '../kl-types';\nimport {SaveReminder} from '../ui/components/save-reminder';\nimport {saveAs} from '../../bb/base/save-as';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {klConfig} from '../kl-config';\n\nexport class SaveToComputer {\n\n    /**\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\n     * and it doesn't even throw an exception.\n     */\n    private saveImage (canvas: HTMLCanvasElement, filename: string, mimeType: string): void {\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n\n        if (!parts) {\n            throw new Error('saveImage: empty parts');\n        }\n\n        //assume base64 encoding\n        const binStr = atob(parts[3]);\n        //convert to binary in ArrayBuffer\n        const buf = new ArrayBuffer(binStr.length);\n        const view = new Uint8Array(buf);\n        for (let i = 0; i < view.length; i++) {\n            view[i] = binStr.charCodeAt(i);\n        }\n        const blob = new Blob([view], {'type': parts[1]});\n        saveAs(blob, filename);\n    }\n\n    constructor (\n        private saveReminder: SaveReminder,\n        private getExportType: () => TExportType,\n        private getKlCanvas: () => KlCanvas,\n    ) {}\n\n    save (format?: 'psd' | 'layers' | 'png'): void {\n        this.saveReminder.reset();\n\n        if (!format) {\n            format = this.getExportType();\n        }\n\n        if (format === 'png') {\n            const extension = 'png';\n            const mimeType = 'image/png';\n            const filename = BB.getDate() + klConfig.filenameBase + '.' + extension;\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\n            try {\n                this.saveImage(fullCanvas, filename, mimeType);\n            } catch (error) { //fallback for old browsers\n                alert('could not save');\n                throw new Error('failed png export');\n            }\n        } else if (format === 'layers') {\n            const extension = 'png';\n            const mimeType = 'image/png';\n            const fileBase = BB.getDate() + klConfig.filenameBase;\n            const layerArr = this.getKlCanvas().getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                const item = layerArr[i];\n                const fnameArr = [\n                    fileBase,\n                    '_',\n                    ('' + (i + 1)).padStart(2, '0'),\n                    '_',\n                    item.name,\n                    '.',\n                    extension,\n                ];\n                this.saveImage(item.canvas, fnameArr.join(''), mimeType);\n            }\n        } else if (format === 'psd') {\n\n            const layerArr = this.getKlCanvas().getLayersFast();\n\n            const psdConfig: Psd = {\n                width: this.getKlCanvas().getWidth(),\n                height: this.getKlCanvas().getHeight(),\n                children: [],\n                canvas: this.getKlCanvas().getCompleteCanvas(1),\n            };\n            for (let i = 0; i < layerArr.length; i++) {\n                const item = layerArr[i];\n                psdConfig.children!.push({\n                    name: item.name,\n                    hidden: !item.isVisible,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0,\n                });\n            }\n\n            KL.loadAgPsd().then((agPsdLazy) => {\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                const blob = new Blob([buffer], { type: 'application/octet-stream' });\n                saveAs(blob, BB.getDate() + klConfig.filenameBase + '.psd');\n            }).catch(() => {\n                alert('Error: failed to load PSD library');\n            });\n\n        }\n\n    }\n\n}","// https://github.com/eligrey/FileSaver.js/issues/774\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\n\nexport function saveAs (blob: Blob, name: string): void {\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\n    a.download = name;\n    a.rel = 'noopener';\n    a.href = URL.createObjectURL(blob);\n\n    setTimeout(() => URL.revokeObjectURL(a.href), 40 /* sec */ * 1000);\n    setTimeout(() => a.click(), 0);\n}\n","import {KL} from '../kl';\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\nimport {IFilter, IFilterApply, IInitState} from '../kl-types';\nimport {KlCanvas, KlCanvasContext} from '../canvas/kl-canvas';\nimport {LayerManager} from '../ui/tool-tabs/layer-manager/layer-manager';\nimport {LayerPreview} from '../ui/components/layer-preview';\nimport {HandUi} from '../ui/tool-tabs/hand-ui';\nimport {throwIfNull} from '../../bb/base/base';\nimport {TBrush} from '../brushes/brushes';\n\nfunction execHistoryEntry (\n    historyEntry: IHistoryEntry,\n    layerIndex: number,\n    klCanvas: KlCanvas,\n    brushes: TBrush[],\n    setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\n    getCurrentLayerCtx: () => CanvasRenderingContext2D,\n): number {\n    if (historyEntry.tool[0] === 'brush') {\n        const b = brushes[historyEntry.tool[1] as any];\n        historyEntry.actions!.forEach(action => {\n            (b[action.action as keyof TBrush] as any)(...action.params);\n        });\n\n    } else if (historyEntry.tool[0] === 'canvas') {\n        const p = historyEntry.params!;\n        const id = (klCanvas[historyEntry.action as keyof KlCanvas] as any)(...p);\n        if (typeof id === 'number') {\n            layerIndex = id;\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\n        }\n\n    } else if (historyEntry.tool[0] === 'filter') {\n        const p = [{\n            context: getCurrentLayerCtx(),\n            klCanvas,\n            input: historyEntry.params![0].input,\n            history: new KL.DecoyKlHistory(),\n        } as IFilterApply];\n        (KL.filterLib[historyEntry.tool[1]][historyEntry.action! as keyof IFilter] as any)(...p);\n\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'focusLayer') {\n        layerIndex = historyEntry.params![0];\n        const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\n        setCurrentLayerCtx(ctx);\n        Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\n\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'importImage') {\n        const id = klCanvas.addLayer();\n        if (typeof id === 'number') {\n            layerIndex = id;\n            if (historyEntry.params![1]) {\n                klCanvas.renameLayer(layerIndex, historyEntry.params![1]);\n            }\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\n        }\n        getCurrentLayerCtx().drawImage(historyEntry.params![0], 0, 0);\n    }\n    return layerIndex;\n}\n\nexport class UndoRedoCatchup {\n\n    private doIgnore = false;\n\n    /**\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\n     * true -> ignore, don't undo / redo\n     */\n    private shouldIgnoreTest (): boolean {\n        if (this.doIgnore) {\n            return true;\n        }\n        this.doIgnore = true;\n        setTimeout(() => {\n            this.doIgnore = false;\n        }, 0);\n        return false;\n    }\n    \n\n    // ---- public ----\n\n    constructor (\n        private brushUiMap: any, // todo\n        private layerPreview: LayerPreview,\n        private layerManager: LayerManager,\n        private handUi: HandUi,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private getInitState: () => IInitState,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\n        private setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\n        private getCurrentBrush: () => TBrush,\n    ) { }\n\n    undo (): boolean {\n        if (this.shouldIgnoreTest() || !klHistory.canUndo()) {\n            return false;\n        }\n        const entries: IHistoryEntry[] = klHistory.undo();\n        const klCanvas = this.getKlCanvas();\n        klHistory.pause(true);\n        const initState: IInitState = this.getInitState();\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\n        klCanvas.copy(initState.canvas);\n        let layerIndex = initState.focus;\n        this.setCurrentLayerCtx(throwIfNull(klCanvas.getLayerContext(layerIndex)));\n        const brushes: any = {};\n        Object.entries(KL.brushes).forEach(([b, brush]) => {\n            brushes[b] = new brush();\n            brushes[b].setContext(this.getCurrentLayerCtx());\n        });\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n        entries.forEach(entry => {\n            layerIndex = execHistoryEntry(\n                entry,\n                layerIndex,\n                klCanvas,\n                brushes,\n                (ctx) => this.setCurrentLayerCtx(ctx),\n                () => throwIfNull(this.getCurrentLayerCtx()),\n            );\n        });\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        this.layerManager.update(layerIndex);\n        this.layerPreview.setLayer(throwIfNull(klCanvas.getLayer(layerIndex)));\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx()! as KlCanvasContext);\n        this.klCanvasWorkspace.setLastDrawEvent();\n\n        klHistory.pause(false);\n        return true;\n    }\n\n    redo (): boolean {\n        if (this.shouldIgnoreTest() || !klHistory.canRedo()) {\n            return false;\n        }\n        const entry = klHistory.redo();\n        if (!entry) {\n            setTimeout(() => {\n                throw new Error('redo failed. redo entry undefined');\n            });\n            return false;\n        }\n        const klCanvas = this.getKlCanvas();\n        klHistory.pause(true);\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\n        const brushes: any = {};\n        Object.entries(KL.brushes).forEach(([b, brush]) => {\n            brushes[b] = new brush();\n            brushes[b].setContext(this.getCurrentLayerCtx());\n        });\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\n        execHistoryEntry(\n            entry,\n            0, // doesn't matter, because result not used\n            klCanvas,\n            brushes,\n            (ctx) => this.setCurrentLayerCtx(ctx),\n            () => throwIfNull(this.getCurrentLayerCtx()),\n        );\n\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        const currentLayerIndex = throwIfNull(klCanvas.getLayerIndex(this.getCurrentLayerCtx()!.canvas));\n        this.layerManager.update(currentLayerIndex);\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex)!);\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx()! as KlCanvasContext);\n        this.klCanvasWorkspace.setLastDrawEvent();\n        klHistory.pause(false);\n\n        return true;\n    }\n\n    catchup (logParam: IHistoryBroadcast | null): void {\n        // const start = performance.now();\n        //play catch up (the version that is a few steps behind)\n\n        if (!logParam || !logParam.bufferUpdate) {\n            return;\n        }\n\n        const initState: IInitState = this.getInitState();\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n\n        initState.focus = execHistoryEntry(\n            logParam.bufferUpdate,\n            initState.focus,\n            initState.canvas,\n            initState.brushes,\n            (ctx) => {\n                localCurrentLayerCtx = ctx;\n            },\n            () => throwIfNull(localCurrentLayerCtx),\n        );\n\n        // console.log('catchup', performance.now() - start);\n    }\n\n\n}","import {IRGB, ISliderConfig} from '../kl-types';\n\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\n    { type: 'opacity'; value: number } |\n    { type: 'size'; value: number } |\n    { type: 'sliderConfig'; value: ISliderConfig };\n\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\n\n/**\n * Central place to update brush settings, and to subscribe to changes.\n */\nexport class BrushSettingService {\n\n    private static instance: BrushSettingService;\n    subscriberArr: TBrushSettingSubscriber[] = [];\n\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (this.subscriberArr[i] === skipSubscriber) {\n                continue;\n            }\n            this.subscriberArr[i](obj);\n        }\n    }\n\n    // --- public ---\n\n    constructor (\n        private onSetColor: (rgb: IRGB) => void,\n        private onSetSize: (size: number) => void,\n        private onSetOpacity: (opacity: number) => void,\n        private onGetColor: () => IRGB,\n        private onGetSize: () => number,\n        private onGetOpacity: () => number,\n        private onGetSliderConfig: () => ISliderConfig,\n    ) {\n        if (BrushSettingService.instance) {\n            throw new Error('BrushSettingService already instantiated');\n        }\n        BrushSettingService.instance = this;\n    }\n\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'color',\n                value: color,\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'size',\n                value: size,\n            },\n            skipSubscriber\n        );\n    }\n\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'opacity',\n                value: opacity,\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\n        this.emit(\n            {\n                type: 'sliderConfig',\n                value: sliderConfig,\n            },\n            skipSubscriber\n        );\n    }\n\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetSize(size);\n        // why not emitting?\n    }\n\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetOpacity(opacity);\n        // why not emitting?\n    }\n\n    /**\n     * get current brush color\n     */\n    getColor (): IRGB {\n        return this.onGetColor();\n    }\n\n    getSize (): number {\n        return this.onGetSize();\n    }\n\n    getOpacity (): number {\n        return this.onGetOpacity();\n    }\n\n    getSliderConfig (): ISliderConfig {\n        return this.onGetSliderConfig();\n    }\n\n    /**\n     * subscribe to changes\n     * @param func\n     */\n    subscribe (func: TBrushSettingSubscriber): void {\n        if (this.subscriberArr.includes(func)) {\n            return;\n        }\n        this.subscriberArr.push(func);\n    }\n\n    unsubscribe (func: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (func === this.subscriberArr[i]) {\n                this.subscriberArr.splice(i, 1);\n                i--;\n            }\n        }\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\nimport {KL} from '../../kl';\nimport {languages} from '../../../../languages/languages';\nimport bitbofLogoImg from '/src/app/img/bitbof-logo.svg';\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\nimport {LocalStorage} from '../../../bb/base/local-storage';\nimport {theme, TTheme} from '../../../theme/theme';\nimport {addIsDarkListener, nullToUndefined} from '../../../bb/base/base';\nimport {showLicensesDialog} from '../modals/licenses-dialog/show-licenses-dialog';\nimport {c} from '../../../bb/base/c';\nimport {SaveReminder} from '../components/save-reminder';\nimport {showModal} from '../modals/base/showModal';\n\nexport class SettingsTab {\n\n    private readonly rootEl: HTMLElement;\n\n    // --- public ---\n    constructor (\n        onLeftRight: () => void,\n        saveReminder: SaveReminder | undefined,\n        customAbout?: HTMLElement,\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n\n        // ---- language ----\n        const autoLanguage = languageStrings.getAutoLanguage();\n\n        const langWrapper = BB.el({\n            parent: this.rootEl,\n            content: BB.el({\n                content: LANG('settings-language') + ':',\n                css: {\n                    marginRight: '5px',\n                    marginBottom: '2px',\n                },\n            }),\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                flexWrap: 'wrap',\n            },\n        });\n\n        const options: [string, string][] = [\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [string, string],\n            ...languages.map(item => {\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\n            }),\n        ];\n        const languageSelect = new KL.Select({\n            initValue: nullToUndefined(LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'),\n            optionArr: options,\n            onChange: (val) => {\n                if (val === 'auto') {\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\n                } else {\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\n                }\n                languageHint.style.display = 'block';\n            },\n        });\n        BB.css(languageSelect.getElement(), {\n            flexGrow: '1',\n        });\n        const languageHint = BB.el({\n            className: 'kl-toolspace-note',\n            content: LANG('settings-language-reload'),\n            css: {\n                display: 'none',\n                marginTop: '5px',\n                flexGrow: '1',\n            },\n        });\n\n        langWrapper.append(\n            languageSelect.getElement(),\n            languageHint,\n        );\n\n\n        // ---- theme ----\n        function themeToLabel (theme: TTheme): string {\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\n        }\n        const themeSelect = new KL.Select({\n            optionArr: [\n                ['auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme())],\n                ['light', themeToLabel('light')],\n                ['dark', themeToLabel('dark')],\n            ],\n            initValue: theme.getStoredTheme() || 'auto',\n            onChange: (val): void => {\n                theme.setStoredTheme(val === 'auto' ? undefined : val);\n            },\n        });\n        BB.css(themeSelect.getElement(), {\n            flexGrow: '1',\n        });\n        addIsDarkListener(() => {\n            themeSelect.updateLabel('auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme()));\n        });\n        BB.el({\n            parent: this.rootEl,\n            content: [\n                BB.el({\n                    content: LANG('settings-theme') + ':',\n                    css: {\n                        marginRight: '5px',\n                        marginBottom: '2px',\n                    },\n                }),\n                themeSelect.getElement(),\n            ],\n            css: {\n                marginTop: '15px',\n                display: 'flex',\n                alignItems: 'center',\n                flexWrap: 'wrap',\n            },\n        });\n\n        // ---- save reminder ----\n        if (saveReminder) {\n            const reminderSelect = new KL.Select({\n                optionArr: [\n                    ['20min', LANG('x-minutes', {x: '20'})],\n                    ['40min', LANG('x-minutes', {x: '40'})],\n                    ['disabled', ' ' + LANG('settings-save-reminder-disabled')],\n                ],\n                initValue: saveReminder.getSetting(),\n                onChange: (val) => {\n                    if (val !== 'disabled') {\n                        saveReminder.setSetting(val);\n                        return;\n                    }\n                    const disableStr = LANG('settings-save-reminder-confirm-disable');\n                    showModal({\n                        target: document.body,\n                        message: '' + LANG('settings-save-reminder-confirm-title'),\n                        div: c('', [\n                            c('.info-hint', LANG('settings-save-reminder-confirm-a')),\n                            LANG('settings-save-reminder-confirm-b'),\n                        ]),\n                        buttons: [disableStr, 'Cancel'],\n                        callback: (result) => {\n                            if (result === disableStr) {\n                                saveReminder.setSetting(val);\n                            } else {\n                                reminderSelect.setValue(saveReminder.getSetting());\n                            }\n                        },\n                    });\n                },\n            });\n            reminderSelect.getElement().style.flexGrow = '1';\n\n            this.rootEl.append(c(',flex,items-center,gap-5,mt-15,flexWrap', [\n                LANG('settings-save-reminder-label') + ':',\n                reminderSelect.getElement(),\n            ]));\n        }\n\n        // ---- flip ui ----\n        BB.el({\n            tagName: 'button',\n            parent: this.rootEl,\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\n            onClick: () => onLeftRight(),\n            css: {\n                marginTop: '15px',\n            },\n            custom: {\n                tabIndex: '-1',\n            },\n        });\n\n\n        // ---- about ----\n        this.rootEl.append(BB.el({className: 'grid-hr', css: {margin: '10px 0'}}));\n\n        function makeLicenses () {\n            return BB.el({\n                tagName: 'a',\n                content: LANG('licenses'),\n                onClick: () => showLicensesDialog(),\n            });\n        }\n\n        if (customAbout) {\n            this.rootEl.append(customAbout);\n            if (!customAbout.innerHTML) {\n                const minimalAbout = BB.el({\n                    parent: customAbout,\n                    css: {\n                       textAlign: 'center',\n                   },\n                });\n                minimalAbout.append(\n                    BB.el({\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\n                    }),\n                    makeLicenses(),\n                );\n            }\n        } else {\n            const versionEl = BB.el({\n                parent: this.rootEl,\n                css: {\n                    textAlign: 'center',\n                },\n                content: `\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${klecksLogoImg}\"><br>\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\n            });\n\n            versionEl.append(\n                makeLicenses(),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('donate'),\n                    custom: {\n                        href: 'https://kleki.com/donate/',\n                        target: '_blank',\n                    },\n                }),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('source-code'),\n                    custom: {\n                        href: 'https://klecks.org',\n                        target: '_blank',\n                    },\n                }),\n            );\n\n\n        }\n\n        window.addEventListener('storage', (e) => {\n            if (e.key !== LS_LANGUAGE_KEY) {\n                return;\n            }\n            languageSelect.setValue(\n                nullToUndefined(LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'),\n            );\n        });\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"bitbof-logo.780497d6.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"ui-swap-lr.32bed0c0.svg\" + \"?\" + Date.now();","import {c} from '../../../../bb/base/c';\nimport {css as emotionCss} from '@emotion/css';\nimport {DynamicModal} from '../base/dynamic-modal';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\n\nexport function showLicensesDialog () {\n    const licensesCss = emotionCss({\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '10px',\n        'details > div': {\n            padding: '10px',\n            boxShadow: '0 0 0 1px',\n            marginTop: '5px',\n            fontFamily: 'monospace',\n            background: '#aaa2',\n            overflow: 'hidden',\n        },\n        'summary': {\n            cursor: 'pointer',\n            userSelect: 'none',\n        },\n    });\n\n    const libraries = c('.' + licensesCss, LANG('loading'));\n    const fonts = c('.' + licensesCss, LANG('loading'));\n\n    const content = c(',flex,flexCol,gap-10', [\n        libraries,\n        fonts,\n    ]);\n\n    new DynamicModal({\n        title: BB.el({\n            content: LANG('licenses'),\n        }),\n        content: BB.el({\n            content,\n            css: {\n                height: '100%',\n                overflowY: 'auto',\n                padding: '10px',\n                boxSizing: 'border-box',\n            },\n        }),\n        width: 800,\n        isMaxHeight: true,\n        onClose: () => {\n            if (window.location.hash === '#licenses') {\n                history.replaceState('', document.title, window.location.pathname\n                    + window.location.search);\n            }\n        },\n    });\n\n    import('./licenses').then(result => {\n        libraries.innerHTML = '';\n        result.licenses.forEach(item => {\n            libraries.append(c('details', [\n                c('summary', item.title),\n                c('', item.full.replace(/\\n/g, '<br>')),\n            ]));\n        });\n    });\n\n    import('../../../../../fonts/font-licenses').then(result => {\n        fonts.innerHTML = '';\n        result.fontLicenses.forEach(item => {\n            fonts.append(c('details', [\n                c('summary', 'Font: ' + item.title),\n                c('', item.full.replace(/\\n/g, '<br>')),\n            ]));\n        });\n    });\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"licenses.ae51f5b4.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('9T8Bv'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('d3gnI') + \"font-licenses.8c6dc81e.js\" + \"?\" + Date.now()).catch(err => {delete module.bundle.cache[module.id]; throw err;})).then(() => module.bundle.root('2SIAq'));","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\nimport {dialogCounter} from '../modals/modal-count';\n\n/**\n * Scroll buttons at the top and bottom of toolspace\n * Show up when window is very small.\n * Allow user to scroll up and down toolspace.\n */\nexport class ToolspaceScroller {\n\n    private readonly toolspace: HTMLElement;\n    private readonly upBtn: HTMLElement;\n    private readonly downBtn: HTMLElement;\n    private downInterval: any;\n    private upInterval: any;\n\n    private update (): void {\n        let newUpDisplay = this.upBtn.style.display;\n        let newDownDisplay = this.downBtn.style.display;\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\n            if (!this.upInterval) {\n                newUpDisplay = this.toolspace.scrollTop === 0 ? 'none' : 'block';\n            }\n            if (!this.downInterval) {\n                newDownDisplay = (\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\n                        'none' : 'block'\n                );\n            }\n        } else {\n            newUpDisplay = 'none';\n            newDownDisplay = 'none';\n        }\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newUpDisplay !== this.upBtn.style.display) {\n            this.upBtn.style.display = newUpDisplay;\n        }\n        if (newDownDisplay !== this.downBtn.style.display) {\n            this.downBtn.style.display = newDownDisplay;\n        }\n    }\n\n    // --- public ---\n    constructor (p: {toolspace: HTMLElement; uiState: 'left' | 'right'}) {\n        this.toolspace = p.toolspace;\n        this.upBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                top: '0',\n                transform: 'rotate(180deg)',\n            },\n        });\n        this.downBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                bottom: '0',\n            },\n        });\n        this.updateUiState(p.uiState);\n\n        const upListener = new BB.PointerListener({\n            target: this.upBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.upInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, -13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.upInterval);\n                    setTimeout(() => { // prevent ff pressing anything underneath\n                        this.upInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            },\n        });\n        const downListener = new BB.PointerListener({\n            target: this.downBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.downInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, 13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.downInterval);\n                    setTimeout(() => { // prevent ff pressing anything underneath\n                        this.downInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            },\n        });\n\n        const wheelListener = (e: WheelEvent) => {\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\n            this.update();\n        };\n        this.upBtn.addEventListener('wheel', wheelListener);\n        this.downBtn.addEventListener('wheel', wheelListener);\n\n        this.update();\n\n        const observer = new MutationObserver(() => this.update());\n        observer.observe(\n            this.toolspace,\n            {\n                attributes: true,\n                childList: true,\n                subtree: true,\n            }\n        );\n        window.addEventListener('resize', () => this.update());\n\n        // hide if in dialog because that can have its own scrollbar\n        dialogCounter.subscribe((v) => {\n            // ignores the 0.5 by tool dropdown\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\n        });\n    }\n\n    updateUiState (uiState: 'left' | 'right'): void {\n        BB.css(this.upBtn, {\n            left: uiState === 'left' ? '0' : '',\n            right: uiState === 'right' ? '0' : '',\n        });\n        BB.css(this.downBtn, {\n            left: uiState === 'left' ? '0' : '',\n            right: uiState === 'right' ? '0' : '',\n        });\n    }\n}","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../components/kl-slider';\nimport {LANG} from '../../../language/language';\nimport {Checkbox} from '../components/checkbox';\nimport {Options} from '../components/options';\nimport {TGradientType} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n\ninterface IGradientUiSettings {\n    opacity: number;\n    type: TGradientType;\n    doLockAlpha: boolean;\n    doSnap: boolean;\n    isReversed: boolean;\n    isEraser: boolean;\n}\n\n/**\n * Gradient Tool tab contents\n *\n * @param p\n * @constructor\n */\nexport class GradientUi {\n\n    private readonly rootEl: HTMLElement;\n    private colorDiv: HTMLElement;\n    private colorSlider: KlColorSlider;\n    private isVisible: boolean;\n    private readonly iconArr: HTMLElement[];\n\n    private settings: IGradientUiSettings = {\n        opacity: 1,\n        type: 'linear',\n        doLockAlpha: false,\n        doSnap: false,\n        isReversed: false,\n        isEraser: false,\n    };\n\n    private updateIcons (): void {\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\n    }\n\n    // ----- public -------\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.colorSlider = p.colorSlider;\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.iconArr = [];\n        {\n            const size = 33;\n            [0, 1, 2].forEach(() => {\n                const el = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        width: size + 'px',\n                        height: size + 'px',\n                        borderRadius: '3px',\n                        margin: '1px',\n                    },\n                });\n                this.iconArr.push(el);\n            });\n        }\n        this.updateIcons();\n\n        const typeOptions = new Options<TGradientType>({\n            optionArr: [\n                {\n                    id: 'linear',\n                    label: this.iconArr[0],\n                    title: LANG('gradient-linear'),\n                },\n                {\n                    id: 'linear-mirror',\n                    label: this.iconArr[1],\n                    title: LANG('gradient-linear-mirror'),\n                },\n                {\n                    id: 'radial',\n                    label: this.iconArr[2],\n                    title: LANG('gradient-radial'),\n                },\n            ],\n            initId: 'linear',\n            onChange: (id) => {\n                this.settings.type = id;\n            },\n        });\n        this.rootEl.append(typeOptions.getElement());\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: this.settings.opacity,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (val) => {\n                this.settings.opacity = val;\n            },\n        });\n        BB.css(opacitySlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(opacitySlider.getElement());\n\n\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            init: false,\n            label: LANG('reverse'),\n            callback: (b) => {\n                this.settings.isReversed = b;\n                this.updateIcons();\n            },\n            css: {\n                width: '50%',\n            },\n        });\n\n        const doSnapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: (b) => {\n                this.settings.doSnap = b;\n            },\n            css: {\n                width: '50%',\n            },\n        });\n\n        row1.append(\n            reverseToggle.getElement(),\n            doSnapToggle.getElement(),\n        );\n\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        const eraserToggle = new Checkbox({\n            init: this.settings.isEraser,\n            label: LANG('eraser'),\n            callback: (b) => {\n                this.settings.isEraser = b;\n            },\n            css: {\n                width: '50%',\n            },\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            callback: (b) => {\n                this.settings.doLockAlpha = b;\n            },\n            doHighlight: true,\n            css: {\n                width: '50%',\n            },\n        });\n\n        row2.append(\n            eraserToggle.getElement(),\n            lockAlphaToggle.getElement(),\n        );\n\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (isVisible: boolean): void {\n        this.isVisible = !!isVisible;\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n        }\n    }\n\n    getSettings (): IGradientUiSettings {\n        return BB.copyObj(this.settings);\n    }\n\n}","import {KL} from '../klecks/kl';\nimport {klHistory, TMiscFocusLayerHistoryEntry} from '../klecks/history/kl-history';\nimport {BB} from '../bb/bb';\nimport {showIframeModal} from '../klecks/ui/modals/show-iframe-modal';\nimport {EmbedToolspaceTopRow} from '../embed/embed-toolspace-top-row';\nimport {\n    IGradient,\n    IInitState,\n    IKlProject, IRGB,\n    TDrawEvent,\n    TExportType,\n    TKlCanvasLayer,\n    TUiLayout,\n} from '../klecks/kl-types';\nimport {importFilters} from '../klecks/filters/filters-lazy';\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\nimport {ProjectStore} from '../klecks/storage/project-store';\nimport {SaveReminder} from '../klecks/ui/components/save-reminder';\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\nimport {LANG} from '../language/language';\nimport {LocalStorage} from '../bb/base/local-storage';\nimport {LineSmoothing} from '../klecks/events/line-smoothing';\nimport {LineSanitizer} from '../klecks/events/line-sanitizer';\nimport {TabRow} from '../klecks/ui/components/tab-row';\nimport {LayerPreview} from '../klecks/ui/components/layer-preview';\nimport {KlColorSlider} from '../klecks/ui/components/kl-color-slider';\nimport {ToolspaceToolRow} from '../klecks/ui/components/toolspace-tool-row';\nimport {StatusOverlay} from '../klecks/ui/components/status-overlay';\nimport {SaveToComputer} from '../klecks/storage/save-to-computer';\nimport {ToolspaceCollapser} from '../klecks/ui/components/toolspace-collapser';\nimport {ToolspaceScroller} from '../klecks/ui/components/toolspace-scroller';\nimport {translateSmoothing} from '../klecks/utils/translate-smoothing';\nimport {ImportHandler} from './import-handler';\n\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\nimport tabSettingsImg from '/src/app/img/ui/tab-settings.svg';\nimport tabLayersImg from '/src/app/img/ui/tab-layers.svg';\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\nimport {IVector2D} from '../bb/bb-types';\nimport {createConsoleApi} from './console-api';\nimport {ERASE_COLOR} from '../klecks/brushes/erase-color';\nimport {throwIfNull} from '../bb/base/base';\nimport {klConfig} from '../klecks/kl-config';\nimport {TRenderTextParam} from '../klecks/image-operations/render-text';\n\ntype KlAppOptionsEmbed = {\n    url: string;\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\n};\n\ninterface IKlAppOptions {\n    saveReminder?: SaveReminder;\n    projectStore?: ProjectStore;\n    logoImg?: string; // app logo\n    bottomBar?: HTMLElement; // row at bottom of toolspace\n    embed?: KlAppOptionsEmbed;\n    app?: {\n        imgurKey?: string; // for imgur uploads\n    };\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\n}\n\nimportFilters();\n\nexport class KlApp {\n\n    private readonly klRootEl: HTMLElement;\n    private uiWidth: number;\n    private uiHeight: number;\n    private readonly layerPreview: LayerPreview;\n    private readonly klColorSlider: KlColorSlider;\n    private readonly toolspaceToolRow: ToolspaceToolRow;\n    private readonly statusOverlay: StatusOverlay;\n    private readonly klCanvas: KlCanvas;\n    private uiState: TUiLayout;\n    private readonly embed: undefined | KlAppOptionsEmbed;\n    private readonly saveToComputer: SaveToComputer;\n    private readonly lineSanitizer: LineSanitizer;\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\n    private readonly collapseThreshold: number = 820;\n    private readonly toolspaceCollapser: ToolspaceCollapser;\n    private readonly toolspace: HTMLElement;\n    private readonly toolspaceInner: HTMLElement;\n    private readonly toolWidth: number = 271;\n    private readonly bottomBar: HTMLElement | undefined;\n    private readonly layerManager: LayerManager;\n    private readonly toolspaceScroller: ToolspaceScroller;\n    private readonly bottomBarWrapper: HTMLElement;\n\n    private updateCollapse (): void {\n\n        //collapser\n        if (this.uiWidth < this.collapseThreshold) {\n            this.toolspaceCollapser.getElement().style.display = 'block';\n\n            this.toolspaceCollapser.setDirection(this.uiState);\n            if (this.toolspaceCollapser.isOpen()) {\n                if (this.uiState === 'left') {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '271px',\n                        right: '',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '271px',\n                    });\n                } else {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '',\n                        right: '271px',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '0',\n                    });\n                }\n                this.toolspace.style.display = 'block';\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n                this.statusOverlay.setWide(false);\n\n            } else {\n                if (this.uiState === 'left') {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '0',\n                        right: '',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '0',\n                    });\n                } else {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '',\n                        right: '0',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '0',\n                    });\n                }\n                this.toolspace.style.display = 'none';\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\n                this.statusOverlay.setWide(true);\n\n            }\n\n        } else {\n            this.toolspaceCollapser.getElement().style.display = 'none';\n            if (this.uiState === 'left') {\n                BB.css(this.klCanvasWorkspace.getElement(), {\n                    left: '271px',\n                });\n            } else {\n                BB.css(this.klCanvasWorkspace.getElement(), {\n                    left: '0',\n                });\n            }\n            this.toolspace.style.display = 'block';\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n            this.statusOverlay.setWide(false);\n        }\n    }\n\n    private updateBottomBar (): void {\n        if (!this.bottomBar) {\n            return;\n        }\n        const isVisible = (this.toolspaceInner.scrollHeight + 40 < window.innerHeight);\n        const newDisplay = isVisible ? '' : 'none';\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newDisplay !== this.bottomBarWrapper.style.display) {\n            this.bottomBarWrapper.style.display = newDisplay;\n        }\n    }\n\n    private updateUi (): void {\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiState === 'left');\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiState === 'right');\n        if (this.uiState === 'left') {\n            BB.css(this.toolspace, {\n                left: '0',\n                right: '',\n            });\n            BB.css(this.klCanvasWorkspace.getElement(), {\n                left: '271px',\n            });\n        } else {\n            BB.css(this.toolspace, {\n                left: '',\n                right: '0',\n            });\n            BB.css(this.klCanvasWorkspace.getElement(), {\n                left: '0',\n            });\n        }\n        this.statusOverlay.setUiState(this.uiState);\n        this.layerPreview.setUiState(this.uiState);\n        this.layerManager.setUiState(this.uiState);\n        this.updateCollapse();\n        this.toolspaceScroller.updateUiState(this.uiState);\n    }\n\n    // -------- public --------\n    constructor (\n        pProject: IKlProject | null,\n        pOptions: IKlAppOptions,\n    ) {\n        this.embed = pOptions.embed;\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\n        // but not larger than 4096 - a fairly arbitrary decision\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\n        this.uiState = (this.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as TUiLayout;\n        const projectStore = pOptions.projectStore;\n        this.klRootEl = BB.el({\n            className: 'g-root',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n            },\n        });\n        this.uiWidth = Math.max(0, window.innerWidth);\n        this.uiHeight = Math.max(0, window.innerHeight);\n        let exportType: TExportType = 'png';\n        this.klCanvas = new KL.KlCanvas(\n            pProject ? {\n                projectObj: pProject,\n            } : {\n                width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\n                height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight)),\n            }, this.embed ? -1 : 0);\n        this.klCanvas.setHistory(klHistory);\n        let initState: IInitState;\n        let mainTabRow: TabRow | undefined = undefined;\n\n        if (!pOptions.saveReminder) {\n            pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\n        }\n\n        if (pProject) {\n            // attempt at freeing memory\n            pProject.layers.forEach(layer => {\n                layer.image = null as any;\n            });\n            pProject = null;\n        } else {\n            klHistory.pause(true);\n            this.klCanvas.addLayer();\n            this.klCanvas.layerFill(0, {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR});\n            klHistory.pause(false);\n        }\n        try {\n            initState = {\n                canvas: new KL.KlCanvas({copy: this.klCanvas}, this.embed ? -1 : 0),\n                focus: this.klCanvas.getLayerCount() - 1,\n                brushes: {},\n            };\n        } catch (e) {\n            if ((e as Error).message === 'kl-create-canvas-error') {\n                this.klCanvas.destroy();\n            }\n            throw e;\n        }\n        Object.entries(KL.brushes).forEach(([b, Brush]) => {\n            initState.brushes[b] = new Brush();\n            if (initState.canvas) {\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\n            }\n        });\n\n\n        let currentColor = new BB.RGB(0, 0, 0);\n        let currentBrushUi: any; // todo\n        let currentBrushId: string;\n        let lastNonEraserBrushId: string;\n        let currentLayerCtx = throwIfNull(this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1));\n\n        // when cycling through brushes you need to know the next non-eraser brush\n        const getNextBrushId = (): string => {\n            if (currentBrushId === 'eraserBrush') {\n                return lastNonEraserBrushId;\n            }\n            const keyArr = Object.keys(brushUiMap).filter(item => item !== 'eraserBrush');\n            const i = keyArr.findIndex(item => item === currentBrushId);\n            return keyArr[(i + 1) % keyArr.length];\n        };\n\n        const sizeWatcher = (val: number) => {\n            brushSettingService.emitSize(val);\n            if (this.klCanvasWorkspace) {\n                this.klCanvasWorkspace.setCursorSize(val * 2);\n            }\n        };\n\n        const brushSettingService = new KL.BrushSettingService(\n            (color) => {\n                this.klColorSlider.setColor(color);\n                currentBrushUi.setColor(color);\n                currentColor = BB.copyObj(color);\n            },\n            (size) => {\n                currentBrushUi.setSize(size);\n                this.klCanvasWorkspace.setCursorSize(size * 2);\n            },\n            (opacity) => {\n                currentBrushUi.setOpacity(opacity);\n            },\n            () => this.klColorSlider.getColor(),\n            () => brushUiMap[currentBrushId].getSize(),\n            () => brushUiMap[currentBrushId].getOpacity(),\n            () => {\n                return {\n                    sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\n                    opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\n                };\n            }\n        );\n\n        const lineSmoothing = new LineSmoothing({\n            smoothing: translateSmoothing(1),\n        });\n        this.lineSanitizer = new LineSanitizer();\n\n        const drawEventChain = new BB.EventChain({\n            chainArr: [\n                this.lineSanitizer as any,\n                lineSmoothing as any,\n            ],\n        });\n\n        drawEventChain.setChainOut(((event: TDrawEvent) => {\n            if (event.type === 'down') {\n                this.toolspace.style.pointerEvents = 'none';\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === 'move') {\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === 'up') {\n                this.toolspace.style.pointerEvents = '';\n                currentBrushUi.endLine();\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === 'line') {\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\n                this.klCanvasWorkspace.requestFrame();\n            }\n        }) as any);\n\n        let textToolSettings = {\n            size: 20,\n            align: 'left' as ('left' | 'center' | 'right'),\n            isBold: false,\n            isItalic: false,\n            font: 'sans-serif',\n            letterSpacing: 0,\n            lineHeight: 1,\n            fill: {\n                color: {r: 0, g: 0, b: 0, a: 1},\n            },\n        } as TRenderTextParam;\n\n        this.klCanvasWorkspace = new KL.KlCanvasWorkspace({\n            klCanvas: this.klCanvas,\n            width: Math.max(0, this.uiWidth - this.toolWidth),\n            height: this.uiHeight,\n            onDraw: (e) => drawEventChain.chainIn(e as any),\n            onPick: (rgbObj, isDragDone) => {\n                brushSettingService.setColor(rgbObj);\n                if (isDragDone) {\n                    this.klColorSlider.pickingDone();\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\n                }\n            },\n            onFill: (canvasX, canvasY) => {\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                this.klCanvas.floodFill(\n                    layerIndex,\n                    canvasX,\n                    canvasY,\n                    fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\n                    fillUi.getOpacity(),\n                    fillUi.getTolerance(),\n                    fillUi.getSample(),\n                    fillUi.getGrow(),\n                    fillUi.getContiguous()\n                );\n                this.klCanvasWorkspace.requestFrame();\n            },\n            onGradient: (typeStr, canvasX, canvasY, angleRad) => {\n                if (typeStr === 'down') {\n                    gradientTool.onDown(canvasX, canvasY, angleRad);\n                }\n                if (typeStr === 'move') {\n                    gradientTool.onMove(canvasX, canvasY);\n                }\n                if (typeStr === 'up') {\n                    gradientTool.onUp(canvasX, canvasY);\n                }\n            },\n            onText: (canvasX, canvasY, angleRad) => {\n                if (KL.dialogCounter.get() > 0) {\n                    return;\n                }\n\n                KL.textToolDialog({\n                    klCanvas: this.klCanvas,\n                    layerIndex: throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\n                    primaryColor: this.klColorSlider.getColor(),\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\n\n                    text: {\n                        ...textToolSettings,\n                        text: '',\n                        x: canvasX,\n                        y: canvasY,\n                        angleRad: angleRad,\n                        fill : textToolSettings.fill ? {\n                            color: {\n                                ...this.klColorSlider.getColor(),\n                                a: textToolSettings.fill.color.a,\n                            },\n                        } : undefined,\n                        stroke : textToolSettings.stroke ? {\n                            ...textToolSettings.stroke,\n                            color: {\n                                ...this.klColorSlider.getSecondaryRGB(),\n                                a: textToolSettings.stroke.color.a,\n                            },\n                        } : undefined,\n                    },\n\n                    onConfirm: (val) => {\n                        textToolSettings = {\n                            ...val,\n                            text: '',\n                        };\n                        const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                        this.klCanvas.text(layerIndex, val);\n                        this.klCanvasWorkspace.requestFrame();\n                    },\n                });\n\n            },\n            onShape: (typeStr, canvasX, canvasY, angleRad) => {\n                if (typeStr === 'down') {\n                    shapeTool.onDown(canvasX, canvasY, angleRad);\n                }\n                if (typeStr === 'move') {\n                    shapeTool.onMove(canvasX, canvasY);\n                }\n                if (typeStr === 'up') {\n                    shapeTool.onUp(canvasX, canvasY);\n                }\n            },\n\n            onViewChange: (viewChangeObj) => {\n\n                if (viewChangeObj.changed.includes('scale')) {\n                    this.statusOverlay.out({\n                        type: 'transform',\n                        scale: viewChangeObj.scale,\n                        angleDeg: viewChangeObj.angle * 180 / Math.PI,\n                    });\n                }\n\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\n\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\n            },\n            onUndo: () => {\n                if (klHistory.canUndo()) {\n                    if (undoRedoCatchup.undo()) {\n                        this.statusOverlay.out(LANG('undo'), true);\n                    }\n                }\n            },\n            onRedo: () => {\n                if (klHistory.canRedo()) {\n                    if (undoRedoCatchup.redo()) {\n                        this.statusOverlay.out(LANG('redo'), true);\n                    }\n                }\n            },\n        });\n\n        const updateMainTabVisibility = () => {\n            if (!mainTabRow) {\n                return;\n            }\n\n            const toolObj = {\n                'draw': {},\n                'hand': {},\n                'fill': {},\n                'gradient': {},\n                'text': {},\n                'shape': {},\n            };\n\n            const activeStr = this.toolspaceToolRow.getActive();\n            const oldTabId = mainTabRow.getOpenedTabId();\n\n            const keysArr = Object.keys(toolObj);\n            for (let i = 0; i < keysArr.length; i++) {\n                if (activeStr === keysArr[i]) {\n                    mainTabRow.setIsVisible(keysArr[i], true);\n                } else {\n                    mainTabRow.setIsVisible(keysArr[i], false);\n                    if (oldTabId === keysArr[i]) {\n                        mainTabRow.open(activeStr);\n                    }\n                }\n            }\n\n        };\n\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr) => {\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\n                    return;\n                }\n\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n                if (isDrawing) {\n                    return;\n                }\n\n                if (comboStr === 'plus') {\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\n                }\n                if (comboStr === 'minus') {\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\n                }\n                if (comboStr === 'home') {\n                    this.klCanvasWorkspace.fitView(true);\n                }\n                if (comboStr === 'end') {\n                    this.klCanvasWorkspace.resetView(true);\n                }\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\n                    event.preventDefault();\n                    undoRedoCatchup.undo();\n                }\n                if (\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\n                    (\n                        (\n                            BB.sameKeys('ctrl+shift+z', comboStr) ||\n                            BB.sameKeys('cmd+shift+z', comboStr)\n                        ) && keyStr === 'z'\n                    )\n                ) {\n                    event.preventDefault();\n                    undoRedoCatchup.redo();\n                }\n                if (!this.embed) {\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\n                        event.preventDefault();\n                        this.saveToComputer.save();\n                    }\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\n                        event.preventDefault();\n\n                        (async () => {\n                            let success = true;\n                            try {\n                                await projectStore!.store(this.klCanvas.getProject());\n                            } catch (e) {\n                                success = false;\n                                setTimeout(() => {\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\n                                }, 0);\n                                this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\n                            }\n                            if (success) {\n                                pOptions.saveReminder!.reset();\n                                this.statusOverlay.out(LANG('file-storage-stored'), true);\n                            }\n                        })();\n                    }\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                        event.preventDefault();\n                        copyToClipboard(true);\n                    }\n                }\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\n                    event.preventDefault();\n                }\n\n\n                if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\n                    if (keyStr === 'left') {\n                        this.klCanvasWorkspace.translateView(1, 0);\n                    }\n                    if (keyStr === 'right') {\n                        this.klCanvasWorkspace.translateView(-1, 0);\n                    }\n                    if (keyStr === 'up') {\n                        this.klCanvasWorkspace.translateView(0, 1);\n                    }\n                    if (keyStr === 'down') {\n                        this.klCanvasWorkspace.translateView(0, -1);\n                    }\n                }\n\n\n                if (['r+left','r+right'].includes(comboStr)) {\n                    if (keyStr === 'left') {\n                        this.klCanvasWorkspace.setAngle(-15, true);\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                    if (keyStr === 'right') {\n                        this.klCanvasWorkspace.setAngle(15, true);\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                }\n                if (['r+up'].includes(comboStr)) {\n                    this.klCanvasWorkspace.setAngle(0);\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                }\n\n\n                if (comboStr === 'sqbr_open') {\n                    currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\n                }\n                if (comboStr === 'sqbr_close') {\n                    currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\n                }\n                if (comboStr === 'enter') {\n                    this.klCanvas.layerFill(\n                        throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\n                        this.klColorSlider.getColor(),\n                    );\n                    this.statusOverlay.out(LANG('filled'), true);\n                }\n                if (['delete', 'backspace'].includes(comboStr)) {\n                    const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) {\n                        this.klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\n                    } else {\n                        this.klCanvas.clearLayer(layerIndex);\n                    }\n                    this.statusOverlay.out(LANG('cleared-layer'), true);\n                }\n                if (comboStr === 'shift+e') {\n                    event.preventDefault();\n                    currentBrushUi.toggleEraser && currentBrushUi.toggleEraser();\n\n                } else if (comboStr === 'e') {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode('draw');\n                    this.toolspaceToolRow.setActive('draw');\n                    mainTabRow && mainTabRow.open('draw');\n                    updateMainTabVisibility();\n                    brushTabRow.open('eraserBrush');\n                }\n                if (comboStr === 'b') {\n                    event.preventDefault();\n                    const prevMode = this.klCanvasWorkspace.getMode();\n                    this.klCanvasWorkspace.setMode('draw');\n                    this.toolspaceToolRow.setActive('draw');\n                    mainTabRow && mainTabRow.open('draw');\n                    updateMainTabVisibility();\n                    brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\n                }\n                if (comboStr === 'g') {\n                    event.preventDefault();\n                    const newMode = this.klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\n                    this.klCanvasWorkspace.setMode(newMode);\n                    this.toolspaceToolRow.setActive(newMode);\n                    mainTabRow && mainTabRow.open(newMode);\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 't') {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode('text');\n                    this.toolspaceToolRow.setActive('text');\n                    mainTabRow && mainTabRow.open('text');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'u') {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode('shape');\n                    this.toolspaceToolRow.setActive('shape');\n                    mainTabRow && mainTabRow.open('shape');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'x') {\n                    event.preventDefault();\n                    this.klColorSlider.swapColors();\n                }\n\n\n            },\n            onUp: (keyStr, event) => {\n            },\n        });\n\n        const brushUiMap: {\n            [key: string]: any;\n        } = {};\n        // create brush UIs\n        Object.entries(KL.brushesUI).forEach(([b, brushUi]) => {\n            const ui = new (brushUi.Ui as any)({\n                onSizeChange: sizeWatcher,\n                onOpacityChange: (opacity: number) => {\n                    brushSettingService.emitOpacity(opacity);\n                },\n                onConfigChange: () => {\n                    brushSettingService.emitSliderConfig({\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\n                    });\n                },\n            });\n            brushUiMap[b] = ui;\n            ui.getElement().style.padding = 10 + 'px';\n        });\n\n        this.statusOverlay = new KL.StatusOverlay();\n\n        this.toolspace = BB.el({\n            className: 'kl-toolspace',\n            css: {\n                position: 'absolute',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                width: (this.toolWidth) + 'px',\n                overflow: 'hidden',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n        this.toolspaceInner = BB.el({\n            parent: this.toolspace,\n        });\n        this.toolspace.oncontextmenu = () => {\n            return false;\n        };\n        this.toolspace.onclick = BB.handleClick;\n\n\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\n            onChange: () => {\n                this.updateCollapse();\n            },\n        });\n\n        this.updateCollapse();\n\n\n\n\n\n        let overlayToolspace;\n        setTimeout(() => {\n            overlayToolspace = new KL.OverlayToolspace({\n                enabledTest: () => {\n                    return KL.dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\n                },\n                brushSettingService,\n            });\n            this.klRootEl.append(overlayToolspace.getElement());\n        }, 0);\n\n        BB.append(\n            this.klRootEl,\n            [\n                this.klCanvasWorkspace.getElement(),\n                this.toolspace,\n                this.toolspaceCollapser.getElement(),\n            ]\n        );\n\n        let toolspaceTopRow;\n        if (this.embed) {\n            toolspaceTopRow = new EmbedToolspaceTopRow({\n                onHelp: () => {\n                    showIframeModal(this.embed!.url + '/help.html', !!this.embed);\n                },\n                onSubmit: () => {\n                    const onFailure = () => {\n                        let closeFunc: () => void;\n                        const saveBtn = BB.el({\n                            tagName: 'button',\n                            textContent: LANG('save-reminder-save-psd'),\n                            css: {\n                                display: 'block',\n                            },\n                        });\n                        saveBtn.onclick = () => {\n                            this.saveAsPsd();\n                            closeFunc();\n                        };\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: '<b>' + LANG('upload-failed') + '</b>',\n                            div: BB.el({\n                                    content: [\n                                        BB.el({\n                                            content: LANG('backup-drawing'),\n                                            css: {\n                                                marginBottom: '10px',\n                                            },\n                                        }),\n                                        saveBtn,\n                                    ],\n                                }),\n                            ignoreBackground: true,\n                            closeFunc: (f) => {\n                                closeFunc = f;\n                            },\n                        });\n                    };\n\n                    KL.popup({\n                        target: this.klRootEl,\n                        message: LANG('submit-prompt'),\n                        buttons: [LANG('submit'), 'Cancel'],\n                        callback: async (result) => {\n                            if (result !== LANG('submit')) {\n                                return;\n                            }\n\n                            const overlay = BB.el({\n                                parent: this.klRootEl,\n                                className: 'upload-overlay',\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\n                            });\n\n                            this.embed!.onSubmit(\n                                () => {\n                                    pOptions.saveReminder!.reset();\n                                    overlay.remove();\n                                },\n                                () => {\n                                    overlay.remove();\n                                    onFailure();\n                                });\n                        },\n                    });\n                },\n                onLeftRight: () => {\n                    this.uiState = this.uiState === 'left' ? 'right' : 'left';\n                    this.updateUi();\n                },\n            });\n        } else {\n            toolspaceTopRow = new KL.ToolspaceTopRow({\n                logoImg: pOptions.logoImg!,\n                onLogo: () => {\n                    showIframeModal('./home/', !!this.embed);\n                },\n                onNew: () => {\n                    showNewImageDialog();\n                },\n                onImport: () => {\n                    fileTab!.triggerImport();\n                },\n                onSave: () => {\n                    this.saveToComputer.save();\n                },\n                onShare: () => {\n                    shareImage();\n                },\n                onHelp: () => {\n                    showIframeModal('./help/', !!this.embed);\n                },\n            });\n        }\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\n\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\n            onActivate: (activeStr) => {\n                if (activeStr === 'draw') {\n                    this.klCanvasWorkspace.setMode('draw');\n                } else if (activeStr === 'hand') {\n                    this.klCanvasWorkspace.setMode('hand');\n                } else if (activeStr === 'fill') {\n                    this.klCanvasWorkspace.setMode('fill');\n                } else if (activeStr === 'gradient') {\n                    this.klCanvasWorkspace.setMode('gradient');\n                } else if (activeStr === 'text') {\n                    this.klCanvasWorkspace.setMode('text');\n                } else if (activeStr === 'shape') {\n                    this.klCanvasWorkspace.setMode('shape');\n                } else {\n                    throw new Error('unknown activeStr');\n                }\n                mainTabRow && mainTabRow.open(activeStr);\n                updateMainTabVisibility();\n                this.klColorSlider.pickingDone();\n            },\n            onZoomIn: () => {\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\n            },\n            onZoomOut: () => {\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\n            },\n            onUndo: () => {\n                undoRedoCatchup.undo();\n            },\n            onRedo: () => {\n                undoRedoCatchup.redo();\n            },\n        });\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n        klHistory.addListener(() => {\n            this.toolspaceToolRow.setEnableUndo(klHistory.canUndo());\n            this.toolspaceToolRow.setEnableRedo(klHistory.canRedo());\n        });\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\n\n        const setBrushColor = (p_color: IRGB) => {\n            currentColor = p_color;\n            currentBrushUi.setColor(p_color);\n            brushSettingService.emitColor(p_color);\n            this.klColorSlider.pickingDone();\n        };\n\n        this.klColorSlider = new KL.KlColorSlider({\n            width: 250,\n            height: 30,\n            svHeight: 100,\n            startValue: new BB.RGB(0, 0, 0),\n            onPick: setBrushColor,\n        });\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.klColorSlider.setPickCallback((doPick) => {\n\n            if (doPick) {\n                this.klCanvasWorkspace.setMode('pick');\n            } else {\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\n                updateMainTabVisibility();\n            }\n\n        });\n\n        const setCurrentBrush = (brushId: string) => {\n            if (brushId !== 'eraserBrush') {\n                lastNonEraserBrushId = brushId;\n            }\n\n            if (this.klColorSlider) {\n                if (brushId === 'eraserBrush') {\n                    this.klColorSlider.enable(false);\n                } else {\n                    this.klColorSlider.enable(true);\n                }\n            }\n\n            currentBrushId = brushId;\n            currentBrushUi = brushUiMap[brushId];\n            currentBrushUi.setColor(currentColor);\n            currentBrushUi.setContext(currentLayerCtx);\n            this.klCanvasWorkspace.setMode('draw');\n            this.toolspaceToolRow.setActive('draw');\n            updateMainTabVisibility();\n        };\n\n        const setCurrentLayer = (layer: TKlCanvasLayer) => { //BrushContext(p_context) {\n            currentLayerCtx = layer.context;\n            currentBrushUi.setContext(layer.context);\n            this.layerPreview.setLayer(layer);\n        };\n\n        const brushDiv = BB.el();\n        const colorDiv = BB.el({\n            css: {\n                margin: '10px',\n                display: 'flex',\n                flexWrap: 'wrap',\n                justifyContent: 'space-between',\n                alignItems: 'flex-end',\n            },\n        });\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\n            smoothing: 1,\n            onSelect: (v) => {\n                lineSmoothing.setSmoothing(translateSmoothing(v));\n            },\n        });\n\n\n        brushDiv.append(colorDiv);\n        BB.append(\n            colorDiv,\n            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\n        );\n\n        const brushTabRow = new KL.TabRow({\n            initialId: 'penBrush',\n            useAccent: true,\n            tabArr: (() => {\n                const result = [];\n\n                const createTab = (keyStr: string) => {\n                    return {\n                        id: keyStr,\n                        image: KL.brushesUI[keyStr].image,\n                        title: KL.brushesUI[keyStr].tooltip,\n                        onOpen: () => {\n                            brushUiMap[keyStr].getElement().style.display = 'block';\n                            setCurrentBrush(keyStr);\n                            this.klColorSlider.pickingDone();\n                            brushSettingService.emitSliderConfig({\n                                sizeSlider: KL.brushesUI[keyStr].sizeSlider,\n                                opacitySlider: KL.brushesUI[keyStr].opacitySlider,\n                            });\n                            sizeWatcher(brushUiMap[keyStr].getSize());\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\n                        },\n                        onClose: () => {\n                            brushUiMap[keyStr].getElement().style.display = 'none';\n                        },\n                    };\n                };\n\n                const keyArr = Object.keys(brushUiMap);\n                for (let i = 0; i < keyArr.length; i++) {\n                    result.push(createTab(keyArr[i]));\n                }\n                return result;\n            })(),\n        });\n        BB.append(brushDiv, [\n            brushTabRow.getElement(),\n            ...Object.entries(KL.brushesUI).map(([b]) => brushUiMap[b].getElement()),\n        ]);\n\n        const handUi = new KL.HandUi({\n            scale: this.klCanvasWorkspace.getScale(),\n            angleDeg: 0,\n            onReset: () => {\n                this.klCanvasWorkspace.resetView(true);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n            onFit: () => {\n                this.klCanvasWorkspace.fitView(true);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n            onAngleChange: (angleDeg, isRelative) => {\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n        });\n\n        const fillUi = new KL.FillUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const gradientUi = new KL.GradientUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const textUi = new KL.TextUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const shapeUi = new KL.ShapeUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const gradientTool = new KL.GradientTool({\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                const settings = gradientUi.getSettings();\n                const gradientObj: IGradient = {\n                    type: settings.type,\n                    color1: this.klColorSlider.getColor(),\n                    isReversed: settings.isReversed,\n                    opacity: settings.opacity,\n                    doLockAlpha: settings.doLockAlpha,\n                    isEraser: settings.isEraser,\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\n                    x1,\n                    y1,\n                    x2,\n                    y2,\n                    angleRad,\n                };\n\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, null);\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\n                } else {\n                    this.klCanvas.setComposite(layerIndex, {\n                        draw: (ctx) => {\n                            KL.drawGradient(ctx, gradientObj);\n                        },\n                    });\n                }\n                this.klCanvasWorkspace.requestFrame();\n            },\n        });\n\n        const shapeTool = new KL.ShapeTool({\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\n\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n\n                const shapeObj: any = {\n                    type: shapeUi.getShape(),\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad,\n                    isOutwards: shapeUi.getIsOutwards(),\n                    opacity: shapeUi.getOpacity(),\n                    isEraser: shapeUi.getIsEraser(),\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\n                };\n                if (shapeUi.getShape() === 'line') {\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\n                } else {\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\n                    if (shapeUi.getMode() === 'stroke') {\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\n                    } else {\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\n                    }\n                }\n\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, null);\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\n                } else {\n                    this.klCanvas.setComposite(layerIndex, {\n                        draw: (ctx) => {\n                            KL.drawShape(ctx, shapeObj);\n                        },\n                    });\n                }\n                this.klCanvasWorkspace.requestFrame();\n\n            },\n        });\n\n        this.layerManager = new KL.LayerManager(\n            this.klCanvas,\n            (val) => {\n                setCurrentLayer(throwIfNull(this.klCanvas.getLayer(val)));\n                klHistory.push({\n                    tool: ['misc'],\n                    action: 'focusLayer',\n                    params: [val],\n                } as TMiscFocusLayerHistoryEntry);\n            },\n            this.klRootEl,\n            this.uiState,\n        );\n        this.layerPreview = new KL.LayerPreview({\n            klRootEl: this.klRootEl,\n            onClick: () => {\n                mainTabRow && mainTabRow.open('layers');\n            },\n            uiState: this.uiState,\n        });\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)!)!);\n\n        const filterTab = new KL.FilterTab(\n            this.klRootEl,\n            this.klColorSlider,\n            this.layerManager,\n            this.klCanvasWorkspace,\n            handUi,\n            () => currentColor,\n            () => klMaxCanvasSize,\n            () => this.klCanvas,\n            () => currentLayerCtx,\n            !!this.embed,\n            this.statusOverlay,\n        );\n\n        const undoRedoCatchup = new KL.UndoRedoCatchup(\n            brushUiMap,\n            this.layerPreview,\n            this.layerManager,\n            handUi,\n            this.klCanvasWorkspace,\n            () => {\n                if (!initState) {\n                    throw new Error('initState not initialized');\n                }\n                return initState;\n            },\n            () => this.klCanvas,\n            () => currentLayerCtx,\n            (ctx) => {\n                currentLayerCtx = ctx;\n            },\n            () => currentBrushUi,\n        );\n        klHistory.addListener((p) => {\n            undoRedoCatchup.catchup(p);\n        });\n\n        const showNewImageDialog = () => {\n            KL.newImageDialog({\n                currentColor: currentColor,\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\n                maxCanvasSize: klMaxCanvasSize,\n                canvasWidth: this.klCanvas.getWidth(),\n                canvasHeight: this.klCanvas.getHeight(),\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\n                workspaceHeight: this.uiHeight,\n                onConfirm: (width, height, color) => {\n                    this.klCanvas.reset({\n                        width: width,\n                        height: height,\n                        color: color.a === 1 ? color : undefined,\n                    });\n\n                    this.layerManager.update(0);\n                    setCurrentLayer(throwIfNull(this.klCanvas.getLayer(0)));\n                    this.klCanvasWorkspace.resetOrFitView();\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                },\n                onCancel: () => {},\n            });\n        };\n\n        const shareImage = (callback?: () => void) => {\n            BB.shareCanvas({\n                canvas: this.klCanvas.getCompleteCanvas(1),\n                fileName: BB.getDate() + klConfig.filenameBase + '.png',\n                title: BB.getDate() + klConfig.filenameBase + '.png',\n                callback: callback ? callback : () => {},\n            });\n        };\n\n        this.saveToComputer = new KL.SaveToComputer(\n            pOptions.saveReminder,\n            () => exportType,\n            () => this.klCanvas,\n        );\n\n        const copyToClipboard = (showCrop?: boolean) => {\n            KL.clipboardDialog(\n                this.klRootEl,\n                this.klCanvas.getCompleteCanvas(1),\n                (inputObj) => {\n                    if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\n                        return;\n                    }\n                    //do a crop\n                    KL.filterLib.cropExtend.apply!({\n                        context: currentLayerCtx,\n                        klCanvas: this.klCanvas,\n                        input: inputObj,\n                        history: klHistory,\n                    });\n                    this.layerManager.update();\n                    this.klCanvasWorkspace.resetOrFitView();\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                },\n                this.statusOverlay,\n                showCrop || false,\n            );\n        };\n\n        const fileTab = this.embed ? null : new KL.FileTab(\n            this.klRootEl,\n            projectStore!,\n            () => this.klCanvas.getProject(),\n            exportType,\n            (type) => {\n                exportType = type;\n            },\n            (files, optionsStr) => importHandler.handleFileSelect(files, optionsStr),\n            () => this.saveToComputer.save(),\n            showNewImageDialog,\n            shareImage,\n            () => { // on upload\n                KL.imgurUpload(\n                    this.klCanvas,\n                    this.klRootEl,\n                    pOptions.saveReminder!,\n                    pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : '',\n                );\n            },\n            copyToClipboard,\n            pOptions.saveReminder,\n        );\n\n        const settingsTab = new KL.SettingsTab(\n            () => {\n                this.uiState = this.uiState === 'left' ? 'right' : 'left';\n                this.updateUi();\n                if (!this.embed) {\n                    LocalStorage.setItem('uiState', this.uiState);\n                }\n            },\n            this.embed ? undefined : pOptions.saveReminder,\n            pOptions.aboutEl,\n        );\n\n        mainTabRow = new KL.TabRow({\n            initialId: 'draw',\n            tabArr: [\n                {\n                    id: 'draw',\n                    title: LANG('tool-brush'),\n                    image: toolPaintImg,\n                    onOpen: () => {\n                        if (currentBrushId === 'eraserBrush') {\n                            this.klColorSlider.enable(false);\n                        }\n                        BB.append(\n                            colorDiv,\n                            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\n                        );\n                        brushDiv.style.display = 'block';\n                    },\n                    onClose: () => {\n                        brushDiv.style.display = 'none';\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'hand',\n                    title: LANG('tool-hand'),\n                    image: toolHandImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        handUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        handUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'fill',\n                    title: LANG('tool-paint-bucket'),\n                    image: toolFillImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        fillUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        fillUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'gradient',\n                    title: LANG('tool-gradient'),\n                    image: toolGradientImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        gradientUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        gradientUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'text',\n                    title: LANG('tool-text'),\n                    image: toolTextImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        textUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        textUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'shape',\n                    title: LANG('tool-shape'),\n                    image: toolShapeImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        shapeUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        shapeUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'layers',\n                    title: LANG('layers'),\n                    image: tabLayersImg,\n                    onOpen: () => {\n                        this.layerManager.update();\n                        this.layerManager.getElement().style.display = 'block';\n                    },\n                    onClose: () => {\n                        this.layerManager.getElement().style.display = 'none';\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'edit',\n                    label: LANG('tab-edit'),\n                    onOpen: () => {\n                        filterTab.show();\n                    },\n                    onClose: () => {\n                        filterTab.hide();\n                    },\n                    css: {\n                        padding: '0 7px',\n                    },\n                },\n                {\n                    id: 'file',\n                    label: LANG('tab-file'),\n                    isVisible: !!fileTab,\n                    onOpen: () => {\n                        if (!fileTab) {\n                            return;\n                        }\n                        fileTab.getElement().style.display = 'block';\n                        fileTab.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        if (!fileTab) {\n                            return;\n                        }\n                        fileTab.getElement().style.display = 'none';\n                        fileTab.setIsVisible(false);\n                    },\n                    css: {\n                        padding: '0 7px',\n                    },\n                },\n                {\n                    id: 'settings',\n                    title: LANG('tab-settings'),\n                    image: tabSettingsImg,\n                    onOpen: () => {\n                        settingsTab.getElement().style.display = 'block';\n                        // settingsTab.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        settingsTab.getElement().style.display = 'none';\n                        // settingsTab.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n            ],\n        });\n\n        this.bottomBarWrapper = BB.el({\n            css: {\n                width: '270px',\n                position: 'absolute',\n                bottom: '0',\n                left: '0',\n            },\n        });\n        if (pOptions.bottomBar) {\n            this.bottomBar = pOptions.bottomBar;\n            this.bottomBarWrapper.append(this.bottomBar);\n            const observer = new MutationObserver(() => this.updateBottomBar());\n            observer.observe(\n                this.toolspaceInner,\n                {\n                    attributes: true,\n                    childList: true,\n                    subtree: true,\n                }\n            );\n        }\n\n\n\n\n        BB.append(this.toolspaceInner, [\n            this.layerPreview.getElement(),\n            mainTabRow.getElement(),\n            brushDiv,\n            handUi.getElement(),\n            fillUi.getElement(),\n            gradientUi.getElement(),\n            textUi.getElement(),\n            shapeUi.getElement(),\n            this.layerManager.getElement(),\n            filterTab.getElement(),\n            fileTab ? fileTab.getElement() : undefined,\n            settingsTab.getElement(),\n            BB.el({\n                css: {\n                    height: '10px', // a bit of spacing at the bottom\n                },\n            }),\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\n        ]);\n\n        this.toolspaceScroller = new KL.ToolspaceScroller({\n            toolspace: this.toolspace,\n            uiState: this.uiState,\n        });\n\n        if (!this.embed) {\n            Object.defineProperty(window, 'KL', {\n                value: createConsoleApi({\n                    onDraw: (path: IVector2D[]): void => {\n                        if (!path || path.length === 0) {\n                            return;\n                        }\n                        path.forEach((p, index) => {\n                            if (index === 0) {\n                                currentBrushUi.startLine(p.x, p.y, 1);\n                            } else {\n                                currentBrushUi.goLine(p.x, p.y, 1);\n                            }\n                        });\n                        currentBrushUi.endLine();\n                        this.klCanvasWorkspace.requestFrame();\n                    },\n                }),\n                writable: false,\n            });\n        }\n\n        this.resize(this.uiWidth, this.uiHeight);\n        this.updateUi();\n\n        const importHandler = new ImportHandler({\n            klRootEl: this.klRootEl,\n            klMaxCanvasSize,\n            layerManager: this.layerManager,\n            setCurrentLayer,\n            klCanvas: this.klCanvas,\n            klCanvasWorkspace: this.klCanvasWorkspace,\n            handUi,\n        }, {\n            onColor: (rgb) => brushSettingService.setColor(rgb),\n        });\n\n        if (!this.embed) {\n            new KL.KlImageDropper({\n                target: document.body,\n                onDrop: (files, optionStr) => {\n                    if (KL.dialogCounter.get() > 0) {\n                        return;\n                    }\n                    importHandler.handleFileSelect(files, optionStr);\n                },\n                enabledTest: () => {\n                    return KL.dialogCounter.get() === 0;\n                },\n            });\n\n            window.document.addEventListener(\n                'paste',\n                (e: ClipboardEvent) => importHandler.onPaste(e),\n                false\n            );\n        }\n\n        {\n            window.addEventListener('resize', () => {\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n            window.addEventListener('orientationchange', () => {\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\n            const windowResizeWatcher = BB.el({\n                parent: document.body,\n                css: {\n                    position: 'fixed',\n                    left: '0',\n                    top: '0',\n                    right: '0',\n                    bottom: '0',\n                    pointerEvents: 'none',\n                    zIndex: '-1',\n                    userSelect: 'none',\n                },\n            });\n            try {\n                // Not all browsers support ResizeObserver. Not critical though.\n                const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\n                observer.observe(windowResizeWatcher);\n            } catch (e) {\n                windowResizeWatcher.remove();\n            }\n\n            // prevent ctrl scroll -> zooming page\n            this.klRootEl.addEventListener('wheel', (event) => {\n                if (keyListener.isPressed('ctrl')) {\n                    event.preventDefault();\n                }\n            });\n            //maybe prevent zooming on safari mac os - todo still needed?\n            const prevent = (e: Event) => {\n                e.preventDefault();\n            };\n            window.addEventListener('gesturestart', prevent);\n            window.addEventListener('gesturechange', prevent);\n            window.addEventListener('gestureend', prevent);\n        }\n    }\n\n    // -------- interface --------\n\n    getEl (): HTMLElement {\n        return this.klRootEl;\n    }\n\n    resize (w: number, h: number): void {\n\n        // iPad scrolls down when increasing text zoom\n        if (window.scrollY > 0) {\n            window.scrollTo(0, 0);\n        }\n\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\n            return;\n        }\n\n        this.uiWidth = Math.max(0, w);\n        this.uiHeight = Math.max(0, h);\n\n        this.updateCollapse();\n        this.updateBottomBar();\n\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n    }\n\n    out (msg: string): void {\n        this.statusOverlay.out(msg);\n    }\n\n    getPNG (): Blob {\n        return base64ToBlob(this.klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\n    }\n\n    getPSD = async ():  Promise<Blob> => {\n        return await klCanvasToPsdBlob(this.klCanvas);\n    };\n\n    getProject (): IKlProject {\n        return this.klCanvas.getProject();\n    }\n\n    swapUiLeftRight (): void {\n        this.uiState = this.uiState === 'left' ? 'right' : 'left';\n        if (!this.embed) {\n            LocalStorage.setItem('uiState', this.uiState);\n        }\n        this.updateUi();\n    }\n\n    saveAsPsd (): void {\n        this.saveToComputer.save('psd');\n    }\n\n    isDrawing (): boolean {\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n    }\n}\n","import {BB} from '../bb/bb';\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\nimport helpImg from '/src/app/img/ui/help.svg';\nimport {LANG} from '../language/language';\nimport {PointerListener} from '../bb/input/pointer-listener';\n\n/**\n * Topmost row of buttons in toolspace. (embed)\n *\n * @param p\n * @constructor\n */\nexport class EmbedToolspaceTopRow {\n\n    private readonly rootEl: HTMLElement;\n\n    // ---- public ----\n\n    constructor (p: {onSubmit: () => void; onLeftRight: () => void; onHelp: () => void}) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '36px',\n                display: 'flex',\n            },\n        });\n\n        function createButton (p: {\n            title: string;\n            content?: HTMLElement;\n            image?: string;\n            onClick: () => void;\n            extraPadding?: number;\n            contain: boolean;\n        }): {\n            el: HTMLElement;\n            pointerListener: PointerListener;\n        } {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\n                },\n            });\n            if (p.content) {\n                el.append(p.content);\n            } else {\n                const im = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\n                        backgroundRepeat: 'no-repeat',\n                        backgroundPosition: 'center',\n                        backgroundSize: p.contain ? 'contain' : '',\n                        //filter: 'grayscale(1)',\n                        height: '100%',\n                    },\n                });\n                im.style.pointerEvents = 'none';\n                el.append(im);\n            }\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: function (isOver): void {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n\n            return {\n                el,\n                pointerListener,\n            };\n        }\n\n        const submitButton = createButton({\n            onClick: p.onSubmit,\n            title: LANG('submit-title'),\n            content: BB.el({\n                content: LANG('submit'),\n                className: 'toolspace-row-button__submit',\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '100%',\n                    height: '100%',\n                },\n            }),\n            contain: true,\n        });\n        submitButton.el.style.width = '45px';\n\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true,\n        });\n\n        const leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: LANG('switch-ui-left-right'),\n            image: uiSwapImg,\n            contain: true,\n        });\n\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import {filterLib, filterLibStatus} from './filters';\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\nimport {filterCropExtend} from './filter-crop-extend';\nimport {filterCurves} from './filter-curves';\nimport {filterFlip} from './filter-flip';\nimport {filterHueSaturation} from './filter-hue-saturation';\nimport {filterInvert} from './filter-invert';\nimport {filterPerspective} from './filter-perspective';\nimport {filterResize} from './filter-resize';\nimport {filterRotate} from './filter-rotate';\nimport {filterTiltShift} from './filter-tilt-shift';\nimport {filterTransform} from './filter-transform';\nimport {filterBlur} from './filter-blur';\nimport {filterUnsharpMask} from './filter-unsharp-mask';\nimport {filterToAlpha} from './filter-to-alpha';\nimport {filterGrid} from './filter-grid';\nimport {filterNoise} from './filter-noise';\nimport {filterPattern} from './filter-pattern';\nimport {filterDistort} from './filter-distort';\nimport {filterVanishPoint} from './filter-vanish-point';\nimport {IFilter} from '../kl-types';\n\ntype TModuleFilter = Pick<IFilter, 'getDialog' | 'apply'>;\n\nfunction importFilter (libObj: IFilter, moduleObj: TModuleFilter): void {\n    if (moduleObj.getDialog) {\n        libObj.getDialog = moduleObj.getDialog;\n    }\n    libObj.apply = moduleObj.apply;\n}\n\n\nexport function importFilters (): void {\n    if (filterLibStatus.isLoaded) {\n        return;\n    }\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast as TModuleFilter);\n    importFilter(filterLib.cropExtend, filterCropExtend as TModuleFilter);\n    importFilter(filterLib.curves, filterCurves as TModuleFilter);\n    importFilter(filterLib.flip, filterFlip as TModuleFilter);\n    importFilter(filterLib.hueSaturation, filterHueSaturation as TModuleFilter);\n    importFilter(filterLib.invert, filterInvert as TModuleFilter);\n    importFilter(filterLib.perspective, filterPerspective as TModuleFilter);\n    importFilter(filterLib.resize, filterResize as TModuleFilter);\n    importFilter(filterLib.rotate, filterRotate as TModuleFilter);\n    importFilter(filterLib.tiltShift, filterTiltShift as TModuleFilter);\n    importFilter(filterLib.transform, filterTransform as TModuleFilter);\n    importFilter(filterLib.blur, filterBlur as TModuleFilter);\n    importFilter(filterLib.unsharpMask, filterUnsharpMask as TModuleFilter);\n    importFilter(filterLib.toAlpha, filterToAlpha as TModuleFilter);\n    importFilter(filterLib.grid, filterGrid as TModuleFilter);\n    importFilter(filterLib.noise, filterNoise as TModuleFilter);\n    importFilter(filterLib.pattern, filterPattern as TModuleFilter);\n    importFilter(filterLib.distort, filterDistort as TModuleFilter);\n    importFilter(filterLib.vanishPoint, filterVanishPoint as TModuleFilter);\n\n    filterLibStatus.isLoaded = true;\n}","import {KlSlider} from '../ui/components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterBrightnessContrastInput = {\n    brightness: number;\n    contrast: number;\n}\n\nexport type TFilterBrightnessContrastHistoryEntry = TFilterHistoryEntry<\n    'brightnessContrast',\n    TFilterBrightnessContrastInput>;\n\nexport const filterBrightnessContrast = {\n    getDialog (params: IFilterGetDialogParam) {\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterBrightnessContrastInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let brightness = 0, contrast = 0;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.brightnessContrast(brightness, contrast);\n            },\n        });\n\n        function finishInit (): void {\n\n            const brightnessSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-brightness'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (brightness + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brightness = val / 50 - 1;\n                    preview.render();\n                },\n            });\n            const contrastSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-contrast'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (contrast + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    contrast = val / 50 - 1;\n                    preview.render();\n                },\n            });\n            brightnessSlider.getElement().style.marginBottom = '10px';\n            contrastSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(brightnessSlider.getElement(), contrastSlider.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n\n            result.destroy = () => {\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterBrightnessContrastInput {\n                result.destroy!();\n                return {\n                    brightness: brightness,\n                    contrast: contrast,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterBrightnessContrastInput>): boolean {\n        const context = params.context;\n        const brightness = params.input.brightness;\n        const contrast = params.input.contrast;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'brightnessContrast'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterBrightnessContrastHistoryEntry);\n\n        return true;\n    },\n};","\nexport const eventResMs = 60;","import {TFxCanvas, TWrappedTexture} from '../../../fx-canvas/fx-canvas-types';\nimport {TProjectViewportLayerFunc, TViewportTransformXY} from './project-viewport';\nimport {BB} from '../../../bb/bb';\nimport {getSharedFx} from '../../../fx-canvas/shared-fx';\nimport {throwIfNull} from '../../../bb/base/base';\nimport {IRect} from '../../../bb/bb-types';\nimport {compose, translate, applyToPoint, inverse, scale} from 'transformation-matrix';\nimport {createTransformMatrix} from './utils/create-transform-matrix';\n\ntype TPostMix = {\n    opacity: number;\n    operation: GlobalCompositeOperation;\n}\n\nexport type TFxPreviewRendererParams = {\n    original: Exclude<CanvasImageSource, VideoFrame | HTMLOrSVGImageElement> | HTMLImageElement;\n    onUpdate: (fxCanvas: TFxCanvas, transform: TViewportTransformXY) => TFxCanvas;\n    postMix?: TPostMix; // mix the result with the original\n};\n\nexport class FxPreviewRenderer {\n    private readonly original: TFxPreviewRendererParams['original'];\n    private readonly onUpdate: TFxPreviewRendererParams['onUpdate'];\n    private texture: TWrappedTexture | undefined = undefined;\n    private readonly textureSource: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private oldOnUpdateProps = {\n        textureWidth: 0,\n        textureHeight: 0,\n        transform: {\n            scaleX: 0,\n            scaleY: 0,\n            angleDeg: 0,\n            x: 0,\n            y: 0,\n        },\n    };\n    private fxCanvas: TFxCanvas;\n    private postMix: TPostMix | undefined;\n\n\n    // --- public ---\n    constructor (p: TFxPreviewRendererParams) {\n        this.original = p.original;\n        this.onUpdate = p.onUpdate;\n        this.textureSource = BB.canvas(1,1);\n        this.ctx = BB.ctx(this.textureSource);\n        this.fxCanvas = throwIfNull(getSharedFx());\n        this.postMix = p.postMix;\n    }\n\n    render: TProjectViewportLayerFunc = (viewportTransform, viewportWidth, viewportHeight) => {\n        const viewportMat = createTransformMatrix(viewportTransform);\n        const padding = 0; // render more than visible with padding < 0\n\n        let clippedViewportRect: IRect; // rect in viewport coordinates which contains the canvas\n        {\n            const topLeft = applyToPoint(viewportMat, {x: 0, y: 0});\n            const bottomRight = applyToPoint(viewportMat, {x: this.original.width, y: this.original.height});\n            bottomRight.x = Math.round(bottomRight.x);\n            bottomRight.y = Math.round(bottomRight.y);\n            const clippedTL = {\n                x: Math.max(padding, topLeft.x),\n                y: Math.max(padding, topLeft.y),\n            };\n            const clippedBR = {\n                x: Math.min(viewportWidth - padding, (bottomRight.x)),\n                y: Math.min(viewportHeight - padding, (bottomRight.y)),\n            };\n            clippedViewportRect = {\n                x: clippedTL.x,\n                y: clippedTL.y,\n                width: clippedBR.x - clippedTL.x,\n                height: clippedBR.y - clippedTL.y,\n            };\n\n            if (clippedViewportRect.width <= 0 || clippedViewportRect.height <= 0) {\n                this.textureSource.width = 1;\n                this.textureSource.height = 1;\n                return this.textureSource;\n            }\n        }\n\n        let resultTransform = compose(\n            inverse(viewportMat),\n            translate(padding, padding),\n            translate(clippedViewportRect.x - padding, clippedViewportRect.y - padding),\n        );\n\n        const onUpdateProps = {\n            textureWidth: Math.ceil(clippedViewportRect.width),\n            textureHeight: Math.ceil(clippedViewportRect.height),\n            transform: {\n                scaleX: viewportTransform.scaleX,\n                scaleY: viewportTransform.scaleY,\n                angleDeg: viewportTransform.angleDeg,\n                x: viewportTransform.x - clippedViewportRect.x,\n                y: viewportTransform.y - clippedViewportRect.y,\n            },\n        };\n\n        let tlOffsetX = 0;\n        let tlOffsetY = 0;\n\n\n        if (viewportTransform.scaleX > 1) {\n            // what pixels of original canvas are actually visible\n            const canvasTopLeft = applyToPoint(resultTransform, {x: 0, y: 0});\n            tlOffsetX = -canvasTopLeft.x;\n            tlOffsetY = -canvasTopLeft.y;\n            canvasTopLeft.x = Math.max(0, Math.floor(canvasTopLeft.x));\n            canvasTopLeft.y = Math.max(0, Math.floor(canvasTopLeft.y));\n            tlOffsetX += canvasTopLeft.x;\n            tlOffsetY += canvasTopLeft.y;\n\n            const canvasBottomRight = applyToPoint(resultTransform, {x: clippedViewportRect.width, y: clippedViewportRect.height});\n            canvasBottomRight.x = Math.min(this.original.width, Math.ceil(canvasBottomRight.x));\n            canvasBottomRight.y = Math.min(this.original.height, Math.ceil(canvasBottomRight.y));\n\n\n            const cw = canvasBottomRight.x - canvasTopLeft.x;\n            const ch = canvasBottomRight.y - canvasTopLeft.y;\n\n            onUpdateProps.textureWidth = cw;\n            onUpdateProps.textureHeight = ch;\n            onUpdateProps.transform = {\n                scaleX: 1,\n                scaleY: 1,\n                angleDeg: 0,\n                x: -canvasTopLeft.x,\n                y: -canvasTopLeft.y,\n            };\n\n            resultTransform = compose(\n                resultTransform,\n                scale(viewportTransform.scaleX, viewportTransform.scaleY),\n                translate(tlOffsetX, tlOffsetY),\n            );\n        }\n\n\n        if (!this.texture || JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps) || this.postMix) {\n            // update texture\n            this.textureSource.width = onUpdateProps.textureWidth;\n            this.textureSource.height = onUpdateProps.textureHeight;\n\n            // draw original canvas into temp\n            this.ctx.save();\n            this.ctx.imageSmoothingEnabled = false;\n            if (viewportTransform.scaleX > 1) {\n                this.ctx.setTransform(createTransformMatrix(onUpdateProps.transform));\n            } else {\n                this.ctx.setTransform(inverse(resultTransform));\n            }\n            this.ctx.drawImage(this.original, 0, 0);\n            this.ctx.restore();\n            // debug\n            /*BB.css(this.canvas, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                zIndex: '1000',\n                boxShadow: '0 0 0 1px #f00',\n            });\n            document.body.append(this.canvas);*/\n\n            if (!this.texture || JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps)) {\n                this.texture && this.texture.destroy();\n                this.texture = this.fxCanvas.texture(this.textureSource);\n            }\n\n            if (!this.postMix) {\n                this.textureSource.width = 1;\n                this.textureSource.height = 1;\n            }\n        }\n        this.oldOnUpdateProps = onUpdateProps;\n\n        const resultFx = this.onUpdate(\n            this.fxCanvas.draw(this.texture),\n            onUpdateProps.transform\n        ).update();\n\n        if (this.postMix) {\n            this.ctx.save();\n            this.ctx.globalAlpha = this.postMix.opacity;\n            this.ctx.globalCompositeOperation = this.postMix.operation;\n            this.ctx.drawImage(resultFx, 0, 0);\n            this.ctx.restore();\n            return {\n                image: this.textureSource,\n                transform: resultTransform,\n            };\n        }\n\n        return {\n            image: resultFx,\n            transform: resultTransform,\n        };\n    };\n\n    setPostMix (postMix: TPostMix): void {\n        this.postMix = postMix;\n    }\n\n    destroy (): void {\n        BB.freeCanvas(this.textureSource);\n        if (this.texture) {\n            this.texture = this.fxCanvas.texture(this.textureSource);\n            this.fxCanvas.draw(this.texture).update();\n            this.texture && this.texture.destroy();\n        }\n    }\n}\n\n\n","import {BB} from '../../bb/bb';\nimport {input} from '../ui/components/input';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {Cropper} from '../ui/components/cropper';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGBA} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {theme} from '../../theme/theme';\nimport {IRect} from '../../bb/bb-types';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterCropExtendInput = {\n    left: number;\n    right: number;\n    top: number;\n    bottom: number;\n    fillColor?: IRGBA;\n};\n\nexport type TFilterCropExtendHistoryEntry = TFilterHistoryEntry<\n    'cropExtend',\n    TFilterCropExtendInput>;\n\nexport const filterCropExtend = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n        const tempCanvas = BB.canvas();\n        {\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\n            const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n            const previewFactor = w / klCanvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = 'block';\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterCropExtendInput> = {\n            element: rootEl,\n        };\n        let left = 0, right = 0, top = 0, bottom = 0;\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        let scale: number = 1;\n\n\n\n        // --- input elements ---\n\n        const lrWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'},\n        });\n        const tbWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'},\n        });\n        rootEl.append(lrWrapper, tbWrapper);\n\n        const leftInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function () {\n                leftChanged = true;\n                updateInput();\n            },\n        });\n        const rightInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px'},\n            callback: function () {\n                rightChanged = true;\n                updateInput();\n            },\n        });\n        const topInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function () {\n                topChanged = true;\n                updateInput();\n            },\n        });\n        const bottomInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px'},\n            callback: function () {\n                bottomChanged = true;\n                updateInput();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            width: '60px',\n        };\n        lrWrapper.append(\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\n            leftInput,\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\n            rightInput\n        );\n        tbWrapper.append(\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\n            topInput,\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\n            bottomInput\n        );\n\n        function updateInput (): void {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = klCanvas.getWidth() + left + right;\n            let newHeight = klCanvas.getHeight() + top + bottom;\n\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + 1;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + 1;\n                    rightInput.value = '' + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + maxWidth;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + maxWidth;\n                    rightInput.value = '' + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + 1;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + 1;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight,\n            });\n\n\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n\n        let useRuleOfThirds = true;\n        const ruleOThirdsCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-crop-rule-thirds'),\n            allowTab: true,\n            callback: function (b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            },\n        });\n        rootEl.append(BB.el({\n            css: {\n                clear: 'both',\n            },\n        }));\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 0},\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-crop-fill'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                updateBg();\n            },\n        });\n\n\n        const flexRow = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n        rootEl.append(flexRow);\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\n\n\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update (transform: IRect): void {\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n\n            const offset = BB.centerWithin(smallPreview.width, previewHeight, fit.width, fit.height);\n\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\n\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + 'px';\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + 'px';\n\n            left = parseInt('' + -transform.x);\n            top = parseInt('' + -transform.y);\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\n            leftInput.value = '' + left;\n            topInput.value = '' + top;\n            rightInput.value = '' + right;\n            bottomInput.value = '' + bottom;\n\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                previewWrapper.style.background = 'url(' + url + ')';\n                if (selectedRgbaObj.a !== 0) {\n                    tempCanvas.style.background = 'url(' + url + ')';\n                }\n            }, theme.isDark());\n            previewWrapper.style.backgroundPosition = (offset.x) + 'px ' + (offset.y) + 'px';\n\n            cropper.setScale(scale);\n        }\n\n        const previewHeight = smallPreview.height - 2; // two less because of border\n        const previewWrapper = BB.el({\n            className: 'kl-edit-crop-preview',\n            css: {\n                width: smallPreview.width + 'px',\n                marginTop: '10px',\n                marginLeft: '-20px',\n                height: previewHeight + 'px',\n                backgroundColor: '#9e9e9e',\n                position: 'relative',\n                borderTop: '1px solid rgb(144,144,144)',\n                borderBottom: '1px solid rgb(144,144,144)',\n                overflow: 'hidden',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        const bgColorOverlay = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n            },\n        });\n        previewWrapper.append(bgColorOverlay);\n\n        const offsetWrapper = BB.el({\n            parent: previewWrapper,\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n            },\n        });\n\n        BB.el({\n            parent: offsetWrapper,\n            content: tempCanvas,\n            css: {\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\n                position: 'absolute',\n                left: '0px',\n                top: '0px',\n            },\n        });\n\n\n        rootEl.append(previewWrapper);\n        const cropper = new Cropper({\n            x: 0,\n            y: 0,\n            width: klCanvas.getWidth(),\n            height: klCanvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight,\n        });\n        update(cropper.getTransform());\n        offsetWrapper.append(cropper.getElement());\n\n        function updateBg (): void {\n            if (selectedRgbaObj.a === 0) {\n                bgColorOverlay.style.background = '';\n                tempCanvas.style.background = '';\n            } else {\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                    tempCanvas.style.background = 'url(' + url + ')';\n                }, theme.isDark());\n            }\n        }\n\n        function updateIsDark (): void {\n            updateInput();\n        }\n        theme.addIsDarkListener(updateIsDark);\n\n        result.destroy = (): void => {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n            theme.removeIsDarkListener(updateIsDark);\n            colorOptions.destroy();\n        };\n        result.getInput = function (): TFilterCropExtendInput {\n            result.destroy!();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterCropExtendInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (\n            !klCanvas ||\n            !history ||\n            isNaN(params.input.left) ||\n            isNaN(params.input.right) ||\n            isNaN(params.input.top) ||\n            isNaN(params.input.bottom)\n        ) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'cropExtend'],\n            action: 'apply',\n            params: [{\n                input: BB.copyObj(params.input),\n            }],\n        } as TFilterCropExtendHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {CurvesInput, getDefaultCurvesInput, TCurvesInput} from './filter-curves/curves-input';\nimport {Options} from '../ui/components/options';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterCurvesInput = {\n    curves: TCurvesInput;\n};\n\nexport type TFilterCurvesHistoryEntry = TFilterHistoryEntry<\n    'curves',\n    TFilterCurvesInput>;\n\nexport const filterCurves = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterCurvesInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let curves: TCurvesInput = getDefaultCurvesInput();\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.curves(curves.r, curves.g, curves.b);\n            },\n        });\n\n\n        function finishInit (): void {\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n\n            const input = new CurvesInput({\n                curves,\n                callback: function (val) {\n                    curves = val;\n                    preview.render();\n                },\n            });\n            const modeButtons: Options<string> = input.getModeButtons();\n\n\n            rootEl.append(input.getElement(),preview.getElement());\n\n            result.destroy = (): void => {\n                input.destroy();\n                modeButtons.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterCurvesInput {\n                result.destroy!();\n                return {\n                    curves: curves,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterCurvesInput>): boolean {\n        const context = params.context;\n        const curves = params.input.curves;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'curves'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterCurvesHistoryEntry);\n\n        return true;\n    },\n\n\n};","import {Options} from '../../ui/components/options';\nimport {LANG} from '../../../language/language';\nimport {BB} from '../../../bb/bb';\nimport {IVector2D} from '../../../bb/bb-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\ntype TCurvePoint = {\n    el: HTMLElement;\n    pointerListener: PointerListener;\n    setPos: (newX: number, newY: number) => void;\n};\n\nexport type TCurvesInput = {\n    r: [number, number][];\n    g: [number, number][];\n    b: [number, number][];\n}\n\nexport function getDefaultCurvesInput (): TCurvesInput {\n    return BB.copyObj({\n        r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n        g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n        b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n    });\n}\n\nexport class CurvesInput {\n\n    private readonly rootEl: HTMLElement;\n    private readonly p0: TCurvePoint;\n    private readonly p1: TCurvePoint;\n    private readonly p2: TCurvePoint;\n    private readonly p3: TCurvePoint;\n    private readonly modeButtons: Options<string>;\n\n    // ---- public ----\n    constructor (\n        p: {\n            curves: TCurvesInput;\n            callback: (val: TCurvesInput) => void;\n        },\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n                marginBottom: '10px',\n            },\n        });\n        this.rootEl.oncontextmenu = () => false;\n        let mode = 'All';\n        let curves = p.curves;\n        this.modeButtons = new Options( {\n            optionArr: [\n                {\n                    id: 'All',\n                    label: LANG('filter-curves-all'),\n                },\n                {\n                    id: 'Red',\n                    label: LANG('red'),\n                },\n                {\n                    id: 'Green',\n                    label: LANG('green'),\n                },\n                {\n                    id: 'Blue',\n                    label: LANG('blue'),\n                },\n            ],\n            initId: 'All',\n            onChange: (id) => {\n                mode = id;\n                if (mode === 'All') {\n                    curves = getDefaultCurvesInput();\n                }\n                let curve = curves.r;\n                if (mode === 'Green') {\n                    curve = curves.g;\n                }\n                if (mode === 'Blue') {\n                    curve = curves.b;\n                }\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\n\n                update();\n            },\n        });\n        this.rootEl.append(this.modeButtons.getElement());\n\n        const curveArea = BB.el({\n            parent: this.rootEl,\n            className: 'kl-curves-graph',\n            css: {\n                position: 'relative',\n                marginTop: '10px',\n            },\n        });\n\n        const areaW = 300, areaH = 100;\n        const canvas = BB.canvas(areaW, areaH);\n        let ctx = BB.ctx(canvas);\n        curveArea.append(canvas);\n\n        const fit = (v: number): number => {\n            return Math.max(0, Math.min(1, v));\n        };\n\n        const createPoint = (\n            x: number,\n            y: number,\n            callback: (p: IVector2D) => void,\n            lock?: boolean,\n        ): TCurvePoint => {\n            const gripSize = 14;\n            let internalY = y, internalX = x;\n            const pointEl = BB.el({\n                className: 'kl-curves-graph__grip',\n                css: {\n                    left: (x - gripSize / 2) + 'px',\n                    top: (y - gripSize / 2) + 'px',\n                    width: gripSize + 'px',\n                    height: gripSize + 'px',\n                    borderRadius: gripSize + 'px',\n                },\n            });\n\n            const update = () => {\n                BB.css(pointEl, {\n                    left: (x - gripSize / 2) + 'px',\n                    top: (y - gripSize / 2) + 'px',\n                });\n            };\n\n            const pointerListener = new BB.PointerListener({\n                target: pointEl,\n                onPointer: (event) => {\n                    event.eventPreventDefault();\n                    if (event.type === 'pointerdown') {\n                        internalX = x;\n                        internalY = y;\n                    }\n                    if (event.button === 'left' && event.type === 'pointermove') {\n                        if (!lock) {\n                            internalX += event.dX;\n                        }\n                        x = Math.max(0, Math.min(areaW, internalX));\n                        internalY += event.dY;\n                        y = Math.max(0, Math.min(areaH, internalY));\n                        update();\n                        callback({\n                            x: x,\n                            y: y,\n                        });\n                    }\n                },\n            });\n\n            curveArea.append(pointEl);\n\n            const setPos = (newX: number, newY: number): void => {\n                x = newX;\n                y = newY;\n                internalY = y;\n                internalX = x;\n                BB.css(pointEl, {\n                    left: (x - gripSize / 2) + 'px',\n                    top: (y - gripSize / 2) + 'px',\n                });\n            };\n\n            return {\n                el: pointEl,\n                setPos,\n                pointerListener,\n            };\n        };\n\n        const updateControl = (i: number, x: number, y: number) => {\n            if (mode === 'All') {\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Red') {\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Green') {\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Blue') {\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n        };\n\n        this.p0 = createPoint(0, areaH, (val: IVector2D) => {\n            updateControl(0, val.x, val.y);\n            update();\n        }, true);\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val: IVector2D) => {\n            updateControl(1, val.x, val.y);\n            update();\n        });\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val: IVector2D) => {\n            updateControl(2, val.x, val.y);\n            update();\n        });\n        this.p3 = createPoint(areaW, 0, (val: IVector2D) => {\n            updateControl(3, val.x, val.y);\n            update();\n        }, true);\n\n\n        const update = () => {\n            ctx = BB.ctx(canvas);\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            const outCurves: TCurvesInput = {\n                r: [],\n                g: [],\n                b: [],\n            };\n            for (let i = 0; i < curves.r.length; i++) {\n                outCurves.r.push(curves.r[i]);\n                outCurves.g.push(curves.g[i]);\n                outCurves.b.push(curves.b[i]);\n            }\n\n            const drawCurve = (curve: [number, number][]) => {\n                ctx.beginPath();\n                const spline = new BB.SplineInterpolator(curve);\n                for (let i = 0; i < 100; i++) {\n                    let y = spline.interpolate(i / 100);\n                    y = Math.max(0, Math.min(1, y));\n\n                    if (i === 0) {\n                        ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\n                    } else {\n                        ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\n                    }\n                }\n                ctx.stroke();\n            };\n\n            ctx.save();\n            if (mode === 'All') {\n                ctx.strokeStyle = 'black';\n                drawCurve(outCurves.r);\n            } else {\n                ctx.globalAlpha = 0.5;\n                ctx.strokeStyle = 'red';\n                drawCurve(outCurves.r);\n                ctx.strokeStyle = 'green';\n                drawCurve(outCurves.g);\n                ctx.strokeStyle = 'blue';\n                drawCurve(outCurves.b);\n            }\n            ctx.restore();\n            p.callback(outCurves);\n        };\n\n        update();\n    }\n\n    // ---- interface ----\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.p0.pointerListener.destroy();\n        this.p1.pointerListener.destroy();\n        this.p2.pointerListener.destroy();\n        this.p3.pointerListener.destroy();\n    }\n\n    getModeButtons (): Options<string> {\n        return this.modeButtons;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IKlBasicLayer, TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {throwIfNull} from '../../bb/base/base';\nimport {TFilterHistoryEntry} from './filters';\nimport {Options} from '../ui/components/options';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterFlipInput = {\n    horizontal: boolean;\n    vertical: boolean;\n    flipCanvas: boolean;\n};\n\nexport type TFilterFlipHistoryEntry = TFilterHistoryEntry<\n    'flip',\n    TFilterFlipInput>;\n\nexport const filterFlip = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterFlipInput> = {\n            element: rootEl,\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n\n\n        const horizontalCheckbox = new Checkbox({\n            init: isHorizontal,\n            label: LANG('filter-flip-horizontal') + ' ',\n            allowTab: true,\n            callback: function (v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n        const verticalCheckbox = new Checkbox({\n            init: isVertical,\n            label: LANG('filter-flip-vertical') + ' ',\n            allowTab: true,\n            callback: function (v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n        rootEl.append(horizontalCheckbox.getElement());\n        rootEl.append(verticalCheckbox.getElement());\n\n        const targetOptions = new Options<boolean>({\n            optionArr: [\n                {\n                    id: true,\n                    label: LANG('filter-flip-image'),\n                },\n                {\n                    id: false,\n                    label: LANG('filter-flip-layer'),\n                },\n            ],\n            onChange: (val) => {\n                doFlipCanvas = val;\n                updatePreview();\n            },\n        });\n\n        rootEl.append(targetOptions.getElement());\n\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: smallPreview.width + 'px',\n                height: smallPreview.height + 'px',\n            },\n        });\n\n        const previewLayer: IKlBasicLayer = {\n            image: BB.canvas(Math.round(w), Math.round(h)),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: 'source-over' as TMixMode,\n        };\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [previewLayer],\n        });\n\n        const previewInnerWrapper = BB.el({\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n            },\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n\n        function updatePreview (): void {\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n\n            for (let i = 0; i < layers.length; i++) {\n                if (!layers[i].isVisible) {\n                    continue;\n                }\n\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        rootEl.append(previewWrapper);\n        result.destroy = (): void => {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n            targetOptions.destroy();\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function (): TFilterFlipInput {\n            result.destroy!();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas,\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterFlipInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        const horizontal = params.input.horizontal;\n        const vertical = params.input.vertical;\n        const flipCanvas = params.input.flipCanvas;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        klCanvas.flip(\n            horizontal,\n            vertical,\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\n        );\n        history.pause(false);\n\n        history.push({\n            tool: ['filter', 'flip'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterFlipHistoryEntry);\n        return true;\n    },\n\n};","import {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterHueSaturationInput = {\n    hue: number;\n    saturation: number;\n};\n\nexport type TFilterHueSaturationHistoryEntry = TFilterHistoryEntry<\n    'hueSaturation',\n    TFilterHueSaturationInput>;\n\nexport const filterHueSaturation = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterHueSaturationInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let hue = 0, saturation = 0;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.hueSaturation(hue, saturation);\n            },\n        });\n\n        function finishInit (): void {\n\n            const hueSlider = new KlSlider({\n                label: LANG('filter-hue-sat-hue'),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                value: hue * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    hue = val / 100;\n                    preview.render();\n                },\n            });\n            const saturationSlider = new KlSlider({\n                label: LANG('filter-hue-sat-saturation'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (saturation + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    saturation = val / 50 - 1;\n                    preview.render();\n                },\n            });\n            hueSlider.getElement().style.marginBottom = '10px';\n            saturationSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(hueSlider.getElement(), saturationSlider.getElement());\n\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterHueSaturationInput {\n                result.destroy!();\n                return {\n                    hue: hue,\n                    saturation: saturation,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterHueSaturationInput>): boolean {\n        const context = params.context;\n        const hue = params.input.hue;\n        const history = params.history;\n        const saturation = params.input.saturation;\n        if (!context || hue === null || saturation === null || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'hueSaturation'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterHueSaturationHistoryEntry);\n        return true;\n    },\n\n};","import {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply} from '../kl-types';\nimport {TFilterHistoryEntry} from './filters';\n\nexport type TFilterInvertInput = null;\n\nexport type TFilterInvertHistoryEntry = TFilterHistoryEntry<\n    'invert',\n    TFilterInvertInput>;\n\nexport const filterInvert = {\n\n    apply (params: IFilterApply<TFilterInvertInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false;\n        }\n\n        history.pause(true);\n\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'invert'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterInvertHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TwoTabs} from '../ui/components/two-tabs';\nimport {TRectanglePoints} from '../../fx-canvas/filters/perspective';\nimport {TFilterHistoryEntry} from './filters';\nimport {applyToPoint, Matrix} from 'transformation-matrix';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {throwIfNull, throwIfUndefined} from '../../bb/base/base';\nimport {DraggableInput} from '../ui/components/draggable-input';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\nexport type TFilterPerspectiveInput = {\n    before: TRectanglePoints;\n    after: TRectanglePoints;\n};\n\nexport type TFilterPerspectiveHistoryEntry = TFilterHistoryEntry<\n    'perspective',\n    TFilterPerspectiveInput>;\n\nexport const filterPerspective = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const isSmall = testIsSmall();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterPerspectiveInput> = {\n            element: rootEl,\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n\n        function finishInit (): void {\n\n            const fxCanvas = throwIfNull(getSharedFx());\n            const texture = throwIfUndefined(fxCanvas?.texture(context.canvas));\n\n            function update (): void {\n                if (isBefore) {\n                    fxCanvas.draw(texture).update();\n                } else {\n                    fxCanvas.draw(texture).perspective(\n                        getFlatArr(beforeInputs) as TRectanglePoints,\n                        getFlatArr(afterInputs) as TRectanglePoints,\n                    ).update();\n                }\n                preview.render();\n            }\n\n            const rectPoints = [\n                {x: 0, y: 0},\n                {x: context.canvas.width, y: 0},\n                {x: context.canvas.width, y: context.canvas.height},\n                {x: 0, y: context.canvas.height},\n            ];\n            const beforeInputs = rectPoints.map(point => {\n                return new DraggableInput({\n                    value: point,\n                    onChange: () => {\n                        update();\n                    },\n                });\n            });\n            beforeInputs.forEach(item => item.getElement().style.display = 'none');\n            const afterInputs = rectPoints.map(point => {\n                return new DraggableInput({\n                    value: point,\n                    onChange: () => {\n                        update();\n                    },\n                });\n            });\n            function getFlatArr (inputs: DraggableInput[], matrix?: Matrix): number[] {\n                return inputs.flatMap(item => {\n                    let value = item.getValue();\n                    if (matrix) {\n                        value = applyToPoint(matrix, value);\n                    }\n                    return [value.x, value.y];\n                });\n            }\n\n            let isBefore = false;\n\n            const beforeAfterTabs = new TwoTabs({\n                left: LANG('compare-before'),\n                right: LANG('compare-after'),\n                init: 1,\n                onChange: (val: number) => {\n                    isBefore = val === 0;\n                    if (isBefore) {\n                        beforeInputs.forEach(item => item.getElement().style.display = 'block');\n                        afterInputs.forEach(item => item.getElement().style.display = 'none');\n                    } else {\n                        beforeInputs.forEach((item, index) => {\n                            afterInputs[index].setValue(item.getValue());\n                        });\n                        beforeInputs.forEach(item => item.getElement().style.display = 'none');\n                        afterInputs.forEach(item => item.getElement().style.display = 'block');\n                    }\n                    update();\n                },\n            });\n            rootEl.append(beforeAfterTabs.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n                onTransformChange: (transform) => {\n                    beforeInputs.forEach(item => item.setTransform(transform));\n                    afterInputs.forEach(item => item.setTransform(transform));\n                },\n            });\n            BB.css(preview.getElement(), {\n                overflow: 'hidden',\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            });\n\n            preview.getElement().append(\n                ...beforeInputs.map(item => item.getElement()),\n                ...afterInputs.map(item => item.getElement()),\n            );\n            rootEl.append(preview.getElement());\n\n\n            update();\n            result.destroy = (): void => {\n                preview.destroy();\n                texture.destroy;\n                beforeInputs.forEach(item => item.destroy());\n                afterInputs.forEach(item => item.destroy());\n            };\n            result.getInput = (): TFilterPerspectiveInput => {\n                result.destroy!();\n                return {\n                    before: getFlatArr(beforeInputs) as TRectanglePoints,\n                    after: getFlatArr(afterInputs) as TRectanglePoints,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterPerspectiveInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const before = params.input.before;\n        const after = params.input.after;\n        if (!context || !before || !after || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'perspective'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterPerspectiveHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../../bb/bb';\n\n/**\n * Two buttons next to each other, each representing a tab. one at a time can be active.\n */\nexport class TwoTabs {\n\n    private readonly rootEl: HTMLElement;\n    private readonly leftTab: HTMLElement;\n    private readonly rightTab: HTMLElement;\n    private value: number;\n\n    private update (): void {\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\n    }\n\n    // ---- public ----\n    constructor (params: {\n        left: string;\n        right: string;\n        init: number; //0, 1\n        onChange: (val: number) => void;\n    }) {\n        this.value = params.init;\n\n        this.rootEl = BB.el({\n            className: 'kl-2-tabs',\n        });\n\n        this.leftTab = BB.el({\n            parent: this.rootEl,\n            content: params.left,\n            className: 'kl-2-tabs__left',\n        });\n        this.leftTab.onpointerdown = () => false;\n\n        this.rightTab = BB.el({\n            parent: this.rootEl,\n            content: params.right,\n            className: 'kl-2-tabs__right',\n        });\n        this.rightTab.onpointerdown = () => false;\n\n        this.update();\n\n        this.leftTab.onclick = () => {\n            if (this.value === 0) {\n                return;\n            }\n            this.value = 0;\n            this.update();\n            params.onChange(this.value);\n        };\n\n        this.rightTab.onclick = () => {\n            if (this.value === 1) {\n                return;\n            }\n            this.value = 1;\n            this.update();\n            params.onChange(this.value);\n        };\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}","import {TViewportTransform} from '../project-viewport/project-viewport';\nimport {BB} from '../../../bb/bb';\nimport {IVector2D} from '../../../bb/bb-types';\nimport {applyToPoint} from 'transformation-matrix';\nimport {createTransformMatrix} from '../project-viewport/utils/create-transform-matrix';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\nexport type TDraggableInputParams = {\n    value: IVector2D;\n    onChange: (value: IVector2D) => void;\n};\n\nconst SIZE = 16;\n\nexport class DraggableInput {\n    private readonly rootEl: HTMLElement;\n    private transform: TViewportTransform;\n    private value: IVector2D;\n    private readonly pointerListener: PointerListener;\n\n    private update (): void {\n        const p = applyToPoint(\n            createTransformMatrix(this.transform),\n            this.value,\n        );\n        BB.css(this.rootEl, {\n            left: (p.x - SIZE / 2) + 'px',\n            top: (p.y - SIZE / 2) + 'px',\n        });\n    }\n\n    // ------ public ------\n    constructor (p: TDraggableInputParams) {\n        this.value = {...p.value};\n        this.transform = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angleDeg: 0,\n        };\n\n        this.rootEl = BB.el({\n            css: {\n                width: SIZE + 'px',\n                height: SIZE + 'px',\n                backgroundColor: '#fff',\n                border: '2px solid #000',\n                borderRadius: SIZE + 'px',\n                position: 'absolute',\n                cursor: 'move',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n\n        this.pointerListener = new BB.PointerListener({\n            target: this.rootEl,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.button === 'left' && event.type === 'pointermove') {\n                    this.value.x += event.dX / this.transform.scale;\n                    this.value.y += event.dY / this.transform.scale;\n                    this.update();\n                    p.onChange(this.value);\n                }\n            },\n        });\n    }\n\n    setTransform (transform: TViewportTransform): void {\n        if (JSON.stringify(this.transform) === JSON.stringify(transform)) {\n            return;\n        }\n        this.transform = transform;\n        this.update();\n    }\n\n    getValue (): IVector2D {\n        return this.value;\n    }\n\n    setValue (p: IVector2D): void {\n        this.value = {...p};\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.rootEl.remove();\n        this.pointerListener.destroy();\n    }\n}","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {Select} from '../ui/components/select';\nimport constrainImg from '/src/app/img/ui/constrain.svg';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {table} from '../ui/components/table';\nimport {theme} from '../../theme/theme';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterResizeInput = {\n    width: number;\n    height: number;\n    algorithm: 'smooth' | 'pixelated';\n};\n\nexport type TFilterResizeHistoryEntry = TFilterHistoryEntry<\n    'resize',\n    TFilterResizeInput>;\n\nexport const filterResize = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        //BB.centerWithin\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n\n        const fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\n\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterResizeInput> = {\n            element: rootEl,\n        };\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\n\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n\n        const widthWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            },\n        });\n        const heightWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            },\n        });\n        const widthInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxWidth,\n                value: '' + klCanvas.getWidth(),\n            },\n        });\n        const heightInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxHeight,\n                value: '' + klCanvas.getHeight(),\n            },\n        });\n        widthInput.onclick = function () {\n            (this as any).focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function () {\n            (this as any).focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function () {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function () {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append(LANG('width') + ': ', widthInput);\n        heightWrapper.append(LANG('height') + ': ', heightInput);\n        const inputWrapper = BB.el({\n            css: {\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\n                backgroundSize: '50px 52px',\n            },\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        const constrainIm = new Image();\n        constrainIm.src = constrainImg;\n        constrainIm.height = 40;\n\n        const sizeTable = table([\n            [\n                LANG('width') + ':&nbsp;',\n                widthInput,\n                constrainIm,\n            ],\n            [\n                BB.el({css: {height: '5px'}}),\n                '',\n                '',\n            ],\n            [\n                LANG('height') + ':&nbsp;',\n                heightInput,\n            ],\n        ], {\n            '0.2': {rowspan: 3},\n        });\n        BB.css(sizeTable, {\n            marginBottom: '10px',\n        });\n\n        rootEl.append(sizeTable);\n\n        //contrain checkbox\n        let heightChanged = false, widthChanged = false;\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\n\n        function updateConstrain (): void {\n            constrainIm.style.display = isConstrained ? '' : 'none';\n            if (isConstrained) {\n                widthInput.value = '' + klCanvas.getWidth();\n                heightInput.value = '' + klCanvas.getHeight();\n                update();\n            }\n        }\n\n        let isConstrained = true;\n        const constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function (b) {\n                isConstrained = b;\n                updateConstrain();\n            },\n        });\n        rootEl.append(BB.el({\n            css: {\n                clear: 'both',\n            },\n        }));\n\n\n        const algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')],\n            ],\n            title: LANG('scaling-algorithm'),\n            initValue: 'smooth',\n            onChange: (): void => {\n                update();\n            },\n        });\n\n        const secondRowElement = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                'alignItems': 'center',\n            },\n        });\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\n\n        const previewCanvas = BB.canvas(w, h);\n        previewCanvas.style.imageRendering = 'pixelated';\n\n\n        const previewCtx = BB.ctx(previewCanvas);\n\n\n        function draw (): void {\n            if (algorithmSelect.getValue() === 'smooth') {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\n\n                previewCanvas.width = klCanvas.getWidth();\n                previewCanvas.height = klCanvas.getHeight();\n\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = 'high';\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n\n            } else {\n                previewCanvas.style.imageRendering = 'pixelated';\n\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n\n        }\n\n        function update (): void {\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) {\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\n                }\n                if (widthChanged) {\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\n                }\n\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    const fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = '' + parseInt('' + fit.width);\n                    heightInput.value = '' + parseInt('' + fit.height);\n                }\n            }\n\n            if (parseInt(widthInput.value) > maxWidth) {\n                widthInput.value = '' + maxWidth;\n            }\n            if (parseInt(heightInput.value) > maxHeight) {\n                heightInput.value = '' + maxHeight;\n            }\n\n            heightChanged = false;\n            widthChanged = false;\n\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\n            const previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\n            previewFactor = previewW / newWidth;\n\n            const offset = BB.centerWithin(smallPreview.width, smallPreview.height, previewW, previewH);\n\n            draw();\n\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\n            canvasWrapper.style.left = offset.x + 'px';\n            canvasWrapper.style.top = offset.y + 'px';\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\n        }\n\n        const previewWrapper = BB.el({\n            className: 'kl-transparent-preview',\n            css: {\n                width: smallPreview.width + 'px',\n                height: smallPreview.height + 'px',\n                marginLeft: '-20px',\n                display: 'table',\n                marginTop: '10px',\n                position: 'relative',\n                userSelect: 'none',\n            },\n        });\n\n        const canvasWrapper = BB.el({\n            parent: previewWrapper,\n            content: previewCanvas,\n            className: 'kl-transparent-preview__canvas',\n            css: {\n                width: w + 'px',\n                height: h + 'px',\n                position: 'absolute',\n                overflow: 'hidden',\n            },\n        });\n\n        function updateCheckerboard (): void {\n            BB.createCheckerDataUrl(8, function (url) {\n                previewWrapper.style.background = 'url(' + url + ')';\n            }, theme.isDark());\n        }\n        theme.addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n\n\n        rootEl.append(previewWrapper);\n        update();\n\n        result.destroy = (): void => {\n            constrainCheckbox.destroy();\n            theme.removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function (): TFilterResizeInput {\n            result.destroy!();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue(),\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterResizeInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        const width = params.input.width;\n        const height = params.input.height;\n        const algorithm = params.input.algorithm;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'resize'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterResizeHistoryEntry);\n        return true;\n    },\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"constrain.21f8c00a.svg\" + \"?\" + Date.now();","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {TFilterHistoryEntry} from './filters';\nimport {theme} from '../../theme/theme';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterRotateInput = {\n    deg: number;\n}\n\nexport type TFilterRotateHistoryEntry = TFilterHistoryEntry<\n    'rotate',\n    TFilterRotateInput>;\n\nexport const filterRotate = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        const previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = BB.canvas(w, h);\n        tempCanvas.style.display = 'block';\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterRotateInput> = {\n            element: rootEl,\n        };\n        let deg = 0;\n\n        function update (): void {\n            canvasWrapper.style.transform = 'rotate(' + deg + 'deg)';\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                const fit = BB.fitInto(h, w, 280, 200, 1);\n                const scale = parseInt('' + fit.height) / w;\n                canvasWrapper.style.transform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\n            }\n        }\n\n        const btnPlus = document.createElement('button');\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\n        const btnMinus = document.createElement('button');\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\n        btnMinus.style.marginRight = '5px';\n\n\n        btnPlus.onclick = function () {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function () {\n            deg -= 90;\n            update();\n        };\n\n        rootEl.append(btnMinus, btnPlus);\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: smallPreview.width + 'px',\n                height: smallPreview.height + 'px',\n                display: 'table',\n            },\n        });\n\n        const previewcell = BB.el({\n            parent: previewWrapper,\n            css: {\n                display: 'table-cell',\n                verticalAlign: 'middle',\n            },\n        });\n        const canvasWrapper = BB.el({\n            parent: previewcell,\n            content: tempCanvas,\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: w + 'px',\n                height: h + 'px',\n                marginLeft: 'auto',\n                marginRight: 'auto',\n                overflow: 'hidden',\n            },\n        });\n\n\n        function updateCheckerboard (): void {\n            BB.createCheckerDataUrl(8, function (url) {\n                canvasWrapper.style.background = 'url(' + url + ')';\n            }, theme.isDark());\n        }\n        theme.addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n\n        canvasWrapper.style.transition = 'all 0.2s ease-out';\n\n        rootEl.append(previewWrapper);\n        update();\n\n        result.destroy = (): void => {\n            theme.removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function (): TFilterRotateInput {\n            result.destroy!();\n            return {\n                deg: deg,\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterRotateInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.rotate(params.input.deg);\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'rotate'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterRotateHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {IVector2D} from '../../bb/bb-types';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {createTransformMatrix} from '../ui/project-viewport/utils/create-transform-matrix';\nimport {applyToPoint} from 'transformation-matrix';\nimport {DraggableInput} from '../ui/components/draggable-input';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterTiltShiftInput = {\n    a: IVector2D;\n    b: IVector2D;\n    blur: number;\n    gradient: number;\n};\n\nexport type TFilterTiltShiftHistoryEntry = TFilterHistoryEntry<\n    'tiltShift',\n    TFilterTiltShiftInput>;\n\nexport const filterTiltShift = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterTiltShiftInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let blur = 20, gradient = 200;\n        let fxPreviewRenderer: FxPreviewRenderer = {destroy: () => {}} as FxPreviewRenderer;\n\n        function finishInit () {\n\n            fxPreviewRenderer = new FxPreviewRenderer({\n                original: context.canvas,\n                onUpdate: (fxCanvas, transform) => {\n                    fa.setTransform(preview.getTransform());\n                    fb.setTransform((preview.getTransform()));\n\n                    const m = createTransformMatrix(transform);\n                    const a = applyToPoint(m, fa.getValue());\n                    const b = applyToPoint(m, fb.getValue());\n                    return fxCanvas.multiplyAlpha().tiltShift(\n                        a.x,\n                        a.y,\n                        b.x,\n                        b.y,\n                        blur * transform.scaleX,\n                        gradient * transform.scaleX\n                    ).unmultiplyAlpha();\n                },\n            });\n\n            function update () {\n                preview.render();\n            }\n\n            // focus line control points\n            const fa = new DraggableInput({\n                value: {x: context.canvas.width / 4, y: context.canvas.height / 2},\n                onChange: () => {\n                    update();\n                },\n            });\n            const fb = new DraggableInput({\n                value: {x: 3 * context.canvas.width / 4, y: context.canvas.height / 2},\n                onChange: () => {\n                    update();\n                },\n            });\n\n            const gradientSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-gradient'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                value: gradient,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    gradient = val;\n                    update();\n                },\n            });\n            gradientSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(gradientSlider.getElement());\n            const blurSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-blur'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: blur,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    blur = val;\n                    update();\n                },\n            });\n            blurSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(blurSlider.getElement());\n\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n\n            preview.render();\n            BB.css(preview.getElement(), {\n                overflow: 'hidden',\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            });\n\n            preview.getElement().append(fa.getElement(), fb.getElement());\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                fa.destroy();\n                fb.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterTiltShiftInput {\n                result.destroy!();\n                return {\n                    a: fa.getValue(),\n                    b: fb.getValue(),\n                    blur: blur,\n                    gradient: gradient,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterTiltShiftInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const a = params.input.a;\n        const b = params.input.b;\n        const blur = params.input.blur;\n        const gradient = params.input.gradient;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().tiltShift(a.x, a.y, b.x, b.y, blur, gradient).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'tiltShift'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterTiltShiftHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {FreeTransform} from '../ui/components/free-transform';\nimport {IFreeTransform} from '../ui/components/free-transform-utils';\nimport {Select} from '../ui/components/select';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\nexport type TFilterTransformInput = {\n    bounds: {x: number; y: number; width: number; height: number};\n    transform: IFreeTransform;\n    isPixelated: boolean;\n};\n\nexport type TFilterTransformHistoryEntry = TFilterHistoryEntry<\n    'transform',\n    TFilterTransformInput>;\n\nexport const filterTransform = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const isSmall = testIsSmall();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        // determine bounds and initial transformation\n        const boundsObj = BB.canvasBounds(context);\n        if (!boundsObj) {\n            return { error: LANG('filter-transform-empty') };\n        }\n        const initTransform = {\n            x: boundsObj.x + boundsObj.width / 2,\n            y: boundsObj.y + boundsObj.height / 2,\n            width: boundsObj.width,\n            height: boundsObj.height,\n            angleDeg: 0,\n        };\n\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterTransformInput> = {\n            element: rootEl,\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n\n        const keyListener = new BB.KeyListener({\n            onDown: function (keyStr) {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n\n                if (keyStr === 'left') {\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'right') {\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'up') {\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'down') {\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\n                    onInputsChanged();\n                }\n            },\n\n        });\n\n        const leftWrapper = BB.el();\n        const rightWrapper = BB.el();\n        const rotWrapper = BB.el();\n        const inputY = BB.el({tagName: 'input'});\n        const inputX = BB.el({tagName: 'input'});\n        const inputR = BB.el({tagName: 'input'});\n        leftWrapper.style.width = '100px';\n        leftWrapper.style.height = '30px';\n        rightWrapper.style.width = '100px';\n        rightWrapper.style.height = '30px';\n        rightWrapper.style.display = 'inline-block';\n        leftWrapper.style.display = 'inline-block';\n        rotWrapper.style.display = 'inline-block';\n        rotWrapper.style.width = '150px';\n        rotWrapper.style.height = '30px';\n        inputY.type = 'number';\n        inputX.type = 'number';\n        inputR.type = 'number';\n        inputX.style.width = 70 + 'px';\n        inputY.style.width = 70 + 'px';\n        inputR.style.width = 70 + 'px';\n        inputY.value = '0';\n        inputX.value = '0';\n        inputR.value = '0';\n        inputY.onclick = function () {\n            inputY.focus();\n            onInputsChanged();\n        };\n        inputX.onclick = function () {\n            inputX.focus();\n            onInputsChanged();\n        };\n        inputR.onclick = function () {\n            inputR.focus();\n            onInputsChanged();\n        };\n        inputY.onchange = function () {\n            onInputsChanged();\n        };\n        inputX.onchange = function () {\n            onInputsChanged();\n        };\n        inputR.onchange = function () {\n            onInputsChanged();\n        };\n        inputY.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputX.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputR.onkeyup = function () {\n            onInputsChanged();\n        };\n        leftWrapper.append('X: ', inputX);\n        rightWrapper.append('Y: ', inputY);\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\n        if (!isSmall) {\n            const inputRow = BB.el({\n                parent: rootEl,\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\n        }\n\n        // buttons\n        const actionBtnCss = {\n            marginLeft: '10px',\n            marginTop: '10px',\n        };\n        const buttonRow = BB.el ({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                marginLeft: '-10px',\n            },\n        });\n        const flipXBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' X',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(-t.width, t.height);\n            },\n            css: actionBtnCss,\n        });\n        const flipYBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' Y',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(t.width, -t.height);\n            },\n            css: actionBtnCss,\n        });\n        const scaleRotLeftBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '-90',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                t.angleDeg -= 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n        const scaleRotRightBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '+90',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                t.angleDeg += 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n        const scaleDoubleBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '2x',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                if (constrainCheckbox.getValue()) {\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\n                } else {\n                    freeTransform.setSize(t.width * 2, t.height * 2);\n                }\n            },\n            css: actionBtnCss,\n        });\n        const scaleHalfBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '1/2x',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\n            },\n            css: actionBtnCss,\n        });\n        const centerBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('center'),\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\n                freeTransform.setAngleDeg(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n\n\n\n\n\n        let isConstrained = true;\n        const constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-constrain'),\n            title: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function (b) {\n                isConstrained = b;\n                freeTransform.setIsConstrained(isConstrained);\n            },\n            css: {\n                display: 'inline-block',\n            },\n        });\n        let isSnapping = false;\n        const snappingCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-snap'),\n            title: LANG('filter-transform-snap-title'),\n            allowTab: true,\n            callback: function (b) {\n                isSnapping = b;\n                freeTransform.setSnapping(isSnapping);\n            },\n            css: {\n                display: 'inline-block',\n                marginLeft: '10px',\n            },\n        });\n        const checkboxWrapper = BB.el();\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\n\n        rootEl.append(BB.el({\n            css: {\n                clear: 'both',\n                height: '10px',\n            },\n        }));\n\n        const bottomRow = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginBottom: '10px',\n            },\n        });\n\n        const algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')],\n            ],\n            initValue: 'smooth',\n            title: LANG('scaling-algorithm'),\n            onChange: (): void => {\n                updatePreview(true);\n            },\n        });\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? previewCanvas : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            hasEditMode: true,\n            onModeChange: (m) => {\n                freeTransform.getElement().style.pointerEvents = m === 'edit' ? '' : 'none';\n                freeTransform.getElement().style.opacity = m === 'edit' ? '' : '0.5';\n            },\n            onTransformChange: (transform) => {\n                freeTransform.setViewportTransform(transform);\n            },\n            padding: 30,\n        });\n        preview.render();\n        preview.getElement().classList.add(css({\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n\n        let lastDrawnTransformStr = '';\n        function updatePreview (doForce: boolean = false) {\n            if (!freeTransform) {\n                return;\n            }\n            const transform = freeTransform.getValue();\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\n                return;\n            }\n            lastDrawnTransformStr = JSON.stringify(transform);\n\n            const ctx = BB.ctx(previewCanvas);\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            BB.drawTransformedImageWithBounds(\n                ctx,\n                layers[selectedLayerIndex].context.canvas,\n                transform,\n                boundsObj,\n                algorithmSelect.getValue() === 'pixelated' ||\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n            );\n            ctx.restore();\n            preview.render();\n        }\n\n        const freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: initTransform.angleDeg,\n            isConstrained: true,\n            snapX: [0, context.canvas.width],\n            snapY: [0, context.canvas.height],\n            callback: function (t) {\n                inputX.value = '' + Math.round(t.x - initTransform.x);\n                inputY.value = '' + Math.round(t.y - initTransform.y);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            viewportTransform: preview.getTransform(),\n        });\n        BB.css(freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        preview.getElement().append(freeTransform.getElement());\n\n        function onInputsChanged () {\n            freeTransform.setPos({\n                x: parseInt(inputX.value) + initTransform.x,\n                y: parseInt(inputY.value) + initTransform.y}\n            );\n            freeTransform.setAngleDeg(parseInt(inputR.value));\n            updatePreview();\n        }\n\n        updatePreview();\n\n        result.destroy = (): void => {\n            keyListener.destroy();\n            freeTransform.destroy();\n            constrainCheckbox.destroy();\n            snappingCheckbox.destroy();\n            BB.destroyEl(flipXBtn);\n            BB.destroyEl(flipYBtn);\n            BB.destroyEl(scaleRotLeftBtn);\n            BB.destroyEl(scaleRotRightBtn);\n            BB.destroyEl(scaleDoubleBtn);\n            BB.destroyEl(scaleHalfBtn);\n            BB.destroyEl(centerBtn);\n            preview.destroy();\n            BB.freeCanvas(previewCanvas);\n        };\n        result.getInput = function (): TFilterTransformInput {\n            const transform = freeTransform.getValue();\n            const input: TFilterTransformInput = {\n                transform,\n                bounds: boundsObj,\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n            };\n            result.destroy!();\n            return BB.copyObj(input);\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterTransformInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        const input = params.input;\n\n        const copyCanvas = BB.copyCanvas(context.canvas);\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        BB.drawTransformedImageWithBounds(\n            context,\n            copyCanvas,\n            input.transform,\n            input.bounds,\n            input.isPixelated,\n        );\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'transform'],\n            action: 'apply',\n            params: [{input}],\n        } as TFilterTransformHistoryEntry);\n        return true;\n    },\n\n};","import {KlSlider} from '../ui/components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterBlurInput = {\n    radius: number;\n}\n\nexport type TFilterBlurHistoryEntry = TFilterHistoryEntry<\n    'blur',\n    TFilterBlurInput>;\n\n\nexport const filterBlur = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        if (!klCanvas || !context) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterBlurInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let radius = 10;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                return fxCanvas.multiplyAlpha().triangleBlur(radius * transform.scaleX).unmultiplyAlpha();\n            },\n        });\n\n\n        function finishInit (): void {\n\n            const radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                value: radius,\n                eventResMs: eventResMs,\n                onChange: (val): void => {\n                    radius = val;\n                    preview.render();\n                },\n            });\n            radiusSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(radiusSlider.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                radiusSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterBlurInput {\n                result.destroy!();\n                return {\n                    radius: radius,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterBlurInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const radius = params.input.radius;\n        if (!context || !radius || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().triangleBlur(radius).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'blur'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterBlurHistoryEntry);\n        return true;\n    },\n\n};","import {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {css} from '@emotion/css';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterUnsharpMaskInput = {\n    radius: number;\n    strength: number;\n};\n\nexport type TFilterUnsharpMaskHistoryEntry = TFilterHistoryEntry<\n    'unsharpMask',\n    TFilterUnsharpMaskInput>;\n\nexport const filterUnsharpMask = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterUnsharpMaskInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let radius = 2, strength = 5.1 / 10;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                return fxCanvas.unsharpMask(radius * transform.scaleX, strength);\n            },\n        });\n\n        function finishInit () {\n\n            function update () {\n                preview.render();\n            }\n\n            const radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: 2,\n                //eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    update();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\n            });\n            const strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                value: 5.1,\n                //eventResMs: eventResMs,\n                onChange: function (val) {\n                    strength = val / 10;\n                    update();\n\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\n            });\n            radiusSlider.getElement().style.marginBottom = '10px';\n            strengthSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(radiusSlider.getElement());\n            rootEl.append(strengthSlider.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            update();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterUnsharpMaskInput {\n                result.destroy!();\n                return {\n                    radius: radius,\n                    strength: strength,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply (params: IFilterApply<TFilterUnsharpMaskInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const radius = params.input.radius;\n        const strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'unsharpMask'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterUnsharpMaskHistoryEntry);\n        return true;\n    },\n\n};","import {Options} from '../ui/components/options';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGBA} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterToAlphaInput = {\n    sourceId: string;\n    selectedRgbaObj: IRGBA | null;\n};\n\nexport type TFilterToAlphaHistoryEntry = TFilterHistoryEntry<\n    'toAlpha',\n    TFilterToAlphaInput>;\n\nexport const filterToAlpha = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterToAlphaInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        function finishInit () {\n\n            const fxPreviewRenderer = new FxPreviewRenderer({\n                original: context.canvas,\n                onUpdate: (fxCanvas) => {\n                    return fxCanvas.toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj);\n                },\n            });\n\n            // source\n            let sourceId = 'inverted-luminance';\n            const sourceOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'inverted-luminance',\n                        label: LANG('filter-to-alpha-inverted-lum'),\n                    },\n                    {\n                        id: 'luminance',\n                        label: LANG('filter-to-alpha-lum'),\n                    },\n                ],\n                initId: sourceId,\n                onChange: function (id) {\n                    sourceId = id;\n                    preview.render();\n                },\n            });\n            rootEl.append(sourceOptions.getElement());\n\n            // color\n            let selectedRgbaObj: IRGBA | null = {r: 0, g: 0, b: 0, a: 1};\n            const colorOptionsArr = [\n                null,\n                {r: 0, g: 0, b: 0, a: 1},\n                {r: 255, g: 255, b: 255, a: 1},\n                {\n                    r: params.currentColorRgb.r,\n                    g: params.currentColorRgb.g,\n                    b: params.currentColorRgb.b,\n                    a: 1,\n                },\n                {\n                    r: params.secondaryColorRgb.r,\n                    g: params.secondaryColorRgb.g,\n                    b: params.secondaryColorRgb.b,\n                    a: 1,\n                },\n            ];\n\n            const colorOptions = new ColorOptions({\n                label: LANG('filter-to-alpha-replace'),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function (rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    preview.render();\n                },\n            });\n            colorOptions.getElement().style.marginTop = '10px';\n            colorOptions.getElement().style.marginBottom = '10px';\n            rootEl.append(colorOptions.getElement());\n\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                sourceOptions.destroy();\n                colorOptions.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterToAlphaInput {\n                result.destroy!();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply (params: IFilterApply<TFilterToAlphaInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const sourceId = params.input.sourceId;\n        const selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'toAlpha'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterToAlphaHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {input} from '../ui/components/input';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {drawGrid} from '../image-operations/draw-grid';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterGridInput = {\n    x: number;\n    y: number;\n    thickness: number;\n    color: string;\n    opacity: number;\n};\n\nexport type TFilterGridHistoryEntry = TFilterHistoryEntry<\n    'grid',\n    TFilterGridInput>;\n\nexport const filterGrid = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterGridInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterGridInput = {\n            x: 2,\n            y: 2,\n            thickness: 8,\n            color: '#000',\n            opacity: 1,\n        };\n\n        const line1 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        const line2 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                marginBottom: '10px',\n            },\n        });\n        const xInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            },\n        });\n        const yInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            },\n        });\n        const thicknessInput = input({\n            init: settingsObj.thickness,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            },\n        });\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n                updatePreview();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({content: 'X:', css: labelStyle}),\n            xInput,\n            BB.el({content: 'Y:', css: labelStyle}),\n            yInput,\n        );\n        line2.append(\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\n            thicknessInput,\n            BB.el({css:{flexGrow: '1'}}),\n            colorOptions.getElement(),\n        );\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = BB.ctx(previewCanvas);\n        const previewLayerArr = layers.map((item, i) => {\n            return {\n                image: i === selectedLayerIndex ? previewCanvas : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false,\n            };\n        });\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n\n        preview.getElement().classList.add(css({\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n        function updatePreview (): void {\n            const ctx = previewCtx;\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            ctx.drawImage(context.canvas, 0, 0);\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness, 1), settingsObj.color, settingsObj.opacity);\n            ctx.restore();\n            preview.render();\n        }\n        updatePreview();\n        preview.render();\n\n\n        result.destroy = (): void => {\n            preview.destroy();\n            BB.freeCanvas(previewCanvas);\n            colorOptions.destroy();\n        };\n        result.getInput = function (): TFilterGridInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterGridInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        drawGrid(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity,\n        );\n        history.pause(false);\n\n        history.push({\n            tool: ['filter', 'grid'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterGridHistoryEntry);\n        return true;\n    },\n\n};","\n// ideas: padding, gutter, other shapes\n\nexport function drawGrid (\n    ctx: CanvasRenderingContext2D,\n    cellsX: number,\n    cellsY: number,\n    thickness: number, // px\n    color: string,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n    const w = ctx.canvas.width;\n    const h = ctx.canvas.height;\n    thickness = Math.round(thickness);\n    const thickIsRound = thickness % 2 === 0;\n\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.globalAlpha = opacity;\n\n    for(let i = 0; i < cellsX - 1; i++) {\n        const cw = w / (cellsX);\n        let pos = cw * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n        ctx.moveTo(pos, 0);\n        ctx.lineTo(pos, h);\n\n    }\n    for(let i = 0; i < cellsY - 1; i++) {\n        const ch = h / (cellsY);\n        let pos = ch * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n\n        ctx.moveTo(0, pos);\n        ctx.lineTo(w, pos);\n    }\n\n    ctx.stroke();\n    ctx.restore();\n}","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGB, TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {Options} from '../ui/components/options';\nimport {eventResMs} from './filters-consts';\nimport {Select} from '../ui/components/select';\nimport {translateBlending} from '../canvas/translate-blending';\nimport {KL} from '../kl';\nimport {ColorConverter} from '../../bb/color/color';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {TFxCanvas} from '../../fx-canvas/fx-canvas-types';\nimport {TKlCanvasHistoryEntry} from '../canvas/kl-canvas';\nimport {throwIfNull} from '../../bb/base/base';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\nimport {testIsSmall} from '../ui/utils/test-is-small';\n\n// see noise(...) in fx-canvas\ninterface INoisePreset {\n    type: number;\n    scaleX: number;\n    scaleY: number;\n    offsetX: number;\n    offsetY: number;\n    octaves: number;\n    samples: number;\n    peaks: number;\n    brightness: number;\n    contrast: number;\n    isReversed: boolean;\n}\n\ntype TNoiseChannels = 'rgb' | 'alpha';\n\ninterface INoiseSettings extends INoisePreset {\n    seed?: number;\n    colA?: IRGB;\n    colB?: IRGB;\n    channels?: TNoiseChannels; // default rgb\n}\n\nexport type TFilterNoiseInput = {\n    seed: number;\n    presetIndex: number; // which preset from presetArr\n    scale: number; // applies to both scaleX and scaleX\n    opacity: number; // aka strength\n    isReversed: boolean; // reverse direction of color gradient\n    channels: TNoiseChannels;\n\n    // only for channels = rgb\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\n    colA: IRGB;\n    colB: IRGB;\n}\n\nconst presetArr: INoisePreset[] = [\n    // each pixel random value\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\n\n    // cloud\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\n\n    // thin lines\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\n\n    // soft large simplex, only 1 octave\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\n\n    // two value large pixels\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\n\n    // zebra\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\n\n    // sparse dots / stars\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\n\n    // pseudo marble\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\n];\n\nfunction drawNoise (fxCanvas: TFxCanvas, settings: INoiseSettings): void {\n    fxCanvas.noise(\n        settings.seed,\n        settings.type,\n        [settings.scaleX, settings.scaleY],\n        [fxCanvas.width / 2, fxCanvas.height / 2],\n        settings.octaves,\n        settings.samples,\n        settings.peaks,\n        settings.brightness,\n        settings.contrast,\n        settings.isReversed,\n        settings.colA,\n        settings.colB,\n        settings.channels ? settings.channels : 'rgb',\n    ).update();\n}\n\n\nexport const filterNoise = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const thumbImgArr: HTMLImageElement[] = [];\n        const thumbSize = 32;\n        {\n            const fxCanvas = throwIfNull(getSharedFx());\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = BB.ctx(canvas);\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            texture.destroy();\n\n            presetArr.forEach((preset) => {\n                const thumbImg = new Image();\n                const presetCopy = BB.copyObj(preset) as INoiseSettings;\n                presetCopy.scaleX /= 10;\n                presetCopy.scaleY /= 10;\n                drawNoise(fxCanvas, presetCopy);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterNoiseInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterNoiseInput = {\n            seed: Math.random() * 300,\n            presetIndex: 0,\n            scale: 50,\n            opacity: 0.5,\n            isReversed: false,\n            channels: 'rgb',\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\n            colA: {r: 0, g: 0, b: 0},\n            colB: {r: 255, g: 255, b: 255},\n        };\n\n        const presetOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                BB.css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                });\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initId: '0',\n            onChange: (id) => {\n                settingsObj.presetIndex = Number(id);\n                update();\n            },\n        });\n        presetOptions.getElement().style.marginBottom = '10px';\n        rootEl.append(presetOptions.getElement());\n\n        const scaleSlider = new KlSlider({\n            label: LANG('filter-noise-scale'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 1000,\n            value: settingsObj.scale,\n            eventResMs: eventResMs,\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\n            onChange: (value) => {\n                settingsObj.scale = value;\n                update();\n            },\n        });\n        scaleSlider.getElement().style.marginBottom = '10px';\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 300,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: settingsObj.opacity,\n            eventResMs: eventResMs,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (value) => {\n                settingsObj.opacity = value;\n                update();\n            },\n        });\n        opacitySlider.getElement().style.marginBottom = '10px';\n\n        const row1El = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginBottom: '10px',\n            },\n        });\n\n        const row2El = BB.el({\n            css: {\n                display: 'flex',\n                marginBottom: '10px',\n            },\n        });\n\n        const channelsOptions = new Options<TNoiseChannels>({\n            optionArr: [\n                {id: 'rgb', label: 'RGB'},\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\n            ],\n            initId: 'rgb',\n            onChange: (id: TNoiseChannels) => {\n                settingsObj.channels = id;\n                if (id === 'rgb') {\n                    row2El.style.visibility = '';\n                } else {\n                    row2El.style.visibility = 'hidden';\n                }\n                update();\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            label: LANG('reverse'),\n            callback: (val) => {\n                settingsObj.isReversed = val;\n                update();\n            },\n            allowTab: true,\n        });\n\n        const mixModes: (TMixMode | undefined)[] = [\n            'source-over',\n            undefined,\n            'darken',\n            'multiply',\n            'color-burn',\n            undefined,\n            'lighten',\n            'screen',\n            'color-dodge',\n            undefined,\n            'overlay',\n            'soft-light',\n            'hard-light',\n            undefined,\n            'difference',\n            'exclusion',\n            undefined,\n            'hue',\n            'saturation',\n            'color',\n            'luminosity',\n        ];\n\n        const blendSelect = new Select({\n            isFocusable: true,\n            optionArr: mixModes.map(item => {\n                return item ? ([item, translateBlending(item)] as [TMixMode, string]) : undefined;\n            }),\n            initValue: settingsObj.mixModeStr,\n            onChange: (val: GlobalCompositeOperation) => {\n                settingsObj.mixModeStr = val;\n                update();\n            },\n        });\n        blendSelect.getElement().title = LANG('layers-blending');\n\n        const colorWrapper = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n\n        const colInputStyle = {\n            width: '34px',\n            height: '34px',\n            marginRight: '5px',\n        };\n        const colAInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\n            callback: (val) => {\n                const newColor = ColorConverter.hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colA = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle,\n        });\n\n        const colBInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\n            callback: (val) => {\n                const newColor = ColorConverter.hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colB = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle,\n        });\n\n        colorWrapper.append(\n            colAInput,\n            colBInput,\n        );\n\n\n        row1El.append(\n            channelsOptions.getElement(),\n            BB.el({css:{flexGrow: '1'}}),\n            reverseToggle.getElement(),\n        );\n\n        row2El.append(\n            blendSelect.getElement(),\n            BB.el({css:{flexGrow: '1'}}),\n            colorWrapper,\n        );\n\n        rootEl.append(\n            scaleSlider.getElement(),\n            opacitySlider.getElement(),\n            row1El,\n            row2El,\n        );\n\n\n\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                const settingsCopy = BB.copyObj(presetArr[settingsObj.presetIndex]) as INoiseSettings;\n                settingsCopy.seed = settingsObj.seed;\n                settingsCopy.scaleX = settingsCopy.scaleX  * settingsObj.scale / 50 * transform.scaleX;\n                settingsCopy.scaleY = settingsCopy.scaleY  * settingsObj.scale / 50 * transform.scaleY;\n                settingsCopy.colA = settingsObj.colA;\n                settingsCopy.colB = settingsObj.colB;\n                settingsCopy.isReversed = settingsObj.isReversed ? !settingsCopy.isReversed : settingsCopy.isReversed;\n                settingsCopy.channels  = settingsObj.channels;\n                settingsCopy.offsetX = context.canvas.width / 2 * transform.scaleX + transform.x;\n                settingsCopy.offsetY = context.canvas.height / 2 * transform.scaleY + transform.y;\n\n                return fxCanvas.noise(\n                    settingsCopy.seed,\n                    settingsCopy.type,\n                    [settingsCopy.scaleX, settingsCopy.scaleY],\n                    [settingsCopy.offsetX, settingsCopy.offsetY],\n                    settingsCopy.octaves,\n                    settingsCopy.samples,\n                    settingsCopy.peaks,\n                    settingsCopy.brightness,\n                    settingsCopy.contrast,\n                    settingsCopy.isReversed,\n                    settingsCopy.colA,\n                    settingsCopy.colB,\n                    settingsCopy.channels ? settingsCopy.channels : 'rgb',\n                );\n            },\n            postMix: {\n                opacity: settingsObj.opacity,\n                operation: settingsObj.channels === 'alpha' ? 'destination-out' : settingsObj.mixModeStr,\n            },\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        preview.render();\n        preview.getElement().classList.add(css({\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n        function update (): void {\n            fxPreviewRenderer.setPostMix({\n                opacity: settingsObj.opacity,\n                operation: settingsObj.channels === 'alpha' ? 'destination-out' : settingsObj.mixModeStr,\n            });\n            preview.render();\n        }\n\n\n        result.destroy = (): void => {\n            presetOptions.destroy();\n            scaleSlider.destroy();\n            opacitySlider.destroy();\n            reverseToggle.destroy();\n            channelsOptions.destroy();\n            blendSelect.destroy();\n            preview.destroy();\n            fxPreviewRenderer.destroy();\n        };\n        result.getInput = function (): TFilterNoiseInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterNoiseInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).update();\n        texture.destroy();\n\n        const input = params.input;\n\n        const presetCopy: INoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as INoiseSettings;\n        presetCopy.seed = input.seed;\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\n        presetCopy.colA = input.colA;\n        presetCopy.colB = input.colB;\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n        presetCopy.channels  = input.channels;\n        drawNoise(fxCanvas, presetCopy);\n\n        context.save();\n        context.globalAlpha = input.opacity;\n        if (input.channels === 'alpha') {\n            context.globalCompositeOperation = 'destination-out';\n        } else {\n            context.globalCompositeOperation = input.mixModeStr;\n        }\n        context.drawImage(fxCanvas, 0, 0);\n        context.restore();\n\n        history.pause(false);\n\n        history.push({\n            tool: ['canvas'],\n            action: 'replaceLayer',\n            params: [\n                klCanvas.getLayerIndex(context.canvas),\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\n            ],\n        } as TKlCanvasHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\nimport {input} from '../ui/components/input';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {LANG} from '../../language/language';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {TwoTabs} from '../ui/components/two-tabs';\nimport {IVector2D} from '../../bb/bb-types';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\n\nexport type TFilterPatternInput = {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    blend: number; // [0, 1] - 1 will blend linearly across whole length\n    offsetX: number;\n    offsetY: number;\n};\n\nexport type TFilterPatternHistoryEntry = TFilterHistoryEntry<\n    'pattern',\n    TFilterPatternInput>;\n\n/**\n * Draws pattern onto context. Pattern generated from context.\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\n *\n * @param context\n * @param settings\n */\nfunction drawPattern (context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\n\n    // keep bounds in center via offset\n    // because blending done towards bottom right\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\n\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\n\n    if (settings.blend) {\n        // construct pattern via linear blending\n\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\n        const blendCtx = BB.ctx(blendCanvas);\n        const colTransparent = '#0000';\n        const colOpaque = '#000';\n\n        // transfer source to blendCanvas\n        blendCtx.drawImage(\n            context.canvas,\n            -settings.x + blendOffsetX,\n            -settings.y + blendOffsetY,\n        );\n\n        // --- 1 cross-fade vertical ------------------------\n\n        // erase vertical gradient bottom half\n        blendCtx.save();\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase vertical gradient top half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw bottom half over top half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\n        blendCtx.restore();\n\n\n\n        // --- 2 cross-fade horizontal ------------------------\n\n        // erase horizontal gradient right half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase horizontal gradient left half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw right half over left half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\n        blendCtx.restore();\n\n        // transfer to pattern canvas\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\n\n    } else {\n        BB.ctx(finalPatternCanvas).drawImage(\n            context.canvas,\n            -settings.x,\n            -settings.y,\n        );\n    }\n\n    context.save();\n\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\n    context.fillStyle = throwIfNull(context.createPattern(finalPatternCanvas, 'repeat'));\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\n\n    context.restore();\n}\n\n\nexport const filterPattern = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const isSmall = testIsSmall();\n        const maxSize = 1024;\n        const rootEl = BB.el();\n        const context = params.context;\n        const width = context.canvas.width;\n        const height = context.canvas.height;\n\n        let settings: TFilterPatternInput = {\n            x: 0,\n            y: 0,\n            width: width <= 250 ? Math.round(width / 4) : 200,\n            height: height <= 250 ? Math.round(height / 4) : 200,\n            blend: 0,\n            offsetX: 0,\n            offsetY: 0,\n        };\n        let lastDrawnSettings: TFilterPatternInput | undefined;\n\n        // determine bounds\n        const bounds = BB.canvasBounds(context);\n        // adjust settings according to bounds\n        if ( // use layer bounds if:\n            bounds &&\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\n        ) {\n            settings.x = bounds.x;\n            settings.y = bounds.y;\n            settings.width = bounds.width;\n            settings.height = bounds.height;\n        } else { // otherwise use default size in center\n            settings.x = Math.round(width / 2 - settings.width / 2);\n            settings.y = Math.round(height / 2 - settings.height / 2);\n        }\n\n        // ---- controls ----\n\n        const xInput = input({\n            init: settings.x,\n            type: 'number',\n            min: 0,\n            max: width,\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.x = Number(v);\n                updatePreview();\n            },\n        });\n        const yInput = input({\n            init: settings.y,\n            type: 'number',\n            min: 0,\n            max: height,\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.y = Number(v);\n                updatePreview();\n            },\n        });\n        const widthInput = input({\n            init: settings.width,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, width),\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.width = Number(v);\n                updatePreview();\n            },\n        });\n        const heightInput = input({\n            init: settings.height,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, height),\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.height = Number(v);\n                updatePreview();\n            },\n        });\n\n        const inputStyle = {\n            marginLeft: '5px',\n            flex: '1',\n        };\n        rootEl.append(\n            BB.el({\n               content: [\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           'X:',\n                           xInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           'Y:',\n                           yInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           LANG('width') + ':',\n                           widthInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           LANG('height') + ':',\n                           heightInput,\n                       ],\n                       css: inputStyle,\n                   }),\n               ],\n               css: {\n                   display: 'flex',\n                   marginLeft: '-5px',\n               },\n            }),\n        );\n\n\n        const blendSlider = new KlSlider({\n            label: LANG('brush-blending'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1,\n            value: settings.blend,\n            eventResMs: eventResMs,\n            onChange: function (val) {\n                settings.blend = val;\n                updatePreview();\n            },\n            formatFunc: (val) => {\n                return BB.round(val, 2);\n            },\n            manualInputRoundDigits: 2,\n        });\n        BB.css(blendSlider.getElement(), {\n            margin: '10px 0',\n        });\n\n        rootEl.append(\n            blendSlider.getElement(),\n        );\n\n        // ---- preview tabs ----\n        let previewMode = 1; // 0 before, 1 after\n        const beforeAfterTabs = new TwoTabs({\n            left: LANG('compare-before'),\n            right: LANG('compare-after'),\n            init: previewMode,\n            onChange: (val) => {\n                previewMode = val;\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\n                updatePreview(true);\n            },\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n\n        // ---- previews ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        // const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: getPreviewWidth(isSmall) + 'px',\n                height: getPreviewHeight(isSmall) + 'px',\n                marginTop: '0',\n            },\n        });\n\n        const previewLayer: IKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        const previewLayerArr = layers.map((item, i) => {\n            if (i === selectedLayerIndex) {\n                return previewLayer;\n            } else {\n                return {\n                    image: item.context.canvas,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                };\n            }\n        });\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr,\n        });\n\n        const overlayCanvas = BB.canvas(w, h);\n        BB.css(overlayCanvas, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            mixBlendMode: 'difference',\n            imageRendering: 'pixelated',\n        });\n\n        const previewInnerWrapper = BB.el({\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n            },\n        });\n        previewInnerWrapper.append(\n            klCanvasPreview.getElement(),\n            overlayCanvas\n        );\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n\n\n        // ---- preview input processing ----\n        const inputs = {} as {\n            start: IVector2D;\n            end: IVector2D | null;\n            oldSettings: TFilterPatternInput;\n            state: null | 'move' | 'select';\n        };\n\n        function syncInputs (): void {\n            xInput.value = '' + settings.x;\n            yInput.value = '' + settings.y;\n            widthInput.value = '' + settings.width;\n            heightInput.value = '' + settings.height;\n        }\n\n        const keyListener = new BB.KeyListener({\n        });\n\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = 'none';\n        const pointerListener = new BB.PointerListener({\n            target: previewInnerWrapper,\n            onPointer: (event) => {\n                if (previewMode === 0) {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.oldSettings = BB.copyObj(settings);\n\n                            const x = event.relX / previewFactor;\n                            const y = event.relY / previewFactor;\n\n                            if (BB.isInsideRect(\n                                {x, y},\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\n                            )) {\n                                inputs.state = 'move';\n                            } else {\n                                inputs.state = 'select';\n                            }\n                            inputs.start = {x, y};\n                        }\n                    } else if (event.type === 'pointermove') {\n\n                        const x = event.relX / previewFactor;\n                        const y = event.relY / previewFactor;\n\n                        if (inputs.state === 'select') {\n                            inputs.end = {x, y};\n\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\n\n                            settings.x = Math.floor(x1);\n                            settings.y = Math.floor(y1);\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\n\n                            if (keyListener.isPressed('shift')) {\n                                settings.width = Math.min(settings.width, settings.height);\n                                settings.height = Math.min(settings.width, settings.height);\n                            }\n\n                            if (settings.width === 0 || settings.height === 0) {\n                                settings = BB.copyObj(inputs.oldSettings);\n                            }\n\n                            syncInputs();\n                            updatePreview();\n                        } else if (inputs.state === 'move') {\n                            const dX = Math.round(x - inputs.start.x);\n                            const dY = Math.round(y - inputs.start.y);\n\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\n\n                            syncInputs();\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            inputs.state = null;\n                        }\n                    }\n                } else {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.state = 'move';\n                            inputs.oldSettings = BB.copyObj(settings);\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n                            inputs.end = null;\n                        }\n                    } else if (event.type === 'pointermove') {\n                        if (inputs.state) {\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\n\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            if (!inputs.end) {\n                                settings.offsetX = 0;\n                                settings.offsetY = 0;\n                                updatePreview();\n                            }\n                            inputs.state = null;\n                        }\n                    }\n                }\n            },\n        });\n\n        // ---------- rendering ---------------------\n        const fullSizeCanvas = BB.canvas(width, height);\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\n\n        function sharpStrokeRect (\n            context: CanvasRenderingContext2D,\n            x: number,\n            y: number,\n            width: number,\n            height: number\n        ): void {\n            const drawX = Math.round(x + 0.5) - 0.5;\n            const drawY = Math.round(y + 0.5) - 0.5;\n            const drawWidth = Math.round(x + width - drawX);\n            const drawHeight = Math.round(y + height - drawY);\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\n        }\n\n        function updatePreview (doForce?: boolean) {\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\n                return;\n            }\n\n            if (previewMode === 0) { // before\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = BB.ctx(previewCanvas);\n                previewCtx.save();\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n                previewCtx.restore();\n\n                const pW = settings.width * previewFactor;\n                const pH = settings.height * previewFactor;\n\n                const overlayCtx = BB.ctx(overlayCanvas);\n                overlayCtx.save();\n                overlayCtx.clearRect(0, 0, w, h);\n                overlayCtx.strokeStyle = '#fff';\n                sharpStrokeRect(\n                    overlayCtx,\n                    settings.x * previewFactor,\n                    settings.y * previewFactor,\n                    pW,\n                    pH\n                );\n                if (settings.blend > 0.05) {\n                    overlayCtx.strokeStyle = '#f0f';\n                    sharpStrokeRect(\n                        overlayCtx,\n                        settings.x * previewFactor - pW / 2 * settings.blend,\n                        settings.y * previewFactor - pH / 2 * settings.blend,\n                        pW * (1 + settings.blend),\n                        pH * (1 + settings.blend),\n                    );\n                }\n                overlayCtx.restore();\n\n\n\n            } else { // after\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                drawPattern(fullSizeCtx, settings);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = BB.ctx(previewCanvas);\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n            }\n\n\n            klCanvasPreview.render();\n            lastDrawnSettings = BB.copyObj(settings);\n        }\n\n        updatePreview();\n\n\n        // ----- result -------------------\n        const destroy = () => {\n            blendSlider.destroy();\n            keyListener.destroy();\n            pointerListener.destroy();\n            klCanvasPreview.destroy();\n        };\n        const result: TFilterGetDialogResult<TFilterPatternInput> = {\n            element: rootEl,\n            destroy,\n            getInput: () => {\n                destroy();\n                return BB.copyObj(settings);\n            },\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterPatternInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const ctx = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        drawPattern(ctx, params.input);\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'pattern'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterPatternHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {LANG} from '../../language/language';\nimport {eventResMs} from './filters-consts';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {Options} from '../ui/components/options';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {TFilterDistortSettings} from '../../fx-canvas/filters/distort';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\n\n// see fx-canvas distort\nexport type TFilterDistortInput = {\n    stepSize: number; // [0, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n    offset: { x: number; y: number };\n};\n\nexport type TFilterDistortHistoryEntry = TFilterHistoryEntry<\n    'distort',\n    TFilterDistortInput>;\n\nexport const filterDistort = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const isSmall = testIsSmall();\n        const rootEl = BB.el();\n        const context = params.context;\n\n        let isSynced = true;\n        const settings: TFilterDistortInput = {\n            stepSize: 1,\n            distortType: 0,\n            scale: {x: 100, y: 100},\n            strength: {x: 20, y: 20},\n            phase: {x: 0, y: 0},\n            offset: {x: 0, y: 0},\n        };\n        // let lastDrawnSettings = null;\n\n        // ---- thumb -------\n        const thumbImgArr: HTMLImageElement[] = [];\n        const thumbSize = 32;\n        {\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = BB.ctx(canvas);\n\n            ctx.beginPath();\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\n            ctx.fill();\n\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\n            gradient.addColorStop(0, '#00f');\n            gradient.addColorStop(0.5, '#f00');\n            gradient.addColorStop(1, '#fff');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'source-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\n            gradient.addColorStop(0, '#000');\n            gradient.addColorStop(1, '#000');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'destination-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            const fxCanvas = throwIfNull(getSharedFx());\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n\n            const scaleFactor = 20;\n\n            ([0, 1, 2] as const).forEach(item => {\n                const thumbImg = new Image();\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\n                settingsCopy.distortType = item;\n                settingsCopy.scale.x /= scaleFactor;\n                settingsCopy.scale.y /= scaleFactor;\n                settingsCopy.strength.x /= scaleFactor;\n                settingsCopy.strength.y /= scaleFactor;\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n\n        // ---- controls ----\n\n        const topRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n\n        const typeOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                BB.css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                });\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initId: '0',\n            onChange: (id) => {\n                settings.distortType = Number(id) as TFilterDistortSettings['distortType'];\n                preview.render();\n            },\n        });\n\n        function sync (from: 'x' | 'y') {\n            if (from === 'x') {\n                settings.scale.y = (settings.scale.x);\n                settings.strength.y = (settings.strength.x);\n                settings.phase.y = (settings.phase.x);\n\n                sliderArr[3].setValue(settings.scale.y);\n                sliderArr[4].setValue(settings.strength.y);\n                sliderArr[5].setValue(settings.phase.y);\n            } else {\n                settings.scale.x = (settings.scale.y);\n                settings.strength.x = (settings.strength.y);\n                settings.phase.x = (settings.phase.y);\n\n                sliderArr[0].setValue(settings.scale.x);\n                sliderArr[1].setValue(settings.strength.x);\n                sliderArr[2].setValue(settings.phase.x);\n            }\n            preview.render();\n        }\n\n        const syncToggle = new Checkbox({\n            init: true,\n            label: LANG('filter-distort-sync-xy'),\n            callback: (val) => {\n                isSynced = val;\n                if (isSynced) {\n                    sync('x');\n                }\n            },\n        });\n\n        topRowEl.append(\n            typeOptions.getElement(),\n            BB.el({css: {flexGrow: '1'}}),\n            syncToggle.getElement(),\n        );\n\n        const xyRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n            },\n        });\n        const leftCol = BB.el({\n            parent: xyRowEl,\n            css: {\n                marginRight: '10px',\n            },\n        });\n        const rightCol = BB.el({parent: xyRowEl});\n\n        const sliderWidth = isSmall ? 300 : 245;\n        const sliderArr: KlSlider[] = [];\n\n        (['x', 'y'] as const).forEach((item, index) => {\n            const targetEl = index === 0 ? leftCol : rightCol;\n\n            const scaleSlider = new KlSlider({\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 1,\n                max: 1000,\n                curve: 'quadratic',\n                value: settings.scale[item],\n                eventResMs: eventResMs,\n                onChange: (val) => {\n                    settings.scale[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            scaleSlider.getElement().style.marginTop = '20px';\n            targetEl.append(scaleSlider.getElement());\n\n            const strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 200,\n                curve: 'quadratic',\n                value: settings.strength[item],\n                eventResMs: eventResMs,\n                onChange: (val) => {\n                    settings.strength[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            strengthSlider.getElement().style.marginTop = '10px';\n            targetEl.append(strengthSlider.getElement());\n\n            const phaseSlider = new KlSlider({\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: settings.phase[item],\n                manualInputRoundDigits: 2,\n                eventResMs: eventResMs,\n                formatFunc: (val) => BB.round(val, 2),\n                onChange: (val) => {\n                    settings.phase[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            phaseSlider.getElement().style.marginTop = '10px';\n            targetEl.append(phaseSlider.getElement());\n\n            sliderArr.push(scaleSlider);\n            sliderArr.push(strengthSlider);\n            sliderArr.push(phaseSlider);\n        });\n\n        const stepSlider = new KlSlider({\n            label: LANG('filter-distort-stepsize'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 300,\n            curve: 'quadratic',\n            value: settings.stepSize,\n            eventResMs: eventResMs,\n            onChange: (val) => {\n                settings.stepSize = Math.round(val);\n                preview.render();\n            },\n        });\n\n        stepSlider.getElement().style.marginTop = '20px';\n        stepSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(stepSlider.getElement());\n\n\n        // ---- preview ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                const scaledSettings = BB.copyObj(settings);\n                scaledSettings.stepSize *= transform.scaleX;\n                scaledSettings.strength.x *= transform.scaleX;\n                scaledSettings.strength.y *= transform.scaleY;\n                if (scaledSettings.distortType !== 2) {\n                    scaledSettings.scale.x *= transform.scaleX;\n                    scaledSettings.scale.y *= transform.scaleY;\n                }\n                scaledSettings.offset.x = -transform.x;\n                scaledSettings.offset.y = -transform.y;\n\n                return fxCanvas.multiplyAlpha().distort(scaledSettings).unmultiplyAlpha();\n            },\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = layers.map((item, i) => {\n            return {\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false,\n            };\n        });\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        preview.render();\n        preview.getElement().classList.add(css({\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n        const destroy = () => {\n            typeOptions.destroy();\n            sliderArr.forEach(item => item.destroy());\n            stepSlider.destroy();\n            syncToggle.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n\n        // ----- result -------------------\n        const result: TFilterGetDialogResult<TFilterDistortInput> = {\n            element: rootEl,\n            destroy,\n            getInput: () => {\n                destroy();\n                return BB.copyObj(settings);\n            },\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterDistortInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'distort'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterDistortHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGB} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {input} from '../ui/components/input';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {drawVanishPoint} from '../image-operations/draw-vanish-point';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {DraggableInput} from '../ui/components/draggable-input';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterVanishPointInput = {\n    x: number;\n    y: number;\n    lines: number;\n    thickness: number;\n    color: IRGB;\n    opacity: number;\n};\n\nexport type TFilterVanishPointHistoryEntry = TFilterHistoryEntry<\n    'vanishPoint',\n    TFilterVanishPointInput>;\n\nexport const filterVanishPoint = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = BB.ctx(previewCanvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterVanishPointInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterVanishPointInput = {\n            x: context.canvas.width / 2,\n            y: context.canvas.height / 2,\n            lines: 8,\n            thickness: 2,\n            color: {r: 0, g: 0, b: 0},\n            opacity: 1,\n        };\n\n        const linesSlider = new KlSlider({\n            label: LANG('filter-vanish-point-lines'),\n            width: 300,\n            height: 30,\n            min: 2,\n            max: 20,\n            value: settingsObj.lines,\n            curve: 'quadratic',\n            eventResMs: eventResMs,\n            onChange: function (val) {\n                settingsObj.lines = Math.round(val);\n                update();\n            },\n        });\n        linesSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(linesSlider.getElement());\n\n        const line1 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        const line2 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                marginBottom: '10px',\n            },\n        });\n        const xInput = input({\n            init: settingsObj.x,\n            type: 'number',\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.x = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y,\n                });\n                update();\n            },\n        });\n        const yInput = input({\n            init: settingsObj.y,\n            type: 'number',\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.y = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y,\n                });\n                update();\n            },\n        });\n        const thicknessInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.thickness = parseFloat(v);\n                update();\n            },\n        });\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\n                update();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({content: 'X:', css: labelStyle}),\n            xInput,\n            BB.el({content: 'Y:', css: labelStyle}),\n            yInput,\n        );\n        line2.append(\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\n            thicknessInput,\n            BB.el({css:{flexGrow: '1'}}),\n            colorOptions.getElement(),\n        );\n\n        // ---- preview input processing ----\n        function syncInputs (): void {\n            xInput.value = '' + settingsObj.x;\n            yInput.value = '' + settingsObj.y;\n        }\n\n        function update (): void {\n            const ctx = previewCtx;\n            const w = previewCanvas.width;\n            const h = previewCanvas.height;\n\n            ctx.save();\n            ctx.clearRect(0, 0, w, h);\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            drawVanishPoint(\n                ctx,\n                settingsObj.x,\n                settingsObj.y,\n                settingsObj.lines,\n                Math.max(settingsObj.thickness, 1),\n                settingsObj.color,\n                settingsObj.opacity,\n            );\n\n            ctx.restore();\n            preview.render();\n        }\n\n        const onRender = () => {\n            dragInput.setTransform(preview.getTransform());\n            return previewCanvas;\n        };\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? onRender : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        BB.css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n            overflow: 'hidden',\n        });\n\n        const dragInput = new DraggableInput({\n            value: {\n                x: settingsObj.x,\n                y: settingsObj.y,\n            },\n            onChange: (val) => {\n                settingsObj.x = Math.round(val.x);\n                settingsObj.y = Math.round(val.y);\n                syncInputs();\n                update();\n            },\n        });\n\n        update();\n\n        preview.getElement().append(dragInput.getElement());\n        rootEl.append(preview.getElement());\n\n\n\n        result.destroy = () => {\n            linesSlider.destroy();\n            colorOptions.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterVanishPointInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterVanishPointInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        drawVanishPoint(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.lines,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity,\n        );\n        history.pause(false);\n\n        history.push({\n            tool: ['filter', 'vanishPoint'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterVanishPointHistoryEntry);\n        return true;\n    },\n\n};","import {drawShape} from './shape-tool';\nimport {BB} from '../../bb/bb';\nimport {IRGB} from '../kl-types';\n\nexport function drawVanishPoint (\n    ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    lines: number, // int, [2, inf]\n    thickness: number, // px\n    color: IRGB,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n\n    const degIncrement = 180 / lines;\n    for (let deg = 0; deg < 180; deg += degIncrement) {\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\n        drawShape(\n            ctx,\n            {\n                type: 'line',\n                x1: x,\n                y1: y,\n                x2: p2.x,\n                y2: p2.y,\n                //angleRad: 0,\n                isOutwards: true,\n                opacity,\n                //isEraser: false,\n                strokeRgb: color,\n                lineWidth: thickness,\n                //doLockAlpha: false,\n            }\n        );\n    }\n\n    ctx.restore();\n}","import {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {loadAgPsd} from './load-ag-psd';\n\nexport async function klCanvasToPsdBlob (klCanvas: KlCanvas): Promise<Blob> {\n    const layerArr = klCanvas.getLayersFast();\n\n    const psdConfig: Psd = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: layerArr.map(item => {\n            // todo - can be optimized if layer mostly empty\n            return {\n                name: item.name,\n                hidden: !item.isVisible,\n                opacity: item.opacity,\n                canvas: item.canvas,\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                left: 0,\n                top: 0,\n            };\n        }),\n    };\n\n    const agPsd = await loadAgPsd();\n    const buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([buffer], { type: 'application/octet-stream' });\n}","import {BB} from '../../bb/bb';\nimport {IDrawMoveEvent, TDrawEvent} from '../kl-types';\n\n/**\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\n * for onDraw events from KlCanvasWorkspace.\n *\n * in some draw event\n * out some draw event\n *\n * type: 'line' Events are just passed through.\n */\nexport class LineSmoothing {\n\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\n    private smoothing: number;\n    private lastMixedInput: {\n        x: number;\n        y: number;\n        pressure: number;\n    } | undefined;\n    private interval: ReturnType<typeof setInterval> | undefined;\n    private timeout: ReturnType<typeof setTimeout> | undefined;\n\n    // --- public ---\n    constructor (\n        p: {\n            smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\n        }\n    ) {\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\n    }\n\n    chainIn (event: TDrawEvent): TDrawEvent | null {\n        event = BB.copyObj(event);\n        this.timeout && clearTimeout(this.timeout);\n        this.interval && clearInterval(this.interval);\n\n        if (event.type === 'down') {\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure,\n            };\n        }\n\n        if (event.type === 'move') {\n\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure,\n            };\n\n            if (this.smoothing > 0) {\n                this.timeout = setTimeout(() => {\n                    this.interval = setInterval(() => {\n                        event = JSON.parse(JSON.stringify(event)) as IDrawMoveEvent;\n\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\n                        event.pressure = BB.mix(inputPressure, this.lastMixedInput!.pressure, this.smoothing);\n                        this.lastMixedInput = {\n                            x: event.x,\n                            y: event.y,\n                            pressure: event.pressure,\n                        };\n\n                        this.chainOut && this.chainOut(event);\n                    }, 35);\n                }, 80);\n            }\n\n        }\n\n        return event;\n    }\n\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\n        this.chainOut = func;\n    }\n\n    setSmoothing (s: number): void {\n        this.smoothing = BB.clamp(s, 0, 1);\n    }\n}\n","import {TDrawEvent} from '../kl-types';\n\n/**\n * cleans up DrawEvents. More trustworthy events. EventChain element\n *\n * in some draw event?\n * out some draw event?\n *\n * that events can only go line this: down -> n x move -> up\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\n */\nexport class LineSanitizer {\n\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\n    private isDrawing: boolean = false;\n\n    // --- public ---\n\n    chainIn (event: TDrawEvent): TDrawEvent | null {\n\n        if (event.type === 'down') {\n            if (this.isDrawing) {\n                //console.log('line sanitizer - down, but already drawing');\n                this.chainOut && this.chainOut({\n                    type: 'up',\n                    scale: event.scale,\n                    shiftIsPressed: event.shiftIsPressed,\n                    isCoalesced: false,\n                });\n            } else {\n                this.isDrawing = true;\n            }\n        }\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\n            return null;\n        }\n\n        if (event.type === 'up' && this.isDrawing) {\n            this.isDrawing = false;\n        }\n\n        return event;\n    }\n\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\n        this.chainOut = func;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n}\n","/**\n * from stabilizer dropdown value to line-smoothing value\n * @param s\n */\nexport function translateSmoothing (s: number): number {\n    if (s == 1) {\n        return 1 - 0.5;\n    }\n    if (s == 2) {\n        return 1 - 0.16;\n    }\n    if (s == 3) {\n        return 1 - 0.035;\n    }\n    if (s == 4) {\n        return 1 - 0.0175;\n    }\n    if (s == 5) {\n        return 1 - 0.00875;\n    }\n    return s;\n}","import {IKlPsd, IRGB, TDropOption, TKlCanvasLayer} from '../klecks/kl-types';\nimport {KL} from '../klecks/kl';\nimport {LANG} from '../language/language';\nimport {BB} from '../bb/bb';\nimport {klHistory, TMiscImportImageHistoryEntry} from '../klecks/history/kl-history';\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\nimport {HandUi} from '../klecks/ui/tool-tabs/hand-ui';\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\nimport {IRect, ISize2D} from '../bb/bb-types';\nimport {throwIfNull, throwIfUndefined} from '../bb/base/base';\n\n// todo later:\n// onImage: (project: IKlProject) => void\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\n\nexport class ImportHandler {\n\n    private readonly klRootEl: HTMLElement;\n    private readonly klMaxCanvasSize: number;\n    private readonly layerManager: LayerManager;\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\n    private readonly klCanvas: KlCanvas;\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\n    private readonly handUi: HandUi;\n\n    private readonly onColor: (rgb: IRGB) => void;\n\n\n    /**\n     *\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\n     * @param filename - string e.g. 'drawing.psd'\n     * @param optionStr? - 'default' | 'layer' | 'image'\n     */\n    private importFinishedLoading (\n        importedImage: IKlPsd | {\n            type: 'image';\n            width: number;\n            height: number;\n            canvas: HTMLCanvasElement | HTMLImageElement;\n        },\n        filename: string | undefined,\n        optionStr: 'default' | 'layer' | 'image',\n    ): void {\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('import-broken-file'),\n                buttons: ['Ok'],\n            });\n            return;\n        }\n\n        const getResizedDimensions = (width: number, height: number): ISize2D => {\n            let w = parseInt('' + width);\n            let h = parseInt('' + height);\n            if (w > this.klMaxCanvasSize) {\n                h = this.klMaxCanvasSize / w * h;\n                w = this.klMaxCanvasSize;\n            }\n            if (h > this.klMaxCanvasSize) {\n                w = this.klMaxCanvasSize / h * w;\n                h = this.klMaxCanvasSize;\n            }\n            w = parseInt('' + w);\n            h = parseInt('' + h);\n            return {\n                width: w,\n                height: h,\n            };\n        };\n\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\n\n            //resize first\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\n            const tempCanvasCtx = BB.ctx(tempCanvas);\n            tempCanvasCtx.drawImage(canvas, 0, 0);\n\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\n\n            this.klCanvas.reset({\n                width: resizedDimensions.width,\n                height: resizedDimensions.height,\n                image: tempCanvas,\n                layerName: filename,\n            });\n\n            this.layerManager.update(0);\n            this.setCurrentLayer(this.klCanvas.getLayer(0)!);\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        };\n\n        /**\n         *\n         * @param convertedPsdObj - if flattened then without layers\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\n         */\n        const importAsImagePsd = (convertedPsdObj: IKlPsd, cropObj?: IRect) => {\n            // crop\n            const crop = (\n                targetCanvas: HTMLCanvasElement,\n                cropCanvas: HTMLCanvasElement,\n                cropObj: IRect,\n            ): void => {\n                // eslint-disable-next-line no-self-assign\n                cropCanvas.width = cropCanvas.width;\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\n                targetCanvas.width = cropObj.width;\n                targetCanvas.height = cropObj.height;\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\n            };\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\n                convertedPsdObj.width = cropObj.width;\n                convertedPsdObj.height = cropObj.height;\n\n                if (!convertedPsdObj.layers) {\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\n                }\n                if (convertedPsdObj.layers) {\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                        const item = convertedPsdObj.layers[i];\n                        crop(item.image, cropCanvas, cropObj);\n                    }\n                }\n            }\n\n            // resize\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\n            convertedPsdObj.width = resizedDimensions.width;\n            convertedPsdObj.height = resizedDimensions.height;\n            if (!convertedPsdObj.layers) {\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\n            }\n            if (convertedPsdObj.layers) {\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                    const item = convertedPsdObj.layers[i];\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\n                }\n            }\n\n            let layerIndex;\n            if (convertedPsdObj.layers) {\n                layerIndex = this.klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    layers: convertedPsdObj.layers,\n                });\n            } else {\n                layerIndex = this.klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    image: convertedPsdObj.canvas,\n                });\n            }\n            this.layerManager.update(layerIndex);\n            this.setCurrentLayer(throwIfNull(this.klCanvas.getLayer(layerIndex)));\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        };\n\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\n            KL.showImportAsLayerDialog({\n                target: this.klRootEl,\n                klCanvas: this.klCanvas,\n                importImage: canvas,\n                callback: (transformObj, isPixelated?: boolean) => {\n                    if (!transformObj) {\n                        return;\n                    }\n\n                    klHistory.pause(true);\n                    this.klCanvas.addLayer();\n                    const layers = this.klCanvas.getLayers();\n                    const activeLayerIndex = layers.length - 1;\n                    if (filename) {\n                        this.klCanvas.renameLayer(activeLayerIndex, filename);\n                    }\n                    const activeLayerContext = throwIfNull(this.klCanvas.getLayerContext(activeLayerIndex));\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, undefined, isPixelated);\n                    this.setCurrentLayer(throwIfNull(this.klCanvas.getLayer(activeLayerIndex)));\n                    this.layerManager.update(activeLayerIndex);\n\n                    klHistory.pause(false);\n\n                    klHistory.push({\n                        tool: ['misc'],\n                        action: 'importImage',\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename],\n                    } as TMiscImportImageHistoryEntry);\n                },\n            });\n        };\n\n\n        if (optionStr === 'default' || !optionStr) {\n            KL.showImportImageDialog({\n                image: importedImage,\n                target: this.klRootEl,\n                maxSize: this.klMaxCanvasSize,\n                callback: (res) => {\n                    if (res.type === 'as-image') {\n                        importAsImage(res.image);\n                    } else if (res.type === 'as-image-psd') {\n                        importAsImagePsd(res.image, res.cropObj);\n                    } else if (res.type === 'as-layer') {\n                        importAsLayer(res.image);\n                    } else if (res.type === 'cancel') {\n                        // nothing to do\n                    }\n                },\n            });\n        }\n\n        if (optionStr === 'layer') {\n            importAsLayer(importedImage.canvas);\n        }\n        if (optionStr === 'image') {\n            if (importedImage.type === 'psd') {\n                importAsImagePsd(importedImage);\n            } else {\n                importAsImage(importedImage.canvas);\n            }\n        }\n\n    }\n\n    // ---- public ----\n    constructor (\n        input: {\n            klRootEl: HTMLElement;\n            klMaxCanvasSize: number;\n            layerManager: LayerManager;\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\n            klCanvas: KlCanvas;\n            klCanvasWorkspace: KlCanvasWorkspace;\n            handUi: HandUi;\n        },\n        callback: {\n            onColor: (rgb: IRGB) => void;\n        }\n    ) {\n        this.klRootEl = input.klRootEl;\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\n        this.layerManager = input.layerManager;\n        this.setCurrentLayer = input.setCurrentLayer;\n        this.klCanvas = input.klCanvas;\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\n        this.handUi = input.handUi;\n\n        this.onColor = callback.onColor;\n    }\n\n\n\n    // ---- interface ----\n\n    onPaste (e: ClipboardEvent): void{\n        if (KL.dialogCounter.get() > 0) {\n            return;\n        }\n\n        const retrieveImageFromClipboardAsBlob = (\n            items: DataTransferItemList,\n            callback: (file: File) => void,\n        ) => {\n            if (!items) {\n                return;\n            }\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf('image') == -1) {\n                    continue;\n                }\n                const file = items[i].getAsFile();\n                file && callback(file);\n            }\n        };\n\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!e.clipboardData) {\n            return;\n        }\n\n        if (e.clipboardData.files[0]) {\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\n                // If there's an image, display it in the canvas\n                const img = new Image();\n                img.onload = () => {\n                    URL.revokeObjectURL(img.src);\n                    this.importFinishedLoading({\n                        type: 'image',\n                        width: img.width,\n                        height: img.height,\n                        canvas: img,\n                    }, undefined, 'default');\n                };\n                const URLObj = window.URL || window.webkitURL;\n                img.src = URLObj.createObjectURL(imageBlob);\n            });\n        } else if (e.clipboardData.items[0]) {\n            e.clipboardData.items[0].getAsString((pasteStr) => {\n                pasteStr = pasteStr.trim();\n                if (pasteStr.match(/^https?/)) {\n                    // url\n                    const img = new Image();\n                    img.onload = () => {\n                        this.importFinishedLoading({\n                            type: 'image',\n                            width: img.width,\n                            height: img.height,\n                            canvas: img,\n                        }, undefined, 'default');\n                    };\n                    img.onerror = (e) => {\n                        console.log('error loading', e);\n                    };\n                    img.crossOrigin = 'Anonymous';\n                    img.src = pasteStr;\n\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\n                    // url\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\n                    rgbObj && this.onColor(rgbObj);\n                }\n            });\n\n        }\n    }\n\n    handleFileSelect (files: FileList, optionStr: TDropOption): void {\n\n        const showWarningPsdFlattened = () => {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'warning',\n                message: LANG('import-psd-unsupported') + '<br /><br />',\n                buttons: ['Ok'],\n            });\n        };\n\n        let hasUnsupportedFile = false;\n        // eslint-disable-next-line no-cond-assign\n        for (let i = 0, file; file = files[i]; i++) {\n            const nameSplit = file.name.split('.');\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\n            if (extension === 'psd') {\n\n                ((f) => {\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\n                    const maxResolution = 4096;\n\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\n                        KL.popup({\n                            target: this.klRootEl,\n                            type: 'error',\n                            message: 'File too big. Unable to import.<br /><br />',\n                            buttons: ['Ok'],\n                        });\n                        return;\n                    }\n\n                    const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\n                    let loaderIsOpen = true;\n                    let closeLoader: (() => void) | null;\n\n                    if (doShowLoader) {\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: LANG('import-opening'),\n                            callback: (result) => {\n                                loaderIsOpen = false;\n                                closeLoader = null;\n                            },\n                            closeFunc: (f) => {\n                                closeLoader = f;\n                            },\n                        });\n                    }\n\n\n                    const reader = new FileReader();\n                    reader.onload = (readerResult) => {\n                        const target = throwIfNull(readerResult.target);\n\n                        KL.loadAgPsd().then((agPsdLazy) => {\n\n                            if (doShowLoader && !loaderIsOpen) {\n                                return;\n                            }\n\n                            try {\n                                let psd;\n\n                                // first pass, only read metadata\n                                psd = agPsdLazy.readPsd(\n                                    (target.result as any),\n                                    {\n                                        skipLayerImageData: true,\n                                        skipThumbnail: true,\n                                        skipCompositeImageData: true,\n                                    });\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    KL.popup({\n                                        target: this.klRootEl,\n                                        type: 'error',\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\n                                            + '<br /><br />'\n                                            + LANG('import-psd-size') + ': ' + psd.width + ' x ' + psd.height + ' pixels'\n                                            + '<br /><br />'\n                                        ,\n                                        buttons: ['Ok'],\n                                    });\n                                    return;\n                                }\n\n\n                                // second pass, now load actual data.\n                                psd = null;\n\n                                try {\n                                    psd = agPsdLazy.readPsd((target.result as any));\n                                } catch (e) {\n                                    //console.log('failed regular psd import', e);\n                                }\n                                if (psd) {\n                                    //console.log('psd', psd);\n                                    const convertedPsd = KL.PSD.readPsd(psd);\n                                    //console.log('converted', convertedPsd);\n                                    if (optionStr === 'image' && convertedPsd.error) {\n                                        showWarningPsdFlattened();\n                                    }\n\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    this.importFinishedLoading(convertedPsd, f.name, optionStr);\n                                } else {\n                                    psd = agPsdLazy.readPsd((target.result as any), { skipLayerImageData: true, skipThumbnail: true });\n\n                                    if (optionStr === 'image') {\n                                        showWarningPsdFlattened();\n                                    }\n\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    this.importFinishedLoading({\n                                        type: 'psd',\n                                        width: psd.width,\n                                        height: psd.height,\n                                        canvas: throwIfUndefined(psd.canvas),\n                                        error: true,\n                                    }, f.name, optionStr);\n                                }\n\n                            } catch (e) {\n                                closeLoader && closeLoader();\n                                KL.popup({\n                                    target: this.klRootEl,\n                                    type: 'error',\n                                    message: 'Failed to load PSD.<br /><br />',\n                                    buttons: ['Ok'],\n                                });\n                                console.log(e);\n                                setTimeout(() => {\n                                    throw new Error('psd load error');\n                                });\n                            }\n                        }).catch((e) => {\n                            closeLoader && closeLoader();\n                            alert('Error: failed to load PSD library');\n                        });\n\n                    };\n                    reader.readAsArrayBuffer(f);\n                })(file);\n\n            } else if (file.type.match('image.*')) {\n                ((f) => {\n                    window.URL = window.URL || window.webkitURL;\n                    const url = window.URL.createObjectURL(f);\n                    const im = new Image();\n                    im.src = url;\n                    BB.loadImage(im, () => {\n                        this.importFinishedLoading({\n                            type: 'image',\n                            width: im.width,\n                            height: im.height,\n                            canvas: im,\n                        }, f.name, optionStr);\n                    });\n                })(file);\n            } else {\n                hasUnsupportedFile = true;\n            }\n        }\n        if (hasUnsupportedFile) {\n            KL.popup({\n                target: this.klRootEl,\n                message: LANG('import-unsupported-file'),\n                type: 'error',\n                buttons: ['OK'],\n            });\n        }\n    }\n}\n\n\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tab-settings.9f59f00e.svg\" + \"?\" + Date.now();","module.exports = require('./helpers/bundle-url').getBundleURL('d3gnI') + \"tab-layers.c98c4feb.svg\" + \"?\" + Date.now();","import {IVector2D} from '../bb/bb-types';\n\n\n\nexport type TConsoleApi = {\n    readonly draw: (path: IVector2D[]) => void;\n    readonly help: () => void;\n};\n\nexport function createConsoleApi (\n    p: {\n        onDraw: (path: IVector2D[]) => void;\n    }\n): TConsoleApi {\n\n    const output = ['Draw via the console! Learn more: %cKL.help()', 'background: #000; color: #0f0;'];\n    'info' in (console as any) ? console.info(...output) : console.log(...output);\n\n    return Object.freeze({\n        draw: (path: IVector2D[]): void => {\n            p.onDraw(path);\n        },\n        help: (): void => {\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\nKL.help() // print help\n`);\n        },\n    });\n}"],"names":["MS","MOZ","WEBKIT","COMMENT","RULESET","DECLARATION","PAGE","MEDIA","IMPORT","CHARSET","VIEWPORT","SUPPORTS","DOCUMENT","NAMESPACE","KEYFRAMES","FONT_FACE","COUNTER_STYLE","FONT_FEATURE_VALUES","LAYER","abs","Math","from","String","fromCharCode","assign","Object","hash","value","length","charat","trim","match","pattern","exec","replace","replacement","indexof","search","indexOf","index","charCodeAt","substr","begin","end","slice","strlen","sizeof","append","array","push","combine","callback","map","join","line","column","position","character","characters","node","root","parent","type","props","children","return","copy","char","prev","next","peek","caret","token","alloc","dealloc","delimit","delimiter","tokenize","tokenizer","whitespace","identifier","escaping","count","commenter","compile","parse","rule","rules","rulesets","pseudo","points","declarations","offset","atrule","property","previous","variable","scanning","ampersand","reference","comment","declaration","ruleset","post","size","i","j","k","x","y","z","prefix","some","element","_","a","b","c","d","e","f","serialize","output","stringify","middleware","collection","rulesheet","prefixer","namespace"],"version":3,"file":"index.9aa0ef6a.js.map","sourceRoot":"/__parcel_source_root/"}